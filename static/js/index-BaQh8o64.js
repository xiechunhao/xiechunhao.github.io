/*!  build: Vue Shop Vite 
     copyright: https://vuejs-core.cn/shop-vite   
     time: 2024-09-26 21:23:19 
 */
import{p as y,d as V,a5 as R,B as b,o as T,A as B,S as v,K as g,Y,X as m,u,e as _,I as C}from"./vsv-element-plus-CleF0dO9.js";import{I as D,a as I,t as h,v as M,_ as N}from"./index-wMoNB7-P.js";import"./vsv-icon-DrZkBOPN.js";import"./vsv-nprogress-D5kd6v05.js";function P(c={}){const{immediate:d=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:t}=c;let a,i;const f=async(e=!0)=>{await i};async function p(){if("serviceWorker"in navigator){if(a=await D(async()=>{const{Workbox:e}=await import("./workbox-window.prod.es5-D5gOYdM7.js");return{Workbox:e}},[],import.meta.url).then(({Workbox:e})=>new e("./sw.js",{scope:"./",type:"classic"})).catch(e=>{t==null||t(e)}),!a)return;a.addEventListener("activated",e=>{(e.isUpdate||e.isExternal)&&window.location.reload()}),a.addEventListener("installed",e=>{e.isUpdate||o==null||o()}),a.register({immediate:d}).then(e=>{s?s("./sw.js",e):r==null||r(e)}).catch(e=>{t==null||t(e)})}}return i=p(),f}function U(c={}){const{immediate:d=!0,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:t}=c,a=y(!1),i=y(!1);return{updateServiceWorker:P({immediate:d,onNeedRefresh(){a.value=!0,n==null||n()},onOfflineReady(){i.value=!0,o==null||o()},onRegistered:r,onRegisteredSW:s,onRegisterError:t}),offlineReady:i,needRefresh:a}}const j={class:"vab-update-icon"},E=V({name:"VabUpdate",__name:"index",setup(c){const{getTitle:d}=I(),n=ref(h("立即升级")),o=ref(!1),r=ref(M),s=ref(!1),{offlineReady:t,needRefresh:a,updateServiceWorker:i}=U(),f=R().format("YYYY-MM-DD"),p=async()=>{n.value=h("正在更新"),o.value=!0,await i(),setTimeout(()=>{o.value=!1,n.value=h("更新完成"),t.value=!1,a.value=!1,setTimeout(()=>{s.value=!1,location.reload(!0)},1e3*3)},1e3*7)},e=()=>{(t.value||a.value)&&(s.value=!0,p())};return onMounted(()=>{setTimeout(()=>{e()},1e3*3)}),watch(t||a,()=>{e()},{immediate:!0}),onBeforeMount(()=>{$sub("update-website",w=>{w&&(r.value=w),t.value=!0,a.value=!0,e()})}),(w,l)=>{const S=b("vab-icon"),x=b("el-button"),W=b("vab-dialog");return T(),B(W,{modelValue:u(s),"onUpdate:modelValue":l[0]||(l[0]=k=>C(s)?s.value=k:null),"append-to-body":"",class:"vab-update","show-close":!1,"show-fullscreen":!1,width:"410px"},{header:v(()=>l[1]||(l[1]=[])),footer:v(()=>[g(x,{loading:u(o),type:"primary",onClick:p},{default:v(()=>[Y(m(u(n)),1)]),_:1},8,["loading"])]),default:v(()=>[_("div",j,[g(S,{icon:"upload-cloud-2-fill"})]),g(S,{class:"vab-update-cup",icon:"cup-line"}),l[2]||(l[2]=_("h3",null,"版本更新：",-1)),_("p",null,m(u(d))+" V"+m(u(r)),1),_("p",null,"更新时间："+m(u(f)),1)]),_:1},8,["modelValue"])}}}),X=N(E,[["__scopeId","data-v-60af51ca"]]);export{X as default};
