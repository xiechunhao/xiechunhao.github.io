/*!  build: Vue Shop Vite 
     copyright: https://vuejs-core.cn/shop-vite   
     time: 2024-09-25 17:01:24 
 */
import{r as y,d as V,a7 as R,F as b,o as T,D,V as v,M as g,_ as M,Z as m,u,e as _,K as B}from"./vsv-element-plus-CbS2IxKo.js";import{I as C,a as N,t as h,v as P,_ as U}from"./index-BnT9uhJE.js";import"./vsv-icon-93gfr_RM.js";import"./vsv-nprogress-DzPgnd7z.js";function Y(c={}){const{immediate:d=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:t}=c;let a,i;const f=async(e=!0)=>{await i};async function p(){if("serviceWorker"in navigator){if(a=await C(async()=>{const{Workbox:e}=await import("./workbox-window.prod.es5-D5gOYdM7.js");return{Workbox:e}},[],import.meta.url).then(({Workbox:e})=>new e("./sw.js",{scope:"./",type:"classic"})).catch(e=>{t==null||t(e)}),!a)return;a.addEventListener("activated",e=>{(e.isUpdate||e.isExternal)&&window.location.reload()}),a.addEventListener("installed",e=>{e.isUpdate||o==null||o()}),a.register({immediate:d}).then(e=>{s?s("./sw.js",e):r==null||r(e)}).catch(e=>{t==null||t(e)})}}return i=p(),f}function j(c={}){const{immediate:d=!0,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:t}=c,a=y(!1),i=y(!1);return{updateServiceWorker:Y({immediate:d,onNeedRefresh(){a.value=!0,n==null||n()},onOfflineReady(){i.value=!0,o==null||o()},onRegistered:r,onRegisteredSW:s,onRegisterError:t}),offlineReady:i,needRefresh:a}}const E={class:"vab-update-icon"},I=V({name:"VabUpdate",__name:"index",setup(c){const{getTitle:d}=N(),n=ref(h("立即升级")),o=ref(!1),r=ref(P),s=ref(!1),{offlineReady:t,needRefresh:a,updateServiceWorker:i}=j(),f=R().format("YYYY-MM-DD"),p=async()=>{n.value=h("正在更新"),o.value=!0,await i(),setTimeout(()=>{o.value=!1,n.value=h("更新完成"),t.value=!1,a.value=!1,setTimeout(()=>{s.value=!1,location.reload(!0)},1e3*3)},1e3*7)},e=()=>{(t.value||a.value)&&(s.value=!0,p())};return onMounted(()=>{setTimeout(()=>{e()},1e3*3)}),watch(t||a,()=>{e()},{immediate:!0}),onBeforeMount(()=>{$sub("update-website",w=>{w&&(r.value=w),t.value=!0,a.value=!0,e()})}),(w,l)=>{const S=b("vab-icon"),x=b("el-button"),W=b("vab-dialog");return T(),D(W,{modelValue:u(s),"onUpdate:modelValue":l[0]||(l[0]=k=>B(s)?s.value=k:null),"append-to-body":"",class:"vab-update","show-close":!1,"show-fullscreen":!1,width:"410px"},{header:v(()=>l[1]||(l[1]=[])),footer:v(()=>[g(x,{loading:u(o),type:"primary",onClick:p},{default:v(()=>[M(m(u(n)),1)]),_:1},8,["loading"])]),default:v(()=>[_("div",E,[g(S,{icon:"upload-cloud-2-fill"})]),g(S,{class:"vab-update-cup",icon:"cup-line"}),l[2]||(l[2]=_("h3",null,"版本更新：",-1)),_("p",null,m(u(d))+" V"+m(u(r)),1),_("p",null,"更新时间："+m(u(f)),1)]),_:1},8,["modelValue"])}}}),K=U(I,[["__scopeId","data-v-60af51ca"]]);export{K as default};
