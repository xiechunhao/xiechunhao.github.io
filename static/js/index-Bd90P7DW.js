/*!  build: Vue Shop Vite 
     copyright: https://vuejs-core.cn/shop-vite   
     time: 2025-03-11 00:13:46 
 */
import{l as y,d as V,a5 as R,z as T,U as v,D,u,A as b,o as U,b as m,J as g,Y as _,Z as Y}from"./vsv-element-plus-CWjYVfvE.js";import{I as B,a as C,t as h,v as M,_ as N}from"./index-D_keMk_X.js";import"./vsv-icon-CzoHxvAi.js";import"./vsv-nprogress-D-M_H-zP.js";function P(c={}){const{immediate:d=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:t}=c;let a,l;const f=async(e=!0)=>{await l};async function p(){if("serviceWorker"in navigator){if(a=await B(async()=>{const{Workbox:e}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:e}},[],import.meta.url).then(({Workbox:e})=>new e("./sw.js",{scope:"./",type:"classic"})).catch(e=>{t==null||t(e)}),!a)return;a.addEventListener("activated",e=>{(e.isUpdate||e.isExternal)&&window.location.reload()}),a.addEventListener("installed",e=>{e.isUpdate||o==null||o()}),a.register({immediate:d}).then(e=>{s?s("./sw.js",e):r==null||r(e)}).catch(e=>{t==null||t(e)})}}return l=p(),f}function j(c={}){const{immediate:d=!0,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:t}=c,a=y(!1),l=y(!1);return{updateServiceWorker:P({immediate:d,onNeedRefresh(){a.value=!0,n==null||n()},onOfflineReady(){l.value=!0,o==null||o()},onRegistered:r,onRegisteredSW:s,onRegisterError:t}),offlineReady:l,needRefresh:a}}const E={class:"vab-update-icon"},I=V({name:"VabUpdate",__name:"index",setup(c){const{getTitle:d}=C(),n=ref(h("立即升级")),o=ref(!1),r=ref(M),s=ref(!1),{offlineReady:t,needRefresh:a,updateServiceWorker:l}=j(),f=R().format("YYYY-MM-DD"),p=async()=>{n.value=h("正在更新"),o.value=!0,await l(),setTimeout(()=>{o.value=!1,n.value=h("更新完成"),t.value=!1,a.value=!1,setTimeout(()=>{s.value=!1,location.reload(!0)},1e3*3)},1e3*7)},e=()=>{(t.value||a.value)&&(s.value=!0,p())};return onMounted(()=>{setTimeout(()=>{e()},1e3*3)}),watch(t||a,()=>{e()},{immediate:!0}),onBeforeMount(()=>{$sub("update-website",w=>{w&&(r.value=w),t.value=!0,a.value=!0,e()})}),(w,i)=>{const S=b("vab-icon"),x=b("el-button"),W=b("vab-dialog");return U(),T(W,{modelValue:u(s),"onUpdate:modelValue":i[0]||(i[0]=k=>D(s)?s.value=k:null),"append-to-body":"",class:"vab-update","show-close":!1,"show-fullscreen":!1,width:"410px"},{header:v(()=>i[1]||(i[1]=[])),footer:v(()=>[g(x,{loading:u(o),type:"primary",onClick:p},{default:v(()=>[Y(_(u(n)),1)]),_:1},8,["loading"])]),default:v(()=>[m("div",E,[g(S,{icon:"upload-cloud-2-fill"})]),g(S,{class:"vab-update-cup",icon:"cup-line"}),i[2]||(i[2]=m("h3",null,"版本更新：",-1)),m("p",null,_(u(d))+" V"+_(u(r)),1),m("p",null,"更新时间："+_(u(f)),1)]),_:1},8,["modelValue"])}}}),J=N(I,[["__scopeId","data-v-60af51ca"]]);export{J as default};
