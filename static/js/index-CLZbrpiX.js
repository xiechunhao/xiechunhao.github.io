/*!  build: Vue Shop Vite 
     copyright: https://vuejs-core.cn/shop-vite   
     time: 2025-02-08 15:10:48 
 */
import{p as y,d as V,a5 as R,A as T,U as v,F as B,u,B as b,o as U,e as m,K as g,Y as _,Z as Y}from"./vsv-element-plus-D84I6Pnf.js";import{I as C,a as D,t as h,v as M,_ as N}from"./index-BL5slC2T.js";import"./vsv-icon-DZABqXig.js";import"./vsv-nprogress-0btfRK0G.js";function P(c={}){const{immediate:d=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:t}=c;let a,i;const f=async(e=!0)=>{await i};async function p(){if("serviceWorker"in navigator){if(a=await C(async()=>{const{Workbox:e}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:e}},[],import.meta.url).then(({Workbox:e})=>new e("./sw.js",{scope:"./",type:"classic"})).catch(e=>{t==null||t(e)}),!a)return;a.addEventListener("activated",e=>{(e.isUpdate||e.isExternal)&&window.location.reload()}),a.addEventListener("installed",e=>{e.isUpdate||o==null||o()}),a.register({immediate:d}).then(e=>{s?s("./sw.js",e):r==null||r(e)}).catch(e=>{t==null||t(e)})}}return i=p(),f}function j(c={}){const{immediate:d=!0,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:t}=c,a=y(!1),i=y(!1);return{updateServiceWorker:P({immediate:d,onNeedRefresh(){a.value=!0,n==null||n()},onOfflineReady(){i.value=!0,o==null||o()},onRegistered:r,onRegisteredSW:s,onRegisterError:t}),offlineReady:i,needRefresh:a}}const E={class:"vab-update-icon"},I=V({name:"VabUpdate",__name:"index",setup(c){const{getTitle:d}=D(),n=ref(h("立即升级")),o=ref(!1),r=ref(M),s=ref(!1),{offlineReady:t,needRefresh:a,updateServiceWorker:i}=j(),f=R().format("YYYY-MM-DD"),p=async()=>{n.value=h("正在更新"),o.value=!0,await i(),setTimeout(()=>{o.value=!1,n.value=h("更新完成"),t.value=!1,a.value=!1,setTimeout(()=>{s.value=!1,location.reload(!0)},1e3*3)},1e3*7)},e=()=>{(t.value||a.value)&&(s.value=!0,p())};return onMounted(()=>{setTimeout(()=>{e()},1e3*3)}),watch(t||a,()=>{e()},{immediate:!0}),onBeforeMount(()=>{$sub("update-website",w=>{w&&(r.value=w),t.value=!0,a.value=!0,e()})}),(w,l)=>{const S=b("vab-icon"),x=b("el-button"),W=b("vab-dialog");return U(),T(W,{modelValue:u(s),"onUpdate:modelValue":l[0]||(l[0]=k=>B(s)?s.value=k:null),"append-to-body":"",class:"vab-update","show-close":!1,"show-fullscreen":!1,width:"410px"},{header:v(()=>l[1]||(l[1]=[])),footer:v(()=>[g(x,{loading:u(o),type:"primary",onClick:p},{default:v(()=>[Y(_(u(n)),1)]),_:1},8,["loading"])]),default:v(()=>[m("div",E,[g(S,{icon:"upload-cloud-2-fill"})]),g(S,{class:"vab-update-cup",icon:"cup-line"}),l[2]||(l[2]=m("h3",null,"版本更新：",-1)),m("p",null,_(u(d))+" V"+_(u(r)),1),m("p",null,"更新时间："+_(u(f)),1)]),_:1},8,["modelValue"])}}}),K=N(I,[["__scopeId","data-v-60af51ca"]]);export{K as default};
