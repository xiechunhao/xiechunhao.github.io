/*!  build: Vue Shop Vite 
     copyright: https://vuejs-core.cn/shop-vite   
     time: 2025-02-28 11:53:44 
 */
import{r as y,d as V,ah as R,C as T,V as v,G as C,u,D as b,o as D,e as m,L as g,Z as _,_ as B}from"./vsv-element-plus-DQNbQgVr.js";import{f as L,a as M,t as h,v as N,_ as P}from"./index-DXRDwnmL.js";import"./vsv-icon-BSoeDgwL.js";import"./vsv-nprogress-BCb6Y0ID.js";function U(c={}){const{immediate:d=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:t}=c;let a,i;const f=async(e=!0)=>{await i};async function p(){if("serviceWorker"in navigator){if(a=await L(async()=>{const{Workbox:e}=await import("workbox-window");return{Workbox:e}},[],import.meta.url).then(({Workbox:e})=>new e("./sw.js",{scope:"./",type:"classic"})).catch(e=>{t==null||t(e)}),!a)return;a.addEventListener("activated",e=>{(e.isUpdate||e.isExternal)&&window.location.reload()}),a.addEventListener("installed",e=>{e.isUpdate||o==null||o()}),a.register({immediate:d}).then(e=>{s?s("./sw.js",e):r==null||r(e)}).catch(e=>{t==null||t(e)})}}return i=p(),f}function Y(c={}){const{immediate:d=!0,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:t}=c,a=y(!1),i=y(!1);return{updateServiceWorker:U({immediate:d,onNeedRefresh(){a.value=!0,n==null||n()},onOfflineReady(){i.value=!0,o==null||o()},onRegistered:r,onRegisteredSW:s,onRegisterError:t}),offlineReady:i,needRefresh:a}}const j={class:"vab-update-icon"},E=V({name:"VabUpdate",__name:"index",setup(c){const{getTitle:d}=M(),n=ref(h("立即升级")),o=ref(!1),r=ref(N),s=ref(!1),{offlineReady:t,needRefresh:a,updateServiceWorker:i}=Y(),f=R().format("YYYY-MM-DD"),p=async()=>{n.value=h("正在更新"),o.value=!0,await i(),setTimeout(()=>{o.value=!1,n.value=h("更新完成"),t.value=!1,a.value=!1,setTimeout(()=>{s.value=!1,location.reload(!0)},1e3*3)},1e3*7)},e=()=>{(t.value||a.value)&&(s.value=!0,p())};return onMounted(()=>{setTimeout(()=>{e()},1e3*3)}),watch(t||a,()=>{e()},{immediate:!0}),onBeforeMount(()=>{$sub("update-website",w=>{w&&(r.value=w),t.value=!0,a.value=!0,e()})}),(w,l)=>{const S=b("vab-icon"),x=b("el-button"),W=b("vab-dialog");return D(),T(W,{modelValue:u(s),"onUpdate:modelValue":l[0]||(l[0]=k=>C(s)?s.value=k:null),"append-to-body":"",class:"vab-update","show-close":!1,"show-fullscreen":!1,width:"410px"},{header:v(()=>l[1]||(l[1]=[])),footer:v(()=>[g(x,{loading:u(o),type:"primary",onClick:p},{default:v(()=>[B(_(u(n)),1)]),_:1},8,["loading"])]),default:v(()=>[m("div",j,[g(S,{icon:"upload-cloud-2-fill"})]),g(S,{class:"vab-update-cup",icon:"cup-line"}),l[2]||(l[2]=m("h3",null,"版本更新：",-1)),m("p",null,_(u(d))+" V"+_(u(r)),1),m("p",null,"更新时间："+_(u(f)),1)]),_:1},8,["modelValue"])}}}),Z=P(E,[["__scopeId","data-v-60af51ca"]]);export{Z as default};
