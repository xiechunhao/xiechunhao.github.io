(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["sale"],{c130:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page erpCase"},[a("l-panel",{scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"header_name"},[e._v(e._s(e.$t("销售订单")))])]},proxy:!0},{key:"toolRight",fn:function(){return[a("el-input",{attrs:{placeholder:e.$t("输入内容"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.queryData.f_Theme,callback:function(t){e.$set(e.queryData,"f_Theme",t)},expression:"queryData.f_Theme"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleSearch},slot:"append"})],1),a("l-tool-btns",{attrs:{hasRefresh:!1},on:{setting:e.lr_handleSettingTable,click:function(t){return e.handleAdd()}}},[a("l-excel-btns")],1)]},proxy:!0}],null,!1,1072631231)},[a("l-table",{ref:"mainTable",attrs:{loading:e.tableLoading,columns:e.lr_getPageColumns(e.columns),dataSource:e.tableData,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_ProductSynopsis",fn:function(t){return[t.row.f_ProductSynopsis?a("el-popover",{attrs:{placement:"bottom-start",title:e.$t("物料概要"),width:"140",trigger:"hover","popper-class":"erpcase-apply-popover"}},[a("div",{attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(e.getSynopsis(t.row.f_ProductSynopsis))+" "),a("i",{staticClass:"el-icon-caret-bottom"})]),a("div",{staticClass:"popover-list"},e._l(t.row.f_ProductSynopsis.split(","),(function(t,r){return a("div",{key:r,staticClass:"popover-list-item"},[a("p",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",width:"120px"}},[e._v(e._s(t))])])})),0)]):e._e()]}},{key:"f_OutStoreState",fn:function(e){return[0==e.row.f_OutStoreState?a("i",{staticClass:"learun-icon-circle-correct-base learun-success",staticStyle:{"font-size":"20px"}}):a("i",{staticClass:"learun-icon-circle-sigh-base learun-error",staticStyle:{"font-size":"20px"}})]}},{key:"f_InvoiceState",fn:function(e){return[0==e.row.f_InvoiceState?a("i",{staticClass:"learun-icon-circle-correct-base learun-success",staticStyle:{"font-size":"20px"}}):a("i",{staticClass:"learun-icon-circle-sigh-base learun-error",staticStyle:{"font-size":"20px"}})]}},{key:"f_GatherState",fn:function(e){return[0==e.row.f_GatherState?a("i",{staticClass:"learun-icon-circle-correct-base learun-success",staticStyle:{"font-size":"20px"}}):a("i",{staticClass:"learun-icon-circle-sigh-base learun-error",staticStyle:{"font-size":"20px"}})]}}],null,!1,4212575216)},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-dialog",{attrs:{title:e.$t(e.formTitle),visible:e.formVisible,height:800,width:1200},on:{"update:visible":function(t){e.formVisible=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},["查看订单详情"==e.formTitle?a("detail-form",{ref:"detailForm",attrs:{isReadOnly:e.formDetails},on:{refHandleDelete:e.handleDelete}}):a("my-form",{ref:"form",attrs:{isReadOnly:e.formDetails}})],1)],1)},n=[],i=(a("99af"),a("a434"),a("ac1f"),a("1276"),a("96cf"),a("1da1")),l=a("d2e5"),o=a("33b2"),s=window.$api.erpcase.sale,c={components:{MyForm:l["default"],DetailForm:o["default"]},data:function(){return{lr_isPage:!0,moduleCode:"ERP_Sale",queryData:{f_Theme:""},queryItems:[{label:"订单主题",prop:"f_Theme"}],tableLoading:!1,tableData:[],tableTotal:0,tableCurrentPage:1,tablePageSize:50,columns:[{label:"销售单号",prop:"f_Number",minWidth:140,align:"left",dataType:"encode",isNotAutoWrap:!0,fixed:!0},{label:"销售订单主题",prop:"f_Theme",minWidth:230,align:"left",dataType:"input",isNotAutoWrap:!0,fixed:!0},{label:"客户名称",prop:"f_ClientName",minWidth:230,align:"left",dataType:"dataSource",dataCode:"ERP_Customers",valueKey:"f_id",labelKey:"f_name"},{label:"销售日期",prop:"f_SaleDate",minWidth:120,align:"left",dataType:"datetime",format:"yyyy-MM-dd"},{label:"产品概要",prop:"f_ProductSynopsis",minWidth:120,align:"left",isNotAutoWrap:!0},{label:"总金额",prop:"f_AmountSum",minWidth:100,align:"left",dataType:"input"},{label:"优惠后金额",prop:"f_Discount",minWidth:100,align:"left",dataType:"input"},{label:"已收金额",prop:"f_AlreadyAmount",minWidth:100,align:"left",dataType:"input"},{label:"已到票金额",prop:"f_AlreadyTicket",minWidth:100,align:"left",dataType:"input"},{label:"出库",prop:"f_OutStoreState",minWidth:80,align:"left",dataType:"input"},{label:"开票",prop:"f_InvoiceState",minWidth:80,align:"left",dataType:"input"},{label:"收款",prop:"f_GatherState",minWidth:80,align:"left",dataType:"input"}],tableBtns:[{prop:"Details",label:"查看",width:40},{prop:"Edit",label:"编辑",width:40},{prop:"Delete",label:"删除",width:40}],formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1,formDetails:!1}},mounted:function(){this.init()},methods:{init:function(){this.loadTableData()},handleSearch:function(){this.loadTableData()},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},loadTableData:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e||(t.tableCurrentPage=1),t.tableLoading=!0,r=t.$deepClone(t.queryData),r.rows=t.tablePageSize,r.page=t.tableCurrentPage,r.sidx="F_CreateDate DESC",a.next=8,t.$awaitWraper(s.getPage(r));case 8:n=a.sent,null!=n?(t.tableData=n.rows,t.tableTotal=n.records):t.tableData=[],t.tableLoading=!1;case 11:case"end":return a.stop()}}),a)})))()},getSynopsis:function(e){var t=e.split(",");return 1==t.length?"".concat(t[0].split(":")[0]):"".concat(t[0].split(":")[0],"等").concat(t.length,"项")},handleEdit:function(e,t){this.formVisible=!1,this.formEdit=!0,this.formDetails=!1,this.formEditRow=t,this.handleShowForm("编辑")},handleDetails:function(e,t){this.formEdit=!0,this.formDetails=!1,this.formEditRow=t,this.handleShowForm("查看订单详情")},handleDelete:function(e,t){var a=this;console.log("删除"),this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.tableData.splice(e,1),a.tableTotal--,r.next=4,s.remove(t.f_Id);case 4:a.$message({type:"success",message:a.$t("删除成功!")});case 5:case"end":return r.stop()}}),r)})))).catch((function(){a.$message({type:"info",message:a.$t("已取消删除!")})}))},handleAdd:function(){this.formEdit=!1,this.formDetails=!1,this.handleShowForm("新增订单")},handleSave:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i,l,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e("保存数据中..."),"查看订单详情"!=a.formTitle){r.next=11;break}return r.next=4,a.$refs.detailForm.validateForm();case 4:if(!r.sent){r.next=9;break}return r.next=7,a.$refs.detailForm.saveForm({keyValue:a.formEdit?a.formEditRow.f_Id:"",isEdit:a.formEdit});case 7:n=r.sent,n&&(i=a.formEdit?"更新成功!":"新增成功!",a.$message({type:"success",message:a.$t(i)}),a.loadTableData(),a.formVisible=!1);case 9:r.next=18;break;case 11:return r.next=13,a.$refs.form.validateForm();case 13:if(!r.sent){r.next=18;break}return r.next=16,a.$refs.form.saveForm({keyValue:a.formEdit?a.formEditRow.f_Id:"",isEdit:a.formEdit});case 16:l=r.sent,l&&(o=a.formEdit?"更新成功!":"新增成功!",a.$message({type:"success",message:a.$t(o)}),a.loadTableData(),a.formVisible=!1);case 18:t();case 19:case"end":return r.stop()}}),r)})))()},handleShowForm:function(e){this.formTitle=e,this.formVisible=!0},handleOpenedForm:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a.formEdit){r.next=10;break}if(e("加载数据中..."),"查看订单详情"!=a.formTitle){r.next=7;break}return r.next=5,a.$refs.detailForm.loadFormData({keyValue:a.formEditRow.f_Id});case 5:r.next=9;break;case 7:return r.next=9,a.$refs.form.loadFormData({keyValue:a.formEditRow.f_Id});case 9:t();case 10:case"end":return r.stop()}}),r)})))()},handleCloseForm:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:"查看订单详情"==e.formTitle?e.$refs.detailForm.resetForm():e.$refs.form.resetForm();case 1:case"end":return t.stop()}}),t)})))()}}},f=c,u=a("2877"),d=Object(u["a"])(f,r,n,!1,null,null,null);t["default"]=d.exports}}]);