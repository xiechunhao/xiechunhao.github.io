(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-codeTable-index","views-dblink-index"],{35363:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page",attrs:{left:208},scopedSlots:e._u([{key:"left",fn:function(){return[a("l-panel",{staticClass:"l-panel-overflow",staticStyle:{"padding-right":"0"},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.$t("数据库"))+" "),a("div",{staticClass:"tree-setting-btn"},[a("el-tooltip",{attrs:{effect:"dark",content:e.$t("数据库管理"),placement:"top"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-setting"},on:{click:e.handleSettingClick}})],1)],1)]},proxy:!0}],null,!1,1541825675)},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticClass:"learun-tree",attrs:{data:e.lr_dblinkTree,"default-expand-all":!0},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,r=t.data;return a("span",{staticClass:"lr-tree-node"},[r.icon?a("i",{class:r.icon}):e._e(),e._v(" "+e._s(e.$t(n.label))+" ")])}}],null,!1,1995507822)})],1)]},proxy:!0}],null,!1,2173349322)},[a("l-panel",{staticStyle:{"padding-left":"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入要查询关键字"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{attrs:{hasAdd:!0},on:{click:function(t){return e.handleAdd()}}},[a("el-button-group",[a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleOpenImport()}}},[e._v(" "+e._s(e.$t("导入表"))+" ")])],1)],1)]},proxy:!0}],null,!1,1878029456)},[a("l-table",{ref:"mainTable",attrs:{"row-key":"f_Id",columns:e.columns,dataSource:e.tableData,loading:e.tableLoading,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage,isExpand:!0},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage,expandChange:e.expandChange},scopedSlots:e._u([{key:"table_expand",fn:function(t){return[a("l-table",{attrs:{isChild:!0,columns:e.childColumns,dataSource:e.chlidrenData[t.row.f_TableName]},scopedSlots:e._u([{key:"f_IsNullable",fn:function(t){return[a("el-switch",{attrs:{size:"mini",activeValue:0,inactiveValue:1,disabled:""},model:{value:t.row.f_IsNullable,callback:function(a){e.$set(t.row,"f_IsNullable",a)},expression:"scope.row.f_IsNullable"}})]}},{key:"f_IsPrimaryKey",fn:function(t){return[a("el-switch",{attrs:{size:"mini",activeValue:1,inactiveValue:0,disabled:""},model:{value:t.row.f_IsPrimaryKey,callback:function(a){e.$set(t.row,"f_IsPrimaryKey",a)},expression:"scope.row.f_IsPrimaryKey"}})]}},{key:"f_IsIdentity",fn:function(t){return[a("el-switch",{attrs:{size:"mini",activeValue:1,inactiveValue:0,disabled:""},model:{value:t.row.f_IsIdentity,callback:function(a){e.$set(t.row,"f_IsIdentity",a)},expression:"scope.row.f_IsIdentity"}})]}}],null,!0)})]}},{key:"f_State",fn:function(t){return[1==t.row.f_State?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(e.$t("同步")))]):a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(e.$t("未同步")))])]}}],null,!1,1895494531)},[a("l-table-btns",{attrs:{btns:e.tableBtns,isFixed:!1},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-dbtable-selectdialog",{attrs:{visible:e.dbTableVisible,dbCode:this.dbCode,isOkClose:!1},on:{"update:visible":function(t){e.dbTableVisible=t},select:e.dbTableSelect}}),a("l-dialog",{ref:"dialogForm",attrs:{title:e.$t(e.formTitle),visible:e.formVisible,height:600,width:1024},on:{"update:visible":function(t){e.formVisible=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm},scopedSlots:e._u([{key:"btns",fn:function(){return[a("el-button-group",{staticStyle:{"margin-right":"8px"}},[a("el-button",{attrs:{plain:"",type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.handleAddRow}},[e._v(e._s(e.$t("添加字段")))]),a("el-button",{attrs:{plain:"",type:"primary",size:"mini",icon:"el-icon-s-unfold"},on:{click:e.handleInsertRow}},[e._v(e._s(e.$t("插入字段")))]),a("el-button",{attrs:{plain:"",type:"primary",size:"mini",icon:"el-icon-minus"},on:{click:e.handleDeleteRows}},[e._v(e._s(e.$t("删除字段")))])],1),a("el-button",{attrs:{size:"mini"},on:{click:e.handleClose}},[e._v(e._s(e.$t("取消")))]),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.handleOk}},[e._v(e._s(e.$t("确定")))])]},proxy:!0}],null,!1,1456793093)},[a("my-form",{ref:"form"})],1),a("l-drawer",{attrs:{title:e.$t("数据库管理"),visible:e.dbManagerVisible,showOk:!1,showClose:!1,size:"800px"},on:{"update:visible":function(t){e.dbManagerVisible=t}}},[a("dblink-index")],1)],1)},r=[],s=(a("a434"),a("96cf"),a("1da1")),i=a("4c62"),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("l-layout",{attrs:{top:108},scopedSlots:e._u([{key:"top",fn:function(){return[a("div",{staticClass:"l-rblock",staticStyle:{padding:"16px 8px 0 8px"}},[a("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini",labelPosition:"right",labelWidth:"56px"}},[a("el-row",{attrs:{gutter:0}},[a("div",{staticClass:"l-rblock"},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("表名"),prop:"f_TableName"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.f_TableName,callback:function(t){e.$set(e.formData,"f_TableName",t)},expression:"formData.f_TableName"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("备注"),prop:"f_Description"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.f_Description,callback:function(t){e.$set(e.formData,"f_Description",t)},expression:"formData.f_Description"}})],1)],1)],1)])],1)],1)]},proxy:!0}])},[a("div",{staticClass:"l-rblock"},[a("l-table",{ref:"lr_db_codecolumns_table",attrs:{rowKey:"f_Id",required:!0,isSortable:!0,border:!1,isShowNum:!1,highlightCurrentRow:!0,isMultiSelect:!0,dataSource:e.lr_db_codecolumns_data,columns:e.lr_db_codecolumns_columns},on:{rowClick:e.handleRowClick},scopedSlots:e._u([{key:"f_DbColumnName",fn:function(t){return[a("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.f_DbColumnName,callback:function(a){e.$set(t.row,"f_DbColumnName",a)},expression:"scope.row.f_DbColumnName"}})]}},{key:"f_CsType",fn:function(t){return[a("el-select",{attrs:{size:"mini"},model:{value:t.row.f_CsType,callback:function(a){e.$set(t.row,"f_CsType",a)},expression:"scope.row.f_CsType"}},e._l(e.lr_dbtype,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)]}},{key:"f_Length",fn:function(t){return[a("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.f_Length,callback:function(a){e.$set(t.row,"f_Length",a)},expression:"scope.row.f_Length"}})]}},{key:"f_DecimalDigits",fn:function(t){return[a("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.f_DecimalDigits,callback:function(a){e.$set(t.row,"f_DecimalDigits",a)},expression:"scope.row.f_DecimalDigits"}})]}},{key:"f_Description",fn:function(t){return[a("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.f_Description,callback:function(a){e.$set(t.row,"f_Description",a)},expression:"scope.row.f_Description"}})]}},{key:"f_IsNullable",fn:function(t){return[a("el-switch",{attrs:{size:"mini",activeValue:0,inactiveValue:1},model:{value:t.row.f_IsNullable,callback:function(a){e.$set(t.row,"f_IsNullable",a)},expression:"scope.row.f_IsNullable"}})]}},{key:"f_IsPrimaryKey",fn:function(t){return[a("el-switch",{attrs:{size:"mini",activeValue:1,inactiveValue:0},model:{value:t.row.f_IsPrimaryKey,callback:function(a){e.$set(t.row,"f_IsPrimaryKey",a)},expression:"scope.row.f_IsPrimaryKey"}})]}},{key:"f_IsIdentity",fn:function(t){return[a("el-switch",{attrs:{size:"mini",activeValue:1,inactiveValue:0},model:{value:t.row.f_IsIdentity,callback:function(a){e.$set(t.row,"f_IsIdentity",a)},expression:"scope.row.f_IsIdentity"}})]}}])},[a("vxe-column",{attrs:{align:"center",width:"40"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("button",{staticClass:"el-button el-button--text el-button--mini",staticStyle:{color:"#f56c6c"},attrs:{type:"button"},on:{click:function(a){return a.stopPropagation(),e.handleDeleteRow(t.$index,t.row)}}},[a("i",{staticClass:"el-icon-delete"})])]}}])})],1)],1)])},o=[],c=(a("99af"),a("4de4"),a("c740"),window.$api.data.codeTable),d={data:function(){return{formData:{f_TableName:"",f_Description:""},rules:{f_TableName:[{required:!0,message:this.$t("请输入表名")},{pattern:/^[A-Za-z][A-Za-z0-9_]*$/,message:this.$t("请以字母开头填写字母、数字或下划线"),trigger:["blur","change"]},{validator:this.validatorPassword,trigger:["blur","change"]}]},lr_db_codecolumns_columns:[{prop:"f_DbColumnName",label:this.$t("名称"),minWidth:120,required:!0},{prop:"f_CsType",label:this.$t("类型"),width:120,required:!0},{prop:"f_Length",label:this.$t("长度"),width:80,patterns:[{msg:this.$t("请填写非负整数或-1"),reg:"/^[1-9]\\d*|0|-1$/"}]},{prop:"f_DecimalDigits",label:this.$t("小数点"),width:64,patterns:[{msg:this.$t("请填写非负整数"),reg:"/^\\d+$/"}]},{prop:"f_IsNullable",label:this.$t("必填"),width:64,align:"center"},{prop:"f_IsPrimaryKey",label:this.$t("主键"),width:64,align:"center"},{prop:"f_IsIdentity",label:this.$t("自增"),width:64,align:"center"},{prop:"f_Description",label:this.$t("备注"),minWidth:120}],lr_db_codecolumns_data:[],selectRow:null}},methods:{validatorPassword:function(e,t,a){"null"==t.toLowerCase()?a(new Error(this.$t("表名输入不合规范"))):a()},handleAddRow:function(){var e={};e.f_Id=this.$uuid(),e.f_DbColumnName="",e.f_CsType="",e.f_Description="",e.f_Length=0,e.f_DecimalDigits=0,e.f_IsNullable=1,e.f_IsPrimaryKey=0,e.f_IsIdentity=0,this.lr_db_codecolumns_data.push(e)},handleInsertRow:function(){var e=this;if(this.selectRow){var t={};t.f_Id=this.$uuid(),t.f_DbColumnName="",t.f_CsType="",t.f_Description="",t.f_Length=0,t.f_DecimalDigits=0,t.f_IsNullable=1,t.f_IsPrimaryKey=0,t.f_IsIdentity=0,this.lr_db_codecolumns_data.splice(this.lr_db_codecolumns_data.findIndex((function(t){return t.f_Id==e.selectRow.f_Id})),0,t)}else this.handleAddRow()},handleDeleteRow:function(e,t){var a=this;this.$confirm("".concat(this.$t("是否删除")).concat(t.f_DbColumnName).concat(this.$t("字段?")),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){a.lr_db_codecolumns_data.splice(e,1),a.$message({type:"success",message:a.$t("删除成功!")})})).catch((function(){a.$message({type:"info",message:a.$t("已取消删除!")})}))},handleDeleteRows:function(){var e=this,t=this.$refs.lr_db_codecolumns_table.getSelected();0!=t.length&&this.$confirm(this.$t("是否删除选中字段?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){var a=e.lr_db_codecolumns_data.filter((function(e){return-1==t.findIndex((function(t){return t.f_Id==e.f_Id}))}));e.lr_db_codecolumns_data=a,e.$message({type:"success",message:e.$t("删除成功!")})})).catch((function(){e.$message({type:"info",message:e.$t("已取消删除!")})}))},resetForm:function(){this.lr_db_codecolumns_data=[],this.formData.f_Id="",this.$refs.lr_db_codecolumns_table.reset(),this.$refs.form.resetFields()},validateForm:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$formValidateWraper(e.$refs.form);case 2:if(t.sent){t.next=4;break}return t.abrupt("return",!1);case 4:if(e.$refs.lr_db_codecolumns_table.validate()){t.next=6;break}return t.abrupt("return",!1);case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}}),t)})))()},setForm:function(e){this.$setFormData(this.formData,e.lr_db_codetableEntity),this.lr_db_codecolumns_data=e.lr_db_codecolumnsList},getForm:function(){var e={lr_db_codetableEntity:{}};return e.lr_db_codetableEntity.f_ClassName=this.formData.f_ClassName,e.lr_db_codetableEntity.f_TableName=this.formData.f_TableName,e.lr_db_codetableEntity.f_Description=this.formData.f_Description,e.lr_db_codecolumnsList=this.lr_db_codecolumns_data,e},loadFormData:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.keyValue,a.next=3,t.$awaitWraper(c.get(n));case 3:if(r=a.sent,!r){a.next=9;break}return t.setForm(r),a.abrupt("return",!0);case 9:return a.abrupt("return",!1);case 10:case"end":return a.stop()}}),a)})))()},saveForm:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e.keyValue,r=e.isEdit,s=e.dbCode,i=t.getForm(),i.lr_db_codetableEntity.f_DbId=s,!r){a.next=9;break}return a.next=6,t.$awaitWraper(c.update(n,i));case 6:return a.abrupt("return",a.sent);case 9:return a.next=11,t.$awaitWraper(c.add(i));case 11:return a.abrupt("return",a.sent);case 12:case"end":return a.stop()}}),a)})))()},handleRowClick:function(e){this.selectRow=e}}},f=d,u=a("2877"),m=Object(u["a"])(f,l,o,!1,null,null,null),p=m.exports,h=window.$api.data.codeTable,b={components:{MyForm:p,DblinkIndex:i["default"]},data:function(){return{lr_isPage:!0,treeLoading:!1,dbManagerVisible:!1,searchWord:"",dbCode:null,dbName:"",dbTableVisible:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1,tableLoading:!1,tableData:[],columns:[{label:"表名",prop:"f_TableName",minWidth:200},{label:"备注",prop:"f_Description",minWidth:200},{label:"状态",prop:"f_State",width:80,align:"center"}],childColumns:[{prop:"f_DbColumnName",label:"名称",minWidth:120},{prop:"f_CsType",label:"类型",width:120},{prop:"f_Length",label:"长度",width:80},{prop:"f_DecimalDigits",label:"小数位",width:64},{prop:"f_IsNullable",label:"必填",width:64,align:"center"},{prop:"f_IsPrimaryKey",label:"主键",width:64,align:"center"},{prop:"f_IsIdentity",label:"自增",width:64,align:"center"},{prop:"f_Description",label:"备注",minWidth:120}],tableBtns:[{prop:"Edit",label:this.$t("编辑"),width:40},{prop:"Update",label:this.$t("同步"),width:40},{prop:"UpdateTable",label:this.$t("更新到表"),width:80},{prop:"Delete",label:this.$t("删除"),width:40}],formTitle:"",formVisible:!1,formEditRow:null,formEdit:!1,chlidrenData:{}}},mounted:function(){this.initDbLink()},methods:{initDbLink:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.treeLoading=!0,t.next=3,e.lr_loadDblink(!1);case 3:e.treeLoading=!1;case 4:case"end":return t.stop()}}),t)})))()},handleNodeClick:function(e){e.children?(this.dbCode="",this.dbName="",this.searchWord="",this.chlidrenData={},this.tableData=[],this.tableTotal=0):this.dbCode!=e.id&&(this.dbCode=e.id,this.dbName=e.label,this.searchWord="",this.chlidrenData={},this.loadTableData())},handleSettingClick:function(){this.dbManagerVisible=!0},hanleSearch:function(){this.loadTableData()},loadTableData:function(e){var t=this;e||(this.tableCurrentPage=1),this.tableLoading=!0;var a={rows:this.tablePageSize,page:this.tableCurrentPage,sidx:"F_TableName DESC",keyWord:this.searchWord,dbCode:this.dbCode};h.getPage(a).then((function(e){var a=t.$deepClone(e.data.data);t.tableData=a.rows,t.tableTotal=a.records,t.tableLoading=!1})).catch((function(){t.tableData=[],t.tableTotal=0,t.tableLoading=!1}))},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},handleOpenImport:function(){this.$validatenull(this.dbCode)?this.$message({type:"warning",message:this.$t("请选择数据库!")}):this.dbTableVisible=!0},dbTableSelect:function(e,t,a){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var s,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t(),0==e.length&&(n.$message({type:"warning",message:n.$t("请选择一条数据!")}),a()),s={tableList:e},r.next=5,n.$awaitWraper(h.importTable(n.dbCode,s));case 5:i=r.sent,i&&(n.$message({type:"success",message:n.$t("导入成功!")}),n.loadTableData(),n.dbTableVisible=!1),a();case 8:case"end":return r.stop()}}),r)})))()},handleAdd:function(){"0"==this.dbCode||null==this.dbCode||""==this.dbCode?this.$message({type:"warning",message:this.$t("请选择数据库!")}):(this.formEdit=!1,this.handleShowForm(this.$t("新增数据对象")))},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.handleShowForm(this.$t("编辑数据对象-".concat(t.f_TableName)))},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a.tableData.splice(e,1),a.tableTotal--,n.next=4,h.remove(t.f_Id);case 4:a.$message({type:"success",message:a.$t("删除成功!")});case 5:case"end":return n.stop()}}),n)})))).catch((function(){a.$message({type:"info",message:a.$t("已取消删除!")})}))},handleClose:function(){this.formVisible=!1},handleShowForm:function(e){this.formTitle=e,this.formVisible=!0},handleOpenedForm:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!a.formEdit){n.next=5;break}return e(a.$t("加载数据中...")),n.next=4,a.$refs.form.loadFormData({keyValue:a.formEditRow.f_Id});case 4:t();case 5:case"end":return n.stop()}}),n)})))()},handleCloseForm:function(){this.$refs.form.resetForm()},handleOk:function(){this.$refs.dialogForm.handleOk()},handleAddRow:function(){this.$refs.form.handleAddRow()},handleInsertRow:function(){this.$refs.form.handleInsertRow()},handleDeleteRows:function(){this.$refs.form.handleDeleteRows()},handleSave:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,s,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e(a.$t("保存数据中...")),n.next=3,a.$refs.form.validateForm();case 3:if(!n.sent){n.next=10;break}return n.next=6,a.$refs.form.saveForm({keyValue:a.formEdit?a.formEditRow.f_Id:"",isEdit:a.formEdit,dbCode:a.dbCode});case 6:r=n.sent,s=a.$refs.form.getForm(),a.chlidrenData[s.lr_db_codetableEntity.f_TableName]&&(a.chlidrenData[s.lr_db_codetableEntity.f_TableName]=s.lr_db_codecolumnsList),r&&(i=a.formEdit?a.$t("更新成功!"):a.$t("新增成功!"),a.$message({type:"success",message:a.$t(i)}),a.loadTableData(),a.formVisible=!1);case 10:t();case 11:case"end":return n.stop()}}),n)})))()},handleUpdateTable:function(e,t){var a=this;this.appConfig.online?this.$message({type:"success",message:this.$t("体验版本无法对数据库新增和修改表!")}):this.$confirm(this.$t("此操作将设置数据更新到数据库, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=a.$loading({target:a.$refs.mainTable?a.$refs.mainTable.$el:"document.body",lock:!0,text:a.$t("同步数据到数据库中..."),spinner:"el-icon-loading"}),e.next=3,a.$awaitWraper(h.createOrUpdateTable(t.f_Id,a.dbCode,a.dbName));case 3:r=e.sent,n.close(),r&&(a.$message({type:"success",message:a.$t("更新成功!")}),a.loadTableData());case 6:case"end":return e.stop()}}),e)})))).catch((function(){a.$message({type:"info",message:a.$t("已取消更新!")})}))},handleUpdate:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=a.$loading({target:a.$refs.mainTable?a.$refs.mainTable.$el:"document.body",lock:!0,text:a.$t("同步表到系统中..."),spinner:"el-icon-loading"}),r={tableList:[{name:t.f_TableName,description:t.f_Description}]},e.next=4,a.$awaitWraper(h.importTable(a.dbCode,r));case 4:s=e.sent,n.close(),s&&(a.$message({type:"success",message:a.$t("更新成功!")}),a.loadTableData());case 7:case"end":return e.stop()}}),e)})))()},expandChange:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e.row,t.chlidrenData[n.f_TableName]){a.next=6;break}return a.next=4,t.$awaitWraper(h.get(n.f_Id));case 4:r=a.sent,t.$set(t.chlidrenData,n.f_TableName,r.lr_db_codecolumnsList);case 6:case"end":return a.stop()}}),a)})))()}}},_=b,g=Object(u["a"])(_,n,r,!1,null,null,null);t["default"]=g.exports},"4c62":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page"},[a("l-panel",{scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入关键字查询"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{attrs:{refreshClick:e.refreshClick},on:{click:function(t){return e.handleAdd()}}},[a("l-excel-btns")],1)]},proxy:!0}],null,!1,1842997105)},[a("l-table",{attrs:{loading:e.tableLoading,columns:e.lr_getPageColumns(e.columns),dataSource:e.tableData,"row-key":"f_Id"}},[a("l-table-btns",{attrs:{filterBtns:e.filterBtns,btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-dialog",{ref:"formDialog",attrs:{title:e.formTitle,visible:e.formVisible,height:576},on:{"update:visible":function(t){e.formVisible=t},opened:e.handleOpenedForm,closed:e.handleCloseForm,ok:e.handleSave},scopedSlots:e._u([{key:"btn",fn:function(){return[a("el-button",{staticStyle:{position:"absolute",left:"0",top:"9px"},attrs:{size:"mini",type:"info",plain:"",loading:e.testLoading},on:{click:e.handleTest}},[e._v(e._s(e.$t("测试连接")))])]},proxy:!0}],null,!1,3840553884)},[a("my-form",{ref:"form",attrs:{activeName:e.activeName},on:{"update:activeName":function(t){e.activeName=t},"update:active-name":function(t){e.activeName=t}}})],1)],1)},r=[],s=(a("4de4"),a("96cf"),a("1da1")),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body learun-el-form-left",staticStyle:{"padding-left":"16px"}},[a("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini",labelPosition:"left","label-width":"80px"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("编码"),prop:"f_DBName"}},[a("el-input",{model:{value:e.formData.f_DBName,callback:function(t){e.$set(e.formData,"f_DBName",t)},expression:"formData.f_DBName"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_DBAlias"}},[a("el-input",{model:{value:e.formData.f_DBAlias,callback:function(t){e.$set(e.formData,"f_DBAlias",t)},expression:"formData.f_DBAlias"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("类型"),prop:"f_DbType"}},[a("l-select",{attrs:{clearable:!1,options:e.options},on:{change:e.handleTypeChange},model:{value:e.formData.f_DbType,callback:function(t){e.$set(e.formData,"f_DbType",t)},expression:"formData.f_DbType"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-tabs",{attrs:{type:"card"},model:{value:e.midActiveName,callback:function(t){e.midActiveName=t},expression:"midActiveName"}},[a("el-tab-pane",{attrs:{label:e.$t("常规"),name:"first"}},["first"==e.midActiveName?[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("主机"),prop:"f_Server"}},[a("el-input",{model:{value:e.formData.f_Server,callback:function(t){e.$set(e.formData,"f_Server",t)},expression:"formData.f_Server"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("端口"),prop:"f_Port"}},[a("el-input",{model:{value:e.formData.f_Port,callback:function(t){e.$set(e.formData,"f_Port",t)},expression:"formData.f_Port"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("用户名"),prop:"f_UserId"}},[a("el-input",{model:{value:e.formData.f_UserId,callback:function(t){e.$set(e.formData,"f_UserId",t)},expression:"formData.f_UserId"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("密码"),prop:"f_Password"}},[a("el-input",{attrs:{type:"password"},model:{value:e.formData.f_Password,callback:function(t){e.$set(e.formData,"f_Password",t)},expression:"formData.f_Password"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("数据库"),prop:"f_DataBase"}},[a("el-input",{model:{value:e.formData.f_DataBase,callback:function(t){e.$set(e.formData,"f_DataBase",t)},expression:"formData.f_DataBase"}})],1)],1)]:e._e()],2),a("el-tab-pane",{attrs:{label:e.$t("高级"),name:"second"}},["first"!=e.midActiveName?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("连接串"),prop:"f_DbConnection"}},[a("el-input",{model:{value:e.formData.f_DbConnection,callback:function(t){e.$set(e.formData,"f_DbConnection",t)},expression:"formData.f_DbConnection"}})],1)],1):e._e()],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("说明"),prop:"f_Description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.formData.f_Description,callback:function(t){e.$set(e.formData,"f_Description",t)},expression:"formData.f_Description"}})],1)],1)],1)],1)},l=[],o=(a("9911f"),{props:{activeName:{type:String,default:function(){return"first"}}},data:function(){var e=this;return{formData:{f_DBName:"",f_DBAlias:"",f_DbType:"MySql",f_DbConnection:"server=localhost;Database=xxx;Uid=root;Pwd=haosql;SslMode=none;",f_Description:"",f_Server:"",f_Port:"3306",f_UserId:"",f_Password:"",f_DataBase:"",f_Type:0},rules:{f_DBName:[{required:!0,message:"请输入编码"},{validator:this.lr_existDbFiled,keyValue:function(){return e.formData.f_Id},tableName:"lr_base_databaselink",keyName:"f_Id",trigger:"null"}],f_DBAlias:[{required:!0,message:"请输入"}],f_DbType:[{required:!0,message:"请选择"}],f_Server:[{required:!0,message:"请输入"}],f_Port:[{required:!0,message:"请输入"}],f_UserId:[{required:!0,message:"请输入"}],f_Password:[{required:!0,message:"请输入"}],f_DataBase:[{required:!0,message:"请输入"}],f_DbConnection:[{required:!0,message:"请输入"}]},options:[{value:"MySql",label:"MySql"},{value:"SqlServer",label:"SqlServer"},{value:"Oracle",label:"Oracle"},{value:"PostgreSQL",label:"PostgreSQL"},{value:"Dameng",label:"达梦"},{value:"Kdbndp",label:"人大金仓"},{value:"HG",label:"瀚高"},{value:"Oscar",label:"神通"},{value:"OpenGauss",label:"华为OpenGauss"},{value:"OceanBase",label:"OceanBase"},{value:"Tidb",label:"Tidb"},{value:"GBase",label:"南大通用GBase"},{value:"TDengine",label:"TDengine"},{value:"ClickHouse",label:"ClickHouse"},{value:"QuestDB",label:"QuestDB"}],link:{MySql:"server=localhost;Database=xxx;Uid=root;Pwd=haosql;SslMode=none;",SqlServer:"server=.;uid=sa;pwd=haosql;database=xxx",Oracle:"Data Source=localhost/orcl;User ID=system;Password=haha;",PostgreSQL:"PORT=5432;DATABASE=xxx;HOST=localhost;PASSWORD=haosql;USER ID=postgres",Dameng:"Server=localhost; User Id=SYSDBA; PWD=SYSDBA;DATABASE=xxx",Kdbndp:"Server=127.0.0.1;Port=54321;UID=SYSTEM;PWD=system;database=xxx",HG:"Server=127.0.0.1;Port=5866;UId=design;Password=000;Database=design;searchpath=design",Oscar:"PORT=2003;DATABASE=osrdb;HOST=localhost;PASSWORD=szoscar55;USER ID=SYSDBA",OpenGauss:"PORT=5432;DATABASE=SqlSugar4xTest;HOST=localhost;PASSWORD=haosql;USER ID=postgres;No Reset On Close=true",OceanBase:"server=localhost;Database=SqlSugar4xTest;Uid=root;Pwd=haosql;",Tidb:"server=localhost;Database=SqlSugar4xTest;Uid=root;Pwd=haosql;",GBase:"Driver={GBase ODBC DRIVER (64-Bit)};Host=localhost;Service=19088;Server=gbase01;Database=testdb;Protocol=onsoctcp;Uid=gbasedbt;Pwd=GBase123;Db_locale=zh_CN.utf8;Client_locale=zh_CN.utf8",TDengine:"Host=localhost;Port=6030;Username=root;Password=taosdata;Database=power",ClickHouse:"Database=SqlSugarTest2;Username=default;Password=;Host=localhost;Port=8123;Compression=False;UseSession=False;Timeout=120;",QuestDB:"host=localhost;port=8812;username=admin;password=quest;database=qdb;ServerCompatibilityMode=NoTypeLoading;"},port:{MySql:"3306",SqlServer:"1433",Oracle:"1521",PostgreSQL:"5432",Dameng:"5236",Kdbndp:"54321",HG:"5866",Oscar:"2003",OpenGauss:"5432",OceanBase:"26257",Tidb:"4000",GBase:"19088",TDengine:"6030",ClickHouse:"8123",QuestDB:"8812"}}},computed:{midActiveName:{get:function(){return this.activeName},set:function(e){this.$emit("update:activeName",e)}}},created:function(){},methods:{resetForm:function(){this.$formClear(this.$refs.form),this.formData.f_Id=""},validateForm:function(e){var t=this;this.$refs.form.validate((function(a){a&&"lrsystemdb"==t.formData.f_DBName&&(t.$message({type:"warning",message:t.$t("编码不可与系统数据库相同!")}),a=!1),e(a)}))},setForm:function(e){var t=this.$deepClone(e);1==t.f_DESEncrypt&&(0==t.f_Type?t.f_Password=this.lr_AESDecrypt(t.f_Password,"learun_db"):t.f_DbConnection=this.lr_AESDecrypt(t.f_DbConnection,"learun_db")),this.formData=t},getForm:function(){var e=this.$deepClone(this.formData);return e.f_DESEncrypt=1,"first"==this.activeName?(e.f_Type=0,e.f_Password=this.lr_AESEncrypt(e.f_Password,"learun_db"),e.f_DbConnection=""):(e.f_Type=1,e.f_DbConnection=this.lr_AESEncrypt(e.f_DbConnection,"learun_db"),e.f_Password=""),e},handleTypeChange:function(){this.formData.f_Port=this.port[this.formData.f_DbType],this.formData.f_DbConnection=this.link[this.formData.f_DbType]}}}),c=o,d=a("2877"),f=Object(d["a"])(c,i,l,!1,null,null,null),u=f.exports,m=window.$api.data.dblink,p={components:{MyForm:u},data:function(){return{lr_isPage:!0,columns:[{label:"名称",prop:"f_DBAlias",minWidth:"150"},{label:"编码",prop:"f_DBName",minWidth:"150"},{label:"类型",prop:"f_DbType",width:"80",align:"center"},{label:"数据库地址",prop:"f_ServerAddress",width:"200"}],tableBtns:[{prop:"Edit",label:"编辑",width:40},{prop:"Delete",label:"删除",width:40}],tableLoading:!1,searchWord:"",searchTableData:null,formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1,testLoading:!1,activeName:"first"}},mounted:function(){this.init()},computed:{tableData:function(){return this.searchTableData||this.lr_dblinkList}},methods:{refreshClick:function(){this.searchWord="",this.init()},init:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableLoading=!0,t.next=3,e.lr_loadDblink(!1);case 3:e.tableLoading=!1;case 4:case"end":return t.stop()}}),t)})))()},hanleSearch:function(){var e=this;this.searchWord?this.searchTableData=this.lr_dblinkList.filter((function(t){return t.f_DBAlias.indexOf(e.searchWord)>-1||t.f_DBName.indexOf(e.searchWord)>-1||t.f_ServerAddress&&t.f_ServerAddress.indexOf(e.searchWord)>-1})):this.searchTableData=null},handleAdd:function(){this.$refs.form&&this.$refs.form.resetForm(),this.activeName="first",this.formEdit=!1,this.showForm("新增")},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.activeName=0==t.f_Type?"first":"second",this.showForm("编辑【".concat(t.f_DBName,"】"))},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){m.remove(t.f_Id).then((function(){a.$message({type:"success",message:a.$t("删除成功!")}),a.init()}))})).catch((function(){a.$message({type:"info",message:a.$t("已取消删除")})}))},handleSave:function(e,t){var a=this;e(),console.log("test handleSave"),this.$refs.form.validateForm((function(e){if(e){var n=a.$refs.form.getForm();console.log("test handleSave1"),a.formEdit?m.update(n.f_Id,a.$deepClone(n)).then((function(){t(),a.formVisible=!1,a.$message({type:"success",message:a.$t("更新成功!")}),a.init()})).catch((function(){t()})):m.add(a.$deepClone(n)).then((function(){t(),a.formVisible=!1,a.$message({type:"success",message:a.$t("添加成功!")}),a.init()})).catch((function(){t()}))}else t()}))},handleOpenedForm:function(){this.formEdit&&this.$refs.form.setForm(this.formEditRow)},handleCloseForm:function(){this.$refs.form.resetForm()},showForm:function(e){this.formTitle=e,this.formVisible=!0},filterBtns:function(e,t){return"lrsystemdb"!=e.f_DBName&&0!=e.f_IsEdit?t:[]},handleTest:function(){var e=this,t=this.$refs.form.getForm();(0==t.f_Type||t.f_DbConnection)&&(0!=t.f_Type||t.f_Server&&t.f_Port&&t.f_UserId&&t.f_Password)?(this.testLoading=!0,m.test(t).then((function(t){t.data.data?e.$message({type:"success",message:e.$t("测试成功!")}):e.$message({type:"error",message:t.data.info}),e.testLoading=!1})).catch((function(){e.testLoading=!1}))):this.$message({type:"error",message:this.$t("请将数据库信息补充完整!")})}}},h=p,b=Object(d["a"])(h,n,r,!1,null,null,null);t["default"]=b.exports},"857a":function(e,t,a){var n=a("1d80"),r=a("577e"),s=/"/g;e.exports=function(e,t,a,i){var l=r(n(e)),o="<"+t;return""!==a&&(o+=" "+a+'="'+r(i).replace(s,"&quot;")+'"'),o+">"+l+"</"+t+">"}},"9911f":function(e,t,a){"use strict";var n=a("23e7"),r=a("857a"),s=a("af03");n({target:"String",proto:!0,forced:s("link")},{link:function(e){return r(this,"a","href",e)}})},af03:function(e,t,a){var n=a("d039");e.exports=function(e){return n((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}}}]);