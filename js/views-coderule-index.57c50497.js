(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-coderule-index"],{fea6:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page"},[a("l-panel",{scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入编码/名称"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.keyWord,callback:function(t){e.keyWord=t},expression:"keyWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{on:{click:function(t){return e.handleAdd()}}},[a("l-excel-btns")],1)]},proxy:!0}],null,!1,1701280842)},[a("l-table",{attrs:{loading:e.tableLoading,columns:e.lr_getPageColumns(e.columns),dataSource:e.tableData,"row-key":"f_RuleId",isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_CreateDate",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_CreateDate))+" ")]}}],null,!1,300722241)},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-drawer",{attrs:{title:e.formTitle,visible:e.formVisible},on:{"update:visible":function(t){e.formVisible=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[a("my-form",{ref:"form"})],1)],1)},o=[],r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body"},[a("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"80px"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("编码"),prop:"f_EnCode"}},[a("el-input",{model:{value:e.formData.f_EnCode,callback:function(t){e.$set(e.formData,"f_EnCode",t)},expression:"formData.f_EnCode"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_FullName"}},[a("el-input",{model:{value:e.formData.f_FullName,callback:function(t){e.$set(e.formData,"f_FullName",t)},expression:"formData.f_FullName"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("说明"),prop:"f_Description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.formData.f_Description,callback:function(t){e.$set(e.formData,"f_Description",t)},expression:"formData.f_Description"}})],1)],1),a("el-col",{staticStyle:{"padding-left":"24px"},attrs:{span:24}},[a("l-edit-table",{attrs:{addBtnText:e.$t("添加规则"),dataSource:e.ruleFormat},on:{addRow:e.handleAdd,deleteRow:e.handleDelete}},[a("el-table-column",{attrs:{prop:"itemType",label:e.$t("前缀"),minWidth:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("l-select",{attrs:{placeholder:"请选择",size:"mini",options:e.options},on:{change:function(a){return e.handleChange(t.row)}},model:{value:t.row.itemType,callback:function(a){e.$set(t.row,"itemType",a)},expression:"scope.row.itemType"}})]}}])}),a("el-table-column",{attrs:{prop:"formatStr",label:e.$t("格式"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.itemType?a("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.formatStr,callback:function(a){e.$set(t.row,"formatStr",a)},expression:"scope.row.formatStr"}}):"1"==t.row.itemType?a("l-select",{attrs:{placeholder:"请选择",size:"mini",options:e.optionsDate},model:{value:t.row.formatStr,callback:function(a){e.$set(t.row,"formatStr",a)},expression:"scope.row.formatStr"}}):"2"==t.row.itemType?a("l-select",{attrs:{placeholder:"请选择",size:"mini",options:e.optionsNumber},model:{value:t.row.formatStr,callback:function(a){e.$set(t.row,"formatStr",a)},expression:"scope.row.formatStr"}}):"3"==t.row.itemType?a("l-select",{attrs:{placeholder:"请选择",size:"mini",options:e.optionsCompany},model:{value:t.row.formatStr,callback:function(a){e.$set(t.row,"formatStr",a)},expression:"scope.row.formatStr"}}):"4"==t.row.itemType?a("l-select",{attrs:{placeholder:"请选择",size:"mini",options:e.optionsDepartment},model:{value:t.row.formatStr,callback:function(a){e.$set(t.row,"formatStr",a)},expression:"scope.row.formatStr"}}):"5"==t.row.itemType?a("l-select",{attrs:{placeholder:"请选择",size:"mini",options:e.optionsUser},model:{value:t.row.formatStr,callback:function(a){e.$set(t.row,"formatStr",a)},expression:"scope.row.formatStr"}}):e._e()]}}])}),a("el-table-column",{attrs:{prop:"stepValue",label:e.$t("步长"),width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return"2"==t.row.itemType?[a("el-input-number",{attrs:{placeholder:e.$t("请输入"),size:"mini",min:1},model:{value:t.row.stepValue,callback:function(a){e.$set(t.row,"stepValue",a)},expression:"scope.row.stepValue"}})]:void 0}}],null,!0)}),a("el-table-column",{attrs:{prop:"initValue",label:e.$t("初始值"),width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return"2"==t.row.itemType?[a("el-input-number",{attrs:{placeholder:e.$t("请输入"),size:"mini",min:0},model:{value:t.row.initValue,callback:function(a){e.$set(t.row,"initValue",a)},expression:"scope.row.initValue"}})]:void 0}}],null,!0)})],1)],1)],1)],1)},n=[],i=(a("7db0"),a("a434"),{name:"coderule-form",props:{},data:function(){return{formData:{f_FullName:"",f_EnCode:"",f_Description:""},rules:{f_FullName:[{required:!0,message:this.$t("请输入编码")}],f_EnCode:[{required:!0,message:this.$t("请输入名称")}]},ruleFormat:[],options:[{value:"0",label:this.$t("自定义")},{value:"1",label:this.$t("日期")},{value:"2",label:this.$t("流水号")},{value:"3",label:this.$t("公司")},{value:"4",label:this.$t("部门")},{value:"5",label:this.$t("用户")}],optionsDate:[{value:"mmdd",label:"mmdd"},{value:"ddmm",label:"ddmm"},{value:"mmyy",label:"mmyy"},{value:"yymm",label:"yymm"},{value:"yyyy",label:"yyyy"},{value:"yy",label:"yy"},{value:"yyyymm",label:"yyyymm"},{value:"yymmdd",label:"yymmdd"},{value:"yyyymmdd",label:"yyyymmdd"}],optionsNumber:[{value:"000",label:"000"},{value:"0000",label:"0000"},{value:"00000",label:"00000"},{value:"000000",label:"000000"}],optionsCompany:[{value:"code",label:this.$t("公司编号")},{value:"name",label:this.$t("公司名称")}],optionsDepartment:[{value:"code",label:this.$t("部门编号")},{value:"name",label:this.$t("部门名称")}],optionsUser:[{value:"code",label:this.$t("用户编号")},{value:"name",label:this.$t("用户名称")}]}},computed:{},created:function(){},methods:{resetForm:function(){this.formData.F_RuleId="",this.ruleFormat=[],this.$refs.form&&this.$refs.form.resetFields()},validateForm:function(e){var t=this;this.$refs.form.validate((function(a){if(a)if(t.ruleFormat.length>0){var l=t.ruleFormat.find((function(e){return""==e.itemType||""==e.formatStr}));l?t.$message({type:"warning",message:t.$t("请完善规则信息!")}):e()}else t.$message({type:"warning",message:t.$t("请设置规则!")})}))},setForm:function(e){this.formData=this.$deepClone(e),this.formData.f_RuleFormatJson&&(this.ruleFormat=JSON.parse(this.formData.f_RuleFormatJson))},getForm:function(){var e=this.$deepClone(this.formData);return e.f_RuleFormatJson=JSON.stringify(this.ruleFormat),e},handleAdd:function(){this.ruleFormat.push({itemType:"",formatStr:"",stepValue:1,initValue:0})},handleDelete:function(e){this.ruleFormat.splice(e.index,1)},handleChange:function(e){e.formatStr=""}}}),s=i,m=a("2877"),u=Object(m["a"])(s,r,n,!1,null,null,null),d=u.exports,c=window.$api.data.coderule,f={components:{MyForm:d},data:function(){return{lr_isPage:!0,columns:[{label:"编码",prop:"f_EnCode",width:"164"},{label:"名称",prop:"f_FullName",minWidth:"160"},{label:"当前流水号",prop:"f_CurrentNumber",width:"184"},{label:"创建人",prop:"f_CreateUserName",width:"100",align:"center"},{label:"创建时间",prop:"f_CreateDate",width:"160"}],tableBtns:[{prop:"Edit",label:"编辑",width:40},{prop:"Delete",label:"删除",width:40}],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1,tableData:[],keyWord:"",formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1}},computed:{},mounted:function(){this.loadTablePageData()},methods:{loadTablePageData:function(e){var t=this;e||(this.tableCurrentPage=1),this.tableLoading=!0;var a={rows:this.tablePageSize,page:this.tableCurrentPage,sidx:"F_CreateDate",keyword:this.keyWord};c.getPage(a).then((function(e){var a=t.$deepClone(e.data.data);t.tableData=a.rows,t.tableTotal=a.records,t.tableLoading=!1})).catch((function(){t.tableData=[],t.tableLoading=!1}))},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTablePageData(!0)},hanleSearch:function(){this.loadTablePageData()},handleAdd:function(){this.formEdit=!1,this.showForm("新增单据编码")},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.showForm("编辑单据编码")},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){c.remove(t.f_RuleId).then((function(){a.$message({type:"success",message:"删除成功!"}),a.loadTablePageData(),a.lr_loadCodeList(!1)}))})).catch((function(){a.$message({type:"info",message:"已取消删除"})}))},handleSave:function(e,t){var a=this;this.$refs.form.validateForm((function(){e();var l=a.$refs.form.getForm();a.formEdit?c.update(l.f_RuleId,a.$deepClone(l)).then((function(){t(),a.formVisible=!1,a.$message({type:"success",message:"更新成功!"}),a.loadTablePageData(),a.lr_loadCodeList(!1)})).catch((function(){t()})):c.add(a.$deepClone(l)).then((function(){t(),a.formVisible=!1,a.$message({type:"success",message:"添加成功!"}),a.loadTablePageData(),a.lr_loadCodeList(!1)})).catch((function(){t()}))}))},handleOpenedForm:function(){this.formEdit&&this.$refs.form.setForm(this.formEditRow)},handleCloseForm:function(){this.$refs.form.resetForm()},showForm:function(e){this.formTitle=e,this.formVisible=!0}}},p=f,h=Object(m["a"])(p,l,o,!1,null,null,null);t["default"]=h.exports}}]);