(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-msg-index"],{"9edc":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page"},[a("l-panel",{scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("l-query2",{attrs:{labelWidth:0,popoverWidth:240,items:e.queryItems,formData:e.queryData,loading:e.tableLoading},on:{search:e.handleSearch},scopedSlots:e._u([{key:"isDelete",fn:function(){return[a("el-radio-group",{attrs:{size:"mini"},on:{change:e.handleSearch},model:{value:e.queryData.isDelete,callback:function(t){e.$set(e.queryData,"isDelete",t)},expression:"queryData.isDelete"}},[a("el-radio-button",{attrs:{label:"0"}},[e._v(e._s(e.$t("站内消息")))]),a("el-radio-button",{attrs:{label:"1"}},[e._v(e._s(e.$t("回收站")))])],1)]},proxy:!0},{key:"keyword",fn:function(){return[a("el-input",{attrs:{placeholder:e.$t("请输入查询关键字")},model:{value:e.queryData.keyword,callback:function(t){e.$set(e.queryData,"keyword",t)},expression:"queryData.keyword"}})]},proxy:!0}],null,!1,921818781)})]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{attrs:{hasAdd:!1}},[a("el-button-group",[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.handleDelete()}}},[e._v(e._s(e.deleteBtnText))])],1),a("l-excel-btns")],1)]},proxy:!0}],null,!1,636819024)},[a("l-table",{ref:"mainTable",attrs:{rowKey:"f_MsgId",loading:e.tableLoading,columns:e.columns,dataSource:e.tableData,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage,isMultiSelect:""},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_Content",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return e.handleLook(t.row)}}},[e._v(e._s(t.row.f_Content))])]}},{key:"f_IsRead",fn:function(t){return[1==t.row.f_IsRead?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(e.$t("已读")))]):a("el-tag",{attrs:{size:"mini",type:"warning "}},[e._v(e._s(e.$t("未读")))])]}},{key:"f_CreateDate",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_CreateDate))+" ")]}},{key:"f_SendUserId",fn:function(t){return[e._v(" "+e._s(e.getName(t.row.f_SendUserId))+" ")]}}],null,!1,2954214067)})],1),e.sysMessagereadly?a(e.sysMessageComponent,{ref:"messageBox",tag:"component"}):e._e()],1)},s=[],r=(a("99af"),a("7db0"),a("d81d"),a("96cf"),a("1da1")),o=window.$api.message.msg,i=window.$api.message.user,l={data:function(){return{lr_isPage:!0,queryItems:[{prop:"isDelete",span:24},{prop:"keyword",span:24}],queryData:{isDelete:"0",keyword:""},tableLoading:!1,tableData:[],tableTotal:0,tableCurrentPage:1,tablePageSize:50,columns:[{label:"内容",prop:"f_Content",minWidth:120,align:"left"},{label:"消息类型",prop:"f_SendUserId",width:120,align:"left"},{label:"状态",prop:"f_IsRead",width:64,align:"center"},{label:"时间",prop:"f_CreateDate",width:160,align:"left"}],sysUserList:[],sysMessagereadly:!1,sysMessageComponent:""}},computed:{deleteBtnText:function(){return"0"==this.queryData.isDelete?this.$t("删除"):this.$t("彻底删除")}},mounted:function(){this.init()},methods:{init:function(){this.loadSysUsers(),this.loadTableData()},loadSysUsers:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$awaitWraper(i.getList());case 2:e.sysUserList=t.sent;case 3:case"end":return t.stop()}}),t)})))()},getName:function(e){var t=this.sysUserList.find((function(t){return t.f_Code==e}));return t?t.f_Name:""},handleSearch:function(){this.loadTableData()},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},loadTableData:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e||(t.tableCurrentPage=1),t.tableLoading=!0,n=t.$deepClone(t.queryData),n.rows=t.tablePageSize,n.page=t.tableCurrentPage,n.sidx="F_IsRead,F_CreateDate DESC",a.next=8,t.$awaitWraper(o.getSysPage(n));case 8:s=a.sent,null!=s?(t.tableData=s.rows,t.tableTotal=s.records):t.tableData=[],t.tableLoading=!1;case 11:case"end":return a.stop()}}),a)})))()},handleLook:function(e){this.sysMessagereadly=!1;var t=this.sysUserList.find((function(t){return t.f_Code==e.f_SendUserId}));t&&t.f_Url&&(this.sysMessageComponent=t.f_Url,this.sysMessagereadly=!0,this.openMessageBox(e,0)),e.f_IsRead=1;var a=window.$api.message.msg;a.read(e.f_MsgId)},openMessageBox:function(e,t){var a=this;this.$refs.messageBox?this.$nextTick(Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a.$refs.messageBox.open(e);case 1:case"end":return t.stop()}}),t)})))):t<100&&setTimeout(Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t++,a.openMessageBox(e,t);case 2:case"end":return n.stop()}}),n)}))),100)},handleDelete:function(){var e=this,t=this.$refs.mainTable.getSelected();if(0!=t.length){var a=String(t.map((function(e){return e.f_MsgId})));this.$confirm("".concat(this.$t("是否")).concat(this.deleteBtnText).concat(this.$t("数据"),"?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){"0"==e.queryData.isDelete?o.virtualDelete({ids:a}).then((function(){e.$refs.mainTable.reset(),e.$message({type:"success",message:"".concat(e.deleteBtnText).concat(e.$t("成功"),"!")}),e.loadTableData(!0)})):o.thoroughDelete({ids:a}).then((function(){e.$refs.mainTable.reset(),e.$message({type:"success",message:"".concat(e.deleteBtnText).concat(e.$t("成功"),"!")}),e.loadTableData(!0)}))})).catch((function(){e.$message({type:"info",message:"".concat(e.$t("已取消")).concat(e.deleteBtnText)})}))}else this.$message({type:"warning",message:this.$t("请选择数据！")})}}},u=l,c=a("2877"),d=Object(c["a"])(u,n,s,!1,null,null,null);t["default"]=d.exports}}]);