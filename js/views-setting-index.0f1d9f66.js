(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-setting-index"],{"1d29":function(e,t,n){},"7bf6":function(e,t,n){"use strict";n("1d29")},"7dc4":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("l-layout",{staticClass:"l-tab-page l-desktop-setting-index"},[n("l-panel",{scopedSlots:e._u([{key:"toolLeft",fn:function(){return[n("div",{staticClass:"l-panel--item"},[n("el-input",{attrs:{placeholder:e.$t("请输入名称"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[n("l-tool-btns",{attrs:{btnText:"新增配置"},on:{click:function(t){return e.handleAdd()}}},[n("el-button-group",[n("l-file-import",{attrs:{fileType:"json",classname:"SettingImport"},on:{success:function(t){return e.exportSuccess()}}})],1)],1)]},proxy:!0}])},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"l-rblock",staticStyle:{"padding-bottom":"48px","background-color":"#f5f5f5"}},[n("div",{staticClass:"l-rblock l-overflow-y"},[e._l(e.tableData,(function(t){return n("div",{directives:[{name:"show",rawName:"v-show",value:e.tableData.length>0,expression:"tableData.length > 0"}],key:t.f_Id,staticClass:"l-v-item"},[n("el-image",{attrs:{src:e.apiUrl+"system/annexesfile/"+t.f_SchemeId+"?token="+e.token}}),n("div",{staticClass:"content__btn",on:{click:function(n){return e.handleDesign(t)}}},[e._v(e._s(e.$t("设计")))]),n("div",{staticStyle:{position:"absolute",top:"8px",right:"8px"}},[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(n){return e.handleEnableChange(t)}},model:{value:t.f_EnabledMark,callback:function(n){e.$set(t,"f_EnabledMark",n)},expression:"item.f_EnabledMark"}})],1),n("div",{staticClass:"content__main"},[n("span",{staticClass:"content__name"},[e._v(e._s(t.f_Name))]),n("div",{staticClass:"content__menulist"},[n("div",{staticClass:"content__view"},[n("el-tooltip",{attrs:{content:e.$t("删除")}},[n("i",{staticClass:"el-icon-delete",on:{click:function(n){return e.handleDelete(t)}}})]),n("el-tooltip",{attrs:{content:e.$t("预览")}},[n("i",{staticClass:"el-icon-view",on:{click:function(n){return e.handleViews(t)}}})]),n("el-tooltip",{attrs:{content:e.$t("复制")}},[n("i",{staticClass:"el-icon-copy-document",on:{click:function(n){return e.handleCopy(t)}}})]),n("el-tooltip",{attrs:{content:e.$t("导出")}},[n("i",{staticClass:"learun-icon-vertical-bottom",on:{click:function(n){return e.handleExport(t)}}})]),n("el-tooltip",{attrs:{content:e.$t("历史")}},[n("i",{staticClass:"el-icon-time",on:{click:function(n){return e.handleHistory(t)}}})])],1)])])],1)})),n("el-empty",{directives:[{name:"show",rawName:"v-show",value:0==e.tableData.length,expression:"tableData.length == 0"}],attrs:{description:e.$t("暂无数据")}})],2),n("div",{staticClass:"l-table--pagination",staticStyle:{border:"0"}},[n("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper",background:"","page-sizes":[10,20,30,50],"page-size":e.tablePageSize,"current-page":e.tableCurrentPage,total:e.tableTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.tableCurrentPage=t},"update:current-page":function(t){e.tableCurrentPage=t}}})],1)])]),n("l-fullscreen-dialog",{attrs:{title:e.$t(e.formTitle),headerMidWidth:320,visible:e.formVisible,isStep:!0,steps:["基本配置","桌面设计"],stepActive:e.stepActive,validateSteps:e.handleValidateSteps},on:{"update:visible":function(t){e.formVisible=t},"update:stepActive":function(t){e.stepActive=t},"update:step-active":function(t){e.stepActive=t},ok:e.handleSave,closed:e.handleCloseForm,opened:e.handleOpenedForm},scopedSlots:e._u([{key:"headerRight",fn:function(){return[n("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.handleSave(!0)}}},[e._v(e._s(e.$t("暂存")))])]},proxy:!0}])},[n("my-form",{ref:"form",attrs:{stepActive:e.stepActive}})],1),n("l-fullscreen-dialog",{attrs:{title:e.$t("预览"),visible:e.preveiwVisible,showOk:!1},on:{"update:visible":function(t){e.preveiwVisible=t},closed:e.handleClosePreviewForm,opened:e.handleOpenedPreviewForm}},[n("preview-form",{ref:"previewForm"})],1),n("l-drawer",{attrs:{title:e.$t("历史记录")+"-"+e.$t(e.historyTitle),visible:e.historyVisible,showOk:!1,showClose:!1,size:"640px"},on:{"update:visible":function(t){e.historyVisible=t},opened:e.HistoryOpened}},[n("history",{ref:"HistoryForm",attrs:{schemeInfoId:e.schemeInfoId,schemeId:e.schemeId,updateSchemeId:e.updateSchemeId}})],1)],1)},i=[],r=(n("99af"),n("96cf"),n("1da1")),o=n("5e02"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("l-quick-bi-viewer",{ref:"quickViewer",attrs:{isPreview:!0}})},l=[],c={mounted:function(){},methods:{resetForm:function(){this.$refs.quickViewer.reset()},setForm:function(e){this.$refs.quickViewer.set(e)}}},d=c,u=n("2877"),f=Object(u["a"])(d,s,l,!1,null,null,null),p=f.exports,h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("l-layout",{staticClass:"l-tab-page"},[n("l-panel",{staticStyle:{padding:"0"},scopedSlots:e._u([{key:"toolRight",fn:function(){return[n("el-button-group",[n("el-button",{attrs:{size:"mini",icon:"el-icon-refresh-left"},on:{click:e.handleRefresh}})],1)]},proxy:!0}])},[n("div",{staticClass:"l-rblock"},[n("l-table",{attrs:{loading:e.tableLoading,columns:e.columns,dataSource:e.tableData,"row-key":"f_Id",isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_CreateTime",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_CreateTime))+" ")]}},{key:"f_IsVerison",fn:function(t){return[n("el-switch",{attrs:{disabled:t.row.f_IsVerison},on:{change:function(n){return e.handleEnableChange(t.row)}},model:{value:t.row.f_IsVerison,callback:function(n){e.$set(t.row,"f_IsVerison",n)},expression:"scope.row.f_IsVerison"}})]}}])},[n("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1)]),n("l-fullscreen-dialog",{attrs:{title:e.$t("预览")+"-"+e.previewTitle,visible:e.previewVisible,showOk:!1},on:{"update:visible":function(t){e.previewVisible=t},closed:e.handlePreviewClosed,opened:e.handlePreviewOpened}},[n("preview-form",{ref:"previewForm"})],1)],1)},m=[],b=(n("d81d"),n("159b"),n("5530")),g=window.$api.desktop.setting,v={components:{PreviewForm:p},props:{schemeInfoId:String,schemeId:String,updateSchemeId:Function},data:function(){return{noAuth:!0,columns:[{label:"创建人",prop:"f_CreateUserId",minWidth:"160",dataType:"user"},{label:"创建时间",prop:"f_CreateTime",minWidth:"160"},{label:"当前版本",prop:"f_IsVerison",width:"80",align:"center"}],tableBtns:[{prop:"Preview",label:"预览"}],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1,tableData:[],previewVisible:!1,previewTitle:"",formEditRow:null}},computed:{},methods:{handleRefresh:function(){this.loadTablePageData()},loadTablePageData:function(e){var t=this;e||(this.tableCurrentPage=1),this.tableLoading=!0;var n={rows:this.tablePageSize,page:this.tableCurrentPage,sidx:"F_CreateTime DESC"};g.getHistoryPage(this.schemeInfoId,n).then((function(e){var n=t.$deepClone(e.data.data);t.tableData=n.rows.map((function(e){return Object(b["a"])(Object(b["a"])({},e),{},{f_IsVerison:e.f_Id==t.schemeId})})),t.tableTotal=n.records,t.tableLoading=!1})).catch((function(){t.tableData=[],t.tableLoading=!1}))},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTablePageData(!0)},handleEnableChange:function(e){var t=this;this.updateSchemeId(e.f_Id),this.tableData.forEach((function(t){t.f_Id!=e.f_Id&&(t.f_IsVerison=!1)})),this.$nextTick((function(){g.updateHistory(t.schemeInfoId,e.f_Id).then((function(){t.$message({type:"success",message:t.$t("更新成功!")})}))}))},handlePreview:function(e,t){this.formEditRow=t,this.previewTitle=this.lr_dateFormat(t.f_CreateTime),this.previewVisible=!0},handlePreviewOpened:function(e,t){var n=this;e("加载数据中..."),this.$nextTick(Object(r["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.$awaitWraper(g.getHistory(n.formEditRow.f_Id));case 2:a=e.sent,n.$refs.previewForm.setForm(JSON.parse(a.f_Content)),t();case 5:case"end":return e.stop()}}),e)}))))},handlePreviewClosed:function(){var e=this;this.$nextTick((function(){e.$refs.previewForm.resetForm()}))}}},w=v,_=Object(u["a"])(w,h,m,!1,null,null,null),k=_.exports,y=window.$api.desktop.setting,C={inject:["admin"],components:{MyForm:o["a"],PreviewForm:p,History:k},props:{},data:function(){return{searchWord:"",searchTableData:null,tableLoading:!1,tableData:[],tableTotal:0,tablePageSize:10,tableCurrentPage:1,stepActive:0,stepPrevBtn:!0,stepNextBtn:!1,stepSaveBtn:!0,formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1,formCopy:!1,preveiwVisible:!1,historyVisible:!1,historyTitle:"",schemeInfoId:"",schemeId:""}},created:function(){},mounted:function(){this.loadTablePageData()},computed:{},methods:{updateModules:function(){this.$store.dispatch("system/module/getList")},handleCurrentChange:function(e){this.tableCurrentPage=e,this.loadTablePageData(!0)},handleSizeChange:function(e){this.tablePageSize=e,this.loadTablePageData()},loadTablePageData:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.tableLoading=!0,e||(t.tableCurrentPage=1),a={rows:t.tablePageSize,page:t.tableCurrentPage,sidx:"F_CreateTime DESC",f_Name:t.searchWord,f_Type:1},n.next=5,t.$awaitWraper(y.getPage(a));case 5:i=n.sent,t.tableData=i.rows,t.tableTotal=i.records,t.tableLoading=!1;case 9:case"end":return n.stop()}}),n)})))()},hanleSearch:function(){this.loadTablePageData()},handleEnableChange:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,y.updateState(e.f_Id,e.f_EnabledMark);case 2:t.$message({type:"success",message:t.$t("更新成功!")}),t.updateModules();case 4:case"end":return n.stop()}}),n)})))()},handleDesign:function(e){this.formEdit=!0,this.formCopy=!1,this.formEditRow=e,this.showForm("编辑桌面")},handleAdd:function(){this.formEdit=!1,this.formCopy=!1,this.showForm("新建桌面")},handleDelete:function(e){var t=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){y.remove(e.f_Id).then((function(){t.$message({type:"success",message:t.$t("删除成功!")}),t.loadTablePageData(),t.updateModules()}))})).catch((function(){t.$message({type:"info",message:t.$t("已取消删除")})}))},handleCopy:function(e){this.formEdit=!1,this.formCopy=!0,this.formEditRow=e,this.showForm("新建桌面")},handleViews:function(e){this.formEditRow=e,this.preveiwVisible=!0},handleHistory:function(e){this.formEditRow=e,this.historyTitle=e.f_Name,this.schemeId=e.f_SchemeId,this.schemeInfoId=e.f_Id,this.historyVisible=!0},showForm:function(e){this.formTitle=e,this.formVisible=!0},handleSave:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=t.$loading({lock:!0,text:"正在保存配置，请稍后",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.2)"}),t.$nextTick(Object(r["a"])(regeneratorRuntime.mark((function n(){var i,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$refs.form.getForm();case 2:if(i=n.sent,r=null,!t.formEdit){n.next=10;break}return n.next=7,t.$awaitWraper(y.update(t.formEditRow.f_Id,i));case 7:r=n.sent,n.next=13;break;case 10:return n.next=12,t.$awaitWraper(y.add(i));case 12:r=n.sent;case 13:r&&(t.$message({type:"success",message:t.formEdit?t.$t("编辑成功!"):t.$t("新增成功!")}),1!=e&&(t.formVisible=!1,t.loadTablePageData(),t.updateModules())),a.close();case 15:case"end":return n.stop()}}),n)}))));case 2:case"end":return n.stop()}}),n)})))()},handleOpenedForm:function(e,t){var n=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!n.formEdit&&!n.formCopy){a.next=8;break}return e("加载数据中..."),a.next=4,n.$awaitWraper(y.get(n.formEditRow.f_Id));case 4:i=a.sent,n.formCopy&&(i.lr_desktop_infoEntity.f_Id="",i.lr_desktop_infoEntity.f_ModuleId="",i.lr_desktop_infoEntity.f_Code="".concat(i.lr_desktop_infoEntity.f_Code,"-copy"),i.lr_desktop_infoEntity.f_Name="".concat(i.lr_desktop_infoEntity.f_Name,"-复制")),n.$refs.form.setForm(i),t();case 8:case"end":return a.stop()}}),a)})))()},handleCloseForm:function(){this.$refs.form.resetForm()},handleValidateSteps:function(){return this.$refs.form.validateSteps()},handleOpenedPreviewForm:function(e,t){var n=this;e("加载数据中..."),this.$nextTick(Object(r["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.$awaitWraper(y.get(n.formEditRow.f_Id));case 2:a=e.sent,n.$refs.previewForm.setForm(JSON.parse(a.lr_desktop_schemeEntity.f_Content)),t();case 5:case"end":return e.stop()}}),e)}))))},handleClosePreviewForm:function(){this.$refs.previewForm.resetForm()},HistoryOpened:function(){this.$refs.HistoryForm.loadTablePageData()},updateSchemeId:function(e){this.schemeId=e,this.formEditRow.f_SchemeId=e},handleExport:function(e){this.lr_downTempFile("desktop/setting/download/desktop/".concat(e.f_Id),"桌面_".concat(e.f_Name).concat(e.f_Code),"desktop","json")},exportSuccess:function(){this.loadTablePageData()}}},$=C,x=(n("7bf6"),Object(u["a"])($,a,i,!1,null,null,null));t["default"]=x.exports}}]);