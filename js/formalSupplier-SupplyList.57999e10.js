(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["formalSupplier-SupplyList","formalSupplier-supplyListForm"],{a275:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("l-layout",{staticClass:"l-tab-page"},[a("l-panel",{scopedSlots:e._u([{key:"toolLeft",fn:function(){return[e.queryOpen?a("l-query2",{attrs:{items:e.queryItems,formData:e.queryData,loading:e.tableLoading},on:{search:e.handleSearch},scopedSlots:e._u([{key:"f_CreateDate",fn:function(){return[a("el-date-picker",{attrs:{type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.queryData.f_CreateDate,callback:function(t){e.$set(e.queryData,"f_CreateDate",t)},expression:"queryData.f_CreateDate"}})]},proxy:!0},{key:"f_State",fn:function(){return[a("l-select",{attrs:{options:e.erp_case_f_StateOptions},model:{value:e.queryData.f_State,callback:function(t){e.$set(e.queryData,"f_State",t)},expression:"queryData.f_State"}})]},proxy:!0},{key:"f_Name",fn:function(){return[a("el-input",{attrs:{placeholder:"请输入关键字"},model:{value:e.queryData.f_Name,callback:function(t){e.$set(e.queryData,"f_Name",t)},expression:"queryData.f_Name"}})]},proxy:!0}],null,!1,3794150642)}):e._e()]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{attrs:{isAuth:!1,hasRefresh:!1},on:{setting:e.lr_handleSettingTable,click:function(t){return e.handleAdd()}}})]},proxy:!0}])},[a("l-table",{key:e.tableData.index,ref:"mainTable",attrs:{loading:e.tableLoading,columns:e.columns,dataSource:e.tableData,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage}},[a("l-table-btns",{attrs:{isAuth:!1,btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-dialog",{attrs:{title:e.$t(e.formTitle),visible:e.formVisible,height:465,width:487},on:{"update:visible":function(t){e.formVisible=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[a("supply-list-form",{ref:"form",attrs:{supplierId:e.supplierId,isReadOnly:e.formDetails}})],1),a("l-dialog",{attrs:{title:e.$t(e.formTitle),visible:e.priceVisible,height:465,width:487,hasBtns:!1},on:{"update:visible":function(t){e.priceVisible=t},close:e.priceCloseForm,opened:e.priceOpenedForm}},[e.priceLoaded?a("l-echarts",{ref:"echart",attrs:{option:e.priceOptions}}):e._e()],1)],1)},i=[],l=(a("a434"),a("96cf"),a("1da1")),s=a("fe5f"),n=window.$api.erpcase.supplier,o={components:{SupplyListForm:s["default"]},props:{isReadOnly:{type:Boolean,default:!1},supplierId:String},data:function(){return{moduleCode:"handle_supplyList",queryOpen:!1,priceVisible:!1,priceLoaded:!1,priceOptions:{tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{show:!1},grid:{top:"10%",bottom:"10%"},xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{barMaxWidth:20,barMinWidth:5,name:"历史记录",type:"bar",emphasis:{focus:"series"},data:[],itemStyle:{color:"#5E95FF"}}]},queryData:{f_CreateDate:"",f_State:"",f_Name:""},queryItems:[{label:"添加时间",prop:"f_CreateDate"},{label:"状态",prop:"f_State"},{label:"搜索",prop:"f_Name"}],tableLoading:!1,tableData:[],tableTotal:0,tableCurrentPage:1,tablePageSize:50,columns:[{label:"物料编码",prop:"f_Number",align:"left"},{label:"物料名称",prop:"f_Name",align:"left",dataType:"input"},{label:"规格型号",prop:"f_Model",align:"left",dataType:"input"},{label:"当前采购单价",prop:"f_Price",align:"left",dataType:"input"},{label:"添加时间",prop:"f_CreateDate",dataType:"datetime",format:"yyyy-MM-dd"},{label:"状态",prop:"f_State",width:120,align:"left",dataType:"switch",setting:{width:40,activeIconClass:"",inactiveIconClass:"",activeText:"",inactiveText:"",valueType:"number",activeValue:"1",inactiveValue:"0",activeColor:"#409EFF",inactiveColor:"#C0CCDA",csType:"int",pid:"1670403938708_34398",ptype:"card"}},{label:"操作人",prop:"f_ModifyUserName"}],tableBtns:[{prop:"Edit",label:"编辑",width:80},{prop:"Price",label:"历史价格对比"},{prop:"Delete",label:"删除"}],formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1,formDetails:!1}},computed:{erp_case_f_StateOptions:function(){return[{label:"全部",value:""},{label:"启用",value:1},{label:"未启用",value:0}]}},created:function(){var e=this;this.init(),setTimeout((function(){e.queryOpen=!0}),500)},methods:{init:function(){this.loadTableData()},handleSearch:function(){this.loadTableData()},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},loadTableData:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e||(t.tableCurrentPage=1),t.tableLoading=!0,r=t.$deepClone(t.queryData),r.rows=t.tablePageSize,r.page=t.tableCurrentPage,r.sidx="F_CreateDate DESC",r.f_SupplierId=t.supplierId,a.next=9,t.$awaitWraper(n.supplymaterialpage(r));case 9:i=a.sent,null!=i?(t.tableData=i.rows,t.tableTotal=i.records):t.tableData=[],t.tableLoading=!1;case 12:case"end":return a.stop()}}),a)})))()},handleEdit:function(e,t){this.formEdit=!0,this.formDetails=!1,this.formEditRow=t,this.handleShowForm("编辑")},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then(Object(l["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.tableData.splice(e,1),a.tableTotal--,r.next=4,n.removeMaterial(t.f_Id);case 4:a.$message({type:"success",message:a.$t("删除成功!")});case 5:case"end":return r.stop()}}),r)})))).catch((function(){a.$message({type:"info",message:a.$t("已取消删除!")})}))},handleAdd:function(){this.formEdit=!1,this.formDetails=!1,this.handleShowForm("新增")},handleSave:function(e,t){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){var i,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e("保存数据中..."),r.next=3,a.$refs.form.validateForm();case 3:if(!r.sent){r.next=8;break}return r.next=6,a.$refs.form.saveForm({keyValue:a.formEditRow?a.formEditRow.f_Id:"",isEdit:a.formEdit});case 6:i=r.sent,i&&(l=a.formEdit?"更新成功!":"新增成功!",a.$message({type:"success",message:a.$t(l)}),a.loadTableData(),a.formVisible=!1);case 8:t();case 9:case"end":return r.stop()}}),r)})))()},handleShowForm:function(e){this.formTitle=e,this.formVisible=!0},handleOpenedForm:function(e,t){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a.formEdit){r.next=5;break}return e("加载数据中..."),r.next=4,a.$refs.form.loadFormData({keyValue:a.formEditRow.f_Id});case 4:t();case 5:case"end":return r.stop()}}),r)})))()},handleCloseForm:function(){"历史价格对比"!=this.formTitle&&this.$refs.form.resetForm()},handlePrice:function(e,t){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a.formTitle="历史价格对比",a.formEditRow=t,a.priceVisible=!0;case 3:case"end":return e.stop()}}),e)})))()},priceOpenedForm:function(e,t){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){var i,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e("加载数据"),a.priceLoaded=!1,r.next=4,a.$awaitWraper(n.supplypricelogs({f_SupplymaterialId:a.formEditRow.f_Id}));case 4:if(i=r.sent,a.priceOptions.series[0].data=[],a.priceOptions.xAxis.data=[],i)for(l in i)a.priceOptions.series[0].data.push(i[l].f_CurrentPrice),a.priceOptions.xAxis.data.push(a.lr_dateFormat(i[l].f_CreateDate));a.priceLoaded=!0,t();case 10:case"end":return r.stop()}}),r)})))()},priceCloseForm:function(){this.priceVisible=!1}}},p=o,u=a("2877"),c=Object(u["a"])(p,r,i,!1,null,null,null);t["default"]=c.exports},fe5f:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-rblock l-form-viewer learun-el-form-left"},[a("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini",labelPosition:"left",labelWidth:"110px"}},[a("div",{staticClass:"l-auto-window only-tabs"},[a("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{staticClass:"l-tabs-container",attrs:{label:e.$t("主表信息"),name:"tab0"}},[a("el-row",{attrs:{gutter:16}},[a("div",{staticClass:"l-rblock pd-16"},[a("div",{staticClass:"flex flex-center flex-c-between"},[a("div",{staticClass:"learun-form-title",staticStyle:{"margin-bottom":"0"}},[e._v(" "+e._s(e.$t("选择物料"))+" ")]),e.isEdit?e._e():a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.materialBtn}},[e._v(e._s(e.$t("选择物料")))])],1),a("div",{staticClass:"mt-16"},[a("el-form-item",{attrs:{label:e.$t("物料编号"),prop:"case_erp_supplymaterial_f_Number"}},[a("el-input",{attrs:{size:"mini",disabled:"",placeholder:e.$t("请选择")},model:{value:e.formData.case_erp_supplymaterial_f_Number,callback:function(t){e.$set(e.formData,"case_erp_supplymaterial_f_Number",t)},expression:"formData.case_erp_supplymaterial_f_Number"}})],1),a("el-form-item",{attrs:{label:e.$t("物料名称"),prop:"case_erp_supplymaterial_f_Name"}},[a("el-input",{attrs:{readonly:!0,placeholder:e.$t("请选择")},model:{value:e.formData.case_erp_supplymaterial_f_Name,callback:function(t){e.$set(e.formData,"case_erp_supplymaterial_f_Name",t)},expression:"formData.case_erp_supplymaterial_f_Name"}})],1),a("el-form-item",{attrs:{label:e.$t("规格型号"),prop:"case_erp_supplymaterial_f_Model"}},[a("el-input",{attrs:{readonly:!0,placeholder:e.$t("请选择")},model:{value:e.formData.case_erp_supplymaterial_f_Model,callback:function(t){e.$set(e.formData,"case_erp_supplymaterial_f_Model",t)},expression:"formData.case_erp_supplymaterial_f_Model"}})],1)],1),a("div",{staticClass:"learun-form-title mt-16"},[e._v(e._s(e.$t("其他设置")))]),a("div",[a("el-form-item",{attrs:{label:e.$t("当前采购单价"),prop:"case_erp_supplymaterial_f_Price"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.case_erp_supplymaterial_f_Price,callback:function(t){e.$set(e.formData,"case_erp_supplymaterial_f_Price",t)},expression:"formData.case_erp_supplymaterial_f_Price"}})],1),a("el-form-item",{attrs:{label:e.$t("状态"),prop:"case_erp_supplymaterial_f_State"}},[a("el-switch",{attrs:{activeValue:1,inactiveValue:0},model:{value:e.formData.case_erp_supplymaterial_f_State,callback:function(t){e.$set(e.formData,"case_erp_supplymaterial_f_State",t)},expression:"formData.case_erp_supplymaterial_f_State"}})],1)],1)])])],1)],1)],1)]),a("l-dialog",{attrs:{title:e.$t("选择物料"),visible:e.materialVisible,height:600,width:1e3},on:{"update:visible":function(t){e.materialVisible=t},ok:e.handleSelect}},[a("l-choose-material",{ref:"choseForm",attrs:{multiple:!1}})],1)],1)},i=[],l=(a("96cf"),a("1da1")),s=window.$api.erpcase.supplier,n={props:{isReadOnly:{type:Boolean,default:!1},supplierId:String},data:function(){return{materialVisible:!1,isEdit:!1,moduleCode:"erpCase_supplymaterial",activeName:"tab0",formData:{case_erp_supplymaterial_f_Number:"",case_erp_supplymaterial_f_Name:"",case_erp_supplymaterial_f_Model:"",case_erp_supplymaterial_f_Price:"",case_erp_supplymaterial_f_State:1},rules:{case_erp_supplymaterial_f_Number:[{required:!0,message:"请选择物料"}],case_erp_supplymaterial_f_Name:[{required:!0,message:"请选择物料"}],case_erp_supplymaterial_f_Model:[{required:!0,message:"请选择物料"}],case_erp_supplymaterial_f_Price:[{required:!0,message:"请输入采购单价"},{pattern:/^-?[0-9]+$/,message:"请输入数字"}]}}},computed:{},methods:{handleSelect:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.choseForm.getSelectData();case 2:a=t.sent,e.formData.case_erp_supplymaterial_f_Number=a[0].f_Number,e.formData.case_erp_supplymaterial_f_Name=a[0].f_Name,e.formData.case_erp_supplymaterial_f_Model=a[0].f_Model,e.formData.case_erp_supplymaterial_f_Unit=a[0].f_Unit,e.$refs.choseForm.resetForm(),e.materialVisible=!1;case 9:case"end":return t.stop()}}),t)})))()},materialBtn:function(){this.materialVisible=!0},resetForm:function(){this.$formClear(this.$refs.form),this.formData.case_erp_supplymaterial_f_Id="",this.isEdit=!1,this.activeName="tab0"},validateForm:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$formValidateWraper(e.$refs.form);case 2:if(t.sent){t.next=4;break}return t.abrupt("return",!1);case 4:return t.abrupt("return",!0);case 5:case"end":return t.stop()}}),t)})))()},setForm:function(e){this.$setFormData(this.formData,e,"case_erp_supplymaterial")},getForm:function(){return this.$getFormData(this.formData,"case_erp_supplymaterial")},loadFormData:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.keyValue,t.isEdit=!0,a.next=4,t.$awaitWraper(s.oneMaterial(r));case 4:if(i=a.sent,!i){a.next=10;break}return t.setForm(i),a.abrupt("return",!0);case 10:return a.abrupt("return",!1);case 11:case"end":return a.stop()}}),a)})))()},saveForm:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var r,i,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=e.keyValue,i=e.isEdit,l=t.getForm(),l.f_SupplierId=t.supplierId,!i){a.next=9;break}return a.next=6,t.$awaitWraper(s.updateMaterial(r,l));case 6:return a.abrupt("return",a.sent);case 9:return a.next=11,t.$awaitWraper(s.addMaterial(l));case 11:return a.abrupt("return",a.sent);case 12:case"end":return a.stop()}}),a)})))()}}},o=n,p=a("2877"),u=Object(p["a"])(o,r,i,!1,null,null,null);t["default"]=u.exports}}]);