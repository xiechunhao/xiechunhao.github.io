(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["scheme","scheme-history","scheme-preview"],{"4f9c":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("l-layout",{staticClass:"l-tab-page",attrs:{right:500},scopedSlots:e._u([{key:"right",fn:function(){return[a("l-panel",{staticStyle:{"padding-left":"0"}},[a("div",{staticClass:"l-auto-window"},[a("el-tabs",{attrs:{stretch:!0},model:{value:e.configActiveName,callback:function(t){e.configActiveName=t},expression:"configActiveName"}},[void 0!=e.currentWfNode?a("el-tab-pane",{attrs:{label:e.$t(e.wfNodeName[e.currentWfNode.type]),name:"tab01"}},[a(e.currentWfNode.type+"Option",{ref:"wfcongfig",tag:"component",attrs:{disabled:!0}})],1):e._e(),a("el-tab-pane",{attrs:{label:e.$t("流程属性"),name:"tab02"}},[a("shcemeinfo-config",{ref:"shcemeinfo",attrs:{disabled:!0}})],1)],1)],1)])]},proxy:!0}])},[a("l-panel",{staticStyle:{"padding-right":"0"},scopedSlots:e._u([{key:"title",fn:function(){return[a("el-button-group",[a("el-tooltip",{attrs:{effect:"dark",content:e.$t("复原"),placement:"bottom"}},[a("el-button",{attrs:{size:"mini",icon:"el-icon-aim"},on:{click:e.resetZoom}})],1),a("el-tooltip",{attrs:{effect:"dark",content:e.$t("放大"),placement:"bottom"}},[a("el-button",{attrs:{size:"mini",icon:"el-icon-zoom-in"},on:{click:function(t){return e.handlerZoom(.1)}}})],1),a("el-tooltip",{attrs:{effect:"dark",content:e.$t("缩小"),placement:"bottom"}},[a("el-button",{attrs:{size:"mini",icon:"el-icon-zoom-out"},on:{click:function(t){return e.handlerZoom(-.1)}}})],1)],1)]},proxy:!0}])},[a("b-wflow-viewer",{ref:"bflow",on:{elementClick:e.elementClick}})],1)],1)},o=[],i=a("57ef"),r=a("f75f"),l=a("db94"),s=a("2edb"),c=a("60f8"),f=a("6ff0"),d=a("a926"),u=a("df4f"),h=a("2061"),p=a("825f"),m={provide:function(){return{wfdesign:this}},components:{shcemeinfoConfig:i["default"],startEventOption:r["default"],endEventOption:l["default"],gatewayAndOption:s["default"],gatewayInclusiveOption:c["default"],gatewayXorOption:f["default"],scriptTaskOption:d["default"],subprocessOption:u["default"],userTaskOption:h["default"],mylineOption:p["default"]},data:function(){return{configActiveName:"tab02",currentWfNode:void 0,wfNodeName:{startEvent:"开始节点",endEvent:"结束节点",gatewayAnd:"并行网关",gatewayInclusive:"包含网关",gatewayXor:"排他网关",scriptTask:"脚本节点",userTask:"审核节点",subprocess:"子流程",myline:"线条"}}},computed:{},created:function(){},methods:{resetZoom:function(){this.$refs.bflow.reset()},handlerZoom:function(e){this.$refs.bflow.handlerZoom(e)},elementClick:function(e){var t=this;this.currentWfNode=e,void 0==e?this.configActiveName="tab02":("myline"==e.type&&this.$nextTick((function(){t.$refs.wfcongfig&&t.$refs.wfcongfig.getConditions()})),this.configActiveName="tab01")},handleGetWFData:function(){return this.$deepClone(this.$refs.bflow.getData())},resetForm:function(){},setForm:function(e){var t=e.f_Content,a=JSON.parse(t),n={undoType:a.undoType,undoDbCode:a.undoDbCode,undoDbSQL:a.undoDbSQL,undoIOCName:a.undoIOCName,undoUrl:a.undoUrl,deleteType:a.deleteType,deleteDbCode:a.deleteDbCode,deleteDbSQL:a.deleteDbSQL,deleteIOCName:a.deleteIOCName,deleteUrl:a.deleteUrl,deleteDraftType:a.deleteDraftType,deleteDraftDbCode:a.deleteDraftDbCode,deleteDraftDbSQL:a.deleteDraftDbSQL,deleteDraftIOCName:a.deleteDraftIOCName,deleteDraftUrl:a.deleteDraftUrl};this.$refs.shcemeinfo.setForm(n),this.$refs.bflow.setData(a.wfData)}}},b=m,g=a("2877"),w=Object(g["a"])(b,n,o,!1,null,null,null);t["default"]=w.exports},"5ebe":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("l-layout",{staticClass:"l-tab-page"},[a("l-panel",{staticStyle:{padding:"0"},scopedSlots:e._u([{key:"toolRight",fn:function(){return[a("el-button-group",[a("el-button",{attrs:{size:"mini",icon:"el-icon-refresh-left"},on:{click:e.handleRefresh}})],1)]},proxy:!0}])},[a("div",{staticClass:"l-rblock"},[a("l-table",{attrs:{loading:e.tableLoading,columns:e.columns,dataSource:e.tableData,"row-key":"f_Id",isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_CreateDate",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_CreateDate))+" ")]}},{key:"f_Type",fn:function(t){return[1!=t.row.f_Type?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v(e._s(e.$t("草稿")))]):a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(e.$t("正式")))])]}},{key:"f_IsVerison",fn:function(t){return[a("el-switch",{attrs:{disabled:t.row.f_IsVerison},on:{change:function(a){return e.handleEnableChange(t.row)}},model:{value:t.row.f_IsVerison,callback:function(a){e.$set(t.row,"f_IsVerison",a)},expression:"scope.row.f_IsVerison"}})]}}])},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1)]),a("l-fullscreen-dialog",{attrs:{title:e.$t("流程模版预览")+"-"+e.previewTitle,visible:e.previewVisible,showOk:!1},on:{"update:visible":function(t){e.previewVisible=t},closed:e.handlePreviewClosed,opened:e.handlePreviewOpened}},[a("preview",{ref:"preview"})],1)],1)},o=[],i=(a("d81d"),a("159b"),a("96cf"),a("1da1")),r=a("5530"),l=a("4f9c"),s=window.$api.workflow.scheme,c={components:{preview:l["default"]},props:{schemeInfoId:String,schemeId:String,updateSchemeId:Function},data:function(){return{noAuth:!0,columns:[{label:"创建人",prop:"f_CreateUserName",minWidth:"160"},{label:"创建时间",prop:"f_CreateDate",minWidth:"160"},{label:"状态",prop:"f_Type",width:"64",align:"center"},{label:"当前版本",prop:"f_IsVerison",width:"80",align:"center"}],tableBtns:[{prop:"Preview",label:"预览"}],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1,tableData:[],previewVisible:!1,previewTitle:"",previewLoading:!1,formEditRow:null}},computed:{},watch:{schemeInfoId:function(){this.loadTablePageData()}},created:function(){this.loadTablePageData()},methods:{handleRefresh:function(){this.loadTablePageData()},loadTablePageData:function(e){var t=this;e||(this.tableCurrentPage=1),this.tableLoading=!0;var a={rows:this.tablePageSize,page:this.tableCurrentPage,sidx:"F_CreateDate DESC"};s.getHistoryPage(this.schemeInfoId,a).then((function(e){var a=t.$deepClone(e.data.data);t.tableData=a.rows.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{f_IsVerison:e.f_Id==t.schemeId})})),t.tableTotal=a.records,t.tableLoading=!1})).catch((function(){t.tableData=[],t.tableLoading=!1}))},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTablePageData(!0)},handleEnableChange:function(e){var t=this;this.updateSchemeId(e.f_Id),this.tableData.forEach((function(t){t.f_Id!=e.f_Id&&(t.f_IsVerison=!1)})),s.updateHistory(this.schemeInfoId,e.f_Id).then((function(){t.$message({type:"success",message:t.$t("更新成功!")})}))},handlePreview:function(e,t){this.formEditRow=t,this.previewTitle=this.lr_dateFormat(t.f_CreateDate),this.previewVisible=!0},handlePreviewOpened:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e(),n.next=3,a.$awaitWraper(s.getHistory(a.formEditRow.f_Id));case 3:o=n.sent,a.$refs.preview.setForm(o),t();case 6:case"end":return n.stop()}}),n)})))()},handlePreviewClosed:function(){this.$refs.preview.resetForm()},handleClosePreview:function(){this.previewVisible=!1}}},f=c,d=a("2877"),u=Object(d["a"])(f,n,o,!1,null,null,null);t["default"]=u.exports},a579:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page",scopedSlots:e._u([{key:"left",fn:function(){return[a("l-panel",{staticStyle:{"padding-right":"0"},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.$t("流程分类"))+" "),a("div",{staticClass:"tree-setting-btn"},[a("el-tooltip",{attrs:{effect:"dark",content:e.$t("分类管理"),placement:"top"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-setting"},on:{click:e.handleSettingClick}})],1)],1)]},proxy:!0}],null,!1,1707119425)},[a("el-tree",{ref:"tree",staticClass:"learun-tree",attrs:{"node-key":"id","highlight-current":!0,data:e.dataItemTree_FlowSort},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return a("span",{staticClass:"lr-tree-node"},[a("i",{staticClass:"el-icon-notebook-2"}),e._v(" "+e._s(n.label)+" ")])}}],null,!1,1970407520)})],1)]},proxy:!0}],null,!1,1935739608)},[a("l-panel",{staticStyle:{"padding-left":"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入模版名称"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},nativeOn:{click:function(t){return e.hanleSearch.apply(null,arguments)}},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{on:{click:function(t){return e.handleAdd()}}},[a("l-excel-btns"),a("el-button-group",[a("l-file-import",{attrs:{fileType:"json",classname:"wfSchemeImport"},on:{success:function(t){return e.exportSuccess()}}})],1)],1)]},proxy:!0}],null,!1,2382485345)},[a("l-table",{attrs:{loading:e.tableLoading,columns:e.columns,dataSource:e.tableData,"row-key":"f_Id",isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_CreateDate",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_CreateDate))+" ")]}},{key:"f_Category",fn:function(t){return[e._v(" "+e._s(e.lr_dataItemName(e.lr_dataItem["FlowSort"],t.row.f_Category))+" ")]}},{key:"f_EnabledMark",fn:function(t){return[1!=t.row.f_Type?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.$t("草稿")))]):a("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(a){return e.handleEnableChange(t.row)}},model:{value:t.row.f_EnabledMark,callback:function(a){e.$set(t.row,"f_EnabledMark",a)},expression:"scope.row.f_EnabledMark"}})]}}],null,!1,1105906758)},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-fullscreen-dialog",{ref:"formDialog",attrs:{title:e.$t("流程模版设计"),visible:e.formVisible},on:{"update:visible":function(t){e.formVisible=t},ok:e.handleSave,closed:e.handleClosed,opened:e.handleOpened},scopedSlots:e._u([{key:"headerRight",fn:function(){return[a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.handleSaveDraft()}}},[e._v(e._s(e.$t("暂存")))])]},proxy:!0}],null,!1,3566740930)},[a("my-form",{ref:"form"})],1),a("l-drawer",{attrs:{title:e.$t("分类管理"),visible:e.classifysVisible,showOk:!1,showClose:!1,size:"800px"},on:{"update:visible":function(t){e.classifysVisible=t}}},[a("l-dataitem-index",{attrs:{classifyCode:"FlowSort"}})],1),a("l-drawer",{attrs:{title:e.$t("历史记录")+"-"+e.$t(e.historyTitle),visible:e.historyVisible,showOk:!1,showClose:!1,size:"640px"},on:{"update:visible":function(t){e.historyVisible=t}}},[a("history",{attrs:{schemeInfoId:e.schemeInfoId,schemeId:e.schemeId,updateSchemeId:e.updateSchemeId}})],1)],1)},o=[],i=(a("99af"),a("a434"),a("159b"),a("96cf"),a("1da1")),r=a("7fea"),l=a("5ebe"),s=window.$api.workflow.scheme,c={components:{MyForm:r["default"],history:l["default"]},data:function(){return{lr_isPage:!0,classifysVisible:!1,treeCategory:"",searchWord:"",columns:[{label:"编号",prop:"f_Code",minWidth:"150"},{label:"名称",prop:"f_Name",minWidth:"150"},{label:"分类",prop:"f_Category",width:"120",align:"center"},{label:"状态",prop:"f_EnabledMark",width:"64",align:"center"},{label:"创建人",prop:"f_CreateUserName",width:"100",align:"center"},{label:"创建时间",prop:"f_CreateDate",width:"160"}],tableBtns:[{prop:"Edit",label:"编辑",width:40},{prop:"Delete",label:"删除",width:40},{prop:"Copy",label:"复制",width:40},{prop:"Export",label:"导出",width:40},{prop:"History",label:"历史记录",width:60}],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1,tableData:[],formVisible:!1,formEditRow:null,formEdit:!1,historyVisible:!1,historyTitle:"",schemeInfoId:"",schemeId:"",formCopy:!1}},computed:{dataItemTree_FlowSort:function(){return this.lr_dataItemTree(this.lr_dataItem["FlowSort"])}},mounted:function(){this.lr_loadDataItem("FlowSort"),this.loadTablePage()},methods:{loadTablePage:function(e){var t=this;e||(this.tableCurrentPage=1),this.tableLoading=!0;var a={rows:this.tablePageSize,page:this.tableCurrentPage,sidx:"F_CreateDate DESC",keyword:this.searchWord,category:this.treeCategory};s.getPage(a).then((function(e){var a=t.$deepClone(e.data.data);t.tableData=a.rows,t.tableTotal=a.records,t.tableLoading=!1})).catch((function(){t.tableData=[],t.tableLoading=!1}))},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTablePage(!0)},hanleSearch:function(){this.loadTablePage()},handleNodeClick:function(e){this.treeCategory=e.value,this.tableCurrentPage=1,this.loadTablePage()},handleSettingClick:function(){this.classifysVisible=!0},handleAdd:function(){this.formEdit=!1,this.formVisible=!0,this.formCopy=!1},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.formVisible=!0,this.formCopy=!1},handleExport:function(e,t){this.lr_downTempFile("workflow/scheme/download/workflow/".concat(t.f_Id),"流程_".concat(t.f_Name).concat(t.f_Code),"workflow","json")},handleHistory:function(e,t){this.formEditRow=t,this.historyTitle=t.f_Name,this.schemeId=t.f_SchemeId,this.schemeInfoId=t.f_Id,this.historyVisible=!0},updateSchemeId:function(e){this.schemeId=e,this.formEditRow.f_SchemeId=e},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){a.tableData.splice(e,1),a.tableTotal--,s.remove(t.f_Id).then((function(){a.$message({type:"success",message:a.$t("删除成功!")})}))})).catch((function(){a.$message({type:"info",message:a.$t("已取消删除")})}))},handleEnableChange:function(e){var t=this;s.updateState(e.f_Id,e.f_EnabledMark).then((function(){t.$message({type:"success",message:t.$t("更新成功!")})}))},handleSaveDraft:function(){this.handleSave(this.$refs.formDialog.showLoading,this.$refs.formDialog.hideLoading,!0)},handleSave:function(e,t,a){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function o(){var i;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return e("保存数据中..."),o.next=3,n.$refs.form.validateForm();case 3:if(o.sent){o.next=6;break}return t(),o.abrupt("return");case 6:i=n.$refs.form.getForm(),i.scheme.f_Type=a?2:1,n.formEdit?s.update(n.formEditRow.f_Id,i).then((function(){n.loadTablePage(),n.$message({type:"success",message:n.$t("更新成功!")}),a||(n.formVisible=!1),t()})).catch((function(){t()})):s.add(i).then((function(){n.loadTablePage(),n.$message({type:"success",message:n.$t("保存成功!")}),n.formVisible=!1,t()})).catch((function(){t()}));case 9:case"end":return o.stop()}}),o)})))()},handleOpened:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!a.formEdit&&!a.formCopy){n.next=10;break}return e("加载数据中..."),n.next=4,a.$awaitWraper(s.get(a.formEditRow.f_Code));case 4:o=n.sent,a.formCopy&&(o.scheme.f_Id="",o.scheme.f_SchemeInfoId="",o.schemeinfo.f_ModuleId="",o.schemeinfo.f_SchemeId="",o.schemeAuthList&&o.schemeAuthList.forEach((function(e){e.f_Id="",e.f_SchemeInfoId=""})),o.schemeinfo.f_Code="".concat(o.schemeinfo.f_Code,"-copy"),o.schemeinfo.f_Name="".concat(o.schemeinfo.f_Name,"-复制")),a.$refs.form.setForm(o),t(),n.next=11;break;case 10:a.$nextTick((function(){a.$refs.form.resetForm()}));case 11:case"end":return n.stop()}}),n)})))()},handleClosed:function(){this.$refs.form.resetForm()},handleCopy:function(e,t){this.formEdit=!1,this.formCopy=!0,this.formEditRow=t,this.showForm()},showForm:function(){this.formVisible=!0},exportSuccess:function(){this.loadTablePage()}}},f=c,d=a("2877"),u=Object(d["a"])(f,n,o,!1,null,null,null);t["default"]=u.exports}}]);