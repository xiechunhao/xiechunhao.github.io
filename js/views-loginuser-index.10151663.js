(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-loginuser-index"],{"6a9a":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-tab-page",staticStyle:{padding:"8px"}},[a("div",{staticClass:"l-rblock"},[a("el-tabs",{attrs:{"tab-position":"left",stretch:!0}},[a("el-tab-pane",{attrs:{label:e.$t("基本信息")}},[a("user-baseinfo")],1),a("el-tab-pane",{attrs:{label:e.$t("联系方式")}},[a("user-contact")],1),a("el-tab-pane",{attrs:{label:e.$t("我的头像")}},[a("user-head")],1),a("el-tab-pane",{directives:[{name:"show",rawName:"v-show",value:this.isShowPassword,expression:"this.isShowPassword"}],attrs:{label:e.$t("修改密码")}},[a("user-password")],1),a("el-tab-pane",{attrs:{label:e.$t("我的日志")}},[a("user-log")],1)],1)],1)])},o=[],l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body",staticStyle:{padding:"8px 48px 8px 48px"}},[a("el-form",{ref:"form",attrs:{"label-position":"left",size:"mini","label-width":"80px"}},[a("el-divider",{attrs:{"content-position":"left"}},[e._v(e._s(e.$t("基本信息")))]),e.loginInfo.tenantNo&&"host"!=e.loginInfo.tenantNo?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("租户号"),prop:"tenantNo"}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:e.loginInfo.tenantNo,callback:function(t){e.$set(e.loginInfo,"tenantNo",t)},expression:"loginInfo.tenantNo"}})],1)],1):e._e(),e.loginInfo.tenantName?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("租户"),prop:"tenantName"}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:e.loginInfo.tenantName,callback:function(t){e.$set(e.loginInfo,"tenantName",t)},expression:"loginInfo.tenantName"}})],1)],1):e._e(),e.loginInfo.tenantCompany?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("租户公司"),prop:"tenantCompany"}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:e.loginInfo.tenantCompany,callback:function(t){e.$set(e.loginInfo,"tenantCompany",t)},expression:"loginInfo.tenantCompany"}})],1)],1):e._e(),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("账号"),prop:"f_Account"}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:e.loginInfo.f_Account,callback:function(t){e.$set(e.loginInfo,"f_Account",t)},expression:"loginInfo.f_Account"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("姓名"),prop:"f_RealName"}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:e.loginInfo.f_RealName,callback:function(t){e.$set(e.loginInfo,"f_RealName",t)},expression:"loginInfo.f_RealName"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("性别"),prop:"f_Gender"}},[a("el-radio",{attrs:{disabled:"disabled",label:1},model:{value:e.loginInfo.f_Gender,callback:function(t){e.$set(e.loginInfo,"f_Gender",t)},expression:"loginInfo.f_Gender"}},[e._v(e._s(e.$t("男")))]),a("el-radio",{attrs:{disabled:"disabled",label:0},model:{value:e.loginInfo.f_Gender,callback:function(t){e.$set(e.loginInfo,"f_Gender",t)},expression:"loginInfo.f_Gender"}},[e._v(e._s(e.$t("女")))])],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("公司"),prop:"f_CompanyId"}},[a("l-company",{attrs:{value:this.loginInfo.f_CompanyId}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("部门"),prop:"f_DepartmentId"}},[a("l-department",{attrs:{value:this.loginInfo.f_DepartmentId}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("岗位"),prop:"postIds"}},[a("el-input",{attrs:{value:e.lr_postName(e.loginInfo.postIds),readonly:"readonly"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("角色"),prop:"roleIds"}},[a("el-input",{attrs:{value:e.lr_roleName(e.loginInfo.roleIds),readonly:"readonly"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("备注"),prop:"f_Description"}},[a("el-input",{attrs:{type:"textarea",readonly:"readonly"},model:{value:e.loginInfo.f_Description,callback:function(t){e.$set(e.loginInfo,"f_Description",t)},expression:"loginInfo.f_Description"}})],1)],1)],1)],1)},r=[],s={name:"user-baseinfo",data:function(){return{}},computed:{},methods:{}},i=s,d=a("2877"),c=Object(d["a"])(i,l,r,!1,null,null,null),p=c.exports,f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body",staticStyle:{padding:"8px 48px 8px 48px"}},[a("el-form",{ref:"form",attrs:{"label-position":"left",size:"mini","label-width":"60px"}},[a("el-divider",{attrs:{"content-position":"left"}},[e._v(e._s(e.$t("联系方式")))]),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("手机")}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:e.loginInfo.f_Mobile,callback:function(t){e.$set(e.loginInfo,"f_Mobile",t)},expression:"loginInfo.f_Mobile"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("电话")}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:e.loginInfo.f_Telephone,callback:function(t){e.$set(e.loginInfo,"f_Telephone",t)},expression:"loginInfo.f_Telephone"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("邮箱")}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:e.loginInfo.f_Email,callback:function(t){e.$set(e.loginInfo,"f_Email",t)},expression:"loginInfo.f_Email"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("微信")}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:e.loginInfo.f_WeChat,callback:function(t){e.$set(e.loginInfo,"f_WeChat",t)},expression:"loginInfo.f_WeChat"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"QQ"}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:e.loginInfo.f_OICQ,callback:function(t){e.$set(e.loginInfo,"f_OICQ",t)},expression:"loginInfo.f_OICQ"}})],1)],1)],1)],1)},u=[],m={name:"user-contact",data:function(){return{}},computed:{},created:function(){},methods:{}},g=m,h=Object(d["a"])(g,f,u,!1,null,null,null),b=h.exports,_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body",staticStyle:{padding:"8px 48px 8px 48px"}},[a("el-divider",{attrs:{"content-position":"left"}},[e._v(e._s(e.$t("我的头像")))]),a("el-avatar",{attrs:{size:100,fit:"cover",src:e.imageUrl||e.avatar}},[e._v(" "+e._s(e.loginInfo.f_Account.slice(0,2))+" ")]),a("l-upload",{staticStyle:{"margin-top":"16px"},attrs:{accept:".jpeg,.jpg,.png",showFileList:!1,autoUpload:!1,isTip:"",maxSize:"2",sizeType:"MB",limit:1e3},on:{change:e.handleChange,success:e.handleAvatarSuccess}})],1)},w=[],$=(a("99af"),a("96cf"),a("1da1")),v=window.$api.organization.user,y={name:"user-head",data:function(){return{imageUrl:"",saveBtnDisabled:!0,loading:!1}},computed:{avatar:function(){return this.loginInfo.f_HeadIcon?"".concat(this.apiUrl,"system/annexesfile/").concat(this.loginInfo.f_HeadIcon,"?token=").concat(this.token):""}},methods:{handleChange:function(e){this.imageUrl=e},handleAvatarSuccess:function(e){var t=this;return Object($["a"])(regeneratorRuntime.mark((function a(){var n,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e.file,o=n.id,t.$validatenull(t.loginInfo.f_HeadIcon)||t.loginInfo.f_HeadIcon==o){a.next=5;break}return a.next=5,t.lr_deleteFile(t.loginInfo.f_HeadIcon);case 5:return t.loginInfo.f_HeadIcon=o,a.next=8,v.update(t.loginInfo.f_UserId,{user:t.$deepClone(t.loginInfo)});case 8:case"end":return a.stop()}}),a)})))()},beforeAvatarUpload:function(e){var t=e.size/1024/1024<2;return t||(this.loading=!1,this.$message.error(this.$t("上传头像图片大小不能超过 2MB!"))),t}}},I=y,x=Object(d["a"])(I,_,w,!1,null,null,null),k=x.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body",staticStyle:{padding:"8px 48px 8px 48px"}},[a("el-form",{ref:"form",attrs:{disabled:e.loading,model:e.formData,rules:e.rules,"label-position":"left",size:"mini","label-width":"100px"}},[a("el-divider",{attrs:{"content-position":"left"}},[e._v(e._s(e.$t("密码修改")))]),a("el-form-item",{attrs:{label:e.$t("旧密码"),prop:"oldPassword"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.formData.oldPassword,callback:function(t){e.$set(e.formData,"oldPassword",t)},expression:"formData.oldPassword"}})],1),a("el-form-item",{attrs:{label:e.$t("新密码"),prop:"password"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}})],1),a("el-form-item",{attrs:{label:e.$t("重复新密码"),prop:"password2"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.formData.password2,callback:function(t){e.$set(e.formData,"password2",t)},expression:"formData.password2"}})],1),a("el-form-item",[a("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.onSubmit}},[e._v(e._s(e.$t("提交")))])],1)],1)],1)},D=[],P=window.$api.organization.user,T={name:"user-password",data:function(){var e=this;return{loading:!1,formData:{oldPassword:"",password:"",password2:""},rules:{oldPassword:[{required:!0,message:this.$t("请输入旧密码")},{validator:this.validatorPassword,trigger:"blur"}],password:[{required:!0,message:this.$t("请输入新密码")},{validator:this.getRule,trigger:"blur"}],password2:[{required:!0,message:this.$t("请再输入新密码")},{validator:function(t,a,n){e.formData.password2!=e.formData.password?n(new Error(e.$t("两次密码输入不一致"))):n()},trigger:"blur"}]}}},computed:{},created:function(){},methods:{validatorPassword:function(e,t,a){P.validatorPassword(this.$md5(t)).then((function(e){200==e.data.code&&e.data.data?a():a(new Error(e.data.info))}))},onSubmit:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.loading=!0;var a={password:e.$md5(e.formData.password),oldPassword:e.$md5(e.formData.oldPassword)};P.updatePassword(a).then((function(){e.$message({type:"success",message:e.$t("修改成功!")}),setTimeout((function(){e.$store.dispatch("organization/user/fedLogOut").then((function(){e.$router.push({path:"/login"})}))}),500)})).catch((function(){e.loading=!1}))}}))},getRule:function(e,t,a){var n=this;return Object($["a"])(regeneratorRuntime.mark((function e(){var o,l,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.$awaitWraper(P.GetRuleByRole());case 2:if(o=e.sent,o){e.next=6;break}return a(),e.abrupt("return");case 6:l=o.f_Complexity,r=o.f_Length,r>t.length?a(new Error(n.$t("密码不符合规范"))):(-1!==l.indexOf(1)?(s=/^(?=.*[A-Z]).*$/,s.test(t)||a(new Error(n.$t("密码不符合规范")))):(s=/^(?=.*[A-Z]).*$/,s.test(t)&&a(new Error(n.$t("密码不符合规范")))),-1!==l.indexOf(2)?(s=/^(?=.*[a-z]).*$/,s.test(t)||a(new Error(n.$t("密码不符合规范")))):(s=/^(?=.*[a-z]).*$/,s.test(t)&&a(new Error(n.$t("密码不符合规范")))),-1!==l.indexOf(3)?(s=/^(?=.*\d).*$/,s.test(t)||a(new Error(n.$t("密码不符合规范")))):(s=/^(?=.*\d).*$/,s.test(t)&&a(new Error(n.$t("密码不符合规范")))),-1!==l.indexOf(4)?(s=/^(?=.*[*?!&￥$%^#,./@";:><\\[\]}{\-=+_\\|》《。，、？’‘“”~ `]).*$/,s.test(t)||a(new Error(n.$t("密码不符合规范")))):(s=/^(?=.*[*?!&￥$%^#,./@";:><\\[\]}{\-=+_\\|》《。，、？’‘“”~ `]).*$/,s.test(t)&&a(new Error(n.$t("密码不符合规范")))),a());case 9:case"end":return e.stop()}}),e)})))()}}},S=T,E=Object(d["a"])(S,C,D,!1,null,null,null),O=E.exports,z=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("l-layout",[a("l-panel",{staticStyle:{padding:"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("el-radio-group",{attrs:{size:"mini"},on:{change:e.handleCaregoryChange},model:{value:e.categoryId,callback:function(t){e.categoryId=t},expression:"categoryId"}},[a("el-radio-button",{attrs:{label:"1"}},[e._v(e._s(e.$t("登录")))]),a("el-radio-button",{attrs:{label:"2"}},[e._v(e._s(e.$t("访问")))]),a("el-radio-button",{attrs:{label:"3"}},[e._v(e._s(e.$t("操作")))])],1)],1),a("div",{staticClass:"l-panel--item",staticStyle:{width:"344px"}},[a("el-date-picker",{attrs:{size:"mini",type:"daterange",align:"right","unlink-panels":"","range-separator":e.$t("至"),"start-placeholder":e.$t("开始日期"),"end-placeholder":e.$t("结束日期"),"picker-options":e.pickerOptions},on:{change:e.handleDateChange},model:{value:e.operateTime,callback:function(t){e.operateTime=t},expression:"operateTime"}})],1),a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入IP/功能/类型"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.keyWord,callback:function(t){e.keyWord=t},expression:"keyWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0}])},[a("l-table",{attrs:{loading:e.tableLoading,columns:e.columns,dataSource:e.tableData,"row-key":"f_Id",isPage:!0,pageTotal:e.tableTotal},on:{loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_OperateTime",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_OperateTime))+" ")]}},{key:"f_Category",fn:function(t){return[e._v(" "+e._s(e.lr_dataItemDetailsName("FormSort",t.row.f_Category))+" ")]}},{key:"f_ExecuteResult",fn:function(t){return[1==t.row.f_ExecuteResult?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(e.$t("成功")))]):a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(e.$t("失败")))])]}}])})],1)],1)},N=[],R=window.$api.system.log,A={name:"user-log",props:{},data:function(){return{categoryId:"1",operateTime:null,pickerOptions:{shortcuts:[{text:this.$t("最近一周"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:this.$t("最近一个月"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:this.$t("最近三个月"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},columns:[{label:"时间",prop:"f_OperateTime",width:"160"},{label:"用户",prop:"f_OperateAccount",width:"80",align:"center"},{label:"IP",prop:"f_IPAddress",width:"100"},{label:"功能",prop:"f_Module",width:"160"},{label:"类型",prop:"f_OperateType",width:"64",align:"center"},{label:"结果",prop:"f_ExecuteResult",width:"64",align:"center"},{label:"描述",prop:"f_ExecuteResultJson",minWidth:"150"}],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1,tableData:[],keyWord:""}},created:function(){this.loadTablePageData()},mounted:function(){},computed:{},methods:{loadTablePageData:function(){var e=this;this.tableLoading=!0;var t={rows:this.tablePageSize,page:this.tableCurrentPage,sidx:"F_OperateTime DESC",categoryId:this.categoryId,keyword:this.keyWord,startTime:this.operateTime?this.operateTime[0]:null,endTime:this.operateTime?this.operateTime[1]:null};R.getMyPage(t).then((function(t){var a=e.$deepClone(t.data.data);e.tableData=a.rows,e.tableTotal=a.records,e.tableLoading=!1})).catch((function(){e.tableData=[],e.tableLoading=!1}))},turnTablePage:function(e){var t=e.rows,a=e.page;this.tablePageSize=t,this.tableCurrentPage=a,this.loadTablePageData()},handleCaregoryChange:function(){this.loadTablePageData()},handleDateChange:function(){this.loadTablePageData()},hanleSearch:function(){this.loadTablePageData()}}},L=A,j=Object(d["a"])(L,z,N,!1,null,null,null),W=j.exports,G={components:{userBaseinfo:p,userContact:b,userHead:k,userPassword:O,userLog:W},data:function(){return{isShowPassword:!1}},mounted:function(){this.ShowPassword()},computed:{},methods:{ShowPassword:function(){1!=this.loginInfo.f_SecurityLevel&&this.lr_IsAdmin?this.isShowPassword=!1:this.isShowPassword=!0}}},H=G,M=Object(d["a"])(H,n,o,!1,null,null,null);t["default"]=M.exports}}]);