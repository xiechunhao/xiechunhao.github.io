(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["purchase"],{"6efe":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("l-layout",{directives:[{name:"show",rawName:"v-show",value:!e.lr_loadPage,expression:"!lr_loadPage"}],staticClass:"l-tab-page"},[a("l-panel",{scopedSlots:e._u([{key:"title",fn:function(){return[a("div",[e._v(e._s(e.$t("采购订单")))]),a("div",{staticStyle:{width:"560px"}},[a("div",{staticClass:"ml-8",staticStyle:{float:"right"}},[a("l-tool-btns",{attrs:{hasTableSetting:!0},on:{setting:e.lr_handleSettingTable,click:function(t){return e.handleAdd()}}},[a("l-excel-btns")],1)],1),a("div",{staticStyle:{float:"right"}},[a("el-input",{attrs:{placeholder:"输入内容",size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleSearch},slot:"append"})],1)],1)])]},proxy:!0}])},[a("l-table",{ref:"mainTable",attrs:{loading:e.tableLoading,columns:e.lr_getPageColumns(e.columns),dataSource:e.tableData,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage,rowKey:"f_Id",isMultiSelect:""},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_InStoreState",fn:function(e){return[0==e.row.f_InStoreState?a("i",{staticClass:"learun-icon-circle-correct-base learun-success",staticStyle:{"font-size":"20px"}}):a("i",{staticClass:"learun-icon-circle-sigh-base learun-error",staticStyle:{"font-size":"20px"}})]}},{key:"f_TicketState",fn:function(e){return[0==e.row.f_TicketState?a("i",{staticClass:"learun-icon-circle-correct-base learun-success",staticStyle:{"font-size":"20px"}}):a("i",{staticClass:"learun-icon-circle-sigh-base learun-error",staticStyle:{"font-size":"20px"}})]}},{key:"f_PayState",fn:function(e){return[0==e.row.f_PayState?a("i",{staticClass:"learun-icon-circle-correct-base learun-success",staticStyle:{"font-size":"20px"}}):a("i",{staticClass:"learun-icon-circle-sigh-base learun-error",staticStyle:{"font-size":"20px"}})]}},{key:"f_PurchaseSynopsis",fn:function(t){return[t.row.f_PurchaseSynopsis?a("el-popover",{attrs:{placement:"bottom-start",width:"140",trigger:"hover","popper-class":"erpcase-purchase-popover"}},[a("div",{attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(e.getSynopsis(t.row.f_PurchaseSynopsis))),a("i",{staticClass:"el-icon-caret-bottom"})]),a("div",{staticClass:"popover-list"},e._l(t.row.f_PurchaseSynopsis.split(","),(function(t,i){return a("div",{key:i,staticClass:"popover-list-item"},[a("p",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",width:"120px"}},[e._v(" "+e._s(t)+" ")])])})),0)]):e._e()]}}])},[a("l-table-btns",{attrs:{btns:e.tableBtns,filterBtns:e.filterBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-dialog",{attrs:{title:e.$t(e.formTitle),visible:e.formVisible,height:980,width:1e3},on:{"update:visible":function(t){e.formVisible=t},close:e.handleCloseForm,opened:e.handleOpenedForm}},[a("detail-form",{ref:"detailForm",on:{refresh:e.wfSubmit}})],1),a("wf-create-form",{ref:"wfcreate",attrs:{code:"erp-purchase",type:e.formEdit?"draft":"",params:{processId:e.purchaseId},isLoadFormData:e.formEdit,title:e.formEdit?"编辑订单":"新增订单",wraperType:"dialog",height:980,width:1e3,visible:e.wfVisible},on:{"update:visible":function(t){e.wfVisible=t},refresh:function(t){return e.loadTableData(!0)}}})],1)},r=[],l=(a("99af"),a("a434"),a("ac1f"),a("1276"),a("96cf"),a("1da1")),n=a("d9bc"),o=window.$api.erpcase.purchase,s=window.$api.workflow.process,c={components:{DetailForm:n["default"]},data:function(){return{lr_isPage:!0,moduleCode:"ERP_PurchaseOrders",searchWord:"",tableLoading:!1,tableData:[],tableTotal:0,tableCurrentPage:1,tablePageSize:50,columns:[{label:"采购编码",prop:"f_Number",width:160,isNotAutoWrap:!0,align:"left"},{label:"采购订单名称",prop:"f_Theme",minWidth:120,align:"left",isNotAutoWrap:!0},{label:"供应商",prop:"f_SupplierName",minWidth:120,align:"left",dataType:"dataSource",dataCode:"ERP_Suppliers",valueKey:"f_id",labelKey:"f_name",isNotAutoWrap:!0},{label:"采购日期",prop:"f_PurchaseDate",width:100,align:"left",dataType:"datetime",format:"yyyy-MM-dd"},{label:"采购部门",prop:"f_PurchaseDep",width:120,align:"left",dataType:"department"},{label:"采购人员",prop:"f_PurchasePerson",width:100,align:"left",dataType:"user"},{label:"采购物品",prop:"f_PurchaseSynopsis",width:120,align:"left",isNotAutoWrap:!0},{label:"总金额",prop:"f_AmountSum",width:100,align:"left"},{label:"已付金额",prop:"f_AlreadyAmount",width:100,align:"left"},{label:"已到票金额",prop:"f_AlreadyTicket",width:100,align:"left"},{label:"审核状态",prop:"f_AuditState",width:80,align:"left",dataType:"mydata",options:[{value:1,label:"未提交"},{value:2,label:"审批中"},{label:3,value:"已驳回"},{label:4,value:"通过"}]},{label:"入库",prop:"f_InStoreState",width:64,align:"center"},{label:"到票",prop:"f_TicketState",width:64,align:"center"},{label:"付款",prop:"f_PayState",width:64,align:"center"}],tableBtns:[{prop:"Details",label:"查看",width:40},{prop:"Edit",label:"编辑",width:40},{prop:"Delete",label:"删除",width:40}],formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1,formDetails:!1,wfVisible:!1}},computed:{purchaseId:function(){return this.formEditRow?this.formEditRow.f_Id:""}},mounted:function(){this.init()},methods:{init:function(){this.loadTableData()},wfSubmit:function(){this.formVisible=!1,this.loadTableData(!0)},filterBtns:function(e,t){return 1!=e.f_AuditState?(t[1].disabled=!0,t[2].disabled=!0):t[0].disabled=!0,t},getSynopsis:function(e){var t=e.split(",");return 1==t.length?"".concat(t[0].split(":")[0]):"".concat(t[0].split(":")[0],"等").concat(t.length,"项")},handleSearch:function(){this.loadTableData()},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},loadTableData:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var i,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e||(t.tableCurrentPage=1),t.tableLoading=!0,i={},i.f_Theme=t.searchWord,i.rows=t.tablePageSize,i.page=t.tableCurrentPage,i.sidx="F_CreateDate DESC",a.next=9,t.$awaitWraper(o.getPage(i));case 9:r=a.sent,null!=r?(t.tableData=r.rows,t.tableTotal=r.records):t.tableData=[],t.tableLoading=!1;case 12:case"end":return a.stop()}}),a)})))()},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.wfVisible=!0},handleAdd:function(){this.formEdit=!1,this.formEditRow=null,this.wfVisible=!0},handleDetails:function(e,t){this.formEdit=!0,this.formDetails=!1,this.formEditRow=t,this.handleShowForm("查看订单详情")},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then(Object(l["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a.tableData.splice(e,1),a.tableTotal--,i.next=4,o.remove(t.f_Id);case 4:return i.next=6,s.deleteDraft(t.f_Id);case 6:a.$message({type:"success",message:a.$t("删除成功!")});case 7:case"end":return i.stop()}}),i)})))).catch((function(){a.$message({type:"info",message:a.$t("已取消删除!")})}))},handleShowForm:function(e){this.formTitle=e,this.formVisible=!0},handleOpenedForm:function(e,t){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!a.formEdit){i.next=5;break}return e("加载数据中..."),i.next=4,a.$refs.detailForm.loadFormData({keyValue:a.formEditRow.f_Id});case 4:t();case 5:case"end":return i.stop()}}),i)})))()},handleCloseForm:function(){this.$refs.detailForm.resetForm()}}},u=c,d=(a("de6b"),a("2877")),f=Object(d["a"])(u,i,r,!1,null,null,null);t["default"]=f.exports},7564:function(e,t,a){},de6b:function(e,t,a){"use strict";a("7564")}}]);