(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["dataSchema-form"],{"56ef4":function(a,e,t){"use strict";t.r(e);var s=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("l-layout",{staticClass:"learun-el-form-left",attrs:{top:a.layoutTop,topMove:!1},scopedSlots:a._u([{key:"top",fn:function(){return[t("el-form",{ref:"form",staticClass:"pd-8",attrs:{model:a.formData,rules:a.rules,size:"mini",labelPosition:"left",labelWidth:"100px"}},[t("el-row",{attrs:{gutter:32}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:a.$t("数据库"),prop:"lr_sass_dataschema_f_DbCode"}},[t("el-select",{attrs:{placeholder:a.$t("请选择")},on:{change:a.dbChange},model:{value:a.formData.lr_sass_dataschema_f_DbCode,callback:function(e){a.$set(a.formData,"lr_sass_dataschema_f_DbCode",e)},expression:"formData.lr_sass_dataschema_f_DbCode"}},a._l(a.lr_dblinkTree,(function(e){return t("el-option-group",{key:e.id,attrs:{label:e.label}},a._l(e.children,(function(a){return t("el-option",{key:a.id,attrs:{label:a.label,value:a.id}})})),1)})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:a.$t("数据表"),prop:"lr_sass_dataschema_f_Table"}},[t("el-input",{attrs:{readonly:"readonly"},model:{value:a.formData.lr_sass_dataschema_f_Table,callback:function(e){a.$set(a.formData,"lr_sass_dataschema_f_Table",e)},expression:"formData.lr_sass_dataschema_f_Table"}},[t("span",{attrs:{slot:"append"},on:{click:function(e){return a.handleAddTable("lr_sass_dataschema_f_Table")}},slot:"append"},[t("el-button",{attrs:{slot:"append",icon:"el-icon-more"},slot:"append"})],1)])],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:a.$t("关联表"),prop:"lr_sass_dataschema_f_HasRTable"}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:a.formData.lr_sass_dataschema_f_HasRTable,callback:function(e){a.$set(a.formData,"lr_sass_dataschema_f_HasRTable",e)},expression:"formData.lr_sass_dataschema_f_HasRTable"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:a.$t("父级字段"),prop:"lr_sass_dataschema_f_ParentId"}},[t("l-select",{attrs:{options:a.fieldOptions},model:{value:a.formData.lr_sass_dataschema_f_ParentId,callback:function(e){a.$set(a.formData,"lr_sass_dataschema_f_ParentId",e)},expression:"formData.lr_sass_dataschema_f_ParentId"}})],1)],1),a.formData.lr_sass_dataschema_f_HasRTable?[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:a.$t("关联字段"),prop:"lr_sass_dataschema_f_Field"}},[t("l-select",{attrs:{options:a.fieldOptions},model:{value:a.formData.lr_sass_dataschema_f_Field,callback:function(e){a.$set(a.formData,"lr_sass_dataschema_f_Field",e)},expression:"formData.lr_sass_dataschema_f_Field"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:a.$t("关联表"),prop:"lr_sass_dataschema_f_RTable"}},[t("el-input",{attrs:{readonly:"readonly"},model:{value:a.formData.lr_sass_dataschema_f_RTable,callback:function(e){a.$set(a.formData,"lr_sass_dataschema_f_RTable",e)},expression:"formData.lr_sass_dataschema_f_RTable"}},[t("span",{attrs:{slot:"append"},on:{click:function(e){return a.handleAddTable("lr_sass_dataschema_f_RTable",!0)}},slot:"append"},[t("el-button",{attrs:{slot:"append",icon:"el-icon-more"},slot:"append"})],1)])],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:a.$t("关联表字段"),prop:"lr_sass_dataschema_f_RField"}},[t("l-select",{attrs:{options:a.rfieldOptions},model:{value:a.formData.lr_sass_dataschema_f_RField,callback:function(e){a.$set(a.formData,"lr_sass_dataschema_f_RField",e)},expression:"formData.lr_sass_dataschema_f_RField"}})],1)],1)]:a._e(),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:a.$t("排序"),prop:"lr_sass_dataschema_f_Sort"}},[t("el-input-number",{attrs:{controlsPosition:"default",placeholder:a.$t("请输入")},model:{value:a.formData.lr_sass_dataschema_f_Sort,callback:function(e){a.$set(a.formData,"lr_sass_dataschema_f_Sort",e)},expression:"formData.lr_sass_dataschema_f_Sort"}})],1)],1)],2)],1)]},proxy:!0}])},[t("div",{staticClass:"l-rblock pd-8",staticStyle:{"padding-bottom":"0"}},[t("div",{staticClass:"l-auto-window"},[t("el-tabs",{attrs:{type:"card"},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},[t("el-tab-pane",{staticClass:"l-tabs-container",attrs:{label:a.$t("数据"),name:"tab0"}},[a.showDataTable?t("l-select-panel",{ref:"dbTableDataTable",attrs:{columns:a.dataColumns,isPage:!0,loadSelectTable:a.loadSelectTable,multiple:!0,model:"client",valueKey:a.pkey},model:{value:a.dataValue,callback:function(e){a.dataValue=e},expression:"dataValue"}}):a._e()],1),t("el-tab-pane",{staticClass:"l-tabs-container",attrs:{label:a.$t("列设置"),name:"tab1"}},[t("l-table",{attrs:{columns:a.columns,dataSource:a.tableColumns},scopedSlots:a._u([{key:"rTable",fn:function(e){return[t("el-input",{attrs:{size:"mini",readonly:"readonly"},model:{value:e.row.rTable,callback:function(t){a.$set(e.row,"rTable",t)},expression:"scope.row.rTable"}},[t("span",{attrs:{slot:"append"},on:{click:function(t){return a.handleSelectTable(e.row,"rTable")}},slot:"append"},[t("el-button",{attrs:{slot:"append",icon:"el-icon-more"},slot:"append"})],1)])]}}])})],1)],1)],1)]),t("l-codetable-selectdialog",{attrs:{visible:a.dbtableSelectdialog,dbCode:a.formData.lr_sass_dataschema_f_DbCode,isOkClose:!1,multiple:!1},on:{"update:visible":function(e){a.dbtableSelectdialog=e},select:a.dbSelect}})],1)},r=[],l=(t("99af"),t("7db0"),t("d81d"),t("b0c0"),t("159b"),t("96cf"),t("1da1")),n=window.$api.sass.dataschema,o=window.$api.data.codeTable,i=window.$api.data.dbTable,c={props:{objectId:String},data:function(){return{moduleCode:"sass_dataschema",activeName:"tab0",formData:{lr_sass_dataschema_f_DbCode:"",lr_sass_dataschema_f_Table:"",lr_sass_dataschema_f_HasRTable:"",lr_sass_dataschema_f_Field:"",lr_sass_dataschema_f_RTable:"",lr_sass_dataschema_f_RField:"",lr_sass_dataschema_f_ParentId:"",lr_sass_dataschema_f_Sort:""},rules:{lr_sass_dataschema_f_DbCode:[{required:!0,message:this.$t("请选择")}],lr_sass_dataschema_f_Table:[{required:!0,message:this.$t("请选择")}],lr_sass_dataschema_f_Field:[{required:!0,message:this.$t("请选择")}],lr_sass_dataschema_f_RTable:[{required:!0,message:this.$t("请选择")}],lr_sass_dataschema_f_RField:[{required:!0,message:this.$t("请选择")}]},columns:[{label:"字段",prop:"name",minWidth:"100"},{label:"描述",prop:"coment",minWidth:"100"},{label:"关联表",prop:"rTable",minWidth:"100"}],dbtableSelectdialog:!1,selectRow:null,tableNameField:"",isNotMain:!1,tableMap:{},dbTableDatas:{},tableColumns:[],showDataTable:!0,dataValue:""}},computed:{fieldOptions:function(){return this.getCols(this.formData.lr_sass_dataschema_f_Table)},rfieldOptions:function(){return console.log("rfieldOptions"),this.getCols(this.formData.lr_sass_dataschema_f_RTable)},layoutTop:function(){return this.formData.lr_sass_dataschema_f_HasRTable?180:132},dataColumns:function(){var a=[];return this.tableColumns.forEach((function(e){a.push({label:e.coment?"".concat(e.name,"(").concat(e.coment,")"):e.name,prop:e.name.toLowerCase(),minWidth:"160"})})),0==a.length&&a.push({label:"",prop:"",minWidth:"160"}),a},pkey:function(){if(0==this.tableColumns.length)return"";var a=this.tableColumns.find((function(a){return a.isPrimary})).name.toLowerCase();return a}},methods:{handleAddTable:function(a,e){this.formData.lr_sass_dataschema_f_DbCode?(this.selectRow=this.formData,this.tableNameField=a,this.isNotMain=e,this.dbtableSelectdialog=!0):this.$message({message:this.$t("请选择数据库"),type:"warning"})},handleSelectTable:function(a,e){this.formData.lr_sass_dataschema_f_DbCode?(this.selectRow=a,this.tableNameField=e,this.isNotMain=!0,this.dbtableSelectdialog=!0):this.$message({message:this.$t("请选择数据库"),type:"warning"})},dbSelect:function(a,e,t){var s=this;return Object(l["a"])(regeneratorRuntime.mark((function r(){var l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e(),l=a[0].f_TableName,r.next=4,s.loadCols(l,s.formData.lr_sass_dataschema_f_DbCode);case 4:s.isNotMain||(s.showDataTable=!1,s.tableColumns=s.tableMap[l]||[]),t(),s.$set(s.selectRow,s.tableNameField,l),s.dbtableSelectdialog=!1,s.isNotMain||(s.dataValue="",setTimeout((function(){s.showDataTable=!0,s.$nextTick((function(){s.$refs.dbTableDataTable.init()}))})));case 9:case"end":return r.stop()}}),r)})))()},loadCols:function(a,e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function s(){var r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.tableMap[a]){s.next=5;break}return s.next=3,t.$awaitWraper(o.getList(e,a));case 3:r=s.sent,r&&(t.tableMap[a]=r[0].lr_db_codecolumnsList.map((function(a){return{id:a.f_DbColumnName,name:a.f_DbColumnName,csType:a.f_CsType,isIdentity:1==a.f_IsIdentity,isPrimary:1==a.f_IsPrimaryKey,isNullable:1==a.f_IsNullable,coment:a.f_Description}})));case 5:case"end":return s.stop()}}),s)})))()},getCols:function(a){if(!a)return[];var e=this.tableMap[a]||[];return e.map((function(a){return{label:a.coment?"".concat(a.name,"(").concat(a.coment,")"):a.name,value:a.name}}))},dbChange:function(){this.tableMap={},this.dbTableDatas={}},loadSelectTable:function(){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var t,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=a.formData.lr_sass_dataschema_f_Table,s=a.formData.lr_sass_dataschema_f_DbCode,t&&s){e.next=4;break}return e.abrupt("return",[]);case 4:if(a.dbTableDatas[t]){e.next=8;break}return e.next=7,a.loaddbTableData(s,t);case 7:a.dbTableDatas[t]=e.sent;case 8:return r=a.dbTableDatas[t],e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})))()},loaddbTableData:function(a,e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function s(){var r,l;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return r={code:a,tableName:e},s.next=3,t.$awaitWraper(i.getDataList(r));case 3:return l=s.sent,s.abrupt("return",l||[]);case 5:case"end":return s.stop()}}),s)})))()},resetForm:function(){var a=this;this.$formClear(this.$refs.form),this.activeName="tab0",this.tableColumns=[],this.tableMap={},this.dbTableDatas={},setTimeout((function(){a.showDataTable=!0,a.$nextTick((function(){a.$refs.dbTableDataTable.init()}))}))},validateForm:function(){var a=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.$formValidateWraper(a.$refs.form);case 2:if(e.sent){e.next=4;break}return e.abrupt("return",!1);case 4:if(0!=a.dataValue.length){e.next=7;break}return a.$message({type:"warning",message:a.$t("请勾选数据")}),e.abrupt("return",!1);case 7:return e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})))()},setForm:function(a){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.showDataTable=!1,s=JSON.parse(a.f_Schema),e.tableColumns=s.columns,e.dataValue=s.data,e.tableMap[a.f_Table]=s.columns,!a.f_RTable){t.next=8;break}return t.next=8,e.loadCols(a.f_RTable,a.f_DbCode);case 8:setTimeout((function(){e.showDataTable=!0,e.$nextTick((function(){e.$refs.dbTableDataTable.init()}))})),e.$setFormData(e.formData,a,"lr_sass_dataschema");case 10:case"end":return t.stop()}}),t)})))()},getForm:function(){var a=this.$getFormData(this.formData,"lr_sass_dataschema");a.f_ObjectId=this.objectId;var e={columns:this.tableColumns,data:this.dataValue};return a.f_Schema=JSON.stringify(e),a},loadFormData:function(a){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=a.keyValue,t.next=3,e.$awaitWraper(n.get(s));case 3:if(r=t.sent,!r){t.next=9;break}return e.setForm(r),t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t)})))()},saveForm:function(a){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var s,r,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=a.keyValue,r=a.isEdit,l=e.getForm(),!r){t.next=8;break}return t.next=5,e.$awaitWraper(n.update(s,l));case 5:return t.abrupt("return",t.sent);case 8:return l.f_Id=s,t.next=11,e.$awaitWraper(n.add(l));case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),t)})))()}}},d=c,m=t("2877"),u=Object(m["a"])(d,s,r,!1,null,null,null);e["default"]=u.exports}}]);