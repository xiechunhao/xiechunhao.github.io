(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-area-index"],{9327:function(e,a,t){"use strict";t.r(a);var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("l-layout",{staticClass:"l-tab-page"},[t("l-panel",{scopedSlots:e._u([{key:"toolRight",fn:function(){return[t("l-tool-btns",{attrs:{hasAdd:!e.loginInfo.tenantName},on:{click:function(a){return e.handleAdd()}}},[t("l-excel-btns")],1)]},proxy:!0}])},[t("l-table",{attrs:{loading:e.tableLoading,columns:e.lr_getPageColumns(e.columns),dataSource:e.tableData,rowKey:"f_AreaId",lazy:!0,load:e.load,isTree:""},scopedSlots:e._u([{key:"f_EnabledMark",fn:function(a){return[t("el-switch",{attrs:{"active-value":1,"inactive-value":0,disabled:e.loginInfo.tenantName},on:{change:function(t){return e.handleEnableChange(a.row)}},model:{value:a.row.f_EnabledMark,callback:function(t){e.$set(a.row,"f_EnabledMark",t)},expression:"scope.row.f_EnabledMark"}})]}}])},[e.loginInfo.tenantName?e._e():t("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),t("l-dialog",{attrs:{height:360,width:480,title:e.formTitle,visible:e.formVisible},on:{"update:visible":function(a){e.formVisible=a},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[t("my-form",{ref:"form"})],1)],1)},n=[],o=(t("96cf"),t("1da1")),i=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"l-from-body"},[t("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"60px"}},[t("el-col",{attrs:{span:24}},[e.ready?t("el-form-item",{attrs:{label:e.$t("上级"),prop:"f_ParentId"}},[t("l-tree-select",{attrs:{lazy:!0,treeLoad:e.treeLoad,labelKey:"f_AreaName",valueKey:"f_AreaCode",getValue:e.getValue},model:{value:e.formData.f_ParentId,callback:function(a){e.$set(e.formData,"f_ParentId",a)},expression:"formData.f_ParentId"}})],1):e._e()],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("编号"),prop:"f_AreaCode"}},[t("el-input",{model:{value:e.formData.f_AreaCode,callback:function(a){e.$set(e.formData,"f_AreaCode",a)},expression:"formData.f_AreaCode"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_AreaName"}},[t("el-input",{model:{value:e.formData.f_AreaName,callback:function(a){e.$set(e.formData,"f_AreaName",a)},expression:"formData.f_AreaName"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("状态"),prop:"f_EnabledMark"}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.formData.f_EnabledMark,callback:function(a){e.$set(e.formData,"f_EnabledMark",a)},expression:"formData.f_EnabledMark"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("描述"),prop:"f_Description"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.formData.f_Description,callback:function(a){e.$set(e.formData,"f_Description",a)},expression:"formData.f_Description"}})],1)],1)],1)],1)},s=[],l=(t("4de4"),{data:function(){var e=this;return{pOptions:[],formData:{f_ParentId:"0",f_AreaCode:"",f_AreaName:"",f_EnabledMark:1,f_Description:""},rules:{f_AreaCode:[{required:!0,message:"请输入"},{validator:this.lr_existDbFiled,keyValue:function(){return e.formData.f_AreaId},tableName:"lr_base_area",keyName:"f_AreaId",trigger:"blur"}],f_AreaName:[{required:!0,message:"请输入"}]},ready:!0}},created:function(){},methods:{treeLoad:function(e,a){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.lr_loadAreas(e.key||"0");case 2:t.$validatenull(t.formData.f_AreaId)?a(t.lr_areas[e.key||"0"]):a(t.lr_areas[e.key||"0"].filter((function(e){return e.f_AreaId!=t.formData.f_AreaId})));case 3:case"end":return r.stop()}}),r)})))()},resetForm:function(){var e=this;this.formData.f_AreaId="",this.formData.f_ParentId="0",this.$refs.form&&this.$refs.form.resetFields(),this.ready=!1,this.$nextTick((function(){e.ready=!0}))},validateForm:function(e){this.$refs.form.validate((function(a){a&&e()}))},setForm:function(e){var a=this;this.ready=!1,this.formData=this.$deepClone(e),this.$nextTick((function(){a.ready=!0}))},getForm:function(){return this.$deepClone(this.formData)},getValue:function(e,a){"0"==e?a([]):this.$store.dispatch("data/area/get",e).then((function(e){e&&a([e.f_AreaName])}))}}}),f=l,d=t("2877"),c=Object(d["a"])(f,i,s,!1,null,"6bca11ef",null),m=c.exports,u={inject:["admin"],components:{MyForm:m},props:{},data:function(){return{lr_isPage:!0,columns:[{label:"名称",prop:"f_AreaName",minWidth:"100"},{label:"编号",prop:"f_AreaCode",width:"100"},{label:"状态",prop:"f_EnabledMark",width:"64",align:"center"}],tableBtns:[{prop:"Edit",label:"编辑",width:40},{prop:"Delete",label:"删除",width:40}],tableLoading:!1,tableData:[],formTitle:"",formVisible:!1,formEditRow:null,formEdit:!1}},computed:{},mounted:function(){this.loadTableData()},methods:{loadTableData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.tableLoading=!0,a.next=3,e.lr_loadAreas("0",!1);case 3:e.tableData=e.lr_areas["0"],console.log(e.tableData),e.tableLoading=!1;case 6:case"end":return a.stop()}}),a)})))()},load:function(e){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.row,t.next=3,a.lr_loadAreas(r.f_AreaId,!1);case 3:return t.abrupt("return",a.lr_areas[r.f_AreaId]);case 4:case"end":return t.stop()}}),t)})))()},handleEnableChange:function(e){var a=this;this.$store.dispatch("data/area/update",{id:e.f_AreaId,formData:this.$deepClone(e)}).then((function(){a.$message({type:"success",message:"更新成功!"})}))},handleAdd:function(){this.formEdit=!1,this.showForm("新增区域")},handleEdit:function(e,a){this.formEdit=!0,this.formEditRow=a,this.showForm("编辑区域")},handleDelete:function(e,a){var t=this;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.lr_loadAreas(a.f_AreaId,!1);case 2:if(!(t.lr_areas[a.f_AreaId].length>0)){e.next=5;break}return t.$message({type:"info",message:"有子节点无法删除"}),e.abrupt("return");case 5:t.$store.dispatch("data/area/remove",{id:a.f_AreaId,pid:a.f_ParentId}).then((function(){t.$message({type:"success",message:"删除成功!"}),t.admin.reload()}));case 6:case"end":return e.stop()}}),e)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},handleSave:function(e,a){var t=this;this.$refs.form.validateForm((function(){e();var r=t.$refs.form.getForm();t.formEdit?t.$store.dispatch("data/area/update",{id:t.formEditRow.f_AreaId,formData:r,oldPid:t.formEditRow.f_ParentId}).then((function(){a(),t.formVisible=!1,t.$message({type:"success",message:"更新成功!"}),t.admin.reload()})).catch((function(){a()})):t.$store.dispatch("data/area/add",r).then((function(){a(),t.formVisible=!1,t.$message({type:"success",message:"新增成功!"}),t.admin.reload()})).catch((function(){a()}))}))},handleOpenedForm:function(){this.formEdit&&this.$refs.form.setForm(this.formEditRow)},handleCloseForm:function(){this.$refs.form.resetForm()},showForm:function(e){this.formTitle=e,this.formVisible=!0}}},h=u,p=Object(d["a"])(h,r,n,!1,null,null,null);a["default"]=p.exports}}]);