(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["dataSchema","dataSchema-form"],{"56ef4":function(e,a,t){"use strict";t.r(a);var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("l-layout",{staticClass:"learun-el-form-left",attrs:{top:e.layoutTop,topMove:!1},scopedSlots:e._u([{key:"top",fn:function(){return[t("el-form",{ref:"form",staticClass:"pd-8",attrs:{model:e.formData,rules:e.rules,size:"mini",labelPosition:"left",labelWidth:"100px"}},[t("el-row",{attrs:{gutter:32}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("数据库"),prop:"lr_sass_dataschema_f_DbCode"}},[t("el-select",{attrs:{placeholder:e.$t("请选择")},on:{change:e.dbChange},model:{value:e.formData.lr_sass_dataschema_f_DbCode,callback:function(a){e.$set(e.formData,"lr_sass_dataschema_f_DbCode",a)},expression:"formData.lr_sass_dataschema_f_DbCode"}},e._l(e.lr_dblinkTree,(function(a){return t("el-option-group",{key:a.id,attrs:{label:a.label}},e._l(a.children,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("数据表"),prop:"lr_sass_dataschema_f_Table"}},[t("el-input",{attrs:{readonly:"readonly"},model:{value:e.formData.lr_sass_dataschema_f_Table,callback:function(a){e.$set(e.formData,"lr_sass_dataschema_f_Table",a)},expression:"formData.lr_sass_dataschema_f_Table"}},[t("span",{attrs:{slot:"append"},on:{click:function(a){return e.handleAddTable("lr_sass_dataschema_f_Table")}},slot:"append"},[t("el-button",{attrs:{slot:"append",icon:"el-icon-more"},slot:"append"})],1)])],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("关联表"),prop:"lr_sass_dataschema_f_HasRTable"}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.formData.lr_sass_dataschema_f_HasRTable,callback:function(a){e.$set(e.formData,"lr_sass_dataschema_f_HasRTable",a)},expression:"formData.lr_sass_dataschema_f_HasRTable"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("父级字段"),prop:"lr_sass_dataschema_f_ParentId"}},[t("l-select",{attrs:{options:e.fieldOptions},model:{value:e.formData.lr_sass_dataschema_f_ParentId,callback:function(a){e.$set(e.formData,"lr_sass_dataschema_f_ParentId",a)},expression:"formData.lr_sass_dataschema_f_ParentId"}})],1)],1),e.formData.lr_sass_dataschema_f_HasRTable?[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("关联字段"),prop:"lr_sass_dataschema_f_Field"}},[t("l-select",{attrs:{options:e.fieldOptions},model:{value:e.formData.lr_sass_dataschema_f_Field,callback:function(a){e.$set(e.formData,"lr_sass_dataschema_f_Field",a)},expression:"formData.lr_sass_dataschema_f_Field"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("关联表"),prop:"lr_sass_dataschema_f_RTable"}},[t("el-input",{attrs:{readonly:"readonly"},model:{value:e.formData.lr_sass_dataschema_f_RTable,callback:function(a){e.$set(e.formData,"lr_sass_dataschema_f_RTable",a)},expression:"formData.lr_sass_dataschema_f_RTable"}},[t("span",{attrs:{slot:"append"},on:{click:function(a){return e.handleAddTable("lr_sass_dataschema_f_RTable",!0)}},slot:"append"},[t("el-button",{attrs:{slot:"append",icon:"el-icon-more"},slot:"append"})],1)])],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("关联表字段"),prop:"lr_sass_dataschema_f_RField"}},[t("l-select",{attrs:{options:e.rfieldOptions},model:{value:e.formData.lr_sass_dataschema_f_RField,callback:function(a){e.$set(e.formData,"lr_sass_dataschema_f_RField",a)},expression:"formData.lr_sass_dataschema_f_RField"}})],1)],1)]:e._e(),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("排序"),prop:"lr_sass_dataschema_f_Sort"}},[t("el-input-number",{attrs:{controlsPosition:"default",placeholder:e.$t("请输入")},model:{value:e.formData.lr_sass_dataschema_f_Sort,callback:function(a){e.$set(e.formData,"lr_sass_dataschema_f_Sort",a)},expression:"formData.lr_sass_dataschema_f_Sort"}})],1)],1)],2)],1)]},proxy:!0}])},[t("div",{staticClass:"l-rblock pd-8",staticStyle:{"padding-bottom":"0"}},[t("div",{staticClass:"l-auto-window"},[t("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(a){e.activeName=a},expression:"activeName"}},[t("el-tab-pane",{staticClass:"l-tabs-container",attrs:{label:e.$t("数据"),name:"tab0"}},[e.showDataTable?t("l-select-panel",{ref:"dbTableDataTable",attrs:{columns:e.dataColumns,isPage:!0,loadSelectTable:e.loadSelectTable,multiple:!0,model:"client",valueKey:e.pkey},model:{value:e.dataValue,callback:function(a){e.dataValue=a},expression:"dataValue"}}):e._e()],1),t("el-tab-pane",{staticClass:"l-tabs-container",attrs:{label:e.$t("列设置"),name:"tab1"}},[t("l-table",{attrs:{columns:e.columns,dataSource:e.tableColumns},scopedSlots:e._u([{key:"rTable",fn:function(a){return[t("el-input",{attrs:{size:"mini",readonly:"readonly"},model:{value:a.row.rTable,callback:function(t){e.$set(a.row,"rTable",t)},expression:"scope.row.rTable"}},[t("span",{attrs:{slot:"append"},on:{click:function(t){return e.handleSelectTable(a.row,"rTable")}},slot:"append"},[t("el-button",{attrs:{slot:"append",icon:"el-icon-more"},slot:"append"})],1)])]}}])})],1)],1)],1)]),t("l-codetable-selectdialog",{attrs:{visible:e.dbtableSelectdialog,dbCode:e.formData.lr_sass_dataschema_f_DbCode,isOkClose:!1,multiple:!1},on:{"update:visible":function(a){e.dbtableSelectdialog=a},select:e.dbSelect}})],1)},r=[],n=(t("99af"),t("7db0"),t("d81d"),t("b0c0"),t("159b"),t("96cf"),t("1da1")),l=window.$api.sass.dataschema,o=window.$api.data.codeTable,i=window.$api.data.dbTable,c={props:{objectId:String},data:function(){return{moduleCode:"sass_dataschema",activeName:"tab0",formData:{lr_sass_dataschema_f_DbCode:"",lr_sass_dataschema_f_Table:"",lr_sass_dataschema_f_HasRTable:"",lr_sass_dataschema_f_Field:"",lr_sass_dataschema_f_RTable:"",lr_sass_dataschema_f_RField:"",lr_sass_dataschema_f_ParentId:"",lr_sass_dataschema_f_Sort:""},rules:{lr_sass_dataschema_f_DbCode:[{required:!0,message:this.$t("请选择")}],lr_sass_dataschema_f_Table:[{required:!0,message:this.$t("请选择")}],lr_sass_dataschema_f_Field:[{required:!0,message:this.$t("请选择")}],lr_sass_dataschema_f_RTable:[{required:!0,message:this.$t("请选择")}],lr_sass_dataschema_f_RField:[{required:!0,message:this.$t("请选择")}]},columns:[{label:"字段",prop:"name",minWidth:"100"},{label:"描述",prop:"coment",minWidth:"100"},{label:"关联表",prop:"rTable",minWidth:"100"}],dbtableSelectdialog:!1,selectRow:null,tableNameField:"",isNotMain:!1,tableMap:{},dbTableDatas:{},tableColumns:[],showDataTable:!0,dataValue:""}},computed:{fieldOptions:function(){return this.getCols(this.formData.lr_sass_dataschema_f_Table)},rfieldOptions:function(){return console.log("rfieldOptions"),this.getCols(this.formData.lr_sass_dataschema_f_RTable)},layoutTop:function(){return this.formData.lr_sass_dataschema_f_HasRTable?180:132},dataColumns:function(){var e=[];return this.tableColumns.forEach((function(a){e.push({label:a.coment?"".concat(a.name,"(").concat(a.coment,")"):a.name,prop:a.name.toLowerCase(),minWidth:"160"})})),0==e.length&&e.push({label:"",prop:"",minWidth:"160"}),e},pkey:function(){if(0==this.tableColumns.length)return"";var e=this.tableColumns.find((function(e){return e.isPrimary})).name.toLowerCase();return e}},methods:{handleAddTable:function(e,a){this.formData.lr_sass_dataschema_f_DbCode?(this.selectRow=this.formData,this.tableNameField=e,this.isNotMain=a,this.dbtableSelectdialog=!0):this.$message({message:this.$t("请选择数据库"),type:"warning"})},handleSelectTable:function(e,a){this.formData.lr_sass_dataschema_f_DbCode?(this.selectRow=e,this.tableNameField=a,this.isNotMain=!0,this.dbtableSelectdialog=!0):this.$message({message:this.$t("请选择数据库"),type:"warning"})},dbSelect:function(e,a,t){var s=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a(),n=e[0].f_TableName,r.next=4,s.loadCols(n,s.formData.lr_sass_dataschema_f_DbCode);case 4:s.isNotMain||(s.showDataTable=!1,s.tableColumns=s.tableMap[n]||[]),t(),s.$set(s.selectRow,s.tableNameField,n),s.dbtableSelectdialog=!1,s.isNotMain||(s.dataValue="",setTimeout((function(){s.showDataTable=!0,s.$nextTick((function(){s.$refs.dbTableDataTable.init()}))})));case 9:case"end":return r.stop()}}),r)})))()},loadCols:function(e,a){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){var r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.tableMap[e]){s.next=5;break}return s.next=3,t.$awaitWraper(o.getList(a,e));case 3:r=s.sent,r&&(t.tableMap[e]=r[0].lr_db_codecolumnsList.map((function(e){return{id:e.f_DbColumnName,name:e.f_DbColumnName,csType:e.f_CsType,isIdentity:1==e.f_IsIdentity,isPrimary:1==e.f_IsPrimaryKey,isNullable:1==e.f_IsNullable,coment:e.f_Description}})));case 5:case"end":return s.stop()}}),s)})))()},getCols:function(e){if(!e)return[];var a=this.tableMap[e]||[];return a.map((function(e){return{label:e.coment?"".concat(e.name,"(").concat(e.coment,")"):e.name,value:e.name}}))},dbChange:function(){this.tableMap={},this.dbTableDatas={}},loadSelectTable:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var t,s,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t=e.formData.lr_sass_dataschema_f_Table,s=e.formData.lr_sass_dataschema_f_DbCode,t&&s){a.next=4;break}return a.abrupt("return",[]);case 4:if(e.dbTableDatas[t]){a.next=8;break}return a.next=7,e.loaddbTableData(s,t);case 7:e.dbTableDatas[t]=a.sent;case 8:return r=e.dbTableDatas[t],a.abrupt("return",r);case 10:case"end":return a.stop()}}),a)})))()},loaddbTableData:function(e,a){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){var r,n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return r={code:e,tableName:a},s.next=3,t.$awaitWraper(i.getDataList(r));case 3:return n=s.sent,s.abrupt("return",n||[]);case 5:case"end":return s.stop()}}),s)})))()},resetForm:function(){var e=this;this.$formClear(this.$refs.form),this.activeName="tab0",this.tableColumns=[],this.tableMap={},this.dbTableDatas={},setTimeout((function(){e.showDataTable=!0,e.$nextTick((function(){e.$refs.dbTableDataTable.init()}))}))},validateForm:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$formValidateWraper(e.$refs.form);case 2:if(a.sent){a.next=4;break}return a.abrupt("return",!1);case 4:if(0!=e.dataValue.length){a.next=7;break}return e.$message({type:"warning",message:e.$t("请勾选数据")}),a.abrupt("return",!1);case 7:return a.abrupt("return",!0);case 8:case"end":return a.stop()}}),a)})))()},setForm:function(e){var a=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a.showDataTable=!1,s=JSON.parse(e.f_Schema),a.tableColumns=s.columns,a.dataValue=s.data,a.tableMap[e.f_Table]=s.columns,!e.f_RTable){t.next=8;break}return t.next=8,a.loadCols(e.f_RTable,e.f_DbCode);case 8:setTimeout((function(){a.showDataTable=!0,a.$nextTick((function(){a.$refs.dbTableDataTable.init()}))})),a.$setFormData(a.formData,e,"lr_sass_dataschema");case 10:case"end":return t.stop()}}),t)})))()},getForm:function(){var e=this.$getFormData(this.formData,"lr_sass_dataschema");e.f_ObjectId=this.objectId;var a={columns:this.tableColumns,data:this.dataValue};return e.f_Schema=JSON.stringify(a),e},loadFormData:function(e){var a=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=e.keyValue,t.next=3,a.$awaitWraper(l.get(s));case 3:if(r=t.sent,!r){t.next=9;break}return a.setForm(r),t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t)})))()},saveForm:function(e){var a=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var s,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=e.keyValue,r=e.isEdit,n=a.getForm(),!r){t.next=8;break}return t.next=5,a.$awaitWraper(l.update(s,n));case 5:return t.abrupt("return",t.sent);case 8:return n.f_Id=s,t.next=11,a.$awaitWraper(l.add(n));case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),t)})))()}}},d=c,u=t("2877"),m=Object(u["a"])(d,s,r,!1,null,null,null);a["default"]=m.exports},9397:function(e,a,t){"use strict";t.r(a);var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return e.lr_loadPage?e._e():t("l-layout",{staticClass:"l-tab-page"},[t("l-panel",{scopedSlots:e._u([{key:"toolLeft",fn:function(){return[t("div",{staticClass:"l-panel--item"},[t("el-input",{attrs:{placeholder:e.$t("请输入关键字"),size:"mini"},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(a){e.searchWord=a},expression:"searchWord"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[t("l-tool-btns",{attrs:{isAuth:!1,refreshClick:e.handleSearch},on:{click:function(a){return e.handleAdd()}}})]},proxy:!0}],null,!1,274980418)},[t("l-table",{ref:"mainTable",attrs:{loading:e.tableLoading,columns:e.columns,dataSource:e.tableData,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(a){e.tableCurrentPage=a},"update:table-page":function(a){e.tableCurrentPage=a},loadPageData:e.turnTablePage}},[t("l-table-btns",{attrs:{isAuth:!1,btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),t("l-dialog",{attrs:{title:e.$t(e.formTitle),visible:e.formVisible,height:600,width:800},on:{"update:visible":function(a){e.formVisible=a},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[t("my-form",{ref:"form",attrs:{objectId:e.objectId}})],1)],1)},r=[],n=(t("a434"),t("96cf"),t("1da1")),l=t("56ef4"),o=window.$api.sass.dataschema,i={props:{objectId:String},components:{MyForm:l["default"]},data:function(){return{moduleCode:"sass_dataschema",searchWord:"",tableLoading:!1,tableData:[],tableTotal:0,tableCurrentPage:1,tablePageSize:50,columns:[{label:"数据库",prop:"f_DbCode",width:120,align:"left"},{label:"数据表",prop:"f_Table",minWidth:120,align:"left"},{label:"排序字段",prop:"f_Sort",width:120,align:"left"}],tableBtns:[{prop:"Edit",label:"编辑",width:100},{prop:"Delete",label:"删除",width:100}],formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1,formDetails:!1}},computed:{},mounted:function(){},methods:{handleSearch:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.loadTableData();case 2:case"end":return a.stop()}}),a)})))()},turnTablePage:function(e){var a=e.rows;this.tablePageSize=a,this.loadTableData(!0)},loadTableData:function(e){var a=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e||(a.tableCurrentPage=1),a.tableLoading=!0,s={},s.f_ObjectId=a.objectId,s.rows=a.tablePageSize,s.page=a.tableCurrentPage,s.f_Table=a.searchWord,s.sidx="f_Sort",t.next=10,a.$awaitWraper(o.getPage(s));case 10:r=t.sent,null!=r?(a.tableData=r.rows,a.tableTotal=r.records):a.tableData=[],a.tableLoading=!1;case 13:case"end":return t.stop()}}),t)})))()},handleAdd:function(){this.formEdit=!1,this.formDetails=!1,this.handleShowForm("新增")},handleEdit:function(e,a){this.formEdit=!0,this.formDetails=!1,this.formEditRow=a,this.handleShowForm("编辑")},handleDelete:function(e,a){var t=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then(Object(n["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.tableData.splice(e,1),t.tableTotal--,s.next=4,o.remove(a.f_Id);case 4:t.$message({type:"success",message:t.$t("删除成功!")});case 5:case"end":return s.stop()}}),s)})))).catch((function(){t.$message({type:"info",message:t.$t("已取消删除!")})}))},handleSave:function(e,a){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){var r,n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return e("保存数据中..."),s.next=3,t.$refs.form.validateForm();case 3:if(!s.sent){s.next=8;break}return s.next=6,t.$refs.form.saveForm({keyValue:t.formEdit?t.formEditRow.f_Id:"",isEdit:t.formEdit});case 6:r=s.sent,r&&(n=t.formEdit?t.$t("更新成功!"):t.$t("新增成功!"),t.$message({type:"success",message:t.$t(n)}),t.loadTableData(),t.formVisible=!1);case 8:a();case 9:case"end":return s.stop()}}),s)})))()},handleShowForm:function(e){this.formTitle=e,this.formVisible=!0},handleOpenedForm:function(e,a){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(!t.formEdit){s.next=5;break}return e("加载数据中..."),s.next=4,t.$refs.form.loadFormData({keyValue:t.formEditRow.f_Id});case 4:a();case 5:case"end":return s.stop()}}),s)})))()},handleCloseForm:function(){this.$refs.form.resetForm()}}},c=i,d=t("2877"),u=Object(d["a"])(c,s,r,!1,null,null,null);a["default"]=u.exports}}]);