"use strict";(self["webpackChunkele_admin_template"]=self["webpackChunkele_admin_template"]||[]).push([[1258,1762],{40705:function(e,t,o){o.d(t,{F:function(){return s},z:function(){return l}});o(88919);var i=o(80462);async function s(e){const t=await i.A.get("https://cdn.eleadmin.com/20200610/document.json",{params:e});return 0===t.data.code?t.data.data:Promise.reject(new Error(t.data.message))}async function l(e){const t=await i.A.get("https://cdn.eleadmin.com/20200610/archive.json",{params:e});return 0===t.data.code?t.data.data:Promise.reject(new Error(t.data.message))}},21762:function(e,t,o){o.r(t),o.d(t,{default:function(){return h}});var i=function(){var e=this,t=e._self._c;return t("ele-modal",{attrs:{top:"5vh",width:"1100px",visible:e.visible,title:"卷内文件调整","custom-class":"demo-file-sort-dialog"},on:{"update:visible":e.updateVisible}},[t("el-row",{attrs:{gutter:15}},[t("el-col",{attrs:{md:8}},[t("ele-pro-table",{ref:"docTable",staticClass:"demo-file-sort-table",attrs:{"sub-title":"案卷列表",datasource:e.documents,columns:e.columns1,"highlight-current-row":"",height:"400px",toolkit:[],"need-page":!1,current:e.current,"tool-style":{lineHeight:"28px"}},on:{"update:current":function(t){e.current=t},done:e.onDocTbDone}})],1),t("el-col",{attrs:{md:8}},[t("ele-pro-table",{ref:"fileTable",attrs:{loading:e.loading,"sub-title":"卷内列表",datasource:e.data1,columns:e.columns2,height:"400px",selection:e.selection1,"need-page":!1,toolkit:[]},on:{"update:selection":function(t){e.selection1=t}}},[t("template",{slot:"toolkit"},[t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top",size:"mini"},on:{click:e.moveUp}},[e._v(" 上移 ")]),t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-bottom",size:"mini"},on:{click:e.moveDown}},[e._v(" 下移 ")]),t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top-right",size:"mini"},on:{click:e.moveOut}},[e._v(" 调出 ")])],1)],2)],1),t("el-col",{attrs:{md:8}},[t("ele-pro-table",{attrs:{loading:e.loading,"sub-title":"未归档列表",datasource:e.data2,columns:e.columns2,height:"400px",selection:e.selection2,"need-page":!1,toolkit:[]},on:{"update:selection":function(t){e.selection2=t}}},[t("template",{slot:"toolkit"},[t("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top-left",size:"mini"},on:{click:e.moveIn}},[e._v(" 调入 ")])],1)],2)],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.close}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)],1)},s=[],l=(o(98729),o(45791),o(13810),o(58607),o(40705)),n={name:"FileSort",props:{visible:Boolean,documents:{type:Array,required:!0}},data(){return{loading:!0,columns1:[{prop:"title",label:"案卷题名",width:110,showOverflowTooltip:!0},{prop:"piece_no",label:"案卷档号",showOverflowTooltip:!0}],columns2:[{columnKey:"selection",type:"selection",width:45,align:"center"},{prop:"title",label:"文件题名",width:110,showOverflowTooltip:!0},{prop:"archive_no",label:"文件档号",showOverflowTooltip:!0}],data:[],current:null,selection1:[],selection2:[]}},computed:{data1(){return this.current?this.data.filter((e=>e.piece_no===this.current.piece_no)):[]},data2(){return this.data.filter((e=>!e.piece_no))}},methods:{onDocTbDone(){this.documents.length&&this.$refs.docTable.setCurrentRow(this.documents[0])},query(){this.loading=!0,(0,l.z)({pieceNoIn:this.documents.map((e=>e.piece_no))}).then((e=>{this.loading=!1,this.data=e})).catch((e=>{this.loading=!1,this.$message.error(e.message)}))},moveUp(){if(!this.selection1.length)return void this.$message.error("请选择一条数据");if(this.selection1.length>1)return void this.$message.error("只能选择一条数据");if(0===this.data1.indexOf(this.selection1[0]))return;const e=this.data.indexOf(this.selection1[0]),t=this.data[e-1];this.$set(this.data,e-1,this.selection1[0]),this.$set(this.data,e,t),this.$nextTick((()=>{this.$refs.fileTable.toggleRowSelection(this.data[e-1],!0)}))},moveDown(){if(!this.selection1.length)return void this.$message.error("请选择一条数据");if(this.selection1.length>1)return void this.$message.error("只能选择一条数据");if(this.data1.indexOf(this.selection1[0])===this.data1.length-1)return;const e=this.data.indexOf(this.selection1[0]),t=this.data[e+1];this.$set(this.data,e+1,this.selection1[0]),this.$set(this.data,e,t),this.$nextTick((()=>{this.$refs.fileTable.toggleRowSelection(this.data[e+1],!0)}))},moveOut(){this.selection1.length?this.selection1.forEach((e=>{e.piece_no=""})):this.$message.error("请至少选择一条数据")},moveIn(){this.current&&(this.selection2.length?this.selection2.forEach((e=>{e.piece_no=this.current.piece_no})):this.$message.error("请至少选择一条数据"))},save(){const e=this.data.map((e=>({archive_no:e.archive_no,piece_no:e.piece_no})));console.log(e),this.updateVisible(!1)},close(){this.updateVisible(!1)},updateVisible(e){this.$emit("update:visible",e)}},watch:{visible(e){e?this.query():this.data=[]}}},a=n,r=o(64008),c=(0,r.A)(a,i,s,!1,null,null,null),h=c.exports},41258:function(e,t,o){o.r(t),o.d(t,{default:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ele-body"},[t("el-card",{attrs:{shadow:"never"}},[t("ele-pro-table",{ref:"table",attrs:{title:"案卷列表",columns:e.columns,datasource:e.datasource,selection:e.selection},on:{"update:selection":function(t){e.selection=t}}},[t("template",{slot:"toolbar"},[t("el-button",{staticClass:"ele-btn-icon hidden-md-and-up",attrs:{size:"small",type:"primary",icon:"el-icon-sort"},on:{click:e.openFileSortDialog}},[e._v(" 卷内文件调整 ")])],1),t("template",{slot:"toolkit"},[t("el-button",{staticClass:"ele-btn-icon hidden-sm-and-down",attrs:{size:"small",type:"primary",icon:"el-icon-sort"},on:{click:e.openFileSortDialog}},[e._v(" 卷内文件调整 ")])],1)],2)],1),t("file-sort",{attrs:{visible:e.showFileSort,documents:e.fileSortChoose},on:{"update:visible":function(t){e.showFileSort=t}}})],1)},s=[],l=o(21762),n=o(40705),a={name:"ExampleDocument",components:{FileSort:l["default"]},data(){return{columns:[{columnKey:"selection",type:"selection",width:45,align:"center",fixed:"left"},{columnKey:"index",type:"index",width:45,align:"center",fixed:"left"},{prop:"piece_no",label:"案卷档号",width:215,minWidth:110,showOverflowTooltip:!0},{prop:"title",label:"案卷题名",minWidth:110,showOverflowTooltip:!0},{prop:"year",label:"年度",minWidth:110,showOverflowTooltip:!0},{prop:"retention",label:"保管期限",minWidth:110,showOverflowTooltip:!0},{prop:"secret",label:"密级",minWidth:110,showOverflowTooltip:!0},{prop:"type",label:"档案类别",minWidth:110,showOverflowTooltip:!0},{prop:"carrier",label:"载体规格",minWidth:110,showOverflowTooltip:!0}],showFileSort:!1,selection:[],fileSortChoose:[]}},methods:{datasource({page:e,limit:t,where:o,order:i}){return(0,n.F)({...o,...i,page:e,limit:t})},openFileSortDialog(){this.selection.length<2?this.$message.error("请至少选择两条数据"):(this.fileSortChoose=this.$refs.table.tableData.slice(0,3),this.showFileSort=!0)}}},r=a,c=o(64008),h=(0,c.A)(r,i,s,!1,null,null,null),d=h.exports}}]);