(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-dbsource-index"],{"15d3":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page",scopedSlots:e._u([{key:"left",fn:function(){return[a("l-panel",{staticStyle:{"padding-right":"0"},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.$t("分类目录"))+" "),e.lr_hasPageAuth("classifysSetting","buttons")?a("div",{staticClass:"tree-setting-btn"},[a("el-tooltip",{attrs:{effect:"dark",content:e.$t("分类管理"),placement:"top"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-setting"},on:{click:e.handleSettingClick}})],1)],1):e._e()]},proxy:!0}],null,!1,1135649178)},[a("el-tree",{staticClass:"learun-tree",attrs:{"default-expand-all":"",data:e.dataItemTree_DatasourceType},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node;return a("span",{staticClass:"lr-tree-node"},[a("i",{staticClass:"el-icon-notebook-2"}),e._v(" "+e._s(e.$t(r.label))+" ")])}}],null,!1,2371071473)})],1)]},proxy:!0}],null,!1,807162499)},[a("l-panel",{staticStyle:{"padding-left":"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入要查询关键字"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search",loading:e.tableLoading},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{attrs:{hasAdd:!1}},[a("el-dropdown",{attrs:{size:"mini","split-button":"",type:"primary"},on:{command:e.handleCommand,click:function(t){return e.handleCommand("sql")}}},[e._v(" "+e._s(e.$t("新增SQL视图"))+" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"table"}},[e._v(" "+e._s(e.$t("表视图"))+" ")]),a("el-dropdown-item",{attrs:{command:"code"}},[e._v(" "+e._s(e.$t("JS脚本视图"))+" ")])],1)],1),a("l-excel-btns")],1)]},proxy:!0}],null,!1,73939437)},[a("l-table",{attrs:{columns:e.lr_getPageColumns(e.columns),dataSource:e.tableData,loading:e.tableLoading,"row-key":"f_Id",isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_Type",fn:function(t){return["1"==t.row.f_Type?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(e.$t("表")))]):"2"==t.row.f_Type?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v(e._s(e.$t("JS")))]):a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.$t("SQL")))])]}}],null,!1,2867665496)},[a("l-table-btns",{attrs:{filterBtns:e.filterBtns,btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-fullscreen-dialog",{attrs:{title:e.formSqlViewTitle,visible:e.formSqlViewVisible},on:{"update:visible":function(t){e.formSqlViewVisible=t},ok:e.handleFormSqlViewSave,close:e.handleFormSqlViewClose,opened:e.handleFormSqlViewOpened}},[a("form-sql-view",{ref:"formSqlView"})],1),a("l-fullscreen-dialog",{attrs:{title:e.formTableViewTitle,visible:e.formTableViewVisible},on:{"update:visible":function(t){e.formTableViewVisible=t},ok:e.handleFormTableViewSave,close:e.handleFormTableViewClose,opened:e.handleFormTableViewOpened}},[a("form-table-view",{ref:"formTableView"})],1),a("l-fullscreen-dialog",{attrs:{title:e.formCodeViewTitle,visible:e.formCodeViewVisible},on:{"update:visible":function(t){e.formCodeViewVisible=t},ok:e.handleFormCodeViewSave,close:e.handleFormCodeViewClose,opened:e.handleFormCodeViewOpened}},[a("form-code-view",{ref:"formCodeView"})],1),a("l-drawer",{attrs:{title:e.$t("查看数据源数据")+"-"+e.name,visible:e.lookVisible,showOk:!1,showClose:!1,width:800},on:{"update:visible":function(t){e.lookVisible=t},close:e.handleCloseLookForm,opened:e.handleOpenedLookForm}},[a("look-form",{ref:"lookForm",attrs:{code:e.code}})],1),a("l-drawer",{attrs:{title:e.$t("分类管理"),visible:e.classifysVisible,showOk:!1,showClose:!1,size:"800px"},on:{"update:visible":function(t){e.classifysVisible=t}}},[a("l-dataitem-index",{attrs:{classifyCode:"datasourceType"}})],1)],1)},n=[],i=(a("99af"),a("b0c0"),a("96cf"),a("1da1")),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.ready?a("l-layout",{staticClass:"l-tab-page"},[a("l-panel",{staticStyle:{padding:"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("l-select",{attrs:{size:"mini",options:e.columnOptions},model:{value:e.field,callback:function(t){e.field=t},expression:"field"}})],1),a("div",{staticClass:"l-panel--item",staticStyle:{width:"320px"}},[a("el-input",{attrs:{placeholder:e.$t("请输入查询关键字"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[a("el-button",{attrs:{slot:"append",loading:e.tableLoading,icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0}],null,!1,4035510283)},[a("div",{staticClass:"l-rblock"},[a("l-table",{ref:"mainTable",attrs:{columns:e.columns,dataSource:e.tableData,loading:e.tableLoading,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage}})],1)])],1):e._e()},s=[],l=(a("7db0"),a("159b"),window.$api.data.dbsource),c={props:{code:String},data:function(){return{field:"",keyword:"",tableData:[],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1,columns:[],ready:!1}},created:function(){},mounted:function(){},computed:{columnOptions:function(){var e=this,t=[];return this.columns.forEach((function(a){t.push({label:e.getColNames(a),value:a.prop})})),t}},methods:{init:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.ready=!1,t.next=3,e.loadTableData();case 3:e.ready=!0;case 4:case"end":return t.stop()}}),t)})))()},getColNames:function(e){var t=e.prop,a=e.label,r=t;return t!=a&&(r="".concat(t,"(").concat(a,")")),r},loadTableData:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e||(t.tableCurrentPage=1),t.tableLoading=!0,r="",t.keyword&&t.field&&(n=t.columns.find((function(e){return e.prop==t.field})),r="string"==n.csType.toLowerCase()?"".concat(t.field," like '%").concat(t.keyword,"%'"):"".concat(t.field," = ").concat(t.keyword)),i={rows:t.tablePageSize,page:t.tableCurrentPage,whereSql:r},a.next=7,t.$awaitWraper(l.getDataPage(t.code,i));case 7:o=a.sent,o?(t.columns=o.cols,t.tableData=o.rows,t.tableTotal=o.records):(t.columns=[],t.tableData=[],t.tableTotal=[]),t.tableLoading=!1;case 10:case"end":return a.stop()}}),a)})))()},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},hanleSearch:function(){this.loadTableData()},resetForm:function(){this.keyword="",this.field="",this.tableData=[]}}},u=c,d=a("2877"),f=Object(d["a"])(u,o,s,!1,null,null,null),p=f.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-rblock l-tab-page view-page"},[a("l-layout",{staticClass:"l-tab-page",attrs:{bottom:300},scopedSlots:e._u([{key:"bottom",fn:function(){return[e.tableColumns.length>0?a("div",{staticClass:"l-rblock"},[a("l-table",{ref:"mainTable",attrs:{columns:e.tableColumns,dataSource:e.tableData,loading:e.tableLoading,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage}})],1):e._e()]},proxy:!0}])},[a("div",{class:["l-auto-window",{"only-tabs":1==e.sqls.length}],staticStyle:{"background-color":"#fff",padding:"4px","padding-bottom":"0"}},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClickTab,edit:e.removeChildSql},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.sqls,(function(t,r){return a("el-tab-pane",{key:r,staticClass:"flex flex-column",staticStyle:{overflow:"hidden"},attrs:{label:t.label,name:""+r,closable:2==t.type}},[a("div",{staticClass:"top-panel"},[a("div",{staticClass:"top-panel__item"},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini",placeholder:e.$t("请选择数据库")},model:{value:t.dbCode,callback:function(a){e.$set(t,"dbCode",a)},expression:"item.dbCode"}},e._l(e.lr_dblinkTree,(function(t){return a("el-option-group",{key:t.id,attrs:{label:t.label}},e._l(t.children,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)})),1)],1),2==t.type?a("div",{staticClass:"top-panel__item"},[a("el-input",{attrs:{size:"mini",placeholder:e.$t("用与主查询条件的参数名")},model:{value:t.paramName,callback:function(a){e.$set(t,"paramName",a)},expression:"item.paramName"}})],1):e._e(),a("div",[a("el-tooltip",{attrs:{content:e.$t("查询"),enterable:!1,placement:"bottom"}},[a("el-button",{staticClass:"learun-text-btn",attrs:{type:"text",icon:"learun-icon-play-base"},on:{click:e.loadTableData}})],1)],1),a("div",[a("el-tooltip",{attrs:{content:e.$t("美化"),enterable:!1,placement:"bottom"}},[a("el-button",{staticClass:"learun-text-btn",attrs:{type:"text",icon:"el-icon-magic-stick"},on:{click:e.handleFormatter}})],1)],1),a("div",{staticClass:"right-btn"},[a("el-tooltip",{attrs:{content:e.$t("添加子查询参数"),enterable:!1,placement:"bottom"}},[a("el-button",{staticClass:"learun-text-btn",attrs:{type:"text",icon:"learun-icon-add"},on:{click:e.addChildSql}})],1)],1)]),a("div",{staticClass:"l-rblock",staticStyle:{"padding-bottom":"30px"}},[""+r==e.activeName?a("l-code-mirror",{ref:"codeMirror"+r,refInFor:!0,attrs:{mode:"text/x-sql"},model:{value:t.sql,callback:function(a){e.$set(t,"sql",a)},expression:"item.sql"}}):e._e()],1)])})),1)],1)]),a("div",{class:["info-wraper",{opened:e.infoWraperOpen}]},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:"info"==e.infoWraperOpenType,expression:"infoWraperOpenType == 'info'"}],ref:"form",staticStyle:{padding:"10px 10px 0 10px"},attrs:{model:e.formData,rules:e.rules,size:"mini"}},[a("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_Name"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.f_Name,callback:function(t){e.$set(e.formData,"f_Name",t)},expression:"formData.f_Name"}})],1),a("el-form-item",{attrs:{label:e.$t("编码"),prop:"f_Code"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.f_Code,callback:function(t){e.$set(e.formData,"f_Code",t)},expression:"formData.f_Code"}})],1),a("el-form-item",{attrs:{label:e.$t("分类"),prop:"f_Category"}},[a("l-tree-select",{attrs:{options:e.lr_dataItemTree(e.lr_dataItem["datasourceType"])},model:{value:e.formData.f_Category,callback:function(t){e.$set(e.formData,"f_Category",t)},expression:"formData.f_Category"}})],1),a("el-form-item",{attrs:{label:e.$t("备注"),prop:"f_Description"}},[a("el-input",{attrs:{type:"textarea",rows:"6"},model:{value:e.formData.f_Description,callback:function(t){e.$set(e.formData,"f_Description",t)},expression:"formData.f_Description"}})],1)],1),"order"==e.infoWraperOpenType?[e.orders.length>0?a("el-form",{staticStyle:{padding:"10px 10px 0 10px"},attrs:{size:"mini"}},e._l(e.orders,(function(t,r){return a("div",{key:r,staticClass:"learun-row-form-input"},[a("el-form-item",{staticStyle:{"margin-bottom":"8px"},attrs:{label:e.$t("字段")}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync},model:{value:t.field,callback:function(a){e.$set(t,"field",a)},expression:"item.field"}})],1),a("el-form-item",{staticStyle:{"margin-bottom":"8px"},attrs:{label:e.$t("倒序")}},[a("el-switch",{model:{value:t.isDESC,callback:function(a){e.$set(t,"isDESC",a)},expression:"item.isDESC"}})],1),a("el-button",{staticClass:"learun-row-form-input-delete",attrs:{title:e.$t("删除"),circle:"",plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.handleRemoveOrder(r)}}},[a("i",{staticClass:"el-icon-close"})])],1)})),0):e._e(),e.orders.length>0?a("div",{staticClass:"mt-8",staticStyle:{"padding-left":"10px"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleAddOrder}},[e._v(e._s(e.$t("添加排序字段")))])],1):a("div",{staticClass:"learun-empty"},[a("el-empty",{attrs:{description:e.$t("还没有添加排序字段")}}),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleAddOrder}},[e._v(e._s(e.$t("添加一个")))])],1)]:"field"==e.infoWraperOpenType?[e.columns.length>0?a("div",{staticStyle:{padding:"10px"}},e._l(e.columns,(function(t){return a("div",{key:t.prop,staticClass:"field-row"},[a("div",{class:["field-row-header",e.getTypeClass(t)]},[e._v(" "+e._s(e.getTypeName(t))+" ")]),a("div",{staticClass:"field-row-content"},[e._v(e._s(e.getColNames(t)))])])})),0):a("div",{staticClass:"learun-empty"},[a("el-empty",{attrs:{description:e.$t("暂无字段信息,请在左侧选择数据表")}})],1)]:e._e()],2),a("div",{staticClass:"right-side"},[a("div",{class:["vertical-btn",{opened:"info"==e.infoWraperOpenType}],on:{click:function(t){return e.handleClickRightSideBtn("info")}}},[e._v(" "+e._s(e.$t("基础信息"))+" ")]),a("div",{class:["vertical-btn",{opened:"order"==e.infoWraperOpenType}],on:{click:function(t){return e.handleClickRightSideBtn("order")}}},[e._v(" "+e._s(e.$t("排序字段"))+" ")]),a("div",{class:["vertical-btn",{opened:"field"==e.infoWraperOpenType}],on:{click:function(t){return e.handleClickRightSideBtn("field")}}},[e._v(" "+e._s(e.$t("字段信息"))+" ")])])],1)},b=[],h=(a("4de4"),a("c740"),a("d81d"),a("a434"),a("5530")),g=window.$api.data.dbsource,_={data:function(){var e=this;return{activeName:"0",infoWraperOpen:!0,infoWraperOpenType:"info",tableMap:{},formData:{f_Name:"",f_Code:"",f_Category:"",f_Description:""},rules:{f_Name:[{required:!0,message:"请输入"}],f_Category:[{required:!0,message:"请选择"}],f_Code:[{required:!0,message:"请输入"},{validator:this.lr_existDbFiled,keyValue:function(){return e.formData.f_Id},tableName:"lr_base_datasource",keyName:"f_Id",trigger:"null"}]},sqls:[{label:this.$t("主查询"),sql:"",dbCode:"lrsystemdb"}],orders:[],columns:[],tableLoading:!1,tables:{},tableColumns:[],tableData:[],tableTotal:0,tablePageSize:50,tableCurrentPage:1}},created:function(){this.lr_loadDblink()},computed:{currentConfig:function(){return this.sqls[parseInt(this.activeName)]}},methods:{handleClickRightSideBtn:function(e){this.infoWraperOpenType!=e?(this.infoWraperOpenType=e,this.infoWraperOpen=!0):(this.infoWraperOpenType="",this.infoWraperOpen=!1)},handleFormatter:function(){var e="codeMirror".concat(this.activeName);this.$refs[e][0].sqlFormatter()},addChildSql:function(){var e={id:this.$uuid(),label:this.$t("子查询"),sql:"",dbCode:"lrsystemdb",type:"2",paramName:""};this.sqls.push(e),this.activeName="".concat(this.sqls.length-1);var t={tableColumns:[],tableData:[],tableTotal:0,tablePageSize:50,tableCurrentPage:1};this.setTable(t)},removeChildSql:function(e,t){var a=this;"remove"===t&&this.$confirm(this.$t("是否删除该子查询?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){var t=a.sqls[e].id;a.sqls.splice(e,1),delete a.tables[t],a.activeName="0",a.setTable(a.tables[a.sqls[0].id||"main"])})).catch((function(){}))},handleClickTab:function(){var e=this.sqls[parseInt(this.activeName)].id||"main";this.setTable(this.tables[e]||{tableColumns:[],tableData:[],tableTotal:0,tablePageSize:50,tableCurrentPage:1})},validateSqls:function(e){for(var t=0,a=e.length;t<a;t++){var r=e[t],n=r.sql,i=r.type,o=r.paramName,s=r.label,l=r.dbCode;if(!l)return this.$message({type:"error",message:"".concat(this.$t("请选择")).concat(s).concat(this.$t("的数据库"))}),!1;if(!n)return this.$message({type:"error",message:"".concat(this.$t("请填写")).concat(s).concat(this.$t("的sql语句"))}),!1;if("2"==i&&e.length>1&&!o)return this.$message({type:"error",message:"".concat(this.$t("请填写")).concat(s).concat(this.$t("的参数名"))}),!1}return!0},loadTableData:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r="0"==t.activeName?t.sqls:[t.sqls[parseInt(t.activeName)]],t.validateSqls(r)){a.next=3;break}return a.abrupt("return");case 3:return e||(t.tableCurrentPage=1),t.tableLoading=!0,n={rows:t.tablePageSize,page:t.tableCurrentPage},a.next=8,t.$awaitWraper(g.getViewPageByEntity(n,{f_DbId:"learun_view",f_Sql:t.getSettingJson(r)}));case 8:i=a.sent,i?(t.setColumns(i.cols.map((function(e){return Object(h["a"])(Object(h["a"])({},e),{},{minWidth:10*e.label.length})}))),t.tableData=i.rows,t.tableTotal=i.records):(t.setColumns([]),t.tableData=[],t.tableTotal=[]),o={tableColumns:t.tableColumns,tableData:t.tableData,tableTotal:t.tableTotal,tablePageSize:t.tablePageSize,tableCurrentPage:t.tableCurrentPage},t.tables[r[0].id||"main"]=o,t.tableLoading=!1;case 13:case"end":return a.stop()}}),a)})))()},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},setColumns:function(e){"0"==this.activeName&&(this.columns=e),this.tableColumns=e,this.$refs.mainTable&&this.$refs.mainTable.doLayout()},setTable:function(e){this.tableColumns=e.tableColumns,this.$refs.mainTable&&this.$refs.mainTable.doLayout(),this.tableData=e.tableData,this.tableTotal=e.tableTotal,this.tablePageSize=e.tablePageSize,this.tableCurrentPage=e.tableCurrentPage},getSettingJson:function(e){var t={orders:this.$deepClone(this.orders),type:"sql",sqls:e,columns:this.columns.map((function(e){return{prop:e.prop,label:e.label,csType:e.csType}}))};return this.lr_AESEncrypt(JSON.stringify(t),"learun")},handleAddOrder:function(){this.orders.push({field:"",isDESC:!1})},handleRemoveOrder:function(e){this.orders.splice(e,1)},querySearchAsync:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=a.columns,i=e?n.filter((function(t){return-1!=t.prop.indexOf(e)||-1!=t.label.indexOf(e)})):n,t(i.map((function(e){return{value:a.getColNames(e)}})));case 3:case"end":return r.stop()}}),r)})))()},getColNames:function(e){var t=e.prop,a=e.label,r=t;return t!=a&&(r="".concat(t,"(").concat(a,")")),r},getTypeClass:function(e){var t=e.csType;switch(t.toLowerCase()){case"string":case"text":return"str";case"int":case"int64":case"int32":case"int16":case"long":case"short":case"decimal":case"double":case"float":return"num";case"datetime":return"date";case"bool":return"bool";default:return""}},getTypeName:function(e){var t=e.csType;switch(t.toLowerCase()){case"string":case"text":return"字符";case"int":case"int64":case"int32":case"int16":case"long":case"short":case"decimal":case"double":case"float":return"数字";case"datetime":return"日期";case"bool":return"布尔";default:return t}},resetForm:function(){this.formData.f_Id="",this.orders=[],this.sqls=[{label:this.$t("主查询"),sql:"",dbCode:"lrsystemdb"}],this.$formClear(this.$refs.form),this.infoWraperOpenType="info",this.infoWraperOpen=!0,this.tableData=[],this.columns=[];var e={tableColumns:[],tableData:[],tableTotal:0,tablePageSize:50,tableCurrentPage:1};this.setTable(e),this.$refs.mainTable&&this.$refs.mainTable.doLayout()},validateForm:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$formValidateWraper(e.$refs.form);case 2:if(a=t.sent,!a){t.next=16;break}if(!(e.orders.findIndex((function(e){return!e.field}))>-1)){t.next=7;break}return e.$message({type:"error",message:e.$t("请完善排序字段设置")}),t.abrupt("return",!1);case 7:if(e.validateSqls(e.sqls)){t.next=9;break}return t.abrupt("return",!1);case 9:return t.next=11,e.$awaitWraper(g.getViewPageByEntity({rows:1,page:1},{f_DbId:"learun_view",f_Sql:e.getSettingJson(e.sqls)}));case 11:if(r=t.sent,r){t.next=14;break}return t.abrupt("return",!1);case 14:return e.columns=r.cols,t.abrupt("return",!0);case 16:return t.abrupt("return",!1);case 17:case"end":return t.stop()}}),t)})))()},setForm:function(e){if(this.formData={f_Id:e.f_Id,f_Name:e.f_Name,f_Code:e.f_Code,f_Category:e.f_Category,f_Description:e.f_Description},"learun_view"==e.f_DbId||"learun_new_data"==e.f_DbId){var t=JSON.parse(e.f_Sql),a=t.orders,r=t.sqls,n=t.columns;this.orders=a,this.columns=n||[],console.log(r,"sqls"),this.sqls=r.filter((function(e){return"1"!=e.type&&!(e.relations&&e.relations.length>0)}))}else this.sqls[0].sql=e.f_Sql,this.sqls[0].dbCode=e.f_DbId;this.loadTableData()},getForm:function(){var e={f_Name:this.formData.f_Name,f_Code:this.formData.f_Code,f_Category:this.formData.f_Category,f_Description:this.formData.f_Description,f_DbId:"learun_view",f_Type:0,f_Sql:this.getSettingJson(this.sqls)};return e}}},y=_,v=(a("d5a0"),Object(d["a"])(y,m,b,!1,null,"6ec681c7",null)),C=v.exports,w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-rblock l-tab-page view-page"},[a("l-layout",{staticClass:"l-tab-page",attrs:{top:44,topMove:!1},scopedSlots:e._u([{key:"top",fn:function(){return[a("div",{staticClass:"top-panel"},[a("div",{staticClass:"top-panel__item"},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini",placeholder:e.$t("请选择数据库")},model:{value:e.currentConfig.dbCode,callback:function(t){e.$set(e.currentConfig,"dbCode",t)},expression:"currentConfig.dbCode"}},e._l(e.lr_dblinkTree,(function(t){return a("el-option-group",{key:t.id,attrs:{label:t.label}},e._l(t.children,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)})),1)],1),a("div",{staticClass:"top-panel__item",staticStyle:{width:"240px"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("请选择表"),readonly:"readonly",size:"mini"},model:{value:e.currentConfig.dbTable,callback:function(t){e.$set(e.currentConfig,"dbTable",t)},expression:"currentConfig.dbTable"}},[a("span",{attrs:{slot:"append"},on:{click:e.handleAddTable},slot:"append"},[a("el-button",{attrs:{slot:"append",icon:"el-icon-more"},slot:"append"})],1)])],1),a("div",[a("el-tooltip",{attrs:{content:e.$t("查询"),enterable:!1,placement:"bottom"}},[a("el-button",{staticClass:"learun-text-btn",attrs:{type:"text",icon:"learun-icon-play-base",loading:e.tableLoading},on:{click:e.loadTableData}})],1)],1)])]},proxy:!0}])},[a("div",{staticClass:"l-rblock"},[a("l-table",{ref:"mainTable",attrs:{columns:e.columns,dataSource:e.tableData,loading:e.tableLoading,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage}})],1)]),a("div",{class:["info-wraper",{opened:e.infoWraperOpen}]},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:"info"==e.infoWraperOpenType,expression:"infoWraperOpenType == 'info'"}],ref:"form",staticStyle:{padding:"10px 10px 0 10px"},attrs:{model:e.formData,rules:e.rules,size:"mini"}},[a("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_Name"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.f_Name,callback:function(t){e.$set(e.formData,"f_Name",t)},expression:"formData.f_Name"}})],1),a("el-form-item",{attrs:{label:e.$t("编码"),prop:"f_Code"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.f_Code,callback:function(t){e.$set(e.formData,"f_Code",t)},expression:"formData.f_Code"}})],1),a("el-form-item",{attrs:{label:e.$t("分类"),prop:"f_Category"}},[a("l-tree-select",{attrs:{options:e.lr_dataItemTree(e.lr_dataItem["datasourceType"])},model:{value:e.formData.f_Category,callback:function(t){e.$set(e.formData,"f_Category",t)},expression:"formData.f_Category"}})],1),a("el-form-item",{attrs:{label:e.$t("备注"),prop:"f_Description"}},[a("el-input",{attrs:{type:"textarea",rows:"6"},model:{value:e.formData.f_Description,callback:function(t){e.$set(e.formData,"f_Description",t)},expression:"formData.f_Description"}})],1)],1),"order"==e.infoWraperOpenType?[e.orders.length>0?a("el-form",{staticStyle:{padding:"10px 10px 0 10px"},attrs:{size:"mini"}},e._l(e.orders,(function(t,r){return a("div",{key:r,staticClass:"learun-row-form-input"},[a("el-form-item",{staticStyle:{"margin-bottom":"8px"},attrs:{label:e.$t("字段")}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync},model:{value:t.field,callback:function(a){e.$set(t,"field",a)},expression:"item.field"}})],1),a("el-form-item",{staticStyle:{"margin-bottom":"8px"},attrs:{label:e.$t("倒序")}},[a("el-switch",{model:{value:t.isDESC,callback:function(a){e.$set(t,"isDESC",a)},expression:"item.isDESC"}})],1),a("el-button",{staticClass:"learun-row-form-input-delete",attrs:{title:e.$t("删除"),circle:"",plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.handleRemoveOrder(r)}}},[a("i",{staticClass:"el-icon-close"})])],1)})),0):e._e(),e.orders.length>0?a("div",{staticClass:"mt-8",staticStyle:{"padding-left":"10px"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleAddOrder}},[e._v(e._s(e.$t("添加排序字段")))])],1):a("div",{staticClass:"learun-empty"},[a("el-empty",{attrs:{description:e.$t("还没有添加排序字段")}}),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleAddOrder}},[e._v(e._s(e.$t("添加一个")))])],1)]:"field"==e.infoWraperOpenType?[e.columns.length>0?a("div",{staticStyle:{padding:"10px"}},e._l(e.columns,(function(t){return a("div",{key:t.prop,staticClass:"field-row"},[a("div",{class:["field-row-header",e.getTypeClass(t)]},[e._v(" "+e._s(e.getTypeName(t))+" ")]),a("div",{staticClass:"field-row-content"},[e._v(e._s(e.getColNames(t)))])])})),0):a("div",{staticClass:"learun-empty"},[a("el-empty",{attrs:{description:e.$t("暂无字段信息,请在左侧选择数据表")}})],1)]:e._e()],2),a("div",{staticClass:"right-side"},[a("div",{class:["vertical-btn",{opened:"info"==e.infoWraperOpenType}],on:{click:function(t){return e.handleClickRightSideBtn("info")}}},[e._v(" "+e._s(e.$t("基础信息"))+" ")]),a("div",{class:["vertical-btn",{opened:"order"==e.infoWraperOpenType}],on:{click:function(t){return e.handleClickRightSideBtn("order")}}},[e._v(" "+e._s(e.$t("排序字段"))+" ")]),a("div",{class:["vertical-btn",{opened:"field"==e.infoWraperOpenType}],on:{click:function(t){return e.handleClickRightSideBtn("field")}}},[e._v(" "+e._s(e.$t("字段信息"))+" ")])]),a("l-codetable-selectdialog",{attrs:{visible:e.dbtableSelectdialog,dbCode:e.currentConfig.dbCode,isOkClose:!1,multiple:!1},on:{"update:visible":function(t){e.dbtableSelectdialog=t},select:e.dbSelect}})],1)},T=[],k=window.$api.data.codeTable,$=window.$api.data.dbsource,D={data:function(){var e=this;return{infoWraperOpen:!0,infoWraperOpenType:"info",dbtableSelectdialog:!1,tableMap:{},formData:{f_Name:"",f_Code:"",f_Category:"",f_Description:""},rules:{f_Name:[{required:!0,message:"请输入"}],f_Category:[{required:!0,message:"请选择"}],f_Code:[{required:!0,message:"请输入"},{validator:this.lr_existDbFiled,keyValue:function(){return e.formData.f_Id},tableName:"lr_base_datasource",keyName:"f_Id",trigger:"null"}]},currentConfig:{},orders:[],columns:[],tableData:[],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1}},created:function(){this.lr_loadDblink()},computed:{},methods:{handleClickRightSideBtn:function(e){this.infoWraperOpenType!=e?(this.infoWraperOpenType=e,this.infoWraperOpen=!0):(this.infoWraperOpenType="",this.infoWraperOpen=!1)},handleAddTable:function(){this.currentConfig.dbCode?this.dbtableSelectdialog=!0:this.$message({message:this.$t("请选择数据库"),type:"warning"})},dbSelect:function(e,t,a){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var i,o,s,l,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r.formData.f_Code||(r.formData.f_Code=e[0].f_TableName),r.formData.f_Name||(r.formData.f_Name=e[0].f_Description||e[0].f_TableName),t(),r.currentConfig.dbTable=e[0].f_TableName,i=r.currentConfig,o=i.dbCode,s=i.dbTable,l="".concat(o,"_").concat(s),n.next=8,r.$awaitWraper(k.getList(o,s));case 8:c=n.sent,c&&(r.tableMap[l]=c[0].lr_db_codecolumnsList.map((function(e){return{label:e.f_Description?"".concat(e.f_DbColumnName,"(").concat(e.f_Description,")"):e.f_DbColumnName,id:e.f_DbColumnName,name:e.f_DbColumnName,csType:e.f_CsType,isIdentity:1==e.f_IsIdentity,isPrimary:1==e.f_IsPrimaryKey,isNullable:1==e.f_IsNullable,coment:e.f_Description}}))),r.dbtableSelectdialog=!1,r.columns=r.tableMap[l].map((function(e){return{prop:e.name.toLowerCase(),label:e.coment||e.name,csType:e.csType,width:120}})),r.$refs.mainTable.doLayout(),a(),r.loadTableData();case 15:case"end":return n.stop()}}),n)})))()},loadTableData:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i,o,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=t.currentConfig,n=r.dbCode,i=r.dbTable,n){a.next=4;break}return t.$message({type:"error",message:t.$t("请选择数据库")}),a.abrupt("return");case 4:if(i){a.next=7;break}return t.$message({type:"error",message:t.$t("请选择数据表")}),a.abrupt("return");case 7:return e||(t.tableCurrentPage=1),t.tableLoading=!0,o={rows:t.tablePageSize,page:t.tableCurrentPage,sidx:t.columns[0].prop},a.next=12,t.$awaitWraper($.getViewPageByEntity(o,{f_DbId:"learun_view",f_Sql:t.getSettingJson()}));case 12:s=a.sent,s?(t.tableData=s.rows,t.tableTotal=s.records):(t.tableData=[],t.tableTotal=[]),t.tableLoading=!1;case 15:case"end":return a.stop()}}),a)})))()},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},getSettingJson:function(){var e=this.currentConfig,t=e.dbCode,a=e.dbTable,r={orders:this.$deepClone(this.orders),type:"table",sqls:[{dbTable:a,dbCode:t}],columns:this.columns.map((function(e){return{prop:e.prop,label:e.label,csType:e.csType}}))};return this.lr_AESEncrypt(JSON.stringify(r),"learun")},handleAddOrder:function(){this.orders.push({field:"",isDESC:!1})},handleRemoveOrder:function(e){this.orders.splice(e,1)},querySearchAsync:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=a.columns,i=e?n.filter((function(t){return-1!=t.prop.indexOf(e)||-1!=t.label.indexOf(e)})):n,t(i.map((function(e){return{value:a.getColNames(e)}})));case 3:case"end":return r.stop()}}),r)})))()},getColNames:function(e){var t=e.prop,a=e.label,r=t;return t!=a&&(r="".concat(t,"(").concat(a,")")),r},getTypeClass:function(e){var t=e.csType;switch(t){case"string":case"text":return"str";case"int":case"long":case"short":case"decimal":case"double":case"float":return"num";case"DateTime":return"date";case"bool":return"bool";default:return""}},getTypeName:function(e){var t=e.csType;switch(t){case"string":case"text":return"字符";case"int":case"long":case"short":case"decimal":case"double":case"float":return"数字";case"DateTime":return"日期";case"bool":return"布尔";default:return t}},resetForm:function(){this.formData.f_Id="",this.currentConfig={},this.orders=[],this.$formClear(this.$refs.form),this.infoWraperOpenType="info",this.infoWraperOpen=!0,this.tableData=[],this.columns=[],this.$refs.mainTable.doLayout()},validateForm:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$formValidateWraper(e.$refs.form);case 2:if(a=t.sent,!a){t.next=15;break}if(!(e.orders.findIndex((function(e){return!e.field}))>-1)){t.next=7;break}return e.$message({type:"error",message:e.$t("请完善排序字段设置")}),t.abrupt("return",!1);case 7:if(r=e.currentConfig,n=r.dbCode,i=r.dbTable,n){t.next=11;break}return e.$message({type:"error",message:e.$t("请选择数据库")}),t.abrupt("return",!1);case 11:if(i){t.next=14;break}return e.$message({type:"error",message:e.$t("请选择数据表")}),t.abrupt("return",!1);case 14:return t.abrupt("return",!0);case 15:return t.abrupt("return",!1);case 16:case"end":return t.stop()}}),t)})))()},setForm:function(e){this.formData={f_Id:e.f_Id,f_Name:e.f_Name,f_Code:e.f_Code,f_Category:e.f_Category,f_Description:e.f_Description};var t=JSON.parse(e.f_Sql),a=t.orders,r=t.sqls,n=t.columns;this.orders=a,this.columns=n.map((function(e){return Object(h["a"])(Object(h["a"])({},e),{},{width:120})}));var i=r[0],o=i.dbCode,s=i.dbTable;this.currentConfig={dbCode:o,dbTable:s},this.$refs.mainTable.doLayout(),this.loadTableData()},getForm:function(){var e={f_Name:this.formData.f_Name,f_Code:this.formData.f_Code,f_Category:this.formData.f_Category,f_Description:this.formData.f_Description,f_DbId:"learun_view",f_Type:1,f_Sql:this.getSettingJson()};return e}}},S=D,x=(a("8360"),Object(d["a"])(S,w,T,!1,null,"4414977f",null)),O=x.exports,q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-rblock l-tab-page view-page"},[a("l-layout",{staticClass:"l-tab-page",attrs:{bottom:300,top:44,topMove:!1},scopedSlots:e._u([{key:"top",fn:function(){return[a("div",{staticClass:"top-panel"},[a("div",[a("el-tooltip",{attrs:{content:e.$t("查询"),enterable:!1,placement:"bottom"}},[a("el-button",{staticClass:"learun-text-btn",attrs:{type:"text",icon:"learun-icon-play-base",loading:e.tableLoading},on:{click:e.loadTableData}})],1)],1),a("div",{staticClass:"right-btn"},[a("el-tooltip",{attrs:{content:e.openCodeInfo?e.$t("关闭说明"):e.$t("查看说明"),enterable:!1,placement:"bottom"}},[a("el-button",{staticClass:"learun-text-btn",attrs:{type:"text",icon:e.openCodeInfo?"learun-icon-double-right":"learun-icon-circle-question"},on:{click:function(t){e.openCodeInfo=!e.openCodeInfo}}})],1)],1)])]},proxy:!0},{key:"bottom",fn:function(){return[e.columns.length>0?a("div",{staticClass:"l-rblock"},[a("l-table",{ref:"mainTable",attrs:{columns:e.columns,dataSource:e.tableData,loading:e.tableLoading,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage}})],1):e._e()]},proxy:!0}])},[a("l-layout",{attrs:{right:360},scopedSlots:e._u([{key:"right",fn:function(){return[e.openCodeInfo?a("l-code-mirror",{attrs:{readOnly:""},model:{value:e.tempCode,callback:function(t){e.tempCode=t},expression:"tempCode"}}):e._e()]},proxy:!0}])},[a("l-code-mirror",{attrs:{mode:"application/javascript"},model:{value:e.currentConfig.sql,callback:function(t){e.$set(e.currentConfig,"sql",t)},expression:"currentConfig.sql"}})],1)],1),a("div",{class:["info-wraper",{opened:e.infoWraperOpen}]},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:"info"==e.infoWraperOpenType,expression:"infoWraperOpenType == 'info'"}],ref:"form",staticStyle:{padding:"10px 10px 0 10px"},attrs:{model:e.formData,rules:e.rules,size:"mini"}},[a("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_Name"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.f_Name,callback:function(t){e.$set(e.formData,"f_Name",t)},expression:"formData.f_Name"}})],1),a("el-form-item",{attrs:{label:e.$t("编码"),prop:"f_Code"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.f_Code,callback:function(t){e.$set(e.formData,"f_Code",t)},expression:"formData.f_Code"}})],1),a("el-form-item",{attrs:{label:e.$t("分类"),prop:"f_Category"}},[a("l-tree-select",{attrs:{options:e.lr_dataItemTree(e.lr_dataItem["datasourceType"])},model:{value:e.formData.f_Category,callback:function(t){e.$set(e.formData,"f_Category",t)},expression:"formData.f_Category"}})],1),a("el-form-item",{attrs:{label:e.$t("备注"),prop:"f_Description"}},[a("el-input",{attrs:{type:"textarea",rows:"6"},model:{value:e.formData.f_Description,callback:function(t){e.$set(e.formData,"f_Description",t)},expression:"formData.f_Description"}})],1)],1),"inputParams"==e.infoWraperOpenType?[e.inputDbSource.length>0?a("div",{staticStyle:{padding:"10px"}},[a("div",{staticStyle:{"margin-bottom":"8px"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleAddDbsource}},[e._v(e._s(e.$t("添加输入数据源")))])],1),e._l(e.inputDbSource,(function(t,r){return a("div",{key:t.code,staticClass:"field-row"},[a("div",{class:["field-row-header",e.getdbSourceClass(t)]},[e._v(" "+e._s(e.getdbSourceTypeName(t))+" ")]),a("div",{staticClass:"field-row-content"},[e._v(e._s(e.getdbSourceName(t)))]),a("el-button",{staticClass:"learun-row-form-input-delete",attrs:{title:e.$t("删除"),circle:"",plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.handleRemoveDbsource(r)}}},[a("i",{staticClass:"el-icon-close"})])],1)}))],2):a("div",{staticClass:"learun-empty"},[a("el-empty",{attrs:{description:e.$t("还没有添加输入数据源")}}),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleAddDbsource}},[e._v(e._s(e.$t("添加一个")))])],1)]:"order"==e.infoWraperOpenType?[e.orders.length>0?a("el-form",{staticStyle:{padding:"10px 10px 0 10px"},attrs:{size:"mini"}},e._l(e.orders,(function(t,r){return a("div",{key:r,staticClass:"learun-row-form-input"},[a("el-form-item",{staticStyle:{"margin-bottom":"8px"},attrs:{label:e.$t("字段")}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync},model:{value:t.field,callback:function(a){e.$set(t,"field",a)},expression:"item.field"}})],1),a("el-form-item",{staticStyle:{"margin-bottom":"8px"},attrs:{label:e.$t("倒序")}},[a("el-switch",{model:{value:t.isDESC,callback:function(a){e.$set(t,"isDESC",a)},expression:"item.isDESC"}})],1),a("el-button",{staticClass:"learun-row-form-input-delete",attrs:{title:e.$t("删除"),circle:"",plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.handleRemoveOrder(r)}}},[a("i",{staticClass:"el-icon-close"})])],1)})),0):e._e(),e.orders.length>0?a("div",{staticClass:"mt-8",staticStyle:{"padding-left":"10px"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleAddOrder}},[e._v(e._s(e.$t("添加排序字段")))])],1):a("div",{staticClass:"learun-empty"},[a("el-empty",{attrs:{description:e.$t("还没有添加排序字段")}}),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleAddOrder}},[e._v(e._s(e.$t("添加一个")))])],1)]:"field"==e.infoWraperOpenType?[e.columns.length>0?a("div",{staticStyle:{padding:"10px"}},e._l(e.columns,(function(t){return a("div",{key:t.prop,staticClass:"field-row"},[a("div",{class:["field-row-header",e.getTypeClass(t)]},[e._v(" "+e._s(e.getTypeName(t))+" ")]),a("div",{staticClass:"field-row-content"},[e._v(e._s(e.getColNames(t)))])])})),0):a("div",{staticClass:"learun-empty"},[a("el-empty",{attrs:{description:e.$t("暂无字段信息,请在左侧写入脚本并查询")}})],1)]:e._e()],2),a("div",{staticClass:"right-side"},[a("div",{class:["vertical-btn",{opened:"info"==e.infoWraperOpenType}],on:{click:function(t){return e.handleClickRightSideBtn("info")}}},[e._v(" "+e._s(e.$t("基础信息"))+" ")]),a("div",{class:["vertical-btn",{opened:"inputParams"==e.infoWraperOpenType}],on:{click:function(t){return e.handleClickRightSideBtn("inputParams")}}},[e._v(" "+e._s(e.$t("输入数据源"))+" ")]),a("div",{class:["vertical-btn",{opened:"order"==e.infoWraperOpenType}],on:{click:function(t){return e.handleClickRightSideBtn("order")}}},[e._v(" "+e._s(e.$t("排序字段"))+" ")]),a("div",{class:["vertical-btn",{opened:"field"==e.infoWraperOpenType}],on:{click:function(t){return e.handleClickRightSideBtn("field")}}},[e._v(" "+e._s(e.$t("字段信息"))+" ")])]),a("l-dbsource-selectdialog",{attrs:{visible:e.dbsourceSelectdialog},on:{"update:visible":function(t){e.dbsourceSelectdialog=t},select:e.dbsourceSelect}})],1)},P=[],N=window.$api.data.dbsource,V={data:function(){var e=this;return{infoWraperOpen:!0,infoWraperOpenType:"info",dbsourceSelectdialog:!1,openCodeInfo:!1,tempCode:"\n// 获取当前登录用户ID\nlearun.userId\n\n// 获取当前登录用户账号\nlearun.userAccount\n\n// 获取当前登录用户公司ID\nlearun.companyId\n\n// 获取当前登录用户部门ID\nlearun.departmentId \n\n// 获取外部输入参数\n// 数据及联使用\nlearun.param \n\n// 获取输入数据源数据\n// 注:需要在右侧输入数据源处先添加\nvar list = learun.data['数据源编码']\n\n// 返回结果\nreturn list\n\n\n",formData:{f_Name:"",f_Code:"",f_Category:"",f_Description:""},rules:{f_Name:[{required:!0,message:"请输入"}],f_Category:[{required:!0,message:"请选择"}],f_Code:[{required:!0,message:"请输入"},{validator:this.lr_existDbFiled,keyValue:function(){return e.formData.f_Id},tableName:"lr_base_datasource",keyName:"f_Id",trigger:"null"}]},currentConfig:{sql:""},orders:[],columns:[],inputDbSource:[],tableData:[],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1}},created:function(){this.lr_loadDblink()},computed:{},methods:{handleClickRightSideBtn:function(e){this.infoWraperOpenType!=e?(this.infoWraperOpenType=e,this.infoWraperOpen=!0):(this.infoWraperOpenType="",this.infoWraperOpen=!1)},loadTableData:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=t.currentConfig.sql,r){a.next=4;break}return t.$message({type:"error",message:t.$t("请填写脚本")}),a.abrupt("return");case 4:return e||(t.tableCurrentPage=1),t.tableLoading=!0,n={rows:t.tablePageSize,page:t.tableCurrentPage},a.next=9,t.$awaitWraper(N.getViewPageByEntity(n,{f_DbId:"learun_view",f_Sql:t.getSettingJson()}));case 9:i=a.sent,i?(t.setColumns(i.cols),t.tableData=i.rows,t.tableTotal=i.records):(t.setColumns([]),t.tableData=[],t.tableTotal=[]),t.tableLoading=!1;case 12:case"end":return a.stop()}}),a)})))()},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},setColumns:function(e){this.columns=e,this.$refs.mainTable&&this.$refs.mainTable.doLayout()},getSettingJson:function(){var e=this.currentConfig.sql,t={orders:this.$deepClone(this.orders),type:"code",dataSourceInputs:this.inputDbSource,sqls:[{sql:e}],columns:this.columns.map((function(e){return{prop:e.prop,label:e.label,csType:e.csType}}))};return this.lr_AESEncrypt(JSON.stringify(t),"learun")},handleAddOrder:function(){this.orders.push({field:"",isDESC:!1})},handleRemoveOrder:function(e){this.orders.splice(e,1)},querySearchAsync:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=a.columns,i=e?n.filter((function(t){return-1!=t.prop.indexOf(e)||-1!=t.label.indexOf(e)})):n,t(i.map((function(e){return{value:a.getColNames(e)}})));case 3:case"end":return r.stop()}}),r)})))()},getColNames:function(e){var t=e.prop,a=e.label,r=t;return t!=a&&(r="".concat(t,"(").concat(a,")")),r},getTypeClass:function(e){var t=e.csType;switch(t.toLowerCase()){case"string":case"text":return"str";case"int":case"int64":case"int32":case"int16":case"long":case"short":case"decimal":case"double":case"float":return"num";case"datetime":return"date";case"bool":return"bool";default:return""}},getTypeName:function(e){var t=e.csType;switch(t.toLowerCase()){case"string":case"text":return"字符";case"int":case"int64":case"int32":case"int16":case"long":case"short":case"decimal":case"double":case"float":return"数字";case"datetime":return"日期";case"bool":return"布尔";default:return t}},handleAddDbsource:function(){this.dbsourceSelectdialog=!0},dbsourceSelect:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.forEach((function(e){var a=e.f_Code,r=e.f_Name,n=e.f_Type,i=t.inputDbSource.find((function(e){return e.code==a}));i?(i.code=a,i.f_Name=r,i.f_Type=n):t.inputDbSource.push({code:a,name:r,type:n})}));case 1:case"end":return a.stop()}}),a)})))()},handleRemoveDbsource:function(e){this.inputDbSource.splice(e,1)},getdbSourceClass:function(e){var t=e.type;switch(t){case 1:return"num";case 2:return"date";default:return"str"}},getdbSourceTypeName:function(e){var t=e.type;switch(t){case 1:return"表";case 2:return"JS";default:return"SQL"}},getdbSourceName:function(e){var t=e.code,a=e.name;return"".concat(t,"(").concat(a,")")},resetForm:function(){this.formData.f_Id="",this.currentConfig={sql:""},this.$formClear(this.$refs.form),this.infoWraperOpenType="info",this.infoWraperOpen=!0,this.orders=[],this.inputDbSource=[],this.tableData=[],this.columns=[],this.$refs.mainTable&&this.$refs.mainTable.doLayout()},validateForm:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$formValidateWraper(e.$refs.form);case 2:if(a=t.sent,!a){t.next=18;break}if(!(e.orders.findIndex((function(e){return!e.field}))>-1)){t.next=7;break}return e.$message({type:"error",message:e.$t("请完善排序字段设置")}),t.abrupt("return",!1);case 7:if(r=e.currentConfig.sql,r){t.next=11;break}return e.$message({type:"error",message:e.$t("请填写脚本")}),t.abrupt("return",!1);case 11:return t.next=13,e.$awaitWraper(N.getViewPageByEntity({rows:1,page:1},{f_DbId:"learun_view",f_Sql:e.getSettingJson()}));case 13:if(n=t.sent,n){t.next=16;break}return t.abrupt("return",!1);case 16:return e.columns=n.cols,t.abrupt("return",!0);case 18:return t.abrupt("return",!1);case 19:case"end":return t.stop()}}),t)})))()},setForm:function(e){this.formData={f_Id:e.f_Id,f_Name:e.f_Name,f_Code:e.f_Code,f_Category:e.f_Category,f_Description:e.f_Description};var t=JSON.parse(e.f_Sql),a=t.orders,r=t.sqls,n=t.columns,i=t.dataSourceInputs;this.orders=a,this.columns=n,this.inputDbSource=i;var o=r[0].sql;this.currentConfig={sql:o},this.loadTableData()},getForm:function(){var e={f_Name:this.formData.f_Name,f_Code:this.formData.f_Code,f_Category:this.formData.f_Category,f_Description:this.formData.f_Description,f_DbId:"learun_view",f_Type:2,f_Sql:this.getSettingJson()};return e}}},W=V,F=(a("e1de"),Object(d["a"])(W,q,P,!1,null,"7dc2b842",null)),R=F.exports,I=window.$api.data.dbsource,L={components:{LookForm:p,FormSqlView:C,FormTableView:O,FormCodeView:R},data:function(){return{lr_isPage:!0,classifysVisible:!1,category:"",searchWord:"",tableLoading:!1,columns:[{label:"类型",prop:"f_Type",width:"60",align:"center"},{label:"编码",prop:"f_Code",minWidth:"160"},{label:"名称",prop:"f_Name",minWidth:"150"},{label:"分类",prop:"f_Category",width:"120",dataType:"dataItem",dataCode:"datasourceType"},{label:"创建用户",prop:"f_CreateUserName",width:"100"},{label:"最后更新",prop:"f_ModifyDate",width:"160",dataType:"datetime"}],tableBtns:[{prop:"LookData",label:"查看",width:40},{prop:"Edit",label:"编辑",width:40},{prop:"Delete",label:"删除",width:40}],tableData:[],tableTotal:0,tablePageSize:50,tableCurrentPage:1,formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1,lookVisible:!1,code:"",name:"",formSqlViewTitle:"",formSqlViewVisible:!1,formTableViewTitle:"",formTableViewVisible:!1,formCodeViewTitle:"",formCodeViewVisible:!1}},computed:{dataItemTree_DatasourceType:function(){return this.lr_dataItemTree(this.lr_dataItem["datasourceType"])}},mounted:function(){this.init()},methods:{handleSettingClick:function(){this.classifysVisible=!0},handleNodeClick:function(e){this.category=e.value,this.hanleSearch()},init:function(){this.lr_loadDataItem("datasourceType"),this.loadTableData()},loadTableData:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e||(t.tableCurrentPage=1),t.tableLoading=!0,r={rows:t.tablePageSize,page:t.tableCurrentPage,sidx:"F_ModifyDate DESC",keyword:t.searchWord,category:t.category},a.next=5,t.$awaitWraper(I.getPage(r));case 5:n=a.sent,n&&(t.tableData=n.rows,t.tableTotal=n.records,t.tableLoading=!1);case 7:case"end":return a.stop()}}),a)})))()},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},hanleSearch:function(){this.loadTableData()},handleCommand:function(e){switch(this.formEdit=!1,this.formEditRow=null,e){case"sql":this.openForm(0);break;case"table":this.openForm(1);break;case"code":this.openForm(2);break}},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.openForm(t.f_Type,t.f_Name)},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){I.remove(t.f_Id).then((function(){a.$message({type:"success",message:a.$t("删除成功!")}),a.init()}))})).catch((function(){a.$message({type:"info",message:a.$t("已取消删除")})}))},handleFormSqlViewSave:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e(),r.next=3,a.$refs.formSqlView.validateForm();case 3:if(n=r.sent,!n){r.next=9;break}return i=a.$refs.formSqlView.getForm(),r.next=8,a.saveForm(i);case 8:a.formSqlViewVisible=!1;case 9:t();case 10:case"end":return r.stop()}}),r)})))()},handleFormSqlViewClose:function(){this.$refs.formSqlView.resetForm()},handleFormSqlViewOpened:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a.formEdit){r.next=5;break}return e("加载数据中..."),r.next=4,a.loadForm("formSqlView");case 4:t();case 5:case"end":return r.stop()}}),r)})))()},handleFormTableViewSave:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e(),r.next=3,a.$refs.formTableView.validateForm();case 3:if(n=r.sent,!n){r.next=9;break}return i=a.$refs.formTableView.getForm(),r.next=8,a.saveForm(i);case 8:a.formTableViewVisible=!1;case 9:t();case 10:case"end":return r.stop()}}),r)})))()},handleFormTableViewClose:function(){this.$refs.formTableView.resetForm()},handleFormTableViewOpened:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a.formEdit){r.next=5;break}return e("加载数据中..."),r.next=4,a.loadForm("formTableView");case 4:t();case 5:case"end":return r.stop()}}),r)})))()},handleFormCodeViewSave:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e(),r.next=3,a.$refs.formCodeView.validateForm();case 3:if(n=r.sent,!n){r.next=9;break}return i=a.$refs.formCodeView.getForm(),r.next=8,a.saveForm(i);case 8:a.formCodeViewVisible=!1;case 9:t();case 10:case"end":return r.stop()}}),r)})))()},handleFormCodeViewClose:function(){this.$refs.formCodeView.resetForm()},handleFormCodeViewOpened:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a.formEdit){r.next=5;break}return e("加载数据中..."),r.next=4,a.loadForm("formCodeView");case 4:t();case 5:case"end":return r.stop()}}),r)})))()},openForm:function(e,t){switch(e){case 1:this.formTableViewTitle=t?"".concat(this.$t("编辑表视图"),"(").concat(t,")"):this.$t("新增表视图"),this.formTableViewVisible=!0;break;case 2:this.formCodeViewTitle=t?"".concat(this.$t("编辑JS脚本视图"),"(").concat(t,")"):this.$t("新增JS脚本视图"),this.formCodeViewVisible=!0;break;case 3:break;default:this.formSqlViewTitle=t?"".concat(this.$t("编辑SQL视图"),"(").concat(t,")"):this.$t("新增SQL视图"),this.formSqlViewVisible=!0;break}},saveForm:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.formEdit){a.next=6;break}return a.next=3,t.$awaitWraper(I.update(t.formEditRow.f_Id,e));case 3:r=a.sent,a.next=9;break;case 6:return a.next=8,t.$awaitWraper(I.add(e));case 8:r=a.sent;case 9:r&&(t.$message({type:"success",message:t.$t("保存成功！")}),t.loadTableData());case 10:case"end":return a.stop()}}),a)})))()},loadForm:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$awaitWraper(I.get(t.formEditRow.f_Code));case 2:r=a.sent,r?t.$refs[e].setForm(r):(t.$message({type:"warning",message:t.$t("获取编辑数据失败!")}),t.formVisible=!1);case 4:case"end":return a.stop()}}),a)})))()},handleLookData:function(e,t){this.lookVisible=!0,this.code=t.f_Code,this.name=t.f_Name},handleCloseLookForm:function(){this.$refs.lookForm.resetForm()},handleOpenedLookForm:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e("加载数据中..."),r.next=3,a.$refs.lookForm.init();case 3:t();case 4:case"end":return r.stop()}}),r)})))()},filterBtns:function(e,t){return t}}},z=L,E=Object(d["a"])(z,r,n,!1,null,null,null);t["default"]=E.exports},8360:function(e,t,a){"use strict";a("b949")},"99f6":function(e,t,a){},b11b:function(e,t,a){},b949:function(e,t,a){},d5a0:function(e,t,a){"use strict";a("b11b")},e1de:function(e,t,a){"use strict";a("99f6")}}]);