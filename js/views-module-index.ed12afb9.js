(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-module-index"],{"5d13":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("l-layout",{directives:[{name:"loading",rawName:"v-loading",value:e.moduleLoading,expression:"moduleLoading"}],staticClass:"l-tab-page",attrs:{left:544},scopedSlots:e._u([{key:"left",fn:function(){return[n("l-panel",{staticStyle:{"padding-right":"0px"}},[n("div",{staticClass:"l-auto-window",staticStyle:{padding:"0 8px"}},[n("el-tabs",{attrs:{"before-leave":e.handleRoleToUser},model:{value:e.tabsActiveName,callback:function(t){e.tabsActiveName=t},expression:"tabsActiveName"}},[n("el-tab-pane",{attrs:{label:e.$t("角色"),name:"tabRole"}},[n("l-layout",{attrs:{bottom:40},scopedSlots:e._u([{key:"bottom",fn:function(){return[n("el-input",{attrs:{placeholder:e.$t("请输入编号/名称"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearchRole.apply(null,arguments)}},model:{value:e.searchRoleWord,callback:function(t){e.searchRoleWord=t},expression:"searchRoleWord"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearchRole},slot:"append"})],1)]},proxy:!0}])},[n("div",{staticClass:"l-rblock",staticStyle:{"padding-top":"8px"}},[n("l-table",{attrs:{highlightCurrentRow:!0,columns:e.roleColumns,dataSource:e.searchRoleData},on:{rowClick:e.handleRowClick}})],1)])],1),n("el-tab-pane",{attrs:{label:e.$t("人员"),name:"tabUser"}},[n("l-layout",{attrs:{bottom:40},scopedSlots:e._u([{key:"bottom",fn:function(){return[n("el-input",{attrs:{placeholder:e.$t("请输入帐号/名称"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearchUser.apply(null,arguments)}},model:{value:e.searchUserWord,callback:function(t){e.searchUserWord=t},expression:"searchUserWord"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearchUser},slot:"append"})],1)]},proxy:!0}])},[n("div",{staticClass:"l-rblock",staticStyle:{"padding-top":"8px"}},[n("l-table",{attrs:{highlightCurrentRow:!0,columns:e.userColumns,dataSource:e.userData,"row-key":"f_UserId",isPage:!0,pageTotal:e.userTotal,tablePage:e.userCurrentPage},on:{rowClick:e.handleRowClick,"update:tablePage":function(t){e.userCurrentPage=t},"update:table-page":function(t){e.userCurrentPage=t},loadPageData:e.turnUserPage},scopedSlots:e._u([{key:"f_CompanyId",fn:function(t){return[e._v(" "+e._s((e.lr_companyList.find((function(e){return e.f_CompanyId==t.row.f_CompanyId}))||{}).f_FullName||"")+" ")]}},{key:"f_DepartmentId",fn:function(t){return[e._v(" "+e._s(e.lr_departmentName(e.lr_departments[t.row.f_CompanyId]||[],t.row.f_DepartmentId))+" ")]}}])})],1)])],1)],1)],1)])]},proxy:!0}])},[n("l-panel",{staticStyle:{"padding-left":"0px"},attrs:{title:e.type+(e.name?"-":"")+e.name}},[n("div",{staticClass:"l-auto-window",staticStyle:{padding:"0 8px"}},[n("el-tabs",{attrs:{"before-leave":e.handleTabLeave},model:{value:e.tabsActiveName2,callback:function(t){e.tabsActiveName2=t},expression:"tabsActiveName2"}},[n("el-tab-pane",{attrs:{label:e.$t("功能"),name:"tabModule"}},[e.isSelectOne?n("l-layout",{attrs:{bottom:40},scopedSlots:e._u([{key:"bottom",fn:function(){return[n("div",{staticClass:"l-rblock",staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{disabled:!e.isSaveModule,size:"mini"},on:{click:e.handleModuleCancel}},[e._v(e._s(e.$t("取消")))]),n("el-button",{attrs:{disabled:!e.isSaveModule,size:"mini",type:"primary"},on:{click:e.handleModuleSave}},[e._v(e._s(e.$t("保存")))])],1)]},proxy:!0}])},[n("div",{staticClass:"l-rblock",staticStyle:{overflow:"auto"}},[n("el-tree",{ref:"modulesTree",attrs:{data:e.modulesTree,"show-checkbox":"","default-expand-all":"","node-key":"f_ModuleId"},on:{check:e.handleModuleCheck},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return n("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(e.$t(a.label))+" ")])}}])})],1)]):n("div",{staticClass:"empty-text"},[e._v(e._s(e.emptyText))])],1),n("el-tab-pane",{attrs:{label:e.$t("按钮"),name:"tabButton"}},[e.isSelectOne?n("l-layout",{attrs:{left:240,bottom:40},scopedSlots:e._u([{key:"left",fn:function(){return[n("div",{staticClass:"l-rblock",staticStyle:{overflow:"auto","border-right":"1px solid #E4E7ED"}},[n("el-tree",{attrs:{data:e.myModulesTree,"default-expand-all":"","node-key":"f_ModuleId"},on:{"node-click":e.handleModuleClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return n("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(e.$t(a.label))+" ")])}}])})],1)]},proxy:!0},{key:"bottom",fn:function(){return[n("div",{staticClass:"l-rblock",staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{disabled:!e.isSaveButton,size:"mini"},on:{click:e.handleButtonCancel}},[e._v(e._s(e.$t("取消")))]),n("el-button",{attrs:{disabled:!e.isSaveButton,size:"mini",type:"primary"},on:{click:e.handleButtonSave}},[e._v(e._s(e.$t("保存")))])],1)]},proxy:!0}])},[n("div",{staticClass:"l-rblock",staticStyle:{overflow:"auto"}},[n("el-tree",{ref:"buttonTree",attrs:{data:e.buttonTree,"show-checkbox":"","default-expand-all":"","node-key":"f_EnCode"},on:{check:e.handleButtonCheck},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return n("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(e.$t(a.label))+" ")])}}])})],1)]):n("div",{staticClass:"empty-text"},[e._v(e._s(e.emptyText))])],1),n("el-tab-pane",{attrs:{label:e.$t("列表"),name:"tabCol"}},[e.isSelectOne?n("l-layout",{attrs:{left:240,bottom:40},scopedSlots:e._u([{key:"left",fn:function(){return[n("div",{staticClass:"l-rblock",staticStyle:{overflow:"auto","border-right":"1px solid #E4E7ED"}},[n("el-tree",{attrs:{data:e.myModulesTree,"default-expand-all":"","node-key":"f_ModuleId"},on:{"node-click":e.handleColModuleClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return n("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(e.$t(a.label))+" ")])}}])})],1)]},proxy:!0},{key:"bottom",fn:function(){return[n("div",{staticClass:"l-rblock",staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{disabled:!e.isSaveColumn,size:"mini"},on:{click:e.handleColumnCancel}},[e._v(e._s(e.$t("取消")))]),n("el-button",{attrs:{disabled:!e.isSaveColumn,size:"mini",type:"primary"},on:{click:e.handleColumnSave}},[e._v(e._s(e.$t("保存")))])],1)]},proxy:!0}])},[n("div",{staticClass:"l-rblock",staticStyle:{overflow:"auto"}},[n("el-tree",{ref:"columnTree",attrs:{data:e.columnTree,"show-checkbox":"","default-expand-all":"","node-key":"f_EnCode"},on:{check:e.handleColumnCheck},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return n("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(e.$t(a.label))+" ")])}}])})],1)]):n("div",{staticClass:"empty-text"},[e._v(e._s(e.emptyText))])],1),n("el-tab-pane",{attrs:{label:e.$t("表单"),name:"tabForm"}},[e.isSelectOne?n("l-layout",{attrs:{left:240,bottom:40},scopedSlots:e._u([{key:"left",fn:function(){return[n("div",{staticClass:"l-rblock",staticStyle:{overflow:"auto","border-right":"1px solid #E4E7ED"}},[n("el-tree",{attrs:{data:e.myModulesTree,"default-expand-all":"","node-key":"f_ModuleId"},on:{"node-click":e.handleFormModuleClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return n("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(e.$t(a.label))+" ")])}}])})],1)]},proxy:!0},{key:"bottom",fn:function(){return[n("div",{staticClass:"l-rblock",staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{disabled:!e.isSaveForm,size:"mini"},on:{click:e.handleFormCancel}},[e._v(e._s(e.$t("取消")))]),n("el-button",{attrs:{disabled:!e.isSaveForm,size:"mini",type:"primary"},on:{click:e.handleFormSave}},[e._v(e._s(e.$t("保存")))])],1)]},proxy:!0}])},[n("div",{staticClass:"l-rblock",staticStyle:{overflow:"auto"}},[n("l-table",{attrs:{columns:e.formColumns,dataSource:e.formTableData},scopedSlots:e._u([{key:"isEdit",fn:function(t){return[t.row.noEdit?e._e():n("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(n){return e.handleFormCheck(t.row,!1)}},model:{value:t.row.isEdit,callback:function(n){e.$set(t.row,"isEdit",n)},expression:"scope.row.isEdit"}})]}},{key:"isLook",fn:function(t){return[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(n){return e.handleFormCheck(t.row,!0)}},model:{value:t.row.isLook,callback:function(n){e.$set(t.row,"isLook",n)},expression:"scope.row.isLook"}})]}}])})],1)]):n("div",{staticClass:"empty-text"},[e._v(e._s(e.emptyText))])],1)],1)],1)])],1)},r=[],o=(n("99af"),n("4de4"),n("7db0"),n("c740"),n("d81d"),n("a434"),n("b0c0"),n("d3b7"),n("ac1f"),n("3ca3"),n("1276"),n("159b"),n("ddb0"),n("2909")),s=n("5530"),i=(n("96cf"),n("1da1")),l=n("5880"),c=window.$api.permission.module,u=window.$api.organization.role,d=window.$api.organization.user,f=window.$api.system.module,m={data:function(){return{lr_isPage:!0,lr_isAuth:!1,tabsActiveName:"tabRole",tabsActiveName2:"tabModule",name:"",id:"",searchRoleWord:"",searchRoleData:[],roleData:[],roleColumns:[{label:"编号",prop:"f_EnCode",minWidth:"110"},{label:"名称",prop:"f_FullName",minWidth:"120"}],searchUserWord:"",userData:[],userColumns:[{label:"姓名",prop:"f_RealName",width:"88"},{label:"账号",prop:"f_Account",width:"88"},{label:"公司",prop:"f_CompanyId",minWidth:"100"},{label:"部门",prop:"f_DepartmentId",minWidth:"100"}],userTotal:0,userPageSize:50,userCurrentPage:1,isSelectOne:!1,moduleLoading:!1,moduleList:[],moduleChecked:[],notAuthList:[],moduleId:"",buttons:[],mybuttons:[],buttonList:[],buttonChecked:[],notAuthButtonList:[],columns:[],mycolumns:[],columnList:[],columnChecked:[],notAuthColumnList:[],forms:[],myforms:[],formList:[],formChecked:[],notAuthFormList:[],formColumns:[{label:"名称",prop:"f_FullName",minWidth:"100"},{label:"编辑",prop:"isEdit",width:"64",align:"center"},{label:"查看",prop:"isLook",width:"64",align:"center"}],formTableData:[]}},created:function(){},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.moduleLoading=!0,t.next=3,Promise.all([e.loadRoleData(),e.lr_loadCompanys(),e.loadUserData()]);case 3:e.moduleLoading=!1;case 4:case"end":return t.stop()}}),t)})))()},computed:Object(s["a"])(Object(s["a"])({},Object(l["mapGetters"])(["modules"])),{},{type:function(){return"tabRole"==this.tabsActiveName?this.$t("角色"):this.$t("人员")},emptyText:function(){return"tabRole"==this.tabsActiveName?this.$t("请选择一个角色查看"):this.$t("请选择一个人员查看")},allModules:function(){return this.modules.filter((function(e){return 1==e.f_EnabledMark}))},myModules:function(){var e=this;return this.lr_IsAdmin?this.allModules:this.allModules.filter((function(t){var n=e.loginInfo.moduleAuthIds||[];return n.indexOf(t.f_ModuleId)>-1||t.f_CreateUserId==e.loginInfo.f_UserId}))},modulesTree:function(){if(this.loading)return[];var e=this.$toTree(this.myModules,"f_ModuleId","f_ParentId","f_ModuleId","f_FullName");return e.filter((function(e){return"0"==e.f_ParentId}))},myModulesTree:function(){var e=this,t=this.myModules.filter((function(t){return e.moduleList.indexOf(t.f_ModuleId)>-1}));return this.$toTree(t,"f_ModuleId","f_ParentId","f_ModuleId","f_FullName")},isSaveModule:function(){return!this.equalsArr(this.moduleList,this.moduleChecked)},myButtons:function(){var e=this;return this.lr_IsAdmin?this.buttons:this.buttons.filter((function(t){return-1!=e.mybuttons.indexOf(t.f_EnCode)||t.f_CreateUserId==e.loginInfo.f_UserId}))},buttonTree:function(){var e=this.$toTree(this.myButtons,"f_Id","f_ParentId","f_EnCode","f_FullName");return e},isSaveButton:function(){return!this.equalsArr(this.buttonList,this.buttonChecked)},myColumns:function(){var e=this;return this.lr_IsAdmin?this.columns:this.columns.filter((function(t){return-1!=e.mycolumns.indexOf(t.f_EnCode)||t.f_CreateUserId==e.loginInfo.f_UserId}))},columnTree:function(){var e=this.$toTree(this.myColumns,"f_Id","f_ParentId","f_EnCode","f_FullName");return e},isSaveColumn:function(){return!this.equalsArr(this.columnList,this.columnChecked)},isSaveForm:function(){return!this.equalsArr(this.formList,this.formChecked)}}),methods:{equalsArr:function(e,t){var n=!0;return e.length!==t.length?n=!1:(e.forEach((function(e){-1===t.indexOf(e)&&(n=!1)})),t.forEach((function(t){-1===e.indexOf(t)&&(n=!1)}))),n},handleRoleToUser:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.leave();case 2:e.name="",e.id="",e.isSelectOne=!1;case 5:case"end":return t.stop()}}),t)})))()},leave:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.t0=e.tabsActiveName2,t.next="tabModule"===t.t0?3:"tabButton"===t.t0?6:"tabCol"===t.t0?9:"tabForm"===t.t0?12:15;break;case 3:return t.next=5,e.leaveModule();case 5:return t.abrupt("break",15);case 6:return t.next=8,e.leaveButton();case 8:return t.abrupt("break",15);case 9:return t.next=11,e.leaveColumn();case 11:return t.abrupt("break",15);case 12:return t.next=14,e.leaveForm();case 14:return t.abrupt("break",15);case 15:case"end":return t.stop()}}),t)})))()},hanleSearchRole:function(){var e=this;this.searchRoleWord?this.searchRoleData=this.roleData.filter((function(t){return t.f_FullName.indexOf(e.searchRoleWord)>-1||t.f_EnCode.indexOf(e.searchRoleWord)>-1})):this.searchRoleData=this.roleData},loadRoleData:function(){var e=this;u.getList().then((function(t){e.searchRoleWord="",e.roleData=t.data.data.filter((function(e){return 1==e.f_EnabledMark})),e.searchRoleData=e.roleData}))},loadUserData:function(e){var t=this;e||(this.userCurrentPage=1);var n={rows:this.userPageSize,page:this.userCurrentPage,sidx:"F_CreateDate DESC",keyword:this.searchUserWord};d.getPage(n).then((function(e){var n=t.$deepClone(e.data.data);n.rows.forEach((function(e){t.lr_loadDepartments(e.f_CompanyId)})),t.userData=n.rows,t.userTotal=n.records})).catch((function(){t.userData=[]}))},turnUserPage:function(e){var t=e.rows;this.tablePageSize=t,this.loadUserData(!0)},hanleSearchUser:function(){this.loadUserData()},handleRowClick:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.row,!("tabRole"==t.tabsActiveName&&t.id==a.f_RoleId||"tabUser"==t.tabsActiveName&&t.id==a.f_UserId)){n.next=3;break}return n.abrupt("return");case 3:return n.next=5,t.leave();case 5:"tabRole"==t.tabsActiveName?(t.name=a.f_FullName,t.id=a.f_RoleId):(t.name=a.f_RealName,t.id=a.f_UserId),t.isSelectOne=!0,t.loadAuthorizeData(t.id);case 8:case"end":return n.stop()}}),n)})))()},loadAuthorizeData:function(e){this.moduleChecked=[],this.moduleList=[],this.loadModuleAuthorizeData(e)},handleTabLeave:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.t0=e.tabsActiveName2,t.next="tabModule"===t.t0?3:"tabButton"===t.t0?6:"tabCol"===t.t0?9:"tabForm"===t.t0?12:15;break;case 3:return t.next=5,e.leaveModule2();case 5:return t.abrupt("break",15);case 6:return t.next=8,e.leaveButton();case 8:return t.abrupt("break",15);case 9:return t.next=11,e.leaveColumn();case 11:return t.abrupt("break",15);case 12:return t.next=14,e.leaveForm();case 14:return t.abrupt("break",15);case 15:case"end":return t.stop()}}),t)})))()},loadModuleAuthorizeData:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.moduleLoading=!0,n.next=3,t.$awaitWraper(c.getList(e,1,"0"));case 3:a=n.sent.settingList,r=a.filter((function(e){return t.allModules.findIndex((function(t){return t.f_ModuleId==e.f_ItemId}))>-1&&-1==t.myModules.findIndex((function(t){return t.f_ModuleId==e.f_ItemId}))})),t.notAuthList=r.map((function(e){return e.f_ItemId})),t.moduleList=a.map((function(e){return e.f_ItemId})),t.$nextTick((function(){t.$refs.modulesTree.setCheckedKeys(t.moduleList.filter((function(e){return-1==t.myModules.findIndex((function(t){return t.f_ParentId==e}))})));var e=t.$refs.modulesTree.getCheckedKeys(),n=t.$refs.modulesTree.getHalfCheckedKeys();t.moduleChecked=e.concat(n)})),t.moduleLoading=!1;case 9:case"end":return n.stop()}}),n)})))()},handleModuleCheck:function(e,t){this.moduleChecked=t.checkedKeys.concat(t.halfCheckedKeys)},handleModuleCancel:function(){this.moduleChecked=this.$deepClone(this.moduleList),this.$refs.modulesTree.setCheckedKeys(this.moduleChecked)},handleModuleSave:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.moduleLoading=!0,n=[],n.push.apply(n,Object(o["a"])(e.moduleChecked)),n.push.apply(n,Object(o["a"])(e.notAuthList)),a={ids:n,objectType:"tabRole"==e.tabsActiveName?1:2,itemType:1,parentId:"0"},t.next=7,e.$awaitWraper(c.save(e.id,a));case 7:r=t.sent,r&&(e.$message({type:"success",message:e.$t("保存成功!")}),e.moduleList=e.$deepClone(e.moduleChecked)),e.moduleLoading=!1;case 10:case"end":return t.stop()}}),t)})))()},leaveModule:function(){var e=this;return new Promise((function(t){e.isSaveModule?e.$confirm(e.$t("离开前,是否保存设置数据?"),e.$t("提示"),{confirmButtonText:e.$t("确定"),cancelButtonText:e.$t("取消"),type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.handleModuleSave();case 2:e.moduleList=[],e.moduleChecked=[],t();case 5:case"end":return n.stop()}}),n)})))).catch((function(){e.moduleList=[],e.moduleChecked=[],t()})):(e.moduleList=[],e.moduleChecked=[],t())}))},leaveModule2:function(){var e=this;return new Promise((function(t){e.isSaveModule?e.$confirm(e.$t("离开前,是否保存设置数据?"),e.$t("提示"),{confirmButtonText:e.$t("确定"),cancelButtonText:e.$t("取消"),type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.handleModuleSave();case 2:t();case 3:case"end":return n.stop()}}),n)})))):t()}))},handleModuleClick:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.moduleId!=e.value){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,t.leaveButton();case 4:if(t.moduleId=e.value,"expand"!=e.f_Target){n.next=12;break}t.buttons=[],t.mybuttons=[],t.buttonList=[],t.buttonChecked=[],n.next=26;break;case 12:return t.moduleLoading=!0,a={f_Id:"0",f_ParentId:"01",f_EnCode:"0",f_FullName:e.f_FullName},n.next=16,t.$awaitWraper(f.getButtons(e.value));case 16:return r=n.sent,r.forEach((function(e){return e.f_ParentId="0"})),r.push(a),n.next=21,t.loadButtons(e.value);case 21:t.buttons=r,t.$refs.buttonTree.setCheckedKeys(t.buttonList),t.notAuthButtonList=t.buttonList.filter((function(e){return t.buttons.findIndex((function(t){return t.f_EnCode==e}))>-1&&-1==t.myButtons.findIndex((function(t){return t.f_EnCode==e}))})),t.$nextTick((function(){var e=t.$refs.buttonTree.getCheckedKeys(),n=t.$refs.buttonTree.getHalfCheckedKeys();t.buttonChecked=e.concat(n).filter((function(e){return"0"!=e}))})),t.moduleLoading=!1;case 26:case"end":return n.stop()}}),n)})))()},loadButtons:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$awaitWraper(c.getList(t.id,2,e));case 2:a=n.sent,t.mybuttons=a.myList||[],t.buttonList=a.settingList.map((function(e){return e.f_ItemId}));case 5:case"end":return n.stop()}}),n)})))()},handleButtonCheck:function(e,t){this.buttonChecked=t.checkedKeys.concat(t.halfCheckedKeys).filter((function(e){return"0"!=e}))},handleButtonCancel:function(){this.buttonChecked=this.$deepClone(this.buttonList),this.$refs.buttonTree.setCheckedKeys(this.buttonChecked)},handleButtonSave:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.moduleLoading=!0,n=[],n.push.apply(n,Object(o["a"])(e.notAuthButtonList)),n.push.apply(n,Object(o["a"])(e.buttonChecked)),a={ids:n,objectType:"tabRole"==e.tabsActiveName?1:2,itemType:2,parentId:e.moduleId},t.next=7,e.$awaitWraper(c.save(e.id,a));case 7:r=t.sent,r&&(e.$message({type:"success",message:e.$t("保存成功!")}),e.buttonList=e.$deepClone(e.buttonChecked)),e.moduleLoading=!1;case 10:case"end":return t.stop()}}),t)})))()},leaveButton:function(){var e=this;return new Promise((function(t){e.isSaveButton?e.$confirm(e.$t("离开前,是否保存设置数据?"),e.$t("提示"),{confirmButtonText:e.$t("确定"),cancelButtonText:e.$t("取消"),type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.handleButtonSave();case 2:e.buttonList=[],e.buttonChecked=[],e.mybuttons=[],e.buttons=[],e.moduleId="",t();case 8:case"end":return n.stop()}}),n)})))).catch((function(){e.buttonList=[],e.buttonChecked=[],e.mybuttons=[],e.buttons=[],e.moduleId="",t()})):(e.buttonList=[],e.buttonChecked=[],e.mybuttons=[],e.buttons=[],e.moduleId="",t())}))},handleColModuleClick:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.moduleId!=e.value){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,t.leaveColumn();case 4:if(t.moduleId=e.value,"expand"!=e.f_Target){n.next=12;break}t.columns=[],t.mycolumns=[],t.columnList=[],t.columnChecked=[],n.next=26;break;case 12:return t.moduleLoading=!0,a={f_Id:"0",f_ParentId:"01",f_EnCode:"0",f_FullName:e.f_FullName},n.next=16,t.$awaitWraper(f.getColumns(e.value));case 16:return r=n.sent,r.forEach((function(e){return e.f_ParentId="0"})),r.push(a),n.next=21,t.loadColumns(e.value);case 21:t.columns=r,t.$refs.columnTree.setCheckedKeys(t.columnList),t.notAuthColumnList=t.columnList.filter((function(e){return t.columns.findIndex((function(t){return t.f_EnCode==e}))>-1&&-1==t.myColumns.findIndex((function(t){return t.f_EnCode==e}))})),t.$nextTick((function(){var e=t.$refs.columnTree.getCheckedKeys(),n=t.$refs.columnTree.getHalfCheckedKeys();t.columnChecked=e.concat(n).filter((function(e){return"0"!=e}))})),t.moduleLoading=!1;case 26:case"end":return n.stop()}}),n)})))()},loadColumns:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$awaitWraper(c.getList(t.id,3,e));case 2:a=n.sent,t.mycolumns=a.myList||[],t.columnList=a.settingList.map((function(e){return e.f_ItemId}));case 5:case"end":return n.stop()}}),n)})))()},handleColumnCheck:function(e,t){this.columnChecked=t.checkedKeys.concat(t.halfCheckedKeys).filter((function(e){return"0"!=e}))},handleColumnCancel:function(){this.columnChecked=this.$deepClone(this.columnList),this.$refs.columnTree.setCheckedKeys(this.columnChecked)},handleColumnSave:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.moduleLoading=!0,n=[],n.push.apply(n,Object(o["a"])(e.notAuthColumnList)),n.push.apply(n,Object(o["a"])(e.columnChecked)),a={ids:n,objectType:"tabRole"==e.tabsActiveName?1:2,itemType:3,parentId:e.moduleId},t.next=7,e.$awaitWraper(c.save(e.id,a));case 7:r=t.sent,r&&(e.$message({type:"success",message:e.$t("保存成功!")}),e.columnList=e.$deepClone(e.columnChecked)),e.moduleLoading=!1;case 10:case"end":return t.stop()}}),t)})))()},leaveColumn:function(){var e=this;return new Promise((function(t){e.isSaveColumn?e.$confirm(e.$t("离开前,是否保存设置数据?"),e.$t("提示"),{confirmButtonText:e.$t("确定"),cancelButtonText:e.$t("取消"),type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.handleColumnSave();case 2:e.columnList=[],e.columnChecked=[],e.mycolumns=[],e.columns=[],e.moduleId="",t();case 8:case"end":return n.stop()}}),n)})))).catch((function(){e.columnList=[],e.columnChecked=[],e.mycolumns=[],e.columns=[],e.moduleId="",t()})):(e.columnList=[],e.columnChecked=[],e.mycolumns=[],e.columns=[],e.moduleId="",t())}))},handleFormModuleClick:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.moduleId!=e.value){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,t.leaveForm();case 4:if(t.moduleId=e.value,"expand"!=e.f_Target){n.next=12;break}t.forms=[],t.myforms=[],t.formList=[],t.formChecked=[],n.next=21;break;case 12:return t.moduleLoading=!0,n.next=15,t.$awaitWraper(f.getForms(e.value));case 15:return a=n.sent,n.next=18,t.loadForms(e.value);case 18:t.forms=a,t.setFormTableData(),t.moduleLoading=!1;case 21:case"end":return n.stop()}}),n)})))()},loadForms:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$awaitWraper(c.getList(t.id,4,e));case 2:a=n.sent,t.myforms=a.myList||[],t.formList=a.settingList.map((function(e){return"".concat(e.f_ItemId,",").concat(e.f_Type||2)}));case 5:case"end":return n.stop()}}),n)})))()},setFormTableData:function(){var e=this,t=[];if(this.notAuthFormList=[],this.lr_IsAdmin)this.forms.forEach((function(e){t.push({f_FullName:e.f_FullName,f_EnCode:e.f_EnCode,isEdit:0,isLook:0})}));else{var n={};this.myforms.forEach((function(e){var t=e.split(",");n[t[0].toLowerCase()]=t[1]})),this.forms.forEach((function(a){if(n[a.f_EnCode.toLowerCase()])1==n[a.f_EnCode.toLowerCase()]?t.push({f_FullName:a.f_FullName,f_EnCode:a.f_EnCode,noEdit:!0,isEdit:0,isLook:0}):t.push({f_FullName:a.f_FullName,f_EnCode:a.f_EnCode,isEdit:0,isLook:0});else if(a.f_CreateUserId==e.loginInfo.f_UserId)t.push({f_FullName:a.f_FullName,f_EnCode:a.f_EnCode,isEdit:0,isLook:0});else{var r=e.formList.find((function(e){return e.indexOf(a.f_EnCode.toLowerCase()+",")>-1}));r&&e.notAuthFormList.push(r)}}))}var a={};this.formList.forEach((function(e){var t=e.split(",");a[t[0].toLowerCase()]=t[1]}));var r=[];t.forEach((function(e){a[e.f_EnCode.toLowerCase()]&&(e.isLook=1,1!=a[e.f_EnCode.toLowerCase()]&&(e.isEdit=1),r.push("".concat(e.f_EnCode,",").concat(a[e.f_EnCode.toLowerCase()])))})),this.formChecked=r,this.formTableData=t},handleFormCheck:function(e,t){var n=this.formChecked.findIndex((function(t){return t.split(",")[0].toLowerCase()==e.f_EnCode.toLowerCase()})),a=0;1==e.isLook?a=1:t&&(e.isEdit=0),1==e.isEdit&&(a=2,t||(e.isLook=1)),-1==n&&0!=a?this.formChecked.push("".concat(e.f_EnCode,",").concat(a)):(this.formChecked.splice(n,1),0!=a&&this.formChecked.push("".concat(e.f_EnCode,",").concat(a)))},handleFormCancel:function(){this.formChecked=this.$deepClone(this.formList),this.setFormTableData()},handleFormSave:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.moduleLoading=!0,n=[],n.push.apply(n,Object(o["a"])(e.formChecked)),n.push.apply(n,Object(o["a"])(e.notAuthFormList)),a={ids:n,objectType:"tabRole"==e.tabsActiveName?1:2,itemType:4,parentId:e.moduleId},t.next=7,e.$awaitWraper(c.save(e.id,a));case 7:r=t.sent,r&&(e.$message({type:"success",message:e.$t("保存成功!")}),e.formList=e.$deepClone(e.formChecked)),e.moduleLoading=!1;case 10:case"end":return t.stop()}}),t)})))()},leaveForm:function(){var e=this;return new Promise((function(t){e.isSaveForm?e.$confirm(e.$t("离开前,是否保存设置数据?"),e.$t("提示"),{confirmButtonText:e.$t("确定"),cancelButtonText:e.$t("取消"),type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.handleFormSave();case 2:e.formList=[],e.formChecked=[],e.myforms=[],e.forms=[],e.formTableData=[],e.moduleId="",t();case 9:case"end":return n.stop()}}),n)})))).catch((function(){e.formList=[],e.formChecked=[],e.myforms=[],e.forms=[],e.formTableData=[],e.moduleId="",t()})):(e.formList=[],e.formChecked=[],e.myforms=[],e.forms=[],e.formTableData=[],e.moduleId="",t())}))}}},p=m,h=(n("7bd9"),n("2877")),b=Object(h["a"])(p,a,r,!1,null,"47819cc8",null);t["default"]=b.exports},"63fc":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.lr_loadPage?e._e():n("l-layout",{staticClass:"l-tab-page",scopedSlots:e._u([{key:"left",fn:function(){return[n("l-panel",{staticStyle:{"padding-right":"0"},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.$t("功能分类"))+" "),n("div",{staticClass:"tree-setting-btn"},[n("el-tooltip",{attrs:{effect:"dark",content:e.$t("分类管理"),placement:"top"}},[n("el-button",{attrs:{type:"text",icon:"el-icon-setting"},on:{click:e.handleSettingClick}})],1)],1)]},proxy:!0}],null,!1,2228074121)},[n("el-tree",{ref:"tree",staticClass:"learun-tree",attrs:{"node-key":"id","highlight-current":!0,data:e.dataItemTree_Function},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node;return n("span",{staticClass:"lr-tree-node"},[n("i",{staticClass:"el-icon-notebook-2"}),e._v(" "+e._s(a.label)+" ")])}}],null,!1,1970407520)})],1)]},proxy:!0}],null,!1,3404993530)},[n("l-panel",{staticStyle:{"padding-left":"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[n("div",{staticClass:"l-panel--item"},[n("el-input",{attrs:{placeholder:e.$t("请输入功能名称"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[n("l-tool-btns",{on:{click:function(t){return e.handleAdd()}}},[n("el-button-group",[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.handleCAdd()}}},[e._v(e._s(e.$t("新增自已定义表单功能")))])],1),n("l-excel-btns")],1)]},proxy:!0}],null,!1,130073863)},[n("l-table",{attrs:{columns:e.columns,dataSource:e.tableShowData,loading:e.loading},scopedSlots:e._u([{key:"f_Type",fn:function(t){return[e._v(" "+e._s(e.lr_dataItemName(e.lr_dataItem["function"],t.row.f_Type))+" ")]}},{key:"f_IsSystem",fn:function(t){return[1===t.row.f_IsSystem?n("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.$t("代码开发")))]):3===t.row.f_IsSystem||4===t.row.f_IsSystem?n("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v(e._s(e.$t("移动桌面")))]):n("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(e.$t("自定义表单")))])]}},{key:"f_EnabledMark",fn:function(t){return[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(n){return e.handleEnableChange(t.row)}},model:{value:t.row.f_EnabledMark,callback:function(n){e.$set(t.row,"f_EnabledMark",n)},expression:"scope.row.f_EnabledMark"}})]}}],null,!1,1650842632)},[n("l-table-btns",{attrs:{filterBtns:e.filterBtns,btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),n("l-dialog",{attrs:{title:e.formTitle,visible:e.formVisible,height:464},on:{"update:visible":function(t){e.formVisible=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[n("my-form",{ref:"form"})],1),n("l-drawer",{attrs:{title:e.$t("分类管理"),visible:e.classifysVisible,showOk:!1,showClose:!1,size:"800px"},on:{"update:visible":function(t){e.classifysVisible=t}}},[n("l-dataitem-index",{attrs:{classifyCode:"function"}})],1),n("l-fullscreen-dialog",{attrs:{title:""+e.$t("功能设计"),headerMidWidth:320,visible:e.cformVisible,isStep:!0,steps:["基本配置","页面设计"],stepActive:e.stepActive,validateSteps:e.handleValidateSteps},on:{"update:visible":function(t){e.cformVisible=t},"update:stepActive":function(t){e.stepActive=t},"update:step-active":function(t){e.stepActive=t},ok:e.handleCSave,closed:e.handleCClosed,opened:e.handleCOpened}},[n("c-my-form",{ref:"cform",attrs:{stepActive:e.stepActive}})],1),n("l-fullscreen-dialog",{attrs:{title:e.$t(e.formTitle),headerMidWidth:320,visible:e.deskVisible,isStep:!0,steps:["基本配置","桌面设计"],stepActive:e.deskStepActive,validateSteps:e.handleDeskValidateSteps},on:{"update:visible":function(t){e.deskVisible=t},"update:stepActive":function(t){e.deskStepActive=t},"update:step-active":function(t){e.deskStepActive=t},ok:e.handleDeskSave,closed:e.handleDeskCloseForm,opened:e.handleDeskOpenedForm}},[n("desk-form",{ref:"deskform",attrs:{stepActive:e.deskStepActive}})],1)],1)},r=[],o=(n("99af"),n("4de4"),n("c740"),n("a434"),n("96cf"),n("1da1")),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"l-auto-window",staticStyle:{padding:"8px","padding-bottom":"0"}},[n("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:e.$t("基础信息"),name:"base"}},[n("div",{staticClass:"l-from-body"},[n("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"60px"}},[n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_Name"}},[n("el-input",{model:{value:e.formData.f_Name,callback:function(t){e.$set(e.formData,"f_Name",t)},expression:"formData.f_Name"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("图标"),prop:"f_Icon"}},[n("l-input-icon",{attrs:{onlyFirst:""},model:{value:e.formData.f_Icon,callback:function(t){e.$set(e.formData,"f_Icon",t)},expression:"formData.f_Icon"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("颜色"),prop:"f_Color"}},[n("l-input-color",{attrs:{placeholder:"请输入"},model:{value:e.formData.f_Color,callback:function(t){e.$set(e.formData,"f_Color",t)},expression:"formData.f_Color"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("分类"),prop:"f_Type"}},[n("el-select",{attrs:{placeholder:e.$t("请选择分类")},model:{value:e.formData.f_Type,callback:function(t){e.$set(e.formData,"f_Type",t)},expression:"formData.f_Type"}},e._l(e.lr_dataItem["function"],(function(e){return n("el-option",{key:e.f_ItemValue,attrs:{label:e.f_ItemName,value:e.f_ItemValue}})})),1)],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("排序"),prop:"f_SortCode"}},[n("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.formData.f_SortCode,callback:function(t){e.$set(e.formData,"f_SortCode",t)},expression:"formData.f_SortCode"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("地址"),prop:"f_Url"}},[n("el-input",{model:{value:e.formData.f_Url,callback:function(t){e.$set(e.formData,"f_Url",t)},expression:"formData.f_Url"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("状态")}},[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.formData.f_EnabledMark,callback:function(t){e.$set(e.formData,"f_EnabledMark",t)},expression:"formData.f_EnabledMark"}})],1)],1)],1)],1)]),n("el-tab-pane",{attrs:{label:e.$t("按钮信息"),name:"btninfo"}},[n("div",{staticClass:"l-from-table-body"},[n("l-edit-table",{attrs:{addBtnText:"添加按钮",dataSource:e.formButtons},on:{addRow:e.handleAddButton,deleteRow:e.handleDeleteButton}},[n("el-table-column",{attrs:{prop:"f_FullName",label:e.$t("名称"),minWidth:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.f_Name,callback:function(n){e.$set(t.row,"f_Name",n)},expression:"scope.row.f_Name"}})]}}])}),n("el-table-column",{attrs:{prop:"f_EnCode",label:e.$t("编号"),minWidth:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.f_Code,callback:function(n){e.$set(t.row,"f_Code",n)},expression:"scope.row.f_Code"}})]}}])})],1)],1)]),n("el-tab-pane",{attrs:{label:e.$t("列表信息"),name:"colinfo"}},[n("div",{staticClass:"l-from-table-body"},[n("l-edit-table",{attrs:{addBtnText:"添加列表字段",dataSource:e.formColumns},on:{addRow:e.handleAddColumns,deleteRow:e.handleDeleteColumns}},[n("el-table-column",{attrs:{prop:"f_FullName",label:e.$t("名称"),minWidth:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.f_Name,callback:function(n){e.$set(t.row,"f_Name",n)},expression:"scope.row.f_Name"}})]}}])}),n("el-table-column",{attrs:{prop:"f_EnCode",label:e.$t("编号"),minWidth:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.f_Code,callback:function(n){e.$set(t.row,"f_Code",n)},expression:"scope.row.f_Code"}})]}}])})],1)],1)]),n("el-tab-pane",{attrs:{label:e.$t("表单信息"),name:"forminfo"}},[n("div",{staticClass:"l-from-table-body"},[n("l-edit-table",{attrs:{addBtnText:"添加表单字段",dataSource:e.formForms},on:{addRow:e.handleAddForms,deleteRow:e.handleDeleteForms}},[n("el-table-column",{attrs:{prop:"f_FullName",label:e.$t("名称"),minWidth:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.f_Name,callback:function(n){e.$set(t.row,"f_Name",n)},expression:"scope.row.f_Name"}})]}}])}),n("el-table-column",{attrs:{prop:"f_EnCode",label:e.$t("编号"),minWidth:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-input",{attrs:{size:"mini",placeholder:e.$t("请输入")},model:{value:t.row.f_Code,callback:function(n){e.$set(t.row,"f_Code",n)},expression:"scope.row.f_Code"}})]}}])})],1)],1)])],1)],1)},i=[],l=n("2909"),c={props:{},data:function(){return{activeName:"base",formData:{f_Name:"",f_Type:"",f_Icon:"learun-icon-star",f_Color:"#3c9cff",f_EnabledMark:1,f_SortCode:"",f_Url:"",f_IsSystem:1},rules:{f_Name:[{required:!0,message:this.$t("请输入名称")}],f_Icon:[{required:!0,message:this.$t("请选择图标")}],f_Color:[{required:!0,message:this.$t("请选择颜色"),trigger:"blur"}],f_Type:[{required:!0,message:this.$t("请选择分类")}],f_Url:[{required:!0,message:this.$t("请输入地址")}]},formButtons:[],formColumns:[],formForms:[]}},computed:{},methods:{resetForm:function(){this.activeName="base",this.$refs.form&&this.$refs.form.resetFields(),this.formButtons=[],this.formColumns=[],this.formForms=[]},validateForm:function(e){this.$refs.form.validate((function(t){t&&e()}))},setForm:function(e){this.formData=this.$deepClone(e.functionEntity);var t=e.moduleItemEntitys||[];this.formButtons=t.filter((function(e){return 1==e.f_Type})),this.formColumns=t.filter((function(e){return 2==e.f_Type})),this.formForms=t.filter((function(e){return 3==e.f_Type}))},getForm:function(){var e=[];e.push.apply(e,Object(l["a"])(this.formButtons.filter((function(e){return e.f_Name&&e.f_Code})))),e.push.apply(e,Object(l["a"])(this.formColumns.filter((function(e){return e.f_Name&&e.f_Code})))),e.push.apply(e,Object(l["a"])(this.formForms.filter((function(e){return e.f_Name&&e.f_Code}))));var t={functionEntity:this.$deepClone(this.formData),moduleItemEntitys:e};return t},handleAddButton:function(){this.formButtons.push({f_Name:"",f_Code:"",f_Type:1})},handleDeleteButton:function(e){this.formButtons.splice(e.index,1)},handleAddColumns:function(){this.formColumns.push({f_Name:"",f_Code:"",f_Type:2})},handleDeleteColumns:function(e){this.formColumns.splice(e.index,1)},handleAddForms:function(){this.formForms.push({f_Name:"",f_Code:"",f_Type:3})},handleDeleteForms:function(e){this.formForms.splice(e.index,1)}}},u=c,d=n("2877"),f=Object(d["a"])(u,s,i,!1,null,null,null),m=f.exports,p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"l-rblock"},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.steps(0),expression:"steps(0)"}],staticClass:"l-rblock",staticStyle:{padding:"24px"}},[n("div",{staticClass:"l-page-panel"},[n("el-form",{ref:"baseInfo",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"80px"}},[n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_Name"}},[n("el-input",{model:{value:e.formData.f_Name,callback:function(t){e.$set(e.formData,"f_Name",t)},expression:"formData.f_Name"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("图标"),prop:"f_Icon"}},[n("l-input-icon",{attrs:{onlyFirst:""},model:{value:e.formData.f_Icon,callback:function(t){e.$set(e.formData,"f_Icon",t)},expression:"formData.f_Icon"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("颜色"),prop:"f_Color"}},[n("l-input-color",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.f_Color,callback:function(t){e.$set(e.formData,"f_Color",t)},expression:"formData.f_Color"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("表单选择"),prop:"f_FormCode"}},[n("l-custmerform-select",{attrs:{placeholder:e.$t("请选择")},on:{change:e.custmerformChange},model:{value:e.formData.f_FormCode,callback:function(t){e.$set(e.formData,"f_FormCode",t)},expression:"formData.f_FormCode"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("表单版本"),prop:"f_FormVerison"}},[n("l-select",{attrs:{options:e.formVerisons,placeholder:e.$t("请选择")},model:{value:e.formData.f_FormVerison,callback:function(t){e.$set(e.formData,"f_FormVerison",t)},expression:"formData.f_FormVerison"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("分类"),prop:"f_Type"}},[n("el-select",{attrs:{placeholder:e.$t("请选择分类")},model:{value:e.formData.f_Type,callback:function(t){e.$set(e.formData,"f_Type",t)},expression:"formData.f_Type"}},e._l(e.lr_dataItem["function"],(function(e){return n("el-option",{key:e.f_ItemValue,attrs:{label:e.f_ItemName,value:e.f_ItemValue}})})),1)],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("排序"),prop:"f_SortCode"}},[n("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.formData.f_SortCode,callback:function(t){e.$set(e.formData,"f_SortCode",t)},expression:"formData.f_SortCode"}})],1)],1),n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:e.$t("状态")}},[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.formData.f_EnabledMark,callback:function(t){e.$set(e.formData,"f_EnabledMark",t)},expression:"formData.f_EnabledMark"}})],1)],1)],1)],1)]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.steps(1),expression:"steps(1)"}],staticClass:"l-rblock"},[n("l-layout",{staticClass:"l-tab-page"},[n("l-panel",[n("div",{staticClass:"l-auto-window"},[n("el-tabs",{attrs:{stretch:!0},model:{value:e.pageActiveName,callback:function(t){e.pageActiveName=t},expression:"pageActiveName"}},[n("el-tab-pane",{attrs:{label:e.$t("列表设置"),name:"tab01"}},[n("webcode-columns",{ref:"columnsOp",attrs:{columnsTree:e.columnsTree}})],1),n("el-tab-pane",{attrs:{label:e.$t("查询设置"),name:"tab02"}},[n("webcode-query",{ref:"queryOp",attrs:{queryTree:e.queryTree}})],1),n("el-tab-pane",{attrs:{label:e.$t("按钮设置"),name:"tab03"}},[n("webcode-btns",{ref:"btnOp",attrs:{formType:e.formScheme&&1==e.formScheme.formType?1:0}})],1)],1)],1)])],1)],1)])},h=[],b=(n("caad"),n("d81d"),n("b0c0"),n("a9e3"),n("d3b7"),n("159b"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("l-layout",{staticStyle:{background:"#f1f2f5"},attrs:{left:240},scopedSlots:e._u([{key:"left",fn:function(){return[n("l-panel",{staticStyle:{padding:"8px 0 0 0"},attrs:{title:"列字段"}},[n("el-tree",{ref:"maintree",attrs:{"default-expand-all":"","show-checkbox":"","node-key":"id","highlight-current":!0,data:e.columnsTree},on:{check:e.handleColumnsCheck},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node;return n("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(a.label)+" ")])}}])})],1)]},proxy:!0}])},[n("l-panel",{staticStyle:{padding:"8px 0 0 4px"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[n("div",{staticClass:"l-panel--item",attrs:{size:"mini"}},[n("span",{staticStyle:{width:"80px"}},[e._v("排序字段")]),n("l-select",{attrs:{size:"mini",valueKey:"prop",options:e.columnsTree[0].children},model:{value:e.config.table.sidx,callback:function(t){e.$set(e.config.table,"sidx",t)},expression:"config.table.sidx"}})],1),n("div",{staticClass:"l-panel--item",attrs:{size:"mini"}},[n("span",{staticStyle:{width:"80px"}},[e._v("是否倒序")]),n("el-switch",{model:{value:e.config.table.isDESC,callback:function(t){e.$set(e.config.table,"isDESC",t)},expression:"config.table.isDESC"}})],1)]},proxy:!0}])},[n("l-table",{attrs:{dataSource:e.config.table.columns,columns:e.columns,isSortable:!0,rowKey:"id",isShowNum:!1},scopedSlots:e._u([{key:"width",fn:function(t){return[n("el-input",{attrs:{size:"mini"},model:{value:t.row.width,callback:function(n){e.$set(t.row,"width",n)},expression:"scope.row.width"}})]}},{key:"align",fn:function(t){return[n("el-select",{attrs:{size:"mini"},model:{value:t.row.align,callback:function(n){e.$set(t.row,"align",n)},expression:"scope.row.align"}},e._l([{value:"left",label:"左"},{value:"center",label:"中"},{value:"right",label:"右"}],(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])})],1)],1)}),_=[],v={name:"webcode-columns",inject:["formConfig"],props:["columnsTree"],components:{},computed:{config:function(){return this.formConfig}},data:function(){return{columns:[{label:"列名",prop:"label",minWidth:"150"},{label:"宽度",prop:"width",width:"120",align:"center"},{label:"对齐",prop:"align",width:"100",align:"center"}]}},created:function(){},methods:{handleColumnsCheck:function(e,t){var n,a=this,r=t.checkedNodes.filter((function(e){return void 0!=e.prop&&-1==a.config.table.columns.findIndex((function(t){return t.prop==e.prop}))})),o=this.config.table.columns.filter((function(e){return-1==t.checkedNodes.findIndex((function(t){return t.prop==e.prop}))}));(o.length>0&&(this.config.table.columns=this.config.table.columns.filter((function(e){return-1==o.findIndex((function(t){return t.prop==e.prop}))}))),r.length>0)&&(n=this.config.table.columns).push.apply(n,Object(l["a"])(r))},setCheckedKeys:function(e){this.$refs.maintree.setCheckedKeys(e)}}},y=v,g=Object(d["a"])(y,b,_,!1,null,null,null),k=g.exports,C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("l-layout",{staticStyle:{background:"#f1f2f5"},attrs:{left:240},scopedSlots:e._u([{key:"left",fn:function(){return[n("l-panel",{staticStyle:{padding:"8px 0 0 0"},attrs:{title:"查询字段"}},[n("el-tree",{ref:"tree",attrs:{"default-expand-all":"","show-checkbox":"","node-key":"id","highlight-current":!0,data:e.queryTree},on:{check:e.handleQueryCheck},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node;return n("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(a.label)+" ")])}}])})],1)]},proxy:!0}])},[n("l-panel",{staticStyle:{padding:"8px 0 0 4px"}},[n("l-table",{attrs:{dataSource:e.config.table.querys,columns:e.columns,isSortable:!0,rowKey:"id",isShowNum:!1}})],1)],1)},w=[],x={name:"webcode-query",inject:["formConfig"],props:["queryTree"],components:{},computed:{config:function(){return this.formConfig}},data:function(){return{columns:[{label:"查询字段名",prop:"label",minWidth:"150"}]}},methods:{handleQueryCheck:function(e,t){var n,a=this,r=t.checkedNodes.filter((function(e){return void 0!=e.prop&&-1==a.config.table.querys.findIndex((function(t){return t.prop==e.prop}))})),o=this.config.table.querys.filter((function(e){return-1==t.checkedNodes.findIndex((function(t){return t.prop==e.prop}))}));(o.length>0&&(this.config.table.querys=this.config.table.querys.filter((function(e){return-1==o.findIndex((function(t){return t.prop==e.prop}))}))),r.length>0)&&(n=this.config.table.querys).push.apply(n,Object(l["a"])(r))},setCheckedKeys:function(e){this.$refs.tree.setCheckedKeys(e)}}},$=x,S=Object(d["a"])($,C,w,!1,null,null,null),I=S.exports,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("l-layout",{staticStyle:{background:"#f1f2f5"},attrs:{left:240},scopedSlots:e._u([{key:"left",fn:function(){return[n("l-panel",{staticStyle:{padding:"8px 0 0 0"},attrs:{title:"常用按钮"}},[n("el-tree",{ref:"tree",attrs:{"default-expand-all":"","show-checkbox":"","node-key":"id","highlight-current":!0,data:e.myTreeData},on:{check:e.handleCheck},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node;return n("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(a.label)+" ")])}}])})],1)]},proxy:!0}])},[n("l-panel",{staticStyle:{padding:"8px 0 0 4px"}},[n("l-table",{attrs:{dataSource:e.config.btns,columns:e.columns,isSortable:!0,rowKey:"id",isShowNum:!1},scopedSlots:e._u([{key:"isRowBtn",fn:function(t){return[n("el-switch",{attrs:{size:"mini",disabled:["Add","Edit","Delete","Details"].includes(t.row.id)},model:{value:t.row.isRowBtn,callback:function(n){e.$set(t.row,"isRowBtn",n)},expression:"scope.row.isRowBtn"}})]}}])})],1)],1)},T=[],E={name:"webcode-btns",inject:["formConfig"],components:{},props:{formType:Number},computed:{config:function(){return this.formConfig},myTreeData:function(){return this.treeData}},data:function(){return{columns:[{label:"名称",prop:"label",minWidth:"150"},{label:"ID",prop:"prop",minWidth:"120"}],treeData:[{label:"新增",id:"Add",prop:"Add",isRowBtn:!1},{label:"编辑",id:"Edit",prop:"Edit",isRowBtn:!0},{label:"删除",id:"Delete",prop:"Delete",isRowBtn:!0},{label:"详情",id:"Details",prop:"Details",isRowBtn:!0}]}},created:function(){},methods:{handleAddBtn:function(){this.config.btns.push({id:this.$uuid(),label:"",prop:"",icon:"",isRowBtn:!1,notHtml:!1})},handleRemove:function(e){this.config.btns.splice(e,1)},handleCheck:function(e,t){var n,a=this,r=t.checkedNodes.filter((function(e){return-1==a.config.btns.findIndex((function(t){return t.id==e.id}))})),o=this.config.btns.filter((function(e){return-1==t.checkedNodes.findIndex((function(t){return t.id==e.id}))}));(o.length>0&&(this.config.btns=this.config.btns.filter((function(e){return-1==o.findIndex((function(t){return t.id==e.id}))}))),r.length>0)&&(n=this.config.btns).push.apply(n,Object(l["a"])(r))},setCheckedKeys:function(e){this.$refs.tree.setCheckedKeys(e)}}},F=E,R=Object(d["a"])(F,D,T,!1,null,null,null),L=R.exports,N=window.$api.custmerForm.scheme,O={provide:function(){return{formConfig:this.config}},props:{stepActive:{type:Number,default:0}},components:{webcodeColumns:k,webcodeQuery:I,webcodeBtns:L},data:function(){return{pageActiveName:"tab01",columnsTree:[{label:"全选",children:[]}],queryTree:[{label:"全选",children:[]}],colslist:[],config:{btns:[{label:this.$t("新增"),id:"Add",prop:"Add",isRowBtn:!1},{label:this.$t("编辑"),id:"Edit",prop:"Edit",isRowBtn:!0},{label:this.$t("删除"),id:"Delete",prop:"Delete",isRowBtn:!0},{label:this.$t("详情"),id:"Details",prop:"Details",isRowBtn:!0}],table:{columns:[],querys:[],sidx:"",isDESC:!1}},formData:{f_Name:"",f_Type:"",f_Icon:"learun-icon-star",f_Color:"#3c9cff",f_EnabledMark:1,f_SortCode:"",f_Url:"",f_IsSystem:2,f_FormCode:"",f_FormVerison:""},rules:{f_Name:[{required:!0,message:this.$t("请输入名称"),trigger:"blur"}],f_Icon:[{required:!0,message:this.$t("请选择图标"),trigger:"blur"}],f_Color:[{required:!0,message:this.$t("请选择颜色"),trigger:"blur"}],f_FormCode:[{required:!0,message:this.$t("请选择表单"),trigger:"blur"}],f_FormVerison:[{required:!0,message:this.$t("请选择表单版本")}],f_Type:[{required:!0,message:this.$t("请选择分类")}]},formScheme:null}},asyncComputed:{formVerisons:{get:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=[],e.$validatenull(e.formData.f_FormCode)){t.next=5;break}return t.next=4,e.$awaitWraper(N.getHistoryList(e.formData.f_FormCode));case 4:n=t.sent;case 5:return t.abrupt("return",(n||[]).map((function(t){return{label:e.lr_dateFormat(t.f_CreateDate),value:t.f_Id}})));case 6:case"end":return t.stop()}}),t)})))()}}},methods:{steps:function(e){return this.stepActive==e},custmerformChange:function(e){this.formData.f_FormVerison=null==e?"":e.f_SchemeId},validateSteps:function(){var e=this;return new Promise((function(t){e.$refs.baseInfo.validate(function(){var n=Object(o["a"])(regeneratorRuntime.mark((function n(a){var r,o,s,i,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!a){n.next=20;break}return n.next=3,e.$awaitWraper(N.getHistory(e.formData.f_FormVerison));case 3:if(n.t0=n.sent,n.t0){n.next=6;break}n.t0={};case 6:r=n.t0,o=r.f_Scheme,e.formScheme=JSON.parse(o),1==e.formScheme.formType&&(e.config.btns=e.config.btns.filter((function(e){return["Import","Export","Details"].includes(e.id)}))),s=[],e.formScheme.formInfo.tabList.forEach((function(e){s.push.apply(s,Object(l["a"])(e.components.filter((function(e){return!["gridtable","divider","password","viewtable","card","btn","qrcode","barcode"].includes(e.type)}))))})),e.columnsTree[0].children=s.map((function(e){return{id:e.prop,prop:e.prop,label:e.label,width:120,align:"left"}})),i=e.config.table.columns.filter((function(t){return-1!=e.columnsTree[0].children.findIndex((function(e){return e.prop==t.prop}))})),e.config.table.columns=i,e.queryTree[0].children=s.filter((function(e){return!["upload","uploadimg","password","timerange","datetimerange"].includes(e.type)})).map((function(e){return{id:e.prop,prop:e.prop,label:e.label}})),c=e.config.table.querys.filter((function(t){return-1!=e.queryTree[0].children.findIndex((function(e){return e.prop==t.prop}))})),e.config.table.querys=c,e.colslist=s.map((function(e){return{value:e.prop,label:e.label}})),e.$nextTick((function(){e.$refs.columnsOp.setCheckedKeys(i.map((function(e){return e.prop}))),e.$refs.queryOp.setCheckedKeys(c.map((function(e){return e.prop}))),e.$refs.btnOp.setCheckedKeys(e.config.btns.map((function(e){return e.id})))}));case 20:t(a);case 21:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}))},resetForm:function(){this.pageActiveName="tab01",this.formData.f_SchemeId="",this.$refs.baseInfo&&this.$refs.baseInfo.resetFields(),this.config.btns=[{label:this.$t("新增"),id:"Add",prop:"Add",isRowBtn:!1},{label:this.$t("编辑"),id:"Edit",prop:"Edit",isRowBtn:!0},{label:this.$t("删除"),id:"Delete",prop:"Delete",isRowBtn:!0},{label:this.$t("详情"),id:"Details",prop:"Details",isRowBtn:!0}],this.config.table={columns:[],querys:[],sidx:"",isDESC:!1}},setForm:function(e){this.formData=e;var t=JSON.parse(e.scheme);this.config.btns=t.btns,this.config.table=t.table},getForm:function(){var e=this,t={},n=this.$deepClone(this.formData);n.scheme=JSON.stringify(this.$deepClone(this.config)),t.moduleItemEntitys=[],this.config.btns.forEach((function(e){t.moduleItemEntitys.push({f_Code:e.prop,f_Name:e.label,f_Type:1})}));var a={};return this.formScheme.formInfo.tabList.forEach((function(n){n.components.forEach((function(n){if(a[n.prop]=n,!["gridtable","divider","card"].includes(n.type)&&n.display)t.moduleItemEntitys.push({f_Code:n.prop,f_Name:n.label,f_Type:3});else if(["gridtable"].includes(n.type)){var r;(r=t.moduleItemEntitys).push.apply(r,Object(l["a"])(n.children.map((function(t){return{f_Code:"".concat(n.prop,"|").concat(t.prop),f_Name:"".concat(n.label||e.$t("表格"),"-").concat(t.label),f_Type:3}})))),t.moduleItemEntitys.push({f_Code:"".concat(n.prop,"_add"),f_Name:"".concat(n.label||e.$t("表格"),"-添加按钮"),f_Type:3}),t.moduleItemEntitys.push({f_Code:"".concat(n.prop,"_remove"),f_Name:"".concat(n.label||e.$t("表格"),"-删除按钮"),f_Type:3})}else["divider"].includes(n.type)&&t.moduleItemEntitys.push({f_Code:n.prop,f_Name:"".concat(n.label,"-").concat(n.html),f_Type:3})}))})),this.config.table.columns.forEach((function(n){var r=a[n.prop],o="".concat(r.field).concat(1==e.formScheme.formType?"":e.formScheme.db.findIndex((function(e){return e.name==r.table})));t.moduleItemEntitys.push({f_Code:o,f_Name:n.label,f_Type:2})})),t.functionEntity=n,t}}},M=O,A=Object(d["a"])(M,p,h,!1,null,null,null),B=A.exports,W=n("7668"),j=window.$api.mapp.module,P=window.$api.desktop.setting,V={components:{MyForm:m,CMyForm:B,DeskForm:W["a"]},data:function(){return{lr_isPage:!0,treeCategory:"",classifysVisible:!1,searchWord:"",searchTableData:null,loading:!1,columns:[{label:"名称",prop:"f_Name",minWidth:"110"},{label:"分类",prop:"f_Type",width:"120"},{label:"类型",prop:"f_IsSystem",width:"100",align:"center"},{label:"排序",prop:"f_SortCode",width:"64",align:"center"},{label:"状态",prop:"f_EnabledMark",width:"64",align:"center"}],tableBtns:[{prop:"Edit",label:this.$t("编辑"),width:40},{prop:"Delete",label:this.$t("删除"),width:40}],tableData:[],tableShowData:[],formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1,cformVisible:!1,stepActive:0,deskVisible:!1,deskStepActive:0,deskId:""}},computed:{dataItemTree_Function:function(){return this.lr_dataItemTree(this.lr_dataItem["function"])}},mounted:function(){this.lr_loadDataItem("function"),this.loadTableData()},methods:{handleSettingClick:function(){this.classifysVisible=!0},handleNodeClick:function(e){var t=this;this.treeCategory=e.value,this.searchWord="",this.tableShowData=this.tableData.filter((function(e){return e.f_Type==t.treeCategory}))},loadTableData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,e.searchWord="",t.next=4,e.$awaitWraper(j.getList());case 4:n=t.sent,e.loading=!1,e.tableData=n||[],e.tableShowData=e.tableData;case 8:case"end":return t.stop()}}),t)})))()},hanleSearch:function(){var e=this;this.$validatenull(this.searchWord)?this.tableShowData=this.tableData:this.tableShowData=this.tableData.filter((function(t){return-1!=t.f_Name.indexOf(e.searchWord)}))},handleEnableChange:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(3!=e.f_IsSystem&&4!=e.f_IsSystem){n.next=5;break}return n.next=3,P.updateStateByModuleId(e.f_Id,e.f_EnabledMark);case 3:n.next=7;break;case 5:return n.next=7,j.updateState(e.f_Id,e.f_EnabledMark);case 7:t.$message({type:"success",message:t.$t("更新成功!")});case 8:case"end":return n.stop()}}),n)})))()},handleAdd:function(){this.formEdit=!1,this.showForm("新增移动功能")},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,2==t.f_IsSystem?this.cformVisible=!0:3==t.f_IsSystem||4==t.f_IsSystem?(this.formTitle="".concat(this.$t("编辑移动桌面"),"-").concat(t.f_Name),this.deskVisible=!0):this.showForm("编辑移动功能")},handleDelete:function(e,t){var n=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then(Object(o["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n.tableShowData.splice(e,1),r=n.tableData.findIndex((function(e){return e.f_Id==t.f_Id})),-1!=r&&n.tableData.splice(r,1),3!=t.f_IsSystem&&4!=t.f_IsSystem){a.next=7;break}P.removeByModuleId(t.f_Id),a.next=9;break;case 7:return a.next=9,j.remove(t.f_Id);case 9:n.$message({type:"success",message:n.$t("删除成功!")});case 10:case"end":return a.stop()}}),a)})))).catch((function(){n.$message({type:"info",message:n.$t("已取消删除")})}))},handleSave:function(e,t){var n=this;this.$refs.form.validateForm(Object(o["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e(),r=n.$refs.form.getForm(),!n.formEdit){a.next=11;break}return a.next=5,n.$awaitWraper(j.update(n.formEditRow.f_Id,r));case 5:if(!a.sent){a.next=9;break}n.$message({type:"success",message:n.$t("更新成功!")}),n.loadTableData(),n.formVisible=!1;case 9:a.next=17;break;case 11:return a.next=13,n.$awaitWraper(j.add(r));case 13:if(!a.sent){a.next=17;break}n.$message({type:"success",message:n.$t("新增成功!")}),n.loadTableData(),n.formVisible=!1;case 17:t();case 18:case"end":return a.stop()}}),a)}))))},handleOpenedForm:function(e,t){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!n.formEdit){a.next=7;break}return e("加载数据中..."),a.next=4,n.$awaitWraper(j.get(n.formEditRow.f_Id));case 4:r=a.sent,n.$refs.form.setForm(r),t();case 7:case"end":return a.stop()}}),a)})))()},handleCloseForm:function(){this.$refs.form.resetForm()},showForm:function(e){this.formTitle=e,this.formVisible=!0},handleCAdd:function(){this.formEdit=!1,this.cformVisible=!0},handleValidateSteps:function(){return this.$refs.cform.validateSteps()},handleCSave:function(e,t){var n=this;e("保存数据中...");var a=this.$refs.cform.getForm();this.formEdit?j.update(this.formEditRow.f_Id,a).then((function(){n.loadTableData(),n.$message({type:"success",message:n.$t("更新成功!")}),n.cformVisible=!1,t()})).catch((function(){t()})):j.add(a).then((function(){n.loadTableData(),n.$message({type:"success",message:n.$t("保存成功!")}),n.cformVisible=!1,t()})).catch((function(){t()}))},handleCClosed:function(){this.$refs.cform.resetForm()},handleCOpened:function(e,t){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!n.formEdit){a.next=7;break}return e("加载数据中..."),a.next=4,n.$awaitWraper(j.get(n.formEditRow.f_Id));case 4:r=a.sent,n.$refs.cform.setForm(r.functionEntity),t();case 7:case"end":return a.stop()}}),a)})))()},handleDeskValidateSteps:function(){return this.$refs.deskform.validateSteps()},handleDeskSave:function(){var e=this,t=this.$loading({lock:!0,text:this.$t("正在保存配置，请稍后"),spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.2)"});this.$nextTick(Object(o["a"])(regeneratorRuntime.mark((function n(){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$refs.deskform.getForm();case 2:return a=n.sent,n.next=5,e.$awaitWraper(P.update(e.deskId,a));case 5:r=n.sent,r&&(e.$message({type:"success",message:e.$t("编辑成功!")}),e.deskVisible=!1,e.loadTableData()),t.close();case 8:case"end":return n.stop()}}),n)}))))},handleDeskCloseForm:function(){this.$refs.deskform.resetForm()},handleDeskOpenedForm:function(e,t){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e("加载数据中..."),a.next=3,n.$awaitWraper(P.getByModuleId(n.formEditRow.f_Id));case 3:r=a.sent,n.deskId=r.lr_desktop_infoEntity.f_Id,n.$refs.deskform.setForm(r),t();case 7:case"end":return a.stop()}}),a)})))()},filterBtns:function(e,t){return t}}},z=V,q=Object(d["a"])(z,a,r,!1,null,null,null);t["default"]=q.exports},"66b7d":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.lr_loadPage?e._e():n("l-layout",{staticClass:"l-tab-page",scopedSlots:e._u([{key:"left",fn:function(){return[n("l-panel",{staticStyle:{"padding-right":"0"},attrs:{title:e.$t("功能目录")}},[n("el-tree",{staticClass:"learun-tree",attrs:{data:e.modulesExpandTree,"expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return n("span",{staticClass:"lr-tree-node"},[n("i",{class:r.icon}),e._v(" "+e._s(e.$t(a.label))+" ")])}}],null,!1,3179785476)})],1)]},proxy:!0}],null,!1,1548085591)},[n("l-panel",{staticStyle:{"padding-left":"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[n("div",{staticClass:"l-panel--item"},[n("el-input",{attrs:{placeholder:"请输入",size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.keyWord,callback:function(t){e.keyWord=t},expression:"keyWord"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[n("l-tool-btns",{on:{click:function(t){return e.handleAdd()}}},[n("l-excel-btns")],1)]},proxy:!0}],null,!1,2014931294)},[n("l-table",{attrs:{loading:e.tableLoading,columns:e.columns,dataSource:e.tableData,"row-key":"f_Id",isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_CreateDate",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_CreateDate))+" ")]}},{key:"f_PModuleId",fn:function(t){return[e._v(" "+e._s((e.modules.find((function(e){return e.f_ModuleId==t.row.f_PModuleId}))||{}).f_FullName||"")+" ")]}},{key:"f_EnabledMark",fn:function(t){return[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(n){return e.handleEnableChange(t.row)}},model:{value:t.row.f_EnabledMark,callback:function(n){e.$set(t.row,"f_EnabledMark",n)},expression:"scope.row.f_EnabledMark"}})]}}],null,!1,1970126151)},[n("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),n("l-fullscreen-dialog",{attrs:{title:""+e.$t("功能设计"),headerMidWidth:320,visible:e.formVisible,isStep:!0,steps:["基本配置","页面设计"],stepActive:e.stepActive,validateSteps:e.handleValidateSteps},on:{"update:visible":function(t){e.formVisible=t},"update:stepActive":function(t){e.stepActive=t},"update:step-active":function(t){e.stepActive=t},ok:e.handleSave,closed:e.handleClosed,opened:e.handleOpened}},[n("my-form",{ref:"form",attrs:{stepActive:e.stepActive}})],1)],1)},r=[],o=(n("a434"),n("96cf"),n("1da1")),s=n("5530"),i=n("5880"),l=n("f5b0"),c=window.$api.custmerForm.module,u={inject:["admin"],components:{MyForm:l["a"]},data:function(){return{lr_isPage:!0,stepActive:0,formVisible:!1,formEdit:!1,formEditRow:null,treeLoading:!0,treeCategory:"",columns:[{label:"名称",prop:"f_Name",minWidth:"150"},{label:"上级功能",prop:"f_PModuleId",minWidth:"120"},{label:"状态",prop:"f_EnabledMark",width:"64",align:"center"},{label:"创建人",prop:"f_CreateUserName",width:"100",align:"center"},{label:"创建时间",prop:"f_CreateDate",width:"160"}],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1,tableData:[],keyWord:"",tableBtns:[{prop:"Edit",label:"编辑",width:40},{prop:"Delete",label:"删除",width:40}]}},mounted:function(){this.init()},computed:Object(s["a"])({},Object(i["mapGetters"])(["modules","modulesExpandTree"])),methods:{init:function(){this.loadTablePage(!0)},updateModules:function(){this.$store.dispatch("system/module/getList")},loadTablePage:function(){var e=this;this.tableLoading=!0;var t={rows:this.tablePageSize,page:this.tableCurrentPage,sidx:"F_ModifyDate DESC,F_CreateDate DESC",keyWord:this.keyWord,f_PModuleId:this.treeCategory};c.getPage(t).then((function(t){var n=e.$deepClone(t.data.data);e.tableData=n.rows,e.tableTotal=n.records,e.tableLoading=!1})).catch((function(){e.tableData=[],e.tableLoading=!1}))},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTablePage(!0)},handleNodeClick:function(e){this.treeCategory=e.id,this.tableCurrentPage=1,this.loadTablePage()},hanleSearch:function(){this.loadTablePage()},handleAdd:function(){this.formEdit=!1,this.showForm()},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.showForm()},handleDelete:function(e,t){var n=this;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){n.tableData.splice(e,1),n.tableTotal--,c.remove(t.f_Id).then((function(){n.$message({type:"success",message:"删除成功!"}),n.updateModules()}))})).catch((function(){n.$message({type:"info",message:"已取消删除"})}))},handleEnableChange:function(e){var t=this;c.updateState(e.f_Id,e.f_EnabledMark).then((function(){t.$message({type:"success",message:"更新成功!"}),t.updateModules()}))},handleSave:function(e,t){var n=this;e("保存数据中...");var a=this.$refs.form.getForm();this.formEdit?c.update(this.formEditRow.f_Id,a).then((function(){n.loadTablePage(),n.updateModules(),n.$message({type:"success",message:"更新成功!"}),n.formVisible=!1,t()})).catch((function(){t()})):c.add(a).then((function(){n.loadTablePage(),n.updateModules(),n.$message({type:"success",message:"保存成功!"}),n.formVisible=!1,t()})).catch((function(){t()}))},showForm:function(){this.formVisible=!0},handleValidateSteps:function(){return this.$refs.form.validateSteps()},handleOpened:function(e,t){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!n.formEdit){a.next=7;break}return e("加载数据中..."),a.next=4,n.$awaitWraper(c.get(n.formEditRow.f_Id));case 4:r=a.sent,n.$refs.form.setForm(r),t();case 7:case"end":return a.stop()}}),a)})))()},handleClosed:function(){this.$refs.form.resetForm()}}},d=u,f=n("2877"),m=Object(f["a"])(d,a,r,!1,null,null,null);t["default"]=m.exports},"7bd9":function(e,t,n){"use strict";n("9230")},8785:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.lr_loadPage?e._e():n("l-layout",{staticClass:"l-tab-page",scopedSlots:e._u([{key:"left",fn:function(){return[n("l-panel",{staticStyle:{"padding-right":"0"},attrs:{title:e.$t("功能目录")}},[n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"learun-tree",attrs:{data:e.modulesTree,"expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return n("span",{staticClass:"lr-tree-node"},[n("i",{class:r.icon}),e._v(" "+e._s(e.$t(a.label))+" ")])}}],null,!1,3179785476)})],1)]},proxy:!0}],null,!1,4118063176)},[n("l-panel",{staticStyle:{"padding-left":"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[n("div",{staticClass:"l-panel--item"},[n("el-input",{attrs:{placeholder:e.$t("请输入名称"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[n("l-tool-btns",{attrs:{hasAdd:!1}},[n("l-excel-btns")],1)]},proxy:!0}],null,!1,2049612143)},[n("l-table",{attrs:{columns:e.columns,dataSource:e.searchTableData||e.tableData,loading:e.loading}},[n("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),n("l-dialog",{attrs:{title:e.formTitle,visible:e.formVisible,width:500,height:48*e.columns.length+88},on:{"update:visible":function(t){e.formVisible=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[n("my-form",{ref:"form"})],1)],1)},r=[],o=(n("4de4"),n("7db0"),n("c740"),n("caad"),n("ac1f"),n("1276"),n("159b"),n("96cf"),n("1da1")),s=n("5530"),i=n("5880"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.ready?n("div",{staticClass:"l-from-body"},[n("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"100px"}},e._l(e.typeList,(function(t,a){return n("el-col",{key:a,attrs:{span:24}},[n("el-form-item",{attrs:{label:t.f_Name,prop:t.f_Code}},[n("el-input",{model:{value:e.formData[t.f_Code],callback:function(n){e.$set(e.formData,t.f_Code,n)},expression:"formData[item.f_Code]"}})],1)],1)})),1)],1):e._e()},c=[],u={data:function(){return{formData:{},rules:{},ready:!1}},computed:{typeList:function(){return this.$store.state.language.type.list},mainType:function(){return this.typeList.find((function(e){return 1==e.f_IsMain}))||{}}},created:function(){var e=this;this.typeList.forEach((function(t){e.$set(e.formData,t.f_Code,"")})),this.ready=!0},methods:{resetForm:function(){this.formData.f_code="",this.$refs.form&&this.$refs.form.resetFields()},validateForm:function(){return!this.$validatenull(this.formData[this.mainType.f_Code])||(this.$message({type:"error",message:"请输入".concat(this.mainType.f_Name)}),!1)},setForm:function(e){this.formData=e},getForm:function(){var e=this,t=[];return this.typeList.forEach((function(n){t.push({f_Name:e.formData[n.f_Code],f_TypeCode:n.f_Code})})),t}}},d=u,f=n("2877"),m=Object(f["a"])(d,l,c,!1,null,null,null),p=m.exports,h=window.$api.language.mapping,b=window.$api.system.module,_={inject:["admin"],components:{MyForm:p},data:function(){return{lr_isPage:!0,loading:!1,tableBtns:[{prop:"Edit",label:this.$t("编辑"),width:60}],tableData:[],searchWord:"",searchTableData:null,currentModuleId:"0",formVisible:!1,formTitle:"",formEditRow:null}},computed:Object(s["a"])(Object(s["a"])({},Object(i["mapGetters"])(["modulesTree","modulesGroup","modules"])),{},{typeList:function(){return this.$store.state.language.type.list},mainType:function(){return this.appConfig.language.mainType},columns:function(){var e=[];return this.typeList.forEach((function(t){e.push({label:t.f_Name,prop:t.f_Code,minWidth:"120"})})),e}}),mounted:function(){this.updateModules()},methods:{updateModules:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.$store.dispatch("system/module/getList");case 3:return t.next=5,e.loadTableData("0");case 5:e.loading=!1;case 6:case"end":return t.stop()}}),t)})))()},loadTableData:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var a,r,o,s,i,l,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=[],r={},o=t.modulesGroup[e]||[],!(o.length>0)){n.next=11;break}return n.next=6,t.$awaitWraper(h.getModuleList(e,1));case 6:s=n.sent,s.forEach((function(e){r[e[t.mainType]]=e})),o.forEach((function(e){if(r[e.f_FullName])a.push(r[e.f_FullName]);else{var n={};n[t.mainType]=e.f_FullName,a.push(n)}})),n.next=23;break;case 11:if(i=t.modules.find((function(t){return t.f_ModuleId==e})),!i||!["view","custmerForm"].includes(i.f_Target)){n.next=23;break}return n.next=15,t.$awaitWraper(h.getModuleList(e,0));case 15:return l=n.sent,l.forEach((function(e){r[e[t.mainType]]=e})),n.next=19,t.$awaitWraper(b.get(e));case 19:c=n.sent,c.buttons.forEach((function(e){if(-1==a.findIndex((function(n){return n[t.mainType]==e.f_FullName})))if(r[e.f_FullName])a.push(r[e.f_FullName]);else{var n={};n[t.mainType]=e.f_FullName,a.push(n)}})),c.columns.forEach((function(e){if(-1==a.findIndex((function(n){return n[t.mainType]==e.f_FullName})))if(r[e.f_FullName])a.push(r[e.f_FullName]);else{var n={};n[t.mainType]=e.f_FullName,a.push(n)}})),c.forms.forEach((function(e){var n=e.f_FullName,o=n.split("-");if(o.length>1&&(n=o[o.length-1]),-1==a.findIndex((function(e){return e[t.mainType]==n})))if(r[n])a.push(r[n]);else{var s={};s[t.mainType]=n,a.push(s)}}));case 23:t.tableData=a;case 24:case"end":return n.stop()}}),n)})))()},handleNodeClick:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.loading=!0,t.currentModuleId=e.id,n.next=4,t.loadTableData(e.id);case 4:t.loading=!1;case 5:case"end":return n.stop()}}),n)})))()},hanleSearch:function(){var e=this;this.searchWord?this.searchTableData=this.tableData.filter((function(t){return t[e.mainType].indexOf(e.searchWord)>-1})):this.searchTableData=null},handleEdit:function(e,t){this.formEditRow=t,this.showForm("编辑翻译")},handleSave:function(e,t){var n=this;if(this.$refs.form.validateForm()){var a=this.$refs.form.getForm();e(),this.formEditRow.f_code?h.update(this.formEditRow.f_code,a).then((function(){t(),n.formVisible=!1,n.loadTableData(n.currentModuleId)})).catch((function(){t()})):h.add(a).then((function(){t(),n.formVisible=!1,n.loadTableData(n.currentModuleId)})).catch((function(){t()}))}},handleOpenedForm:function(){this.$refs.form.setForm(this.$deepClone(this.formEditRow))},handleCloseForm:function(){this.$refs.form.resetForm()},showForm:function(e){this.formTitle=e,this.formVisible=!0}}},v=_,y=Object(f["a"])(v,a,r,!1,null,null,null);t["default"]=y.exports},9230:function(e,t,n){}}]);