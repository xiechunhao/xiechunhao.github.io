(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["purchase-form"],{c57c:function(e,a,r){"use strict";r.r(a);var t=function(){var e=this,a=e.$createElement,r=e._self._c||a;return r("div",{staticClass:"l-rblock learun-el-form-left",staticStyle:{padding:"16px",overflow:"hidden auto"}},[r("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini",labelPosition:"left",labelWidth:"96px"}},[r("el-row",{attrs:{gutter:78}},[r("div",{staticClass:"l-rblock"},[r("el-col",{attrs:{span:24}},[r("div",{staticClass:"learun-form-title"},[e._v(e._s(e.$t("基础信息")))])]),e.lr_formLookAuth("case_erp_purchase_f_Number")?r("el-col",{staticStyle:{"padding-right":"0"},attrs:{span:9}},[r("el-form-item",{attrs:{label:e.$t("采购单号"),prop:"case_erp_purchase_f_Number"}},[0==parseInt(e.formData.case_erp_purchase_f_IsSysNum)?r("l-code",{attrs:{size:"mini",code:"erp_purchase_num"},model:{value:e.formData.case_erp_purchase_f_Number,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_Number",a)},expression:"formData.case_erp_purchase_f_Number"}}):r("el-input",{attrs:{disabled:!e.lr_formEditAuth("case_erp_apply_f_Number",e.isReadOnly||e.isEdit)},model:{value:e.formData.case_erp_apply_f_Number,callback:function(a){e.$set(e.formData,"case_erp_apply_f_Number",a)},expression:"formData.case_erp_apply_f_Number"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_IsSysNum")?r("el-col",{staticStyle:{"padding-left":"4px"},attrs:{span:3}},[r("el-form-item",{attrs:{label:e.$t(""),prop:"case_erp_purchase_f_IsSysNum",labelWidth:"0px"}},[r("l-checkbox",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_IsSysNum",e.isReadOnly||e.isEdit),options:e.case_erp_purchase_f_IsSysNumOptions},on:{change:e.handleCodeTypeChange},model:{value:e.formData.case_erp_purchase_f_IsSysNum,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_IsSysNum",a)},expression:"formData.case_erp_purchase_f_IsSysNum"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_ApplyId")?r("el-col",{staticStyle:{"padding-right":"0"},attrs:{span:9}},[r("el-form-item",{attrs:{label:e.$t("关联申请单"),prop:"case_erp_purchase_f_ApplyId"}},[r("el-input",{attrs:{readonly:"",disabled:1==parseInt(e.formData.case_erp_purchase_f_IsRelated)||e.isReadOnly||e.isEdit},on:{focus:function(a){return e.handleShowApply()}},model:{value:e.formData.case_erp_purchase_f_ApplyId,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_ApplyId",a)},expression:"formData.case_erp_purchase_f_ApplyId"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_IsRelated")?r("el-col",{staticStyle:{"padding-left":"4px"},attrs:{span:3}},[r("el-form-item",{attrs:{label:e.$t(""),prop:"case_erp_purchase_f_IsRelated",labelWidth:"0px"}},[r("l-checkbox",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_IsRelated",e.isReadOnly||e.isEdit),options:e.case_erp_purchase_f_IsRelatedOptions},on:{change:e.handleIsRelatedChange},model:{value:e.formData.case_erp_purchase_f_IsRelated,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_IsRelated",a)},expression:"formData.case_erp_purchase_f_IsRelated"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_Theme")?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:e.$t("订单主题"),prop:"case_erp_purchase_f_Theme"}},[r("el-input",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_Theme",e.isReadOnly),placeholder:e.$t("请输入")},model:{value:e.formData.case_erp_purchase_f_Theme,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_Theme",a)},expression:"formData.case_erp_purchase_f_Theme"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_PurchaseDate")?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("采购日期"),prop:"case_erp_purchase_f_PurchaseDate"}},[r("l-date",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_PurchaseDate",e.isReadOnly),readonly:!1,format:"yyyy-MM-dd",dateType:"date",clearable:!0,placeholder:e.$t("请选择")},model:{value:e.formData.case_erp_purchase_f_PurchaseDate,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_PurchaseDate",a)},expression:"formData.case_erp_purchase_f_PurchaseDate"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_SupplierName")?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("供应商名称"),prop:"case_erp_purchase_f_SupplierName"}},[r("l-select",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_SupplierName",e.isReadOnly),options:e.case_erp_purchase_f_SupplierNameOptions},on:{change:e.changeSupplier},model:{value:e.formData.case_erp_purchase_f_SupplierName,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_SupplierName",a)},expression:"formData.case_erp_purchase_f_SupplierName"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_SupplierPerson")?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("联系人"),prop:"case_erp_purchase_f_SupplierPerson"}},[r("el-input",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_SupplierPerson",e.isReadOnly),placeholder:e.$t("请输入")},model:{value:e.formData.case_erp_purchase_f_SupplierPerson,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_SupplierPerson",a)},expression:"formData.case_erp_purchase_f_SupplierPerson"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_SupplierWay")?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("联系方式"),prop:"case_erp_purchase_f_SupplierWay"}},[r("el-input",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_SupplierWay",e.isReadOnly),placeholder:e.$t("请输入")},model:{value:e.formData.case_erp_purchase_f_SupplierWay,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_SupplierWay",a)},expression:"formData.case_erp_purchase_f_SupplierWay"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_PurchaseDep")?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("采购部门"),prop:"case_erp_purchase_f_PurchaseDep"}},[r("l-department-select",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_PurchaseDep",e.isReadOnly)},model:{value:e.formData.case_erp_purchase_f_PurchaseDep,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_PurchaseDep",a)},expression:"formData.case_erp_purchase_f_PurchaseDep"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_PurchasePerson")?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("采购人员"),prop:"case_erp_purchase_f_PurchasePerson"}},[r("l-user-select",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_PurchasePerson",e.isReadOnly),isDepartment:"",department:e.formData.case_erp_purchase_f_PurchaseDep},on:{change:e.purchaseUserSelect,userLoaded:e.purchaseUserSelect},model:{value:e.formData.case_erp_purchase_f_PurchasePerson,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_PurchasePerson",a)},expression:"formData.case_erp_purchase_f_PurchasePerson"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_PurchasePhone")?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("联系电话"),prop:"case_erp_purchase_f_PurchasePhone"}},[r("el-input",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_PurchasePhone",e.isReadOnly),placeholder:e.$t("请输入")},model:{value:e.formData.case_erp_purchase_f_PurchasePhone,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_PurchasePhone",a)},expression:"formData.case_erp_purchase_f_PurchasePhone"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_RelatedProject")?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("关联项目"),prop:"case_erp_purchase_f_RelatedProject"}},[r("l-select",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_RelatedProject",e.isReadOnly),options:e.case_erp_purchase_f_RelatedProjectOptions},model:{value:e.formData.case_erp_purchase_f_RelatedProject,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_RelatedProject",a)},expression:"formData.case_erp_purchase_f_RelatedProject"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_PayType")?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("结算方式"),prop:"case_erp_purchase_f_PayType"}},[r("l-select",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_PayType",e.isReadOnly),options:e.case_erp_purchase_f_PayTypeOptions},model:{value:e.formData.case_erp_purchase_f_PayType,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_PayType",a)},expression:"formData.case_erp_purchase_f_PayType"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_PayAddress")?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:e.$t("支付地址"),prop:"case_erp_purchase_f_PayAddress"}},[r("el-input",{attrs:{disabled:!e.lr_formEditAuth("case_erp_purchase_f_PayAddress",e.isReadOnly),placeholder:e.$t("请输入")},model:{value:e.formData.case_erp_purchase_f_PayAddress,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_PayAddress",a)},expression:"formData.case_erp_purchase_f_PayAddress"}})],1)],1):e._e(),e.lr_formLookAuth("case_erp_purchase_f_Description")?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:e.$t("备注"),prop:"case_erp_purchase_f_Description"}},[r("el-input",{attrs:{type:"textarea",disabled:!e.lr_formEditAuth("case_erp_purchase_f_Description",e.isReadOnly),placeholder:e.$t("请输入")},model:{value:e.formData.case_erp_purchase_f_Description,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_Description",a)},expression:"formData.case_erp_purchase_f_Description"}})],1)],1):e._e(),r("el-col",{attrs:{span:12}},[r("div",{staticClass:"learun-form-title"},[e._v("采购物料")])]),r("el-col",{attrs:{span:12}},[r("div",{staticStyle:{"text-align":"right"}},[r("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.handleCase_erp_purchasedetailAddRow}},[e._v(e._s(e.$t("添加")))]),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:e.handleCase_erp_purchasedetailRemoveRow}},[e._v(e._s(e.$t("移除")))])],1)]),e.lr_formLookAuth("1670914821908_15394")?r("el-col",{attrs:{span:24}},[r("l-edit-table",{ref:"purchasedetail",attrs:{columns:e.lr_formTableAuth("case_erp_purchasedetail",e.case_erp_purchasedetail_columns),isMultiSelect:"",isAddBtn:!1,dataSource:e.case_erp_purchasedetail_data,rowKey:"f_Id",summaryList:[{label:"总量",prop:"f_Count",decimals:0},{label:"总金额",prop:"f_AfterTaxAmount"}],showSummary2:""},on:{deleteRow:e.deleteRow},scopedSlots:e._u([{key:"f_Price",fn:function(a){return[r("el-input",{attrs:{size:"mini",disabled:!e.lr_formTableEditAuth("case_erp_purchasedetail","f_Price",e.isReadOnly),placeholder:e.$t("请输入")},on:{input:function(r){return e.handleRowChange(a.row)}},model:{value:a.row.f_Price,callback:function(r){e.$set(a.row,"f_Price",r)},expression:"scope.row.f_Price"}})]}},{key:"f_Count",fn:function(a){return[r("el-input-number",{attrs:{"controls-position":"right",size:"mini",disabled:!e.lr_formTableEditAuth("case_erp_purchasedetail","f_Count",e.isReadOnly)},on:{change:function(r){return e.handleRowChange(a.row)}},model:{value:a.row.f_Count,callback:function(r){e.$set(a.row,"f_Count",r)},expression:"scope.row.f_Count"}})]}},{key:"f_Discount",fn:function(a){return[r("el-input",{attrs:{size:"mini",disabled:!e.lr_formTableEditAuth("case_erp_purchasedetail","f_Discount",e.isReadOnly)},on:{input:function(r){return e.handleRowChange(a.row)}},model:{value:a.row.f_Discount,callback:function(r){e.$set(a.row,"f_Discount",r)},expression:"scope.row.f_Discount"}})]}},{key:"f_TaxRate",fn:function(a){return[r("el-input",{attrs:{size:"mini",disabled:!e.lr_formTableEditAuth("case_erp_purchasedetail","f_TaxRate",e.isReadOnly)},on:{input:function(r){return e.handleRowChange(a.row)}},model:{value:a.row.f_TaxRate,callback:function(r){e.$set(a.row,"f_TaxRate",r)},expression:"scope.row.f_TaxRate"}})]}},{key:"f_TaxBreak",fn:function(a){return[r("el-input",{attrs:{size:"mini",disabled:""},model:{value:a.row.f_TaxBreak,callback:function(r){e.$set(a.row,"f_TaxBreak",r)},expression:"scope.row.f_TaxBreak"}})]}},{key:"f_AfterTaxAmount",fn:function(a){return[r("el-input",{attrs:{size:"mini",disabled:""},model:{value:a.row.f_AfterTaxAmount,callback:function(r){e.$set(a.row,"f_AfterTaxAmount",r)},expression:"scope.row.f_AfterTaxAmount"}})]}},{key:"f_DeliveryDate",fn:function(a){return[r("l-date",{attrs:{size:"mini",disabled:!e.lr_formTableEditAuth("case_erp_purchasedetail","f_DeliveryDate",e.isReadOnly),readonly:!1,format:"yyyy-MM-dd",dateType:"date",clearable:!0,placeholder:e.$t("请选择")},model:{value:a.row.f_DeliveryDate,callback:function(r){e.$set(a.row,"f_DeliveryDate",r)},expression:"scope.row.f_DeliveryDate"}})]}}],null,!1,181681233)})],1):e._e(),r("el-col",{attrs:{span:24}},[r("div",{staticClass:"learun-form-title mt-8"},[e._v("附件")])]),e.lr_formLookAuth("case_erp_purchase_f_File")?r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{prop:"case_erp_purchase_f_File",labelWidth:"0"}},[r("l-upload",{attrs:{drag:"",maxSize:"10",sizeType:"MB",limit:3,disabled:!e.lr_formEditAuth("case_erp_purchase_f_File",e.isReadOnly),showFileList:"uploadTheme1"},model:{value:e.formData.case_erp_purchase_f_File,callback:function(a){e.$set(e.formData,"case_erp_purchase_f_File",a)},expression:"formData.case_erp_purchase_f_File"}})],1)],1):e._e()],1)]),r("l-dialog",{attrs:{visible:e.applyVisible,height:800,width:1e3,hasBtns:!1},on:{"update:visible":function(a){e.applyVisible=a}}},[r("l-choose-purchase-apply",{ref:"choseApplyForm",on:{rowClick:e.purchaseApplySelect}})],1),r("l-dialog",{attrs:{visible:e.formVisible,height:800,width:1e3},on:{"update:visible":function(a){e.formVisible=a},ok:e.handleMaterialSelect}},[r("l-choose-material",{ref:"choseForm",attrs:{supplierId:e.formData.case_erp_purchase_f_SupplierName}})],1)],1)],1)},s=[],_=(r("99af"),r("4de4"),r("7db0"),r("c740"),r("d81d"),r("a434"),r("b680"),r("159b"),r("96cf"),r("1da1")),p=window.$api.erpcase.purchase,c=window.$api.erpcase.apply,l={props:{isReadOnly:{type:Boolean,default:!1}},data:function(){return{applyVisible:!1,formVisible:!1,moduleCode:"ERP_PurchaseOrders",activeName:"tab0",formData:{case_erp_purchase_f_Number:"",case_erp_purchase_f_IsSysNum:0,case_erp_purchase_f_ApplyId:"",case_erp_purchase_f_IsRelated:0,case_erp_purchase_f_Theme:"",case_erp_purchase_f_PurchaseDate:"",case_erp_purchase_f_SupplierName:"",case_erp_purchase_f_SupplierPerson:"",case_erp_purchase_f_SupplierWay:"",case_erp_purchase_f_PurchaseDep:"",case_erp_purchase_f_PurchasePerson:"",case_erp_purchase_f_PurchasePhone:"",case_erp_purchase_f_RelatedProject:"",case_erp_purchase_f_PayType:"",case_erp_purchase_f_PayAddress:"",case_erp_purchase_f_Description:"",case_erp_purchase_f_File:""},rules:{case_erp_purchase_f_Number:[{required:!0,message:"请输入"}],case_erp_purchase_f_ApplyId:[{required:!0,message:"请选择",trigger:"null"}],case_erp_purchase_f_Theme:[{required:!0,message:"请输入"}],case_erp_purchase_f_PurchaseDate:[{required:!0,message:"请选择"}],case_erp_purchase_f_PurchasePhone:[]},case_erp_purchasedetail_columns:[{id:"case_erp_purchasedetail_F_Number",prop:"f_Number",label:"物料编码",minWidth:100},{id:"case_erp_purchasedetail_F_Name",prop:"f_Name",label:"物料名称",minWidth:140},{id:"case_erp_purchasedetail_F_Model",prop:"f_Model",label:"规格型号",minWidth:80},{id:"case_erp_purchasedetail_F_Unit",prop:"f_Unit",label:"单位",minWidth:64,align:"center",dataType:"dataSource",dataCode:"ERP_Unit",valueKey:"f_id",labelKey:"f_name"},{id:"case_erp_purchasedetail_F_Price",prop:"f_Price",label:"单价",minWidth:80,required:!0},{id:"case_erp_purchasedetail_F_Count",prop:"f_Count",label:"数量",minWidth:100,required:!0},{id:"case_erp_purchasedetail_F_Discount",prop:"f_Discount",label:"折扣%",minWidth:80,align:"center"},{id:"case_erp_purchasedetail_F_TaxRate",prop:"f_TaxRate",label:"税率%",minWidth:80,align:"center",required:!0},{id:"case_erp_purchasedetail_F_TaxBreak",prop:"f_TaxBreak",label:"税费",minWidth:80,align:"center",required:!0},{id:"case_erp_purchasedetail_F_AfterTaxAmount",prop:"f_AfterTaxAmount",label:"税后金额",minWidth:80,align:"center",required:!0},{id:"case_erp_purchasedetail_F_DeliveryDate",prop:"f_DeliveryDate",label:"交付日期",minWidth:156}],case_erp_purchasedetail_data:[],isEdit:!1}},computed:{case_erp_purchase_f_IsSysNumOptions:function(){return[{value:"0",label:"用系统编号"}]},case_erp_purchase_f_IsRelatedOptions:function(){return[{value:"1",label:"不关联"}]},case_erp_purchase_f_SupplierNameOptions:function(){var e=this.lr_DataSource("ERP_Suppliers");return this.lr_DataSourceOptions(e,"f_id","f_name")},case_erp_purchase_f_RelatedProjectOptions:function(){return this.lr_loadDataItem("140"),this.lr_dataItemOptions(this.lr_dataItem["140"])},case_erp_purchase_f_PayTypeOptions:function(){return this.lr_loadDataItem("PurchaseType"),this.lr_dataItemOptions(this.lr_dataItem["PurchaseType"])}},methods:{handleCodeTypeChange:function(){var e=this;this.formData.case_erp_purchase_f_Number="",0!=parseInt(this.formData.case_erp_purchase_f_IsSysNum)?this.rules.case_erp_purchase_f_Number.push({validator:this.lr_existDbFiled,fieldName:"f_Number",keyValue:function(){return e.formData.case_erp_apply_f_Id},tableName:"case_erp_purchase",keyName:"f_Id",trigger:"null"}):(this.formData.case_erp_purchase_f_IsSysNum=1,this.rules.case_erp_apply_f_Number.splice(1,1))},handleIsRelatedChange:function(){this.formData.case_erp_purchase_f_ApplyId="",1==parseInt(this.formData.case_erp_purchase_f_IsRelated)?this.rules.case_erp_purchase_f_ApplyId.splice(0,1):(this.rules.case_erp_purchase_f_ApplyId.push({required:!0,message:"请选择",trigger:"null"}),this.formData.case_erp_purchase_f_IsRelated=0)},handleShowApply:function(){0==parseInt(this.formData.case_erp_purchase_f_IsRelated)&&(this.applyVisible=!0)},purchaseApplySelect:function(e){var a=this;return Object(_["a"])(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.formData.case_erp_purchase_f_ApplyId=e.f_Number,a.formData.case_erp_purchase_f_Theme=e.f_Theme,a.formData.case_erp_purchase_f_PurchaseDep=e.f_ApplyDep,a.formData.case_erp_purchase_f_PurchasePerson=e.f_ApplyPerson,a.formData.case_erp_purchase_f_RelatedProject=e.f_RelatedProject,a.formData.case_erp_purchase_f_Description=e.f_Description,r.next=8,a.$awaitWraper(c.getDetails({f_ApplyId:e.f_Id}));case 8:t=r.sent,a.case_erp_purchasedetail_data=t.map((function(e){var r={f_Number:e.f_Number,f_Name:e.f_Name,f_Model:e.f_Model,f_Unit:e.f_Unit,f_Price:e.f_Price,f_Count:e.f_Count,f_TaxRate:3,f_TaxBreak:0,f_AfterTaxAmount:0,f_DeliveryDate:e.f_PayDate};return a.handleRowChange(r),r})),a.applyVisible=!1;case 11:case"end":return r.stop()}}),r)})))()},changeSupplier:function(e){this.formData.case_erp_purchase_f_SupplierPerson=e.f_person,this.formData.case_erp_purchase_f_SupplierWay=e.f_phone},handleCase_erp_purchasedetailAddRow:function(){this.formVisible=!0},deleteRow:function(e){var a=e.index;this.case_erp_purchasedetail_data.splice(a,1)},handleCase_erp_purchasedetailRemoveRow:function(){var e=this,a=this.$refs.purchasedetail.getSelected();a.forEach((function(a){var r=a.f_Id,t=e.case_erp_purchasedetail_data.find((function(e){return e.f_Id==r}));e.case_erp_purchasedetail_data.splice(t,1)}))},handleMaterialSelect:function(){var e=this;return Object(_["a"])(regeneratorRuntime.mark((function a(){var r,t,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$refs.choseForm.getSelectData();case 2:for(t in r=a.sent,r)s={},s.f_Number=r[t].f_Number,s.f_Name=r[t].f_Name,s.f_Model=r[t].f_Model,s.f_Unit=r[t].f_Unit,s.f_TaxRate=3,s.f_DeliveryDate="",r[t].f_Price&&(s.f_Price=r[t].f_Price),e.case_erp_purchasedetail_data.push(s);e.$refs.choseForm.resetForm(),e.formVisible=!1;case 6:case"end":return a.stop()}}),a)})))()},purchaseUserSelect:function(e){this.formData.case_erp_purchase_f_PurchasePhone=e?e.f_Mobile||e.f_Telephone:""},handleRowChange:function(e){if(e.f_Price&&e.f_Count&&e.f_TaxRate){var a=parseFloat(e.f_Price)*e.f_Count;e.f_Discount&&(a=parseFloat(e.f_Discount)*a/100),e.f_AfterTaxAmount=(a/(1+parseFloat(e.f_TaxRate)/100)).toFixed(2),e.f_TaxBreak=(a-parseFloat(e.f_AfterTaxAmount)).toFixed(2)}else e.f_TaxBreak=0,e.f_AfterTaxAmount=0},resetForm:function(){this.$formClear(this.$refs.form),this.activeName="tab0",this.isEdit=!1,this.case_erp_purchasedetail_data=[]},validateForm:function(){var e=this;return Object(_["a"])(regeneratorRuntime.mark((function a(){var r,t,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$formValidateWraper(e.$refs.form);case 2:if(a.sent){a.next=4;break}return a.abrupt("return",!1);case 4:if(e.$refs.purchasedetail.validate()){a.next=6;break}return a.abrupt("return",!1);case 6:if(!e.formData.case_erp_purchase_f_SupplierName){a.next=15;break}return r=window.$api.erpcase.supplier,a.next=10,e.$awaitWraper(r.supplymaterials({f_SupplierId:e.formData.case_erp_purchase_f_SupplierName}));case 10:if(t=a.sent,s=e.case_erp_purchasedetail_data.filter((function(e){return-1==t.findIndex((function(a){return a.f_Number==e.f_Number}))})),!(s.length>0)){a.next=15;break}return e.$message({type:"error",message:"【".concat(s[0].f_Name,"】").concat(e.$t("此物料不在当前供应商供货清单上"))}),a.abrupt("return",!1);case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),a)})))()},setForm:function(e){this.isEdit=!0,this.$setFormData(this.formData,e.caseErpPurchaseEntity,"case_erp_purchase"),this.case_erp_purchasedetail_data=e.caseErpPurchasedetailList},getForm:function(){var e={};return e.caseErpPurchaseEntity=this.$getFormData(this.formData,"case_erp_purchase"),e.caseErpPurchasedetailList=this.case_erp_purchasedetail_data,e},loadFormData:function(e){var a=this;return Object(_["a"])(regeneratorRuntime.mark((function r(){var t,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t=e.keyValue,r.next=3,a.$awaitWraper(p.get(t));case 3:if(s=r.sent,!s){r.next=9;break}return a.setForm(s),r.abrupt("return",!0);case 9:return r.abrupt("return",!1);case 10:case"end":return r.stop()}}),r)})))()},saveForm:function(e){var a=this;return Object(_["a"])(regeneratorRuntime.mark((function r(){var t,s,_;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t=e.keyValue,s=e.isEdit,_=a.getForm(),!s){r.next=8;break}return r.next=5,a.$awaitWraper(p.update(t,_));case 5:return r.abrupt("return",r.sent);case 8:return _.caseErpPurchaseEntity.f_Id=t,_.caseErpPurchaseEntity.f_SaveState=1,_.caseErpPurchaseEntity.f_AuditState=1,r.next=13,a.$awaitWraper(p.add(_));case 13:return r.abrupt("return",r.sent);case 14:case"end":return r.stop()}}),r)})))()}}},i=l,o=r("2877"),u=Object(o["a"])(i,t,s,!1,null,null,null);a["default"]=u.exports}}]);