(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["dataItem","dataItem-classifysIndex","dataItem-form"],{5023:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page",scopedSlots:e._u([{key:"left",fn:function(){return[a("l-panel",{staticStyle:{"padding-right":"0"},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.$t("常量分类"))+" "),e.lr_hasPageAuth("classifysSetting","buttons")?a("div",{staticClass:"tree-setting-btn"},[a("el-tooltip",{attrs:{effect:"dark",content:e.$t("分类管理"),placement:"top"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-setting"},on:{click:e.handleSettingClick}})],1)],1):e._e()]},proxy:!0}],null,!1,2536938070)},[a("div",{staticClass:"l-rblock",staticStyle:{"padding-bottom":"32px"}},[a("div",{staticClass:"l-rblock",staticStyle:{overflow:"hidden auto"}},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticClass:"learun-tree",attrs:{"default-expand-all":"",data:e.dataItemClassifysTree,"expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node;return a("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(s.label)+" ")])}}],null,!1,3651016474)})],1),a("div",{staticClass:"l-bottom"},[a("el-input",{attrs:{placeholder:e.$t("请输入编码/名称"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearchClassifys.apply(null,arguments)}},model:{value:e.searchClassifysWord,callback:function(t){e.searchClassifysWord=t},expression:"searchClassifysWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearchClassifys},slot:"append"})],1)],1)])])]},proxy:!0}],null,!1,1044722568)},[a("l-panel",{staticStyle:{"padding-left":"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入编码/名称"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{on:{click:function(t){return e.handleAdd()}}},[a("l-excel-btns")],1)]},proxy:!0}],null,!1,3991047251)},[a("div",{staticClass:"l-rblock",staticStyle:{"padding-bottom":"33px"}},[a("div",{staticClass:"l-rblock",staticStyle:{overflow:"hidden auto"}},[a("l-table",{attrs:{columns:e.columns,dataSource:e.tableShowData,loading:e.tableLoading,"row-key":"f_Id"},scopedSlots:e._u([{key:"f_EnabledMark",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(a){return e.handleEnableChange(t.row)}},model:{value:t.row.f_EnabledMark,callback:function(a){e.$set(t.row,"f_EnabledMark",a)},expression:"scope.row.f_EnabledMark"}})]}}],null,!1,2974089236)},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("div",{staticClass:"l-bottom"},[e.classifyCode?a("el-tag",{attrs:{type:"warning",size:"medium"}},[e._v(e._s(e.classifyCode+"-"+e.classifyName))]):e._e()],1)])]),a("l-drawer",{attrs:{title:e.$t("分类管理"),visible:e.classifysVisible,showOk:!1,size:"800px"},on:{"update:visible":function(t){e.classifysVisible=t},opened:e.handleClassifysOpened}},[a("classifys-index",{ref:"classifysIndex"})],1),a("l-dialog",{attrs:{title:e.$t(e.formTitle),visible:e.formVisible},on:{"update:visible":function(t){e.formVisible=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[a("dataitem-form",{ref:"form",attrs:{classifyTree:e.classifyTree,classifyId:e.classifyId,pOptions:e.tableData}})],1)],1)},n=[],i=(a("4de4"),a("96cf"),a("1da1")),r=a("bf52"),l=a("a4d1"),o=window.$api.data.dataItem,f={name:"data-dataitem",components:{dataitemForm:r["default"],classifysIndex:l["default"]},props:{},data:function(){return{lr_isPage:!0,searchWord:"",searchTableData:null,treeLoading:!1,treeData:null,searchClassifysWord:"",classifysVisible:!1,classifyCode:"",classifyName:"",classifyTree:0,classifyId:"",columns:[{label:"项目名",prop:"f_ItemName",minWidth:"100"},{label:"项目值",prop:"f_ItemValue",minWidth:"100"},{label:"排序",prop:"f_SortCode",width:"64",align:"center"},{label:"有效",prop:"f_EnabledMark",width:"64",align:"center"}],tableBtns:[{prop:"Edit",label:this.$t("编辑"),width:40},{prop:"Delete",label:this.$t("删除"),width:40}],tableLoading:!1,formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1}},computed:{tableData:function(){return this.lr_dataItem[this.classifyCode]||[]},dataItemClassifysTree:function(){return this.$toTree(this.treeData||this.lr_dataItemClassifys.filter((function(e){return 1==e.f_Type})),"f_ItemId","f_ParentId","f_ItemCode","f_ItemName")},tableShowData:function(){var e=this.searchTableData||this.tableData;return 1==this.classifyTree&&(e=this.$toTree(e,"f_Id","f_ParentId","f_ItemValue","f_ItemName")),e}},mounted:function(){this.initTree()},methods:{refreshTable:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.searchWord="",e.searchTableData=null,e.tableLoading=!0,t.next=5,e.lr_loadDataItem(e.classifyCode,!1);case 5:e.tableLoading=!1;case 6:case"end":return t.stop()}}),t)})))()},hanleSearch:function(){var e=this;this.searchWord?this.searchTableData=this.tableData.filter((function(t){return t.f_ItemValue.indexOf(e.searchWord)>-1||t.f_ItemName.indexOf(e.searchWord)>-1})):this.searchTableData=null},initTree:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.treeLoading=!0,t.next=3,e.lr_loadDataItemClassifys(!1);case 3:e.treeLoading=!1;case 4:case"end":return t.stop()}}),t)})))()},handleSettingClick:function(){this.classifysVisible=!0},handleClassifysOpened:function(){this.$refs.classifysIndex.init()},hanleSearchClassifys:function(){var e=this;this.searchClassifysWord?this.treeData=this.lr_dataItemClassifys.filter((function(t){return 1==t.f_Type&&(t.f_ItemCode.indexOf(e.searchClassifysWord)>-1||t.f_ItemName.indexOf(e.searchClassifysWord)>-1)})):this.treeData=null},handleNodeClick:function(e){this.classifyCode=e.f_ItemCode,this.classifyName=e.f_ItemName,this.classifyTree=e.f_IsTree,this.classifyId=e.f_ItemId,this.refreshTable()},handleEnableChange:function(e){var t=this;o.updateDetail(e.f_Id,this.$deepClone(e)).then((function(){t.$message({type:"success",message:t.$t("更新成功!")})}))},handleAdd:function(){this.classifyCode?(this.formEdit=!1,this.showForm("新增数据项")):this.$message({type:"warning",message:this.$t("请选择数据分类!")})},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.showForm("编辑数据项")},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){o.removeDetail(t.f_Id).then((function(){a.$message({type:"success",message:a.$t("删除成功!")}),a.refreshTable()}))})).catch((function(){a.$message({type:"info",message:a.$t("已取消删除")})}))},handleSave:function(e,t){var a=this;this.$refs.form.validateForm((function(){e();var s=a.$refs.form.getForm();a.formEdit?o.updateDetail(s.f_Id,a.$deepClone(s)).then((function(){t(),a.formVisible=!1,a.$message({type:"success",message:a.$t("更新成功!")}),a.refreshTable()})).catch((function(){t()})):o.addDetail(a.classifyCode,a.$deepClone(s)).then((function(){t(),a.formVisible=!1,a.$message({type:"success",message:a.$t("添加成功!")}),a.refreshTable()})).catch((function(){t()}))}))},handleOpenedForm:function(){this.formEdit&&this.$refs.form.setForm(this.formEditRow)},handleCloseForm:function(){this.$refs.form.resetForm()},showForm:function(e){this.formTitle=e,this.formVisible=!0}}},c=f,d=a("2877"),m=Object(d["a"])(c,s,n,!1,null,null,null);t["default"]=m.exports},a4d1:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("l-layout",[a("l-panel",{staticStyle:{padding:"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入名称/编号"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[a("el-button-group",[a("el-button",{attrs:{size:"mini",icon:"el-icon-refresh-left"},on:{click:e.handleRefresh}})],1),e.lr_hasPageAuth("classifysAdd","buttons")?a("el-button-group",[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:function(t){return e.handleAdd()}}},[e._v(e._s(e.$t("新增")))])],1):e._e()]},proxy:!0}])},[a("l-table",{ref:"table",attrs:{loading:e.tableLoading,columns:e.columns,dataSource:e.tableShowData,"row-key":"f_ItemId"},scopedSlots:e._u([{key:"f_IsTree",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(a){return e.handleEnableChange(t.row)}},model:{value:t.row.f_IsTree,callback:function(a){e.$set(t.row,"f_IsTree",a)},expression:"scope.row.f_IsTree"}})]}},{key:"f_EnabledMark",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(a){return e.handleEnableChange(t.row)}},model:{value:t.row.f_EnabledMark,callback:function(a){e.$set(t.row,"f_EnabledMark",a)},expression:"scope.row.f_EnabledMark"}})]}}])},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-dialog",{attrs:{title:e.formTitle,visible:e.formVisible,height:440},on:{"update:visible":function(t){e.formVisible=t},close:e.handleCloseForm,opened:e.handleOpenedForm,ok:e.handleSave}},[a("div",{staticClass:"l-from-body"},[a("el-form",{ref:"form",attrs:{model:e.formData,size:"mini",rules:e.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:e.$t("上级"),prop:"f_ParentId"}},[a("l-tree-select",{attrs:{options:e.dataItemClassifysTree},model:{value:e.formData.f_ParentId,callback:function(t){e.$set(e.formData,"f_ParentId",t)},expression:"formData.f_ParentId"}})],1),a("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_ItemName"}},[a("el-input",{model:{value:e.formData.f_ItemName,callback:function(t){e.$set(e.formData,"f_ItemName",t)},expression:"formData.f_ItemName"}})],1),a("el-form-item",{attrs:{label:e.$t("编码"),prop:"f_ItemCode"}},[a("el-input",{model:{value:e.formData.f_ItemCode,callback:function(t){e.$set(e.formData,"f_ItemCode",t)},expression:"formData.f_ItemCode"}})],1),a("el-form-item",{attrs:{label:e.$t("排序"),prop:"f_SortCode"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.formData.f_SortCode,callback:function(t){e.$set(e.formData,"f_SortCode",t)},expression:"formData.f_SortCode"}})],1),a("el-form-item",{attrs:{label:e.$t("树型"),prop:"f_IsTree"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.formData.f_IsTree,callback:function(t){e.$set(e.formData,"f_IsTree",t)},expression:"formData.f_IsTree"}})],1),a("el-form-item",{attrs:{label:e.$t("有效"),prop:"f_EnabledMark"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.formData.f_EnabledMark,callback:function(t){e.$set(e.formData,"f_EnabledMark",t)},expression:"formData.f_EnabledMark"}})],1),a("el-form-item",{attrs:{label:e.$t("描述"),prop:"f_Description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.formData.f_Description,callback:function(t){e.$set(e.formData,"f_Description",t)},expression:"formData.f_Description"}})],1)],1)],1)])],1)},n=[],i=(a("4de4"),a("96cf"),a("1da1")),r={data:function(){var e=this;return{searchWord:"",columns:[{label:"名称",prop:"f_ItemName",minWidth:"100"},{label:"编码",prop:"f_ItemCode",minWidth:"100"},{label:"排序",prop:"f_SortCode",width:"64",align:"center"},{label:"树型",prop:"f_IsTree",width:"64",align:"center"},{label:"有效",prop:"f_EnabledMark",width:"64",align:"center"}],tableBtns:[{prop:"ClassifysEdit",label:this.$t("编辑")},{prop:"ClassifysDelete",label:this.$t("删除")}],tableLoading:!1,tableData:[],formTitle:"",formVisible:!1,formEdit:!1,formRow:null,formData:{f_ParentId:"",f_ItemName:"",f_ItemCode:"",f_SortCode:"",f_IsTree:0,f_EnabledMark:1,f_Description:"",f_Type:1},rules:{f_ItemCode:[{required:!0,message:this.$t("请输入编号")},{validator:this.lr_existDbFiled,keyValue:function(){return e.formData.f_ItemId},tableName:"lr_base_dataitem",keyName:"f_ItemId",trigger:"null"}],f_ItemName:[{required:!0,message:this.$t("请输入名称")}]},myId:""}},created:function(){},mounted:function(){this.handleRefresh()},computed:{tableShowData:function(){return this.$toTree(this.tableData,"f_ItemId","f_ParentId","f_ItemId","f_ItemName")},dataItemClassifysTree:function(){return this.$toTree(this.dataItemClassifys.filter((function(e){return 1==e.f_Type})),"f_ItemId","f_ParentId","f_ItemId","f_ItemName",[this.myId])},dataItemClassifys:function(){return this.$store.state.data.dataItem.classifys}},methods:{handleRefresh:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tableLoading=!0,t.next=3,e.lr_loadDataItemClassifys(!1);case 3:e.init(),e.tableLoading=!1;case 5:case"end":return t.stop()}}),t)})))()},init:function(){this.tableData=this.$deepClone(this.dataItemClassifys.filter((function(e){return 1==e.f_Type})))},hanleSearch:function(){var e=this;this.searchWord?this.tableData=this.dataItemClassifys.filter((function(t){return t.f_ItemName.indexOf(e.searchWord)>-1||t.f_ItemCode.indexOf(e.searchWord)>-1})):this.init()},handleAdd:function(){this.formEdit=!1,this.myId="",this.showForm("新增分类")},handleClassifysEdit:function(e,t){this.formEdit=!0,this.formRow=t,this.myId=t.f_ItemId,this.showForm("编辑分类")},handleEnableChange:function(e){var t=this;this.$store.dispatch("data/dataItem/updateClassify",this.$deepClone(e)).then((function(){t.$message({type:"success",message:t.$t("更新成功!")})}))},handleClassifysDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){a.$store.dispatch("data/dataItem/removeClassify",t.f_ItemId).then((function(){a.$message({type:"success",message:a.$t("删除成功!")}),a.init()}))})).catch((function(){a.$message({type:"info",message:a.$t("已取消删除")})}))},handleSave:function(e,t){var a=this;this.$refs.form.validate((function(s){if(s){e();var n=a.$deepClone(a.formData);a.formEdit?a.$store.dispatch("data/dataItem/updateClassify",n).then((function(){t(),a.formVisible=!1,a.init(),a.$message({type:"success",message:a.$t("更新成功!")})})).catch((function(){t()})):a.$store.dispatch("data/dataItem/addClassify",n).then((function(){t(),a.formVisible=!1,a.init(),a.$message({type:"success",message:a.$t("新增成功!")})})).catch((function(){t()}))}}))},handleOpenedForm:function(){this.formEdit&&(this.formData=this.$deepClone(this.formRow))},handleCloseForm:function(){this.formData.f_ItemId="",this.$refs.form&&this.$refs.form.resetFields()},showForm:function(e){this.formTitle=e,this.formVisible=!0}}},l=r,o=a("2877"),f=Object(o["a"])(l,s,n,!1,null,null,null);t["default"]=f.exports},bf52:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body"},[a("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"120px"}},[1==e.classifyTree?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("上级"),prop:"f_ParentId"}},[a("l-tree-select",{attrs:{options:e.pOptionsTree},model:{value:e.formData.f_ParentId,callback:function(t){e.$set(e.formData,"f_ParentId",t)},expression:"formData.f_ParentId"}})],1)],1):e._e(),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("项目名"),prop:"f_ItemName"}},[a("el-input",{model:{value:e.formData.f_ItemName,callback:function(t){e.$set(e.formData,"f_ItemName",t)},expression:"formData.f_ItemName"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("项目值"),prop:"f_ItemValue"}},[a("el-input",{model:{value:e.formData.f_ItemValue,callback:function(t){e.$set(e.formData,"f_ItemValue",t)},expression:"formData.f_ItemValue"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("排序"),prop:"f_SortCode"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.formData.f_SortCode,callback:function(t){e.$set(e.formData,"f_SortCode",t)},expression:"formData.f_SortCode"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("有效"),prop:"f_EnabledMark"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.formData.f_EnabledMark,callback:function(t){e.$set(e.formData,"f_EnabledMark",t)},expression:"formData.f_EnabledMark"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("备注"),prop:"f_Description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.formData.f_Description,callback:function(t){e.$set(e.formData,"f_Description",t)},expression:"formData.f_Description"}})],1)],1)],1)],1)},n=[],i=(a("a9e3"),{props:{classifyTree:Number,classifyId:String,pOptions:{type:Array,default:function(){return[]}}},data:function(){return{formData:{f_ParentId:"",f_ItemName:"",f_ItemValue:"",f_SortCode:1,f_EnabledMark:1,f_Description:"",f_Type:1},rules:{f_ItemName:[{required:!0,message:this.$t("请输入项目名")}],f_ItemValue:[{required:!0,message:this.$t("请输入项目值")},{validator:this.lr_existDbFiled,tableName:"lr_base_dataitemdetail",keyName:"f_Id",filedsJsonName:"dataItem_filedsJson",trigger:"null"}],f_SortCode:[{required:!0,message:this.$t("请输入排序")}]}}},computed:{dataItem_filedsJson:function(){return{f_ItemId:this.classifyId}},pOptionsTree:function(){return console.log("this.pOptions",this.pOptions),this.$toTree(this.pOptions,"f_Id","f_ParentId","f_Id","f_ItemName",[this.formData.f_Id])}},created:function(){},methods:{resetForm:function(){this.formData.f_Id="",this.$refs.form&&this.$refs.form.resetFields()},validateForm:function(e){this.$refs.form.validate((function(t){t&&e()}))},setForm:function(e){this.formData=this.$deepClone(e),this.formData.children&&delete this.formData.children},getForm:function(){return this.$deepClone(this.formData)}}}),r=i,l=a("2877"),o=Object(l["a"])(r,s,n,!1,null,null,null);t["default"]=o.exports}}]);