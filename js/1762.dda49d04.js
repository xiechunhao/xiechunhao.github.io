"use strict";(self["webpackChunkele_admin_template"]=self["webpackChunkele_admin_template"]||[]).push([[1762],{40705:function(t,e,i){i.d(e,{F:function(){return s},z:function(){return n}});i(88919);var o=i(80462);async function s(t){const e=await o.A.get("https://cdn.eleadmin.com/20200610/document.json",{params:t});return 0===e.data.code?e.data.data:Promise.reject(new Error(e.data.message))}async function n(t){const e=await o.A.get("https://cdn.eleadmin.com/20200610/archive.json",{params:t});return 0===e.data.code?e.data.data:Promise.reject(new Error(e.data.message))}},21762:function(t,e,i){i.r(e),i.d(e,{default:function(){return h}});var o=function(){var t=this,e=t._self._c;return e("ele-modal",{attrs:{top:"5vh",width:"1100px",visible:t.visible,title:"卷内文件调整","custom-class":"demo-file-sort-dialog"},on:{"update:visible":t.updateVisible}},[e("el-row",{attrs:{gutter:15}},[e("el-col",{attrs:{md:8}},[e("ele-pro-table",{ref:"docTable",staticClass:"demo-file-sort-table",attrs:{"sub-title":"案卷列表",datasource:t.documents,columns:t.columns1,"highlight-current-row":"",height:"400px",toolkit:[],"need-page":!1,current:t.current,"tool-style":{lineHeight:"28px"}},on:{"update:current":function(e){t.current=e},done:t.onDocTbDone}})],1),e("el-col",{attrs:{md:8}},[e("ele-pro-table",{ref:"fileTable",attrs:{loading:t.loading,"sub-title":"卷内列表",datasource:t.data1,columns:t.columns2,height:"400px",selection:t.selection1,"need-page":!1,toolkit:[]},on:{"update:selection":function(e){t.selection1=e}}},[e("template",{slot:"toolkit"},[e("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top",size:"mini"},on:{click:t.moveUp}},[t._v(" 上移 ")]),e("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-bottom",size:"mini"},on:{click:t.moveDown}},[t._v(" 下移 ")]),e("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top-right",size:"mini"},on:{click:t.moveOut}},[t._v(" 调出 ")])],1)],2)],1),e("el-col",{attrs:{md:8}},[e("ele-pro-table",{attrs:{loading:t.loading,"sub-title":"未归档列表",datasource:t.data2,columns:t.columns2,height:"400px",selection:t.selection2,"need-page":!1,toolkit:[]},on:{"update:selection":function(e){t.selection2=e}}},[e("template",{slot:"toolkit"},[e("el-button",{staticClass:"ele-btn-icon",attrs:{type:"primary",icon:"el-icon-top-left",size:"mini"},on:{click:t.moveIn}},[t._v(" 调入 ")])],1)],2)],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.close}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")])],1)],1)},s=[],n=(i(98729),i(45791),i(13810),i(58607),i(40705)),a={name:"FileSort",props:{visible:Boolean,documents:{type:Array,required:!0}},data(){return{loading:!0,columns1:[{prop:"title",label:"案卷题名",width:110,showOverflowTooltip:!0},{prop:"piece_no",label:"案卷档号",showOverflowTooltip:!0}],columns2:[{columnKey:"selection",type:"selection",width:45,align:"center"},{prop:"title",label:"文件题名",width:110,showOverflowTooltip:!0},{prop:"archive_no",label:"文件档号",showOverflowTooltip:!0}],data:[],current:null,selection1:[],selection2:[]}},computed:{data1(){return this.current?this.data.filter((t=>t.piece_no===this.current.piece_no)):[]},data2(){return this.data.filter((t=>!t.piece_no))}},methods:{onDocTbDone(){this.documents.length&&this.$refs.docTable.setCurrentRow(this.documents[0])},query(){this.loading=!0,(0,n.z)({pieceNoIn:this.documents.map((t=>t.piece_no))}).then((t=>{this.loading=!1,this.data=t})).catch((t=>{this.loading=!1,this.$message.error(t.message)}))},moveUp(){if(!this.selection1.length)return void this.$message.error("请选择一条数据");if(this.selection1.length>1)return void this.$message.error("只能选择一条数据");if(0===this.data1.indexOf(this.selection1[0]))return;const t=this.data.indexOf(this.selection1[0]),e=this.data[t-1];this.$set(this.data,t-1,this.selection1[0]),this.$set(this.data,t,e),this.$nextTick((()=>{this.$refs.fileTable.toggleRowSelection(this.data[t-1],!0)}))},moveDown(){if(!this.selection1.length)return void this.$message.error("请选择一条数据");if(this.selection1.length>1)return void this.$message.error("只能选择一条数据");if(this.data1.indexOf(this.selection1[0])===this.data1.length-1)return;const t=this.data.indexOf(this.selection1[0]),e=this.data[t+1];this.$set(this.data,t+1,this.selection1[0]),this.$set(this.data,t,e),this.$nextTick((()=>{this.$refs.fileTable.toggleRowSelection(this.data[t+1],!0)}))},moveOut(){this.selection1.length?this.selection1.forEach((t=>{t.piece_no=""})):this.$message.error("请至少选择一条数据")},moveIn(){this.current&&(this.selection2.length?this.selection2.forEach((t=>{t.piece_no=this.current.piece_no})):this.$message.error("请至少选择一条数据"))},save(){const t=this.data.map((t=>({archive_no:t.archive_no,piece_no:t.piece_no})));console.log(t),this.updateVisible(!1)},close(){this.updateVisible(!1)},updateVisible(t){this.$emit("update:visible",t)}},watch:{visible(t){t?this.query():this.data=[]}}},l=a,r=i(64008),c=(0,r.A)(l,o,s,!1,null,null,null),h=c.exports}}]);