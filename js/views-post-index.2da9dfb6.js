(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-post-index"],{"201f":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page",attrs:{left:240},scopedSlots:e._u([{key:"left",fn:function(){return[a("l-panel",{staticStyle:{"padding-right":"0"},attrs:{title:e.$t("公司信息")}},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],ref:"mytree",staticClass:"learun-tree",attrs:{"node-key":"value",data:e.lr_companyTree,"default-expand-all":"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return a("span",{staticClass:"lr-tree-node"},[a("i",{staticClass:"learun-icon-co"}),e._v(" "+e._s(e.$t(n.label))+" ")])}}],null,!1,1976182835)})],1)]},proxy:!0}],null,!1,401915956)},[a("l-panel",{staticStyle:{"padding-left":"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("l-tree-select",{attrs:{placeholder:e.$t("请选择部门"),options:e.lr_departmentTree(e.lr_departments[e.companyId]||[]),size:"mini"},model:{value:e.departmentId,callback:function(t){e.departmentId=t},expression:"departmentId"}})],1),a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入关键字"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{on:{click:function(t){return e.handleAdd()}}},[a("l-excel-btns")],1)]},proxy:!0}],null,!1,906086398)},[a("l-table",{attrs:{columns:e.lr_getPageColumns(e.columns),dataSource:e.tableShowData,loading:e.loading,isTree:"",rowKey:"f_PostId",pidKey:"f_ParentId",defaultExpandAll:""},scopedSlots:e._u([{key:"f_DepartmentId",fn:function(t){return[e._v(" "+e._s(e.lr_departmentName(e.lr_departments[e.companyId]||[],t.row.f_DepartmentId))+" ")]}},{key:"f_CreateDate",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_CreateDate,"yyyy-MM-dd"))+" ")]}}],null,!1,1819600353)},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-dialog",{attrs:{title:e.formTitle,visible:e.formVisible},on:{"update:visible":function(t){e.formVisible=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[a("my-form",{ref:"form"})],1),a("l-fullscreen-dialog",{attrs:{title:e.$t("成员添加")+"-"+e.authName,visible:e.userRelationVisible},on:{"update:visible":function(t){e.userRelationVisible=t},ok:e.handleSaveUserRelation,opened:e.handleOpenedUserRelation,closed:e.handleClosedUserRelation}},[a("user-relation",{ref:"userRelation"})],1)],1)},r=[],o=(a("4de4"),a("96cf"),a("1da1")),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body"},[a("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"88px"}},[a("el-col",{attrs:{span:24}},[e.lr_formLookAuth("f_EnCode")?a("el-form-item",{attrs:{label:e.$t("编号"),prop:"f_EnCode"}},[a("el-input",{attrs:{disabled:!e.lr_formEditAuth("f_EnCode",e.isReadOnly),placeholder:e.$t("请输入")},model:{value:e.formData.f_EnCode,callback:function(t){e.$set(e.formData,"f_EnCode",t)},expression:"formData.f_EnCode"}})],1):e._e()],1),a("el-col",{attrs:{span:24}},[e.lr_formLookAuth("f_Name")?a("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_Name"}},[a("el-input",{attrs:{disabled:!e.lr_formEditAuth("f_Name",e.isReadOnly),placeholder:e.$t("请输入")},model:{value:e.formData.f_Name,callback:function(t){e.$set(e.formData,"f_Name",t)},expression:"formData.f_Name"}})],1):e._e()],1),a("el-col",{attrs:{span:24}},[e.lr_formLookAuth("f_DepartmentId")?a("el-form-item",{attrs:{label:e.$t("部门"),prop:"f_DepartmentId"}},[a("l-tree-select",{attrs:{disabled:!e.lr_formEditAuth("f_DepartmentId",e.isReadOnly),options:e.lr_departmentTree(e.lr_departments[e.formData.f_CompanyId]||[])},model:{value:e.formData.f_DepartmentId,callback:function(t){e.$set(e.formData,"f_DepartmentId",t)},expression:"formData.f_DepartmentId"}})],1):e._e()],1),a("el-col",{attrs:{span:24}},[e.lr_formLookAuth("f_ParentId")?a("el-form-item",{attrs:{label:e.$t("上级"),prop:"f_ParentId"}},[a("l-tree-select",{attrs:{disabled:!e.lr_formEditAuth("f_ParentId",e.isReadOnly),options:e.postTree},model:{value:e.formData.f_ParentId,callback:function(t){e.$set(e.formData,"f_ParentId",t)},expression:"formData.f_ParentId"}})],1):e._e()],1),a("el-col",{attrs:{span:24}},[e.lr_formLookAuth("f_Description")?a("el-form-item",{attrs:{label:e.$t("描述"),prop:"f_Description"}},[a("el-input",{attrs:{disabled:!e.lr_formEditAuth("f_Description",e.isReadOnly),type:"textarea",rows:"4"},model:{value:e.formData.f_Description,callback:function(t){e.$set(e.formData,"f_Description",t)},expression:"formData.f_Description"}})],1):e._e()],1)],1)],1)},l=[],s={props:{postlist:{type:Array,default:function(){return[]}},departmentsTree:{type:Array,default:function(){return[]}},isReadOnly:{type:Boolean,default:!1}},data:function(){var e=this;return{formData:{f_CompanyId:"",f_ParentId:"0",f_EnCode:"",f_Name:"",f_DepartmentId:"",f_Description:""},rules:{f_EnCode:[{required:!0,message:this.$t("请输入编号")},{pattern:/^[-+]?\d+$/,message:this.$t("岗位编号需要为数字")},{validator:this.lr_existDbFiled,keyValue:function(){return e.formData.f_PostId},tableName:"lr_base_post",keyName:"f_PostId",trigger:"null"}],f_Name:[{required:!0,message:this.$t("请输入名称")}],f_DepartmentId:[{required:!0,message:this.$t("请选择所属部门")}]}}},computed:{postTree:function(){return this.$toTree(this.lr_posts[this.formData.f_CompanyId]||[],"f_PostId","f_ParentId","f_PostId","f_Name",[this.formData.f_PostId])}},created:function(){},methods:{resetForm:function(){this.formData.f_PostId="",this.$formClear(this.$refs.form)},validateForm:function(e){this.$refs.form.validate((function(t){t&&e()}))},setForm:function(e){this.formData=this.$deepClone(e)},getForm:function(){return this.$deepClone(this.formData)}}},d=s,c=a("2877"),f=Object(c["a"])(d,i,l,!1,null,null,null),u=f.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.isShow?a("l-layout",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticClass:"l-tab-page",attrs:{left:240,"element-loading-text":e.$t("数据保存中")},scopedSlots:e._u([{key:"left",fn:function(){return[a("l-panel",{staticStyle:{"padding-right":"0"},attrs:{title:e.$t("公司信息")}},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.companyLoading,expression:"companyLoading"}],attrs:{data:e.lr_companyTree,"default-expand-all":"","expand-on-click-node":!1},on:{"node-click":e.handleCompanyClick},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return a("span",{staticClass:"lr-tree-node"},[a("i",{staticClass:"fa fa-sitemap"}),e._v(" "+e._s(e.$t(n.label))+" ")])}}],null,!1,2357994351)})],1)]},proxy:!0}],null,!1,65213275)},[a("l-layout",{scopedSlots:e._u([{key:"left",fn:function(){return[a("l-panel",{staticStyle:{"padding-left":"0","padding-right":"0"},attrs:{title:e.$t("部门信息")}},[a("el-tree",{attrs:{data:e.departmentsTree,"default-expand-all":"","expand-on-click-node":!1},on:{"node-click":e.handleDepartmentClick},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return a("span",{staticClass:"lr-tree-node"},[a("i",{staticClass:"fa fa-sitemap"}),e._v(" "+e._s(e.$t(n.label))+" ")])}}],null,!1,2357994351)})],1)]},proxy:!0}],null,!1,294411589)},[a("l-select-panel",{ref:"selectPanel",staticStyle:{padding:"8px","padding-left":"0"},attrs:{valueKey:"f_UserId",columns:e.columns,loadSelectTable:e.loadSelectTable},scopedSlots:e._u([{key:"f_Gender",fn:function(t){return[1==t.row.f_Gender?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(e.$t("男")))]):a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(e.$t("女")))])]}},{key:"f_CompanyId",fn:function(t){return[e._v(" "+e._s((e.lr_companyList.find((function(e){return e.f_CompanyId==t.row.f_CompanyId}))||{}).f_FullName||"")+" ")]}},{key:"f_DepartmentId",fn:function(t){return[e._v(" "+e._s(e.lr_departmentName(e.lr_departments[t.row.f_CompanyId]||[],t.row.f_DepartmentId))+" ")]}}],null,!1,1731369605),model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)],1):e._e()},p=[],h=(a("d81d"),a("159b"),window.$api.organization.userRelation),_=window.$api.organization.user,y={data:function(){return{isShow:!0,value:"",showType:1,objectType:1,objectId:void 0,pageLoading:!1,companyId:"",departmentId:"",companyLoading:!1,departmentLoading:!1,columns:[{label:"姓名",prop:"f_RealName",minWidth:"110"},{label:"账号",prop:"f_Account",width:"110"},{label:"手机",prop:"f_Mobile",width:"108"},{label:"公司",prop:"f_CompanyId",minWidth:"120"},{label:"部门",prop:"f_DepartmentId",minWidth:"88"},{label:"性别",prop:"f_Gender",width:"56",align:"center"}]}},computed:{departmentsTree:function(){return this.lr_departmentTree(this.lr_departments[this.companyId]||[])}},created:function(){this.companyInit()},methods:{companyInit:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.companyLoading=!0,t.next=3,e.lr_loadCompanys();case 3:e.companyLoading=!1;case 4:case"end":return t.stop()}}),t)})))()},handleCompanyClick:function(e){this.companyId=e.value,this.departmentId="",this.lr_loadDepartments(this.companyId),this.tableLoadData()},handleDepartmentClick:function(e){this.departmentId=e.value,this.tableLoadData()},tableLoadData:function(){this.$refs.selectPanel.init()},loadSelectTable:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.showType=e.showType,e.sidx="F_CreateDate DESC",1==e.showType?(e.companyId=t.companyId,e.departmentId=t.departmentId):e.page=1,a.next=5,_.getPage(e);case 5:return n=a.sent,r=n.data.data,r.rows.forEach((function(e){t.lr_loadDepartments(e.f_CompanyId)})),console.log(r,"这是data"),a.abrupt("return",r);case 10:case"end":return a.stop()}}),a)})))()},resetForm:function(){var e=this;this.value="",this.companyId="",this.departmentId="",this.isShow=!1,this.$nextTick((function(){e.isShow=!0}))},setForm:function(e,t){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a.objectId=e,a.objectType=t,n.next=4,h.getList(a.objectId);case 4:r=n.sent.data.data,a.value=String(r.map((function(e){return e.f_UserId}))),a.tableLoadData();case 7:case"end":return n.stop()}}),n)})))()},saveForm:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.pageLoading=!0,t.next=3,h.save(e.objectId,e.objectType,{userIds:e.value});case 3:e.pageLoading=!1;case 4:case"end":return t.stop()}}),t)})))()}}},b=y,g=Object(c["a"])(b,m,p,!1,null,null,null),v=g.exports,I=window.$api.organization.post,D={components:{MyForm:u,userRelation:v},data:function(){return{lr_isPage:!0,searchWord:"",searchTableData:null,loading:!1,tableData:[],columns:[{label:"名称",prop:"f_Name",minWidth:"160"},{label:"编号",prop:"f_EnCode",width:"110"},{label:"部门",prop:"f_DepartmentId",width:"120"},{label:"创建人",prop:"f_CreateUserName",width:"100"},{label:"创建时间",prop:"f_CreateDate",width:"100"}],tableBtns:[{prop:"Edit",label:this.$t("编辑"),width:40},{prop:"Delete",label:this.$t("删除"),width:40},{prop:"MemberAdd",label:this.$t("添加成员"),width:60}],companyId:"",treeLoading:!1,departmentId:"",departmentLoading:!1,formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1,userRelationVisible:!1,authName:""}},computed:{list:function(){return this.lr_posts[this.companyId]||[]},tableShowData:function(){var e=this,t=this.list;return this.searchTableData&&(t=this.searchTableData),this.departmentId&&(t=t.filter((function(t){return t.f_DepartmentId==e.departmentId}))),t}},mounted:function(){this.init()},methods:{init:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.companyId="53298b7a-404c-4337-aa7f-80b2a4ca6681",e.loadTableData(),e.lr_loadDepartments(e.companyId),e.treeLoading=!0,t.next=6,e.lr_loadCompanys();case 6:e.lr_companyTree.length>0&&(e.companyId=e.lr_companyTree[0].f_CompanyId,e.$refs["mytree"]&&e.$refs["mytree"].setCurrentKey(e.companyId),e.loadTableData()),e.treeLoading=!1;case 8:case"end":return t.stop()}}),t)})))()},loadTableData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.lr_loadPosts(e.companyId,!1);case 3:e.loading=!1;case 4:case"end":return t.stop()}}),t)})))()},handleNodeClick:function(e){this.companyId=e.f_CompanyId,this.departmentId="",this.lr_loadDepartments(this.companyId),this.loadTableData()},hanleSearch:function(){var e=this;this.searchWord?this.searchTableData=this.list.filter((function(t){return t.f_Name.indexOf(e.searchWord)>-1||t.f_EnCode.indexOf(e.searchWord)>-1})):this.searchTableData=null},handleAdd:function(){this.companyId?(this.formEdit=!1,this.showForm("新增岗位")):this.$message({type:"warning",message:this.$t("请选择左侧公司!")})},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.showForm("编辑岗位")},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){I.remove(t.f_PostId).then((function(){a.$message({type:"success",message:a.$t("删除成功!")}),a.loadTableData()}))})).catch((function(){a.$message({type:"info",message:a.$t("已取消删除")})}))},handleSave:function(e,t){var a=this;this.$refs.form.validateForm((function(){e();var n=a.$refs.form.getForm();a.formEdit?I.update(n.f_PostId,n).then((function(){t(),a.formVisible=!1,a.$message({type:"success",message:a.$t("更新成功!")}),a.loadTableData()})).catch((function(){t()})):I.add(n).then((function(){t(),a.formVisible=!1,a.$message({type:"success",message:a.$t("添加成功!")}),a.loadTableData()})).catch((function(){t()}))}))},handleOpenedForm:function(){if(this.formEdit)this.$refs.form.setForm(this.formEditRow);else{var e=this.$refs.form.getForm();e.f_CompanyId=this.companyId,this.$refs.form.setForm(e)}},handleCloseForm:function(){this.$refs.form.resetForm()},showForm:function(e){this.formTitle=e,this.formVisible=!0},handleMemberAdd:function(e,t){this.formEditRow=t,this.authName=t.f_Name,this.userRelationVisible=!0},handleOpenedUserRelation:function(){this.$refs.userRelation.setForm(this.formEditRow.f_PostId,2)},handleClosedUserRelation:function(){this.$refs.userRelation.resetForm()},handleSaveUserRelation:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.userRelation.saveForm();case 2:e.userRelationVisible=!1;case 3:case"end":return t.stop()}}),t)})))()}}},w=D,$=Object(c["a"])(w,n,r,!1,null,null,null);t["default"]=$.exports}}]);