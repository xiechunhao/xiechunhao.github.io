(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views-scheme-index","report"],{"2c78":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page"},[a("l-panel",{scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入关键字查询"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{on:{click:function(t){return e.handleAdd()}}},[a("l-excel-btns")],1)]},proxy:!0}],null,!1,831781051)},[a("l-table",{attrs:{columns:e.columns,dataSource:e.tableData,loading:e.tableLoading,"row-key":"f_Id",isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t}},scopedSlots:e._u([{key:"f_BeginTime",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_BeginTime,"yyyy-MM-dd hh:mm:ss"))+" ")]}},{key:"f_EndTime",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_EndTime,"yyyy-MM-dd hh:mm:ss"))+" ")]}},{key:"f_IsActive",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(a){return e.handleEnableChange(t.row)}},model:{value:t.row.f_IsActive,callback:function(a){e.$set(t.row,"f_IsActive",a)},expression:"scope.row.f_IsActive"}})]}}],null,!1,2567910582)},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-dialog",{attrs:{title:e.formTitle,visible:e.formVisible,isStep:!0,steps:["基础信息","任务配置"],stepActive:e.stepActive,validateSteps:e.handleValidateSteps,width:700,height:610},on:{"update:visible":function(t){e.formVisible=t},"update:stepActive":function(t){e.stepActive=t},"update:step-active":function(t){e.stepActive=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[a("my-form",{ref:"form",attrs:{stepActive:e.stepActive}})],1)],1)},l=[],i=(a("96cf"),a("1da1")),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body"},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:0==e.stepActive,expression:"stepActive == 0"}],ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"88px"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("任务名称"),prop:"f_Name"}},[a("el-input",{model:{value:e.formData.f_Name,callback:function(t){e.$set(e.formData,"f_Name",t)},expression:"formData.f_Name"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("开始时间"),prop:"startType"}},[a("l-radio",{attrs:{options:[{label:"立即执行",value:"1"},{label:"设置开始时间",value:"2"}]},model:{value:e.formData.startType,callback:function(t){e.$set(e.formData,"startType",t)},expression:"formData.startType"}})],1)],1),"2"==e.formData.startType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"",prop:"startTime"}},[a("l-date",{attrs:{dateType:"datetime"},model:{value:e.formData.startTime,callback:function(t){e.$set(e.formData,"startTime",t)},expression:"formData.startTime"}})],1)],1):e._e(),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("执行频率"),prop:"executeType"}},[a("l-radio",{attrs:{options:[{label:"执行一次",value:"1"},{label:"重复执行",value:"2"},{label:"频率明细",value:"3"},{label:"表达式设置",value:"4"}]},model:{value:e.formData.executeType,callback:function(t){e.$set(e.formData,"executeType",t)},expression:"formData.executeType"}})],1)],1),"2"==e.formData.executeType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"",prop:"simpleValue"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.simpleValue,callback:function(t){e.$set(e.formData,"simpleValue",t)},expression:"formData.simpleValue"}},[a("template",{slot:"prepend"},[e._v(e._s(e.$t("每隔")))]),a("l-select",{staticClass:"s-w-96",attrs:{slot:"append",clearable:!1,placeholder:e.$t("请选择"),options:[{label:"分钟",value:"minute"},{label:"小时",value:"hours"},{label:"天",value:"day"},{label:"周",value:"week"}]},slot:"append",model:{value:e.formData.simpleType,callback:function(t){e.$set(e.formData,"simpleType",t)},expression:"formData.simpleType"}})],2)],1)],1):e._e(),"3"==e.formData.executeType?a("el-col",{attrs:{span:24}},[a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-plus"},on:{click:function(t){return e.addFrequency()}}},[e._v(" "+e._s(e.$t("新增调度明细"))+" ")])],1)],1):e._e(),"3"==e.formData.executeType&&e.frequencyList.length>0?a("el-col",{attrs:{span:24}},e._l(e.frequencyList,(function(t,r){return a("el-form-item",{key:r},[a("el-input",{attrs:{readonly:"",value:e.formatFrequency(t)}},[a("el-button",{staticStyle:{color:"#409EFF"},attrs:{slot:"append"},on:{click:function(a){return e.editFrequency(t,r)}},slot:"append"},[e._v(e._s(e.$t("编辑"))+" ")]),a("el-button",{staticStyle:{color:"#F56C6C"},attrs:{slot:"append"},on:{click:function(t){return e.delFrequency(r)}},slot:"append"},[e._v(e._s(e.$t("删除")))])],1)],1)})),1):e._e(),"4"==e.formData.executeType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{prop:"cornValue"}},[a("el-input",{attrs:{placeholder:e.$t("请输入表达式")},model:{value:e.formData.cornValue,callback:function(t){e.$set(e.formData,"cornValue",t)},expression:"formData.cornValue"}},[a("el-button",{attrs:{slot:"append"},on:{click:function(t){return e.addExpress()}},slot:"append"},[e._v(e._s(e.$t("添加")))])],1)],1)],1):e._e(),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("结束时间"),prop:"endType"}},[a("l-radio",{attrs:{options:[{label:"无期限",value:"1"},{label:"设置结束时间",value:"2"}]},model:{value:e.formData.endType,callback:function(t){e.$set(e.formData,"endType",t)},expression:"formData.endType"}})],1)],1),"2"==e.formData.endType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"",prop:"endTime"}},[a("l-date",{attrs:{dateType:"datetime"},model:{value:e.formData.endTime,callback:function(t){e.$set(e.formData,"endTime",t)},expression:"formData.endTime"}})],1)],1):e._e(),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("任务重启"),prop:"isRestart"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.formData.isRestart,callback:function(t){e.$set(e.formData,"isRestart",t)},expression:"formData.isRestart"}})],1)],1),"1"==e.formData.isRestart?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("重启频率"),prop:"restartMinute"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.restartMinute,callback:function(t){e.$set(e.formData,"restartMinute",e._n(t))},expression:"formData.restartMinute"}},[a("template",{slot:"prepend"},[e._v(e._s(e.$t("每隔(分钟)")))]),a("template",{slot:"append"},[e._v(e._s(e.$t("执行一次")))])],2)],1)],1):e._e(),"1"==e.formData.isRestart?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("重启次数"),prop:"restartNum"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.restartNum,callback:function(t){e.$set(e.formData,"restartNum",e._n(t))},expression:"formData.restartNum"}})],1)],1):e._e()],1),a("el-form",{directives:[{name:"show",rawName:"v-show",value:1==e.stepActive,expression:"stepActive == 1"}],ref:"form2",attrs:{model:e.formData2,rules:e.rules2,size:"mini","label-width":"88px"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("任务类型"),prop:"methodType"}},[a("l-radio",{attrs:{options:[{label:"SQL语句",value:"1"},{label:"存储过程",value:"2"},{label:"接口",value:"3"},{label:"Ioc依赖注入",value:"4"}]},model:{value:e.formData2.methodType,callback:function(t){e.$set(e.formData2,"methodType",t)},expression:"formData2.methodType"}})],1)],1),"1"==e.formData2.methodType||"2"==e.formData2.methodType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("数据库"),prop:"dbId"}},[a("el-select",{attrs:{placeholder:e.$t("请选择")},model:{value:e.formData2.dbId,callback:function(t){e.$set(e.formData2,"dbId",t)},expression:"formData2.dbId"}},e._l(e.lr_dblinkTree,(function(t){return a("el-option-group",{key:t.id,attrs:{label:t.label}},e._l(t.children,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)})),1)],1)],1):e._e(),"1"==e.formData2.methodType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("SQL语句"),prop:"strSql"}},[a("el-input",{attrs:{type:"textarea",rows:"8"},model:{value:e.formData2.strSql,callback:function(t){e.$set(e.formData2,"strSql",t)},expression:"formData2.strSql"}})],1)],1):e._e(),"2"==e.formData2.methodType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("存储过程"),prop:"procName"}},[a("el-input",{attrs:{type:"textarea",rows:"8"},model:{value:e.formData2.procName,callback:function(t){e.$set(e.formData2,"procName",t)},expression:"formData2.procName"}})],1)],1):e._e(),"3"==e.formData2.methodType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("接口类型"),prop:"urlType"}},[a("l-radio",{attrs:{options:[{label:"Get",value:"1"},{label:"Post",value:"2"}]},model:{value:e.formData2.urlType,callback:function(t){e.$set(e.formData2,"urlType",t)},expression:"formData2.urlType"}})],1)],1):e._e(),"3"==e.formData2.methodType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("接口地址"),prop:"url"}},[a("el-input",{attrs:{type:"textarea",rows:"8"},model:{value:e.formData2.url,callback:function(t){e.$set(e.formData2,"url",t)},expression:"formData2.url"}})],1)],1):e._e(),"4"==e.formData2.methodType?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("IOC方法"),prop:"iocName"}},[a("el-input",{attrs:{type:"textarea",rows:"8"},model:{value:e.formData2.iocName,callback:function(t){e.$set(e.formData2,"iocName",t)},expression:"formData2.iocName"}})],1)],1):e._e()],1),a("l-dialog",{attrs:{title:e.formTitle,visible:e.formVisible,width:560,height:320},on:{"update:visible":function(t){e.formVisible=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[a("frequency-form",{ref:"frequencyForm"})],1),a("l-dialog",{attrs:{title:e.$t("添加预置表达式"),visible:e.expressVisible,width:600,height:424,hasBtns:!1},on:{"update:visible":function(t){e.expressVisible=t}}},[a("l-table",{attrs:{columns:e.expressColumns,dataSource:e.expressData},on:{rowClick:e.handleExpressClick}})],1)],1)},s=[],n=(a("99af"),a("a434"),a("a9e3"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body"},[a("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"88px"}},[a("el-form-item",{attrs:{label:e.$t("执行小时"),prop:"hour"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.hour,callback:function(t){e.$set(e.formData,"hour",e._n(t))},expression:"formData.hour"}})],1),a("el-form-item",{attrs:{label:e.$t("执行分钟"),prop:"minute"}},[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.formData.minute,callback:function(t){e.$set(e.formData,"minute",e._n(t))},expression:"formData.minute"}})],1),a("el-form-item",{attrs:{label:e.$t("执行日"),prop:"type"}},[a("el-select",{attrs:{placeholder:e.$t("请选择")},on:{change:e.typeChange},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}},[a("el-option",{attrs:{label:e.$t("每日"),value:"day"}}),a("el-option",{attrs:{label:e.$t("每周"),value:"week"}}),a("el-option",{attrs:{label:e.$t("每月"),value:"month"}})],1)],1),"week"==e.formData.type?a("el-form-item",{attrs:{label:e.$t("每周"),prop:"week"}},[a("l-select",{attrs:{options:e.weekOptions,multiple:"",placeholder:e.$t("请选择")},model:{value:e.formData.week,callback:function(t){e.$set(e.formData,"week",t)},expression:"formData.week"}})],1):e._e(),"month"==e.formData.type?a("el-form-item",{attrs:{label:e.$t("每月"),prop:"day"}},[a("l-select",{attrs:{options:e.dayOptions,multiple:"",placeholder:e.$t("请选择")},model:{value:e.formData.day,callback:function(t){e.$set(e.formData,"day",t)},expression:"formData.day"}})],1):e._e(),a("el-form-item",{attrs:{label:e.$t("执行月"),prop:"mounth"}},[a("l-select",{attrs:{options:e.monthOptions,multiple:"",placeholder:e.$t("请选择")},model:{value:e.formData.mounth,callback:function(t){e.$set(e.formData,"mounth",t)},expression:"formData.mounth"}})],1)],1)],1)}),c=[],u={props:{},data:function(){return{formData:{hour:"",minute:"",type:"day",week:"",day:"",mounth:""},rules:{hour:[{required:!0,message:this.$t("执行小时不能为空")},{pattern:/^(2[0-3]|[0-1]?\d)$/,message:this.$t("请输入0-23的有效正整数")}],minute:[{required:!0,message:this.$t("执行分钟不能为空")},{pattern:/^(?:[1-5]?\d)$/,message:this.$t("请输入0-59的有效正整数")}],week:[{required:!0,message:this.$t("每周不能为空"),trigger:"change"}],day:[{required:!0,message:this.$t("每月不能为空"),trigger:"change"}],mounth:[{required:!0,message:this.$t("每月不能为空"),trigger:"change"}]},weekOptions:[{value:"1",label:this.$t("周一")},{value:"2",label:this.$t("周二")},{value:"3",label:this.$t("周三")},{value:"4",label:this.$t("周四")},{value:"5",label:this.$t("周五")},{value:"6",label:this.$t("周六")},{value:"7",label:this.$t("周日")}],monthOptions:[{value:"1",label:this.$t("一月")},{value:"2",label:this.$t("二月")},{value:"3",label:this.$t("三月")},{value:"4",label:this.$t("四月")},{value:"5",label:this.$t("五月")},{value:"6",label:this.$t("六月")},{value:"7",label:this.$t("七月")},{value:"8",label:this.$t("八月")},{value:"9",label:this.$t("九月")},{value:"10",label:this.$t("十月")},{value:"11",label:this.$t("十一月")},{value:"12",label:this.$t("十二月")}],dayOptions:[{value:"1",label:this.$t("1号")},{value:"2",label:this.$t("2号")},{value:"3",label:this.$t("3号")},{value:"4",label:this.$t("4号")},{value:"5",label:this.$t("5号")},{value:"6",label:this.$t("6号")},{value:"7",label:this.$t("7号")},{value:"8",label:this.$t("8号")},{value:"9",label:this.$t("9号")},{value:"10",label:this.$t("10号")},{value:"11",label:this.$t("11号")},{value:"12",label:this.$t("12号")},{value:"13",label:this.$t("13号")},{value:"14",label:this.$t("14号")},{value:"15",label:this.$t("15号")},{value:"16",label:this.$t("16号")},{value:"17",label:this.$t("17号")},{value:"18",label:this.$t("18号")},{value:"19",label:this.$t("19号")},{value:"20",label:this.$t("20号")},{value:"21",label:this.$t("21号")},{value:"22",label:this.$t("22号")},{value:"23",label:this.$t("23号")},{value:"24",label:this.$t("24号")},{value:"25",label:this.$t("25号")},{value:"26",label:this.$t("26号")},{value:"27",label:this.$t("27号")},{value:"28",label:this.$t("28号")},{value:"29",label:this.$t("29号")},{value:"30",label:this.$t("30号")},{value:"31",label:this.$t("31号")}]}},computed:{},created:function(){},methods:{typeChange:function(){var e=this;this.formData.week="",this.formData.day="",this.$nextTick((function(){e.$refs.form.clearValidate()}))},resetForm:function(){this.$refs.form&&this.$refs.form.resetFields()},validateForm:function(e){this.$refs.form.validate((function(t){t&&e()}))},setForm:function(e){this.formData=this.$deepClone(e)},getForm:function(){var e=this.$deepClone(this.formData);return e}}},m=u,f=a("2877"),d=Object(f["a"])(m,n,c,!1,null,null,null),p=d.exports,h={components:{FrequencyForm:p},props:{stepActive:{type:Number,default:0}},data:function(){return{frequencyList:[],formData:{f_Name:"",startType:"1",startTime:"",executeType:"1",simpleValue:"1",simpleType:"minute",cornValue:"",endType:"1",endTime:"",isRestart:"0",restartMinute:1,restartNum:1},rules:{f_Name:[{required:!0,message:this.$t("请输入任务名称")}],startTime:[{required:!0,message:this.$t("请选择开始时间")}],simpleValue:[{required:!0,message:this.$t("请输入时间")}],cornValue:[{required:!0,message:this.$t("请输入表达式")}],endTime:[{required:!0,message:this.$t("请选择结束时间")}],restartMinute:[{required:!0,message:this.$t("请输入时间")}],restartNum:[{required:!0,message:this.$t("请输入次数")}]},formData2:{methodType:"1",dbId:"",strSql:"",procName:"",urlType:"1",url:"",iocName:""},rules2:{dbId:[{required:!0,message:this.$t("请输入数据库")}],strSql:[{required:!0,message:this.$t("请输入Sql语句")}],procName:[{required:!0,message:this.$t("请输入存储过程名称")}],url:[{required:!0,message:this.$t("请输入接口地址")}],iocName:[{required:!0,message:this.$t("请输入依赖注入名称")}]},formVisible:!1,formTitle:"",formEditData:null,formEdit:!1,expressVisible:!1,expressColumns:[{label:"名称",prop:"name",minWidth:"200"}],expressData:[{name:this.$t("每天12点运行"),value:"0 0 12 * * ?"},{name:this.$t("每天10:15运行"),value:"0 15 10 * * ? *"},{name:this.$t("在2018年的每天10：15运行"),value:"0 15 10 * * ? 2018"},{name:this.$t("每天14点到15点之间每分钟运行一次，开始于14:00，结束于14:59"),value:"0 * 14 * * ?"},{name:this.$t("每天14点到15点每5分钟运行一次，开始于14:00，结束于14:55"),value:"0 0/5 14 * * ?"},{name:this.$t("每天14点到15点每5分钟运行一次，此外每天18点到19点每5钟也运行一次"),value:"0 0/5 14,18 * * ?"},{name:this.$t("每天14:00点到14:05，每分钟运行一次"),value:"0 0-5 14 * * ?"},{name:this.$t("3月每周三的14:10分到14:44，每分钟运行一次"),value:"0 10,44 14 ? 3 WED"},{name:this.$t("每周一，二，三，四，五的10:15分运行"),value:"0 15 10 ? * MON-FRI"},{name:this.$t("每月15日10:15分运行"),value:"0 15 10 15 * ?"},{name:this.$t("每月最后一天10:15分运行"),value:"0 15 10 L * ?"},{name:this.$t("每月最后一个星期五10:15分运行"),value:"0 15 10 ? * 6L"},{name:this.$t("在2018,2019,2010年每个月的最后一个星期五的10:15分运行"),value:"0 15 10 ? * 6L 2017-2019"},{name:this.$t("每月第三个星期五的10:15分运行"),value:"0 15 10 ? * 6#3"}]}},computed:{},created:function(){this.lr_loadDblink()},methods:{addFrequency:function(){this.formTitle=this.$t("添加频率明细"),this.formEdit=!1,this.formVisible=!0},editFrequency:function(e,t){this.formTitle=this.$t("编辑频率明细"),this.formEdit=!0,this.formEditData=e,this.formEditIndex=t,this.formVisible=!0},delFrequency:function(e){this.frequencyList.splice(e,1)},formatFrequency:function(e){var t="".concat(this.$t("每")).concat(e.mounth).concat(this.$t("月的"));switch(e.type){case"day":t+=this.$t("每天");break;case"week":t+="".concat(this.$t("每周")).concat(e.week).concat(this.$t("天"));break;case"month":t+="".concat(e.day).concat(this.$t("号"));break}return t+="".concat(e.hour).concat(this.$t("时")).concat(e.minute).concat(this.$t("分执行")),t},handleSave:function(){var e=this;this.$refs.frequencyForm.validateForm((function(){e.formEdit?e.frequencyList[e.formEditIndex]=e.$refs.frequencyForm.getForm():e.frequencyList.push(e.$refs.frequencyForm.getForm()),e.formVisible=!1}))},handleCloseForm:function(){this.$refs.frequencyForm.resetForm()},handleOpenedForm:function(){this.formEdit&&this.$refs.frequencyForm.setForm(this.formEditData)},addExpress:function(){this.expressVisible=!0},handleExpressClick:function(e){var t=e.row;this.formData.cornValue=t.value,this.expressVisible=!1},resetForm:function(){this.frequencyList=[],this.$refs.form&&this.$refs.form.resetFields(),this.$refs.form2&&this.$refs.form2.resetFields()},validateStep:function(){return"3"==this.formData.executeType&&0==this.frequencyList.length?(this.$message({type:"error",message:this.$t("请添加频率明细!")}),!1):this.$formValidateWraper(this.$refs.form)},validateForm:function(){return this.$formValidateWraper(this.$refs.form2)},setForm:function(e){this.formData.f_Name=e.f_Name;var t=JSON.parse(e.f_Scheme);switch(this.formData.startType=t.startType,this.formData.startTime=t.startTime,this.formData.endType=t.endType,this.formData.endTime=t.endTime,this.formData.executeType=t.executeType,this.formData.isRestart=t.isRestart,this.formData.executeType){case"1":break;case"2":this.formData.simpleValue=t.simpleValue,this.formData.simpleType=t.simpleType;break;case"3":this.frequencyList=t.frequencyList;break;case"4":this.formData.cornValue=t.cornValue;break}switch("1"==this.formData.isRestart&&(this.formData.restartMinute=t.restartMinute,this.formData.restartNum=t.restartNum),this.formData2.methodType=t.methodType,this.formData2.methodType){case"1":this.formData2.dbId=t.dbId,this.formData2.strSql=t.strSql;break;case"2":this.formData2.dbId=t.dbId,this.formData2.procName=t.procName;break;case"3":this.formData2.urlType=t.urlType,this.formData2.url=t.url;break;case"4":this.formData2.iocName=t.iocName;break}},getForm:function(){var e={f_Name:this.formData.f_Name},t={startType:this.formData.startType,startTime:this.formData.startTime,endType:this.formData.endType,endTime:this.formData.endTime,executeType:this.formData.executeType,isRestart:this.formData.isRestart};switch(t.executeType){case"1":break;case"2":t.simpleValue=this.formData.simpleValue,t.simpleType=this.formData.simpleType;break;case"3":t.frequencyList=this.frequencyList;break;case"4":t.cornValue=this.formData.cornValue;break}switch("1"==t.isRestart&&(t.restartMinute=this.formData.restartMinute,t.restartNum=this.formData.restartNum),t.methodType=this.formData2.methodType,this.formData2.methodType){case"1":t.dbId=this.formData2.dbId,t.strSql=this.formData2.strSql;break;case"2":t.dbId=this.formData2.dbId,t.procName=this.formData2.procName;break;case"3":t.urlType=this.formData2.urlType,t.url=this.formData2.url;break;case"4":t.iocName=this.formData2.iocName;break}return e.f_Scheme=JSON.stringify(t),e}}},b=h,_=Object(f["a"])(b,o,s,!1,null,null,null),v=_.exports,g=window.$api.quartz.scheme,y={components:{MyForm:v},data:function(){return{lr_isPage:!0,columns:[{label:"名称",prop:"f_Name",minWidth:"200"},{label:"状态",prop:"f_IsActive",width:"64",align:"center"},{label:"开始时间",prop:"f_BeginTime",width:"160"},{label:"结束时间",prop:"f_EndTime",width:"160"}],tableBtns:[{prop:"Edit",label:this.$t("编辑"),width:40},{prop:"Delete",label:this.$t("删除"),width:40}],tableData:[],tableLoading:!1,searchWord:"",tableTotal:0,tablePageSize:50,tableCurrentPage:1,stepActive:0,formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1}},mounted:function(){this.loadTableData()},computed:{},methods:{loadTableData:function(e){var t=this;e||(this.tableCurrentPage=1),this.tableLoading=!0;var a={rows:this.tablePageSize,page:this.tableCurrentPage,sidx:"F_BeginTime DESC",keyword:this.searchWord};g.getPage(a).then((function(e){var a=t.$deepClone(e.data.data);t.tableData=a.rows,t.tableTotal=a.records,t.tableLoading=!1})).catch((function(){t.tableData=[],t.tableLoading=!1}))},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},hanleSearch:function(){this.loadTableData()},handleEnableChange:function(e){var t=this;2==e.f_IsActive?g.pauseJob(e.f_Id).then((function(){t.$message({type:"success",message:t.$t("暂停成功!")})})):g.resumeJob(e.f_Id).then((function(){t.$message({type:"success",message:t.$t("启动成功!")})}))},handleAdd:function(){this.formEdit=!1,this.showForm("新增任务计划")},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.showForm("编辑任务计划")},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then((function(){g.remove(t.f_Id).then((function(){a.$message({type:"success",message:a.$t("删除成功!")}),a.loadTableData()}))})).catch((function(){a.$message({type:"info",message:a.$t("已取消删除")})}))},handleSave:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var l,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e(),r.next=3,a.$refs.form.validateForm();case 3:if(r.sent){r.next=6;break}return t(),r.abrupt("return");case 6:if(l=a.$refs.form.getForm(),!a.formEdit){r.next=14;break}return r.next=10,a.$awaitWraper(g.update(a.formEditRow.f_Id,l));case 10:i=r.sent,i&&(a.$message({type:"success",message:a.$t("更新成功!")}),a.formVisible=!1,a.loadTableData()),r.next=18;break;case 14:return r.next=16,a.$awaitWraper(g.add(l));case 16:o=r.sent,o&&(a.$message({type:"success",message:a.$t("新增成功!")}),a.formVisible=!1,a.loadTableData());case 18:t();case 19:case"end":return r.stop()}}),r)})))()},handleOpenedForm:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a.formEdit){r.next=7;break}return e("加载数据中..."),r.next=4,a.$awaitWraper(g.get(a.formEditRow.f_Id));case 4:l=r.sent,a.$refs.form.setForm(l),t();case 7:case"end":return r.stop()}}),r)})))()},handleCloseForm:function(){this.$refs.form.resetForm()},showForm:function(e){this.formTitle=e,this.formVisible=!0},handleValidateSteps:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.form.validateStep();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()}}},D=y,$=Object(f["a"])(D,r,l,!1,null,null,null);t["default"]=$.exports},"3d0d":function(e,t,a){},"69c7":function(e,t,a){"use strict";a("8a37")},8062:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page",scopedSlots:e._u([{key:"left",fn:function(){return[a("l-panel",{staticClass:"l-panel-overflow",staticStyle:{"padding-right":"0"},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.$t("分类"))+" "),a("div",{staticClass:"tree-setting-btn"},[a("el-tooltip",{attrs:{effect:"dark",content:e.$t("设置"),placement:"top"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-setting"},on:{click:e.handleSettingClick}})],1)],1)]},proxy:!0}],null,!1,3022135713)},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],ref:"tree",staticClass:"learun-tree",attrs:{"node-key":"id","highlight-current":!0,data:e.dataItemTree_FormSort},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node;return a("span",{staticClass:"lr-tree-node"},[a("i",{staticClass:"el-icon-notebook-2"}),e._v(" "+e._s(r.label)+" ")])}}],null,!1,1970407520)})],1)]},proxy:!0}],null,!1,2494566793)},[a("l-panel",{staticStyle:{"padding-left":"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("div",{staticClass:"l-panel--item"},[a("el-input",{attrs:{placeholder:e.$t("请输入名称"),size:"mini"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.hanleSearch.apply(null,arguments)}},model:{value:e.keyWord,callback:function(t){e.keyWord=t},expression:"keyWord"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.hanleSearch},slot:"append"})],1)],1)]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{on:{click:function(t){return e.handleAdd()}}},[a("l-excel-btns"),a("el-button-group",[a("l-file-import",{attrs:{fileType:"json",classname:"custmerFormSchemeImport"},on:{success:function(t){return e.exportSuccess()}}})],1)],1)]},proxy:!0}],null,!1,1687980727)},[a("l-table",{attrs:{loading:e.tableLoading,columns:e.columns,dataSource:e.tableData,"row-key":"f_Id",isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_CreateDate",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_CreateDate))+" ")]}},{key:"f_Category",fn:function(t){return[e._v(" "+e._s(e.lr_dataItemName(e.lr_dataItem["FormSort"],t.row.f_Category))+" ")]}},{key:"f_FormType",fn:function(t){return[1==t.row.f_FormType?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v(e._s(e.$t("视图表单")))]):0==t.row.f_FormType?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(e.$t("常规表单")))]):a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(e.$t("自动建表")))])]}},{key:"f_EnabledMark",fn:function(t){return[1!=t.row.f_Type?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.$t("草稿")))]):a("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(a){return e.handleEnableChange(t.row)}},model:{value:t.row.f_EnabledMark,callback:function(a){e.$set(t.row,"f_EnabledMark",a)},expression:"scope.row.f_EnabledMark"}})]}}],null,!1,2045947457)},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-fullscreen-dialog",{ref:"formDialog",attrs:{title:e.$t("表单设计"),headerMidWidth:400,visible:e.formVisible,isStep:!0,steps:["基本配置","表单设计"],stepActive:e.stepActive,validateSteps:e.handleValidateSteps},on:{"update:visible":function(t){e.formVisible=t},"update:stepActive":function(t){e.stepActive=t},"update:step-active":function(t){e.stepActive=t},ok:e.handleSave,closed:e.handleClosed,opened:e.handleOpened},scopedSlots:e._u([{key:"headerRight",fn:function(){return[a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.handleSaveDraft()}}},[e._v(e._s(e.$t("暂存")))])]},proxy:!0}],null,!1,3566740930)},[a("formDesign-form",{ref:"form",attrs:{stepActive:e.stepActive,isDisabled:e.formEdit}})],1),a("l-drawer",{attrs:{title:e.$t("分类管理"),visible:e.classifysVisible,showOk:!1,showClose:!1,size:"800px"},on:{"update:visible":function(t){e.classifysVisible=t}}},[a("l-dataitem-index",{attrs:{classifyCode:"FormSort"}})],1),a("l-dialog",{attrs:{title:e.$t("表单预览")+"-"+e.$t(e.previewTitle),visible:e.previewVisible,height:600,width:"800px",hasBtns:!1},on:{"update:visible":function(t){e.previewVisible=t},opened:e.handlePreviewOpened,closed:e.handlePreviewClosed}},[a("preview",{ref:"preview"})],1),a("l-drawer",{attrs:{title:e.$t("历史记录")+"-"+e.$t(e.historyTitle),visible:e.historyVisible,showOk:!1,showClose:!1,size:"640px"},on:{"update:visible":function(t){e.historyVisible=t},opened:e.HistoryOpened}},[a("history",{ref:"HistoryForm",attrs:{schemeInfoId:e.schemeInfoId,schemeId:e.schemeId,updateSchemeId:e.updateSchemeId}})],1),a("l-dialog",{ref:"formTableStructure",attrs:{title:e.$t("表结构配置"),visible:e.tableStructureVisible,height:700,width:900},on:{"update:visible":function(t){e.tableStructureVisible=t},opened:e.handleTableStructureOpened,closed:e.handleTableStructureClosed,ok:e.handleTableStructureOk}},[a("table-structure",{ref:"tableStructure"})],1)],1)},l=[],i=(a("a434"),a("96cf"),a("1da1")),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-rblock"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.steps(0),expression:"steps(0)"}],staticClass:"l-rblock",staticStyle:{padding:"24px"}},[a("div",{staticClass:"l-page-panel"},[a("el-form",{ref:"baseInfo",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"88px"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("名称"),prop:"f_Name"}},[a("el-input",{model:{value:e.formData.f_Name,callback:function(t){e.$set(e.formData,"f_Name",t)},expression:"formData.f_Name"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("分类"),prop:"f_Category"}},[a("l-tree-select",{attrs:{placeholder:e.$t("请选择"),options:e.lr_dataItemTree(e.lr_dataItem["FormSort"])},model:{value:e.formData.f_Category,callback:function(t){e.$set(e.formData,"f_Category",t)},expression:"formData.f_Category"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("数据库"),prop:"f_DbCode"}},[a("el-select",{attrs:{placeholder:e.$t("请选择")},model:{value:e.formData.f_DbCode,callback:function(t){e.$set(e.formData,"f_DbCode",t)},expression:"formData.f_DbCode"}},e._l(e.lr_dblinkTree,(function(t){return a("el-option-group",{key:t.id,attrs:{label:t.label}},e._l(t.children,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)})),1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("状态"),prop:"f_EnabledMark"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.formData.f_EnabledMark,callback:function(t){e.$set(e.formData,"f_EnabledMark",t)},expression:"formData.f_EnabledMark"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("类型"),prop:"f_FormType"}},[a("l-radio",{attrs:{options:[{value:0,label:e.$t("常规表单")},{value:1,label:e.$t("视图表单")},{value:2,label:e.$t("自动建表")}],disabled:e.isDisabled},on:{change:e.handleFormTypeChange},model:{value:e.formData.f_FormType,callback:function(t){e.$set(e.formData,"f_FormType",t)},expression:"formData.f_FormType"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("描述"),prop:"f_Description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.formData.f_Description,callback:function(t){e.$set(e.formData,"f_Description",t)},expression:"formData.f_Description"}})],1)],1)],1),0==e.formData.f_FormType?[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"l-title"},[e._v(" "+e._s(e.$t("添加数据库表（请先选择数据库）"))+" ")])]),a("el-col",{key:1,attrs:{span:24}},[a("l-edit-table",{attrs:{addBtnText:"添加",dataSource:e.dbTableData},on:{addRow:e.addRow,deleteRow:e.deleteRow}},[a("el-table-column",{attrs:{prop:"type",label:e.$t("类别"),width:"64",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["main"==t.row.type?a("el-tag",{attrs:{size:"mini"}},[e._v("主表")]):a("el-tag",{staticStyle:{cursor:"pointer"},attrs:{size:"mini",type:"warning"},on:{click:function(a){return e.chlidTagClick(t.row)}}},[e._v("子表")])]}}],null,!1,3390340495)}),a("el-table-column",{attrs:{prop:"name",label:e.$t("表名"),minWidth:"100"}}),a("el-table-column",{attrs:{prop:"field",label:e.$t("外键"),minWidth:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return"main"!=t.row.type?[a("el-select",{attrs:{size:"mini",placeholder:e.$t("请选择")},model:{value:t.row.field,callback:function(a){e.$set(t.row,"field",a)},expression:"scope.row.field"}},e._l(t.row.columns||[],(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)]:void 0}}],null,!0)}),a("el-table-column",{attrs:{prop:"relationName",label:e.$t("关联表"),minWidth:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return"main"!=t.row.type?[a("el-select",{attrs:{size:"mini",placeholder:e.$t("请选择")},model:{value:t.row.relationName,callback:function(a){e.$set(t.row,"relationName",a)},expression:"scope.row.relationName"}},e._l(e.relationTables(t.row.name),(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)]:void 0}}],null,!0)}),a("el-table-column",{attrs:{prop:"relationField",label:e.$t("关联主键"),minWidth:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return"main"!=t.row.type&&t.row.relationName?[a("el-select",{attrs:{size:"mini",placeholder:e.$t("请选择")},model:{value:t.row.relationField,callback:function(a){e.$set(t.row,"relationField",a)},expression:"scope.row.relationField"}},e._l(e.relationTableFields(t.row.relationName),(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)]:void 0}}],null,!0)})],1)],1),a("el-col",{attrs:{span:24}},[a("div",{staticClass:"l-title"},[e._v(" "+e._s(e.$t("添加数据库关联表，只用来做数据权限设置（请先选择数据库）"))+" ")])]),a("el-col",{key:2,attrs:{span:24}},[a("l-edit-table",{attrs:{addBtnText:"添加",dataSource:e.dbTableRData},on:{addRow:e.addDbTableRData,deleteRow:e.deleteDbTableRData}},[a("el-table-column",{attrs:{prop:"fname",label:e.$t("名称"),minWidth:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"mini"},model:{value:t.row.fname,callback:function(a){e.$set(t.row,"fname",a)},expression:"scope.row.fname"}})]}}],null,!1,1168064708)}),a("el-table-column",{attrs:{prop:"name",label:e.$t("表名"),minWidth:"160"}}),a("el-table-column",{attrs:{prop:"cfield",label:e.$t("比较字段"),minWidth:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{attrs:{size:"mini",placeholder:e.$t("请选择")},model:{value:t.row.cfield,callback:function(a){e.$set(t.row,"cfield",a)},expression:"scope.row.cfield"}},e._l(t.row.columns||[],(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)]}}],null,!1,4113441934)}),a("el-table-column",{attrs:{prop:"field",label:e.$t("外键"),minWidth:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{attrs:{size:"mini",placeholder:e.$t("请选择")},model:{value:t.row.field,callback:function(a){e.$set(t.row,"field",a)},expression:"scope.row.field"}},e._l(t.row.columns||[],(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)]}}],null,!1,2449988301)}),a("el-table-column",{attrs:{prop:"relationName",label:e.$t("关联表"),minWidth:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return"main"!=t.row.type?[a("el-select",{attrs:{size:"mini",placeholder:e.$t("请选择")},model:{value:t.row.relationName,callback:function(a){e.$set(t.row,"relationName",a)},expression:"scope.row.relationName"}},e._l(e.dbTableData,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)]:void 0}}],null,!0)}),a("el-table-column",{attrs:{prop:"relationField",label:e.$t("关联主键"),minWidth:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.relationName?[a("el-select",{attrs:{size:"mini",placeholder:e.$t("请选择")},model:{value:t.row.relationField,callback:function(a){e.$set(t.row,"relationField",a)},expression:"scope.row.relationField"}},e._l(e.relationTableFields(t.row.relationName),(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)]:void 0}}],null,!0)})],1)],1)]:e._e(),1==e.formData.f_FormType?[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"l-title"},[e._v(" "+e._s(e.$t("添加数据视图（请先选择数据库）"))+" ")])]),a("el-col",{attrs:{span:24}},[a("l-edit-table",{attrs:{addBtnText:"添加",dataSource:e.dbTableData},on:{addRow:e.addSqlData,deleteRow:e.deleteSqlData}},[a("el-table-column",{attrs:{prop:"type",label:e.$t("类别"),width:"64",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["main"==t.row.type?a("el-tag",{attrs:{size:"mini"}},[e._v("主")]):a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("子")])]}}],null,!1,2417086592)}),a("el-table-column",{attrs:{prop:"name",label:e.$t("名称"),minWidth:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return a("el-button",{attrs:{type:"text"},on:{click:function(a){return a.stopPropagation(),e.editSqlData(t.row)}}},[e._v(e._s(t.row.name))])}}],null,!1,1158776797)}),a("el-table-column",{attrs:{prop:"relationField",label:e.$t("关联字段"),minWidth:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return"main"!=t.row.type?a("el-select",{attrs:{size:"mini",placeholder:"请选择"},model:{value:t.row.relationField,callback:function(a){e.$set(t.row,"relationField",a)},expression:"scope.row.relationField"}},e._l(e.sqlMainCols||[],(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1):e._e()}}],null,!0)})],1)],1)]:e._e()],2)]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.steps(1),expression:"steps(1)"}],staticClass:"l-rblock"},[a("l-form-design",{ref:"formDesign",attrs:{dbTables:e.dbTableData,isAutoCreateTable:2==e.formData.f_FormType}})],1),a("l-codetable-selectdialog",{attrs:{visible:e.dbtableSelectdialog,dbCode:e.formData.f_DbCode},on:{"update:visible":function(t){e.dbtableSelectdialog=t},select:e.dbSelect}}),a("l-dialog",{attrs:{title:e.sqlDialogTitle,visible:e.addSqlDialog,width:640},on:{"update:visible":function(t){e.addSqlDialog=t},ok:e.sqlDialogSave,closed:e.sqlDialogClosed,opened:e.sqlDialogOpened}},[a("sql-form",{ref:"sqlForm"})],1)],1)},s=[],n=(a("99af"),a("4de4"),a("7db0"),a("c740"),a("d81d"),a("b0c0"),a("a9e3"),a("d3b7"),a("159b"),a("2909")),c=a("b85c"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-from-body"},[a("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini","label-width":"60px"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"SQL",prop:"sql"}},[a("el-alert",{staticStyle:{"margin-bottom":"8px"},attrs:{title:"@param 与主表关联参数值，比如 where id = @param;",type:"info",closable:!1}}),a("div",{staticClass:"l-rblock",staticStyle:{height:"200px",border:"1px solid #dcdfe6","border-radius":"4px",overflow:"hidden"}},[a("l-code-mirror",{attrs:{mode:"text/x-sql"},model:{value:e.formData.sql,callback:function(t){e.$set(e.formData,"sql",t)},expression:"formData.sql"}})],1)],1)],1)],1)],1)},m=[],f={data:function(){return{pOptions:[],formData:{name:"",sql:""},rules:{name:[{required:!0,message:"请输入"}],sql:[{required:!0,message:"请输入"}]}}},created:function(){},methods:{resetForm:function(){this.formData.id="",this.formData.relationField="",this.formData.type="",this.$refs.form&&this.$refs.form.resetFields()},resetSql:function(){this.formData.sql=" "},validateForm:function(){return this.$formValidateWraper(this.$refs.form)},setForm:function(e){this.formData=this.$deepClone(e)},getForm:function(){return this.$deepClone(this.formData)}}},d=f,p=a("2877"),h=Object(p["a"])(d,u,m,!1,null,null,null),b=h.exports,_=window.$api.custmerForm.scheme,v=window.$api.data.codeTable,g={props:{stepActive:{type:Number,default:0},isDisabled:{type:Boolean,default:!1}},components:{SqlForm:b},data:function(){return{formData:{f_Name:"",f_Category:"",f_DbCode:"",f_EnabledMark:1,f_FormType:0,f_Description:""},rules:{f_Name:[{required:!0,message:this.$t("请输入"),trigger:"blur"}],f_Category:[{required:!0,message:this.$t("请选择"),trigger:"change"}],f_DbCode:[{required:!0,message:this.$t("请选择"),trigger:"change"}]},dbTableData:[],dbtableSelectdialog:!1,dbTableRData:[],isAddDbTableRData:!1,addSqlDialog:!1,editSql:!1,sqlDialogTitle:"",sqlDialogRow:null,isNotFetchTables:!1,tableColumns:{},mainTableName:""}},created:function(){this.initData()},computed:{sqlMainCols:function(){var e=this.dbTableData.find((function(e){return"main"==e.type}));return e.columns}},methods:{initData:function(){this.lr_loadDblink()},dbSelect:function(e,t,a){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function l(){var i,o,s,n,u,m;return regeneratorRuntime.wrap((function(l){while(1)switch(l.prev=l.next){case 0:if(t(),i=[],o=[],e.forEach((function(e){var t={id:e.f_TableName,name:e.f_TableName,comment:e.f_Description,columns:[]};r.tableColumns[t.name]?t.columns=r.tableColumns[t.name]:i.push(t),r.isAddDbTableRData?void 0==r.dbTableData.find((function(e){return e.name==t.name}))?r.dbTableRData.push(t):o.push(t.name):0==r.dbTableData.length?(t.type="main",r.dbTableData.push(t)):void 0==r.dbTableData.find((function(e){return e.name==t.name}))?(t.type="chlid",r.dbTableData.push(t)):o.push(t.name)})),!(i.length>0)){l.next=10;break}return l.next=7,r.$awaitWraper(v.getList(r.formData.f_DbCode,String(i.map((function(e){return e.name})))));case 7:s=l.sent,n=Object(c["a"])(i);try{for(m=function(){var e=u.value,t=s.find((function(t){return t.lr_db_codetableEntity.f_TableName==e.name}));e.columns=t.lr_db_codecolumnsList.map((function(e){return{name:e.f_DbColumnName,csType:e.f_CsType,isIdentity:1==e.f_IsIdentity,isPrimary:1==e.f_IsPrimaryKey,isNullable:1==e.f_IsNullable,coment:e.f_Description}})),r.tableColumns[e.name]=e.columns},n.s();!(u=n.n()).done;)m()}catch(f){n.e(f)}finally{n.f()}case 10:o.length>0&&(r.isAddDbTableRData?r.$message({message:"不能是表单已经绑定的表【".concat(String(o),"】"),type:"warning"}):r.$message({message:"重复添加表【".concat(String(o),"】"),type:"warning"})),r.dbtableSelectdialog=!1,r.isNotFetchTables=!1,a();case 14:case"end":return l.stop()}}),l)})))()},chlidTagClick:function(e){this.dbTableData.find((function(e){return"main"==e.type})).type="chlid",e.type="main",this.$set(this.dbTableData,0,this.dbTableData[0])},addRow:function(){this.isAddDbTableRData=!1,this.formData.f_DbCode?this.dbtableSelectdialog=!0:this.$message({message:"请选择数据库",type:"warning"})},deleteRow:function(e){this.dbTableData.splice(e.index,1),"main"==e.row.type&&this.dbTableData.length>0&&(this.dbTableData[0].type="main",this.dbTableData[0].relationName="",this.dbTableData[0].relationField="",this.dbTableData[0].field="",this.$set(this.dbTableData,0,this.dbTableData[0]))},relationTables:function(e){var t=[];return this.dbTableData.forEach((function(a){a.name!=e&&t.push(a)})),t},relationTableFields:function(e){var t=this.dbTableData.find((function(t){return t.name==e}))||{};return t.columns||[]},addDbTableRData:function(){this.isAddDbTableRData=!0,this.formData.f_DbCode?this.dbtableSelectdialog=!0:this.$message({message:"请选择数据库",type:"warning"})},deleteDbTableRData:function(e){this.dbTableRData.splice(e.index,1)},validateSteps:function(){var e=this;return new Promise((function(t){0==e.stepActive?e.validateBaseInfo().then((function(e){t(e)})):t(!0)}))},steps:function(e){return this.stepActive==e},validateBaseInfo:function(){var e=this;return new Promise((function(t){e.$refs.baseInfo.validate((function(a){if(a){if(2==e.formData.f_FormType)return void t(!0);if(e.isNotFetchTables)return e.$message({type:"error",message:"请将数据表的对象导入,点击数据表添加按钮,导入表重新编辑页面!"}),void t(!1);if(!(e.dbTableData.length>0))return e.$message({type:"error",message:1!=e.formData.f_FormType?"请添加数据库表!":"请添加视图语句"}),void t(!1);if(1!=e.formData.f_FormType){if(void 0!=e.dbTableData.find((function(t){return"main"!=t.type&&(e.$validatenull(t.field)||e.$validatenull(t.relationName)||e.$validatenull(t.relationField))})))return e.$message({type:"error",message:"请完善数据库表信息!"}),void t(!1)}else if(void 0!=e.dbTableData.find((function(t){return"main"!=t.type&&e.$validatenull(t.relationField)})))return e.$message({type:"error",message:"请完善子试图和主视图关联!"}),void t(!1);if(e.dbTableRData.length>0&&void 0!=e.dbTableRData.find((function(t){return e.$validatenull(t.fname)||e.$validatenull(t.cfield)||e.$validatenull(t.field)||e.$validatenull(t.relationName)||e.$validatenull(t.relationField)})))return e.$message({type:"error",message:"请完善数据库关联表信息!"}),void t(!1);e.$nextTick((function(){e.$refs.formDesign.updateTable()})),t(!0)}else t(!1)}))}))},resetForm:function(){this.$refs.formDesign.clear(),this.$formClear(this.$refs.baseInfo),this.isNotFetchTables=!1,this.dbTableData=[],this.dbTableRData=[],this.tableColumns={},this.mainTableName=""},validateForm:function(){return this.$refs.formDesign.validate()},setForm:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var l,i,o,s,u,m,f,d,p,h,b;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,a.$awaitWraper(_.get(e));case 2:if(l=r.sent,!l){r.next=25;break}if(t&&(l.info.f_Id="",l.info.f_SchemeId="",l.info.f_Name="".concat(l.info.f_Name,"-复制"),l.scheme.f_Id="",l.scheme.f_SchemeInfoId=""),i=JSON.parse(l.scheme.f_Scheme),l.info.f_DbCode=i.dbCode,a.formData=l.info,a.dbTableData=i.db,a.dbTableRData=i.rdb||[],1==a.formData.f_FormType||2==a.formData.f_FormType){r.next=19;break}return u=[],(o=u).push.apply(o,Object(n["a"])(a.dbTableData.map((function(e){return e.name})))),(s=u).push.apply(s,Object(n["a"])(a.dbTableRData.map((function(e){return e.name})))),u=a.$unique(u),r.next=17,a.$awaitWraper(v.getList(i.dbCode,String(u)));case 17:if(m=r.sent,m.length<u.length)a.isNotFetchTables=!0;else{f=[].concat(Object(n["a"])(a.dbTableData),Object(n["a"])(a.dbTableRData)),d=Object(c["a"])(f);try{for(h=function(){var e=p.value,t=m.find((function(t){return t.lr_db_codetableEntity.f_TableName==e.name}));e.columns=t.lr_db_codecolumnsList.map((function(e){return{name:e.f_DbColumnName,csType:e.f_CsType,isIdentity:1==e.f_IsIdentity,isPrimary:1==e.f_IsPrimaryKey,isNullable:1==e.f_IsNullable,coment:e.f_Description}})),a.tableColumns[e.name]=e.columns},d.s();!(p=d.n()).done;)h()}catch(g){d.e(g)}finally{d.f()}}case 19:return a.$refs.formDesign.setData(i.formInfo),b=i.db.filter((function(e){return"main"==e.type}))[0],b&&(a.mainTableName=b.name),r.abrupt("return",!0);case 25:return a.$message({message:"数据加载失败",type:"warning"}),r.abrupt("return",!1);case 27:case"end":return r.stop()}}),r)})))()},getForm:function(e,t,a){var r=[],l=[],i=[];if(1!=this.formData.f_FormType&&2!=this.formData.f_FormType){var o=this.dbTableData.find((function(e){return"main"==e.type}));o.columns.forEach((function(e){e.isPrimary&&i.push(e.name)}))}var s,n=this.$deepClone(this.dbTableData),u=this.$deepClone(this.dbTableRData),m=Object(c["a"])(n);try{for(m.s();!(s=m.n()).done;){var f=s.value;1!=this.formData.f_FormType&&delete f.columns,r.push(f)}}catch(y){m.e(y)}finally{m.f()}var d,p=Object(c["a"])(u);try{for(p.s();!(d=p.n()).done;){var h=d.value;1!=this.formData.f_FormType&&delete h.columns,l.push(h)}}catch(y){p.e(y)}finally{p.f()}if(t){r=[];var b=a.formInfo,_={id:b.tableInfo.tableName,name:b.tableInfo.tableName,comment:b.tableInfo.tableNotes,type:"main"};r.push(_),a.tableData.map((function(e,t){if(0!=t){var a={id:e.table,name:e.table,comment:e.tableNotes,type:"chlid",field:"".concat(b.tableInfo.tableName,"_Id"),relationName:b.tableInfo.tableName,relationField:"F_Id"};r.push(a)}}))}var v={dbCode:this.formData.f_DbCode,db:r,rdb:l,primaryKey:t?"F_Id":String(i),formInfo:t?a.formInfo:this.$refs.formDesign.getData(),formType:this.formData.f_FormType},g={info:this.$deepClone(this.formData),scheme:{F_Scheme:JSON.stringify(v),F_Type:e?2:1}};return g},handleFormTypeChange:function(){this.dbTableData=[],this.dbTableRData=[]},addSqlData:function(){this.formData.f_DbCode?(this.editSql=!1,this.sqlDialogTitle="添加SQL",this.addSqlDialog=!0):this.$message({message:"请选择数据库",type:"warning"})},editSqlData:function(e){this.formData.f_DbCode?(this.editSql=!0,this.sqlDialogRow=e,this.sqlDialogTitle="编辑SQL",this.addSqlDialog=!0):this.$message({message:"请选择数据库",type:"warning"})},deleteSqlData:function(e){var t=e.index,a=e.row;"main"!=a.type?this.dbTableData.splice(t,1):this.$message({message:"主语句无法删除",type:"warning"})},sqlDialogSave:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var l,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e("保存中..."),r.next=3,a.$refs.sqlForm.validateForm();case 3:if(!r.sent){r.next=19;break}if(l=a.$refs.sqlForm.getForm(),0==a.dbTableData.length||"main"==l.type){r.next=10;break}if(-1!=l.sql.indexOf("@param")){r.next=10;break}return a.$message({message:"请在语句中设置关联参数",type:"warning"}),t(),r.abrupt("return");case 10:return r.next=12,a.$awaitWraper(_.geColnames(a.formData.f_DbCode,l.sql));case 12:if(i=r.sent,null!=i){r.next=16;break}return t(),r.abrupt("return");case 16:l.columns=i.map((function(e){return{name:e}})),a.editSql?(o=a.dbTableData.findIndex((function(e){return e.id=l.id})),a.$set(a.dbTableData,o,l)):(0==a.dbTableData.length?l.type="main":l.type="chlid",l.id=a.$uuid(),a.dbTableData.push(l)),a.addSqlDialog=!1;case 19:t();case 20:case"end":return r.stop()}}),r)})))()},sqlDialogClosed:function(){this.$refs.sqlForm.resetForm()},sqlDialogOpened:function(){this.editSql?this.$refs.sqlForm.setForm(this.sqlDialogRow):this.$refs.sqlForm.resetSql()}}},y=g,D=Object(p["a"])(y,o,s,!1,null,null,null),$=D.exports,w=a("6862"),T=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("l-layout",{staticClass:"l-tab-page"},[a("l-panel",{staticStyle:{padding:"0"},scopedSlots:e._u([{key:"toolRight",fn:function(){return[a("el-button-group",[a("el-button",{attrs:{size:"mini",icon:"el-icon-refresh-left"},on:{click:e.handleRefresh}})],1)]},proxy:!0}])},[a("div",{staticClass:"l-rblock"},[a("l-table",{attrs:{loading:e.tableLoading,columns:e.columns,dataSource:e.tableData,"row-key":"f_Id",isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([{key:"f_CreateDate",fn:function(t){return[e._v(" "+e._s(e.lr_dateFormat(t.row.f_CreateDate))+" ")]}},{key:"f_Type",fn:function(t){return[1!=t.row.f_Type?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("草稿")]):a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("正式")])]}},{key:"f_IsVerison",fn:function(t){return[a("el-switch",{attrs:{disabled:t.row.f_IsVerison},on:{change:function(a){return e.handleEnableChange(t.row)}},model:{value:t.row.f_IsVerison,callback:function(a){e.$set(t.row,"f_IsVerison",a)},expression:"scope.row.f_IsVerison"}})]}}])},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1)]),a("l-dialog",{attrs:{title:e.$t("表单预览")+"-"+e.previewTitle,visible:e.previewVisible,height:600,width:"800px",hasBtns:!1},on:{"update:visible":function(t){e.previewVisible=t},opened:e.handlePreviewOpened,closed:e.handlePreviewClosed}},[a("preview",{ref:"preview",attrs:{loading:e.previewLoading}})],1)],1)},k=[],x=a("5530"),S=window.$api.custmerForm.scheme,C={components:{preview:w["a"]},props:{schemeInfoId:String,schemeId:String,updateSchemeId:Function},data:function(){return{noAuth:!0,columns:[{label:"创建人",prop:"f_CreateUserName",minWidth:"160"},{label:"创建时间",prop:"f_CreateDate",minWidth:"160"},{label:"状态",prop:"f_Type",width:"64",align:"center"},{label:"当前版本",prop:"f_IsVerison",width:"80",align:"center"}],tableBtns:[{prop:"Preview",label:"预览"}],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1,tableData:[],previewVisible:!1,previewTitle:"",previewLoading:!1,formEditRow:null}},computed:{},methods:{handleRefresh:function(){this.loadTablePageData()},loadTablePageData:function(e){var t=this;e||(this.tableCurrentPage=1),this.tableLoading=!0;var a={rows:this.tablePageSize,page:this.tableCurrentPage,sidx:"F_CreateDate DESC"};S.getHistoryPage(this.schemeInfoId,a).then((function(e){var a=t.$deepClone(e.data.data);t.tableData=a.rows.map((function(e){return Object(x["a"])(Object(x["a"])({},e),{},{f_IsVerison:e.f_Id==t.schemeId})})),t.tableTotal=a.records,t.tableLoading=!1})).catch((function(){t.tableData=[],t.tableLoading=!1}))},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTablePageData(!0)},handleEnableChange:function(e){var t=this;this.updateSchemeId(e.f_Id),this.tableData.forEach((function(t){t.f_Id!=e.f_Id&&(t.f_IsVerison=!1)})),S.updateHistory(this.schemeInfoId,e.f_Id).then((function(){t.$message({type:"success",message:"更新成功!"})}))},handlePreview:function(e,t){this.formEditRow=t,this.previewLoading=!0,this.previewTitle=this.lr_dateFormat(t.f_CreateDate),this.previewVisible=!0},handlePreviewOpened:function(){var e=this;S.getHistory(this.formEditRow.f_Id).then((function(t){e.$refs.preview.setForm(t.data.data),e.previewLoading=!1})).catch((function(){e.previewLoading=!1}))},handlePreviewClosed:function(){this.$refs.preview.resetForm()}}},F=C,N=Object(p["a"])(F,T,k,!1,null,null,null),q=N.exports,I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-rblock structure"},[a("p",{staticClass:"structure-tip"},[e._v(" * ( "+e._s(e.tableName)+" ) 为主表，字段名可进行修改，数据格式默认为 varchar ")]),a("p",{staticClass:"structure-tip structure-tip2"},[e._v(" * 表名、字段名由数字、字母或下划线组成，且不能以数字，特殊字符串开头。 ")]),a("p",{staticClass:"structure-tip structure-tip2"},[e._v("* 表名、字段名一旦生成不可修改。")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"default-expand-all":""}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-table",{staticStyle:{width:"90%","margin-left":"55px"},attrs:{data:t.row.fieldList||t.row.children,"row-class-name":e.rowClassName}},e._l(e.childColumns,(function(t,r,l){return a("el-table-column",{key:l,attrs:{label:t.name,prop:t.propName},scopedSlots:e._u([{key:"default",fn:function(r){return["field"==t.propName?a("el-input",{attrs:{size:"mini",maxlength:"30",oninput:"value=value.replace(/[^\\a-\\z\\A-\\Z0-9\\_]|^[0-9\\_]/g,'')",disabled:r.row.fieldDisabled,placeholder:"请输入字段名"},model:{value:r.row.field,callback:function(t){e.$set(r.row,"field",t)},expression:"scope.row.field"}}):e._e(),"fieldLong"==t.propName?a("el-input",{attrs:{size:"mini",disabled:"varchar"!=r.row.fieldFormat,placeholder:"请输入长度",oninput:"value=value.replace(/[^\\d]/g,'')"},on:{change:function(e){Number(r.row.fieldLong)?Number(r.row.fieldLong)>500?r.row.fieldLong=500:Number(r.row.fieldLong)<0?r.row.fieldLong=0:r.row.fieldLong=r.row.fieldLong:r.row.fieldLong=0}},model:{value:r.row.fieldLong,callback:function(t){e.$set(r.row,"fieldLong",e._n(t))},expression:"scope.row.fieldLong"}}):e._e(),"fieldFormat"==t.propName?a("l-select",{attrs:{options:e.formatOptions,clearable:!1},on:{change:function(e){"varchar"!==r.row.fieldFormat?r.row.fieldLong=null:r.row.fieldLong=200}},model:{value:r.row.fieldFormat,callback:function(t){e.$set(r.row,"fieldFormat",t)},expression:"scope.row.fieldFormat"}}):e._e(),"label"==t.propName?a("span",[e._v(e._s(r.row.label))]):e._e()]}}],null,!0)})})),1)]}}])}),e._l(e.parentsCloums,(function(t,r,l){return a("el-table-column",{key:l,attrs:{label:t.name,prop:t.propName},scopedSlots:e._u([{key:"default",fn:function(r){return["table"==t.propName?a("el-input",{attrs:{size:"mini",maxlength:"30",oninput:"value=value.replace(/[^\\a-\\z\\A-\\Z0-9\\_]|^[0-9\\_]/g,'')",disabled:r.row.tableDisabled,placeholder:"请输入表名"},model:{value:r.row.table,callback:function(t){e.$set(r.row,"table",t)},expression:"scope.row.table"}}):e._e(),"tableNotes"==t.propName?a("el-input",{attrs:{size:"mini",placeholder:"请输入备注"},model:{value:r.row.tableNotes,callback:function(t){e.$set(r.row,"tableNotes",t)},expression:"scope.row.tableNotes"}}):e._e()]}}],null,!0)})}))],2)],1)},O=[],R=(a("caad"),a("2532"),{data:function(){return{parentsCloums:[{name:"表名",id:"table",propName:"table"},{name:"备注",id:"tableNotes",propName:"tableNotes"}],childColumns:[{name:"字段名",id:"field",propName:"field"},{name:"长度",id:"fieldLong",propName:"fieldLong"},{name:"数据格式(默认varchar)",id:"fieldFormat",propName:"fieldFormat"},{name:"备注",id:"label",propName:"label"}],formatOptions:[{value:"varchar",label:"短文本"},{value:"text",label:"长文本"},{value:"int",label:"整数"},{value:"decimal",label:"小数"},{value:"datetime",label:"时间日期"}],tableData:[],designData:{},tabList:[],belongType:["btn"]}},computed:{tableName:{get:function(){return this.tableData[0]?this.tableData[0].table:""},set:function(){}},tableNotes:{get:function(){return this.tableData[0]?this.tableData[0].tableNotes:""},set:function(){}}},methods:{setForm:function(e,t){var a=this;this.designData=e;var r=[],l=e.tableInfo&&e.tableInfo.tableNotes||"",i=0,o=0,s=t||"table"+parseInt((new Date).getTime()/1e3)+i;i++,this.tableData=[];var n={table:s,tableNotes:l,tableDisabled:!!t,fieldList:[]},c=[];e.tabList.map((function(e){a.compList=e.components;var t=[];a.compList.map((function(e){if(["card","collapse","tab","divider","lable","viewtable","btn","gridtable","qrcode","barcode","tableLayout"].includes(e.type)||e.isNotSave||(e=Object(x["a"])(Object(x["a"])({},e),{},{field:e.field?e.field:"field"+parseInt((new Date).getTime()/1e3)+o,fieldLong:e.fieldLong?e.fieldLong:"varchar"!=e.fieldFormat&&e.fieldFormat?null:200,fieldFormat:e.fieldFormat?e.fieldFormat:"varchar",fieldDisabled:!!e.field}),o++,n.fieldList.push(e)),["gridtable"].includes(e.type)){var r="table"+parseInt((new Date).getTime()/1e3)+i;i++;var l=Object(x["a"])(Object(x["a"])({},e),{},{table:e.table?e.table:r,tableNotes:e.tableNotes?e.tableNotes:"",tableDisabled:!!e.table});e=l;var s=[];e.children.map((function(e){["btn"].includes(e.type)||(e=Object(x["a"])(Object(x["a"])({},e),{},{field:e.field?e.field:"field"+parseInt((new Date).getTime()/1e3)+o,fieldLong:e.fieldLong?e.fieldLong:"varchar"!=e.fieldFormat&&e.fieldFormat?null:200,fieldFormat:e.fieldFormat?e.fieldFormat:"varchar",fieldDisabled:!!e.field}),o++),s.push(e)})),l.children=s,a.tableData.push(l),a.$set(e,"children",s)}c.push(e),t.push(e)})),r.push(Object(x["a"])(Object(x["a"])({},e),{},{components:t}))})),this.tableData.unshift(n),this.tabList=r},getForm:function(){for(var e=this,t=0;t<this.tableData.length;t++){if(!this.tableData[t].table)return this.$message({type:"error",message:"请填写表名!"}),!1;for(var a=0;a<(this.tableData[t].fieldList?this.tableData[t].fieldList.length:this.tableData[t].children.length);a++){var r=this.tableData[t].fieldList||this.tableData[t].children;if(!r[a].field&&"btn"!==r[a].type)return this.$message({type:"error",message:"请填写字段名!"}),!1;if(r[a].field&&"f_id"==r[a].field.toLowerCase())return this.$message({type:"error",message:"字段名不能设置为f_id!"}),!1}}var l=[];return this.tabList.map((function(t){var a=[];t.components.map((function(t){if(["card","collapse","tab","tableLayout","divider","lable","viewtable","btn","gridtable","qrcode","barcode"].includes(t.type)||t.isNotSave)if(["gridtable"].includes(t.type)){for(var r=[],l=0;l<t.children.length;l++){var i=t.children[l];["btn"].includes(i.type)?r.push(i):r.push(Object(x["a"])(Object(x["a"])({},i),{},{table:t.table}))}a.push(Object(x["a"])(Object(x["a"])({},t),{},{children:r}))}else a.push(t);else a.push(Object(x["a"])(Object(x["a"])({},t),{},{table:e.tableName}))})),l.push(Object(x["a"])(Object(x["a"])({},t),{},{components:a}))})),{formInfo:Object(x["a"])(Object(x["a"])({},this.designData),{},{tabList:l,tableInfo:{tableName:this.tableName,tableNotes:this.tableNotes}}),tableData:this.tableData}},resetForm:function(){this.tableName="",this.tableData=[]},rowClassName:function(e){var t=e.row;if(this.belongType.length)return this.belongType.includes(t.type)?"showRow":void 0}}}),E=R,L=(a("e7b4"),Object(p["a"])(E,I,O,!1,null,null,null)),P=L.exports,V=window.$api.custmerForm.scheme,A={components:{formDesignForm:$,preview:w["a"],history:q,tableStructure:P},data:function(){return{lr_isPage:!0,stepActive:0,stepPrevBtn:!0,stepNextBtn:!1,stepSaveBtn:!0,formVisible:!1,treeLoading:!1,treeCategory:"",classifysVisible:!1,columns:[{label:"名称",prop:"f_Name",minWidth:"150"},{label:"分类",prop:"f_Category",width:"140",align:"center"},{label:"类型",prop:"f_FormType",width:"100",align:"center"},{label:"状态",prop:"f_EnabledMark",width:"64",align:"center"},{label:"创建人",prop:"f_CreateUserName",width:"100",align:"center"},{label:"创建时间",prop:"f_CreateDate",width:"160"}],tableBtns:[{prop:"Edit",label:"编辑",width:40},{prop:"Delete",label:"删除",width:40},{prop:"Copy",label:"复制",width:40},{prop:"Export",label:"导出",width:40},{prop:"Preview",label:"预览",width:40},{prop:"History",label:"历史记录",width:60}],tableLoading:!1,tableTotal:0,tablePageSize:50,tableCurrentPage:1,tableData:[],keyWord:"",formEdit:!1,formEditRow:null,formLoading:!1,formLoadingText:"",previewVisible:!1,previewTitle:"",previewLoading:!1,historyVisible:!1,historyTitle:"",schemeInfoId:"",schemeId:"",formCopy:!1,tableStructureVisible:!1}},created:function(){this.lr_loadDataItem("FormSort"),this.loadTablePageData()},mounted:function(){},computed:{dataItemTree_FormSort:function(){return this.lr_dataItemTree(this.lr_dataItem["FormSort"])}},methods:{loadTablePageData:function(e){var t=this;e||(this.tableCurrentPage=1),this.tableLoading=!0;var a={rows:this.tablePageSize,page:this.tableCurrentPage,sidx:"F_CreateDate DESC",category:this.treeCategory,keyword:this.keyWord};V.getPage(a).then((function(e){var a=t.$deepClone(e.data.data);t.tableData=a.rows,t.tableTotal=a.records,t.tableLoading=!1})).catch((function(){t.tableData=[],t.tableLoading=!1}))},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTablePageData(!0)},hanleSearch:function(){this.loadTablePageData()},handleSettingClick:function(){this.classifysVisible=!0},handleNodeClick:function(e){this.treeCategory=e.value,this.loadTablePageData(!0)},handleAdd:function(){this.formEdit=!1,this.formCopy=!1,this.showForm()},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.formCopy=!1,this.showForm()},handleDelete:function(e,t){var a=this;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.tableData.splice(e,1),a.tableTotal--,V.remove(t.f_Id).then((function(){a.$message({type:"success",message:"删除成功!"})}))})).catch((function(){a.$message({type:"info",message:"已取消删除"})}))},handleSaveDraft:function(){this.handleSave(this.$refs.formDialog.showLoading,this.$refs.formDialog.hideLoading,!0)},handleSave:function(e,t,a,r){var l=this;if(2==this.$refs.form.formData.f_FormType||this.$refs.form.dbTableData.length)if(2!=this.$refs.form.formData.f_FormType||a||r)if(e("保存数据中..."),a||this.$refs.form.validateForm()){var i={};if(!r||(i=this.$refs.tableStructure.getForm(),i)){var o=this.$refs.form.getForm(a,r,i);this.formEdit?V.update(this.formEditRow.f_Id,o).then((function(){l.loadTablePageData(!0),l.$message({type:"success",message:"更新成功!"}),a||(l.formVisible=!1),r&&(l.tableStructureVisible=!1),t()})).catch((function(){t()})):V.add(o).then((function(e){l.formEditRow=e.data.data,l.formEdit=!0,l.loadTablePageData(!0),l.$message({type:"success",message:"添加成功!"}),a||(l.formVisible=!1),r&&(l.tableStructureVisible=!1),t()})).catch((function(){t()}))}else t()}else t();else this.tableStructureVisible=!0;else this.$message({type:"error",message:"请添加数据库表!"})},handleEnableChange:function(e){var t=this;V.updateState(e.f_Id,e.f_EnabledMark).then((function(){t.$message({type:"success",message:"更新成功!"})}))},handlePreview:function(e,t){this.formEditRow=t,this.previewLoading=!0,this.previewVisible=!0,this.previewTitle=t.f_Name},handlePreviewOpened:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e("加载中..."),r.next=3,a.$awaitWraper(V.getHistory(a.formEditRow.f_SchemeId));case 3:l=r.sent,l&&a.$refs.preview.setForm(l),t();case 6:case"end":return r.stop()}}),r)})))()},handlePreviewClosed:function(){this.$refs.preview.resetForm()},handleHistory:function(e,t){this.formEditRow=t,this.historyTitle=t.f_Name,this.schemeId=t.f_SchemeId,this.schemeInfoId=t.f_Id,this.historyVisible=!0},HistoryOpened:function(){this.$refs.HistoryForm.loadTablePageData()},updateSchemeId:function(e){this.schemeId=e,this.formEditRow.f_SchemeId=e},showForm:function(){this.formVisible=!0},handleValidateSteps:function(){return this.$refs.form.validateSteps()},handleOpened:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a.formEdit&&!a.formCopy){r.next=7;break}return e("加载数据中..."),r.next=4,a.$refs.form.setForm(a.formEditRow.f_Id,a.formCopy);case 4:l=r.sent,t(),l||(a.formVisible=!1);case 7:case"end":return r.stop()}}),r)})))()},handleClosed:function(){this.$refs.form.resetForm()},handleCopy:function(e,t){this.formEdit=!1,this.formCopy=!0,this.formEditRow=t,this.showForm()},handleExport:function(e,t){this.lr_downTempFile("custmerform/scheme/download/custmerform/".concat(t.f_Id),"表单设计_".concat(t.f_Name),"custmerform","json")},exportSuccess:function(){this.loadTablePageData()},handleTableStructureOpened:function(){var e=this.$refs.form.mainTableName,t=this.$refs.form.$refs.formDesign.getData();this.$refs.tableStructure.setForm(t,e)},handleTableStructureClosed:function(){this.$refs.tableStructure.resetForm()},handleTableStructureOk:function(){this.handleSave(this.$refs.formTableStructure.showLoading,this.$refs.formTableStructure.hideLoading,!1,!0)}}},j=A,W=Object(p["a"])(j,r,l,!1,null,null,null);t["default"]=W.exports},"8a37":function(e,t,a){},"8fbf":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page",scopedSlots:e._u([{key:"left",fn:function(){return[a("l-panel",{staticStyle:{"padding-right":"0"},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.$t("表单分类"))+" "),a("div",{staticClass:"tree-setting-btn"},[a("el-tooltip",{attrs:{effect:"dark",content:e.$t("分类管理"),placement:"top"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-setting"},on:{click:e.handleSettingClick}})],1)],1)]},proxy:!0}],null,!1,4241853718)},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticClass:"learun-tree",attrs:{data:e.treeData,"default-expand-all":"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node;return a("span",{staticClass:"lr-tree-node"},[e._v(" "+e._s(e.$t(r.label))+" ")])}}],null,!1,3997867947)})],1)]},proxy:!0}],null,!1,3693888314)},[a("l-panel",{staticStyle:{"padding-left":"0"},scopedSlots:e._u([{key:"toolLeft",fn:function(){return[a("l-query2",{attrs:{items:e.queryItems,formData:e.queryData,loading:e.tableLoading},on:{search:e.handleSearch},scopedSlots:e._u([{key:"f_Name",fn:function(){return[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.queryData.f_Name,callback:function(t){e.$set(e.queryData,"f_Name",t)},expression:"queryData.f_Name"}})]},proxy:!0},{key:"f_Code",fn:function(){return[a("el-input",{attrs:{placeholder:e.$t("请输入")},model:{value:e.queryData.f_Code,callback:function(t){e.$set(e.queryData,"f_Code",t)},expression:"queryData.f_Code"}})]},proxy:!0}],null,!1,2991152585)})]},proxy:!0},{key:"toolRight",fn:function(){return[a("l-tool-btns",{attrs:{hasTableSetting:!0},on:{setting:e.lr_handleSettingTable,click:function(t){return e.handleAdd()}}},[a("l-excel-btns")],1)]},proxy:!0}],null,!1,1115749121)},[a("l-table",{ref:"mainTable",attrs:{loading:e.tableLoading,columns:e.lr_getPageColumns(e.columns),dataSource:e.tableData,isPage:!0,pageTotal:e.tableTotal,tablePage:e.tableCurrentPage},on:{"update:tablePage":function(t){e.tableCurrentPage=t},"update:table-page":function(t){e.tableCurrentPage=t},loadPageData:e.turnTablePage},scopedSlots:e._u([e._l(e.lr_tableColumnsByToLabel(e.lr_getPageColumns(e.columns)),(function(e,t){return{key:e.prop,fn:function(r){return[a("l-value-to-label",{key:t,attrs:{value:r.row[e.prop],type:e.dataType,code:e.dataCode,valueKey:e.valueKey,labelKey:e.labelKey,options:e.options,format:e.format,setting:e.setting}})]}}}))],null,!0)},[a("l-table-btns",{attrs:{btns:e.tableBtns},on:{click:e.lr_handleTableBtnClick}})],1)],1),a("l-dialog",{attrs:{isStep:!0,steps:["基本配置","数据配置"],stepActive:e.stepActive,validateSteps:e.handleValidateSteps,title:e.$t(e.formTitle),visible:e.formVisible,height:600,width:800},on:{"update:stepActive":function(t){e.stepActive=t},"update:step-active":function(t){e.stepActive=t},"update:visible":function(t){e.formVisible=t},ok:e.handleSave,close:e.handleCloseForm,opened:e.handleOpenedForm}},[a("my-form",{ref:"form",attrs:{stepActive:e.stepActive}})],1),a("l-drawer",{attrs:{title:e.$t("分类管理"),visible:e.classifysVisible,showOk:!1,showClose:!1,width:800},on:{"update:visible":function(t){e.classifysVisible=t}}},[a("l-dataitem-index",{attrs:{classifyCode:"ReportSort"}})],1),a("l-fullscreen-dialog",{attrs:{title:""+e.$t("报表预览"),visible:e.previewVisible,showOk:!1},on:{"update:visible":function(t){e.previewVisible=t},opened:e.previewOpened}},[a("my-preview",{ref:"MyPreview"})],1)],1)},l=[],i=(a("a434"),a("96cf"),a("1da1")),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"l-rblock l-form-viewer",staticStyle:{padding:"8px"}},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.steps(0),expression:"steps(0)"}],ref:"form",attrs:{model:e.formData,rules:e.rules,size:"mini",labelPosition:"right",labelWidth:"80px"}},[a("el-row",{attrs:{gutter:0}},[a("div",{staticClass:"l-rblock"},[e.lr_formLookAuth("lr_report_scheme_f_Code")?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("报表编号"),prop:"lr_report_scheme_f_Code"}},[a("el-input",{attrs:{disabled:!e.lr_formEditAuth("lr_report_scheme_f_Code"),placeholder:e.$t("请输入")},model:{value:e.formData.lr_report_scheme_f_Code,callback:function(t){e.$set(e.formData,"lr_report_scheme_f_Code",t)},expression:"formData.lr_report_scheme_f_Code"}})],1)],1):e._e(),e.lr_formLookAuth("lr_report_scheme_f_Name")?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("报表名称"),prop:"lr_report_scheme_f_Name"}},[a("el-input",{attrs:{disabled:!e.lr_formEditAuth("lr_report_scheme_f_Name"),placeholder:e.$t("请输入")},model:{value:e.formData.lr_report_scheme_f_Name,callback:function(t){e.$set(e.formData,"lr_report_scheme_f_Name",t)},expression:"formData.lr_report_scheme_f_Name"}})],1)],1):e._e(),e.lr_formLookAuth("lr_report_scheme_f_TempCategory")?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("报表分类"),prop:"lr_report_scheme_f_TempCategory"}},[a("l-select",{attrs:{disabled:!e.lr_formEditAuth("lr_report_scheme_f_TempCategory"),options:e.lr_report_scheme_f_TempCategoryOptions},model:{value:e.formData.lr_report_scheme_f_TempCategory,callback:function(t){e.$set(e.formData,"lr_report_scheme_f_TempCategory",t)},expression:"formData.lr_report_scheme_f_TempCategory"}})],1)],1):e._e(),e.lr_formLookAuth("lr_report_scheme_f_TempStyle")?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("报表风格"),prop:"lr_report_scheme_f_TempStyle"}},[a("l-radio",{attrs:{disabled:!e.lr_formEditAuth("lr_report_scheme_f_TempStyle"),options:e.lr_report_scheme_f_TempStyleOptions},model:{value:e.formData.lr_report_scheme_f_TempStyle,callback:function(t){e.$set(e.formData,"lr_report_scheme_f_TempStyle",t)},expression:"formData.lr_report_scheme_f_TempStyle"}})],1)],1):e._e(),!e.lr_formLookAuth("lr_report_scheme_f_TempType")||"2"!=e.formData.lr_report_scheme_f_TempStyle&&"3"!=e.formData.lr_report_scheme_f_TempStyle?e._e():a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("图表类型"),prop:"lr_report_scheme_f_TempType"}},[a("l-select",{attrs:{disabled:!e.lr_formEditAuth("lr_report_scheme_f_TempType"),options:e.lr_report_scheme_f_TempTypeOptions},model:{value:e.formData.lr_report_scheme_f_TempType,callback:function(t){e.$set(e.formData,"lr_report_scheme_f_TempType",t)},expression:"formData.lr_report_scheme_f_TempType"}})],1)],1),e.lr_formLookAuth("lr_report_scheme_f_Description")?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("报表介绍"),prop:"lr_report_scheme_f_Description"}},[a("el-input",{attrs:{type:"textarea",disabled:!e.lr_formEditAuth("lr_report_scheme_f_Description"),rows:5,placeholder:e.$t("请输入")},model:{value:e.formData.lr_report_scheme_f_Description,callback:function(t){e.$set(e.formData,"lr_report_scheme_f_Description",t)},expression:"formData.lr_report_scheme_f_Description"}})],1)],1):e._e()],1)])],1),a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.steps(1),expression:"steps(1)"}],ref:"form2",attrs:{model:e.formData2,rules:e.rules2,size:"mini",labelPosition:"right",labelWidth:"80px"}},[a("el-row",{attrs:{gutter:0}},[a("div",{staticClass:"l-rblock"},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("数据库"),prop:"dbCode"}},[a("el-select",{attrs:{placeholder:e.$t("请选择")},model:{value:e.formData2.dbCode,callback:function(t){e.$set(e.formData2,"dbCode",t)},expression:"formData2.dbCode"}},e._l(e.lr_dblinkTree,(function(t){return a("el-option-group",{key:t.id,attrs:{label:t.label}},e._l(t.children,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),1)})),1)],1)],1),"2"==e.formData.lr_report_scheme_f_TempStyle||"3"==e.formData.lr_report_scheme_f_TempStyle?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("图表SQL"),prop:"chart_sql"}},[a("el-input",{attrs:{type:"textarea",rows:8,placeholder:e.$t("请输入")},model:{value:e.formData2.chart_sql,callback:function(t){e.$set(e.formData2,"chart_sql",t)},expression:"formData2.chart_sql"}})],1)],1):e._e(),"1"==e.formData.lr_report_scheme_f_TempStyle||"3"==e.formData.lr_report_scheme_f_TempStyle?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("列表SQL"),prop:"table_sql"}},[a("el-input",{attrs:{type:"textarea",rows:8,placeholder:e.$t("请输入")},model:{value:e.formData2.table_sql,callback:function(t){e.$set(e.formData2,"table_sql",t)},expression:"formData2.table_sql"}})],1)],1):e._e()],1)])],1)],1)},s=[],n=(a("a9e3"),window.$api.report.scheme),c={props:{stepActive:{type:Number,default:0}},data:function(){var e=this;return{moduleCode:"report_scheme",formData:{lr_report_scheme_f_Code:"",lr_report_scheme_f_Name:"",lr_report_scheme_f_TempCategory:"",lr_report_scheme_f_TempStyle:"1",lr_report_scheme_f_TempType:"",lr_report_scheme_f_Description:""},formData2:{dbCode:"",chart_sql:"",table_sql:""},rules:{lr_report_scheme_f_Code:[{required:!0,message:this.$t("请输入报表编号")},{validator:this.lr_existDbFiled,fieldName:"f_Code",keyValue:function(){return e.formData.lr_report_scheme_f_Id},tableName:"lr_report_scheme",keyName:"f_Id",trigger:"null"}],lr_report_scheme_f_Name:[{required:!0,message:this.$t("请输入报表名称")}],lr_report_scheme_f_TempCategory:[{required:!0,message:this.$t("请选择报表分类")}],lr_report_scheme_f_TempStyle:[{required:!0,message:this.$t("请选择报表风格")}],lr_report_scheme_f_TempType:[{required:!0,message:this.$t("请选择图表类型")}]},rules2:{dbCode:[{required:!0,message:this.$t("数据库")}],chart_sql:[{required:!0,message:this.$t("图表SQL")}],table_sql:[{required:!0,message:this.$t("列表SQL")}]}}},computed:{lr_report_scheme_f_TempCategoryOptions:function(){return this.lr_loadDataItem("ReportSort"),this.lr_dataItemOptions(this.lr_dataItem["ReportSort"])},lr_report_scheme_f_TempStyleOptions:function(){return[{value:"1",label:"列表"},{value:"2",label:"图表"},{value:"3",label:"混合"}]},lr_report_scheme_f_TempTypeOptions:function(){return[{value:"line",label:"折线图"},{value:"bar",label:"柱状图"},{value:"pie",label:"饼图"}]}},created:function(){this.lr_loadDblink()},methods:{resetForm:function(){this.formData.lr_report_scheme_f_Id="",this.$formClear(this.$refs.form),this.$formClear(this.$refs.form2)},validateSteps:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!=e.stepActive){t.next=4;break}return t.abrupt("return",e.validateBaseInfo());case 4:return t.abrupt("return",!0);case 5:case"end":return t.stop()}}),t)})))()},steps:function(e){return this.stepActive==e},validateBaseInfo:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$formValidateWraper(e.$refs.form);case 2:if(t.sent){t.next=4;break}return t.abrupt("return",!1);case 4:return t.abrupt("return",!0);case 5:case"end":return t.stop()}}),t)})))()},validateForm:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$formValidateWraper(e.$refs.form2);case 2:if(t.sent){t.next=4;break}return t.abrupt("return",!1);case 4:return t.abrupt("return",!0);case 5:case"end":return t.stop()}}),t)})))()},setForm:function(e){this.$setFormData(this.formData,e,"lr_report_scheme");var t=JSON.parse(e.f_ParamJson);this.formData2.dbCode=t.F_DataSourceId,this.formData2.chart_sql=t.F_ChartSqlString,this.formData2.table_sql=t.F_ListSqlString},getForm:function(){var e={F_DataSourceId:this.formData2.dbCode,F_ChartSqlString:this.formData2.chart_sql,F_ListSqlString:this.formData2.table_sql},t=this.$getFormData(this.formData,"lr_report_scheme");return t.f_ParamJson=this.lr_AESEncrypt(JSON.stringify(e),"learun"),t},loadFormData:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=e.keyValue,a.next=3,t.$awaitWraper(n.get(r));case 3:if(l=a.sent,!l){a.next=9;break}return t.setForm(l),a.abrupt("return",!0);case 9:return a.abrupt("return",!1);case 10:case"end":return a.stop()}}),a)})))()},saveForm:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,l,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=e.keyValue,l=e.isEdit,i=t.getForm(),!l){a.next=8;break}return a.next=5,t.$awaitWraper(n.update(r,i));case 5:return a.abrupt("return",a.sent);case 8:return i.f_Id=r,a.next=11,t.$awaitWraper(n.add(i));case 11:return a.abrupt("return",a.sent);case 12:case"end":return a.stop()}}),a)})))()}}},u=c,m=a("2877"),f=Object(m["a"])(u,o,s,!1,null,null,null),d=f.exports,p=a("d646"),h=window.$api.report.scheme,b={components:{MyForm:d,MyPreview:p["default"]},data:function(){return{lr_isPage:!0,lr_isAuth:!0,moduleCode:"report_scheme",stepActive:0,treeLoading:!1,treeCategory:"",classifysVisible:!1,queryData:{f_Name:"",f_Code:""},queryItems:[{label:this.$t("报表名称"),prop:"f_Name"},{label:this.$t("报表编号"),prop:"f_Code"}],tableLoading:!1,tableData:[],tableTotal:0,tableCurrentPage:1,tablePageSize:50,columns:[{label:"报表编号",prop:"f_Code",width:120,align:"left",dataType:"input"},{label:"报表名称",prop:"f_Name",minWidth:120,align:"left",dataType:"input"},{label:"报表分类",prop:"f_TempCategory",width:100,align:"left",dataType:"dataItem",dataCode:"ReportSort"},{label:"报表风格",prop:"f_TempStyle",width:80,align:"center",dataType:"mydata",options:[{value:"1",label:"列表"},{value:"2",label:"图表"},{value:"3",label:"混合"}]},{label:"报表介绍",prop:"f_Description",minWidth:120,align:"left",dataType:"textarea"}],tableBtns:[{prop:"Preview",label:this.$t("预览"),width:50},{prop:"Edit",label:this.$t("编辑"),width:40},{prop:"Delete",label:this.$t("删除"),width:40}],formVisible:!1,formTitle:"",formEditRow:null,formEdit:!1,previewVisible:!1}},computed:{treeData:function(){return this.lr_dataItemTree(this.lr_dataItem["ReportSort"])}},mounted:function(){this.init()},methods:{init:function(){this.lr_loadDataItem("ReportSort"),this.loadTableData()},handleSettingClick:function(){this.classifysVisible=!0},handleNodeClick:function(e){this.treeCategory=e.value,this.loadTableData(!0)},handleSearch:function(){this.loadTableData()},turnTablePage:function(e){var t=e.rows;this.tablePageSize=t,this.loadTableData(!0)},loadTableData:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e||(t.tableCurrentPage=1),t.tableLoading=!0,r=t.$deepClone(t.queryData),r.rows=t.tablePageSize,r.page=t.tableCurrentPage,r.sidx="F_Id",r.f_TempCategory=t.treeCategory,a.next=9,t.$awaitWraper(h.getPage(r));case 9:l=a.sent,null!=l?(t.tableData=l.rows,t.tableTotal=l.records):t.tableData=[],t.tableLoading=!1;case 12:case"end":return a.stop()}}),a)})))()},handleValidateSteps:function(){return this.$refs.form.validateSteps()},handleAdd:function(){this.formEdit=!1,this.handleShowForm("新增报表")},handleEdit:function(e,t){this.formEdit=!0,this.formEditRow=t,this.handleShowForm("编辑报表")},handlePreview:function(e,t){this.formEdit=!0,this.formEditRow=t,this.previewVisible=!0},handleDelete:function(e,t){var a=this;this.$confirm(this.$t("此操作将永久删除该数据, 是否继续?"),this.$t("提示"),{confirmButtonText:this.$t("确定"),cancelButtonText:this.$t("取消"),type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.tableData.splice(e,1),a.tableTotal--,r.next=4,h.remove(t.f_Id);case 4:a.$message({type:"success",message:a.$t("删除成功!")});case 5:case"end":return r.stop()}}),r)})))).catch((function(){a.$message({type:"info",message:a.$t("已取消删除!")})}))},handleSave:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var l,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e("保存数据中..."),r.next=3,a.$refs.form.validateForm();case 3:if(!r.sent){r.next=8;break}return r.next=6,a.$refs.form.saveForm({keyValue:a.formEdit?a.formEditRow.f_Id:"",isEdit:a.formEdit});case 6:l=r.sent,l&&(i=a.formEdit?a.$t("更新成功!"):a.$t("新增成功!"),a.$message({type:"success",message:a.$t(i)}),a.loadTableData(),a.formVisible=!1);case 8:t();case 9:case"end":return r.stop()}}),r)})))()},handleShowForm:function(e){this.formTitle=e,this.formVisible=!0},handleOpenedForm:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!a.formEdit){r.next=5;break}return e("加载数据中..."),r.next=4,a.$refs.form.loadFormData({keyValue:a.formEditRow.f_Id});case 4:t();case 5:case"end":return r.stop()}}),r)})))()},handleCloseForm:function(){this.$refs.form.resetForm()},previewOpened:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e("加载数据中..."),r.next=3,a.$refs.MyPreview.init(a.formEditRow.f_Id,!0);case 3:t();case 4:case"end":return r.stop()}}),r)})))()}}},_=b,v=Object(m["a"])(_,r,l,!1,null,null,null);t["default"]=v.exports},d646:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.lr_loadPage?e._e():a("l-layout",{staticClass:"l-tab-page"},[a("l-panel",{staticClass:"l-panel-overflow",attrs:{title:e.title}},["2"==e.data.tempStyle||"3"==e.data.tempStyle?a("div",{staticClass:"report-chart"},[a("l-echarts",{ref:"main"})],1):e._e(),"1"==e.data.tempStyle||"3"==e.data.tempStyle?a("l-table",{ref:"mainTable",attrs:{height:"notset",columns:e.columns,dataSource:e.tableData}}):e._e()],1)],1)},l=[],i=(a("99af"),a("b0c0"),a("159b"),a("96cf"),a("1da1")),o=a("5530"),s=a("5880"),n=window.$api.report.scheme,c={data:function(){return{lr_isPage:!1,tableData:[],columns:[],ispreview:!1,id:"",data:{},ready:!1,timer:null,barOption:{tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{data:[],type:"bar"}]},lineOption:{xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{data:[],type:"line"}]},pieOption:{tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},series:[{name:"",type:"pie",radius:"50%",data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}},computed:Object(o["a"])(Object(o["a"])({},Object(s["mapGetters"])(["screen"])),{},{title:function(){return this.ispreview?"".concat(this.$t("当前报表连接"),":/myreport/").concat(this.id):""}}),watch:{lr_isCollapse:function(){var e=this;setTimeout((function(){e.$refs.main&&e.$refs.main.updateChart()}),100)},screen:function(){var e=this;setTimeout((function(){e.$refs.main&&e.$refs.main.updateChart()}),100)},$route:{handler:function(e){"myreport"==e.name&&e.params.routerPath&&this.init(e.params.routerPath)},immediate:!0}},methods:{init:function(e,t){var a=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.ready=!1,a.id=e,a.ispreview=!!t,r.next=5,a.$awaitWraper(n.getData(e));case 5:l=r.sent,l.id==a.id&&(a.data=l||{},"1"!=l.tempStyle&&"3"!=l.tempStyle||a.refreshTable(l.listData),a.ready=!0,"2"!=l.tempStyle&&"3"!=l.tempStyle||a.refreshChart(l.chartType,l.chartData));case 7:case"end":return r.stop()}}),r)})))()},refreshTable:function(e){e=e||[],this.tableData=e;var t=[];if(e.length>0)for(var a in e[0])t.push({prop:a,label:a,minWidth:120});this.columns=t},refreshChart:function(e,t){var a=this;null==this.timer&&(this.timer=setTimeout(Object(i["a"])(regeneratorRuntime.mark((function r(){var l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:r.t0=e,r.next="bar"===r.t0?3:"line"===r.t0?7:"pie"===r.t0?11:15;break;case 3:return r.next=5,a.getBarOption(t);case 5:return l=r.sent,r.abrupt("break",15);case 7:return r.next=9,a.getLineOption(t);case 9:return l=r.sent,r.abrupt("break",15);case 11:return r.next=13,a.getOption(t);case 13:return l=r.sent,r.abrupt("break",15);case 15:a.$refs.main.updateChart(l),a.timer=null;case 17:case"end":return r.stop()}}),r)}))),100))},getBarOption:function(e){e=e||[],this.barOption.xAxis={type:"category",data:[]},this.barOption.yAxis={type:"value"};var t=[],a=[];return e.forEach((function(e){t.push(e.name),a.push(e.value)})),this.barOption.series[0].data=a,this.barOption.xAxis.data=t,this.barOption},getLineOption:function(e){e=e||[],this.lineOption.xAxis={type:"category",data:[]},this.lineOption.yAxis={type:"value"};var t=[],a=[];return e.forEach((function(e){t.push(e.name),a.push(e.value)})),this.lineOption.series[0].data=a,this.lineOption.xAxis.data=t,this.lineOption},getOption:function(e){return this.pieOption.series[0].data=e||[],this.pieOption}}},u=c,m=(a("69c7"),a("2877")),f=Object(m["a"])(u,r,l,!1,null,null,null);t["default"]=f.exports},e7b4:function(e,t,a){"use strict";a("3d0d")}}]);