import{aS as cn,bD as Cs,L as xs,r as ot,U as Ps,K as As,R as Is,o as ut,m as Ca,c as Dt,w as _e,e as At,b as he,d as Ot,aC as nr,a as Ds,E as Os,aI as Ls,a_ as Rs,_ as xa,a6 as Ms,u as Pi,by as Ns,bs as Bs,bt as Fs,bz as Us,g as Hs}from"./index-C4BxmZrN.js";import{E as js,a as Vs}from"./col-DljvzS69.js";import{i as fn}from"./index-CkGVv88Q.js";import{i as zs}from"./index-DSHqkOzX.js";function yr(a,o){var i=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)}return i}function Se(a){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?yr(Object(i),!0).forEach(function(t){M(a,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):yr(Object(i)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(i,t))})}return a}function Re(a){"@babel/helpers - typeof";return Re=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Re(a)}function W(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function _r(a,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,Pa(t.key),t)}}function $(a,o,i){return o&&_r(a.prototype,o),i&&_r(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a}function M(a,o,i){return o=Pa(o),o in a?Object.defineProperty(a,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[o]=i,a}function X(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),o&&Vn(a,o)}function Q(a){return Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Q(a)}function Vn(a,o){return Vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Vn(a,o)}function Gs(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function I(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function rr(a,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return I(a)}function Z(a){var o=Gs();return function(){var t=Q(a),e;if(o){var n=Q(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return rr(this,e)}}function Ws(a,o){for(;!Object.prototype.hasOwnProperty.call(a,o)&&(a=Q(a),a!==null););return a}function ne(){return typeof Reflect<"u"&&Reflect.get?ne=Reflect.get.bind():ne=function(o,i,t){var e=Ws(o,i);if(e){var n=Object.getOwnPropertyDescriptor(e,i);return n.get?n.get.call(arguments.length<3?o:t):n.value}},ne.apply(this,arguments)}function it(a){return $s(a)||Ks(a)||Ys(a)||qs()}function $s(a){if(Array.isArray(a))return zn(a)}function Ks(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function Ys(a,o){if(a){if(typeof a=="string")return zn(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return zn(a,o)}}function zn(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,t=new Array(o);i<o;i++)t[i]=a[i];return t}function qs(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xs(a,o){if(typeof a!="object"||a===null)return a;var i=a[Symbol.toPrimitive];if(i!==void 0){var t=i.call(a,o);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}function Pa(a){var o=Xs(a,"string");return typeof o=="symbol"?o:String(o)}var Aa={exports:{}};(function(a){var o=Object.prototype.hasOwnProperty,i="~";function t(){}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(i=!1));function e(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function n(u,l,c,f,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var v=new e(c,f||u,d),h=i?i+l:l;return u._events[h]?u._events[h].fn?u._events[h]=[u._events[h],v]:u._events[h].push(v):(u._events[h]=v,u._eventsCount++),u}function r(u,l){--u._eventsCount===0?u._events=new t:delete u._events[l]}function s(){this._events=new t,this._eventsCount=0}s.prototype.eventNames=function(){var l=[],c,f;if(this._eventsCount===0)return l;for(f in c=this._events)o.call(c,f)&&l.push(i?f.slice(1):f);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},s.prototype.listeners=function(l){var c=i?i+l:l,f=this._events[c];if(!f)return[];if(f.fn)return[f.fn];for(var d=0,v=f.length,h=new Array(v);d<v;d++)h[d]=f[d].fn;return h},s.prototype.listenerCount=function(l){var c=i?i+l:l,f=this._events[c];return f?f.fn?1:f.length:0},s.prototype.emit=function(l,c,f,d,v,h){var p=i?i+l:l;if(!this._events[p])return!1;var g=this._events[p],y=arguments.length,m,b;if(g.fn){switch(g.once&&this.removeListener(l,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,f),!0;case 4:return g.fn.call(g.context,c,f,d),!0;case 5:return g.fn.call(g.context,c,f,d,v),!0;case 6:return g.fn.call(g.context,c,f,d,v,h),!0}for(b=1,m=new Array(y-1);b<y;b++)m[b-1]=arguments[b];g.fn.apply(g.context,m)}else{var k=g.length,w;for(b=0;b<k;b++)switch(g[b].once&&this.removeListener(l,g[b].fn,void 0,!0),y){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,c);break;case 3:g[b].fn.call(g[b].context,c,f);break;case 4:g[b].fn.call(g[b].context,c,f,d);break;default:if(!m)for(w=1,m=new Array(y-1);w<y;w++)m[w-1]=arguments[w];g[b].fn.apply(g[b].context,m)}}return!0},s.prototype.on=function(l,c,f){return n(this,l,c,f,!1)},s.prototype.once=function(l,c,f){return n(this,l,c,f,!0)},s.prototype.removeListener=function(l,c,f,d){var v=i?i+l:l;if(!this._events[v])return this;if(!c)return r(this,v),this;var h=this._events[v];if(h.fn)h.fn===c&&(!d||h.once)&&(!f||h.context===f)&&r(this,v);else{for(var p=0,g=[],y=h.length;p<y;p++)(h[p].fn!==c||d&&!h[p].once||f&&h[p].context!==f)&&g.push(h[p]);g.length?this._events[v]=g.length===1?g[0]:g:r(this,v)}return this},s.prototype.removeAllListeners=function(l){var c;return l?(c=i?i+l:l,this._events[c]&&r(this,c)):(this._events=new t,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=i,s.EventEmitter=s,a.exports=s})(Aa);var Ia=Aa.exports;const ci=cn(Ia);var Zs=typeof window<"u"&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,bn={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},Sn="%c[xgplayer]",le={config:{debug:Zs?3:0},logInfo:function(o){for(var i,t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];this.config.debug>=3&&(i=console).log.apply(i,[Sn,bn.info,o].concat(e))},logWarn:function(o){for(var i,t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];this.config.debug>=1&&(i=console).warn.apply(i,[Sn,bn.warn,o].concat(e))},logError:function(o){var i;if(!(this.config.debug<1)){for(var t=this.config.debug>=2?"trace":"error",e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];(i=console)[t].apply(i,[Sn,bn.error,o].concat(n))}}};function Js(a){a.logInfo=le.logInfo.bind(a),a.logWarn=le.logWarn.bind(a),a.logError=le.logError.bind(a)}var Qs=function(){function a(o){W(this,a),this.bufferedList=o}return $(a,[{key:"start",value:function(i){return this.bufferedList[i].start}},{key:"end",value:function(i){return this.bufferedList[i].end}},{key:"length",get:function(){return this.bufferedList.length}}]),a}(),_={};_.createDom=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"div",o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",e=document.createElement(a);return e.className=t,e.innerHTML=o,Object.keys(i).forEach(function(n){var r=n,s=i[n];a==="video"||a==="audio"||a==="live-video"?s&&e.setAttribute(r,s):e.setAttribute(r,s)}),e};_.createDomFromHtml=function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";try{var t=document.createElement("div");t.innerHTML=a;var e=t.children;return t=null,e.length>0?(e=e[0],i&&_.addClass(e,i),o&&Object.keys(o).forEach(function(n){e.setAttribute(n,o[n])}),e):null}catch(n){return le.logError("util.createDomFromHtml",n),null}};_.hasClass=function(a,o){if(!a||!o)return!1;try{return Array.prototype.some.call(a.classList,function(t){return t===o})}catch(t){var i=a.className&&Re(a.className)==="object"?a.getAttribute("class"):a.className;return i&&!!i.match(new RegExp("(\\s|^)"+o+"(\\s|$)"))}};_.addClass=function(a,o){if(!(!a||!o))try{o.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(i){i&&a.classList.add(i)})}catch(i){_.hasClass(a,o)||(a.className&&Re(a.className)==="object"?a.setAttribute("class",a.getAttribute("class")+" "+o):a.className+=" "+o)}};_.removeClass=function(a,o){if(!(!a||!o))try{o.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(i){i&&a.classList.remove(i)})}catch(i){_.hasClass(a,o)&&o.split(/\s+/g).forEach(function(t){var e=new RegExp("(\\s|^)"+t+"(\\s|$)");a.className&&Re(a.className)==="object"?a.setAttribute("class",a.getAttribute("class").replace(e," ")):a.className=a.className.replace(e," ")})}};_.toggleClass=function(a,o){a&&o.split(/\s+/g).forEach(function(i){_.hasClass(a,i)?_.removeClass(a,i):_.addClass(a,i)})};_.classNames=function(){for(var a=arguments,o=[],i=function(n){_.typeOf(a[n])==="String"?o.push(a[n]):_.typeOf(a[n])==="Object"&&Object.keys(a[n]).map(function(r){a[n][r]&&o.push(r)})},t=0;t<arguments.length;t++)i(t);return o.join(" ")};_.findDom=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document,o=arguments.length>1?arguments[1]:void 0,i;try{i=a.querySelector(o)}catch(t){le.logError("util.findDom",t),o.indexOf("#")===0&&(i=a.getElementById(o.slice(1)))}return i};_.getCss=function(a,o){return a.currentStyle?a.currentStyle[o]:document.defaultView.getComputedStyle(a,!1)[o]};_.padStart=function(a,o,i){for(var t=String(i),e=o>>0,n=Math.ceil(e/t.length),r=[],s=String(a);n--;)r.push(t);return r.join("").substring(0,e-s.length)+s};_.format=function(a){if(window.isNaN(a))return"";a=Math.round(a);var o=_.padStart(Math.floor(a/3600),2,0),i=_.padStart(Math.floor((a-o*3600)/60),2,0),t=_.padStart(Math.floor(a-o*3600-i*60),2,0);return(o==="00"?[i,t]:[o,i,t]).join(":")};_.event=function(a){if(a.touches){var o=a.touches[0]||a.changedTouches[0];a.clientX=o.clientX||0,a.clientY=o.clientY||0,a.offsetX=o.pageX-o.target.offsetLeft,a.offsetY=o.pageY-o.target.offsetTop}a._target=a.target||a.srcElement};_.typeOf=function(a){return Object.prototype.toString.call(a).match(/([^\s.*]+)(?=]$)/g)[0]};_.deepCopy=function(a,o){if(_.typeOf(o)==="Object"&&_.typeOf(a)==="Object")return Object.keys(o).forEach(function(i){_.typeOf(o[i])==="Object"&&!(o[i]instanceof Node)?a[i]===void 0||a[i]===void 0?a[i]=o[i]:_.deepCopy(a[i],o[i]):_.typeOf(o[i])==="Array"?a[i]=_.typeOf(a[i])==="Array"?a[i].concat(o[i]):o[i]:a[i]=o[i]}),a};_.deepMerge=function(a,o){return Object.keys(o).map(function(i){if(_.typeOf(o[i])==="Array"&&_.typeOf(a[i])==="Array"){if(_.typeOf(a[i])==="Array"){var t;(t=a[i]).push.apply(t,it(o[i]))}}else _.typeOf(a[i])===_.typeOf(o[i])&&a[i]!==null&&_.typeOf(a[i])==="Object"&&!(o[i]instanceof window.Node)?_.deepMerge(a[i],o[i]):o[i]!==null&&(a[i]=o[i])}),a};_.getBgImage=function(a){var o=(a.currentStyle||window.getComputedStyle(a,null)).backgroundImage;if(!o||o==="none")return"";var i=document.createElement("a");return i.href=o.replace(/url\("|"\)/g,""),i.href};_.copyDom=function(a){if(a&&a.nodeType===1){var o=document.createElement(a.tagName);return Array.prototype.forEach.call(a.attributes,function(i){o.setAttribute(i.name,i.value)}),a.innerHTML&&(o.innerHTML=a.innerHTML),o}else return""};_.setInterval=function(a,o,i,t){a._interval[o]||(a._interval[o]=window.setInterval(i.bind(a),t))};_.clearInterval=function(a,o){clearInterval(a._interval[o]),a._interval[o]=null};_.setTimeout=function(a,o,i){a._timers||(a._timers=[]);var t=setTimeout(function(){o(),_.clearTimeout(a,t)},i);return a._timers.push(t),t};_.clearTimeout=function(a,o){var i=a._timers;if(_.typeOf(i)==="Array"){for(var t=0;t<i.length;t++)if(i[t]===o){i.splice(t,1),clearTimeout(o);break}}else clearTimeout(o)};_.clearAllTimers=function(a){var o=a._timers;_.typeOf(o)==="Array"&&(o.map(function(i){clearTimeout(i)}),a._timerIds=[])};_.createImgBtn=function(a,o,i,t){var e=_.createDom("xg-".concat(a),"",{},"xgplayer-".concat(a,"-img"));if(e.style.backgroundImage='url("'.concat(o,'")'),i&&t){var n,r,s;["px","rem","em","pt","dp","vw","vh","vm","%"].every(function(u){return i.indexOf(u)>-1&&t.indexOf(u)>-1?(n=parseFloat(i.slice(0,i.indexOf(u)).trim()),r=parseFloat(t.slice(0,t.indexOf(u)).trim()),s=u,!1):!0}),e.style.width="".concat(n).concat(s),e.style.height="".concat(r).concat(s),e.style.backgroundSize="".concat(n).concat(s," ").concat(r).concat(s),a==="start"?e.style.margin="-".concat(r/2).concat(s," auto auto -").concat(n/2).concat(s):e.style.margin="auto 5px auto 5px"}return e};_.Hex2RGBA=function(a,o){var i=[];if(/^\#[0-9A-F]{3}$/i.test(a)){var t="#";a.replace(/[0-9A-F]/ig,function(e){t+=e+e}),a=t}return/^#[0-9A-F]{6}$/i.test(a)?(a.replace(/[0-9A-F]{2}/ig,function(e){i.push(parseInt(e,16))}),"rgba(".concat(i.join(","),", ").concat(o,")")):"rgba(255, 255, 255, 0.1)"};_.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement};_.checkIsFunction=function(a){return a&&typeof a=="function"};_.checkIsObject=function(a){return a!==null&&Re(a)==="object"};_.hide=function(a){a.style.display="none"};_.show=function(a,o){a.style.display=o||"block"};_.isUndefined=function(a){if(typeof a>"u"||a===null)return!0};_.isNotNull=function(a){return a!=null};_.setStyleFromCsstext=function(a,o){if(o)if(_.typeOf(o)==="String"){var i=o.replace(/\s+/g,"").split(";");i.map(function(t){if(t){var e=t.split(":");e.length>1&&(a.style[e[0]]=e[1])}})}else Object.keys(o).map(function(t){a.style[t]=o[t]})};function eo(a,o){for(var i=0,t=o.length;i<t;i++)if(a.indexOf(o[i])>-1)return!0;return!1}_.filterStyleFromText=function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],i=a.style.cssText;if(!i)return{};var t=i.replace(/\s+/g,"").split(";"),e={},n={};return t.map(function(r){if(r){var s=r.split(":");s.length>1&&(eo(s[0],o)?e[s[0]]=s[1]:n[s[0]]=s[1])}}),a.setAttribute("style",""),Object.keys(n).map(function(r){a.style[r]=n[r]}),e};_.getStyleFromCsstext=function(a){var o=a.style.cssText;if(!o)return{};var i=o.replace(/\s+/g,"").split(";"),t={};return i.map(function(e){if(e){var n=e.split(":");n.length>1&&(t[n[0]]=n[1])}}),t};_.preloadImg=function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(a){var t=new window.Image;t.onload=function(e){t=null,o&&o(e)},t.onerror=function(e){t=null,i&&i(e)},t.src=a}};_.stopPropagation=function(a){a&&a.stopPropagation()};_.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0};_.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0};_.checkTouchSupport=function(){return"ontouchstart"in window};_.getBuffered2=function(a){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,i=[],t=0;t<a.length;t++)i.push({start:a.start(t)<.5?0:a.start(t),end:a.end(t)});i.sort(function(u,l){var c=u.start-l.start;return c||l.end-u.end});var e=[];if(o)for(var n=0;n<i.length;n++){var r=e.length;if(r){var s=e[r-1].end;i[n].start-s<o?i[n].end>s&&(e[r-1].end=i[n].end):e.push(i[n])}else e.push(i[n])}else e=i;return new Qs(e)};_.getEventPos=function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return a.touches&&a.touches.length>0&&(a=a.touches[0]),{x:a.x/o,y:a.y/o,clientX:a.clientX/o,clientY:a.clientY/o,offsetX:a.offsetX/o,offsetY:a.offsetY/o,pageX:a.pageX/o,pageY:a.pageY/o}};_.requestAnimationFrame=function(a){var o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(o)return o(a)};_.getHostFromUrl=function(a){if(_.typeOf(a)!=="String")return"";var o=a.split("/"),i="";return o.length>3&&o[2]&&(i=o[2]),i};_.cancelAnimationFrame=function(a){var o=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;o&&o(a)};_.isMSE=function(a){return!a||!(a instanceof HTMLMediaElement)?!1:/^blob/.test(a.currentSrc)||/^blob/.test(a.src)};_.isBlob=function(a){return typeof a=="string"&&/^blob/.test(a)};_.generateSessionId=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=new Date().getTime();try{a=parseInt(a)}catch(t){a=0}o+=a,window.performance&&typeof window.performance.now=="function"&&(o+=parseInt(window.performance.now()));var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(t==="x"?e:e&3|8).toString(16)});return i};_.createEvent=function(a){var o;return typeof window.Event=="function"?o=new Event(a):(o=document.createEvent("Event"),o.initEvent(a,!0,!0)),o};_.adjustTimeByDuration=function(a,o,i){return!o||!a?a:a>o||i&&a<o?o:a};_.createPositionBar=function(a,o){var i=_.createDom("xg-bar","",{"data-index":-1},a);return o.appendChild(i),i};_.getTransformStyle=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{x:0,y:0,scale:1,rotate:0},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i={scale:"".concat(a.scale||1),translate:"".concat(a.x||0,"%, ").concat(a.y||0,"%"),rotate:"".concat(a.rotate||0,"deg")},t=Object.keys(i);return t.forEach(function(e){var n=new RegExp("".concat(e,"\\([^\\(]+\\)"),"g"),r="".concat(e,"(").concat(i[e],")");n.test(o)?(n.lastIndex=-1,o=o.replace(n,r)):o+="".concat(r," ")}),o};_.convertDeg=function(a){return Math.abs(a)<=1?a*360:a%360};_.getIndexByTime=function(a,o){var i=o.length,t=-1;if(i<1)return t;if(a<=o[0].end||i<2)t=0;else if(a>o[i-1].end)t=i-1;else for(var e=1;e<i;e++)if(a>o[e-1].end&&a<=o[e].end){t=e;break}return t};_.getOffsetCurrentTime=function(a,o){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,t=-1;if(i>=0&&i<o.length?t=i:t=_.getIndexByTime(a,o),t<0)return-1;var e=o.length,n=o[t],r=n.start,s=n.end,u=n.cTime,l=n.offset;return a<r?u:a>=r&&a<=s?a-l:a>s&&t>=e-1?s:-1};_.getCurrentTimeByOffset=function(a,o){var i=-1;if(!o||o.length<0)return a;for(var t=0;t<o.length;t++)if(a<=o[t].duration){i=t;break}if(i!==-1){var e=o[i].start;return i-1<0?e+a:e+(a-o[i-1].duration)}return a};function Da(a){var o=Re(a);return a!==null&&(o==="object"||o==="function")}function to(a,o,i){var t,e,n,r,s,u,l=0,c=!1,f=!1,d=!0,v=!o&&o!==0&&typeof window.requestAnimationFrame=="function";if(typeof a!="function")throw new TypeError("Expected a function");o=+o||0,Da(i)&&(c=!!i.leading,f="maxWait"in i,n=f?Math.max(+i.maxWait||0,o):n,d="trailing"in i?!!i.trailing:d);function h(D){var L=t,S=e;return t=e=void 0,l=D,r=a.apply(S,L),r}function p(D,L){return v?(window.cancelAnimationFrame(s),window.requestAnimationFrame(D)):setTimeout(D,L)}function g(D){if(v)return window.cancelAnimationFrame(D);clearTimeout(D)}function y(D){return l=D,s=p(k,o),c?h(D):r}function m(D){var L=D-u,S=D-l,E=o-L;return f?Math.min(E,n-S):E}function b(D){var L=D-u,S=D-l;return u===void 0||L>=o||L<0||f&&S>=n}function k(){var D=Date.now();if(b(D))return w(D);s=p(k,m(D))}function w(D){return s=void 0,d&&t?h(D):(t=e=void 0,r)}function C(){s!==void 0&&g(s),l=0,t=u=e=s=void 0}function x(){return s===void 0?r:w(Date.now())}function R(){return s!==void 0}function N(){for(var D=Date.now(),L=b(D),S=arguments.length,E=new Array(S),T=0;T<S;T++)E[T]=arguments[T];if(t=E,e=this,u=D,L){if(s===void 0)return y(u);if(f)return s=p(k,o),h(u)}return s===void 0&&(s=p(k,o)),r}return N.cancel=C,N.flush=x,N.pending=R,N}function io(a,o,i){var t=!0,e=!0;if(typeof a!="function")throw new TypeError("Expected a function");return Da(i)&&(t="leading"in i?!!i.leading:t,e="trailing"in i?!!i.trailing:e),to(a,o,{leading:t,trailing:e,maxWait:o})}function no(){var a=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return a==="zh-cn"&&(a="zh"),a}function ro(a,o,i){if(a){var t=a.getAttribute(i);return!!(t&&t===o&&(a.tagName==="VIDEO"||a.tagName==="AUDIO"))}}var br={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},ao=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],ae={get device(){var a=ae.os;return a.isPc?"pc":"mobile"},get browser(){if(typeof navigator>"u")return"";var a=navigator.userAgent.toLowerCase(),o={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(o).filter(function(i){return o[i].test(a)}))[0]},get os(){if(typeof navigator>"u")return{};var a=navigator.userAgent,o=/(?:Windows Phone)/.test(a),i=/(?:SymbianOS)/.test(a)||o,t=/(?:Android)/.test(a),e=/(?:Firefox)/.test(a),n=/(?:iPad|PlayBook)/.test(a)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,r=n||t&&!/(?:Mobile)/.test(a)||e&&/(?:Tablet)/.test(a),s=/(?:iPhone)/.test(a)&&!r,u=!s&&!t&&!i&&!r;return{isTablet:r,isPhone:s,isIpad:n,isIos:s||n,isAndroid:t,isPc:u,isSymbian:i,isWindowsPhone:o,isFireFox:e}},get osVersion(){if(typeof navigator>"u")return 0;var a=navigator.userAgent,o="";/(?:iPhone)|(?:iPad|PlayBook)/.test(a)?o=br.ios:o=br.android;var i=o?o.exec(a):[];if(i&&i.length>=3){var t=i[2].split(".");return t.length>0?parseInt(t[0]):0}return 0},get isWeixin(){if(typeof navigator>"u")return!1;var a=/(micromessenger)\/([\d.]+)/,o=a.exec(navigator.userAgent.toLocaleLowerCase());return!!o},isSupportMP4:function(){var o={isSupport:!1,mime:""};if(typeof document>"u")return o;if(this.supportResult)return this.supportResult;var i=document.createElement("video");return typeof i.canPlayType=="function"&&ao.map(function(t){i.canPlayType('video/mp4; codecs="'.concat(t,'"'))==="probably"&&(o.isSupport=!0,o.mime+="||".concat(t))}),this.supportResult=o,i=null,o},isMSESupport:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(typeof MediaSource>"u"||!MediaSource)return!1;try{return MediaSource.isTypeSupported(o)}catch(i){return this._logger.error(o,i),!1}},isHevcSupported:function(){return typeof MediaSource>"u"||!MediaSource.isTypeSupported?!1:MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"')},probeConfigSupported:function(o){var i={supported:!1,smooth:!1,powerEfficient:!1};if(!o||typeof navigator>"u")return Promise.resolve(i);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(o);var t=o.video||{},e=o.audio||{};try{var n=MediaSource.isTypeSupported(t.contentType),r=MediaSource.isTypeSupported(e.contentType);return Promise.resolve({supported:n&&r,smooth:!1,powerEfficient:!1})}catch(s){return Promise.resolve(i)}}},Gn="3.0.16",Sr={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},kr={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},gi=$(function a(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};W(this,a);var t=o&&o.i18n?o.i18n.ERROR_TYPES:null;if(o.media){var e=i.mediaError?i.mediaError:o.media.error||{},n=o.duration,r=o.currentTime,s=o.ended,u=o.src,l=o.currentSrc,c=o.media,f=c.readyState,d=c.networkState,v=i.errorCode||e.code;kr[v]&&(v=kr[v]);var h={playerVersion:Gn,currentTime:r,duration:n,ended:s,readyState:f,networkState:d,src:u||l,errorType:i.errorType,errorCode:v,message:i.errorMessage||e.message,mediaError:e,originError:i.originError?i.originError.stack:"",host:_.getHostFromUrl(u||l)};return i.ext&&Object.keys(i.ext).map(function(m){h[m]=i.ext[m]}),h}else if(arguments.length>1){for(var p={playerVersion:Gn,domain:document.domain},g=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],y=0;y<arguments.length;y++)p[g[y]]=arguments[y];return p.ex=t?(t[arguments[0]]||{}).msg:"",p}}),Be="play",ar="playing",Lt="ended",jt="pause",fi="error",ki="seeking",ct="seeked",Le="timeupdate",Ei="waiting",vt="canplay",so="canplaythrough",St="durationchange",Oa="volumechange",yt="loadeddata",oo="loadedmetadata",La="ratechange",Ra="progress",sr="loadstart",Vt="emptied",uo="stalled",lo="suspend",co="abort",fo="bufferedChange",or="focus",Ma="blur",ur="ready",Na="urlNull",Ft="autoplay_started",lr="autoplay_was_prevented",hn="complete",$i="replay",dn="destroy",wi="urlchange",Wn="download_speed_change",Ba="leaveplayer",Fa="enterplayer",Ua="loading",dt="fullscreen_change",Ki="cssFullscreen_change",Yi="mini_state_change",cr="definition_change",ho="before_definition_change",$n="after_definition_change",po="SEI_PARSED",vo="retry",_t="video_resize",Kn="pip_change",Ha="rotate",ja="screenShot",qi="playnext",Va="shortcut",za="xglog",Xi="user_action",pn="reset",Ga="source_error",Wa="source_success",$a="switch_subtitle",Ka=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","loadedmetadata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],Ya={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},qa="fps_stuck";const go=Object.freeze(Object.defineProperty({__proto__:null,ABORT:co,AFTER_DEFINITION_CHANGE:$n,AUTOPLAY_PREVENTED:lr,AUTOPLAY_STARTED:Ft,BEFORE_DEFINITION_CHANGE:ho,BUFFER_CHANGE:fo,CANPLAY:vt,CANPLAY_THROUGH:so,COMPLETE:hn,CSS_FULLSCREEN_CHANGE:Ki,DEFINITION_CHANGE:cr,DESTROY:dn,DOWNLOAD_SPEED_CHANGE:Wn,DURATION_CHANGE:St,EMPTIED:Vt,ENDED:Lt,ENTER_PLAYER:Fa,ERROR:fi,FPS_STUCK:qa,FULLSCREEN_CHANGE:dt,LEAVE_PLAYER:Ba,LOADED_DATA:yt,LOADED_METADATA:oo,LOADING:Ua,LOAD_START:sr,MINI_STATE_CHANGE:Yi,PAUSE:jt,PIP_CHANGE:Kn,PLAY:Be,PLAYER_BLUR:Ma,PLAYER_FOCUS:or,PLAYING:ar,PLAYNEXT:qi,PROGRESS:Ra,RATE_CHANGE:La,READY:ur,REPLAY:$i,RESET:pn,RETRY:vo,ROTATE:Ha,SCREEN_SHOT:ja,SEEKED:ct,SEEKING:ki,SEI_PARSED:po,SHORTCUT:Va,SOURCE_ERROR:Ga,SOURCE_SUCCESS:Wa,STALLED:uo,STATS_EVENTS:Ya,SUSPEND:lo,SWITCH_SUBTITLE:$a,TIME_UPDATE:Le,URL_CHANGE:wi,URL_NULL:Na,USER_ACTION:Xi,VIDEO_EVENTS:Ka,VIDEO_RESIZE:_t,VOLUME_CHANGE:Oa,WAITING:Ei,XGLOG:za},Symbol.toStringTag,{value:"Module"}));function kn(a,o){!this||!this.emit||(a==="error"?this.errorHandler(a,o.error):this.emit(a,o))}function mo(a,o){return function(i,t){var e={player:o,eventName:a,originalEvent:i,detail:i.detail||{},timeStamp:i.timeStamp,currentTime:o.currentTime,duration:o.duration,paused:o.paused,ended:o.ended,isInternalOp:!!o._internalOp[i.type],muted:o.muted,volume:o.volume,host:_.getHostFromUrl(o.currentSrc),vtype:o.vtype};if(o.removeInnerOP(i.type),a==="timeupdate"&&(o._currentTime=o.media&&o.media.currentTime),a==="ratechange"){var n=o.media?o.media.playbackRate:0;if(n&&o._rate===n)return;o._rate=o.media&&o.media.playbackRate}if(a==="durationchange"&&(o._duration=o.media.duration),a==="volumechange"&&(e.isMutedChange=o._lastMuted!==o.muted,o._lastMuted=o.muted),a==="error"&&(e.error=t||o.video.error),o.mediaEventMiddleware[a]){var r=kn.bind(o,a,e);try{o.mediaEventMiddleware[a].call(o,e,r)}catch(s){throw kn.call(o,a,e),s}}else kn.call(o,a,e)}}var yo=function(a){X(i,a);var o=Z(i);function i(t){var e;W(this,i),e=o.call(this,t),e._hasStart=!1,e._currentTime=0,e._duration=0,e._internalOp={},e._lastMuted=!1,e.vtype="MP4",e._rate=-1,e.mediaConfig=Object.assign({},{controls:!1,autoplay:t.autoplay,playsinline:t.playsinline,"x5-playsinline":t.playsinline,"webkit-playsinline":t.playsinline,"x5-video-player-fullscreen":t["x5-video-player-fullscreen"]||t.x5VideoPlayerFullscreen,"x5-video-orientation":t["x5-video-orientation"]||t.x5VideoOrientation,airplay:t.airplay,"webkit-airplay":t.airplay,tabindex:t.tabindex|0,mediaType:t.mediaType||"video","data-index":-1},t.videoConfig,t.videoAttributes);var n=t["x5-video-player-type"]||t.x5VideoPlayerType;return ae.isWeixin&&ae.os.isAndroid&&n&&(e.mediaConfig["x5-video-player-type"]=n,delete e.mediaConfig.playsinline,delete e.mediaConfig["webkit-playsinline"],delete e.mediaConfig["x5-playsinline"]),t.loop&&(e.mediaConfig.loop="loop"),t.autoplayMuted&&!Object.prototype.hasOwnProperty.call(e.mediaConfig,"muted")&&(e.mediaConfig.muted=!0),e.media=_.createDom(e.mediaConfig.mediaType,"",e.mediaConfig,""),t.defaultPlaybackRate&&(e.media.defaultPlaybackRate=e.media.playbackRate=t.defaultPlaybackRate),_.typeOf(t.volume)==="Number"&&(e.volume=t.volume),t.autoplayMuted&&(e.media.muted=!0,e._lastMuted=!0),t.autoplay&&(e.media.autoplay=!0),e._interval={},e.mediaEventMiddleware={},e.attachVideoEvents(),e}return $(i,[{key:"setEventsMiddleware",value:function(e){var n=this;Object.keys(e).map(function(r){n.mediaEventMiddleware[r]=e[r]})}},{key:"removeEventsMiddleware",value:function(e){var n=this;Object.keys(e).map(function(r){delete n.mediaEventMiddleware[r]})}},{key:"attachVideoEvents",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers||(this._evHandlers=Ka.map(function(r){var s="on".concat(r.charAt(0).toUpperCase()).concat(r.slice(1));return typeof e[s]=="function"&&e.on(r,e[s]),M({},r,mo(r,e))})),this._evHandlers.forEach(function(r){var s=Object.keys(r)[0];n.addEventListener(s,r[s],!1)})}},{key:"detachVideoEvents",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers.forEach(function(r){var s=Object.keys(r)[0];n.removeEventListener(s,r[s],!1)}),this._evHandlers.forEach(function(r){var s=Object.keys(r)[0],u="on".concat(s.charAt(0).toUpperCase()).concat(s.slice(1));typeof e[u]=="function"&&e.off(s,e[u])}),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,n){var r=this;e.removeAttribute("src"),e.load(),n.forEach(function(f,d){r.media.appendChild(_.createDom("source","",{src:"".concat(f.src),type:"".concat(f.type||""),"data-index":d+1}))});var s=e.children;if(s){this._videoSourceCount=s.length,this._videoSourceIndex=s.length,this._vLoadeddata=function(f){r.emit(Wa,{src:f.target.currentSrc,host:_.getHostFromUrl(f.target.currentSrc)})};for(var u=null,l=0;l<this._evHandlers.length;l++)if(Object.keys(this._evHandlers[l])[0]==="error"){u=this._evHandlers[l];break}!this._sourceError&&(this._sourceError=function(f){var d=parseInt(f.target.getAttribute("data-index"),10);if(r._videoSourceIndex--,r._videoSourceIndex===0||d>=r._videoSourceCount){var v={code:4,message:"sources_load_error"};u?u.error(f,v):r.errorHandler("error",v)}var h=Sr[4];r.emit(Ga,new gi(r,{errorType:h,errorCode:4,errorMessage:"sources_load_error",mediaError:{code:4,message:"sources_load_error"},src:f.target.src}))});for(var c=0;c<s.length;c++)s[c].addEventListener("error",this._sourceError);e.addEventListener("loadeddata",this._vLoadeddata)}}},{key:"_detachSourceEvents",value:function(e){var n=e.children;if(!(!n||n.length===0||!this._sourceError)){for(var r=0;r<n.length;r++)n[r].removeEventListener("error",this._sourceError);for(;n.length>0;)e.removeChild(n[0]);this._vLoadeddata&&e.removeEventListener("loadeddata",this._vLoadeddata)}}},{key:"errorHandler",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.media&&(this.media.error||n)){var r=this.media.error||n,s=r.code?Sr[r.code]:"other",u=r.message;this.media.currentSrc||(u="empty_src",r={code:6,message:u}),this.emit(e,new gi(this,{errorType:s,errorCode:r.code,errorMessage:r.message||"",mediaError:r}))}}},{key:"destroy",value:function(){this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null;for(var e in this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}},{key:"video",get:function(){return this.media},set:function(e){this.media=e}},{key:"play",value:function(){var e=this.media?this.media.play():null;return e}},{key:"pause",value:function(){this.media&&this.media.pause()}},{key:"load",value:function(){this.media&&this.media.load()}},{key:"canPlayType",value:function(e){return this.media?this.media.canPlayType(e):!1}},{key:"getBufferedRange",value:function(e){var n=[0,0];if(!this.media)return n;e||(e=this.media.buffered);var r=this.media.currentTime;if(e)for(var s=0,u=e.length;s<u&&(n[0]=e.start(s),n[1]=e.end(s),!(n[0]<=r&&r<=n[1]));s++);return n[0]-r<=0&&r-n[1]<=0?n:[0,0]}},{key:"autoplay",get:function(){return this.media?this.media.autoplay:!1},set:function(e){this.media&&(this.media.autoplay=e)}},{key:"buffered",get:function(){return this.media?this.media.buffered:null}},{key:"buffered2",get:function(){return this.media&&this.media.buffered?_.getBuffered2(this.media.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.media)return e;var n=this.media.buffered;if(!n||n.length===0)return e;for(var r=0;r<n.length;r++)if((n.start(r)<=this.currentTime||n.start(r)<.1)&&n.end(r)>=this.currentTime)return{start:n.start(r),end:n.end(r)};return e}},{key:"crossOrigin",get:function(){return this.media?this.media.crossOrigin:""},set:function(e){this.media&&(this.media.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.media?this.media.currentSrc:""},set:function(e){this.media&&(this.media.currentSrc=e)}},{key:"currentTime",get:function(){return this.media?this.media.currentTime!==void 0?this.media.currentTime:this._currentTime:0},set:function(e){this.media&&(this.media.currentTime=e)}},{key:"defaultMuted",get:function(){return this.media?this.media.defaultMuted:!1},set:function(e){this.media&&(this.media.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return this.media?this.media.ended:!1}},{key:"error",get:function(){return this.media.error}},{key:"errorNote",get:function(){var e=this.media.error;if(!e)return"";var n=["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"];return n[this.media.error.code-1]}},{key:"loop",get:function(){return this.media?this.media.loop:!1},set:function(e){this.media&&(this.media.loop=e)}},{key:"muted",get:function(){return this.media?this.media.muted:!1},set:function(e){!this.media||this.media.muted===e||(this._lastMuted=this.media.muted,this.media.muted=e)}},{key:"networkState",get:function(){return this.media.networkState}},{key:"paused",get:function(){return this.media?this.media.paused:!0}},{key:"playbackRate",get:function(){return this.media?this.media.playbackRate:0},set:function(e){!this.media||e===1/0||(this.media.defaultPlaybackRate=e,this.media.playbackRate=e)}},{key:"played",get:function(){return this.media?this.media.played:null}},{key:"preload",get:function(){return this.media?this.media.preload:!1},set:function(e){this.media&&(this.media.preload=e)}},{key:"readyState",get:function(){return this.media.readyState}},{key:"seekable",get:function(){return this.media?this.media.seekable:!1}},{key:"seeking",get:function(){return this.media?this.media.seeking:!1}},{key:"src",get:function(){return this.media?this.media.src:""},set:function(e){if(this.media){if(this.emit(wi,e),this.emit(Ei),this._currentTime=0,this._duration=0,_.isMSE(this.media)){this.onWaiting();return}this._detachSourceEvents(this.media),_.typeOf(e)==="Array"?this._attachSourceEvents(this.media,e):e?this.media.src=e:this.media.removeAttribute("src"),this.load()}}},{key:"volume",get:function(){return this.media?this.media.volume:0},set:function(e){e===1/0||!this.media||(this.media.volume=e)}},{key:"aspectRatio",get:function(){return this.media?this.media.videoWidth/this.media.videoHeight:0}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,n){for(var r,s=arguments.length,u=new Array(s>2?s-2:0),l=2;l<s;l++)u[l-2]=arguments[l];(r=ne(Q(i.prototype),"emit",this)).call.apply(r,[this,e,n].concat(u))}},{key:"on",value:function(e,n){for(var r,s=arguments.length,u=new Array(s>2?s-2:0),l=2;l<s;l++)u[l-2]=arguments[l];(r=ne(Q(i.prototype),"on",this)).call.apply(r,[this,e,n].concat(u))}},{key:"once",value:function(e,n){for(var r,s=arguments.length,u=new Array(s>2?s-2:0),l=2;l<s;l++)u[l-2]=arguments[l];(r=ne(Q(i.prototype),"once",this)).call.apply(r,[this,e,n].concat(u))}},{key:"off",value:function(e,n){for(var r,s=arguments.length,u=new Array(s>2?s-2:0),l=2;l<s;l++)u[l-2]=arguments[l];(r=ne(Q(i.prototype),"off",this)).call.apply(r,[this,e,n].concat(u))}},{key:"offAll",value:function(){ne(Q(i.prototype),"removeAllListeners",this).call(this)}}]),i}(ci),_o=function(){function a(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};W(this,a),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=o}return $(a,[{key:"openDB",value:function(i){var t=this,e=this,n=this.myDB.version||1,r=e.indexedDB.open(e.myDB.name,n);r.onerror=function(s){},r.onsuccess=function(s){t.myDB.db=s.target.result,i.call(e)},r.onupgradeneeded=function(s){var u=s.target.result;s.target.transaction,u.objectStoreNames.contains(e.myDB.ojstore.name)||u.createObjectStore(e.myDB.ojstore.name,{keyPath:e.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){var i=this;i.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(i,t){for(var e=this.myDB.db.transaction(i,"readwrite").objectStore(i),n,r=0;r<t.length;r++)n=e.add(t[r]),n.onerror=function(){},n.onsuccess=function(){}}},{key:"putData",value:function(i,t){for(var e=this.myDB.db.transaction(i,"readwrite").objectStore(i),n,r=0;r<t.length;r++)n=e.put(t[r]),n.onerror=function(){},n.onsuccess=function(){}}},{key:"getDataByKey",value:function(i,t,e){var n=this,r=this.myDB.db.transaction(i,"readwrite").objectStore(i),s=r.get(t);s.onerror=function(){e.call(n,null)},s.onsuccess=function(u){var l=u.target.result;e.call(n,l)}}},{key:"deleteData",value:function(i,t){var e=this.myDB.db.transaction(i,"readwrite").objectStore(i);e.delete(t)}},{key:"clearData",value:function(i){var t=this.myDB.db.transaction(i,"readwrite").objectStore(i);t.clear()}}]),a}(),Er=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],wr=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],Tr=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],Mt="data-xgplayerid";function Ai(a,o,i){for(var t=arguments.length,e=new Array(t>3?t-3:0),n=3;n<t;n++)e[n-3]=arguments[n];var r=o.call.apply(o,[a].concat(e));!i||typeof i!="function"||(r&&r.then?r.then(function(){for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];i.call.apply(i,[a].concat(u))}):i.call.apply(i,[a].concat(e)))}function Zi(a,o){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[a]&&(this.__hooks[a]=null),function(){var t=arguments,e=this;if(i.pre)try{var n;(n=i.pre).call.apply(n,[this].concat(Array.prototype.slice.call(arguments)))}catch(u){throw u.message="[pluginName: ".concat(this.pluginName,":").concat(a,":pre error] >> ").concat(u.message),u}if(this.__hooks&&this.__hooks[a])try{var r,s=(r=this.__hooks[a]).call.apply(r,[this,this].concat(Array.prototype.slice.call(arguments)));s?s.then?s.then(function(u){u!==!1&&Ai.apply(void 0,[e,o,i.next].concat(it(t)))}).catch(function(u){throw u}):Ai.apply(void 0,[this,o,i.next].concat(Array.prototype.slice.call(arguments))):s===void 0&&Ai.apply(void 0,[this,o,i.next].concat(Array.prototype.slice.call(arguments)))}catch(u){throw u.message="[pluginName: ".concat(this.pluginName,":").concat(a,"] >> ").concat(u.message),u}else Ai.apply(void 0,[this,o,i.next].concat(Array.prototype.slice.call(arguments)))}.bind(this)}function Ji(a,o){var i=this.__hooks;if(i)return i.hasOwnProperty(a)?(i&&(i[a]=o),!0):(console.warn("has no supported hook which name [".concat(a,"]")),!1)}function Qi(a,o){var i=this.__hooks;i&&delete i[a]}function Cr(a){if(!(!this.plugins||!this.plugins[a.toLowerCase()])){for(var o=this.plugins[a.toLowerCase()],i=arguments.length,t=new Array(i>1?i-1:0),e=1;e<i;e++)t[e-1]=arguments[e];return o.useHooks&&o.useHooks.apply(o,t)}}function xr(a){if(!(!this.plugins||!this.plugins[a.toLowerCase()])){var o=this.plugins[a.toLowerCase()];if(o){for(var i=arguments.length,t=new Array(i>1?i-1:0),e=1;e<i;e++)t[e-1]=arguments[e];return o.removeHooks&&o.removeHooks.apply(o,t)}}}function Xa(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];a.__hooks={},o&&o.map(function(i){a.__hooks[i]=null}),Object.defineProperty(a,"hooks",{get:function(){return a.__hooks&&Object.keys(a.__hooks).map(function(t){if(a.__hooks[t])return t})}})}function Za(a){a.__hooks=null}function pt(a,o,i){for(var t=arguments.length,e=new Array(t>3?t-3:0),n=3;n<t;n++)e[n-3]=arguments[n];if(a.__hooks&&a.__hooks[o]){var r,s=(r=a.__hooks[o]).call.apply(r,[a,a].concat(e));if(s&&s.then)s.then(function(u){return u===!1?null:i.call.apply(i,[a,a].concat(e))}).catch(function(u){console.warn("[runHooks]".concat(o," reject"),u.message)});else if(s!==!1)return i.call.apply(i,[a,a].concat(e))}else return i.call.apply(i,[a,a].concat(e))}function En(a,o){le.logError("[".concat(a,"] event or callback cant be undefined or null when call ").concat(o))}var nt=function(){function a(o){W(this,a),_.checkIsFunction(this.beforeCreate)&&this.beforeCreate(o),Xa(this),this.__args=o,this.__events={},this.__onceEvents={},this.config=o.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(o)}return $(a,[{key:"beforeCreate",value:function(i){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(i){this.player=i.player,this.playerConfig=i.player&&i.player.config,this.pluginName=i.pluginName?i.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=i.player&&i.player.logger}},{key:"updateLang",value:function(i){i||(i=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var i=_.checkTouchSupport()?"touch":"mouse";return this.playerConfig&&(this.playerConfig.domEventType==="touch"||this.playerConfig.domEventType==="mouse")&&(i=this.playerConfig.domEventType),i}},{key:"on",value:function(i,t){var e=this;if(!i||!t||!this.player){En(this.pluginName,"plugin.on(event, callback)");return}typeof i=="string"?(this.__events[i]=t,this.player.on(i,t)):Array.isArray(i)&&i.forEach(function(n){e.__events[n]=t,e.player.on(n,t)})}},{key:"once",value:function(i,t){var e=this;if(!i||!t||!this.player){En(this.pluginName,"plugin.once(event, callback)");return}typeof i=="string"?(this.__onceEvents[i]=t,this.player.once(i,t)):Array.isArray(i)&&i.forEach(function(n){e.__onceEvents[n]=t,e.player.once(i,t)})}},{key:"off",value:function(i,t){var e=this;if(!i||!t||!this.player){En(this.pluginName,"plugin.off(event, callback)");return}typeof i=="string"?(delete this.__events[i],this.player.off(i,t)):Array.isArray(i)&&i.forEach(function(n){delete e.__events[i],e.player.off(n,t)})}},{key:"offAll",value:function(){var i=this;["__events","__onceEvents"].forEach(function(t){Object.keys(i[t]).forEach(function(e){i[t][e]&&i.off(e,i[t][e]),e&&delete i[t][e]})}),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(i){var t;if(this.player){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];(t=this.player).emit.apply(t,[i].concat(n))}}},{key:"emitUserAction",value:function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.player){var n=Se(Se({},e),{},{pluginName:this.pluginName});this.player.emitUserAction(i,t,n)}}},{key:"hook",value:function(i,t){return Zi.call.apply(Zi,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(i,t){for(var e=arguments.length,n=new Array(e>2?e-2:0),r=2;r<e;r++)n[r-2]=arguments[r];return Ji.call.apply(Ji,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(i,t){for(var e=arguments.length,n=new Array(e>2?e-2:0),r=2;r<e;r++)n[r-2]=arguments[r];return Qi.call.apply(Qi,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(this.player)return e&&(t.pluginName=e),this.player.registerPlugin({plugin:i,options:t})}},{key:"getPlugin",value:function(i){return this.player?this.player.getPlugin(i):null}},{key:"__destroy",value:function(){var i=this,t=this.player,e=this.pluginName;this.offAll(),_.clearAllTimers(this),_.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map(function(n){i[n]=null}),t.unRegisterPlugin(e),Za(this)}}],[{key:"defineGetterOrSetter",value:function(i,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(i,e,t[e])}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),a}(),bo=9;if(typeof Element<"u"&&!Element.prototype.matches){var qt=Element.prototype;qt.matches=qt.matchesSelector||qt.mozMatchesSelector||qt.msMatchesSelector||qt.oMatchesSelector||qt.webkitMatchesSelector}function So(a,o){for(;a&&a.nodeType!==bo;){if(typeof a.matches=="function"&&a.matches(o))return a;a=a.parentNode}}var ko=So,Eo=ko;function wn(a,o,i,t,e){var n=To.apply(this,arguments);return a.addEventListener(i,n,e),{destroy:function(){a.removeEventListener(i,n,e)}}}function wo(a,o,i,t,e){return typeof a.addEventListener=="function"?wn.apply(null,arguments):typeof i=="function"?wn.bind(null,document).apply(null,arguments):(typeof a=="string"&&(a=document.querySelectorAll(a)),Array.prototype.map.call(a,function(n){return wn(n,o,i,t,e)}))}function To(a,o,i,t){return function(e){e.delegateTarget=Eo(e.target,o),e.delegateTarget&&t.call(a,e)}}var Co=wo;const Pr=cn(Co);var xo={CONTROLS:"controls",ROOT:"root"},pe={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"};function Tn(a){return a?a.indexOf&&/^(?:http|data:|\/)/.test(a):!1}function Po(a,o){return Re(a)==="object"&&a.class&&typeof a.class=="string"?"".concat(o," ").concat(a.class):o}function Ao(a,o){return Re(a)==="object"&&a.attr&&Re(a.attr)==="object"&&Object.keys(a.attr).map(function(i){o[i]=a.attr[i]}),o}function Ar(a,o){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",n=null;if(a instanceof window.Element)return _.addClass(a,i),Object.keys(t).map(function(r){a.setAttribute(r,t[r])}),a;if(Tn(a)||Tn(a.url))return t.src=Tn(a)?a:a.url||"",n=_.createDom(a.tag||"img","",t,"xg-img ".concat(i)),n;if(typeof a=="function")try{return n=a(),n instanceof window.Element?(_.addClass(n,i),Object.keys(t).map(function(r){n.setAttribute(r,t[r])}),n):(le.logWarn("warn>>icons.".concat(o," in config of plugin named [").concat(e,"] is a function mast return an Element Object")),null)}catch(r){return le.logError("Plugin named [".concat(e,"]:createIcon"),r),null}return typeof a=="string"?_.createDomFromHtml(a,t,i):(le.logWarn("warn>>icons.".concat(o," in config of plugin named [").concat(e,"] is invalid")),null)}function Io(a,o){var i=o.config.icons||o.playerConfig.icons;Object.keys(a).map(function(t){var e=a[t],n=e&&e.class?e.class:"",r=e&&e.attr?e.attr:{},s=null;i&&i[t]&&(n=Po(i[t],n),r=Ao(i[t],r),s=Ar(i[t],t,n,r,o.pluginName)),!s&&e&&(s=Ar(e.icon?e.icon:e,r,n,{},o.pluginName)),o.icons[t]=s})}function Do(a,o){Object.keys(a).map(function(i){Object.defineProperty(o.langText,i,{get:function(){var e=o.lang,n=o.i18n;return n[i]?n[i]:a[i]&&a[i][e]||""}})})}var ee=function(a){X(i,a);var o=Z(i);function i(){var t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return W(this,i),t=o.call(this,e),t.__delegates=[],t}return $(i,[{key:"__init",value:function(e){if(ne(Q(i.prototype),"__init",this).call(this,e),!!e.root){var n=e.root,r=null;this.icons={},this.root=null,this.parent=null;var s=this.registerIcons()||{};Io(s,this),this.langText={};var u=this.registerLanguageTexts()||{};Do(u,this);var l="";try{l=this.render()}catch(d){throw le.logError("Plugin:".concat(this.pluginName,":render"),d),new Error("Plugin:".concat(this.pluginName,":render:").concat(d.message))}if(l)r=i.insert(l,n,e.index),r.setAttribute("data-index",e.index);else if(e.tag)r=_.createDom(e.tag,"",e.attr,e.name),r.setAttribute("data-index",e.index),n.appendChild(r);else return;this.root=r,this.parent=n;var c=this.config.attr||{},f=this.config.style||{};this.setAttr(c),this.setStyle(f),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var n=this.children();n&&Re(n)==="object"&&Object.keys(n).length>0&&Object.keys(n).map(function(r){var s=r,u=n[s],l={root:e.root},c,f;typeof u=="function"?(c=e.config[s]||{},f=u):Re(u)==="object"&&typeof u.plugin=="function"&&(c=u.options?_.deepCopy(e.config[s]||{},u.options):e.config[s]||{},f=u.plugin),l.config=c,c.index!==void 0&&(l.index=c.index),c.root&&(l.root=c.root),e.registerPlugin(f,l,s)})}}},{key:"updateLang",value:function(e){e||(e=this.lang);function n(l,c){for(var f=0;f<l.children.length;f++)l.children[f].children.length>0?n(l.children[f],c):c(l.children[f])}var r=this.root,s=this.i18n,u=this.langText;r&&n(r,function(l){var c=l.getAttribute&&l.getAttribute("lang-key");if(c){var f=s[c.toUpperCase()]||u[c];f&&(l.innerHTML=typeof f=="function"?f(e):f)}})}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=this.i18n||{},s=this.langText;e.setAttribute&&e.setAttribute("lang-key",n);var u=r[n]||s[n]||"";u&&(e.innerHTML=u)}},{key:"plugins",value:function(){return this._children}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";n.root=n.root||this.root;var s=ne(Q(i.prototype),"registerPlugin",this).call(this,e,n,r);return this._children.push(s),s}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,n,r){var s=this;if(arguments.length<3&&typeof n=="function")Array.isArray(e)?e.forEach(function(l){s.bindEL(l,n)}):this.bindEL(e,n);else{var u=i.delegate.call(this,this.root,e,n,r);this.__delegates=this.__delegates.concat(u)}}},{key:"unbind",value:function(e,n){var r=this;if(arguments.length<3&&typeof n=="function")Array.isArray(e)?e.forEach(function(l){r.unbindEL(l,n)}):this.unbindEL(e,n);else for(var s="".concat(e,"_").concat(n),u=0;u<this.__delegates.length;u++)if(this.__delegates[u].key===s){this.__delegates[u].destroy(),this.__delegates.splice(u,1);break}}},{key:"setStyle",value:function(e,n){var r=this;if(this.root){if(_.typeOf(e)==="String")return this.root.style[e]=n;_.typeOf(e)==="Object"&&Object.keys(e).map(function(s){r.root.style[s]=e[s]})}}},{key:"setAttr",value:function(e,n){var r=this;if(this.root){if(_.typeOf(e)==="String")return this.root.setAttribute(e,n);_.typeOf(e)==="Object"&&Object.keys(e).map(function(s){r.root.setAttribute(s,e[s])})}}},{key:"setHtml",value:function(e,n){this.root&&(this.root.innerHTML=e,typeof n=="function"&&n())}},{key:"bindEL",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof n=="function"&&this.root.addEventListener(e,n,r)}},{key:"unbindEL",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof n=="function"&&this.root.removeEventListener(e,n,r)}},{key:"show",value:function(e){if(this.root){this.root.style.display=e!==void 0?e:"block";var n=window.getComputedStyle(this.root,null),r=n.getPropertyValue("display");r==="none"&&(this.root.style.display="block")}}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,n){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!n||!(n instanceof window.Element))return null;try{return typeof e=="string"?this.find(e).appendChild(n):e.appendChild(n)}catch(r){return le.logError("Plugin:appendChild",r),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,n=this.player;this.__delegates.map(function(r){r.destroy()}),this.__delegates=[],this._children instanceof Array&&(this._children.map(function(r){n.unRegisterPlugin(r.pluginName)}),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),ne(Q(i.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map(function(r){e[r]=null})}}],[{key:"insert",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=n.children.length,u=Number(r),l=e instanceof window.Node;if(s){for(var c=0,f=null,d="";c<s;c++){f=n.children[c];var v=Number(f.getAttribute("data-index"));if(v>=u){d="beforebegin";break}else v<u&&(d="afterend")}return l?d==="afterend"?n.appendChild(e):n.insertBefore(e,f):f.insertAdjacentHTML(d,e),d==="afterend"?n.children[n.children.length-1]:n.children[c]}else return l?n.appendChild(e):n.insertAdjacentHTML("beforeend",e),n.children[n.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,n,r,s){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,l=[];if(e instanceof window.Node&&typeof s=="function")if(Array.isArray(r))r.forEach(function(f){var d=Pr(e,n,f,s,u);d.key="".concat(n,"_").concat(f),l.push(d)});else{var c=Pr(e,n,r,s,u);c.key="".concat(n,"_").concat(r),l.push(c)}return l}},{key:"ROOT_TYPES",get:function(){return xo}},{key:"POSITIONS",get:function(){return pe}}]),i}(nt),Oo=function(){function a(){var o=this;if(W(this,a),M(this,"__trigger",function(i){var t=new Date().getTime();o.timeStamp=t;for(var e=0;e<i.length;e++)o.__runHandler(i[e].target)}),this.__handlers=[],this.timeStamp=0,this.observer=null,!!window.ResizeObserver)try{this.observer=new window.ResizeObserver(io(this.__trigger,100,{trailing:!0})),this.timeStamp=new Date().getTime()}catch(i){console.error(i)}}return $(a,[{key:"addObserver",value:function(i,t){if(this.observer){this.observer&&this.observer.observe(i);for(var e=i.getAttribute(Mt),n=this.__handlers,r=-1,s=0;s<n.length;s++)n[s]&&i===n[s].target&&(r=s);r>-1?this.__handlers[r].handler=t:this.__handlers.push({target:i,handler:t,playerId:e})}}},{key:"unObserver",value:function(i){var t=-1;this.__handlers.map(function(e,n){i===e.target&&(t=n)});try{this.observer&&this.observer.unobserve(i)}catch(e){}this.observer&&this.observer.unobserve(i),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(i){for(var t=this.__handlers,e=0;e<t.length;e++)if(t[e]&&i===t[e].target){try{t[e].handler(i)}catch(n){console.error(n)}return!0}return!1}}]),a}(),vi=null;function Lo(a,o){return vi||(vi=new Oo),vi.addObserver(a,o),vi}function Ro(a,o){vi.unObserver(a,o)}var Ae={pluginGroup:{},init:function(o){var i=o._pluginInfoId;i||(i=new Date().getTime(),o._pluginInfoId=i),!o.config.closeResizeObserver&&Lo(o.root,function(){o.resize()}),this.pluginGroup[i]={_originalOptions:o.config||{},_plugins:{}}},formatPluginInfo:function(o,i){var t=null,e=null;return o.plugin&&typeof o.plugin=="function"?(t=o.plugin,e=o.options):(t=o,e={}),i&&(e.config=i||{}),{PLUFGIN:t,options:e}},checkPluginIfExits:function(o,i){for(var t=0;t<i.length;t++)if(o.toLowerCase()===i[t].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function(o,i){for(var t=Object.keys(i),e=null,n=0;n<t.length;n++)if(o.toLowerCase()===t[n].toLowerCase()){e=i[t[n]];break}return _.typeOf(e)==="Object"?{root:e.root,position:e.position}:{}},lazyRegister:function(o,i){var t=this,e=i.timeout||1500;return Promise.race([i.loader().then(function(n){var r;n&&n.__esModule?r=n.default:r=n,t.register(o,r,n.options)}),new Promise(function(n,r){setTimeout(function(){r(new Error("timeout"))},e)})])},register:function(o,i){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(!o||!i||typeof i!="function"||i.prototype===void 0)){var e=o._pluginInfoId;if(!(!e||!this.pluginGroup[e])){this.pluginGroup[e]._plugins||(this.pluginGroup[e]._plugins={});var n=this.pluginGroup[e]._plugins,r=this.pluginGroup[e]._originalOptions;t.player=o;var s=t.pluginName||i.pluginName;if(!s)throw new Error("The property pluginName is necessary");if(i.isSupported&&!i.isSupported(o.config.mediaType,o.config.codecType)){console.warn("not supported plugin [".concat(s,"]"));return}t.config||(t.config={});for(var u=Object.keys(r),l=0;l<u.length;l++)if(s.toLowerCase()===u[l].toLowerCase()){var c=r[u[l]];_.typeOf(c)==="Object"?t.config=Object.assign({},t.config,r[u[l]]):_.typeOf(c)==="Boolean"&&(t.config.disable=!c);break}i.defaultConfig&&Object.keys(i.defaultConfig).forEach(function(d){typeof t.config[d]>"u"&&(t.config[d]=i.defaultConfig[d])}),t.root?typeof t.root=="string"&&(t.root=o[t.root]):t.root=o.root,t.index=t.config.index||0;try{n[s.toLowerCase()]&&(this.unRegister(e,s.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(s,"] exist, destroy the old instance")));var f=new i(t);return n[s.toLowerCase()]=f,n[s.toLowerCase()].func=i,f&&typeof f.afterCreate=="function"&&f.afterCreate(),f}catch(d){throw console.error(d),d}}}},unRegister:function(o,i){o._pluginInfoId&&(o=o._pluginInfoId),i=i.toLowerCase();try{var t=this.pluginGroup[o]._plugins[i];t&&(t.pluginName&&t.__destroy(),delete this.pluginGroup[o]._plugins[i])}catch(e){console.error("[unRegister:".concat(i,"] cgid:[").concat(o,"] error"),e)}},deletePlugin:function(o,i){var t=o._pluginInfoId;t&&this.pluginGroup[t]&&this.pluginGroup[t]._plugins&&delete this.pluginGroup[t]._plugins[i]},getPlugins:function(o){var i=o._pluginInfoId;return i&&this.pluginGroup[i]?this.pluginGroup[i]._plugins:{}},findPlugin:function(o,i){var t=o._pluginInfoId;if(!t||!this.pluginGroup[t])return null;var e=i.toLowerCase();return this.pluginGroup[t]._plugins[e]},beforeInit:function(o){var i=this;function t(e){return!e||!e.then?new Promise(function(n){n()}):e}return new Promise(function(e){if(i.pluginGroup){var n;return o._loadingPlugins&&o._loadingPlugins.length?n=Promise.all(o._loadingPlugins):n=Promise.resolve(),n.then(function(){var r=o._pluginInfoId;if(!i.pluginGroup[r]){e();return}var s=i.pluginGroup[r]._plugins,u=[];Object.keys(s).forEach(function(l){if(s[l]&&s[l].beforePlayerInit)try{var c=s[l].beforePlayerInit();u.push(t(c))}catch(f){throw u.push(t(null)),f}}),Promise.all([].concat(u)).then(function(){e()}).catch(function(l){console.error(l),e()})})}})},afterInit:function(o){var i=o._pluginInfoId;if(!(!i||!this.pluginGroup[i])){var t=this.pluginGroup[i]._plugins;Object.keys(t).forEach(function(e){t[e]&&t[e].afterPlayerInit&&t[e].afterPlayerInit()})}},setLang:function(o,i){var t=i._pluginInfoId;if(!(!t||!this.pluginGroup[t])){var e=this.pluginGroup[t]._plugins;Object.keys(e).forEach(function(n){if(e[n].updateLang)e[n].updateLang(o);else try{e[n].lang=o}catch(r){console.warn("".concat(n," setLang"))}})}},reRender:function(o){var i=this,t=o._pluginInfoId;if(!(!t||!this.pluginGroup[t])){var e=[],n=this.pluginGroup[t]._plugins;Object.keys(n).forEach(function(r){r!=="controls"&&n[r]&&(e.push({plugin:n[r].func,options:n[r].__args}),i.unRegister(t,r))}),e.forEach(function(r){i.register(o,r.plugin,r.options)})}},onPluginsReady:function(o){var i=o._pluginInfoId;if(!(!i||!this.pluginGroup[i])){var t=this.pluginGroup[i]._plugins||{};Object.keys(t).forEach(function(e){t[e].onPluginsReady&&typeof t[e].onPluginsReady=="function"&&t[e].onPluginsReady()})}},destroy:function(o){var i=o._pluginInfoId;if(this.pluginGroup[i]){Ro(o.root);for(var t=this.pluginGroup[i]._plugins,e=0,n=Object.keys(t);e<n.length;e++){var r=n[e];this.unRegister(i,r)}delete this.pluginGroup[i],delete o._pluginInfoId}}},H={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"};function Ir(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},preProcessUrl:null,ignores:[],whitelist:[],inactive:3e3,lang:no(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,minWaitDelay:200,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var Mo=function(o,i){var t,e,n;i.preset&&i.options?n=new i.preset(i.options,o.config):n=new i({},o.config);var r=n,s=r.plugins,u=s===void 0?[]:s,l=r.ignores,c=l===void 0?[]:l,f=r.icons,d=f===void 0?{}:f,v=r.i18n,h=v===void 0?[]:v;o.config.plugins||(o.config.plugins=[]),o.config.ignores||(o.config.ignores=[]),(t=o.config.plugins).push.apply(t,it(u)),(e=o.config.ignores).push.apply(e,it(c)),Object.keys(d).map(function(g){o.config.icons[g]||(o.config.icons[g]=d[g])});var p=o.config.i18n||[];h.push.apply(h,it(p)),o.config.i18n=h},No=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"onMouseEnter",function(s){var u=I(t),l=u.player,c=u.playerConfig;c.closeControlsBlur&&l.focus({autoHide:!1})}),M(I(t),"onMouseLeave",function(s){var u=I(t),l=u.player;l.focus()}),t}return $(i,[{key:"beforeCreate",value:function(e){!e.config.mode&&ae.device==="mobile"&&(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,n=this.config,r=n.disable,s=n.height,u=n.mode;if(!r){u==="flex"&&this.player.addClass(H.FLEX_CONTROLS);var l={height:"".concat(s,"px")};Object.keys(l).map(function(f){e.root.style[f]=l[f]}),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(Yi,function(f){f?_.addClass(e.root,"mini-controls"):_.removeClass(e.root,"mini-controls")});var c=this.playerConfig.isMobileSimulateMode;ae.device!=="mobile"&&c!=="mobile"&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&_.addClass(this.root,H.CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){_.removeClass(this.root,H.CONTROLS_AUTOHIDE)}},{key:"show",value:function(e){this.root.style.display="",this.player.focus()}},{key:"hide",value:function(){this.root.style.display="none"}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;if(this.root){var s=e.defaultConfig||{};if(!n.root){var u=n.position?n.position:n.config&&n.config.position?n.config.position:s.position;switch(u){case pe.CONTROLS_LEFT:n.root=this.left;break;case pe.CONTROLS_RIGHT:n.root=this.right;break;case pe.CONTROLS_CENTER:n.root=this.center;break;case pe.CONTROLS:n.root=this.root;break;default:n.root=this.left}return ne(Q(i.prototype),"registerPlugin",this).call(this,e,n,r)}}}},{key:"destroy",value:function(){ae.device!=="mobile"&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}},{key:"render",value:function(){var e=this.config,n=e.mode,r=e.autoHide,s=e.initShow,u=e.disable;if(!u){var l=_.classNames({"xgplayer-controls":!0},{"flex-controls":n==="flex"},{"bottom-controls":n==="bottom"},M({},H.CONTROLS_AUTOHIDE,r),{"xgplayer-controls-initshow":s||!r});return'<xg-controls class="'.concat(l,`" unselectable="on">
    <xg-inner-controls class="xg-inner-controls xg-pos">
      <xg-left-grid class="xg-left-grid">
      </xg-left-grid>
      <xg-center-grid class="xg-center-grid"></xg-center-grid>
      <xg-right-grid class="xg-right-grid">
      </xg-right-grid>
    </xg-inner-controls>
    </xg-controls>`)}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),i}(ee),Bo={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}},Ge={lang:{},langKeys:[],textKeys:[]};function mi(a,o){return Object.keys(o).forEach(function(i){var t=_.typeOf(o[i]),e=_.typeOf(a[i]);if(t==="Array"){var n;e!=="Array"&&(a[i]=[]),(n=a[i]).push.apply(n,it(o[i]))}else t==="Object"?(e!=="Object"&&(a[i]={}),mi(a[i],o[i])):a[i]=o[i]}),a}function Ja(){Object.keys(Ge.lang.en).map(function(a){Ge.textKeys[a]=a})}function Fo(a,o){var i=[];if(o||(o=Ge),!!o.lang){_.typeOf(a)!=="Array"?i=Object.keys(a).map(function(n){var r=n==="zh"?"zh-cn":n;return{LANG:r,TEXT:a[n]}}):i=a;var t=o,e=t.lang;i.map(function(n){n.LANG==="zh"&&(n.LANG="zh-cn"),e[n.LANG]?mi(e[n.LANG]||{},n.TEXT||{}):fr(n,o)}),Ja()}}function fr(a,o){var i=a.LANG;if(o||(o=Ge),!!o.lang){var t=a.TEXT||{};i==="zh"&&(i="zh-cn"),o.lang[i]?mi(o.lang[i],t):(o.langKeys.push(i),o.lang[i]=t),Ja()}}function Uo(a){var o,i={lang:{},langKeys:[],textKeys:{},pId:a};return mi(i.lang,Ge.lang),(o=i.langKeys).push.apply(o,it(Ge.langKeys)),mi(i.textKeys,Ge.textKeys),i}fr(Bo);var ri={get textKeys(){return Ge.textKeys},get langKeys(){return Ge.langKeys},get lang(){var a={};return Ge.langKeys.map(function(o){a[o]=Ge.lang[o]}),Ge.lang["zh-cn"]&&(a.zh=Ge.lang["zh-cn"]||{}),a},extend:Fo,use:fr,init:Uo},ce={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7,DESTROYED:8},Dr=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"],Ne={},Cn=null,Qa=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"add",value:function(e){e&&(Ne[e.playerId]=e,Object.keys(Ne).length===1&&this.setActive(e.playerId,!0))}},{key:"remove",value:function(e){e&&(e.isUserActive,delete Ne[e.playerId])}},{key:"_iterate",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(var r in Ne)if(Object.prototype.hasOwnProperty.call(Ne,r)){var s=Ne[r];if(n){if(e(s))break}else e(s)}}},{key:"forEach",value:function(e){this._iterate(e)}},{key:"find",value:function(e){var n=null;return this._iterate(function(r){var s=e(r);return s&&(n=r),s},!0),n}},{key:"findAll",value:function(e){var n=[];return this._iterate(function(r){e(r)&&n.push(r)}),n}},{key:"setActive",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(Ne[e])return n?this.forEach(function(r){e===r.playerId?(r.isUserActive=!0,r.isInstNext=!1):r.isUserActive=!1}):Ne[e].isUserActive=n,e}},{key:"getActiveId",value:function(){for(var e=Object.keys(Ne),n=0;n<e.length;n++){var r=Ne[e[n]];if(r&&r.isUserActive)return e[n]}return null}},{key:"setNext",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(Ne[e])return n?this.forEach(function(r){e===r.playerId?(r.isUserActive=!1,r.isInstNext=!0):r.isInstNext=!1}):Ne[e].isInstNext=n,e}}],[{key:"getInstance",value:function(){return Cn||(Cn=new i),Cn}}]),i}(Ia.EventEmitter);function Ho(a){for(var o=Object.keys(Ne),i=0;i<o.length;i++){var t=Ne[o[i]];if(t.root===a)return t}return null}var jo=["play","pause","replay","retry"],Or=0,Lr=0,Tt=null,vn=function(a){X(i,a);var o=Z(i);function i(t){var e;W(this,i);var n=_.deepMerge(Ir(),t);e=o.call(this,n),M(I(e),"canPlayFunc",function(){if(e.config){var h=e.config,p=h.autoplay,g=h.defaultPlaybackRate;le.logInfo("player","canPlayFunc, startTime",e.__startTime),e.__startTime>0&&e.duration>0&&(e.currentTime=e.__startTime>e.duration?e.duration:e.__startTime,e.__startTime=-1),e.playbackRate=g,(p||e._useAutoplay)&&e.mediaPlay(),e.off(vt,e.canPlayFunc),e.removeClass(H.ENTER)}}),M(I(e),"onFullscreenChange",function(h,p){var g=function(){_.setTimeout(I(e),function(){e.resize()},100)},y=_.getFullScreenEl();e._fullActionFrom?e._fullActionFrom="":e.emit(Xi,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:e.currentTime,duration:e.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});var m=ro(y,e.playerId,Mt);if(p||y&&(y===e._fullscreenEl||m))g(),!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!0,e.changeFullStyle(e.root,y,H.FULLSCREEN),e.emit(dt,!0,e._fullScreenOffset),e.cssfullscreen&&e.exitCssFullscreen();else if(e.fullscreen){g();var b=I(e),k=b._fullScreenOffset,w=b.config;w.needFullscreenScroll?(window.scrollTo(k.left,k.top),_.setTimeout(I(e),function(){e.fullscreen=!1,e._fullScreenOffset=null},100)):(!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!1,e._fullScreenOffset=null),e.cssfullscreen?e.removeClass(H.FULLSCREEN):e.recoverFullStyle(e.root,e._fullscreenEl,H.FULLSCREEN),e._fullscreenEl=null,e.emit(dt,!1)}}),M(I(e),"_onWebkitbeginfullscreen",function(h){e._fullscreenEl=e.media,e.onFullscreenChange(h,!0)}),M(I(e),"_onWebkitendfullscreen",function(h){e.onFullscreenChange(h,!1)}),Xa(I(e),jo),e.config=n,e._pluginInfoId=_.generateSessionId(),Js(I(e));var r=e.constructor.defaultPreset;if(e.config.presets.length){var s=e.config.presets.indexOf("default");s>=0&&r&&(e.config.presets[s]=r)}else r&&e.config.presets.push(r);e.userTimer=null,e.waitTimer=null,e.handleSource=!0,e._state=ce.INITIAL,e.isError=!1,e._hasStart=!1,e.isSeeking=!1,e.isCanplay=!1,e._useAutoplay=!1,e.__startTime=-1,e.rotateDeg=0,e.isActive=!1,e.fullscreen=!1,e.cssfullscreen=!1,e.isRotateFullscreen=!1,e._fullscreenEl=null,e.timeSegments=[],e._cssfullscreenEl=null,e.curDefinition=null,e._orgCss="",e._fullScreenOffset=null,e._videoHeight=0,e._videoWidth=0,e.videoPos={pi:1,scale:0,rotate:-1,x:0,y:0,h:-1,w:-1,vy:0,vx:0},e.sizeInfo={width:0,height:0,left:0,top:0},e._accPlayed={t:0,acc:0,loopAcc:0},e._offsetInfo={currentTime:-1,duration:0},e.innerContainer=null,e.controls=null,e.topBar=null,e.root=null,e.__i18n=ri.init(e._pluginInfoId),ae.os.isAndroid&&ae.osVersion>0&&ae.osVersion<6&&(e.config.autoplay=!1),e.database=new _o,e.isUserActive=!1,e._onceSeekCanplay=null,e._isPauseBeforeSeek=0,e.innerStates={isActiveLocked:!1},e.instManager=Tt;var u=e._initDOM();if(!u)return console.error(new Error("can't find the dom which id is ".concat(e.config.id," or this.config.el does not exist"))),rr(e);var l=e.config,c=l.definition,f=c===void 0?{}:c,d=l.url;if(!d&&f.list&&f.list.length>0){var v=f.list.find(function(h){return h.definition&&h.definition===f.defaultDefinition});v||(f.defaultDefinition=f.list[0].definition,v=f.list[0]),e.config.url=v.url,e.curDefinition=v}return e._bindEvents(),e._registerPresets(),e._registerPlugins(),Ae.onPluginsReady(I(e)),e.getInitDefinition(),e.setState(ce.READY),_.setTimeout(I(e),function(){e.emit(ur)},0),e.onReady&&e.onReady(),(e.config.videoInit||e.config.autoplay)&&(!e.hasStart||e.state<ce.ATTACHED)&&e.start(),e}return $(i,[{key:"_initDOM",value:function(){var e,n=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var r=this.config.el;if(r&&r.nodeType===1)this.root=r;else return this.emit(fi,new gi("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1}var s=Ho(this.root);s&&(le.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),s.destroy()),this.root.setAttribute(Mt,this.playerId),(e=Tt)===null||e===void 0||e.add(this),Ae.init(this),this._initBaseDoms();var u=this.constructor.XgVideoProxy;if(u&&this.mediaConfig.mediaType===u.mediaType){var l=this.innerContainer||this.root;this.detachVideoEvents(this.media);var c=new u(l,this.config,this.mediaConfig);this.attachVideoEvents(c),this.media=c}if(this.media.setAttribute(Mt,this.playerId),this.config.controls){var f=this.config.controls.root||null,d=Ae.register(this,No,{root:f});this.controls=d}var v=this.config.isMobileSimulateMode==="mobile"?"mobile":ae.device;if(this.addClass("".concat(H.DEFAULT," ").concat(H.INACTIVE," xgplayer-").concat(v," ").concat(this.config.controls?"":H.NO_CONTROLS)),this.config.autoplay?this.addClass(H.ENTER):this.addClass(H.NO_START),this.config.fluid){var h=this.config,p=h.width,g=h.height;(typeof p!="number"||typeof g!="number")&&(p=600,g=337.5);var y={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(g*100/p,"%")};Object.keys(y).forEach(function(x){n.root.style[x]=y[x]})}else["width","height"].forEach(function(x){n.config[x]&&(typeof n.config[x]!="number"?n.root.style[x]=n.config[x]:n.root.style[x]="".concat(n.config[x],"px"))});var m=this.root.getBoundingClientRect(),b=m.width,k=m.height,w=m.left,C=m.top;return this.sizeInfo.width=b,this.sizeInfo.height=k,this.sizeInfo.left=w,this.sizeInfo.top=C,!0}},{key:"_initBaseDoms",value:function(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=_.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach(function(n){e.on(n,e["on"+n.charAt(0).toUpperCase()+n.slice(1)])}),Er.forEach(function(n){document&&document.addEventListener(n,e.onFullscreenChange)}),ae.os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(yt,this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.media.focus()},this.once(Be,this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),Er.forEach(function(n){document.removeEventListener(n,e.onFullscreenChange)}),this.playFunc&&this.off(Be,this.playFunc),this.off(vt,this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_startInit",value:function(e){var n=this;if(this.media&&!((!e||e===""||_.typeOf(e)==="Array"&&e.length===0)&&(e="",this.emit(Na),le.logWarn("config.url is null, please get url and run player._startInit(url)"),this.config.nullUrlStart))){this.handleSource&&(this._detachSourceEvents(this.media),_.typeOf(e)==="Array"&&e.length>0?this._attachSourceEvents(this.media,e):!this.media.src||this.media.src!==e?this.media.src=e:e||this.media.removeAttribute("src")),_.typeOf(this.config.volume)==="Number"&&(this.volume=this.config.volume);var r=this.innerContainer?this.innerContainer:this.root;this.media instanceof window.Element&&!r.contains(this.media)&&r.insertBefore(this.media,r.firstChild);var s=this.media.readyState;le.logInfo("_startInit readyState",s),this.config.autoplay&&(!_.isMSE(this.media)&&this.load(),(ae.os.isIpad||ae.os.isPhone)&&this.mediaPlay());var u=this.config.startTime;this.__startTime=u>0?u:-1,this.config.startTime=0,s>=2&&this.duration>0?this.canPlayFunc():this.on(vt,this.canPlayFunc),(!this.hasStart||this.state<ce.ATTACHED)&&Ae.afterInit(this),this.hasStart=!0,this.setState(ce.ATTACHED),_.setTimeout(this,function(){n.emit(hn)},0)}}},{key:"_registerPlugins",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._loadingPlugins=[];var r=this.config.ignores||[],s=this.config.plugins||[],u=this.config.i18n||[];n&&ri.extend(u,this.__i18n);var l=r.join("||").toLowerCase().split("||"),c=this.plugins;s.forEach(function(f){try{var d=f.plugin?f.plugin.pluginName:f.pluginName;if(d&&l.indexOf(d.toLowerCase())>-1)return null;if(!n&&c[d.toLowerCase()])return;if(f.lazy&&f.loader){var v=Ae.lazyRegister(e,f);f.forceBeforeInit&&(v.then(function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(v),1)}).catch(function(h){le.logError("_registerPlugins:loadingPlugin",h),e._loadingPlugins.splice(e._loadingPlugins.indexOf(v),1)}),e._loadingPlugins.push(v));return}return e.registerPlugin(f)}catch(h){le.logError("_registerPlugins:",h)}})}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach(function(n){Mo(e,n)})}},{key:"_getRootByPosition",value:function(e){var n=null;switch(e){case pe.ROOT_RIGHT:this.rightBar||(this.rightBar=_.createPositionBar("xg-right-bar",this.root)),n=this.rightBar;break;case pe.ROOT_LEFT:this.leftBar||(this.leftBar=_.createPositionBar("xg-left-bar",this.root)),n=this.leftBar;break;case pe.ROOT_TOP:this.topBar||(this.topBar=_.createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&_.addClass(this.topBar,H.TOP_BAR_AUTOHIDE)),n=this.topBar;break;default:n=this.innerContainer||this.root;break}return n}},{key:"registerPlugin",value:function(e,n){var r=Ae.formatPluginInfo(e,n),s=r.PLUFGIN,u=r.options,l=this.config.plugins,c=Ae.checkPluginIfExits(s.pluginName,l);!c&&l.push(s);var f=Ae.getRootByConfig(s.pluginName,this.config);f.root&&(u.root=f.root),f.position&&(u.position=f.position);var d=u.position?u.position:u.config&&u.config.position||s.defaultConfig&&s.defaultConfig.position;return!u.root&&typeof d=="string"&&d.indexOf("controls")>-1?this.controls&&this.controls.registerPlugin(s,u,s.pluginName):(u.root||(u.root=this._getRootByPosition(d)),Ae.register(this,s,u))}},{key:"deregister",value:function(e){typeof e=="string"?Ae.unRegister(this,e):e instanceof nt&&Ae.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.deregister(e),n&&this.removePluginFromConfig(e)}},{key:"removePluginFromConfig",value:function(e){var n;if(typeof e=="string"?n=e:e instanceof nt&&(n=e.pluginName),!!n)for(var r=this.config.plugins.length-1;r>-1;r--){var s=this.config.plugins[r];if(s.pluginName.toLowerCase()===n.toLowerCase()){this.config.plugins.splice(r,1);break}}}},{key:"plugins",get:function(){return Ae.getPlugins(this)}},{key:"getPlugin",value:function(e){var n=Ae.findPlugin(this,e);return n&&n.pluginName?n:null}},{key:"addClass",value:function(e){this.root&&(_.hasClass(this.root,e)||_.addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&_.removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return _.hasClass(this.root,e)}},{key:"setAttribute",value:function(e,n){this.root&&this.root.setAttribute(e,n)}},{key:"removeAttribute",value:function(e,n){this.root&&this.root.removeAttribute(e,n)}},{key:"start",value:function(e){var n=this;if(!(this.state>ce.ATTACHING))return!e&&!this.config.url&&this.getInitDefinition(),this.hasStart=!0,this.setState(ce.ATTACHING),this._registerPlugins(!1),Ae.beforeInit(this).then(function(){if(n.config){e||(e=n.url||n.config.url);var r=n._preProcessUrl(e),s=n._startInit(r.url);return s}}).catch(function(r){throw r.fileName="player",r.lineNumber="236",le.logError("start:beforeInit:",r),r})}},{key:"switchURL",value:function(e,n){var r=this,s=e;_.typeOf(e)==="Object"&&(s=e.url),s=this._preProcessUrl(s).url;var u=this.currentTime;this.__startTime=u;var l=this.paused&&!this.isError;return this.src=s,new Promise(function(c,f){var d=function(p){r.off("timeupdate",v),r.off("canplay",v),f(p)},v=function(){r.duration>0&&r.__startTime>0&&(r.currentTime=r.__startTime,r.__startTime=-1),l&&r.pause(),r.off("error",d),c(!0)};if(r.once("error",d),!s){r.errorHandler("error",{code:6,message:"empty_src"});return}ae.os.isAndroid?r.once("timeupdate",v):r.once("canplay",v),r.play()})}},{key:"videoPlay",value:function(){this.mediaPlay()}},{key:"mediaPlay",value:function(){var e=this;if(!this.hasStart&&this.state<ce.ATTACHED){this.removeClass(H.NO_START),this.addClass(H.ENTER),this.start(),this._useAutoplay=!0;return}this.state<ce.RUNNING&&(this.removeClass(H.NO_START),!this.isCanplay&&this.addClass(H.ENTER));var n=ne(Q(i.prototype),"play",this).call(this);return n!==void 0&&n&&n.then?n.then(function(){e.removeClass(H.NOT_ALLOW_AUTOPLAY),e.addClass(H.PLAYING),e.state<ce.RUNNING&&(le.logInfo(">>>>playPromise.then"),e.setState(ce.RUNNING),e.emit(Ft))}).catch(function(r){if(le.logWarn(">>>>playPromise.catch",r.name),e.media&&e.media.error){e.onError(),e.removeClass(H.ENTER);return}r.name==="NotAllowedError"&&(e._errorTimer=_.setTimeout(e,function(){e._errorTimer=null,e.emit(lr),e.addClass(H.NOT_ALLOW_AUTOPLAY),e.removeClass(H.ENTER),e.pause(),e.setState(ce.NOTALLOW)},0))}):(le.logWarn("video.play not return promise"),this.state<ce.RUNNING&&(this.setState(ce.RUNNING),this.removeClass(H.NOT_ALLOW_AUTOPLAY),this.removeClass(H.NO_START),this.removeClass(H.ENTER),this.addClass(H.PLAYING),this.emit(Ft))),n}},{key:"mediaPause",value:function(){ne(Q(i.prototype),"pause",this).call(this)}},{key:"videoPause",value:function(){ne(Q(i.prototype),"pause",this).call(this)}},{key:"play",value:function(){var e=this;return this.removeClass(H.PAUSED),pt(this,"play",function(){return e.mediaPlay()})}},{key:"pause",value:function(){var e=this;pt(this,"pause",function(){ne(Q(i.prototype),"pause",e).call(e)})}},{key:"seek",value:function(e,n){var r=this;if(!(!this.media||Number.isNaN(Number(e))||!this.hasStart)){var s=this.config,u=s.isSeekedPlay,l=s.seekedStatus,c=n||(u?"play":l);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off(ct,this._onceSeekCanplay),this._onceSeekCanplay=function(){switch(r.removeClass(H.ENTER),r.isSeeking=!1,c){case"play":r.play();break;case"pause":r.pause();break;default:r._isPauseBeforeSeek>1||r.paused?r.pause():r.play()}r._isPauseBeforeSeek=0,r._onceSeekCanplay=null},this.once(ct,this._onceSeekCanplay),this.state<ce.RUNNING?(this.removeClass(H.NO_START),this.currentTime=e,this.play()):this.currentTime=e}}},{key:"getInitDefinition",value:function(){var e=this,n=this.config,r=n.definition,s=n.url;!s&&r&&r.list&&r.list.length>0&&r.defaultDefinition&&r.list.map(function(u){u.definition===r.defaultDefinition&&(e.config.url=u.url,e.curDefinition=u)})}},{key:"changeDefinition",value:function(e,n){var r=this,s=this.config.definition;if(Array.isArray(s==null?void 0:s.list)&&s.list.forEach(function(l){(e==null?void 0:e.definition)===l.definition&&(r.curDefinition=l)}),e!=null&&e.bitrate&&typeof e.bitrate!="number"&&(e.bitrate=parseInt(e.bitrate,10)||0),this.emit(cr,{from:n,to:e}),!this.hasStart){this.config.url=e.url;return}var u=this.switchURL(e.url,Se({seamless:s.seamless!==!1&&typeof MediaSource<"u"&&typeof MediaSource.isTypeSupported=="function"},e));u&&u.then?u.then(function(){r.emit($n,{from:n,to:e})}):this.emit($n,{from:n,to:e})}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(yt,this.reloadFunc)}},{key:"resetState",value:function(){var e=this,n=H.NOT_ALLOW_AUTOPLAY,r=H.PLAYING,s=H.NO_START,u=H.PAUSED,l=H.REPLAY,c=H.ENTER,f=H.ENDED,d=H.ERROR,v=H.LOADING,h=[n,r,s,u,l,c,f,d,v];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,h.forEach(function(p){e.removeClass(p)}),this.addClass(H.NO_START),this.emit(pn)}},{key:"reset",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0;this.resetState();var s=this.plugins;if(s&&(n.map(function(l){e.deregister(l)}),r)){var u=Ir();Object.keys(this.config).keys(function(l){e.config[l]!=="undefined"&&(l==="plugins"||l==="presets"||l==="el"||l==="id")&&(e.config[l]=u[l])})}}},{key:"destroy",value:function(){var e,n=this,r=this.innerContainer,s=this.root,u=this.media;if(!(!s||!u)){if(this.hasStart=!1,this._useAutoplay=!1,s.removeAttribute(Mt),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),_.clearAllTimers(this),this.emit(dn),(e=Tt)===null||e===void 0||e.remove(this),Ae.destroy(this),Za(this),ne(Q(i.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),r)for(var l=r.children,c=0;c<l.length;c++)r.removeChild(l[c]);!r&&u instanceof window.Node&&s.contains(u)&&s.removeChild(u),["topBar","leftBar","rightBar","innerContainer"].map(function(d){n[d]&&s.removeChild(n[d]),n[d]=null});var f=s.className.split(" ");f.length>0?s.className=f.filter(function(d){return d.indexOf("xgplayer")<0}).join(" "):s.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach(function(d){n[d]=!1})}}},{key:"replay",value:function(){var e=this;this.removeClass(H.ENDED),this.currentTime=0,this.isSeeking=!1,pt(this,"replay",function(){e.once(ct,function(){var n=e.mediaPlay();n&&n.catch&&n.catch(function(r){console.log(r)})}),e.emit($i),e.onPlay()})}},{key:"retry",value:function(){var e=this;this.removeClass(H.ERROR),this.addClass(H.LOADING),pt(this,"retry",function(){var n=e.currentTime,r=e.config.url,s=_.isMSE(e.media)?{url:r}:e._preProcessUrl(r);e.src=s.url,!e.config.isLive&&(e.currentTime=n),e.once(vt,function(){e.mediaPlay()})})}},{key:"changeFullStyle",value:function(e,n,r,s){e&&(s||(s=H.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=_.filterStyleFromText(e)),_.addClass(e,r),n&&n!==e&&!this._orgPCss&&(this._orgPCss=_.filterStyleFromText(n),_.addClass(n,s),n.setAttribute(Mt,this.playerId)))}},{key:"recoverFullStyle",value:function(e,n,r,s){s||(s=H.PARENT_FULLSCREEN),this._orgCss&&(_.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),_.removeClass(e,r),n&&n!==e&&this._orgPCss&&(_.setStyleFromCsstext(n,this._orgPCss),this._orgPCss="",_.removeClass(n,s),n.removeAttribute(Mt))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget,n=this.root,r=this.media;e||(e=n),this._fullScreenOffset={top:_.scrollTop(),left:_.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";var s=_.getFullScreenEl();if(s===this._fullscreenEl)return this.onFullscreenChange(),Promise.resolve();try{for(var u=0;u<wr.length;u++){var l=wr[u];if(e[l]){var c=l==="webkitRequestFullscreen"?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[l]();return c&&c.then?c:Promise.resolve()}}return r.fullscreenEnabled||r.webkitSupportsFullscreen?(r.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch(f){return Promise.reject(new Error("call getFullscreen fail"))}}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),!(!this._fullscreenEl&&!_.getFullScreenEl())){this.root;var n=this.media;this._fullActionFrom="exit";try{for(var r=0;r<Tr.length;r++){var s=Tr[r];if(document[s]){var u=document[s]();return u&&u.then?u:Promise.resolve()}}return n&&n.webkitSupportsFullscreen?(n.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch(l){return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var n=e?"".concat(H.INNER_FULLSCREEN," ").concat(H.CSS_FULLSCREEN):H.CSS_FULLSCREEN;this.changeFullStyle(this.root,e,n);var r=this.config.fullscreen,s=r===void 0?{}:r,u=s.useCssFullscreen===!0||typeof s.useCssFullscreen=="function"&&s.useCssFullscreen();u&&(this.fullscreen=!0,this.emit(dt,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(Ki,!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(H.INNER_FULLSCREEN," ").concat(H.CSS_FULLSCREEN):H.CSS_FULLSCREEN;if(!this.fullscreen)this.recoverFullStyle(this.root,this._cssfullscreenEl,e);else{var n=this.config.fullscreen,r=n===void 0?{}:n,s=r.useCssFullscreen===!0||typeof r.useCssFullscreen=="function"&&r.useCssFullscreen();s?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(dt,!1)):this.removeClass(e)}this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(Ki,!1)}},{key:"getRotateFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.cssfullscreen&&this.exitCssFullscreen(e);var n=e?"".concat(H.INNER_FULLSCREEN," ").concat(H.ROTATE_FULLSCREEN):H.ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,n,H.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this._rootStyle=this.root.getAttribute("style"),this.root.style.width="".concat(window.innerHeight,"px"),this.emit(dt,!0)}},{key:"exitRotateFullscreen",value:function(e){var n=this._fullscreenEl!==this.root?"".concat(H.INNER_FULLSCREEN," ").concat(H.ROTATE_FULLSCREEN):H.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,n,H.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(dt,!1),this._rootStyle&&(this.root.style.style=this._rootStyle,this._rootStyle=!1)}},{key:"setRotateDeg",value:function(e){window.orientation===90||window.orientation===-90?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};if(this.isActive){this.onFocus(e);return}this.emit(or,Se({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{ignorePaused:!1};if(!this.isActive){this.onBlur(e);return}this.emit(Ma,Se({paused:this.paused,ended:this.ended},e))}},{key:"onFocus",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!0,delay:3e3},r=this.innerStates;if(this.isActive=!0,this.removeClass(H.INACTIVE),this.userTimer&&(_.clearTimeout(this,this.userTimer),this.userTimer=null),n.isLock!==void 0&&(r.isActiveLocked=n.isLock),n.autoHide===!1||n.isLock===!0||r.isActiveLocked){this.userTimer&&(_.clearTimeout(this,this.userTimer),this.userTimer=null);return}var s=n&&n.delay?n.delay:this.config.inactive;this.userTimer=_.setTimeout(this,function(){e.userTimer=null,e.blur()},s)}},{key:"onBlur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.ignorePaused,r=n===void 0?!1:n;if(!(!this.isActive||this.innerStates.isActiveLocked)){var s=this.config.closePauseVideoFocus;this.isActive=!1,(r||s||!this.paused&&!this.ended)&&this.addClass(H.INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.removeClass(H.ENTER),this.removeClass(H.ERROR),this.removeClass(H.LOADING),this.isCanplay=!0,this.waitTimer&&_.clearTimeout(this,this.waitTimer)}},{key:"onDurationchange",value:function(){this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime,this.__startTime=-1)}},{key:"onLoadeddata",value:function(){this.isError=!1,this.isSeeking=!1}},{key:"onLoadstart",value:function(){this.removeClass(H.ERROR),this.isCanplay=!1}},{key:"onPlay",value:function(){this.state===ce.ENDED&&this.setState(ce.RUNNING),this.removeClass(H.PAUSED),this.ended&&this.removeClass(H.ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(H.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this.userTimer&&(_.clearTimeout(this,this.userTimer),this.userTimer=null),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(H.ENDED),this.setState(ce.ENDED)}},{key:"onError",value:function(){this.isError=!0,this.updateAcc("error"),this.removeClass(H.NOT_ALLOW_AUTOPLAY),this.removeClass(H.NO_START),this.removeClass(H.ENTER),this.removeClass(H.LOADING),this.addClass(H.ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(H.SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&_.clearTimeout(this,this.waitTimer),this.removeClass(H.LOADING),this.removeClass(H.SEEKING)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&_.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=_.setTimeout(this,function(){e.addClass(H.LOADING),e.emit(Ua),_.clearTimeout(e,e.waitTimer),e.waitTimer=null},this.config.minWaitDelay)}},{key:"onPlaying",value:function(){var e=this;this.isError=!1;var n=H.NO_START,r=H.PAUSED,s=H.ENDED,u=H.ERROR,l=H.REPLAY,c=H.LOADING,f=[n,r,s,u,l,c];f.forEach(function(d){e.removeClass(d)}),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.media.videoHeight&&this.resize(),(this.waitTimer||this.hasClass(H.LOADING))&&this.media.readyState>2&&(this.removeClass(H.LOADING),_.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state<ce.RUNNING&&this.duration&&(this.setState(ce.RUNNING),this.emit(Ft)),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onVolumechange",value:function(){_.typeOf(this.config.volume)==="Number"&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,n,r){if(!(!this.media||!n||!e)){var s=_.typeOf(e)==="String"?e:e.type||"";r.props&&_.typeOf(r.props)!=="Array"&&(r.props=[r.props]),this.emit(Xi,Se({eventType:s,action:n,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},r))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var n=new Date().getTime()-this._accPlayed.t;this._accPlayed.acc+=n,this._accPlayed.t=0,(e==="ended"||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var n=this.media.buffered;if(!n||n.length===0||!this.duration)return!0;for(var r=e||this.media.currentTime||.2,s=n.length,u=0;u<s;u++)if(n.start(u)<=r&&n.end(u)>r)return!0;return!1}},{key:"resizePosition",value:function(){var e=this.videoPos,n=e.vy,r=e.vx,s=e.h,u=e.w,l=this.videoPos.rotate;if(!(l<0&&s<0&&u<0)){var c=this.videoPos._pi;if(!c&&this.media.videoHeight&&(c=this.media.videoWidth/this.media.videoHeight*100),!!c){this.videoPos.pi=c,l=l<0?0:l;var f={rotate:l},d=0,v=0,h=1,p=Math.abs(l/90),g=this.root,y=this.innerContainer,m=g.offsetWidth,b=y?y.offsetHeight:g.offsetHeight,k=b,w=m;if(p%2===0)h=s>0?100/s:u>0?100/u:1,f.scale=h,d=n>0?(100-s)/2-n:0,f.y=p===2?0-d:d,v=r>0?(100-u)/2-r:0,f.x=p===2?0-v:v,this.media.style.width="".concat(w,"px"),this.media.style.height="".concat(k,"px");else if(p%2===1){w=b,k=m;var C=b-m;v=-C/2/w*100,f.x=p===3?v+n/2:v-n/2,d=C/2/k*100,f.y=p===3?d+r/2:d-r/2,f.scale=h,this.media.style.width="".concat(w,"px"),this.media.style.height="".concat(k,"px")}var x=_.getTransformStyle(f,this.media.style.transform||this.media.style.webkitTransform);this.media.style.transform=x,this.media.style.webkitTransform=x}}}},{key:"position",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{h:0,y:0,x:0,w:0};if(!(!this.media||!e||!e.h)){var n=this.videoPos;n.h=e.h*100||0,n.w=e.w*100||0,n.vx=e.x*100||0,n.vy=e.y*100||0,this.resizePosition()}}},{key:"setConfig",value:function(e){var n=this;e&&Object.keys(e).map(function(r){if(r!=="plugins"){n.config[r]=e[r];var s=n.plugins[r.toLowerCase()];s&&_.typeOf(s.setConfig)==="Function"&&s.setConfig(e[r])}})}},{key:"playNext",value:function(e){var n=this;this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,pt(this,"playnext",function(){n.start(),n.emit(qi,e)})}},{key:"resize",value:function(){var e=this;if(this.media){var n=this.root.getBoundingClientRect();this.sizeInfo.width=n.width,this.sizeInfo.height=n.height,this.sizeInfo.left=n.left,this.sizeInfo.top=n.top;var r=this.media,s=r.videoWidth,u=r.videoHeight,l=this.config,c=l.fitVideoSize,f=l.videoFillMode;if((f==="fill"||f==="cover"||f==="contain")&&this.setAttribute("data-xgfill",f),!(!u||!s)){this._videoHeight=u,this._videoWidth=s;var d=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,v=n.width,h=n.height-d,p=parseInt(s/u*1e3,10),g=parseInt(v/h*1e3,10),y=v,m=h,b={};c==="auto"&&g>p||c==="fixWidth"?(m=v/p*1e3,this.config.fluid?b.paddingTop="".concat(m*100/y,"%"):b.height="".concat(m+d,"px")):(c==="auto"&&g<p||c==="fixHeight")&&(y=p*h/1e3,b.width="".concat(y,"px")),!this.fullscreen&&!this.cssfullscreen&&Object.keys(b).forEach(function(w){e.root.style[w]=b[w]}),(f==="fillHeight"&&g<p||f==="fillWidth"&&g>p)&&this.setAttribute("data-xgfill","cover");var k={videoScale:p,vWidth:y,vHeight:m,cWidth:y,cHeight:m+d};this.resizePosition(),this.emit(_t,k)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(this.media.updateObjectPosition){this.media.updateObjectPosition(e,n);return}this.media.style.objectPosition="".concat(e*100,"% ").concat(n*100,"%")}},{key:"setState",value:function(e){le.logInfo("setState","state from:".concat(Dr[this.state]," to:").concat(Dr[e])),this._state=e}},{key:"_preProcessUrl",value:function(e,n){var r=this.config.preProcessUrl;return!_.isBlob(e)&&typeof r=="function"?r(e,n):{url:e}}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){typeof e=="boolean"&&(this._hasStart=e,e===!1&&this.setState(ce.READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===ce.RUNNING||this._state===ce.ENDED},set:function(e){e?this.setState(ce.RUNNING):this._state>=ce.RUNNING&&this.setState(ce.ATTACHED)}},{key:"definitionList",get:function(){return!this.config||!this.config.definition?[]:this.config.definition.list||[]},set:function(e){var n=this,r=this.config.definition,s=null,u=null;r.list=e,this.emit("resourceReady",e),e.forEach(function(l){var c;((c=n.curDefinition)===null||c===void 0?void 0:c.definition)===l.definition&&(s=l),r.defaultDefinition===l.definition&&(u=l)}),!u&&e.length>0&&(u=e[0]),s?this.changeDefinition(s):u&&this.changeDefinition(u)}},{key:"videoFrameInfo",get:function(){var e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return e;var n=this.media.getVideoPlaybackQuality();return e.dropped=n.droppedVideoFrames||0,e.total=n.totalVideoFrames||0,e.corrupted=n.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}},{key:"lang",get:function(){return this.config.lang},set:function(e){var n=ri.langKeys.filter(function(r){return r===e});if(n.length===0&&e!=="zh"){console.error("Sorry, set lang fail, because the language [".concat(e,"] is not supported now, list of all supported languages is [").concat(ri.langKeys.join(),"] "));return}this.config.lang=e,Ae.setLang(e,this)}},{key:"i18n",get:function(){var e=this.config.lang;return e==="zh"&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return Gn}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){return ne(Q(i.prototype),"readyState",this)}},{key:"error",get:function(){var e=ne(Q(i.prototype),"error",this);return this.i18n[e]||e}},{key:"networkState",get:function(){return ne(Q(i.prototype),"networkState",this)}},{key:"fullscreenChanging",get:function(){return this._fullScreenOffset!==null}},{key:"cumulateTime",get:function(){var e=this._accPlayed,n=e.acc,r=e.t;return r?new Date().getTime()-r+n:n}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"videoRotateDeg",get:function(){return this.videoPos.rotate},set:function(e){e=_.convertDeg(e),!(e%90!==0||e===this.videoPos.rotate)&&(this.videoPos.rotate=e,this.resizePosition())}},{key:"avgSpeed",get:function(){return Lr},set:function(e){Lr=e}},{key:"realTimeSpeed",get:function(){return Or},set:function(e){Or=e}},{key:"offsetCurrentTime",get:function(){return this._offsetInfo.currentTime||0},set:function(e){this._offsetInfo.currentTime=e}},{key:"offsetDuration",get:function(){return this._offsetInfo.duration||0},set:function(e){this._offsetInfo.duration=e||0}},{key:"hook",value:function(e,n){return Zi.call.apply(Zi,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,n){return Ji.call.apply(Ji,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,n){return Qi.call.apply(Qi,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,n,r){for(var s=arguments.length,u=new Array(s>3?s-3:0),l=3;l<s;l++)u[l-3]=arguments[l];return Cr.call.apply(Cr,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(e,n,r){for(var s=arguments.length,u=new Array(s>3?s-3:0),l=3;l<s;l++)u[l-3]=arguments[l];return xr.call.apply(xr,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,n){var r;typeof n=="boolean"&&n!==this.muted&&(this.addInnerOP("volumechange"),_.typeOf(n)===Boolean&&(this.muted=n)),(r=Tt)===null||r===void 0||r.setActive(this.playerId,e)}}],[{key:"debugger",get:function(){return le.config.debug},set:function(e){le.config.debug=e}},{key:"instManager",get:function(){return Tt},set:function(e){Tt=e}},{key:"getCurrentUserActivePlayerId",value:function(){var e;return(e=Tt)===null||e===void 0?void 0:e.getActiveId()}},{key:"setCurrentUserActive",value:function(e,n){var r;(r=Tt)===null||r===void 0||r.setActive(e,n)}},{key:"isHevcSupported",value:function(){return ae.isHevcSupported()}},{key:"probeConfigSupported",value:function(e){return ae.probeConfigSupported(e)}},{key:"install",value:function(e,n){i.plugins||(i.plugins={}),i.plugins[e]||(i.plugins[e]=n)}},{key:"use",value:function(e,n){i.plugins||(i.plugins={}),i.plugins[e]=n}}]),i}(yo);M(vn,"defaultPreset",null);M(vn,"XgVideoProxy",null);vn.instManager=Qa.getInstance();function De(){return new Date().getTime()}var Ct={LOAD_START:"loadstart",LOADED_DATA:"loadeddata",FIRST_FRAME:"firstFrame",WAIT_START:"waitingStart",WAIT_END:"waitingEnd",SEEK_START:"seekStart",SEEK_END:"seekEnd"},Vo=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"_onTimeupdate",function(){t._state.isTimeUpdate=!0,t._state.autoplayStart&&(le.logInfo("[xgLogger]".concat(t.player.playerId," _onTimeupdate")),t._sendFF("onTimeupdate"))}),M(I(t),"_onAutoplayStart",function(){le.logInfo("[xgLogger]".concat(t.player.playerId," _onAutoplayStart")),t._state.autoplayStart=!0,t.vt&&t._sendFF("onAutoplayStart")}),M(I(t),"_onReset",function(){t._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1,isFFSend:!1,isLs:!1},t.vt=0,t.pt=0,t.fvt=0,t.newPointTime=De(),t.loadedCostTime=0,t.startCostTime=0,t._isSeeking=!1,t.seekingStart=0,t.waitingStart=0,t.fixedWaitingStart=0,t._isWaiting=!1,t._waitTimer&&_.clearTimeout(I(t),t._waitTimer),t._waittTimer&&_.clearTimeout(I(t),t._waittTimer),t._waitTimer=null,t._waittTimer=null,t._waitType=0}),M(I(t),"_onSeeking",function(){t.seekingStart||(t.suspendWaitingStatus("seek"),t.seekingStart=De(),t.emitLog(Ct.SEEK_START,{start:De()}))}),M(I(t),"_onSeeked",function(){t.suspendSeekingStatus("seeked")}),M(I(t),"_onWaitingLoadStart",function(){t._isWaiting||t.vt||(t._isWaiting=!0,t.waitingStart=De(),t.fixedWaitingStart=De(),t._waitType=1,t.emitLog(Ct.WAIT_START,{fixedStart:t.fixedWaitingStart,start:t.waitingStart,type:1,endType:"loadstart"}))}),M(I(t),"_onWaiting",function(){t._isWaiting||!t.vt||(t._isWaiting=!0,t.vt?t.seekingStart?t._waitType=2:t._waitType=0:t._waitType=1,t.fixedWaitingStart=De(),t._waitTimer=_.setTimeout(I(t),function(){t._isWaiting&&(t.waitingStart=De(),_.clearTimeout(I(t),t._waitTimer),t._waitTimer=null,t._startWaitTimeout(),t.emitLog(Ct.WAIT_START,{fixedStart:t.fixedWaitingStart,start:t.waitingStart,type:t._waitType,endType:t._waitType===2?"seek":"playing"}))},200))}),M(I(t),"_onError",function(){t.suspendSeekingStatus("error"),t.suspendWaitingStatus("error")}),M(I(t),"_onPlaying",function(){t._isWaiting&&t.suspendWaitingStatus("playing")}),t}return $(i,[{key:"afterCreate",value:function(){var e=this;this._onReset(),this._waitType="firstFrame",this._initOnceEvents(),this.newPointTime=De(),this.loadedCostTime=0,this.startCostTime=0,this.on(sr,function(){var n=e._state,r=n.autoplayStart,s=n.isFFSend;e.startCostTime=De()-e.newPointTime,le.logInfo("[xgLogger]".concat(e.player.playerId," LOAD_START"),"autoplayStart:".concat(r," isFFSend:").concat(s," startCostTime:").concat(e.startCostTime," newPointTime").concat(e.newPointTime)),!s&&(!n.isLs&&e.emitLog(Ct.LOAD_START,{}),n.isLs=!0,n.isTimeUpdate=!1,n.isFFLoading=!0,e.pt=De(),e.vt=0,e.fvt=0,e._initOnceEvents(),e._onWaitingLoadStart())}),this.on(yt,function(){e.vt=De(),e.fvt=e.vt-e.pt,e.loadedCostTime=e.vt-e.newPointTime;var n=e._state,r=n.isTimeUpdate,s=n.isFFSend,u=n.autoplayStart;le.logInfo("[xgLogger]".concat(e.player.playerId," LOADED_DATA"),"fvt:".concat(e.fvt," isTimeUpdate:").concat(e._state.isTimeUpdate," loadedCostTime:").concat(e.loadedCostTime)),(r||u)&&e._sendFF("loadedData"),s||e.emitLog(Ct.LOADED_DATA,{}),e.suspendWaitingStatus("loadeddata")}),this.on(ki,this._onSeeking),this.on(ct,this._onSeeked),this.on(dn,function(){e.endState("destroy")}),this.on(wi,function(){e.endState("urlChange"),le.logInfo("[xgLogger]".concat(e.player.playerId," URL_CHANGE")),e._state.isFFSend&&e._onReset()}),this.on([ar,vt],this._onPlaying),this.on(Ei,this._onWaiting),this.on(fi,this._onError),this.on(pn,function(){le.logInfo("[xgLogger]".concat(e.player.playerId," RESET")),e.endState("reset"),e._initOnceEvents(),e._onReset()})}},{key:"_initOnceEvents",value:function(){this.off(Ft,this._onAutoplayStart),this.off(Le,this._onTimeupdate),this.once(Ft,this._onAutoplayStart),this.once(Le,this._onTimeupdate)}},{key:"_sendFF",value:function(e){this.s=De();var n=this._state,r=n.isFFLoading,s=n.isFFSend;le.logInfo("[xgLogger]".concat(this.player.playerId," _sendFF"),"".concat(e," fvt:").concat(this.fvt," isFFLoading:").concat(r," !isFFSend:").concat(!s)),this.vt>0&&r&&!s&&(le.logInfo("[xgLogger]".concat(this.player.playerId," emitLog_firstFrame"),e),this._state.isFFLoading=!1,this._state.isFFSend=!0,this.emitLog(Ct.FIRST_FRAME,{fvt:this.fvt,costTime:this.fvt,vt:this.vt,startCostTime:this.startCostTime,loadedCostTime:this.loadedCostTime}))}},{key:"_startWaitTimeout",value:function(){var e=this;this._waittTimer&&_.clearTimeout(this,this._waittTimer),this._waittTimer=_.setTimeout(this,function(){e.suspendWaitingStatus("timeout"),_.clearTimeout(e,e._waittTimer),e._waittTimer=null},this.config.waitTimeout)}},{key:"endState",value:function(e){this.suspendWaitingStatus(e),this.suspendSeekingStatus(e)}},{key:"suspendSeekingStatus",value:function(e){if(this.seekingStart){var n=De(),r=n-this.seekingStart;this.seekingStart=0,this.emitLog(Ct.SEEK_END,{end:n,costTime:r,endType:e})}}},{key:"suspendWaitingStatus",value:function(e){if(this._waitTimer&&(_.clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(_.clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,!!this.waitingStart){var n=De(),r=n-this.waitingStart,s=n-this.fixedWaitingStart,u=this.config.waitTimeout;this._isWaiting=!1,this.waitingStart=0,this.fixedWaitingStart=0,this.emitLog(Ct.WAIT_END,{fixedCostTime:s>u?u:s,costTime:r>u?u:r,type:e==="loadeddata"?1:this._waitType,endType:this._waitType===2?"seek":e})}}},{key:"emitLog",value:function(e,n){var r=this.player;this.emit(za,Se({t:De(),host:_.getHostFromUrl(r.currentSrc),vtype:r.vtype,eventType:e,currentTime:this.player.currentTime,readyState:r.video.readyState,networkState:r.video.networkState},n))}}],[{key:"pluginName",get:function(){return"xgLogger"}},{key:"defaultConfig",get:function(){return{waitTimeout:1e4}}}]),i}(ee);function zo(){return new DOMParser().parseFromString(`<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">
  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>
</svg>
`,"image/svg+xml").firstChild}var Go=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"registerIcons",value:function(){return{replay:zo}}},{key:"afterCreate",value:function(){var e=this;ee.insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",function(){e.player.replay()},{pre:function(r){r.preventDefault(),r.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(Lt,function(){if(e.playerConfig.loop||_.addClass(e.player.root,"replay"),!e.config.disable){e.show();var n=e.root.querySelector("path");if(n){var r=window.getComputedStyle(n).getPropertyValue("transform");if(typeof r=="string"&&r.indexOf("none")>-1)return null;n.setAttribute("transform",r)}}}),this.on(Be,function(){e.hide()})}},{key:"handleReplay",value:function(e){e.preventDefault(),e.stopPropagation(),this.player.replay(),_.removeClass(this.player.root,"replay")}},{key:"show",value:function(e){this.config.disable||(this.root.style.display="flex")}},{key:"enable",value:function(){this.config.disable=!1}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}},{key:"render",value:function(){return`<xg-replay class="xgplayer-replay">
      <xg-replay-txt class="xgplayer-replay-txt" lang-key="`.concat(this.i18nKeys.REPLAY,'">').concat(this.i18n.REPLAY,`</xg-replay-txt>
    </xg-replay>`)}}],[{key:"pluginName",get:function(){return"replay"}},{key:"defaultConfig",get:function(){return{disable:!1}}}]),i}(ee),Wo=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"isEndedShow",get:function(){return this.config.isEndedShow},set:function(e){this.config.isEndedShow=e}},{key:"hide",value:function(){_.addClass(this.root,"hide")}},{key:"show",value:function(e){_.removeClass(this.root,"hide")}},{key:"beforeCreate",value:function(e){typeof e.player.config.poster=="string"&&(e.config.poster=e.player.config.poster)}},{key:"afterCreate",value:function(){var e=this;this.on(Lt,function(){e.isEndedShow&&_.removeClass(e.root,"hide")}),this.config.hideCanplay?(this.once(Le,function(){e.onTimeUpdate()}),this.on(wi,function(){_.removeClass(e.root,"hide"),_.addClass(e.root,"xg-showplay"),e.once(Le,function(){e.onTimeUpdate()})})):this.on(Be,function(){_.addClass(e.root,"hide")})}},{key:"onTimeUpdate",value:function(){var e=this;this.player.currentTime?_.removeClass(this.root,"xg-showplay"):this.once(Le,function(){e.onTimeUpdate()})}},{key:"update",value:function(e){e&&(this.config.poster=e,this.root.style.backgroundImage="url(".concat(e,")"))}},{key:"getBgSize",value:function(e){var n="";switch(e){case"cover":n="cover";break;case"contain":n="contain";break;case"fixHeight":n="auto 100%";break;default:n=""}return n?"background-size: ".concat(n,";"):""}},{key:"render",value:function(){var e=this.config,n=e.poster,r=e.hideCanplay,s=e.fillMode,u=e.notHidden,l=this.getBgSize(s),c=n?"background-image:url(".concat(n,");").concat(l):l,f=u?"xg-not-hidden":r?"xg-showplay":"";return'<xg-poster class="xgplayer-poster '.concat(f,'" style="').concat(c,`">
    </xg-poster>`)}}],[{key:"pluginName",get:function(){return"poster"}},{key:"defaultConfig",get:function(){return{isEndedShow:!0,hideCanplay:!1,notHidden:!1,poster:"",fillMode:"fixWidth"}}}]),i}(ee);function hr(){return new DOMParser().parseFromString(`<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>
</svg>
`,"image/svg+xml").firstChild}function dr(){return new DOMParser().parseFromString(`<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>
</svg>
`,"image/svg+xml").firstChild}var st={};function $o(a,o){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{start:null,end:null};return st[a]&&window.clearTimeout(st[a].id),st[a]={},i.start&&i.start(),st[a].id=window.setTimeout(function(){i.end&&i.end(),window.clearTimeout(st[a].id),delete st[a]},o),st[a].id}function Rr(a){if(a){window.clearTimeout(a);return}Object.keys(st).map(function(o){window.clearTimeout(st[o].id),delete st[o]})}var Ko=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),M(I(e),"onPlayerReset",function(){e.autoPlayStart=!1;var n=e.config.mode==="auto"?"auto-hide":"hide";e.setAttr("data-state","play"),_.removeClass(e.root,n),e.show()}),M(I(e),"onAutoplayStart",function(){if(!e.autoPlayStart){var n=e.config.mode==="auto"?"auto-hide":"hide";_.addClass(e.root,n),e.autoPlayStart=!0,e.onPlayPause("play")}}),e.autoPlayStart=!1,e}return $(i,[{key:"afterCreate",value:function(){var e=this,n=this.player,r=this.playerConfig;this.initIcons(),this.once(ur,function(){r&&(r.lang&&r.lang==="en"?_.addClass(n.root,"lang-is-en"):r.lang==="jp"&&_.addClass(n.root,"lang-is-jp"))}),this.on(Ft,this.onAutoplayStart),r.autoplay||this.show(),this.on(lr,function(){var s=e.config.mode==="auto"?"auto-hide":"hide";e.setAttr("data-state","play"),_.removeClass(e.root,s),e.show()}),this.on(Be,function(){e.onPlayPause("play")}),this.on(jt,function(){e.onPlayPause("pause")}),this.on(pn,function(){e.onPlayerReset()}),this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:function(u){u.cancelable&&u.preventDefault(),u.stopPropagation();var l=e.player.paused;e.emitUserAction(u,"switch_play_pause",{props:"paused",from:l,to:!l})}}),this.bind(["click","touchend"],this.clickHandler)}},{key:"registerIcons",value:function(){return{startPlay:{icon:hr,class:"xg-icon-play"},startPause:{icon:dr,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild("xg-start-inner",e.startPlay),this.appendChild("xg-start-inner",e.startPause)}},{key:"hide",value:function(){_.addClass(this.root,"hide")}},{key:"show",value:function(e){_.removeClass(this.root,"hide")}},{key:"focusHide",value:function(){_.addClass(this.root,"focus-hide")}},{key:"recover",value:function(){_.removeClass(this.root,"focus-hide")}},{key:"switchStatus",value:function(e){e?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}},{key:"animate",value:function(e){var n=this;this._animateId=$o("pauseplay",400,{start:function(){_.addClass(n.root,"interact"),n.show(),n.switchStatus(!0)},end:function(){_.removeClass(n.root,"interact"),!e&&n.hide(),n._animateId=null}})}},{key:"endAnimate",value:function(){_.removeClass(this.root,"interact"),Rr(this._animateId),this._animateId=null}},{key:"switchPausePlay",value:function(e){var n=this.player;if(e.cancelable&&e.preventDefault(),e.stopPropagation(),!(n.state<ce.READY)){var r=this.player.paused;!r&&n.state===ce.RUNNING?n.pause():n.play()}}},{key:"onPlayPause",value:function(e){var n=this.config,r=this.player;if(!(!r||r.state<ce.RUNNING||!this.autoPlayStart)){if(n.mode==="show"){this.switchStatus(),this.show();return}if(n.mode==="auto"){this.switchStatus();return}if(n.isShowPause&&r.paused&&!r.ended||n.isShowEnd&&r.ended){this.switchStatus(),this.show(),this.endAnimate();return}if(n.disableAnimate){this.switchStatus(),this.hide();return}if(e==="play")this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||r.ended)return;this.animate()}}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.clickHandler),Rr(this._animateId)}},{key:"render",value:function(){var e=this.playerConfig.autoplay?this.config.mode==="auto"?"auto-hide":"hide":"";return`
    <xg-start class="xgplayer-start `.concat(e,`">
    <xg-start-inner></xg-start-inner>
    </xg-start>`)}}],[{key:"pluginName",get:function(){return"start"}},{key:"defaultConfig",get:function(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}}]),i}(ee),Yo=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"render",value:function(){var e=this.config.innerHtml,n=_.createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)n.appendChild(e);else if(e&&typeof e=="string")n.innerHTML=e;else{for(var r="",s=1;s<=12;s++)r+='<div class="xgplayer-enter-bar'.concat(s,'"></div>');n.innerHTML='<div class="xgplayer-enter-spinner">'.concat(r,"</div>")}return n}}],[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}]),i}(ee);function kt(a,o,i){try{return' <div class="xg-tips '.concat(i?"hide":" ",'" lang-key="').concat(a.i18nKeys[o],`">
    `).concat(a.i18n[o],`
    </div>`)}catch(t){return'<div class="xg-tips hide"></div>'}}var Mr=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="MINISCREEN";return`
      <xg-icon class="xgplayer-miniicon">
      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="`.concat(this.i18nKeys[e],'">').concat(this.i18n[e],`</span></div>
      </xg-icon>`)}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:10}}}]),i}(ee);function Nr(a){var o=parseFloat(a),i=a.indexOf("%")===-1&&!Number.isNaN(o);return i&&o}var pr=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],es=pr.length;function qo(){for(var a={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},o=0;o<es;o++){var i=pr[o];a[i]=0}return a}function Xo(a){var o=window.getComputedStyle(a);return o}function Br(a){if(typeof a=="string"&&(a=document.querySelector(a)),!(!a||Re(a)!=="object"||!a.nodeType)){var o=Xo(a);if(o.display==="none")return qo();var i={};i.width=a.offsetWidth,i.height=a.offsetHeight;for(var t=i.isBorderBox=o.boxSizing==="border-box",e=0;e<es;e++){var n=pr[e],r=o[n],s=parseFloat(r);i[n]=Number.isNaN(s)?0:s}var u=i.paddingLeft+i.paddingRight,l=i.paddingTop+i.paddingBottom,c=i.marginLeft+i.marginRight,f=i.marginTop+i.marginBottom,d=i.borderLeftWidth+i.borderRightWidth,v=i.borderTopWidth+i.borderBottomWidth,h=t,p=Nr(o.width);p!==!1&&(i.width=p+(h?0:u+d));var g=Nr(o.height);return g!==!1&&(i.height=g+(h?0:l+v)),i.innerWidth=i.width-(u+d),i.innerHeight=i.height-(l+v),i.outerWidth=i.width+c,i.outerHeight=i.height+f,i}}function xn(a,o){for(var i=0;i<a.length;i++){var t=a[i];if(t.identifier===o)return t}}var Pn={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},Fr={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},Zo=function(a){X(i,a);var o=Z(i);function i(t){var e,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return W(this,i),e=o.call(this),e.isEnabled=!0,e.isDragging=!1,e.isDown=!1,e.position={},e.downPoint={},e.dragPoint={x:0,y:0},e.startPos={x:0,y:0},e._root=t instanceof Element?t:document.querySelector(t),e._handlerDom=n.handle instanceof Element?n.handle:document.querySelector(n.handle),!e._root||!e._handlerDom?rr(e):(e._bindStartEvent(),e)}return $(i,[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),Fr[this._startKey].map(function(n){e["on".concat(n)]=e["on".concat(n)].bind(e)})}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var n=this;if(e){var r=Fr[this._startKey];r.map(function(s){window.addEventListener(s,n["on".concat(s)])}),this._boundPointerEvents=r}}},{key:"_unbindPostStartEvents",value:function(){var e=this;this._boundPointerEvents&&(this._boundPointerEvents.map(function(n){window.removeEventListener(n,e["on".concat(n)])}),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame(function(){e.animate()}))}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var n=e.changedTouches[0];this.dragStart(e,n),this.touchIdentifier=n.pointerId!==void 0?n.pointerId:n.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var n=xn(e.changedTouches,this.touchIdentifier);n&&this.dragMove(e,n)}},{key:"ontouchend",value:function(e){var n=xn(e.changedTouches,this.touchIdentifier);n&&this.dragEnd(e,n),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var n=xn(e.changedTouches,this.touchIdentifier);n&&this.dragCancel(e,n)}},{key:"dragStart",value:function(e,n){if(!(!this._root||this.isDown||!this.isEnabled)){this.downPoint=n,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var r=Br(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-r.height,this.startPos.maxX=window.innerWidth-r.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,n){this.isDragging=!0,this.animate(),this.emit(Pn.START,this.startPos)}},{key:"dragEnd",value:function(e,n){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(Pn.ENDED)),this.presetInfo())}},{key:"_dragPointerMove",value:function(e,n){var r={x:n.pageX-this.downPoint.pageX,y:n.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(r)&&this.dragRealStart(e,n),r}},{key:"dragMove",value:function(e,n){if(e=e||window.event,!!this.isDown){var r=this.startPos,s=r.x,u=r.y,l=this._dragPointerMove(e,n),c=l.x,f=l.y;c=this.checkContain("x",c,s),f=this.checkContain("y",f,u),this.position.x=s+c,this.position.y=u+f,this.dragPoint.x=c,this.dragPoint.y=f,this.emit(Pn.MOVE,this.position)}}},{key:"dragCancel",value:function(e,n){this.dragEnd(e,n)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,n,r){return n+r<0?0-r:e==="x"&&n+r>this.startPos.maxX?this.startPos.maxX-r:e==="y"&&n+r>this.startPos.maxY?this.startPos.maxY-r:n}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),n=this._getPositionCoord(e.left,"width"),r=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(n)?0:n,this.position.y=Number.isNaN(r)?0:r,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var n=e.transform;if(n.indexOf("matrix")===0){var r=n.split(","),s=n.indexOf("matrix3d")===0?12:4,u=parseInt(r[s],10),l=parseInt(r[s+1],10);this.position.x+=u,this.position.y+=l}}},{key:"_getPositionCoord",value:function(e,n){if(e.indexOf("%")!==-1){var r=Br(this._root.parentNode);return r?parseFloat(e)/100*r[n]:0}return parseInt(e,10)}}]),i}(ci),Jo=function(a){X(i,a);var o=Z(i);function i(t){var e;W(this,i),e=o.call(this,t),M(I(e),"onCancelClick",function(s){e.exitMini(),e.isClose=!0}),M(I(e),"onCenterClick",function(s){var u=I(e),l=u.player;l.paused?l.play():l.pause()}),M(I(e),"onScroll",function(s){if(!(!window.scrollY&&window.scrollY!==0||Math.abs(window.scrollY-e.pos.scrollY)<50)){var u=parseInt(_.getCss(e.player.root,"height"));u+=e.config.scrollTop,e.pos.scrollY=window.scrollY,window.scrollY>u+5?!e.isMini&&!e.isClose&&e.getMini():window.scrollY<=u&&(e.isMini&&e.exitMini(),e.isClose=!1)}}),e.isMini=!1,e.isClose=!1;var n=I(e),r=n.config;return e.pos={left:r.left<0?window.innerWidth-r.width-20:r.left,top:r.top<0?window.innerHeight-r.height-20:r.top,height:e.config.height,width:e.config.width,scrollY:window.scrollY||0},e.lastStyle=null,e}return $(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.mini=="boolean"&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(jt,function(){e.setAttr("data-state","pause")}),this.on(Be,function(){e.setAttr("data-state","play")})}},{key:"onPluginsReady",value:function(){var e=this,n=this.player,r=this.config;if(!r.disable){if(this.config.isShowIcon){var s={config:{onClick:function(){e.getMini()}}};n.controls.registerPlugin(Mr,s,Mr.pluginName)}var u=_.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",u,this.onCancelClick),this.bind(".play-icon",u,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new Zo(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:hr,class:"xg-icon-play"},pause:{icon:dr,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var n=this.player,r=this.playerConfig,s=this.config.target||this.player.root;this.lastStyle={},_.addClass(n.root,"xgplayer-mini"),["width","height","top","left"].map(function(u){e.lastStyle[u]=s.style[u],s.style[u]="".concat(e.pos[u],"px")}),r.fluid&&(s.style["padding-top"]=""),this.emit(Yi,!0),n.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var n=this.player,r=this.playerConfig,s=this.config.target||this.player.root;_.removeClass(n.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map(function(u){s.style[u]=e.lastStyle[u]}),this.lastStyle=null,r.fluid&&(n.root.style.width="100%",n.root.style.height="0",n.root.style["padding-top"]="".concat(r.height*100/r.width,"%")),this.emit(Yi,!1),this.isMini=n.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=_.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return`
      <xg-mini-layer class="xg-mini-layer">
      <xg-mini-header class="xgplayer-mini-header">
      `.concat(kt(this,"MINI_DRAG",this.playerConfig.isHideTips),`
      </xg-mini-header>
      <div class="mini-cancel-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>
        </svg>
      </div>
      <div class="play-icon">
      </div>
      </xg-mini-layer>`)}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),i}(ee),Ii={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},An=["videoClick","videoDbClick"],In=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"onMouseMove",function(s){var u=I(t),l=u.player,c=u.playerConfig;l.isActive||(l.focus({autoHide:!c.closeDelayBlur}),!c.closeFocusVideoFocus&&l.media.focus())}),M(I(t),"onMouseEnter",function(s){var u=I(t),l=u.playerConfig,c=u.player;!l.closeFocusVideoFocus&&c.media.focus(),l.closeDelayBlur?c.focus({autoHide:!1}):c.focus(),t.emit(Fa)}),M(I(t),"onMouseLeave",function(s){var u=t.playerConfig,l=u.closePlayerBlur,c=u.leavePlayerTime,f=u.closeDelayBlur;!l&&!f&&(c?t.player.focus({autoHide:!0,delay:c}):t.player.blur({ignorePaused:!0})),t.emit(Ba)}),M(I(t),"onVideoClick",function(s){var u=I(t),l=u.player,c=u.playerConfig;s.target&&c.closeVideoClick||(s.target===l.root||s.target===l.media||s.target===l.innerContainer||s.target===l.media.__canvas)&&(s.preventDefault(),c.closeVideoStopPropagation||s.stopPropagation(),t._clickCount++,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),t.clickTimer=setTimeout(function(){t._clickCount&&(t._clickCount--,pt(I(t),An[0],function(f,d){t.switchPlayPause(d.e)},{e:s,paused:l.paused}),clearTimeout(t.clickTimer),t.clickTimer=null)},300))}),M(I(t),"onVideoDblClick",function(s){var u=I(t),l=u.player,c=u.playerConfig;if(!(c.closeVideoDblclick||!s.target||s.target!==l.media&&s.target!==l.media.__canvas)){if(!c.closeVideoClick&&t._clickCount<2){t._clickCount=0;return}t._clickCount=0,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),s.preventDefault(),s.stopPropagation(),pt(I(t),An[1],function(f,d){t.emitUserAction(d.e,"switch_fullscreen",{props:"fullscreen",from:l.fullscreen,to:!l.fullscreen}),l.fullscreen?l.exitFullscreen():l.getFullscreen()},{e:s,fullscreen:l.fullscreen})}}),t}return $(i,[{key:"afterCreate",value:function(){var e=this;this._clickCount=0,An.map(function(r){e.__hooks[r]=null});var n=this.playerConfig.isMobileSimulateMode;n==="mobile"||ae.device==="mobile"&&!ae.os.isIpad||this.initEvents()}},{key:"initEvents",value:function(){var e=this,n=this.player,r=n.media,s=n.root,u=this.playerConfig.enableContextmenu;s&&s.addEventListener("click",this.onVideoClick,!1),s&&s.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(Ii).map(function(l){s.addEventListener(l,e[Ii[l]],!1)}),!u&&r&&r.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(e){var n=this.player;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:n.paused,to:!n.paused}),n.ended?n.duration!==1/0&&n.duration>0&&n.replay():n.paused?n.play():n.pause()}},{key:"onContextmenu",value:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.stopPropagation?e.stopPropagation():(e.returnValue=!1,e.cancelBubble=!0)}},{key:"destroy",value:function(){var e=this,n=this.player,r=n.video,s=n.root;this.clickTimer&&clearTimeout(this.clickTimer),s.removeEventListener("click",this.onVideoClick,!1),s.removeEventListener("dblclick",this.onVideoDblClick,!1),r.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(Ii).map(function(u){s.removeEventListener(u,e[Ii[u]],!1)})}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{}}}]),i}(nt),xt={PRESS:"press",PRESS_END:"pressend",DOUBlE_CLICK:"doubleclick",CLICK:"click",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend"},Qo={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},eu={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function Ur(a){return a&&a.length>0?a[a.length-1]:null}function tu(){return{pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0}}var iu=function(){function a(o){var i=this,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{eventType:"touch"};W(this,a),M(this,"onTouchStart",function(e){var n=i._pos,r=i.root,s=Ur(e.touches);n.x=s?parseInt(s.pageX,10):e.pageX,n.y=s?parseInt(s.pageX,10):e.pageX,n.start=!0,i.__setPress(e),r.addEventListener(i.events.end,i.onTouchEnd),r.addEventListener(i.events.cancel,i.onTouchCancel),r.addEventListener(i.events.move,i.onTouchMove),i.trigger(xt.TOUCH_START,e)}),M(this,"onTouchCancel",function(e){i.onTouchEnd(e)}),M(this,"onTouchEnd",function(e){var n=i._pos,r=i.root;i.__clearPress(),r.removeEventListener(i.events.cancel,i.onTouchCancel),r.removeEventListener(i.events.end,i.onTouchEnd),r.removeEventListener(i.events.move,i.onTouchMove),e.moving=n.moving,e.press=n.press,n.press&&i.trigger(xt.PRESS_END,e),i.trigger(xt.TOUCH_END,e),!n.press&&!n.moving&&i.__setDb(e),n.press=!1,n.start=!1,n.moving=!1}),M(this,"onTouchMove",function(e){var n=i._pos,r=i.config,s=Ur(e.touches),u=s?parseInt(s.pageX,10):e.pageX,l=s?parseInt(s.pageY,10):e.pageX,c=u-n.x,f=l-n.y;Math.abs(f)<r.miniStep&&Math.abs(c)<r.miniStep||(i.__clearPress(),n.press&&i.trigger(xt.PRESS_END,e),n.press=!1,n.moving=!0,i.trigger(xt.TOUCH_MOVE,e))}),this._pos={moving:!1,start:!1,x:0,y:0},this.config=tu(),Object.keys(t).map(function(e){i.config[e]=t[e]}),this.root=o,this.events=t.eventType==="mouse"?eu:Qo,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}return $(a,[{key:"_initEvent",value:function(){this.root.addEventListener(this.events.start,this.onTouchStart)}},{key:"__setPress",value:function(i){var t=this,e=this.config;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout(function(){t.trigger(xt.PRESS,i),t._pos.press=!0,t.__clearPress()},e.pressDelay)}},{key:"__clearPress",value:function(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}},{key:"__setDb",value:function(i){var t=this,e=this.config;if(this.dbIntrvalId){this.__clearDb(),this.trigger(xt.DOUBlE_CLICK,i);return}this.dbIntrvalId=setTimeout(function(){t.__clearDb(),!t._pos.start&&!t._pos.press&&!t._pos.moving&&t.trigger(xt.CLICK,i)},e.dbClickDelay)}},{key:"__clearDb",value:function(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}},{key:"on",value:function(i,t){this.__handlers[i]||(this.__handlers[i]=[]),this.__handlers[i].push(t)}},{key:"off",value:function(i,t){if(this.__handlers[i]){for(var e=this.__handlers[i],n=-1,r=0;r<e.length;r++)if(e[r]===t){n=r;break}n>=0&&this.__handlers[i].splice(n,1)}}},{key:"trigger",value:function(i,t){this.__handlers[i]&&this.__handlers[i].map(function(e){try{e(t)}catch(n){console.error("trigger>>:".concat(i),n)}})}},{key:"destroy",value:function(){var i=this,t={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(t).forEach(function(e){i.root.removeEventListener(e,i[t[e]])})}}]),a}();function nu(){return new DOMParser().parseFromString(`<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path opacity="0.54"
    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"
    fill="white" />
  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>
</svg>`,"image/svg+xml").firstChild}var Xt={AUTO:"auto",SEEKING:"seeking",PLAYBACK:"playbackrate",LIGHT:""},Dn=["videoClick","videoDbClick"],ru=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),M(I(e),"onTouchStart",function(n){var r=I(e),s=r.player,u=r.config,l=r.pos,c=r.playerConfig,f=e.getTouche(n);if(f&&!u.disableGesture&&e.duration>0&&!s.ended){l.isStart=!0,_.checkIsFunction(c.disableSwipeHandler)&&c.disableSwipeHandler(),e.find(".xg-dur").innerHTML=_.format(e.duration);var d=e.root.getBoundingClientRect();s.rotateDeg===90?(l.top=d.left,l.left=d.top,l.width=d.height,l.height=d.width):(l.top=d.top,l.left=d.left,l.width=d.width,l.height=d.height);var v=parseInt(f.pageX-l.left,10),h=parseInt(f.pageY-l.top,10);l.x=s.rotateDeg===90?h:v,l.y=s.rotateDeg===90?v:h,l.scopeL=u.scopeL*l.width,l.scopeR=(1-u.scopeR)*l.width,l.scopeM1=l.width*(1-u.scopeM)/2,l.scopeM2=l.width-l.scopeM1}}),M(I(e),"onTouchMove",function(n){var r=e.getTouche(n),s=I(e),u=s.pos,l=s.config,c=s.player;if(!(!r||l.disableGesture||!e.duration||!u.isStart)){var f=l.miniMoveStep,d=l.hideControlsActive,v=parseInt(r.pageX-u.left,10),h=parseInt(r.pageY-u.top,10),p=c.rotateDeg===90?h:v,g=c.rotateDeg===90?v:h;if(Math.abs(p-u.x)>f||Math.abs(g-u.y)>f){var y=p-u.x,m=g-u.y,b=u.scope;if(b===-1&&(b=e.checkScope(p,g,y,m,u),b===0&&(d?c.blur():c.focus({autoHide:!1}),!u.time&&(u.time=parseInt(c.currentTime*1e3,10)+e.timeOffset*1e3)),u.scope=b),b===-1||b>0&&!l.gestureY||b===0&&!l.gestureX)return;n.cancelable&&n.preventDefault(),e.executeMove(y,m,b,u.width,u.height),u.x=p,u.y=g}}}),M(I(e),"onTouchEnd",function(n){var r=I(e),s=r.player,u=r.pos,l=r.playerConfig;if(u.isStart){u.scope>-1&&n.cancelable&&n.preventDefault();var c=e.config,f=c.disableGesture,d=c.gestureX;!f&&d?(e.endLastMove(u.scope),setTimeout(function(){s.getPlugin("progress")&&s.getPlugin("progress").resetSeekState()},10)):u.time=0,u.scope=-1,e.resetPos(),_.checkIsFunction(l.enableSwipeHandler)&&l.enableSwipeHandler(),e.changeAction(Xt.AUTO)}}),M(I(e),"onRootTouchMove",function(n){e.config.disableGesture||!e.config.gestureX||e.checkIsRootTarget(n)&&(n.stopPropagation(),e.pos.isStart?e.onTouchMove(n):e.onTouchStart(n))}),M(I(e),"onRootTouchEnd",function(n){e.pos.isStart&&e.checkIsRootTarget(n)&&(n.stopPropagation(),e.onTouchEnd(n))}),e.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},e.timer=null,e}return $(i,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"registerIcons",value:function(){return{seekTipIcon:{icon:nu,class:"xg-seek-pre"}}}},{key:"afterCreate",value:function(){var e=this;Dn.map(function(f){e.__hooks[f]=null});var n=this.playerConfig,r=this.config,s=this.player;n.closeVideoDblclick===!0&&(r.closedbClick=!0),this.resetPos(),_.isUndefined(n.disableGesture)||(r.disableGesture=!!n.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=_.createDom("xg-mask","",{},"xgmask"),s.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();var u=this.domEventType==="mouse"?"mouse":"touch";this.touch=new iu(this.root,{eventType:u,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",function(f){f.preventDefault()}),s.root.addEventListener("touchmove",this.onRootTouchMove,!0),s.root.addEventListener("touchend",this.onRootTouchEnd,!0),this.on(St,function(){var f=e.player,d=e.config;f.duration*1e3<d.moveDuration&&(d.moveDuration=f.duration*1e3)}),this.on([vt,Lt],function(){var f=e.pos,d=f.time,v=f.isStart;!v&&d>0&&(e.pos.time=0)});var l={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(l).map(function(f){e.touch.on(f,function(d){e[l[f]](d)})}),!r.disableActive){var c=s.plugins.progress;c&&(c.addCallBack("dragmove",function(f){e.activeSeekNote(f.currentTime,f.forward)}),c.addCallBack("dragend",function(){e.changeAction(Xt.AUTO)}))}}},{key:"registerThumbnail",value:function(){var e=this.player,n=e.plugins.thumbnail;if(n&&n.usable){this.thumbnail=n.createThumbnail(null,"mobile-thumbnail");var r=this.find(".time-preview");r.insertBefore(this.thumbnail,r.children[0])}}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},n=e.commonStyle,r=n.playedColor,s=n.progressColor,u=n.timePreviewStyle,l=n.curTimeColor,c=n.durationColor;if(r&&(this.find(".xg-curbar").style.backgroundColor=r),s&&(this.find(".xg-bar").style.backgroundColor=s),u){var f=this.find(".time-preview");Object.keys(u).forEach(function(h){f.style[h]=u[h]})}var d=l||r,v=c;d&&(this.find(".xg-cur").style.color=d),v&&(this.find(".xg-dur").style.color=v),this.config.disableTimeProgress&&_.addClass(this.find(".xg-timebar"),"hide")}},{key:"resetPos",value:function(){var e=this;this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map(function(n){e.pos[n]=0})):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}},{key:"changeAction",value:function(e){var n=this.player,r=this.root;r.setAttribute("data-xg-action",e);var s=n.plugins.start;s&&s.recover()}},{key:"getTouche",value:function(e){var n=this.player.rotateDeg,r=e.touches&&e.touches.length>0?e.touches[e.touches.length-1]:e;return n===0?{pageX:r.pageX,pageY:r.pageY}:{pageX:r.pageX,pageY:r.pageY}}},{key:"checkScope",value:function(e,n,r,s,u){var l=u.width,c=-1;if(e<0||e>l)return c;var f=Math.abs(s===0?r:r/s);return Math.abs(r)>0&&f>=1.73&&e>u.scopeM1&&e<u.scopeM2?c=0:(Math.abs(r)===0||f<=.57)&&(c=e<u.scopeL?1:e>u.scopeR?2:3),c}},{key:"executeMove",value:function(e,n,r,s,u){switch(r){case 0:this.updateTime(e/s*this.config.scopeM);break;case 1:this.updateBrightness(n/u);break;case 2:ae.os.isIos||this.updateVolume(n/u);break}}},{key:"endLastMove",value:function(e){var n=this,r=this.pos,s=this.player,u=this.config,l=(r.time-this.timeOffset)/1e3;switch(e){case 0:s.seek(Number(l).toFixed(1)),u.hideControlsEnd?s.blur():s.focus(),this.timer=setTimeout(function(){n.pos.time=0},500);break}this.changeAction(Xt.AUTO)}},{key:"checkIsRootTarget",value:function(e){var n=this.player.plugins||{};return n.progress&&n.progress.root.contains(e.target)?!1:n.start&&n.start.root.contains(e.target)||n.controls&&n.controls.root.contains(e.target)}},{key:"sendUseAction",value:function(e){var n=this.player.paused;this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:n,to:!n})}},{key:"clickHandler",value:function(e){var n=this.player,r=this.config,s=this.playerConfig;if(n.state<ce.RUNNING){s.closeVideoClick||(this.sendUseAction(_.createEvent("click")),n.play());return}!r.closedbClick||s.closeVideoClick?n.isActive?n.blur():n.focus():s.closeVideoClick||((n.isActive||r.focusVideoClick)&&(this.sendUseAction(_.createEvent("click")),this.switchPlayPause()),n.focus())}},{key:"dbClickHandler",value:function(e){var n=this.config,r=this.player;!n.closedbClick&&r.state>=ce.RUNNING&&(this.sendUseAction(_.createEvent("dblclick")),this.switchPlayPause())}},{key:"onClick",value:function(e){var n=this,r=this.player;pt(this,Dn[0],function(s,u){n.clickHandler(u.e)},{e,paused:r.paused})}},{key:"onDbClick",value:function(e){var n=this,r=this.player;pt(this,Dn[1],function(s,u){n.dbClickHandler(u.e)},{e,paused:r.paused})}},{key:"onPress",value:function(e){var n=this.pos,r=this.config,s=this.player;r.disablePress||(n.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:s.playbackRate,to:r.pressRate}),s.playbackRate=r.pressRate,this.changeAction(Xt.PLAYBACK))}},{key:"onPressEnd",value:function(e){var n=this.pos,r=this.config,s=this.player;r.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:s.playbackRate,to:n.rate}),s.playbackRate=n.rate,n.rate=1,this.changeAction(Xt.AUTO))}},{key:"updateTime",value:function(e){var n=this.player,r=this.config,s=this.player.duration;e=Number(e.toFixed(4));var u=parseInt(e*r.moveDuration,10)+this.timeOffset;u+=this.pos.time,u=u<0?0:u>s*1e3?s*1e3-200:u,n.getPlugin("time")&&n.getPlugin("time").updateTime(u/1e3),n.getPlugin("progress")&&n.getPlugin("progress").updatePercent(u/1e3/this.duration,!0),this.activeSeekNote(u/1e3,e>0),r.isTouchingSeek&&n.seek(Number((u-this.timeOffset)/1e3).toFixed(1)),this.pos.time=u}},{key:"updateVolume",value:function(e){this.player.rotateDeg&&(e=-e);var n=this.player,r=this.pos;if(e=parseInt(e*100,10),r.volume+=e,!(Math.abs(r.volume)<10)){var s=parseInt(n.volume*10,10)-parseInt(r.volume/10,10);s=s>10?10:s<1?0:s,n.volume=s/10,r.volume=0}}},{key:"updateBrightness",value:function(e){this.player.rotateDeg&&(e=-e);var n=this.pos,r=this.config,s=this.xgMask,u=n.light+.8*e;u=u>r.maxDarkness?r.maxDarkness:u<0?0:u,s&&(s.style.backgroundColor="rgba(0,0,0,".concat(u,")")),n.light=u}},{key:"activeSeekNote",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.player,s=this.config,u=!(this.duration!==1/0&&this.duration>0);if(!(!e||typeof e!="number"||u||s.disableActive)){e<0?e=0:e>r.duration&&(e=r.duration-.2),this.changeAction(Xt.SEEKING);var l=r.plugins.start;l&&l.focusHide(),this.find(".xg-dur").innerHTML=_.format(this.duration),this.find(".xg-cur").innerHTML=_.format(e),this.find(".xg-curbar").style.width="".concat(e/this.duration*100,"%"),n?_.removeClass(this.find(".xg-seek-show"),"xg-back"):_.addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(e)}}},{key:"updateThumbnails",value:function(e){var n=this.player,r=n.plugins.thumbnail;r&&r.usable&&this.thumbnail&&r.update(this.thumbnail,e,160,90)}},{key:"switchPlayPause",value:function(){var e=this.player;if(e.state<ce.ATTACHED)return!1;e.ended||(e.paused?e.play():e.pause())}},{key:"disableGesture",value:function(){this.config.disableGesture=!1}},{key:"enableGesture",value:function(){this.config.disableGesture=!0}},{key:"destroy",value:function(){var e=this.player;this.timer&&clearTimeout(this.timer),this.thumbnail=null,e.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,e.root.removeEventListener("touchmove",this.onRootTouchMove,!0),e.root.removeEventListener("touchend",this.onRootTouchEnd,!0)}},{key:"render",value:function(){var e=this.config.gradient!=="normal"?"gradient ".concat(this.config.gradient):"gradient";return`
     <xg-trigger class="trigger">
     <div class="`.concat(e,`"></div>
        <div class="time-preview">
            <div class="xg-seek-show `).concat(this.config.disableSeekIcon?" hide-seek-icon":"",`">
              <i class="xg-seek-icon"></i>
              <span class="xg-cur">00:00</span>
              <span class="xg-separator">/</span>
              <span class="xg-dur">00:00</span>
            </div>
              <div class="xg-bar xg-timebar">
                <div class="xg-curbar"></div>
              </div>
        </div>
        <div class="xg-playbackrate xg-top-note">
            <span><i>`).concat(this.config.pressRate,"X</i>").concat(this.i18n.FORWARD,`</span>
        </div>
     </xg-trigger>
    `)}}],[{key:"pluginName",get:function(){return"mobile"}},{key:"defaultConfig",get:function(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:60*6*1e3,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}}]),i}(ee);function au(a){a.preventDefault(),a.returnValue=!1}function Hr(a){var o=a.tagName;return!!(o==="INPUT"||o==="TEXTAREA"||a.isContentEditable)}var jr=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"onBodyKeyDown",function(s){if(t.player){var u=s||window.event,l=u.keyCode,c=I(t),f=c._keyState,d=c.player,v=t.config,h=v.disable,p=v.disableBodyTrigger,g=v.isIgnoreUserActive;if(h||p||!(d.isUserActive||g)||Hr(u.target)||!t.checkIsVisible()||u.metaKey||u.altKey||u.ctrlKey){f.isBodyKeyDown=!1;return}!s.repeat&&!f.isKeyDown&&((u.target===document.body||t.config.isGlobalTrigger&&!Hr(u.target))&&t.checkCode(l,!0)&&(f.isBodyKeyDown=!0),document.addEventListener("keyup",t.onBodyKeyUp)),f.isBodyKeyDown&&t.handleKeyDown(u)}}),M(I(t),"onBodyKeyUp",function(s){t.player&&(document.removeEventListener("keyup",t.onBodyKeyUp),t.handleKeyUp(s))}),M(I(t),"onKeydown",function(s){if(t.player){var u=s||window.event,l=I(t),c=l._keyState;if(!u.repeat){if(t.config.disable||t.config.disableRootTrigger||u.metaKey||u.altKey||u.ctrlKey)return;u&&(u.keyCode===37||t.checkCode(u.keyCode))&&(u.target===t.player.root||u.target===t.player.video||u.target===t.player.controls.el)&&(c.isKeyDown=!0),t.player.root.addEventListener("keyup",t.onKeyup)}c.isKeyDown&&t.handleKeyDown(u)}}),M(I(t),"onKeyup",function(s){t.player&&(t.player.root.removeEventListener("keyup",t.onKeyup),t.handleKeyUp(s))}),t}return $(i,[{key:"mergekeyCodeMap",value:function(){var e=this,n=this.config.keyCodeMap;n&&Object.keys(n).map(function(r){e.keyCodeMap[r]?["keyCode","action","disable","pressAction","disablePress","isBodyTarget"].map(function(s){n[r][s]&&(e.keyCodeMap[r][s]=n[r][s])}):e.keyCodeMap[r]=n[r]})}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var e=typeof this.config.seekStep=="function"?this.config.seekStep(this.player):this.config.seekStep;!e||typeof e!="number"||(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,disablePress:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,disablePress:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,disablePress:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disablePress:!1,disable:!1},right:{keyCode:39,action:"seek",pressAction:"changePlaybackRate",disablePress:!1,disable:!1},esc:{keyCode:27,action:"exitFullscreen",disablePress:!0,disable:!1}},this.mergekeyCodeMap(),this._keyState={isKeyDown:!1,isBodyKeyDown:!1,isPress:!1,tt:0,playbackRate:0},this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"setConfig",value:function(e){var n=this;Object.keys(e).forEach(function(r){n.config[r]=e[r]})}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var e=this.player.root.getBoundingClientRect(),n=e.height,r=e.top,s=e.bottom,u=window.innerHeight;return!(r<0&&r<0-n*.9||s>0&&s-u>n*.9)}},{key:"checkCode",value:function(e,n){var r=this,s=!1;return Object.keys(this.keyCodeMap).map(function(u){r.keyCodeMap[u]&&e===r.keyCodeMap[u].keyCode&&!r.keyCodeMap[u].disable&&(s=!n||n&&!r.keyCodeMap[u].noBodyTarget)}),s}},{key:"downVolume",value:function(e){var n=this.player;if(!(n.volume<=0)){var r=parseFloat((n.volume-.1).toFixed(1)),s={volume:{from:n.volume,to:r}};this.emitUserAction(e,"change_volume",{props:s}),r>=0?n.volume=r:n.volume=0}}},{key:"upVolume",value:function(e){var n=this.player;if(!(n.volume>=1)){var r=parseFloat((n.volume+.1).toFixed(1)),s={volume:{from:n.volume,to:r}};this.emitUserAction(e,"change_volume",{props:s}),r<=1?n.volume=r:n.volume=1}}},{key:"seek",value:function(e){var n=this.player,r=n.currentTime,s=n.offsetCurrentTime,u=n.duration,l=n.offsetDuration,c=n.timeSegments,f=s>-1?s:r,d=l||u,v=e.repeat&&this.seekStep>=4?parseInt(this.seekStep/2,10):this.seekStep;f+v<=d?f=f+v:f=d;var h=_.getCurrentTimeByOffset(f,c),p={currentTime:{from:r,to:h}};this.emitUserAction(e,"seek",{props:p}),this.player.currentTime=h}},{key:"seekBack",value:function(e){var n=this.player,r=n.currentTime,s=n.offsetCurrentTime,u=n.timeSegments,l=e.repeat?parseInt(this.seekStep/2,10):this.seekStep,c=s>-1?s:r,f=c-l;f<0&&(f=0),f=_.getCurrentTimeByOffset(f,u);var d={currentTime:{from:r,to:f}};this.emitUserAction(e,"seek",{props:d}),this.player.currentTime=f}},{key:"changePlaybackRate",value:function(e){var n=this._keyState,r=this.config,s=this.player;n.playbackRate===0&&(n.playbackRate=s.playbackRate,s.playbackRate=r.playbackRate)}},{key:"playPause",value:function(e){var n=this.player;n&&(this.emitUserAction(e,"switch_play_pause"),n.paused?n.play():n.pause())}},{key:"exitFullscreen",value:function(e){var n=this.player,r=n.fullscreen,s=n.cssfullscreen;r&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:r,to:!r}),n.exitFullscreen()),s&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:s,to:!s}),n.exitCssFullscreen())}},{key:"handleKeyDown",value:function(e){var n=this._keyState;if(e.repeat){n.isPress=!0;var r=Date.now();if(r-n.tt<200)return;n.tt=r}this.handleKeyCode(e.keyCode,e,n.isPress)}},{key:"handleKeyUp",value:function(e){var n=this._keyState;n.playbackRate>0&&(this.player.playbackRate=n.playbackRate,n.playbackRate=0),n.isKeyDown=!1,n.isPress=!1,n.tt=0}},{key:"handleKeyCode",value:function(e,n,r){for(var s=Object.keys(this.keyCodeMap),u=0;u<s.length;u++){var l=this.keyCodeMap[s[u]],c=l.action,f=l.keyCode,d=l.disable,v=l.pressAction,h=l.disablePress;if(f===e){if(!d&&!(r&&h)){var p=r&&v||c;typeof p=="function"?c(n,this.player,r):typeof p=="string"&&typeof this[p]=="function"&&this[p](n,this.player,r),this.emit(Va,Se({key:s[u],target:n.target,isPress:r},this.keyCodeMap[s[u]]))}au(n),n.stopPropagation();break}}}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown),this.player.root.removeEventListener("keyup",this.onKeyup),document.removeEventListener("keyup",this.onBodyKeyUp)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!1,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!0,keyCodeMap:{},disable:!1,playbackRate:2,isIgnoreUserActive:!0}}}]),i}(nt);function su(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">
  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>
</svg>
`,"image/svg+xml").firstChild}var ou=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"registerIcons",value:function(){return{loadingIcon:su}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return`
    <xg-loading class="xgplayer-loading">
      <xg-loading-inner></xg-loading-inner>
    </xg-loading>`}}],[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:pe.ROOT}}}]),i}(ee),uu=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}],lu=function(){function a(o){W(this,a),this.fragments=o.fragments||[],this.fragments.length===0&&this.fragments.push({percent:1}),this._callBack=o.actionCallback,this.fragConfig={fragFocusClass:o.fragFocusClass||"inner-focus-point",fragAutoFocus:!!o.fragAutoFocus,fragClass:o.fragClass||""},this.style=o.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0,this.focusIndex=-1}return $(a,[{key:"updateDuration",value:function(i){var t=this;this.duration=i;var e=0,n=this.fragments;this.fragments=n.map(function(r){return r.start=parseInt(e,10),r.end=parseInt(e+r.percent*t.duration,10),r.duration=parseInt(r.percent*t.duration,10),e+=r.percent*t.duration,r})}},{key:"updateProgress",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"played",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},e=this.progressList,n=this.fragments;if(!(e.length<1)){var r=t.newIndex,s=t.curIndex,u=t.millisecond;r!==s&&e.map(function(f,d){d<r?f[i].style.width="100%":d>r&&(f[i].style.width=0)});var l=n[r],c=u===0?0:(u-l.start)/l.duration;e[r][i].style.width=c<0?0:"".concat(c*100,"%")}}},{key:"updateFocus",value:function(i){if(!(!this.fragConfig.fragAutoFocus||this.fragments.length<2)){if(!i){if(this.focusIndex>-1){this.unHightLight(this.focusIndex);var t={index:-1,preIndex:this.focusIndex,fragment:null};this._callBack&&this._callBack(t),this.focusIndex=-1}return}var e=this.findIndex(i.currentTime*1e3,this.focusIndex);if(e>=0&&e!==this.focusIndex){this.focusIndex>-1&&this.unHightLight(this.focusIndex),this.setHightLight(e);var n={index:e,preIndex:this.focusIndex,fragment:this.fragments[this.focusIndex]};this.focusIndex=e,this._callBack&&this._callBack(n)}}}},{key:"update",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(t*1e3,10)!==this.duration){if(!t&&t!==0)return;this.updateDuration(parseInt(t*1e3,10))}var e=this.playedIndex,n=this.cachedIndex;if(_.typeOf(i.played)!=="Undefined"){var r=this.findIndex(i.played*1e3,e);if(r<0)return;this.updateProgress("played",{newIndex:r,curIndex:e,millisecond:parseInt(i.played*1e3,10)}),this.playedIndex=r}if(_.typeOf(i.cached)!=="Undefined"){var s=this.findIndex(i.cached*1e3,n);if(s<0)return;this.updateProgress("cached",{newIndex:s,curIndex:n,millisecond:parseInt(i.cached*1e3,10)}),this.cachedIndex=s}}},{key:"findIndex",value:function(i,t){var e=this.fragments;if(!e||e.length===0)return-1;if(e.length===1)return 0;if(t>-1&&t<e.length&&i>e[t].start&&i<e[t].end)return t;if(i>e[e.length-1].start)return e.length-1;for(var n=0;n<e.length;n++)if(i>e[n].start&&i<=e[n].end){t=n;break}return t}},{key:"findHightLight",value:function(){for(var i=this.root.children,t=0;t<i.length;t++)if(_.hasClass(i[t],this.fragConfig.fragFocusClass))return{dom:i[t],pos:i[t].getBoundingClientRect()}}},{key:"findFragment",value:function(i){var t=this.root.children;return i<0||i>=t.length?null:{dom:t[i],pos:t[i].getBoundingClientRect()}}},{key:"unHightLight",value:function(){for(var i=this.root.children,t=0;t<i.length;t++)_.removeClass(i[t],this.fragConfig.fragFocusClass)}},{key:"setHightLight",value:function(i){var t=this.root.children;if(i<t.length)return _.addClass(t[i],this.fragConfig.fragFocusClass),{dom:t[i],pos:t[i].getBoundingClientRect()}}},{key:"destroy",value:function(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}},{key:"reset",value:function(i){var t=this;if(Object.keys(this.fragConfig).forEach(function(n){i[n]!==void 0&&(t.fragConfig[n]=i[n])}),i.fragments){if(this.fragments=i.fragments.length===0?[{percent:1}]:i.fragments,this.updateDuration(this.duration),this.playedIndex=0,this.cachedIndex=0,this.root)for(var e=this.root.children;e.length>0;)this.root.removeChild(e[0]);this.render()}}},{key:"render",value:function(){var i=this,t=this.style.progressColor;if(this.root||(this.root=_.createDom("xg-inners","",{},"progress-list")),this.fragments){var e=this.fragConfig,n=e.fragClass,r=e.fragFocusClass;this.progressList=this.fragments.map(function(s){var u=_.createDom("xg-inner","",{style:t?"background:".concat(t,"; flex: ").concat(s.percent):"flex: ".concat(s.percent)},"".concat(s.isFocus?r:""," xgplayer-progress-inner ").concat(n));return i.root.appendChild(u),uu.forEach(function(l){u.appendChild(_.createDom(l.tag,"",{style:l.styleKey?"background: ".concat(i.style[l.styleKey],"; width:0;"):"width:0;"},l.className))}),{cached:u.children[0],played:u.children[1]}})}return this.root}}]),a}(),Vr={POINT:"inner-focus-point",HIGHLIGHT:"inner-focus-highlight"},cu=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),M(I(e),"onMoveOnly",function(n,r){var s=I(e),u=s.pos,l=s.config,c=s.player,f=r;if(n){_.event(n);var d=_.getEventPos(n,c.zoom),v=c.rotateDeg===90?d.clientY:d.clientX;if(u.moving&&Math.abs(u.x-v)<l.miniMoveStep)return;u.moving=!0,u.x=v,f=e.computeTime(n,v)}e.triggerCallbacks("dragmove",f,n),e._updateInnerFocus(f)}),M(I(e),"onBodyClick",function(n){e.pos.isLocked&&(e.pos.isLocked=!1,n.preventDefault(),n.stopPropagation())}),M(I(e),"_mouseDownHandler",function(n,r){e._state.time=r.currentTime,e.updateWidth(r.currentTime,r.seekTime,r.percent,0),e._updateInnerFocus(r)}),M(I(e),"_mouseUpHandler",function(n,r){var s=I(e),u=s.pos;u.moving&&e.updateWidth(r.currentTime,r.seekTime,r.percent,2)}),M(I(e),"_mouseMoveHandler",function(n,r){var s=I(e),u=s._state,l=s.pos,c=s.config,f=s.player;u.time<r.currentTime?r.forward=!0:r.forward=!1,u.time=r.currentTime,l.isDown&&!l.moving&&(l.moving=!0,c.isPauseMoving&&f.pause(),e.triggerCallbacks("dragstart",r,n),e.emitUserAction("drag","dragstart",r)),e.updateWidth(r.currentTime,r.seekTime,r.percent,1),e.triggerCallbacks("dragmove",r,n),e._updateInnerFocus(r)}),M(I(e),"onMouseDown",function(n){var r=I(e),s=r._state,u=r.player,l=r.pos,c=r.config,f=r.playerConfig,d=_.getEventPos(n,u.zoom),v=u.rotateDeg===90?d.clientY:d.clientX;if(!(u.isMini||c.closeMoveSeek||!f.allowSeekAfterEnded&&u.ended)){if(!u.duration&&!u.isPlaying){u.play();return}n.stopPropagation(),e.focus(),_.checkIsFunction(f.disableSwipeHandler)&&f.disableSwipeHandler(),_.checkIsFunction(c.onMoveStart)&&c.onMoveStart(),_.event(n),l.x=v,l.isDown=!0,l.moving=!1,s.prePlayTime=u.currentTime,u.focus({autoHide:!1}),e.isProgressMoving=!0,_.addClass(e.progressBtn,"active");var h=e.computeTime(n,v);h.prePlayTime=s.prePlayTime,e._mouseDownHandlerHook(n,h);var p=n.type;return p==="touchstart"?(e.root.addEventListener("touchmove",e.onMouseMove),e.root.addEventListener("touchend",e.onMouseUp)):(e.unbind("mousemove",e.onMoveOnly),document.addEventListener("mousemove",e.onMouseMove,!1),document.addEventListener("mouseup",e.onMouseUp,!1)),!0}}),M(I(e),"onMouseUp",function(n){var r=I(e),s=r.player,u=r.config,l=r.pos,c=r.playerConfig,f=r._state;n.stopPropagation(),n.preventDefault(),_.checkIsFunction(c.enableSwipeHandler)&&c.enableSwipeHandler(),_.checkIsFunction(u.onMoveEnd)&&u.onMoveEnd(),_.event(n),_.removeClass(e.progressBtn,"active");var d=e.computeTime(n,l.x);d.prePlayTime=f.prePlayTime,l.moving?(e.triggerCallbacks("dragend",d,n),e.emitUserAction("drag","dragend",d)):(e.triggerCallbacks("click",d,n),e.emitUserAction("click","click",d)),e._mouseUpHandlerHook(n,d),l.moving=!1,l.isDown=!1,l.x=0,l.y=0,l.isLocked=!0,f.prePlayTime=0,f.time=0;var v=n.type;v==="touchend"?(e.root.removeEventListener("touchmove",e.onMouseMove),e.root.removeEventListener("touchend",e.onMouseUp),e.blur()):(document.removeEventListener("mousemove",e.onMouseMove,!1),document.removeEventListener("mouseup",e.onMouseUp,!1),l.isEnter?c.isMobileSimulateMode!=="mobile"&&e.bind("mousemove",e.onMoveOnly):e.onMouseLeave(n)),_.setTimeout(I(e),function(){e.resetSeekState()},10),s.focus()}),M(I(e),"onMouseMove",function(n){var r=I(e),s=r._state,u=r.pos,l=r.player,c=r.config;_.checkTouchSupport()&&n.preventDefault(),_.event(n);var f=_.getEventPos(n,l.zoom),d=l.rotateDeg===90?f.clientY:f.clientX,v=Math.abs(u.x-d);if(!(u.moving&&v<c.miniMoveStep||!u.moving&&v<c.miniStartStep)){u.x=d;var h=e.computeTime(n,d);h.prePlayTime=s.prePlayTime,e._mouseMoveHandlerHook(n,h)}}),M(I(e),"onMouseOut",function(n){e.triggerCallbacks("mouseout",null,n)}),M(I(e),"onMouseOver",function(n){e.triggerCallbacks("mouseover",null,n)}),M(I(e),"onMouseEnter",function(n){var r=I(e),s=r.player,u=r.pos;if(!(u.isDown||u.isEnter||s.isMini||!s.config.allowSeekAfterEnded&&s.ended)){u.isEnter=!0,e.bind("mousemove",e.onMoveOnly),e.bind("mouseleave",e.onMouseLeave),_.event(n);var l=_.getEventPos(n,s.zoom),c=s.rotateDeg===90?l.clientY:l.clientX,f=e.computeTime(n,c);e.triggerCallbacks("mouseenter",f,n),e.focus()}}),M(I(e),"onMouseLeave",function(n){e.triggerCallbacks("mouseleave",null,n),e.unlock(),e._updateInnerFocus(null)}),M(I(e),"onVideoResize",function(){var n=e.pos,r=n.x,s=n.isDown,u=n.isEnter;if(u&&!s){var l=e.computeTime(null,r);e.onMoveOnly(null,l)}}),e.useable=!1,e.isProgressMoving=!1,e.__dragCallBacks=[],e._state={now:-1,direc:0,time:0,prePlayTime:-1},e._disableBlur=!1,e}return $(i,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"currentTime",get:function(){var e=this.player,n=e.offsetCurrentTime,r=e.currentTime;return n>=0?n:r+this.timeOffset}},{key:"changeState",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.useable=e}},{key:"show",value:function(e){this.root&&(this.root.style.display="flex")}},{key:"_initInner",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(!n||n.length===0)&&(n=[{percent:1}]);var s=Se(Se({fragments:n},r),{},{actionCallback:function(l){e.emitUserAction("fragment_focus","fragment_focus",l)}});this.innerList?this.innerList.reset(s):(this.innerList=new lu(s),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map(function(u){e[u]=e.innerList[u].bind(e.innerList)}))}},{key:"_updateInnerFocus",value:function(e){this.innerList&&this.innerList.updateFocus(e)}},{key:"afterCreate",value:function(){var e=this;if(!(this.config.disable||this.playerConfig.isLive)){this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1,isLocked:!1},this.outer=this.find("xg-outer");var n=this.config,r=n.fragFocusClass,s=n.fragAutoFocus,u=n.fragClass;this._initInner(this.config.fragments,{fragFocusClass:r,fragAutoFocus:s,fragClass:u,style:this.playerConfig.commonStyle||{}}),ae.device==="mobile"&&(this.config.isDragingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.on(St,function(){e.onMouseLeave()}),this.on(Le,function(){e.onTimeupdate()}),this.on(ct,function(){e.onTimeupdate(),e.onCacheUpdate()}),this.on(Ra,function(){e.onCacheUpdate()}),this.on(Lt,function(){e.onCacheUpdate(!0),e.onTimeupdate(!0),e._state.now=0}),this.on(Vt,function(){e.onReset()}),this.on(_t,function(){e.onVideoResize()}),this.bindDomEvents(),this.initCustomStyle()}}},{key:"setConfig",value:function(e){var n=this,r=null;Object.keys(e).forEach(function(s){n.config[s]=e[s],s==="fragments"&&(r=e[s])}),r&&this._initInner(r,e)}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},n=e.commonStyle,r=n.sliderBtnStyle,s=this.progressBtn;r&&(typeof r=="string"?s.style.boxShadow=r:Re(r)==="object"&&Object.keys(r).map(function(u){s.style[u]=r[u]}))}},{key:"triggerCallbacks",value:function(e,n,r){this.__dragCallBacks.length>0&&this.__dragCallBacks.map(function(s){if(s&&s.handler&&s.type===e)try{s.handler(n,r)}catch(u){console.error("[XGPLAYER][triggerCallbacks] ".concat(s," error"),u)}})}},{key:"addCallBack",value:function(e,n){n&&typeof n=="function"&&this.__dragCallBacks.push({type:e,handler:n})}},{key:"removeCallBack",value:function(e,n){var r=this.__dragCallBacks,s=-1;r.map(function(u,l){u&&u.type===e&&u.handler===n&&(s=l)}),s>-1&&r.splice(s,1)}},{key:"unlock",value:function(){var e=this.player,n=this.pos;if(n.isEnter=!1,n.isLocked=!1,!e.isMini){if(this.unbind("mousemove",this.onMoveOnly),n.isDown){this.unbind("mouseleave",this.onMouseLeave);return}this.blur()}}},{key:"bindDomEvents",value:function(){var e=this.player,n=e.controls,r=e.config;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),(this.domEventType==="touch"||this.domEventType==="compatible")&&(this.root.addEventListener("touchstart",this.onMouseDown),n&&(n.root&&n.root.addEventListener("touchmove",_.stopPropagation),n.center&&n.center.addEventListener("touchend",_.stopPropagation))),(this.domEventType==="mouse"||this.domEventType==="compatible")&&(this.bind("mousedown",this.onMouseDown),r.isMobileSimulateMode!=="mobile"&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut),this.player.root.addEventListener("click",this.onBodyClick,!0))}},{key:"focus",value:function(){this.player.controls.pauseAutoHide(),_.addClass(this.root,"active")}},{key:"blur",value:function(){this._disableBlur||(this.player.controls.recoverAutoHide(),_.removeClass(this.root,"active"))}},{key:"disableBlur",value:function(){this._disableBlur=!0}},{key:"enableBlur",value:function(){this._disableBlur=!1}},{key:"updateWidth",value:function(e,n,r,s){var u=this.config,l=this.player;if(!(u.isCloseClickSeek&&s===0)){var c=n=n>=l.duration?l.duration-u.endedDiff:Number(n).toFixed(1);this.updatePercent(r),this.updateTime(e),!(s===1&&(!u.isDragingSeek||l.config.mediaType==="audio"))&&(this._state.now=c,this._state.direc=c>l.currentTime?0:1,l.seek(c))}}},{key:"computeTime",value:function(e,n){var r=this.player,s=this.root.getBoundingClientRect(),u=s.width,l=s.height,c=s.top,f=s.left,d,v,h=n;r.rotateDeg===90?(d=l,v=c):(d=u,v=f);var p=h-v;p=p>d?d:p<0?0:p;var g=p/d;g=g<0?0:g>1?1:g;var y=parseInt(g*this.offsetDuration*1e3,10)/1e3,m=_.getCurrentTimeByOffset(y,r.timeSegments);return{percent:g,currentTime:y,seekTime:m,offset:p,width:d,left:v,e}}},{key:"updateTime",value:function(e){var n=this.player,r=this.duration;e>r?e=r:e<0&&(e=0);var s=n.plugins.time;s&&s.updateTime(e)}},{key:"resetSeekState",value:function(){this.isProgressMoving=!1;var e=this.player.plugins.time;e&&e.resetActive()}},{key:"updatePercent",value:function(e,n){if(this.isProgressMoving=!0,!this.config.disable){e=e>1?1:e<0?0:e,this.progressBtn.style.left="".concat(e*100,"%"),this.innerList.update({played:e*this.offsetDuration},this.offsetDuration);var r=this.player.plugins.miniprogress;r&&r.update({played:e*this.offsetDuration},this.offsetDuration)}}},{key:"onTimeupdate",value:function(e){var n=this.player,r=this._state,s=this.offsetDuration;if(!(n.isSeeking&&n.media.seeking||this.isProgressMoving||!n.hasStart)){if(r.now>-1){var u=parseInt(r.now*1e3,10)-parseInt(n.currentTime*1e3,10);if(r.direc===0&&u>300||r.direc===1&&u>-300){r.now=-1;return}else r.now=-1}var l=this.currentTime;l=_.adjustTimeByDuration(l,s,e),this.innerList.update({played:l},s),this.progressBtn.style.left="".concat(l/s*100,"%")}}},{key:"onCacheUpdate",value:function(e){var n=this.player,r=this.duration;if(n){var s=n.bufferedPoint.end;s=_.adjustTimeByDuration(s,r,e),this.innerList.update({cached:s},r)}}},{key:"onReset",value:function(){this.innerList.update({played:0,cached:0},0),this.progressBtn.style.left="0%"}},{key:"destroy",value:function(){var e=this.player,n=e.controls;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null;var r=this.domEventType;(r==="touch"||r==="compatible")&&(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),n&&(n.root&&n.root.removeEventListener("touchmove",_.stopPropagation),n.center&&n.center.removeEventListener("touchend",_.stopPropagation))),(r==="mouse"||r==="compatible")&&(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),e.root.removeEventListener("click",this.onBodyClick,!0))}},{key:"render",value:function(){if(!(this.config.disable||this.playerConfig.isLive)){var e=this.player.controls?this.player.controls.config.mode:"",n=e==="bottom"?"xgplayer-progress-bottom":"";return`
    <xg-progress class="xgplayer-progress `.concat(n,`">
      <xg-outer class="xgplayer-progress-outer">
        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>
      </xg-outer>
    </xg-progress>
    `)}}}],[{key:"pluginName",get:function(){return"progress"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_CENTER,index:0,disable:!1,isDragingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],fragFocusClass:Vr.POINT,fragClass:"",fragAutoFocus:!1,miniMoveStep:5,miniStartStep:2,onMoveStart:function(){},onMoveEnd:function(){},endedDiff:.2}}},{key:"FRAGMENT_FOCUS_CLASS",get:function(){return Vr}}]),i}(ee),zt=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"_onMouseenter",function(s){t.emit("icon_mouseenter",{pluginName:t.pluginName})}),M(I(t),"_onMouseLeave",function(s){t.emit("icon_mouseleave",{pluginName:t.pluginName})}),t}return $(i,[{key:"afterCreate",value:function(){this.bind("mouseenter",this._onMouseenter),this.bind("mouseleave",this._onMouseLeave)}},{key:"destroy",value:function(){this.unbind("mouseenter",this._onMouseenter),this.unbind("mouseleave",this._onMouseLeave)}}]),i}(ee),fu=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"afterCreate",value:function(){var e=this;ne(Q(i.prototype),"afterCreate",this).call(this);var n=this.player,r=this.config;r.disable||(this.initIcons(),this.btnClick=this.btnClick.bind(this),this.bind(["touchend","click"],this.btnClick),this.on([jt,fi,Vt],function(){e.animate(n.paused)}),this.on(Be,function(){e.animate(n.paused)}),this.animate(!0))}},{key:"registerIcons",value:function(){return{play:{icon:hr,class:"xg-icon-play"},pause:{icon:dr,class:"xg-icon-pause"}}}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var n=this.player;return this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:n.paused,to:!n.paused}),n.ended?n.replay():n.paused?(n.play(),this.animate(!1)):(n.pause(),this.animate(!0)),!1}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.play),this.appendChild(".xgplayer-icon",e.pause)}},{key:"animate",value:function(e){if(this.player){var n=this.i18nKeys,r=this.find(".xg-tips");e?(this.setAttr("data-state","pause"),r&&this.changeLangTextKey(r,n.PLAY_TIPS)):(this.setAttr("data-state","play"),r&&this.changeLangTextKey(r,n.PAUSE_TIPS))}}},{key:"destroy",value:function(){ne(Q(i.prototype),"destroy",this).call(this),this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-play">
    <div class="xgplayer-icon">
    </div>
    `.concat(kt(this,"PLAY_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_LEFT,index:0,disable:!1}}}]),i}(zt);function hu(){return new DOMParser().parseFromString(`<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>
    </g>
</svg>`,"image/svg+xml").firstChild}var du=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.onClick=function(n){n.preventDefault(),n.stopPropagation(),e.config.onClick(n)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:hu,class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(this.root,e.screenBack)}},{key:"show",value:function(){_.addClass(this.root,"show")}},{key:"hide",value:function(){_.removeClass(this.root,"show")}},{key:"render",value:function(){return`<xg-icon class="xgplayer-back">
    </xg-icon>`}}],[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:pe.ROOT_TOP,index:0}}}]),i}(ee);function pu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>
</svg>
`,"image/svg+xml").firstChild}function vu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>
</svg>
`,"image/svg+xml").firstChild}var gu=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"_onOrientationChange",function(s){t.player.fullscreen&&t.config.rotateFullscreen&&(window.orientation===90||window.orientation===-90?t.player.setRotateDeg(0):t.player.setRotateDeg(90))}),t}return $(i,[{key:"afterCreate",value:function(){var e=this;ne(Q(i.prototype),"afterCreate",this).call(this);var n=this.config,r=this.playerConfig;if(!n.disable){n.target&&(this.playerConfig.fullscreenTarget=this.config.target);var s=_.getFullScreenEl();r.fullscreenTarget===s&&this.player.getFullscreen().catch(function(u){}),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:function(l){var c=e.player.fullscreen;e.emitUserAction(l,"switch_fullscreen",{prop:"fullscreen",from:c,to:!c})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(dt,function(u){var l=e.find(".xg-tips");l&&e.changeLangTextKey(l,u?e.i18nKeys.EXITFULLSCREEN_TIPS:e.i18nKeys.FULLSCREEN_TIPS),e.animate(u)}),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:du,options:{config:{onClick:function(l){e.handleFullscreen(l)}}}})),ae.device==="mobile"&&window.addEventListener("orientationchange",this._onOrientationChange)}}},{key:"registerIcons",value:function(){return{fullscreen:{icon:pu,class:"xg-get-fullscreen"},exitFullscreen:{icon:vu,class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){ne(Q(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",ae.device==="mobile"?"touchend":"click",this.handleFullscreen),ae.device==="mobile"&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}},{key:"toggleFullScreen",value:function(e){e&&(e.preventDefault(),e.stopPropagation());var n=this.player,r=this.config,s=r.useCssFullscreen===!0||typeof r.useCssFullscreen=="function"&&r.useCssFullscreen();s?(n.fullscreen?n.exitCssFullscreen():n.getCssFullscreen(),this.animate(n.fullscreen)):r.rotateFullscreen?(n.fullscreen?n.exitRotateFullscreen():n.getRotateFullscreen(),this.animate(n.fullscreen)):r.switchCallback&&typeof r.switchCallback=="function"?r.switchCallback(n.fullscreen):n.fullscreen?(n.exitFullscreen(),r.useScreenOrientation&&this.unlockScreen()):(n.getFullscreen().catch(function(u){}),r.useScreenOrientation&&n.aspectRatio>1&&this.lockScreen(r.lockOrientationType))}},{key:"animate",value:function(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"render",value:function(){if(!this.config.disable){var e="FULLSCREEN_TIPS";return`<xg-icon class="xgplayer-fullscreen">
    <div class="xgplayer-icon">
    </div>
    `.concat(kt(this,e,this.playerConfig.isHideTips),`
    </xg-icon>`)}}},{key:"lockScreen",value:function(e){try{screen.orientation.lock(e).catch(function(n){})}catch(n){}}},{key:"unlockScreen",value:function(){try{screen.orientation.unlock().catch(function(e){})}catch(e){}}}],[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,useScreenOrientation:!1,lockOrientationType:"landscape",switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}]),i}(zt),mu=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),e.isActiving=!1,e}return $(i,[{key:"duration",get:function(){var e=this.player,n=e.offsetDuration,r=e.duration;return this.playerConfig.customDuration||n||r}},{key:"currentTime",get:function(){var e=this.player,n=e.offsetCurrentTime,r=e.currentTime;return n>=0?n:r}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"afterCreate",value:function(){var e=this,n=this.player.controls.config.mode;this.mode=n==="flex"?"flex":"normal",!this.config.disable&&(this.mode==="flex"&&(this.createCenterTime(),this.root.style.display="none"),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.on([St,ct,Le],function(r){r.eventName==="durationchange"&&(e.isActiving=!1),e.onTimeUpdate()}),this.on(Lt,function(){e.onTimeUpdate(!0)}),this.on(Vt,function(){e.onReset()}))}},{key:"show",value:function(e){if(this.mode==="flex"){this.centerCurDom&&(this.centerCurDom.style.display="block"),this.centerDurDom&&(this.centerDurDom.style.display="block");return}this.root.style.display="block"}},{key:"hide",value:function(){if(this.mode==="flex"){this.centerCurDom&&(this.centerCurDom.style.display="none"),this.centerDurDom&&(this.centerDurDom.style.display="none");return}this.root.style.display="none"}},{key:"onTimeUpdate",value:function(e){var n=this.player,r=this.config,s=this.duration;if(!(r.disable||this.isActiving||!n.hasStart)){var u=this.currentTime+this.timeOffset;u=_.adjustTimeByDuration(u,s,e),this.mode==="flex"?(this.centerCurDom.innerHTML=this.minWidthTime(_.format(u)),s!==1/0&&s>0&&(this.centerDurDom.innerHTML=_.format(s))):(this.timeDom.innerHTML=this.minWidthTime(_.format(u)),s!==1/0&&s>0&&(this.durationDom.innerHTML=_.format(s)))}}},{key:"onReset",value:function(){this.mode==="flex"?(this.centerCurDom.innerHTML=this.minWidthTime(_.format(0)),this.centerDurDom.innerHTML=_.format(0)):(this.timeDom.innerHTML=this.minWidthTime(_.format(0)),this.durationDom.innerHTML=_.format(0))}},{key:"createCenterTime",value:function(){var e=this.player;if(!(!e.controls||!e.controls.center)){var n=e.controls.center;this.centerCurDom=_.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-left"),this.centerDurDom=_.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-right"),n.children.length>0?n.insertBefore(this.centerCurDom,n.children[0]):n.appendChild(this.centerCurDom),n.appendChild(this.centerDurDom)}}},{key:"afterPlayerInit",value:function(){var e=this.config;if(this.duration===1/0||this.playerConfig.isLive?(_.hide(this.durationDom),_.hide(this.timeDom),_.hide(this.find(".time-separator")),_.show(this.find(".time-live-tag"))):_.hide(this.find(".time-live-tag")),e.hide){this.hide();return}this.show()}},{key:"changeLiveState",value:function(e){e?(_.hide(this.durationDom),_.hide(this.timeDom),_.hide(this.find(".time-separator")),_.show(this.find(".time-live-tag"))):(_.hide(this.find(".time-live-tag")),_.show(this.find(".time-separator")),_.show(this.durationDom),_.show(this.timeDom))}},{key:"updateTime",value:function(e){if(this.isActiving=!0,!(!e&&e!==0||e>this.duration)){if(this.mode==="flex"){this.centerCurDom.innerHTML=this.minWidthTime(_.format(e));return}this.timeDom.innerHTML=this.minWidthTime(_.format(e))}}},{key:"minWidthTime",value:function(e){return e.split(":").map(function(n){return'<span class="time-min-width">'.concat(n,"</span>")}).join(":")}},{key:"resetActive",value:function(){var e=this,n=this.player,r=function(){e.isActiving=!1};this.off(ct,r),n.isSeeking&&n.media.seeking?this.once(ct,r):this.isActiving=!1}},{key:"destroy",value:function(){var e=this.player.controls.center;this.centerCurDom&&e.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&e.removeChild(this.centerDurDom),this.centerDurDom=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-time">
    <span class="time-current">00:00</span>
    <span class="time-separator">/</span>
    <span class="time-duration">00:00</span>
    <span class="time-live-tag">`.concat(this.i18n.LIVE_TIP,`</span>
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"time"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_LEFT,index:2,disable:!1}}}]),i}(ee),yu=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"_onDurationChange",function(){t.updateSegments();var s=t.player,u=s.currentTime,l=s.timeSegments;if(t._checkIfEnabled(l)){var c=_.getIndexByTime(u,l),f=_.getOffsetCurrentTime(u,l,c);t.player.offsetCurrentTime=f,t.changeIndex(c,l)}}),M(I(t),"_onLoadedData",function(){var s=t.player.timeSegments;if(t._checkIfEnabled(s)){var u=_.getOffsetCurrentTime(0,s);t.player.offsetCurrentTime=u,t.changeIndex(0,s),t.curPos.start>0&&(t.player.currentTime=t.curPos.start)}}),M(I(t),"_onTimeupdate",function(){var s=t.player,u=s.currentTime,l=s.timeSegments;if(t._checkIfEnabled(l)){var c=l.length;t.lastCurrentTime=u;var f=_.getIndexByTime(u,l);f!==t.curIndex&&t.changeIndex(f,l);var d=_.getOffsetCurrentTime(u,l,f);if(t.player.offsetCurrentTime=d,!!t.curPos){var v=t.curPos,h=v.start,p=v.end;u<h?t.player.currentTime=h:u>p&&f>=c-1&&t.player.pause()}}}),M(I(t),"_onSeeking",function(){var s=t.player,u=s.currentTime,l=s.timeSegments;if(t._checkIfEnabled(l))if(u<l[0].start)t.player.currentTime=l[0].start;else if(u>l[l.length-1].end)t.player.currentTime=l[l.length-1].end;else{var c=_.getIndexByTime(u,l);if(c>=0){var f=t.getSeekTime(u,t.lastCurrentTime,c,l);f>=0&&(t.player.currentTime=f)}}}),M(I(t),"_onPlay",function(){var s=t.player,u=s.currentTime,l=s.timeSegments;t._checkIfEnabled(l)&&u>=l[l.length-1].end&&(t.player.currentTime=l[0].start)}),t}return $(i,[{key:"afterCreate",value:function(){this.curIndex=-1,this.curPos=null,this.lastCurrentTime=0,this.updateSegments(),this.on(St,this._onDurationChange),this.on(yt,this._onLoadedData),this.on(Le,this._onTimeupdate),this.on(ki,this._onSeeking),this.on(Be,this._onPlay)}},{key:"setConfig",value:function(e){var n=this;if(e){var r=Object.keys(e);r.length<1||(r.forEach(function(s){n.config[s]=e[s]}),this.updateSegments())}}},{key:"updateSegments",value:function(){var e=this.config,n=e.disable,r=e.segments,s=this.player;if(n||!r||r.length===0)s.timeSegments=[],s.offsetDuration=0,s.offsetCurrentTime=-1;else{var u=this.formatTimeSegments(r,s.duration);s.timeSegments=u,s.offsetDuration=u.length>0?u[u.length-1].duration:0}}},{key:"formatTimeSegments",value:function(e,n){var r=[];return e?(e.sort(function(s,u){return s.start-u.start}),e.forEach(function(s,u){var l={};if(l.start=s.start<0?0:s.start,l.end=n>0&&s.end>n?n:s.end,!(n>0&&l.start>n)){r.push(l);var c=l.end-l.start;if(u===0)l.offset=s.start,l.cTime=0,l.segDuration=c,l.duration=c;else{var f=r[u-1];l.offset=f.offset+(l.start-f.end),l.cTime=f.duration+f.cTime,l.segDuration=c,l.duration=f.duration+c}}}),r):[]}},{key:"getSeekTime",value:function(e,n,r,s){var u=-1,l=s[r],c=l.start,f=l.end;if(e>=c&&e<=f)return u;var d=e-n;if(d<0&&e<c){var v=n>c?n-c:0;return u=r-1>=0?s[r-1].end+d+v:0,u}return-1}},{key:"_checkIfEnabled",value:function(e){return!(!e||e.length<1)}},{key:"changeIndex",value:function(e,n){this.curIndex=e,e>=0&&n.length>0?this.curPos=n[e]:this.curPos=null}}],[{key:"pluginName",get:function(){return"TimeSegmentsControls"}},{key:"defaultConfig",get:function(){return{disable:!0,segments:[]}}}]),i}(nt);function _u(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>
</svg>
`,"image/svg+xml").firstChild}function bu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>
</svg>
`,"image/svg+xml").firstChild}function Su(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>
</svg>
`,"image/svg+xml").firstChild}var ku=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"onBarMousedown",function(s){var u=I(t),l=u.player,c=t.find(".xgplayer-bar");_.event(s);var f=c.getBoundingClientRect(),d=_.getEventPos(s,l.zoom),v=f.height-(d.clientY-f.top);if(d.h=v,d.barH=f.height,t.pos=d,!(v<-2))return t.updateVolumePos(v,s),document.addEventListener("mouseup",t.onBarMouseUp),t._d.isStart=!0,!1}),M(I(t),"onBarMouseMove",function(s){var u=I(t),l=u._d;if(l.isStart){var c=I(t),f=c.pos,d=c.player;s.preventDefault(),s.stopPropagation(),_.event(s);var v=_.getEventPos(s,d.zoom);l.isMoving=!0;var h=f.h-v.clientY+f.clientY;h>f.barH||t.updateVolumePos(h,s)}}),M(I(t),"onBarMouseUp",function(s){_.event(s),document.removeEventListener("mouseup",t.onBarMouseUp);var u=I(t),l=u._d;l.isStart=!1,l.isMoving=!1}),M(I(t),"onMouseenter",function(s){t._d.isActive=!0,t.focus(),t.emit("icon_mouseenter",{pluginName:t.pluginName})}),M(I(t),"onMouseleave",function(s){t._d.isActive=!1,t.unFocus(100,!1,s),t.emit("icon_mouseleave",{pluginName:t.pluginName})}),M(I(t),"onVolumeChange",function(s){if(t.player){var u=t.player,l=u.muted,c=u.volume;t._d.isMoving||(t.find(".xgplayer-drag").style.height=l||c===0?"4px":"".concat(c*100,"%"),t.config.showValueLabel&&t.updateVolumeValue()),t.animate(l,c)}}),t}return $(i,[{key:"registerIcons",value:function(){return{volumeSmall:{icon:bu,class:"xg-volume-small"},volumeLarge:{icon:_u,class:"xg-volume"},volumeMuted:{icon:Su,class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var e=this;if(this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},!this.config.disable){this.initIcons();var n=this.playerConfig,r=n.commonStyle,s=n.volume;r.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=r.volumeColor),this.changeMutedHandler=this.hook("mutedChange",function(u){e.changeMuted(u)},{pre:function(l){l.preventDefault(),l.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),ae.device!=="mobile"&&this.playerConfig.isMobileSimulateMode!=="mobile"&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(Oa,this.onVolumeChange),this.once(yt,this.onVolumeChange),_.typeOf(s)!=="Number"&&(this.player.volume=this.config.default),this.onVolumeChange()}}},{key:"updateVolumePos",value:function(e,n){var r=this.player,s=this.find(".xgplayer-drag"),u=this.find(".xgplayer-bar");if(!(!u||!s)){var l=parseInt(e/u.getBoundingClientRect().height*1e3,10);s.style.height="".concat(e,"px");var c=Math.max(Math.min(l/1e3,1),0),f={volume:{from:r.volume,to:c}};r.muted&&(f.muted={from:!0,to:!1}),this.emitUserAction(n,"change_volume",{muted:r.muted,volume:r.volume,props:f}),r.volume=Math.max(Math.min(l/1e3,1),0),r.muted&&(r.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var e=this.player,n=e.volume,r=e.muted,s=this.find(".xgplayer-value-label"),u=Math.max(Math.min(n,1),0);s.innerText=r?0:Math.ceil(u*100)}},{key:"focus",value:function(){var e=this.player;e.focus({autoHide:!1}),this._timerId&&(_.clearTimeout(this,this._timerId),this._timerId=null),_.addClass(this.root,"slide-show")}},{key:"unFocus",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,s=arguments.length>2?arguments[2]:void 0,u=this._d,l=this.player;u.isActive||(this._timerId&&(_.clearTimeout(this,this._timerId),this._timerId=null),this._timerId=_.setTimeout(this,function(){u.isActive||(r?l.blur():l.focus(),_.removeClass(e.root,"slide-show"),u.isStart&&e.onBarMouseUp(s)),e._timerId=null},n))}},{key:"changeMuted",value:function(e){e&&e.stopPropagation();var n=this.player,r=this._d;r.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:n.muted,volume:n.volume,props:{muted:{from:n.muted,to:!n.muted}}}),n.volume>0&&(n.muted=!n.muted),n.volume<.01&&(n.volume=this.config.miniVolume)}},{key:"animate",value:function(e,n){e||n===0?this.setAttr("data-state","mute"):n<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}},{key:"destroy",value:function(){this._timerId&&(_.clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon",ae.device==="mobile"?"touchend":"click",this.changeMutedHandler)}},{key:"render",value:function(){if(!this.config.disable){var e=this.config.default||this.player.volume,n=this.config.showValueLabel;return`
    <xg-icon class="xgplayer-volume" data-state="normal">
      <div class="xgplayer-icon">
      </div>
      <xg-slider class="xgplayer-slider">
        `.concat(n?'<div class="xgplayer-value-label">'.concat(e*100,"</div>"):"",`
        <div class="xgplayer-bar">
          <xg-drag class="xgplayer-drag" style="height: `).concat(e*100,`%"></xg-drag>
        </div>
      </xg-slider>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}]),i}(ee);function Eu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">
  <g clip-path="url(#clip0)">
    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>
    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>
  </g>
  <defs>
    <clipPath id="clip0">
      <rect width="40" height="40" fill="white"/>
    </clipPath>
  </defs>
</svg>
`,"image/svg+xml").firstChild}var wu=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),e.rotateDeg=e.config.rotateDeg||0,e}return $(i,[{key:"afterCreate",value:function(){var e=this;if(!this.config.disable){ne(Q(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(_t,function(){e.rotateDeg&&e.config.innerRotate&&_.setTimeout(e,function(){e.updateRotateDeg(e.rotateDeg,e.config.innerRotate)},100)});var n=this.player.root;this.rootWidth=n.style.width||n.offsetWidth||n.clientWidth,this.rootHeight=n.style.height||n.offsetHeight||n.clientHeight,this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}}},{key:"destroy",value:function(){ne(Q(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(e,n){if(e||(e=0),n){this.player.videoRotateDeg=e;return}var r=this.player,s=this.rootWidth,u=this.rootHeight,l=r.root,c=r.innerContainer,f=r.media,d=l.offsetWidth,v=c&&n?c.offsetHeight:l.offsetHeight,h=s,p=u,g=0,y=0;(e===.75||e===.25)&&(h="".concat(v,"px"),p="".concat(d,"px"),g=-(v-d)/2,y=-(d-v)/2);var m="translate(".concat(g,"px,").concat(y,"px) rotate(").concat(e,"turn)"),b={transformOrigin:"center center",transform:m,webKitTransform:m,height:p,width:h},k=n?f:l,w=n?r.getPlugin("poster"):null;Object.keys(b).map(function(C){k.style[C]=b[C],w&&w.root&&(w.root.style[C]=b[C])})}},{key:"rotate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=this.player;this.rotateDeg||(this.rotateDeg=0);var u=e?1:-1;this.rotateDeg=(this.rotateDeg+1+u*.25*r)%1,this.updateRotateDeg(this.rotateDeg,n),s.emit(Ha,this.rotateDeg*360)}},{key:"registerIcons",value:function(){return{rotate:Eu}}},{key:"render",value:function(){if(!this.config.disable)return`
    <xg-icon class="xgplayer-rotate">
      <div class="xgplayer-icon">
      </div>
      `.concat(kt(this,"ROTATE_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),i}(zt);function Tu(){return new DOMParser().parseFromString(`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"
    fill="white" />
</svg>`,"image/svg+xml").firstChild}function Cu(){return new DOMParser().parseFromString(`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"
    fill="white" />
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"
    fill="white" />
</svg>`,"image/svg+xml").firstChild}var Zt={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"},xu=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"switchPIP",function(s){if(!t.isPIPAvailable())return!1;s.stopPropagation&&s.stopPropagation(),t.isPip?(t.exitPIP(),t.emitUserAction(s,"change_pip",{props:"pip",from:!0,to:!1}),t.setAttr("data-state","normal")):t.player.media.readyState===4&&(t.requestPIP(),t.emitUserAction(s,"change_pip",{props:"pip",from:!1,to:!0}),t.setAttr("data-state","pip"))}),t}return $(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.pip=="boolean"&&(e.config.showIcon=e.player.config.pip)}},{key:"afterCreate",value:function(){var e=this;this.isPIPAvailable()&&(ne(Q(i.prototype),"afterCreate",this).call(this),this.pMode=Zt.INLINE,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(hn,function(){e.config.showIcon&&(_.removeClass(e.find(".xgplayer-icon"),"xg-icon-disable"),e.bind("click",e.switchPIP))}))}},{key:"registerIcons",value:function(){return{pipIcon:{icon:Tu,class:"xg-get-pip"},pipIconExit:{icon:Cu,class:"xg-exit-pip"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.pipIcon),this.appendChild(".xgplayer-icon",e.pipIconExit)}},{key:"initPipEvents",value:function(){var e=this,n=this.player;this.leavePIPCallback=function(){var r=n.paused;_.setTimeout(e,function(){!r&&n.mediaPlay()},0),!r&&n.mediaPlay(),e.setAttr("data-state","normal"),e.pipWindow=null,n.emit(Kn,!1)},this.enterPIPCallback=function(r){n.emit(Kn,!0),r!=null&&r.pictureInPictureWindow&&(e.pipWindow=r.pictureInPictureWindow),e.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=function(r){var s=n.media.webkitPresentationMode;e.pMode===Zt.FULLSCREEN&&s!==Zt.FULLSCREEN&&n.onFullscreenChange(null,!1),e.pMode=s,s===Zt.PIP?e.enterPIPCallback(r):s===Zt.INLINE&&e.leavePIPCallback(r)},n.media&&(n.media.addEventListener("enterpictureinpicture",this.enterPIPCallback),n.media.addEventListener("leavepictureinpicture",this.leavePIPCallback),i.checkWebkitSetPresentationMode(n.media)&&n.media.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}},{key:"copyStyleIntoPiPWindow",value:function(e){var n=it(document.styleSheets).map(function(s){try{return it(s.cssRules).map(function(l){return l.cssText}).join("")}catch(l){var u=document.createElement("link");u.rel="stylesheet",u.type=s.type,u.media=s.media,u.href=s.href,e.document.head.appendChild(u)}return""}).filter(Boolean).join(`
`),r=document.createElement("style");r.textContent=n,e.document.head.appendChild(r)}},{key:"requestPIP",value:function(){var e=this,n=this.player,r=this.playerConfig,s=this.config;if(!(!this.isPIPAvailable()||this.isPip))try{var u=r.poster;if(u&&(n.media.poster=_.typeOf(u)==="String"?u:u.poster),s.preferDocument&&this.isDocPIPAvailable()){var l={};if(s.width&&s.height)l.width=s.width,l.height=s.height;else{var c=n.root.getBoundingClientRect();l.width=c.width,l.height=c.height}documentPictureInPicture.requestWindow(l).then(function(f){var d=s.docPiPNode,v=s.docPiPStyle;e.enterPIPCallback();var h=d||n.root,p=h.parentElement,g=h.previousSibling,y=h.nextSibling;e.copyStyleIntoPiPWindow(f);var m=document.createElement("style");if(m.append("body{padding:0; margin:0;}"),v){var b="";typeof v=="string"?b=v:typeof v=="function"&&(b=v.call(s)),b&&m.append(b)}else h===n.root&&m.append(`
              .xgplayer{width: 100%!important; height: 100%!important;}
            `);f.document.head.append(m),f.document.body.append(h),f.addEventListener("pagehide",function(k){p&&(y?p.insertBefore(h,y):g?p.insertBefore(h,g.nextSibling):p.appendChild(h)),e.leavePIPCallback()},{once:!0})})}else i.checkWebkitSetPresentationMode(n.media)?n.media.webkitSetPresentationMode("picture-in-picture"):n.media.requestPictureInPicture();return!0}catch(f){return console.error("requestPiP",f),!1}}},{key:"exitPIP",value:function(){var e=this.player;try{if(this.isPIPAvailable()&&this.isPip){var n;this.isDocPIPAvailable()&&(n=documentPictureInPicture)!==null&&n!==void 0&&n.window?documentPictureInPicture.window.close():i.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("inline"):document.exitPictureInPicture()}return!0}catch(r){return console.error("exitPIP",r),!1}}},{key:"isPip",get:function(){var e,n=this.player;return!!(this.isDocPIPAvailable()&&(e=documentPictureInPicture)!==null&&e!==void 0&&e.window)||document.pictureInPictureElement&&document.pictureInPictureElement===n.media||n.media.webkitPresentationMode===Zt.PIP}},{key:"isPIPAvailable",value:function(){var e=this.player.media,n=_.typeOf(document.pictureInPictureEnabled)==="Boolean"?document.pictureInPictureEnabled:!0;return n&&(_.typeOf(e.disablePictureInPicture)==="Boolean"&&!e.disablePictureInPicture||e.webkitSupportsPresentationMode&&_.typeOf(e.webkitSetPresentationMode)==="Function")||this.isDocPIPAvailable()}},{key:"isDocPIPAvailable",value:function(){return"documentPictureInPicture"in window&&/^(https|file)/.test(location.protocol)}},{key:"destroy",value:function(){ne(Q(i.prototype),"destroy",this).call(this);var e=this.player;e.media.removeEventListener("enterpictureinpicture",this.enterPIPCallback),e.media.removeEventListener("leavepictureinpicture",this.leavePIPCallback),i.checkWebkitSetPresentationMode(e.media)&&e.media.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}},{key:"render",value:function(){if(!(!this.config.showIcon||!this.isPIPAvailable()))return`<xg-icon class="xgplayer-pip">
      <div class="xgplayer-icon xg-icon-disable">
      </div>
      `.concat(kt(this,"PIP",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"pip"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:6,showIcon:!1,preferDocument:!1,width:void 0,height:void 0,docPiPNode:void 0,docPiPStyle:void 0}}},{key:"checkWebkitSetPresentationMode",value:function(e){return typeof e.webkitSetPresentationMode=="function"}}]),i}(zt);function Pu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">
  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>
</svg>
`,"image/svg+xml").firstChild}var Au=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),M(I(e),"playNext",function(n){var r=I(e),s=r.player;n.preventDefault(),n.stopPropagation(),e.idx+1<e.config.urlList.length?(e.idx++,e.nextHandler(e.config.urlList[e.idx],e.idx),s.emit(qi,e.idx+1)):(e.nextHandler(),s.emit(qi))}),e.idx=-1,e}return $(i,[{key:"afterCreate",value:function(){!this.config.urlList||this.config.urlList.length===0||(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:Pu}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var e=ae.device==="mobile"?"touchend":"click";this.bind(e,this.playNext),this.show()}},{key:"changeSrc",value:function(e){var n=this.player;e&&(n.pause(),n.currentTime=0,n.switchURL?n.switchURL(e):n.src=e,n.config.url=e,n.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(!(!this.config.urlList||this.config.urlList.length===0))return`
     <xg-icon class="xgplayer-playnext">
      <div class="xgplayer-icon">
      </div>
      `.concat(kt(this,"PLAYNEXT_TIPS",this.playerConfig.isHideTips),`
     </xg-icon>
    `)}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),i}(ee),ts={exports:{}};(function(a,o){(function(i,t){a.exports=t()})(Cs,function(){return function i(t,e,n){var r=window,s="application/octet-stream",u=n||s,l=t,c=!e&&!n&&l,f=document.createElement("a"),d=function(x){return String(x)},v=r.Blob||r.MozBlob||r.WebKitBlob||d,h=e||"download",p,g;if(v=v.call?v.bind(r):Blob,String(this)==="true"&&(l=[l,u],u=l[0],l=l[1]),c&&c.length<2048&&(h=c.split("/").pop().split("?")[0],f.href=c,f.href.indexOf(c)!==-1)){var y=new XMLHttpRequest;return y.open("GET",c,!0),y.responseType="blob",y.onload=function(x){i(x.target.response,h,s)},setTimeout(function(){y.send()},0),y}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(l))if(l.length>1024*1024*1.999&&v!==d)l=w(l),u=l.type||s;else return navigator.msSaveBlob?navigator.msSaveBlob(w(l),h):C(l);else if(/([\x80-\xff])/.test(l)){var m=0,b=new Uint8Array(l.length),k=b.length;for(m;m<k;++m)b[m]=l.charCodeAt(m);l=new v([b],{type:u})}p=l instanceof v?l:new v([l],{type:u});function w(x){var R=x.split(/[:;,]/),N=R[1],D=R[2]=="base64"?atob:decodeURIComponent,L=D(R.pop()),S=L.length,E=0,T=new Uint8Array(S);for(E;E<S;++E)T[E]=L.charCodeAt(E);return new v([T],{type:N})}function C(x,R){if("download"in f)return f.href=x,f.setAttribute("download",h),f.className="download-js-link",f.innerHTML="downloading...",f.style.display="none",document.body.appendChild(f),setTimeout(function(){f.click(),document.body.removeChild(f),R===!0&&setTimeout(function(){r.URL.revokeObjectURL(f.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(x)&&(x="data:"+x.replace(/^data:([\w\/\-\+]+)/,s)),window.open(x)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=x),!0;var N=document.createElement("iframe");document.body.appendChild(N),!R&&/^data:/.test(x)&&(x="data:"+x.replace(/^data:([\w\/\-\+]+)/,s)),N.src=x,setTimeout(function(){document.body.removeChild(N)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(p,h);if(r.URL)C(r.URL.createObjectURL(p),!0);else{if(typeof p=="string"||p.constructor===d)try{return C("data:"+u+";base64,"+r.btoa(p))}catch(x){return C("data:"+u+","+encodeURIComponent(p))}g=new FileReader,g.onload=function(x){C(this.result)},g.readAsDataURL(p)}return!0}})})(ts);var Iu=ts.exports;const Du=cn(Iu);function Ou(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">
  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">
      <g id="Group-2">
        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">
          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>
          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>
          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>
          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>
        </g>
      </g>
    </g>
  </g>
</svg>
`,"image/svg+xml").firstChild}var Lu=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),M(I(e),"download",function(n){if(!e.isLock){e.emitUserAction(n,"download");var r=e.playerConfig.url,s="";_.typeOf(r)==="String"?s=r:_.typeOf(r)==="Array"&&r.length>0&&(s=r[0].src);var u=e.getAbsoluteURL(s);Du(u),e.isLock=!0,e.timer=window.setTimeout(function(){e.isLock=!1,window.clearTimeout(e.timer),e.timer=null},300)}}),e.timer=null,e.isLock=!1,e}return $(i,[{key:"afterCreate",value:function(){ne(Q(i.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.appendChild(".xgplayer-icon",this.icons.download),this._handler=this.hook("click",this.download,{pre:function(n){n.preventDefault(),n.stopPropagation()}}),this.bind(["click","touchend"],this._handler))}},{key:"registerIcons",value:function(){return{download:Ou}}},{key:"getAbsoluteURL",value:function(e){if(!e.match(/^https?:\/\//)){var n=document.createElement("div");n.innerHTML='<a href="'.concat(e,'">x</a>'),e=n.firstChild.href}return e}},{key:"destroy",value:function(){ne(Q(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-download">
   <div class="xgplayer-icon">
   </div>
   `.concat(kt(this,"DOWNLOAD_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:3,disable:!0}}}]),i}(zt),Ru=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.screenShot=="boolean"&&(e.config.disable=!e.player.config.screenShot)}},{key:"afterCreate",value:function(){ne(Q(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var e=this.config;this.initSize=function(n){e.fitVideo&&(e.width=n.vWidth,e.height=n.vHeight)},this.once(_t,this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(e,n){var r=document.createElement("a");r.href=e,r.download=n;var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(s)}},{key:"createCanvas",value:function(e,n){var r=document.createElement("canvas"),s=r.getContext("2d");this.canvasCtx=s,this.canvas=r,r.width=e||this.config.width,r.height=n||this.config.height,s.imageSmoothingEnabled=!0,s.imageSmoothingEnabled&&(s.imageSmoothingQuality="high")}},{key:"onClickBtn",value:function(e){var n=this;e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot");var r=this.config;this.shot(r.width,r.height).then(function(s){n.emit(ja,s),r.saveImg&&n.saveScreenShot(s,r.name+r.format)})}},{key:"shot",value:function(e,n){var r=this,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{quality:.92,type:"image/png"},u=this.config,l=this.player,c=s.quality||u.quality,f=s.type||u.type;return new Promise(function(d,v){var h=null,p;if(l.media.canvas)h=l.media.canvas;else{r.canvas?(r.canvas.width=e||u.width,r.canvas.height=n||u.height):r.createCanvas(e,n),h=r.canvas,p=r.canvasCtx;var g=l.media.videoWidth/l.media.videoHeight,y=h.width/h.height,m=0,b=0,k=l.media.videoWidth,w=l.media.videoHeight,C,x,R,N;g>y?(R=h.width,N=h.width/g,C=0,x=Math.round((h.height-N)/2)):g===y?(R=h.width,N=h.height,C=0,x=0):g<y&&(R=h.height*g,N=h.height,C=Math.round((h.width-R)/2),x=0),p.drawImage(l.media,m,b,k,w,C,x,R,N)}var D=h.toDataURL(f,c).replace(f,"image/octet-stream");D=D.replace(/^data:image\/[^;]+/,"data:application/octet-stream"),d(D)})}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){ne(Q(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.onClickBtn),this.off(_t,this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",n="SCREENSHOT";return`
      <xg-icon class="xgplayer-shot">
      <div class="`.concat(e,`">
      `).concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[n],'">').concat(this.i18n[n],"</span>"),`
      </div>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,saveImg:!0,fitVideo:!0,disable:!1,name:"screenshot"}}}]),i}(zt),Mu=function(){function a(o){W(this,a),this.config=o.config,this.parent=o.root,this.root=_.createDom("ul","",{},"xg-options-list xg-list-slide-scroll ".concat(this.config.className)),o.root.appendChild(this.root);var i=this.config.maxHeight;i&&this.setStyle({maxHeight:i}),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var t=ae.device==="mobile"?"touchend":"click";this._delegates=ee.delegate.call(this,this.root,"li",t,this.onItemClick)}return $(a,[{key:"renderItemList",value:function(i){var t=this,e=this.config,n=this.root;i?e.data=i:i=e.data,e.style&&Object.keys(e.style).map(function(r){n.style[r]=e[r]}),i.length>0&&(this.attrKeys=Object.keys(i[0])),this.root.innerHTML="",i.map(function(r,s){var u=r.selected?"option-item selected":"option-item";r["data-index"]=s,t.root.appendChild(_.createDom("li","<span>".concat(r.showText,"</span>"),r,u))})}},{key:"onItemClick",value:function(i){i.delegateTarget||(i.delegateTarget=i.target);var t=i.delegateTarget;if(t&&_.hasClass(t,"selected"))return!1;var e=typeof this.config.onItemClick=="function"?this.config.onItemClick:null,n=this.root.querySelector(".selected");_.addClass(t,"selected"),n&&_.removeClass(n,"selected"),e(i,{from:n?this.getAttrObj(n,this.attrKeys):null,to:this.getAttrObj(t,this.attrKeys)})}},{key:"getAttrObj",value:function(i,t){if(!i||!t)return{};var e={};t.map(function(r){e[r]=i.getAttribute(r)});var n=i.getAttribute("data-index");return n&&(e.index=Number(n)),e}},{key:"show",value:function(){_.removeClass(this.root,"hide"),_.addClass(this.root,"active")}},{key:"hide",value:function(){_.removeClass(this.root,"active"),_.addClass(this.root,"hide")}},{key:"setStyle",value:function(i){var t=this;Object.keys(i).forEach(function(e){t.root.style[e]=i[e]})}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map(function(i){i.destroy&&i.destroy()}),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),a}(),at={SIDE:"side",MIDDLE:"middle"},Jt={CLICK:"click",HOVER:"hover"};function Nu(a,o){return a===at.SIDE?o===pe.CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""}var Di=ae.device==="mobile",en=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),M(I(e),"onEnter",function(n){n.stopPropagation(),e.emit("icon_mouseenter",{pluginName:e.pluginName}),e.switchActiveState(n)}),M(I(e),"switchActiveState",function(n){n.stopPropagation();var r=e.config.toggleMode;r===Jt.CLICK?e.toggle(!e.isActive):e.toggle(!0)}),M(I(e),"onLeave",function(n){n.stopPropagation(),e.emit("icon_mouseleave",{pluginName:e.pluginName}),e.config.listType!==at.SIDE&&e.isActive&&e.toggle(!1)}),M(I(e),"onListEnter",function(n){e.enterType=2}),M(I(e),"onListLeave",function(n){e.enterType=0,e.isActive&&e.toggle(!1)}),e.isIcons=!1,e.isActive=!1,e.curValue=null,e.curIndex=0,e}return $(i,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,n=this.config;this.initIcons(),Di&&n.listType!==at.MIDDLE&&(n.listType=at.SIDE),n.hidePortrait&&_.addClass(this.root,"portrait"),this.on([_t,dt],function(){e._resizeList()}),this.once(vt,function(){n.list&&n.list.length>0&&(e.renderItemList(n.list),e.show())}),Di&&this.on(or,function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)}),Di?(n.toggleMode=Jt.CLICK,this.activeEvent="touchend"):this.activeEvent=n.toggleMode===Jt.CLICK?"click":"mouseenter",n.toggleMode===Jt.CLICK?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}},{key:"initIcons",value:function(){var e=this,n=this.icons,r=Object.keys(n),s=!1;r.length>0&&(r.forEach(function(u){e.appendChild(".xgplayer-icon",n[u]),!s&&(s=n[u])}),this.isIcons=s),!s&&(this.appendChild(".xgplayer-icon",_.createDom("span","",{},"icon-text")),_.addClass(this.find(".xgplayer-icon"),"btn-text"))}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||_.addClass(this.root,"show")}},{key:"hide",value:function(){_.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,n,r){if(e===void 0)return"";var s=this.config.list;!r&&(r=this.player.lang),n=!n||_.isUndefined(e[n])?"text":n,typeof e=="number"&&(e=s[e]);try{return Re(e[n])==="object"?e[n][r]||e[n].en:e[n]}catch(u){return console.warn(u),""}}},{key:"toggle",value:function(e){if(e!==this.isActive){var n=this.player.controls,r=this.config.listType;e?(r===at.SIDE?n.blur():n.focus(),this.optionsList&&this.optionsList.show()):(r===at.SIDE?n.focus():n.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,n){e.stopPropagation();var r=this.config,s=r.listType,u=r.list;this.curIndex=n.to.index,this.curItem=u[this.curIndex],this.changeCurrentText();var l=this.config.isItemClickHide;(l||Di||s===at.SIDE)&&this.toggle(!1)}},{key:"onIconClick",value:function(e){}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,n=this.curIndex<e.length?this.curIndex:0,r=e[n];r&&(this.find(".icon-text").innerHTML=this.getTextByLang(r,"iconText"))}}},{key:"renderItemList",value:function(e,n){var r=this,s=this.config,u=this.optionsList,l=this.player;if(typeof n=="number"&&(this.curIndex=n,this.curItem=s.list[n]),u){u.renderItemList(e),this.changeCurrentText();return}var c={config:{data:e||[],className:Nu(s.listType,s.position),onItemClick:function(p,g){r.onItemClick(p,g)}},root:s.listType===at.SIDE?l.innerContainer||l.root:this.root};if(this.config.isShowIcon){var f=this.player.root.getBoundingClientRect(),d=f.height,v=s.listType===at.MIDDLE?d-50:d;v&&s.heightLimit&&(c.config.maxHeight="".concat(v,"px")),this.optionsList=new Mu(c),this.changeCurrentText(),this.show()}this._resizeList()}},{key:"_resizeList",value:function(){if(this.config.heightLimit){var e=this.player.root.getBoundingClientRect(),n=e.height,r=this.config.listType===at.MIDDLE?n-50:n;this.optionsList&&this.optionsList.setStyle({maxHeight:"".concat(r,"px")})}}},{key:"destroy",value:function(){var e=this.config;e.toggleMode===Jt.CLICK?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",`">
    <div class="xgplayer-icon">
    </div>
   </xg-icon>`)}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:100,list:[],listType:"middle",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:Jt.HOVER,heightLimit:!0}}}]),i}(ee),Bu=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),e.curTime=0,e.isPaused=!0,e}return $(i,[{key:"beforeCreate",value:function(e){var n=e.config.list;Array.isArray(n)&&n.length>0&&(e.config.list=n.map(function(r){return!r.text&&r.name&&(r.text=r.name),r.text||(r.text=r.definition),r}))}},{key:"afterCreate",value:function(){var e=this;ne(Q(i.prototype),"afterCreate",this).call(this),this.on("resourceReady",function(n){e.changeDefinitionList(n)}),this.on(cr,function(n){e.renderItemList(e.config.list,n.to)}),this.player.definitionList.length<2&&this.hide()}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||_.addClass(this.root,"show")}},{key:"initDefinition",value:function(){var e=this.config,n=e.list,r=e.defaultDefinition;if(n.length>0){var s=null;n.map(function(u){u.definition===r&&(s=u)}),s||(s=n[0]),this.changeDefinition(s)}}},{key:"renderItemList",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.list||[],r=arguments.length>1?arguments[1]:void 0,s=r&&r.definition?r.definition:this.config.defaultDefinition;r&&n.forEach(function(c){c.selected=!1});var u=0,l=n.map(function(c,f){var d=Se(Se({},c),{},{showText:e.getTextByLang(c)||c.definition,selected:!1});return(c.selected||c.definition&&c.definition==s)&&(d.selected=!0,u=f),d});ne(Q(i.prototype),"renderItemList",this).call(this,l,u)}},{key:"changeDefinitionList",value:function(e){Array.isArray(e)&&(this.config.list=e.map(function(n){return!n.text&&n.name&&(n.text=n.name),n.text||(n.text=n.definition),n}),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(e,n){this.player.changeDefinition(e,n)}},{key:"onItemClick",value:function(e,n){var r=this.player.definitionList;ne(Q(i.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(e,"change_definition",{from:n.from,to:n.to});for(var s=0;s<r.length;s++)n.to&&r[s].definition===n.to.definition&&(n.to.url=r[s].url),n.from&&r[s].definition===n.from.definition&&(n.from.url=r[s].url);this.player.changeDefinition(n.to,n.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return Se(Se({},en.defaultConfig),{},{position:pe.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0})}}]),i}(en),Fu=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),e.curRate=1,e}return $(i,[{key:"beforeCreate",value:function(e){var n=e.player.config.playbackRate,r=n?Array.isArray(n)?n:e.config.list:[];Array.isArray(r)&&(e.config.list=r.map(function(s){return typeof s=="number"?s={rate:s,text:"".concat(s,"x")}:!s.text&&s.rate&&(s.text="".concat(s.rate,"x")),s}))}},{key:"afterCreate",value:function(){var e=this;ne(Q(i.prototype),"afterCreate",this).call(this),this.on(La,function(){e.curValue!==e.player.playbackRate&&e.renderItemList()}),this.renderItemList()}},{key:"show",value:function(e){!this.config.list||this.config.list.length===0||ne(Q(i.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(e,n){ne(Q(i.prototype),"onItemClick",this).apply(this,arguments);var r=e.delegateTarget,s=Number(r.getAttribute("rate"));if(!s||s===this.curValue)return!1;var u={playbackRate:{from:this.player.playbackRate,to:s}};this.emitUserAction(e,"change_rate",{props:u}),this.curValue=s,this.player.playbackRate=s}},{key:"renderItemList",value:function(){var e=this,n=this.player.playbackRate||1;this.curValue=n;var r=-1,s=this.config.list.map(function(u,l){var c={rate:u.rate};return c.rate===n&&(c.selected=!0,r=l),c.showText=e.getTextByLang(u),c});ne(Q(i.prototype),"renderItemList",this).call(this,s,r)}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,n=this.curIndex<e.length?this.curIndex:0,r=e[n],s="";!r||this.curIndex<0?s="".concat(this.player.playbackRate,"x"):s=this.getTextByLang(r,"iconText"),this.find(".icon-text").innerHTML=s}}},{key:"destroy",value:function(){ne(Q(i.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return Se(Se({},en.defaultConfig),{},{position:pe.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1})}}]),i}(en);function Uu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">
  <path fill="#fff" transform="scale(1.3, 1.3)" class='path_full' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>
</svg>
`,"image/svg+xml").firstChild}function Hu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">
  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>
</svg>
`,"image/svg+xml").firstChild}var zr=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.cssFullscreen=="boolean"&&(e.config.disable=!e.player.config.cssFullscreen)}},{key:"afterCreate",value:function(){var e=this;ne(Q(i.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(Ki,function(n){e.animate(n)}),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:function(r){r.preventDefault(),r.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}},{key:"initIcons",value:function(){var e=this.icons,n=this.find(".xgplayer-icon");n.appendChild(e.cssFullscreen),n.appendChild(e.exitCssFullscreen)}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var n=this.player.isCssfullScreen;this.emitUserAction(e,"switch_cssfullscreen",{cssfullscreen:n}),n?this.player.exitCssFullscreen():this.player.getCssFullscreen()}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){var n=this.i18nKeys,r=this.find(".xg-tips");r&&this.changeLangTextKey(r,e?n.EXITCSSFULLSCREEN_TIPS:n.CSSFULLSCREEN_TIPS)}},{key:"registerIcons",value:function(){return{cssFullscreen:{icon:Uu,class:"xg-get-cssfull"},exitCssFullscreen:{icon:Hu,class:"xg-exit-cssfull"}}}},{key:"destroy",value:function(){ne(Q(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class='xgplayer-cssfullscreen'>
    <div class="xgplayer-icon">
    </div>
    `.concat(kt(this,"CSSFULLSCREEN_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"cssFullscreen"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:1,disable:!1,target:null}}}]),i}(zt),ju=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"afterCreate",value:function(){var e=this;this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:function(r){r.preventDefault(),r.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(fi,function(n){e.onError(n)})}},{key:"errorRetry",value:function(e){this.emitUserAction(e,"error_retry",{}),this.player.retry()}},{key:"handleError",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.player,r=e.errorType,s=n.errorNote?this.i18n[n.errorNote]:"";if(!s)switch(r){case"decoder":s=this.i18n.MEDIA_ERR_DECODE;break;case"network":s=this.i18n.MEDIA_ERR_NETWORK;break;default:s=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=s,this.find(".xgplayer-error-tips").innerHTML="".concat(this.i18n.REFRESH_TIPS,'<span class="xgplayer-error-refresh">').concat(this.i18n.REFRESH,"</span>")}},{key:"destroy",value:function(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}},{key:"render",value:function(){return`<xg-error class="xgplayer-error">
      <div class="xgplayer-errornote">
       <span class="xgplayer-error-text"></span>
       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>
      </div>
    </xg-error>`}}],[{key:"pluginName",get:function(){return"error"}}]),i}(ee),Vu=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"afterCreate",value:function(){var e=this;this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],function(n){(e.config.onClick||e.customOnClick)&&(n.preventDefault(),n.stopPropagation(),e.customOnClick?e.customOnClick(n):e.config.onClick(n))}),this.player.showPrompt=function(){e.showPrompt.apply(e,arguments)},this.player.hidePrompt=function(){e.hide()}}},{key:"setStyle",value:function(e){var n=this;Object.keys(e).map(function(r){n.root.style[r]=e[r]})}},{key:"showPrompt",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(e){this.customOnClick=s;var u=this.config.interval;this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),_.addClass(this.root,"show"),r.mode==="arrow"&&_.addClass(this.root,"arrow"),typeof e=="string"?this.find(".xgplayer-prompt-detail").innerHTML=e:this.find(".xgplayer-prompt-detail").innerHTML="".concat(e.text||"")+"".concat(e.highlight?'<i class="highlight">'.concat(e.highlight,"</i>"):""),r.style&&this.setStyle(r.style);var l=typeof r.autoHide=="boolean"?r.autoHide:this.config.autoHide;if(l){var c=r.interval||u;this.intervalId=setTimeout(function(){n.hide()},c)}}}},{key:"hide",value:function(){_.removeClass(this.root,"show"),_.removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}},{key:"render",value:function(){return'<xg-prompt class="xgplayer-prompt '.concat(H.CONTROLS_FOLLOW,`">
    <span class="xgplayer-prompt-detail"></span>
    </xg-prompt>`)}}],[{key:"pluginName",get:function(){return"prompt"}},{key:"defaultConfig",get:function(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:function(){}}}}]),i}(ee),Gr={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function is(a){Object.keys(Gr).map(function(o){a[o]===void 0&&(a[o]=Gr[o])})}var Wr={_updateDotDom:function(o,i){if(i){var t=this.calcuPosition(o.time,o.duration),e=o.style||{};e.left="".concat(t.left,"%"),e.width="".concat(t.width,"%"),i.setAttribute("data-text",o.text),i.setAttribute("data-time",o.time),t.isMini?_.addClass(i,"mini"):_.removeClass(i,"mini"),Object.keys(e).map(function(n){i.style[n]=e[n]})}},initDots:function(){var o=this;this._ispots.map(function(i){o.createDot(i,!1)}),this.ispotsInit=!0},createDot:function(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this.player.plugins.progress;if(t&&(i&&(is(o),this._ispots.push(o)),!(!this.ispotsInit&&i))){var e=this.calcuPosition(o.time,o.duration),n=o.style||{};n.left="".concat(e.left,"%"),n.width="".concat(e.width,"%");var r="xgspot_".concat(o.id," xgplayer-spot");e.isMini&&(r+=" mini");var s=o.template?'<div class="xgplayer-spot-pop">'.concat(o.template,"</div>"):"",u=_.createDom("xg-spot",s,{"data-text":o.text,"data-time":o.time,"data-id":o.id},r);Object.keys(n).map(function(l){u.style[l]=n[l]}),t.outer&&t.outer.appendChild(u),this.positionDot(u,o.id)}},findDot:function(o){if(this.player.plugins.progress){var i=this._ispots.filter(function(t,e){return t.id===o});return i.length>0?i[0]:null}},updateDot:function(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=this.player.plugins.progress;if(t){var e=this.findDot(o.id);if(e&&Object.keys(o).map(function(r){e[r]=o[r]}),!!this.ispotsInit){var n=t.find('xg-spot[data-id="'.concat(o.id,'"]'));n&&(this._updateDotDom(o,n),i&&this.showDot(o.id))}}},deleteDot:function(o){var i=this._ispots,t=this.player.plugins.progress;if(t){for(var e=[],n=0;n<i.length;n++)i[n].id===o&&e.push(n);for(var r=e.length,s=r-1;s>=0;s--)if(i.splice(e[s],1),this.ispotsInit){var u=t.find('xg-spot[data-id="'.concat(o,'"]'));u&&u.parentElement.removeChild(u)}}},deleteAllDots:function(){var o=this.player.plugins.progress;if(o){if(!this.ispotsInit){this._ispots=[];return}for(var i=o.root.getElementsByTagName("xg-spot"),t=i.length-1;t>=0;t--)o.outer.removeChild(i[t]);this._ispots=[]}},updateAllDots:function(){var o=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=this.player.plugins.progress;if(t){if(!this.ispotsInit){this._ispots=i;return}this._ispots=[];var e=t.root.getElementsByTagName("xg-spot"),n=e.length;if(n>i.length)for(var r=n-1;r>i.length-1;r--)t.outer.removeChild(e[r]);i.forEach(function(s,u){u<n?(e[u].setAttribute("data-id","".concat(s.id)),o._ispots.push(s),o.updateDot(s)):o.createDot(s)})}},positionDots:function(){var o=this,i=this._ispots,t=this.playerSize,e=this.player.sizeInfo,n=this.player.plugins.progress;!n||e.width===t.width||(t.width=e.width,t.left=e.left,i.forEach(function(r){var s=n.find('xg-spot[data-id="'.concat(r.id,'"]'));s&&o.positionDot(s,r.id)}))},positionDot:function(o,i){var t=_.findDom(o,".xgplayer-spot-pop");if(t){var e=this.playerSize,n=o.getBoundingClientRect(),r=t.getBoundingClientRect(),s=n.left-e.left,u=e.width-s-n.width/2;if(s<r.width/2||e.width<r.width){var l=r.width/2-s;t.style.left="".concat(l,"px")}else if(u<r.width/2){var c=u-r.width/2+n.width/2;t.style.left="".concat(c,"px")}else t.style.left="50%"}},updateDuration:function(){var o=this,i=this.player.plugins.progress;if(i){var t=this._ispots;t.forEach(function(e){var n=i.find('xg-spot[data-id="'.concat(e.id,'"]'));o._updateDotDom(e,n)})}},getAllDotsDom:function(){var o=this.player.plugins.progress;if(!o)return[];var i=o.root.getElementsByTagName("xg-spot");return i},getDotDom:function(o){var i=this.player.plugins.progress;if(i)return i.find('xg-spot[data-id="'.concat(o,'"]'))}};function zu(a){var o=a.config,i=a.player;Object.keys(Wr).map(function(e){a[e]=Wr[e].bind(a)});var t=i.config.progressDot||o.ispots||[];a._ispots=t.map(function(e){return is(e),e}),a.ispotsInit=!1,a.playerSize={left:i.sizeInfo.left,width:i.sizeInfo.width},a.on(St,function(){a.ispotsInit?a.updateDuration():a.initDots()}),a.on(_t,function(){a.positionDots()})}var Qt={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver",mouseenter:"onProgressMouseOver"},Gu=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),M(I(e),"onMousemove",function(n){if(!e.config.disable){if(_.hasClass(n.target,"xg-spot-content")&&e.config.isHideThumbnailHover){e.player.plugins.progress.onMouseLeave(n);return}(e._state.f||_.hasClass(n.target,"xg-spot-content"))&&(_.event(n),n.stopPropagation())}}),M(I(e),"onMousedown",function(n){e.config.disable||(e._state.f||_.hasClass(n.target,"xg-spot-content"))&&(_.event(n),n.stopPropagation())}),M(I(e),"onMouseup",function(n){if(e.isDrag){var r=e.player.plugins.progress;r&&r.pos&&(r.onMouseUp(n),!r.pos.isEnter&&r.onMouseLeave(n))}}),M(I(e),"onDotMouseLeave",function(n){if(!e.config.disable){e._curDot.removeEventListener("mouseleave",e.onDotMouseLeave),e.blurDot(n.target),e._curDot=null;var r=e.player.plugins.progress;r&&r.enableBlur(),e.show()}}),M(I(e),"onProgressMouseOver",function(n,r){if(!e.config.disable&&_.hasClass(r.target,"xgplayer-spot")&&!e._curDot){e._curDot=r.target,e.focusDot(r.target),e._curDot.children.length>0&&e.hide();var s=e.player.plugins.progress;s&&s.disableBlur(),e._curDot.addEventListener("mouseleave",e.onDotMouseLeave)}}),e._ispots=[],e.videoPreview=null,e.videothumbnail=null,e.thumbnail=null,e.timeStr="",e._state={now:0,f:!1},e}return $(i,[{key:"beforeCreate",value:function(e){var n=e.player.plugins.progress;n&&(e.root=n.root)}},{key:"afterCreate",value:function(){var e=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",function(n,r){r.seekTime&&e.player.seek(r.seekTime)}),this.transformTimeHook=this.hook("transformTime",function(n){e.setTimeContent(_.format(n))}),zu(this),this.on(St,function(){e.show()}),this.config.disable&&this.disable(),this.extTextRoot=this.find(".xg-spot-ext-text")}},{key:"setConfig",value:function(e){var n=this;e&&Object.keys(e).map(function(r){n.config[r]=e[r]})}},{key:"onPluginsReady",value:function(){var e=this.player;e.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var e=this,n=this.player.plugins.progress;if(n&&(Object.keys(Qt).map(function(s){e[Qt[s]]=e[Qt[s]].bind(e),n.addCallBack(s,e[Qt[s]])}),ae.device!=="mobile")){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);var r=this.hook("previewClick",function(){});this.handlerPreviewClick=function(s){s.stopPropagation(),r(parseInt(e._state.now*1e3,10)/1e3,s)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(e,n){this.config.disable||!this.player.duration||this.updatePosition(e.offset,e.width,e.currentTime,e.e)}},{key:"onProgressDragStart",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!0,this.videoPreview&&_.addClass(this.videoPreview,"show"))}},{key:"onProgressDragEnd",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!1,this.videoPreview&&_.removeClass(this.videoPreview,"show"))}},{key:"onProgressClick",value:function(e,n){this.config.disable||_.hasClass(n.target,"xgplayer-spot")&&(n.stopPropagation(),n.preventDefault(),["time","id","text"].map(function(r){e[r]=n.target.getAttribute("data-".concat(r))}),e.time&&(e.time=Number(e.time)),this.handlerSpotClick(n,e))}},{key:"updateLinePos",value:function(e,n){var r=this.root,s=this.previewLine,u=this.player,l=this.config,c=u.controls.mode,f=c==="flex",d=r.getBoundingClientRect().width;if(!(!d&&this._hasThumnail)){d=this._hasThumnail&&d<l.width?l.width:d;var v=e-d/2,h;v<0&&!f?(v=0,h=e-d/2):v>n-d&&!f?(h=v-(n-d),v=n-d):h=0,h!==void 0&&(s.style.transform="translateX(".concat(h.toFixed(2),"px)")),r.style.transform="translateX(".concat(v.toFixed(2),"px) translateZ(0)")}}},{key:"updateTimeText",value:function(e){var n=this.timeText,r=this.timePoint;n.innerHTML=e,!this.thumbnail&&(r.innerHTML=e)}},{key:"updatePosition",value:function(e,n,r,s){var u=this.root,l=this.config,c=this._state;if(u){c.now=r,this.transformTimeHook(r);var f=this.timeStr;s&&s.target&&_.hasClass(s.target,"xgplayer-spot")?(this.showTips(s.target.getAttribute("data-text"),!1,f),this.focusDot(s.target),c.f=!0,l.isFocusDots&&c.f&&(c.now=parseInt(s.target.getAttribute("data-time"),10))):l.defaultText?(c.f=!1,this.showTips(l.defaultText,!0,f)):(c.f=!1,this.hideTips("")),this.updateTimeText(f),this.updateThumbnails(c.now),this.updateLinePos(e,n)}}},{key:"setTimeContent",value:function(e){this.timeStr=e}},{key:"updateThumbnails",value:function(e){var n=this.player,r=this.videoPreview,s=this.config,u=n.plugins.thumbnail;if(u&&u.usable){this.thumbnail&&u.update(this.thumbnail,e,s.width,s.height);var l=r&&r.getBoundingClientRect();this.videothumbnail&&u.update(this.videothumbnail,e,l.width,l.height)}}},{key:"registerThumbnail",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ae.device!=="mobile"){var n=this.player,r=this.config,s=n.getPlugin("thumbnail");if(s&&s.setConfig(e),!s||!s.usable||!r.isShowThumbnail){_.addClass(this.root,"short-line no-thumbnail");return}else _.removeClass(this.root,"short-line no-thumbnail");r.mode==="short"&&_.addClass(this.root,"short-line"),this._hasThumnail=!0;var u=this.find(".xg-spot-thumbnail");this.thumbnail=s.createThumbnail(u,"progress-thumbnail"),r.isShowCoverPreview&&(this.videoPreview=_.createDom("xg-video-preview","",{},"xgvideo-preview"),n.root.appendChild(this.videoPreview),this.videothumbnail=s.createThumbnail(this.videoPreview,"xgvideo-thumbnail")),this.updateThumbnails(0)}}},{key:"calcuPosition",value:function(e,n){var r=this.player.plugins.progress,s=this.player,u=r.root.getBoundingClientRect().width,l=s.duration/u*6;return e+n>s.duration&&(n=s.duration-e),e/s.duration*100,n/s.duration,{left:e/s.duration*100,width:n/s.duration*100,isMini:n<l}}},{key:"showDot",value:function(e){var n=this.findDot(e);if(n){var r=this.root.getBoundingClientRect(),s=r.width,u=n.time/this.player.duration*s;this.updatePosition(u,s,n.time)}}},{key:"focusDot",value:function(e,n){e&&(n||(n=e.getAttribute("data-id")),_.addClass(e,"active"),this._activeDotId=n)}},{key:"blurDot",value:function(e){if(!e){var n=this._activeDotId;e=this.getDotDom(n)}e&&(_.removeClass(e,"active"),this._activeDotId=null)}},{key:"showTips",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";_.addClass(this.root,"no-timepoint"),e&&(_.addClass(this.find(".xg-spot-content"),"show-text"),n&&this.config.mode==="production"?(_.addClass(this.root,"product"),this.tipText.textContent=e):(_.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:"".concat(r," ").concat(e)))}},{key:"hideTips",value:function(){_.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",_.removeClass(this.find(".xg-spot-content"),"show-text"),_.removeClass(this.root,"product")}},{key:"hide",value:function(){_.addClass(this.root,"hide")}},{key:"show",value:function(e){_.removeClass(this.root,"hide")}},{key:"enable",value:function(){var e=this.config,n=this.playerConfig;this.config.disable=!1,this.show(),!this.thumbnail&&e.isShowThumbnail&&this.registerThumbnail(n.thumbnail||{})}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){var e=this,n=this.player.plugins.progress;n&&Object.keys(Qt).map(function(r){n.removeCallBack(r,e[Qt[r]])}),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return ae.device==="mobile"||this.playerConfig.isMobileSimulateMode==="mobile"?"":'<div class="xg-spot-info hide '.concat(this.config.mode==="short"?"short-line":"",`">
      <div class="xg-spot-content">
        <div class="xg-spot-thumbnail">
          <span class="xg-spot-time"></span>
        </div>
        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>
      </div>
      <div class="xgplayer-progress-point">00:00</div>
      <div class="xg-spot-ext-text"></div>
      <div class="xg-spot-line"></div>
    </div>`)}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isHideThumbnailHover:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1,width:160,height:90}}}]),i}(ee),Wu=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),e.ratio=1,e.interval=null,e._preloadMark={},e}return $(i,[{key:"afterCreate",value:function(){var e=this;this.usable&&this.initThumbnail(),this.on([St],function(){var n=e.config,r=n.pic_num,s=n.interval;e.usable&&(e.interval=s>0?s:Math.round(e.player.duration*1e3/r)/1e3)})}},{key:"setConfig",value:function(e){var n=this;if(e){var r=Object.keys(e);r.length<1||(r.forEach(function(s){n.config[s]=e[s]}),this.usable&&this.initThumbnail())}}},{key:"usable",get:function(){var e=this.config,n=e.urls,r=e.pic_num;return n&&n.length>0&&r>0}},{key:"initThumbnail",value:function(){var e=this.config,n=e.width,r=e.height,s=e.pic_num,u=e.interval;this.ratio=n/r*100,this.interval=u||Math.round(this.player.duration/s),this._preloadMark={}}},{key:"getUrlByIndex",value:function(e){return e>=0&&e<this.config.urls.length?this.config.urls[e]:""}},{key:"preload",value:function(e){var n=this;if(!this._preloadMark[e]){var r=this.config.urls,s=r.length,u=[];e>0&&u.push(e-1),u.push(e),e>0&&e<s-1&&u.push(e+1),u.map(function(l){!n._preloadMark[l]&&l>=0&&l<s&&(n._preloadMark[l]=1,_.preloadImg(r[l],function(){n._preloadMark[l]=2}))})}}},{key:"getPosition",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=this.config,u=s.pic_num,l=s.row,c=s.col,f=s.width,d=s.height;this.interval=Math.round(this.player.duration/u);var v=Math.ceil(e/this.interval);v=v>u?u:v;var h=v<l*c?0:Math.ceil(v/(l*c))-1,p=v-h*(c*l),g=p>0?Math.ceil(p/c)-1:0,y=p>0?p-g*c-1:0,m=0,b=0;if(n&&r){var k=n/r;k<f/d?(b=r,m=b*(f/d)):(m=n,b=m/(f/d))}else r?n||(b=r||d,m=b*(f/d)):(m=n||f,b=m/(f/d));var w=this.getUrlByIndex(h);return{urlIndex:h,rowIndex:g,colIndex:y,url:w,height:b,width:m,style:{backgroundImage:"url(".concat(w,")"),backgroundSize:"".concat(m*c,"px auto"),backgroundPosition:"-".concat(y*m,"px -").concat(g*b,"px"),width:"".concat(m,"px"),height:"".concat(b,"px")}}}},{key:"update",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",l=this.config,c=l.pic_num,f=l.urls;if(!(c<=0||!f||f.length===0)){var d=this.getPosition(n,r,s);this.preload(d.urlIndex),Object.keys(d.style).map(function(v){e.style[v]=d.style[v]}),Object.keys(u).map(function(v){e.style[v]=u[v]})}}},{key:"changeConfig",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setConfig(e)}},{key:"createThumbnail",value:function(e,n){var r=_.createDom("xg-thumbnail","",{},"thumbnail ".concat(n));return e&&e.appendChild(r),r}}],[{key:"pluginName",get:function(){return"thumbnail"}},{key:"defaultConfig",get:function(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,height:90,width:160,scale:1,className:"",hidePortrait:!1}}}]),i}(ee);function On(a){return a?"background:".concat(a,";"):""}var $u=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"onTimeupdate",function(){var s=t.player.ended,u=I(t),l=u.offsetDuration,c=t.currentTime;c=_.adjustTimeByDuration(c,l,s),t.update({played:c},l)}),t}return $(i,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"currentTime",get:function(){var e=this.player,n=e.offsetCurrentTime,r=e.currentTime;return n>=0?n:r}},{key:"afterCreate",value:function(){var e=this;this.root&&(this.on(Le,this.onTimeupdate),this.on(Vt,function(){e.reset()}))}},{key:"reset",value:function(){this.update({played:0,cached:0},0)}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cached:0,played:0},n=arguments.length>1?arguments[1]:void 0;!n||!this.root||(e.cached&&(this.find("xg-mini-progress-cache").style.width="".concat(e.cached/n*100,"%")),e.played&&(this.find("xg-mini-progress-played").style.width="".concat(e.played/n*100,"%")))}},{key:"render",value:function(){var e=this.playerConfig,n=e.commonStyle,r=e.miniprogress;if(r){var s=this.config,u=s.mode,l=s.height,c={cached:On(n.cachedColor),played:On(n.playedColor),progress:On(n.progressColor),height:l>0&&l!==2?"height: ".concat(l,"px;"):""},f=u==="show"?"xg-mini-progress-show":"";return'<xg-mini-progress class="xg-mini-progress '.concat(f,'" style="').concat(c.progress," ").concat(c.height,`">
    <xg-mini-progress-cache class="xg-mini-progress-cache" style="`).concat(c.cached,`"></xg-mini-progress-cache>
    <xg-mini-progress-played class="xg-mini-progress-played" style="`).concat(c.played,`"></xg-mini-progress-played>
    </xg-mini-progress>`)}}}],[{key:"pluginName",get:function(){return"MiniProgress"}},{key:"defaultConfig",get:function(){return{mode:"auto",height:2}}}]),i}(ee),ei={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",FRAME_RATE:"framerate",POSTER:"poster"};function Ku(){try{return parseInt(window.performance.now(),10)}catch(a){return new Date().getTime()}}function Yu(){try{var a=document.createElement("canvas").getContext;return!!a}catch(o){return!1}}var Oi=null,qu=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"onLoadedData",function(s){t.player&&(t._frameCount=t.config.startFrameCount,t.stop(),t.renderOnTimeupdate(s),t.off(Le,t.renderOnTimeupdate),t.on(Le,t.renderOnTimeupdate))}),M(I(t),"onVisibilitychange",function(s){document.visibilityState==="visible"?t._checkIfCanStart()&&t.start():document.visibilityState==="hidden"&&t.stop()}),M(I(t),"renderOnTimeupdate",function(s){if(t._frameCount>0)t.renderOnce(),t._frameCount--;else{t._isLoaded=!0,t.off(Le,t.renderOnTimeupdate);var u=t.config.startInterval;!t.player.paused&&t._checkIfCanStart()&&t.start(0,u)}}),M(I(t),"start",function(s,u){var l=t.player.video,c=Ku(),f=t.checkVideoIsSupport(l);!f||!t.canvasCtx||(u||(u=t.interval),t.stop(),l.videoWidth&&l.videoHeight&&(t.videoPI=l.videoHeight>0?parseInt(l.videoWidth/l.videoHeight*100,10):0,(t.config.mode===ei.REAL_TIME||c-t.preTime>=u)&&(l&&l.videoWidth&&t.update(f,t.videoPI),t.preTime=c)),t.frameId=t._loopType==="timer"?_.setTimeout(I(t),t.start,u):_.requestAnimationFrame(t.start))}),M(I(t),"stop",function(){t.frameId&&(t._loopType==="timer"?_.clearTimeout(I(t),t.frameId):_.cancelAnimationFrame(t.frameId),t.frameId=null)}),t}return $(i,[{key:"afterCreate",value:function(){var e=this;this.playerConfig.dynamicBg===!0&&(this.config.disable=!1),i.isSupport||(this.config.disable=!0);var n=this.config,r=n.disable,s=n.mode,u=n.frameRate;r||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/u,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this._loopType=this.config.mode!==ei.REAL_TIME&&this.interval>=1e3?"timer":"animation",this.once(hn,function(){e.player&&(e.init(),e.renderByPoster(),e.player.paused||e.start())}),s!==ei.POSTER&&(s!==ei.FIRST_FRAME&&(this.on(Vt,function(){e.stop()}),this.on(Be,function(){var l=e.config.startInterval;e._checkIfCanStart()&&e.start(0,l)}),this.on(jt,function(){e.stop()})),this.on(yt,this.onLoadedData),this.on(sr,function(){e._isLoaded=!1,e.stop()}),document.addEventListener("visibilitychange",this.onVisibilitychange)))}},{key:"setConfig",value:function(e){var n=this;Object.keys(e).forEach(function(r){r==="root"&&e[r]!==n.config[r]?n.reRender(e[r]):r==="frameRate"?n.interval=parseInt(1e3/e[r],10):r==="disable"&&e[r]&&n.stop(),n.config[r]=e[r]})}},{key:"init",value:function(e){var n=this.player,r=this.config;this.canvasFilter=i.supportCanvasFilter();try{var s=e||r.root;s||(s=r.isInnerRender&&n.innerContainer||n.root),s.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg" data-index="'.concat(r.index,`"><canvas>
        </canvas><xgmask></xgmask></div>`)),this.root=s.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=r.filter,this.canvas.style.webkitFilter=r.filter),this.mask=this.find("xgmask"),r.addMask&&(this.mask.style.background=r.maskBg),this.canvasCtx=this.canvas.getContext("2d")}catch(u){le.logError("plugin:DynamicBg",u)}}},{key:"reRender",value:function(e){var n=this.config.disable;if(!(!n&&!this.root)){this.stop();var r=this.root?this.root.parentElement:null;if(r!==e&&r.removeChild(this.root),!e){this.root=null;return}this.init(e),this.renderOnce();var s=this.config.startInterval;this._checkIfCanStart()&&this.start(0,s)}}},{key:"checkVideoIsSupport",value:function(e){if(!e)return null;var n=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(n&&!(ae.browser==="safari"&&_.isMSE(n)))return n;var r=n?n.tagName.toLowerCase():"";return r==="canvas"||r==="img"?n:null}},{key:"renderByPoster",value:function(){var e=this.playerConfig.poster;if(e){var n=_.typeOf(e)==="String"?e:_.typeOf(e.poster)==="String"?e.poster:null;this.updateImg(n)}}},{key:"_checkIfCanStart",value:function(){var e=this.config.mode;return this._isLoaded&&!this.player.paused&&e!==ei.FIRST_FRAME&&e!==ei.POSTER}},{key:"renderOnce",value:function(){var e=this.player.video;if(!(!e.videoWidth||!e.videoHeight)){this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);var n=this.checkVideoIsSupport(e);n&&this.update(n,this.videoPI)}}},{key:"updateImg",value:function(e){var n=this;if(e){var r=this.canvas.getBoundingClientRect(),s=r.width,u=r.height,l=new window.Image;l.onload=function(){if(!(!n.canvas||n.frameId||n.isStart)){n.canvas.height=u,n.canvas.width=s;var c=parseInt(s/u*100,10);n.update(l,c),l=null}},l.src=e}}},{key:"update",value:function(e,n){if(!(!this.canvas||!this.canvasCtx||!n))try{var r=this._pos,s=this.config,u=this.canvas.getBoundingClientRect(),l=u.width,c=u.height;if(l!==r.width||c!==r.height||r.pi!==n){var f=parseInt(l/c*100,10);r.pi=n,r.width!==l&&(r.width=this.canvas.width=l),r.height!==c&&(r.height=this.canvas.height=c);var d=c,v=l;f<n?v=parseInt(c*n/100,10):f>n&&(d=parseInt(l*100/n,10)),r.rwidth=v*s.multiple,r.rheight=d*s.multiple,r.x=(l-r.rwidth)/2,r.y=(c-r.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=s.filter),this.canvasCtx.drawImage(e,r.x,r.y,r.rwidth,r.rheight)}catch(h){le.logError("plugin:DynamicBg",h)}}},{key:"destroy",value:function(){this.stop(),document.removeEventListener("visibilitychange",this.onVisibilitychange),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,index:-1,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,startInterval:0,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return typeof Oi=="boolean"||(Oi=Yu()),Oi}},{key:"supportCanvasFilter",value:function(){return!(ae.browser==="safari"||ae.browser==="firefox")}}]),i}(ee),Xu={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:"视频下载错误"},mse:{code:2,msg:"流追加错误"},parse:{code:3,msg:"解析错误"},format:{code:4,msg:"格式错误"},decoder:{code:5,msg:"解码错误"},runtime:{code:6,msg:"语法错误"},timeout:{code:7,msg:"播放超时"},other:{code:8,msg:"其他错误"}},HAVE_NOTHING:"没有关于音频/视频是否就绪的信息",HAVE_METADATA:"音频/视频的元数据已就绪",HAVE_CURRENT_DATA:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒",HAVE_FUTURE_DATA:"当前及至少下一帧的数据是可用的",HAVE_ENOUGH_DATA:"可用数据足以开始播放",NETWORK_EMPTY:"音频/视频尚未初始化",NETWORK_IDLE:"音频/视频是活动的且已选取资源，但并未使用网络",NETWORK_LOADING:"浏览器正在下载数据",NETWORK_NO_SOURCE:"未找到音频/视频来源",MEDIA_ERR_ABORTED:"取回过程被用户中止",MEDIA_ERR_NETWORK:"网络错误",MEDIA_ERR_DECODE:"解码错误",MEDIA_ERR_SRC_NOT_SUPPORTED:"不支持的音频/视频格式",REPLAY:"重播",ERROR:"网络连接似乎出现了问题",PLAY_TIPS:"播放",PAUSE_TIPS:"暂停",PLAYNEXT_TIPS:"下一集",DOWNLOAD_TIPS:"下载",ROTATE_TIPS:"旋转",RELOAD_TIPS:"重新载入",FULLSCREEN_TIPS:"进入全屏",EXITFULLSCREEN_TIPS:"退出全屏",CSSFULLSCREEN_TIPS:"进入样式全屏",EXITCSSFULLSCREEN_TIPS:"退出样式全屏",TEXTTRACK:"字幕",PIP:"画中画",SCREENSHOT:"截图",LIVE:"正在直播",OFF:"关闭",OPEN:"开启",MINI_DRAG:"点击按住可拖动视频",MINISCREEN:"小屏幕",REFRESH_TIPS:"请试试",REFRESH:"刷新",FORWARD:"快进中",LIVE_TIP:"直播"}},di="info",Ln=Ya,Zu=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"_recordUserActions",function(s){var u=t._getTime(),l=Object.assign({},s,{msg:s.msg||s.action});t._stats[di].push(Se(Se({type:"userAction"},u),{},{payload:l}))}),M(I(t),"_onReset",function(){t.reset()}),M(I(t),"_recordInfo",function(s){t.info(s)}),M(I(t),"_downloadStats",function(){var s=t.getStats(),u=new Blob([JSON.stringify(s)],{type:"application/json"}),l=window.URL.createObjectURL(u),c=document.createElement("a");c.style.display="none",c.href=l,c.download="player.txt",c.disabled=!1,c.click()}),t}return $(i,[{key:"_getTime",value:function(){return{timestamp:Date.now(),timeFormat:new Date().toISOString()}}},{key:"afterCreate",value:function(){this.reset(),this.on(Xi,this._recordUserActions),this.on(Ln.STATS_INFO,this._recordInfo),this.on(Ln.STATS_DOWNLOAD,this._downloadStats),this.on(Ln.STATS_RESET,this._onReset)}},{key:"destroy",value:function(){this.offAll()}},{key:"downloadStats",value:function(){this._downloadStats()}},{key:"info",value:function(e){e.profile?this._infoProfile(e):this._info(e)}},{key:"_info",value:function(e){var n=this._getTime();this._stats[di].push(Se(Se({},n),{},{payload:e}))}},{key:"_infoProfile",value:function(e){if(e&&e.startMs){var n=Date.now(),r=n-e.startMs,s=Se({cat:"function",dur:r,name:e.name||e.msg,ph:"X",pid:0,tid:0,ts:e.startMs,profile:!0},e);this._info(s)}else console.warn("infoProfile need object data, include startMs")}},{key:"reset",value:function(){var e;this._stats=(e={},M(e,di,[]),M(e,"media",{}),e)}},{key:"getStats",value:function(){for(var e=this.player,n=e.media,r=[],s=0;s<n.buffered.length;s++)r.push({start:n.buffered.start(s),end:n.buffered.end(s)});var u={currentTime:n.currentTime,readyState:n.readyState,buffered:r,paused:n.paused,ended:n.ended};return this._stats.media=u,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}},{key:"_getTimeStats",value:function(){var e=this._stats[di],n=e.map(function(r){var s=r.payload.data,u="";try{s instanceof Error?u=s.msg:s!==void 0&&(u=JSON.stringify(s))}catch(l){console.log("err",l)}return"[".concat(r.timeFormat,"] : ").concat(r.payload.msg," ").concat(u," ")});return n}},{key:"_getProfile",value:function(){var e={traceEvents:[]},n=this._stats[di];return n.forEach(function(r){r.payload.profile&&e.traceEvents.push(r.payload)}),e}}],[{key:"pluginName",get:function(){return"stats"}},{key:"defaultConfig",get:function(){return{}}}]),i}(nt),ns=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"onGapJump",function(){var s=I(t),u=s.player,l=s.config;if(u.media.readyState!==HTMLMediaElement.HAVE_NOTHING){if(u.media.seeking){if(!t.seekingEventReceived)return}else t.seekingEventReceived=!1;if(!(u.media.paused&&u.media.currentTime!==0&&t.hasPlayed)){var c=u.media.buffered,f=l.smallGapLimit||.5,d=l.gapDetectionThreshold||.3,v=u.media.currentTime,h=t._getIndex(c,v,d);if(!(h===null||h===0)){console.log("GapJump  bufferRange ",c.start(h),c.end(h));var p=c.start(h)+.1,g=u.media.duration;if(!(p>g)){var y=p-v,m=y<=f;y<i.BROWSER_GAP_TOLERANCE||m&&(l.useGapJump!==!1&&(u.media.currentTime=t.isSafari?p+.1:p),t.player&&t.player.emit("detectGap"),console.log("gapJump gapIndex",h," isGapSamll:",m," currentTime:",u.media.currentTime," jumpSize:",v-u.media.currentTime),p!==.08&&u&&u.emit("log",{type:"oneevent",end_type:"gap",vid:u.config.vid,ext:{video_postion:Math.floor(p*1e3)}}))}}}}}),t}return $(i,[{key:"afterCreate",value:function(){var e=this,n=this.config.useGapJump;n!==!1&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(Ei,this.onGapJump),this.on(Be,function(){e.hasPlayed=!0}),this.on(ki,function(){e.seekingEventReceived=!0}))}},{key:"_getIndex",value:function(e,n,r){if(!e||!e.length||e.length===1&&e.end(0)-e.start(0)<1e-6)return null;for(var s=this._getBuffered(e),u=null,l=0;l<s.length;l++){var c=s[l];if(c.start>n&&(l===0||s[l-1].end-n<=r)){u=l;break}}return u}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var n=[],r=0;r<e.length;r++)n.push({start:e.start(r),end:e.end(r)});return n}}],[{key:"pluginName",get:function(){return"gapJump"}},{key:"defaultConfig",get:function(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}}]),i}(ee);ns.BROWSER_GAP_TOLERANCE=.001;var Ju=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"onWaiting",function(){var s=I(t),u=s.config;t.jumpCnt>u.jumpCntMax||t.timer||u.useWaitingTimeoutJump===!1||(t.timer=setTimeout(t.onJump,u.waitingTime*1e3))}),M(I(t),"onJump",function(){var s=I(t),u=s.player,l=s.config;if(clearTimeout(t.timer),t.timer=null,!(t.jumpCnt>l.jumpCntMax||l.useWaitingTimeoutJump===!1)&&!(u.media.paused&&u.media.currentTime!==0&&t.hasPlayed)){t.jumpSize=l.jumpSize*(t.jumpCnt+1),t.jumpCnt===l.jumpSize&&t.jumpSize<6&&(t.jumpSize=6);var c=u.currentTime+t.jumpSize,f=u.media.duration;c>f||(console.log("waitintTimeout, currentTime:",u.currentTime,", jumpTo:",c),t.jumpCnt++,u.currentTime=c)}}),t}return $(i,[{key:"afterCreate",value:function(){var e=this,n=this.config,r=n.useWaitingTimeoutJump,s=n.jumpSize;r!==!1&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=s,this.on(Ei,this.onWaiting),this.on([ar,vt],function(){clearTimeout(e.timer),e.timer=null,e.jumpSize=e.config.jumpSize}),this.on(Be,function(){e.hasPlayed=!0}))}}],[{key:"pluginName",get:function(){return"waitingTimeoutJump"}},{key:"defaultConfig",get:function(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}}]),i}(ee),ti="cdn",Li=["cdn"],Qu=function(a){X(i,a);var o=Z(i);function i(){var t;W(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),M(I(t),"getSpeed",function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ti;if(!t.speedListCache||!t.speedListCache[s]||t.speedListCache[s].length<=0)return 0;var u=0;return t.speedListCache[s].map(function(l){u+=l}),Math.floor(u/t.speedListCache[s].length)}),M(I(t),"startTimer",function(){_.isMSE(t.player.video)||(t.initSpeedList(),t.cnt=0,t.timer=setTimeout(t.testSpeed,t.config.testTimeStep))}),M(I(t),"initSpeedList",function(){t.speedListCache={},Li.forEach(function(s){t.speedListCache[s]=[]})}),M(I(t),"_onRealSpeedChange",function(s){s.speed&&t.appendList(s.speed,s.type||ti)}),M(I(t),"testSpeed",function(){if(clearTimeout(t.timer),t.timer=null,!(!t.player||!t.config.openSpeed)){var s=t.config,u=s.url,l=s.loadSize,c=s.testCnt,f=s.testTimeStep,d=u+(u.indexOf("?")<0?"?testst=":"&testst=")+Date.now();if(!(t.cnt>=c)){t.cnt++;try{var v=new Date().getTime(),h=null,p=new XMLHttpRequest;t.xhr=p,p.open("GET",d);var g={},y=Math.floor(Math.random()*10);g.Range="bytes="+y+"-"+(l+y),g&&Object.keys(g).forEach(function(m){p.setRequestHeader(m,g[m])}),p.onreadystatechange=function(){if(p.readyState===4){t.xhr=null,h=new Date().getTime();var m=p.getResponseHeader("Content-Length")/1024*8,b=Math.round(m*1e3/(h-v));t.appendList(b),t.timer=setTimeout(t.testSpeed,f)}},p.send()}catch(m){console.error(m)}}}}),M(I(t),"appendList",function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ti;if(!(!t.speedListCache||!t.speedListCache[u])){var l=t.config.saveSpeedMax;t.speedListCache[u].length>=l&&t.speedListCache[u].shift(),t.speedListCache[u].push(s);var c=I(t),f=c.player;f&&(u===ti?f.realTimeSpeed=s:f[t.getSpeedName("realTime",u)]=s),t.updateSpeed(u)}}),M(I(t),"updateSpeed",function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ti,u=t.getSpeed(s),l=I(t),c=l.player;if(c)if(s===ti)(!c.avgSpeed||u!==c.avgSpeed)&&(c.avgSpeed=u,c.emit(Wn,{speed:u,realTimeSpeed:c.realTimeSpeed}));else{var f=t.getSpeedName("avg",s);(!c[f]||u!==c[f])&&(c[f]=u,c.emit(Wn,{speed:u,realTimeSpeed:c.realTimeSpeed}))}}),t}return $(i,[{key:"afterCreate",value:function(){var e=this.config,n=e.openSpeed,r=e.addSpeedTypeList;(r==null?void 0:r.length)>0&&Li.push.apply(Li,it(r)),this.initSpeedList(),this.on("real_time_speed",this._onRealSpeedChange),this.timer=null,this.cnt=0,this.xhr=null,n&&this.on([yt,$i],this.startTimer)}},{key:"getSpeedName",value:function(e,n){return e+"Speed"+n.toUpperCase()}},{key:"openSpeed",get:function(){return this.config.openSpeed},set:function(e){if(this.config.openSpeed=e,!e&&this.timer){clearTimeout(this.timer),this.timer=null;return}if(this.config.openSpeed){if(this.timer)return;this.timer=setTimeout(this.testSpeed,this.config.testTimeStep)}}},{key:"destroy",value:function(){var e=this;this.off("real_time_speed",this._onRealSpeedChange),this.off([yt,$i],this.startTimer),Li.forEach(function(n){e.speedListCache&&e.speedListCache[n]&&(e.speedListCache[n]=[])}),this.speedListCache&&(this.speedListCache={}),clearTimeout(this.timer),this.timer=null,this.xhr&&this.xhr.readyState!==4&&(this.xhr.cancel&&this.xhr.cancel(),this.xhr=null)}}],[{key:"pluginName",get:function(){return"testspeed"}},{key:"defaultConfig",get:function(){return{openSpeed:!1,testCnt:3,loadSize:200*1024,testTimeStep:3e3,url:"",saveSpeedMax:5,addSpeedTypeList:[]}}}]),i}(ee),el=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"afterCreate",value:function(){var e=this,n=this.player,r=this.config,s=n.media||n.video;if(this.timer=null,this._lastDecodedFrames=0,this._currentStuckCount=0,this._lastCheckPoint=null,this._payload=[],!r.disabled){var u=s.getVideoPlaybackQuality;u&&(this.on(Be,function(){e._startTick()}),this.on(jt,function(){e._stopTick()}),this.on(Lt,function(){e._stopTick()}),this.on(Vt,function(){e._stopTick()}))}}},{key:"_startTick",value:function(){var e=this;this._stopTick(),this._timer=setTimeout(function(){e._checkDecodeFPS(),e._startTick()},this.config.tick)}},{key:"_stopTick",value:function(){clearTimeout(this._timer),this._timer=null}},{key:"_checkBuffer",value:function(e,n){for(var r=!1,s=[],u=0;u<n.length;u++){var l=n.start(u),c=n.end(u);if(s.push({start:l,end:c}),l<=e&&e<=c-1){r=!0;break}}return{enoughBuffer:r,buffers:s}}},{key:"_checkStuck",value:function(e,n,r,s){var u=this.player.media||this.player.video,l=document.hidden,c=u.paused,f=u.readyState,d=u.currentTime,v=u.buffered;if(!(l||c||f<4)){var h=this._checkBuffer(d,v),p=h.enoughBuffer,g=h.buffers;p&&(e<=this.config.reportFrame?(this._currentStuckCount++,this._payload.push({currentTime:d,buffers:g,curDecodedFrames:e,totalVideoFrames:n,droppedVideoFrames:r,checkInterval:s}),this._currentStuckCount>=this.config.stuckCount&&(this.emit(qa,this._payload),this._reset())):this._reset())}}},{key:"_reset",value:function(){this._payload=[],this._currentStuckCount=0}},{key:"_checkDecodeFPS",value:function(){var e=this.player.media||this.player.video;if(e){var n=e.getVideoPlaybackQuality(),r=n.totalVideoFrames,s=n.droppedVideoFrames,u=performance.now();if(r&&this._lastCheckPoint){var l=r-this._lastDecodedFrames,c=u-this._lastCheckPoint;this._checkStuck(l,r,s,c)}this._lastDecodedFrames=r,this._lastCheckPoint=u}}},{key:"destroy",value:function(){this._stopTick()}}],[{key:"pluginName",get:function(){return"FpsDetect"}},{key:"defaultConfig",get:function(){return{disabled:!1,tick:1e3,stuckCount:3,reportFrame:0}}}]),i}(ee);ri.use(Xu);var tl=$(function a(o,i){var t,e,n;W(this,a);var r=i&&i.isMobileSimulateMode==="mobile",s=i.isLive,u=s?[]:[yu,cu,$u,Gu,mu],l=[].concat(u,[fu,gu,wu,Au,Bu,Fu,Lu,Ru,ku,xu]),c=[Go,Wo,Ko,ou,Yo,ju,Vu,Wu,Jo];this.plugins=[Zu,Vo].concat(it(l),c,[ns,Ju]);var f=r?"mobile":ae.device;switch(f){case"pc":(t=this.plugins).push.apply(t,[jr,In,zr,Qu,el]);break;case"mobile":(e=this.plugins).push.apply(e,[ru]);break;default:(n=this.plugins).push.apply(n,[jr,In,zr])}(ae.os.isIpad||f==="pc")&&this.plugins.push(qu),ae.os.isIpad&&this.plugins.push(In),this.ignores=[],this.i18n=[]}),rt=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i)}(vn);M(rt,"defaultPreset",tl);M(rt,"Util",_);M(rt,"Sniffer",ae);M(rt,"Errors",gi);M(rt,"Events",go);M(rt,"Plugin",ee);M(rt,"BasePlugin",nt);M(rt,"I18N",ri);M(rt,"STATE_CLASS",H);M(rt,"InstManager",Qa);var rs={exports:{}};/*! Built @Thu, 14 Sep 2023 04:46:00 GMT */(function(a,o){(function(i,t){a.exports=t()})(window,function(){return function(i){var t={};function e(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return i[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=i,e.c=t,e.d=function(n,r,s){e.o(n,r)||Object.defineProperty(n,r,{enumerable:!0,get:s})},e.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,r){if(1&r&&(n=e(n)),8&r||4&r&&typeof n=="object"&&n&&n.__esModule)return n;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:n}),2&r&&typeof n!="string")for(var u in n)e.d(s,u,function(l){return n[l]}.bind(null,u));return s},e.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(r,"a",r),r},e.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)},e.p="",e(e.s=5)}([function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.createDom=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"div",c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",v=document.createElement(l);return v.className=d,v.innerHTML=c,Object.keys(f).forEach(function(h){var p=h,g=f[h];l==="video"||l==="audio"?g&&v.setAttribute(p,g):v.setAttribute(p,g)}),v},t.hasClass=n,t.addClass=r,t.removeClass=s,t.toggleClass=function(l,c){c.split(/\s+/g).forEach(function(f){n(l,f)?s(l,f):r(l,f)})},t.findDom=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document,c=arguments[1],f=void 0;try{f=l.querySelector(c)}catch(d){c.startsWith("#")&&(f=l.getElementById(c.slice(1)))}return f},t.deepCopy=function l(c,f){if(u(f)==="Object"&&u(c)==="Object")return Object.keys(f).forEach(function(d){u(f[d])!=="Object"||f[d]instanceof Node?u(f[d])==="Array"?c[d]=u(c[d])==="Array"?c[d].concat(f[d]):f[d]:c[d]=f[d]:c[d]?l(c[d],f[d]):c[d]=f[d]}),c},t.typeOf=u,t.copyDom=function(l){if(l&&l.nodeType===1){var c=document.createElement(l.tagName);return Array.prototype.forEach.call(l.attributes,function(f){c.setAttribute(f.name,f.value)}),l.innerHTML&&(c.innerHTML=l.innerHTML),c}return""},t.attachEventListener=function(l,c,f,d){d?(l.on(c,f),function(v,h,p,g){v.once(g,function y(){v.off(h,p),v.off(g,y)})}(l,c,f,d)):l.on(c,function v(h){f(h),l.off(c,v)})},t.styleUtil=function(l,c,f){var d=l.style;try{d[c]=f}catch(v){d.setProperty(c,f)}},t.styleCSSText=function(l,c){var f=l.style;try{f.cssText=c}catch(d){}},t.isNumber=function(l){return typeof l=="number"&&!Number.isNaN(l)},t.isFunction=function(l){return typeof l=="function"},t.throttle=function(l,c){var f=this,d=0;return function(){for(var v=arguments.length,h=Array(v),p=0;p<v;p++)h[p]=arguments[p];clearTimeout(d),d=setTimeout(function(){return l.apply(f,h)},c)}},t.hasOwnProperty=Object.prototype.hasOwnProperty;function n(l,c){return l.classList?Array.prototype.some.call(l.classList,function(f){return f===c}):!!l.className.match(new RegExp("(\\s|^)"+c+"(\\s|$)"))}function r(l,c){l.classList?c.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(f){f&&l.classList.add(f)}):n(l,c)||(l.className+=" "+c)}function s(l,c){l.classList?c.split(/\s+/g).forEach(function(f){l.classList.remove(f)}):n(l,c)&&c.split(/\s+/g).forEach(function(f){var d=new RegExp("(\\s|^)"+f+"(\\s|$)");l.className=l.className.replace(d," ")})}function u(l){return Object.prototype.toString.call(l).match(/([^\s.*]+)(?=]$)/g)[0]}},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function c(f,d){for(var v=0;v<d.length;v++){var h=d[v];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(f,h.key,h)}}return function(f,d,v){return d&&c(f.prototype,d),v&&c(f,v),f}}(),s=e(4),u=(n=s)&&n.__esModule?n:{default:n},l=function(){function c(){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,c)}return r(c,[{key:"setLogger",value:function(f){this.logger=f instanceof u.default?f:new u.default((f||"")+".js")}}]),c}();t.default=l,i.exports=t.default},function(i,t,e){var n=e(19)();i.exports=function(r){return r!==n&&r!==null}},function(i,t,e){i.exports=function(n){return n!=null}},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function u(l,c){for(var f=0;f<c.length;f++){var d=c[f];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(l,d.key,d)}}return function(l,c,f){return c&&u(l.prototype,c),f&&u(l,f),l}}(),r=typeof window<"u"&&window.location.href.indexOf("danmu-debug")>-1,s=function(){function u(l){(function(c,f){if(!(c instanceof f))throw new TypeError("Cannot call a class as a function")})(this,u),this.constructorName=l||""}return n(u,[{key:"info",value:function(l){for(var c,f=arguments.length,d=Array(f>1?f-1:0),v=1;v<f;v++)d[v-1]=arguments[v];r&&(c=console).log.apply(c,["[Danmu Log]["+this.constructorName+"]",l].concat(d))}}]),u}();t.default=s,i.exports=t.default},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0});var n,r=e(6),s=(n=r)&&n.__esModule?n:{default:n};e(34),t.default=s.default,i.exports=t.default},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.DanmuJs=void 0;var n=function(){function g(y,m){for(var b=0;b<m.length;b++){var k=m[b];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(y,k.key,k)}}return function(y,m,b){return m&&g(y.prototype,m),b&&g(y,b),y}}(),r=v(e(7)),s=e(26),u=v(e(1)),l=v(e(27)),c=v(e(32)),f=e(33),d=e(0);function v(g){return g&&g.__esModule?g:{default:g}}function h(g,y){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!y||typeof y!="object"&&typeof y!="function"?g:y}var p=t.DanmuJs=function(g){function y(m){(function(C,x){if(!(C instanceof x))throw new TypeError("Cannot call a class as a function")})(this,y);var b=h(this,(y.__proto__||Object.getPrototypeOf(y)).call(this));b.setLogger("danmu"),b.logger&&b.logger.info("danmu.js version: "+s.version);var k=b.config={overlap:!1,area:{start:0,end:1,lines:void 0},hooks:void 0,live:!1,comments:[],direction:"r2l",needResizeObserver:!1,dropStaleComments:!1,channelSize:void 0,maxCommentsLength:void 0,bulletOffset:void 0,interval:2e3,highScorePriority:!0,chaseEffect:!0};if((0,d.deepCopy)(k,m),(0,r.default)(b),b.globalHooks={},k.hooks&&b.hooks(k.hooks),b.hideArr=[],b.recycler=new c.default,b.freezeId=null,k.comments.forEach(function(C){C.duration=C.duration?C.duration:5e3,C.mode||(C.mode="scroll")}),b.container=k.container&&k.container.nodeType===1?k.container:null,!b.container)return b.emit("error","container id can't be empty"),h(b,!1);if(k.containerStyle){var w=k.containerStyle;Object.keys(w).forEach(function(C){b.container.style[C]=w[C]})}return(0,d.addClass)(b.container,"danmu"),b.live=k.live,b.player=k.player,b.direction=k.direction,b.bulletBtn=new l.default(b),b.main=b.bulletBtn.main,b.isReady=!0,b.emit("ready"),b.logger&&b.logger.info("ready"),b.addResizeObserver(),b}return function(m,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof b);m.prototype=Object.create(b&&b.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(m,b):m.__proto__=b)}(y,g),n(y,[{key:"hooks",value:function(m){(0,d.deepCopy)(this.globalHooks,m)}},{key:"addResizeObserver",value:function(){var m=this;this.config.needResizeObserver&&this.container&&(0,f.addObserver)(this.container,function(){m.logger&&m.logger.info("needResizeObserver"),m.resize()})}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this.main&&this.main.start()}},{key:"pause",value:function(){this.logger&&this.logger.info("pause"),this.main&&this.main.pause()}},{key:"play",value:function(){this.logger&&this.logger.info("play"),this.main&&this.main.play()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this.main&&this.main.stop()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.main&&this.main.clear()}},{key:"destroy",value:function(){for(var m in(0,f.unObserver)(this.container),this.logger&&this.logger.info("destroy"),this.stop(),this.bulletBtn&&this.bulletBtn.destroy(),this.recycler&&this.recycler.destroy(),this)delete this[m];this.emit("destroy")}},{key:"sendComment",value:function(m){var b=this.main,k=this.logger;k&&k.info("sendComment: "+(m.txt||"[DOM Element]")),b&&(m.duration||(m.duration=15e3),m&&m.id&&m.duration&&(m.el||m.elLazyInit||m.txt)&&(m.duration=m.duration?m.duration:5e3,m.style||(m.style={opacity:void 0,fontSize:void 0}),m.style&&(this.opacity&&this.opacity!==m.style.opacity&&(m.style.opacity=this.opacity),this.fontSize&&this.fontSize!==m.style.fontSize&&(m.style.fontSize=this.fontSize)),m.prior||m.realTime?(b.data.unshift(m),m.realTime&&(b.readData(),b.dataHandle())):b.data.push(m),b.sortData(),b.keepPoolWatermark()))}},{key:"setCommentID",value:function(m,b){var k=this;this.logger&&this.logger.info("setCommentID: oldID "+m+" newID "+b),m&&b&&(this.main.data.some(function(w){return w.id===m&&(w.id=b,!0)}),this.main.queue.some(function(w){return w.id===m&&(w.id=b,w.pauseMove(),k.main.status!=="paused"&&w.startMove(),!0)}))}},{key:"setCommentDuration",value:function(m,b){var k=this;this.logger&&this.logger.info("setCommentDuration: id "+m+" duration "+b),m&&b&&(b=b||5e3,this.main.data.some(function(w){return w.id===m&&(w.duration=b,!0)}),this.main.queue.some(function(w){return w.id===m&&(w.duration=b,w.pauseMove(),k.main.status!=="paused"&&w.startMove(),!0)}))}},{key:"setCommentLike",value:function(m,b){this.logger&&this.logger.info("setCommentLike: id "+m+" like "+b),m&&b&&(this.main.data.some(function(k){return k.id===m&&(k.like=b,!0)}),this.main.queue.some(function(k){return k.id===m&&(k.pauseMove(),k.setLikeDom(b.el,b.style),k.danmu.main.status!=="paused"&&k.startMove(),!0)}))}},{key:"restartComment",value:function(m){if(this.logger&&this.logger.info("restartComment: id "+m),m){var b=this.main;if(this._releaseCtrl(m),b.status==="closed")return;b.queue.some(function(k){return k.id===m&&(b.status!=="paused"?k.startMove(!0):k.status="paused",!0)})}}},{key:"_releaseCtrl",value:function(m){this.freezeId&&m===this.freezeId&&(this.mouseControl=!1,this.freezeId=null)}},{key:"_freezeCtrl",value:function(m){this.mouseControl=!0,this.freezeId=m}},{key:"freezeComment",value:function(m){this.logger&&this.logger.info("freezeComment: id "+m),m&&(this._freezeCtrl(m),this.main.queue.some(function(b){return b.id===m&&(b.status="forcedPause",b.pauseMove(),b.el&&b.el.style&&(0,d.styleUtil)(b.el,"zIndex",10),!0)}))}},{key:"removeComment",value:function(m){if(this.logger&&this.logger.info("removeComment: id "+m),m){var b=this.main;this._releaseCtrl(m),b.queue=b.queue.filter(function(k){return k.id!==m||(k.remove(),!1)}),b.data=b.data.filter(function(k){return k.id!==m})}}},{key:"updateComments",value:function(m){var b=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this.logger&&this.logger.info("updateComments: "+m.length+", isClear "+b);var k=this.main;typeof b=="boolean"&&b&&(k.data=[]),k.data=k.data.concat(m),k.sortData(),k.keepPoolWatermark()}},{key:"setAllDuration",value:function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"scroll",b=this,k=arguments[1],w=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];this.logger&&this.logger.info("setAllDuration: mode "+m+" duration "+k+" force "+w),k&&(k=k||5e3,w&&(this.main.forceDuration=k),this.main.data.forEach(function(C){m===C.mode&&(C.duration=k)}),this.main.queue.forEach(function(C){m===C.mode&&(C.duration=k,C.pauseMove(),b.main.status!=="paused"&&C.startMove())}))}},{key:"setPlayRate",value:function(){var m=this,b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"scroll",k=arguments[1];this.logger&&this.logger.info("setPlayRate: "+k),(0,d.isNumber)(k)&&k>0&&(this.main.playRate=k,this.main.queue.forEach(function(w){b===w.mode&&(w.pauseMove(),m.main.status!=="paused"&&w.startMove())}))}},{key:"setOpacity",value:function(m){this.logger&&this.logger.info("setOpacity: opacity "+m),this.container&&(this.container.style.opacity=m)}},{key:"setFontSize",value:function(m,b){var k=this,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{reflow:!0};this.logger&&this.logger.info("setFontSize: size "+m+" channelSize "+b),this.fontSize=m+"px",m&&(this.main.data.forEach(function(C){C.style&&(C.style.fontSize=k.fontSize)}),this.main.queue.forEach(function(C){C.options.style||(C.options.style={}),C.options.style.fontSize=k.fontSize,C.setFontSize(k.fontSize),b&&(C.top=C.channel_id[0]*b,C.topInit())})),b&&(this.config.channelSize=b,w.reflow&&this.main.channel.resizeSync())}},{key:"setArea",value:function(m){this.logger&&this.logger.info("setArea: area "+m),this.config.area=m,m.reflow!==!1&&this.main.channel.resizeSync()}},{key:"hide",value:function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"scroll";this.logger&&this.logger.info("hide: mode "+m),this.hideArr.indexOf(m)<0&&this.hideArr.push(m);var b=this.main.queue.filter(function(k){return m===k.mode||m==="color"&&k.color});b.forEach(function(k){return k.remove()})}},{key:"show",value:function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"scroll";this.logger&&this.logger.info("show: mode "+m);var b=this.hideArr.indexOf(m);b>-1&&this.hideArr.splice(b,1)}},{key:"setDirection",value:function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"r2l";this.logger&&this.logger.info("setDirection: direction "+m),this.direction=m,this.emit("changeDirection",m)}},{key:"resize",value:function(){this.logger&&this.logger.info("resize"),this.emit("channel_resize")}},{key:"status",get:function(){return this.main.status}},{key:"state",get:function(){var m=this.main;return{status:m.status,comments:m.data,bullets:m.queue,displayArea:m.channel.getRealOccupyArea()}}},{key:"containerPos",get:function(){return this.main.channel.containerPos}}]),y}(u.default);t.default=p},function(i,t,e){var n,r,s,u,l,c,f,d=e(8),v=e(25),h=Function.prototype.apply,p=Function.prototype.call,g=Object.create,y=Object.defineProperty,m=Object.defineProperties,b=Object.prototype.hasOwnProperty,k={configurable:!0,enumerable:!1,writable:!0};r=function(w,C){var x,R;return v(C),R=this,n.call(this,w,x=function(){s.call(R,w,x),h.call(C,this,arguments)}),x.__eeOnceListener__=C,this},l={on:n=function(w,C){var x;return v(C),b.call(this,"__ee__")?x=this.__ee__:(x=k.value=g(null),y(this,"__ee__",k),k.value=null),x[w]?typeof x[w]=="object"?x[w].push(C):x[w]=[x[w],C]:x[w]=C,this},once:r,off:s=function(w,C){var x,R,N,D;if(v(C),!b.call(this,"__ee__"))return this;if(!(x=this.__ee__)[w])return this;if(typeof(R=x[w])=="object")for(D=0;N=R[D];++D)N!==C&&N.__eeOnceListener__!==C||(R.length===2?x[w]=R[D?0:1]:R.splice(D,1));else R!==C&&R.__eeOnceListener__!==C||delete x[w];return this},emit:u=function(w){var C,x,R,N,D;if(b.call(this,"__ee__")&&(N=this.__ee__[w]))if(typeof N=="object"){for(x=arguments.length,D=new Array(x-1),C=1;C<x;++C)D[C-1]=arguments[C];for(N=N.slice(),C=0;R=N[C];++C)h.call(R,this,D)}else switch(arguments.length){case 1:p.call(N,this);break;case 2:p.call(N,this,arguments[1]);break;case 3:p.call(N,this,arguments[1],arguments[2]);break;default:for(x=arguments.length,D=new Array(x-1),C=1;C<x;++C)D[C-1]=arguments[C];h.call(N,this,D)}}},c={on:d(n),once:d(r),off:d(s),emit:d(u)},f=m({},c),i.exports=t=function(w){return w==null?g(f):m(Object(w),c)},t.methods=l},function(i,t,e){var n=e(3),r=e(9),s=e(13),u=e(21),l=e(22);(i.exports=function(c,f){var d,v,h,p,g;return arguments.length<2||typeof c!="string"?(p=f,f=c,c=null):p=arguments[2],n(c)?(d=l.call(c,"c"),v=l.call(c,"e"),h=l.call(c,"w")):(d=h=!0,v=!1),g={value:f,configurable:d,enumerable:v,writable:h},p?s(u(p),g):g}).gs=function(c,f,d){var v,h,p,g;return typeof c!="string"?(p=d,d=f,f=c,c=null):p=arguments[3],n(f)?r(f)?n(d)?r(d)||(p=d,d=void 0):d=void 0:(p=f,f=d=void 0):f=void 0,n(c)?(v=l.call(c,"c"),h=l.call(c,"e")):(v=!0,h=!1),g={get:f,set:d,configurable:v,enumerable:h},p?s(u(p),g):g}},function(i,t,e){var n=e(10),r=/^\s*class[\s{/}]/,s=Function.prototype.toString;i.exports=function(u){return!!n(u)&&!r.test(s.call(u))}},function(i,t,e){var n=e(11);i.exports=function(r){if(typeof r!="function"||!hasOwnProperty.call(r,"length"))return!1;try{if(typeof r.length!="number"||typeof r.call!="function"||typeof r.apply!="function")return!1}catch(s){return!1}return!n(r)}},function(i,t,e){var n=e(12);i.exports=function(r){if(!n(r))return!1;try{return!!r.constructor&&r.constructor.prototype===r}catch(s){return!1}}},function(i,t,e){var n=e(3),r={object:!0,function:!0,undefined:!0};i.exports=function(s){return!!n(s)&&hasOwnProperty.call(r,typeof s)}},function(i,t,e){i.exports=e(14)()?Object.assign:e(15)},function(i,t,e){i.exports=function(){var n,r=Object.assign;return typeof r=="function"&&(r(n={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),n.foo+n.bar+n.trzy==="razdwatrzy")}},function(i,t,e){var n=e(16),r=e(20),s=Math.max;i.exports=function(u,l){var c,f,d,v=s(arguments.length,2);for(u=Object(r(u)),d=function(h){try{u[h]=l[h]}catch(p){c||(c=p)}},f=1;f<v;++f)n(l=arguments[f]).forEach(d);if(c!==void 0)throw c;return u}},function(i,t,e){i.exports=e(17)()?Object.keys:e(18)},function(i,t,e){i.exports=function(){try{return Object.keys("primitive"),!0}catch(n){return!1}}},function(i,t,e){var n=e(2),r=Object.keys;i.exports=function(s){return r(n(s)?Object(s):s)}},function(i,t,e){i.exports=function(){}},function(i,t,e){var n=e(2);i.exports=function(r){if(!n(r))throw new TypeError("Cannot use null or undefined");return r}},function(i,t,e){var n=e(2),r=Array.prototype.forEach,s=Object.create,u=function(l,c){var f;for(f in l)c[f]=l[f]};i.exports=function(l){var c=s(null);return r.call(arguments,function(f){n(f)&&u(Object(f),c)}),c}},function(i,t,e){i.exports=e(23)()?String.prototype.contains:e(24)},function(i,t,e){var n="razdwatrzy";i.exports=function(){return typeof n.contains=="function"&&n.contains("dwa")===!0&&n.contains("foo")===!1}},function(i,t,e){var n=String.prototype.indexOf;i.exports=function(r){return n.call(this,r,arguments[1])>-1}},function(i,t,e){i.exports=function(n){if(typeof n!="function")throw new TypeError(n+" is not a function");return n}},function(i){i.exports=JSON.parse('{"version":"1.1.13"}')},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function f(d,v){for(var h=0;h<v.length;h++){var p=v[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(d,p.key,p)}}return function(d,v,h){return v&&f(d.prototype,v),h&&f(d,h),d}}(),r=l(e(1)),s=l(e(28)),u=e(0);function l(f){return f&&f.__esModule?f:{default:f}}var c=function(f){function d(v){(function(p,g){if(!(p instanceof g))throw new TypeError("Cannot call a class as a function")})(this,d);var h=function(p,g){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!g||typeof g!="object"&&typeof g!="function"?p:g}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));return h.setLogger("control"),h.danmu=v,h.main=new s.default(v),v.config.defaultOff||h.main.start(),h}return function(v,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);v.prototype=Object.create(h&&h.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),h&&(Object.setPrototypeOf?Object.setPrototypeOf(v,h):v.__proto__=h)}(d,f),n(d,[{key:"createSwitch",value:function(){var v=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this.logger&&this.logger.info("createSwitch"),this.switchBtn=(0,u.createDom)("dk-switch",'<span class="txt">弹</span>',{},"danmu-switch "+(v?"danmu-switch-active":"")),this.switchBtn}},{key:"destroy",value:function(){for(var v in this.logger&&this.logger.info("destroy"),this.main.destroy(),this)u.hasOwnProperty.call(this,v)&&delete this[v]}}]),d}(r.default);t.default=c,i.exports=t.default},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function d(v,h){for(var p=0;p<h.length;p++){var g=h[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(v,g.key,g)}}return function(v,h,p){return h&&d(v.prototype,h),p&&d(v,p),v}}(),r=c(e(1)),s=c(e(29)),u=c(e(30)),l=e(0);function c(d){return d&&d.__esModule?d:{default:d}}var f=function(d){function v(h){(function(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")})(this,v);var p=function(g,y){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!y||typeof y!="object"&&typeof y!="function"?g:y}(this,(v.__proto__||Object.getPrototypeOf(v)).call(this));return p.setLogger("main"),p.danmu=h,p.container=h.container,p.channel=new u.default(h),p.data=[].concat(h.config.comments),p.playedData=[],p.queue=[],p.timer=null,p.playRate=1,p.retryStatus="normal",p.interval=h.config.interval,p._status="idle",p._events=[],p._bindEvents(),p}return function(h,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof p);h.prototype=Object.create(p&&p.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),p&&(Object.setPrototypeOf?Object.setPrototypeOf(h,p):h.__proto__=p)}(v,d),n(v,[{key:"destroy",value:function(){for(var h in this.logger&&this.logger.info("destroy"),this._unbindEvents(),this._cancelTick(),this.channel&&this.channel.destroy(),this.data=[],this)delete this[h]}},{key:"_bindEvents",value:function(){var h=this,p=this.danmu,g=this.container;this._unbindEvents(),this._events.push([p,"bullet_remove",function(y){var m=y.bullet,b=h.data,k=h.queue;k.some(function(w,C){return w.id===m.id&&(k.splice(C,1),!0)}),b.some(function(w){return w.id===m.id&&(w.attached_=!1,!0)})}]),this._events.push([g,"transitionend",function(y){var m=h._getBulletByEvt(y);m&&(m.status="end",m.remove(!1))}]),(p.config.mouseControl||p.config.mouseEnterControl)&&this._events.push([g,"mouseover",function(y){var m,b=h.danmu;!b||b.mouseControl&&b.config.mouseControlPause||(m=h._getBulletByEvt(y))&&m.status!=="waiting"&&m.status!=="end"&&b.emit("bullet_hover",{bullet:m,event:y})}]),this._events.forEach(function(y){y[0].addEventListener?y[0].addEventListener(y[1],y[2],!1):y[0].on&&y[0].on(y[1],y[2])})}},{key:"_unbindEvents",value:function(){this._events.length&&(this._events.forEach(function(h){h[0].removeEventListener?h[0].removeEventListener(h[1],h[2],!1):h[0].off&&h[0].off(h[1],h[2])}),this._events=[])}},{key:"_cancelTick",value:function(){this.handleTimer&&(clearTimeout(this.handleTimer),this.handleTimer=null)}},{key:"_startTick",value:function(){var h=this;h.retryStatus="normal",h._cancelTick(),h.sortData(),function p(){h._status!=="closed"||h.retryStatus!=="stop"?(h._status==="playing"&&(h.readData(),h.dataHandle()),h.retryStatus==="stop"&&h._status!=="paused"||(h.handleTimer=setTimeout(p,250))):h._cancelTick()}()}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this._status!=="playing"&&(this._status="playing",this.queue=[],this.container.innerHTML="",this.channel.reset(),this._startTick())}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this._status!=="closed"&&(this._status="closed",this.retryStatus="stop",this.queue=[],this.container&&(this.container.innerHTML=""),this.channel&&this.channel.reset(),this._cancelTick())}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.channel&&this.channel.reset(),this.data=[],this.queue=[],this.container&&(this.container.innerHTML="")}},{key:"play",value:function(){var h=this;if(this._status!=="closed"){this.logger&&this.logger.info("play"),this._status="playing";var p=this.channel.channels;p&&p.length>0&&["scroll","top","bottom"].forEach(function(g){h.queue.forEach(function(m){m.startMove(),m.resized=!0});for(var y=0;y<p.length;y++)p[y].queue[g].forEach(function(m){m.resized=!1})}),this._startTick()}else this.logger&&this.logger.info("play ignored")}},{key:"pause",value:function(){if(this._status!=="closed"){this.logger&&this.logger.info("pause"),this._status="paused",this._cancelTick();var h=this.channel.channels;h&&h.length>0&&this.queue.forEach(function(p){p.pauseMove()})}else this.logger&&this.logger.info("pause ignored")}},{key:"dataHandle",value:function(){this._status!=="paused"&&this._status!=="closed"&&this.queue.length&&this.queue.forEach(function(h){h.status==="waiting"&&h.startMove()})}},{key:"readData",value:function(){var h=this.danmu,p=this.interval,g=this.channel,y=h.player,m=void 0,b=void 0;if(h.isReady&&h.main){if(y){var k=y.currentTime?Math.floor(1e3*y.currentTime):0;b=this.data.filter(function(N){return!N.start&&h.hideArr.indexOf(N.mode)<0&&(!N.color||h.hideArr.indexOf("color")<0)&&(N.start=k),!N.attached_&&h.hideArr.indexOf(N.mode)<0&&(!N.color||h.hideArr.indexOf("color")<0)&&N.start-p<=k&&k<=N.start+p}),h.config.highScorePriority&&b.sort(function(N,D){return D.prior&&!N.prior||(D.score||-1)-(N.score||-1)}),h.live&&(this.data=[])}else(b=this.data.splice(0,1)).length===0&&(b=this.playedData.splice(0,1));if(b.length>0&&g.checkAvailableTrack(b[0].mode)){g.updatePos();var w=0;e:for(var C,x=0;x<b.length;x++)if(C=b[x],this.forceDuration&&this.forceDuration!==C.duration&&(C.duration=this.forceDuration),(m=new s.default(h,C)).bulletCreateFail){if(w===0)break e;w--}else if(m.attach(),C.attached_=!0,g.addBullet(m).result)this.queue.push(m),m.topInit(),w=0;else{for(var R in m.detach(),m)l.hasOwnProperty.call(m,R)&&delete m[R];if(m=null,C.attached_=!1,C.noDiscard&&(C.prior?this.data.unshift(C):this.data.push(C)),w===0)break e;w--}}}}},{key:"sortData",value:function(){this.data.sort(function(h,p){return(h.start||-1)-(p.start||-1)})}},{key:"keepPoolWatermark",value:function(){var h=this.danmu,p=h.config,g=h.player,y=this.data,m=[],b=0;if(typeof p.maxCommentsLength=="number"&&y.length>p.maxCommentsLength){b=y.length-p.maxCommentsLength;for(var k,w=0;w<b;w++)(k=y[w]).prior&&!k.attached_&&m.push(y[w])}else if(p.dropStaleComments&&g&&g.currentTime){var C=Math.floor(1e3*g.currentTime)-p.interval;if(C>0){for(var x,R=0;R<y.length;R++)if((x=y[R]).prior&&!x.attached_&&m.push(y[R]),x.start>C){b=R;break}}}b>0&&(y.splice(0,b),this.data=m.concat(y))}},{key:"_getBulletByEvt",value:function(h){for(var p,g=h.target||h.srcElement,y=this.queue,m=void 0,b=0;b<y.length;b++)if((p=y[b])&&p.el&&(p.el===g||p.el.contains(g))){m=p;break}return m}},{key:"status",get:function(){return this._status}}]),v}(r.default);t.default=f,i.exports=t.default},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.Bullet=void 0;var n=function(){function h(p,g){for(var y=0;y<g.length;y++){var m=g[y];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(p,m.key,m)}}return function(p,g,y){return g&&h(p.prototype,g),y&&h(p,y),p}}(),r=l(e(1)),s=l(e(4)),u=e(0);function l(h){return h&&h.__esModule?h:{default:h}}function c(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")}function f(h,p){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!p||typeof p!="object"&&typeof p!="function"?h:p}var d=new s.default("bullet"),v=t.Bullet=function(h){function p(g){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};c(this,p);var m=f(this,(p.__proto__||Object.getPrototypeOf(p)).call(this)),b=g.container,k=g.recycler,w=g.config;return m.setLogger(d),m.danmu=g,m.options=y,m.duration=y.duration,m.id=y.id,m.container=b,m.mode=y.mode==="top"||y.mode==="bottom"?y.mode:"scroll",m.start=y.start,m.prior=y.prior,m.realTime=y.realTime,m.color=y.color,m.bookChannelId=y.bookChannelId,m.reuseDOM=!0,m.noCopyEl=!(!w.disableCopyDOM&&!y.disableCopyDOM),m.recycler=k,m._fullySlideInScreenDuration=void 0,m._lastMoveTime=void 0,m.status="waiting",y.elLazyInit||(m.bulletCreateFail=!m._makeEl()),m}return function(g,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);g.prototype=Object.create(y&&y.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(g,y):g.__proto__=y)}(p,h),n(p,[{key:"_makeEl",value:function(){var g=this.danmu,y=this.options,m=g.config,b=g.globalHooks,k=void 0,w="",C=y.style||{};if(C.perspective="500em",y.el||y.elLazyInit){if(this.noCopyEl&&(this.reuseDOM=!1),y.elLazyInit){if((0,u.isFunction)(b.bulletCreateEl))try{var x=b.bulletCreateEl(y);k=x instanceof HTMLElement?x:x.el}catch(E){}}else if(y.el.nodeType===1&&!y.el.parentNode)if(this.reuseDOM){var R=(0,u.copyDom)(y.el);y.eventListeners&&y.eventListeners.length>0&&y.eventListeners.forEach(function(E){R.addEventListener(E.event,E.listener,E.useCapture||!1)}),(k=this.recycler.use()).childNodes.length>0&&(k.innerHTML=""),k.textContent&&(k.textContent=""),k.appendChild(R)}else k=y.el}else typeof y.txt=="string"&&((k=this.recycler.use()).textContent=y.txt);if(!k||!g.main)return!1;var N=void 0;if((0,u.isNumber)(m.bulletOffset)&&m.bulletOffset>=0)N=m.bulletOffset;else{var D=g.containerPos;N=D.width/10>100?100:D.width/10}var L=y.realTime?0:Math.floor(Math.random()*N),S=this.updateOffset(L,!0);return C.left=S,Object.keys(C).forEach(function(E){var T=E.replace(/[A-Z]/g,function(O){return"-"+O.toLowerCase()});w+=T+":"+C[E]+";"}),(0,u.styleCSSText)(k,w),this.el=k,y.like&&y.like.el&&this.setLikeDom(y.like.el,y.like.style),!0}},{key:"updateOffset",value:function(g){var y=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.random=g;var m=this.danmu.containerPos.width+g+"px";return y||(0,u.styleUtil)(this.el,"left",this.danmu.containerPos.width+g+"px"),m}},{key:"attach",value:function(){if(this.options.elLazyInit&&!this.el&&this._makeEl(),this.danmu&&this.danmu.main){var g=this.danmu,y=this.options,m=this.el,b=g.globalHooks;b.bulletAttaching&&b.bulletAttaching(y),this.container.contains(m)||this.container.appendChild(m),this.elPos=m.getBoundingClientRect(),this.direction==="b2t"?(this.width=this.elPos.height,this.height=this.elPos.width):(this.width=this.elPos.width,this.height=this.elPos.height),this.moveV&&(this.duration=(this.danmu.containerPos.width+this.random+this.width)/this.moveV*1e3),b.bulletAttached&&b.bulletAttached(y,m)}}},{key:"detach",value:function(){var g=this.el,y=this.danmu,m=this.options,b=y.globalHooks;g&&(b.bulletDetaching&&b.bulletDetaching(m),this.reuseDOM?this.recycler.unused(g):g.parentNode&&g.parentNode.removeChild(g),b.bulletDetached&&b.bulletDetached(m,g),this.el=null),this.elPos=void 0}},{key:"topInit",value:function(){this.logger&&this.logger.info("topInit #"+(this.options.txt||"[DOM Element]")+"#"),this.direction==="b2t"?((0,u.styleUtil)(this.el,"transformOrigin","left top"),(0,u.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+this.danmu.containerPos.height+"px) translateZ(0px) rotate(90deg)"),(0,u.styleUtil)(this.el,"transition","transform 0s linear 0s")):(0,u.styleUtil)(this.el,"top",this.top+"px")}},{key:"pauseMove",value:function(){var g=arguments.length>0&&arguments[0]!==void 0&&arguments[0],y=this;if(y.status!=="paused"&&(y.status!=="forcedPause"&&(this.status="paused"),y._moveV=void 0,this.el))if(this.mode==="scroll"){var m=y.danmu.containerPos;if(g){var b=(new Date().getTime()-y._lastMoveTime)/1e3,k=b*this.moveV,w=0;w=y.moveMoreS-k>=0?this.direction==="b2t"?(y.moveMoreS-k)/y.moveContainerHeight*m.height:(y.moveMoreS-k)/y.moveContainerWidth*m.width:y.moveMoreS-k,this.direction==="b2t"?(0,u.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+w+"px) translateZ(0px) rotate(90deg)"):(0,u.styleUtil)(this.el,"left",w+"px")}else this.direction==="b2t"?(0,u.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+(this.el.getBoundingClientRect().top-m.top)+"px) translateZ(0px) rotate(90deg)"):(0,u.styleUtil)(this.el,"left",this.el.getBoundingClientRect().left-m.left+"px");this.direction==="b2t"||(0,u.styleUtil)(this.el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),(0,u.styleUtil)(this.el,"transition","transform 0s linear 0s")}else this.pastDuration&&this.startTime?this.pastDuration=this.pastDuration+new Date().getTime()-this.startTime:this.pastDuration=1}},{key:"startMove",value:function(g){if(this.hasMove||(this.danmu.emit("bullet_start",this),this.hasMove=!0),(this.status!=="forcedPause"||g)&&this.el&&this.status!=="start")if(this.status="start",this.mode==="scroll"){var y=this.danmu.containerPos;if(!this.el)return;var m=this.el.getBoundingClientRect(),b=void 0;if(this.direction==="b2t"){b=m.bottom-y.bottom;var k=(m.bottom-y.top)/this.moveV;(0,u.styleUtil)(this.el,"transition","transform "+k+"s linear 0s"),(0,u.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY(-"+this.height+"px) translateZ(0px) rotate(90deg)"),this._lastMoveTime=new Date().getTime(),this.moveMoreS=m.top-y.top,this.moveContainerHeight=y.height}else{b=m.right-y.right;var w=m.right-y.left,C=w/this.moveV;m.right>y.left?((0,u.styleUtil)(this.el,"transition","transform "+C+"s linear 0s"),(0,u.styleUtil)(this.el,"transform","translateX(-"+w+"px) translateY(0px) translateZ(0px)"),this._lastMoveTime=new Date().getTime(),this.moveMoreS=m.left-y.left,this.moveContainerWidth=y.width):(this.status="end",this.remove())}this._fullySlideInScreenDuration=b/this.moveV}else{var x=new Date().getTime(),R=(this.startTime&&x-this.startTime>this.duration?x-this.startTime:this.duration)/1e3;(0,u.styleUtil)(this.el,"left","50%"),(0,u.styleUtil)(this.el,"margin","0 0 0 -"+this.width/2+"px"),(0,u.styleUtil)(this.el,"visibility","hidden"),(0,u.styleUtil)(this.el,"transition","visibility "+R+"s 0s"),this.pastDuration||(this.pastDuration=1),this.startTime=x}}},{key:"remove",value:function(){var g=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];this.logger&&this.logger.info("remove #"+(this.options.txt||"[DOM Element]")+"#");var y=this;g&&y.pauseMove(),y.el&&y.el.parentNode&&(y.detach(),this.options.el&&this.options.el.nodeType===1&&this.noCopyEl&&(0,u.styleUtil)(this.options.el,"transform","none"),y.danmu.emit("bullet_remove",{bullet:y}))}},{key:"setFontSize",value:function(g){this.el&&(this.el.style.fontSize=g)}},{key:"setLikeDom",value:function(g,y){if(g&&(Object.keys(y).forEach(function(b){g.style[b]=y[b]}),g.className="danmu-like",this.el)){var m=this.el.querySelector(".danmu-like");m&&this.el.removeChild(m),this.el.innerHTML=""+this.el.innerHTML+g.outerHTML}return g}},{key:"moveV",get:function(){var g=this.danmu,y=this.options,m=this._moveV;if(!m){if(y.moveV)m=y.moveV;else if(this.elPos){var b=g.containerPos;m=(this.direction==="b2t"?b.height+(g.config.chaseEffect?this.height:0):b.width+(g.config.chaseEffect?this.width:0))/this.duration*1e3}m&&(m*=g.main.playRate,this._moveV=m)}return m}},{key:"direction",get:function(){return this.danmu.direction}},{key:"fullySlideIntoScreen",get:function(){var g=!0;return this.mode==="scroll"&&this._lastMoveTime&&this._fullySlideInScreenDuration>0&&(g=(new Date().getTime()-this._lastMoveTime)/1e3>=this._fullySlideInScreenDuration),g}}]),p}(r.default);t.default=v},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function d(v,h){for(var p=0;p<h.length;p++){var g=h[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(v,g.key,g)}}return function(v,h,p){return h&&d(v.prototype,h),p&&d(v,p),v}}(),s=e(1),u=(n=s)&&n.__esModule?n:{default:n},l=e(0),c=e(31),f=function(d){function v(h){(function(y,m){if(!(y instanceof m))throw new TypeError("Cannot call a class as a function")})(this,v);var p=function(y,m){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!m||typeof m!="object"&&typeof m!="function"?y:m}(this,(v.__proto__||Object.getPrototypeOf(v)).call(this)),g=p;return g.setLogger("channel"),g.danmu=h,g.width=0,g.height=0,g.reset(!0),g.channels=[],g.updatePos(),(0,l.attachEventListener)(p.danmu,"bullet_remove",function(y){g.removeBullet(y.bullet)},"destroy"),(0,l.attachEventListener)(p.danmu,"channel_resize",function(){g.resize()},"destroy"),p}return function(h,p){if(typeof p!="function"&&p!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof p);h.prototype=Object.create(p&&p.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),p&&(Object.setPrototypeOf?Object.setPrototypeOf(h,p):h.__proto__=p)}(v,d),r(v,[{key:"checkAvailableTrack",value:function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"scroll",p=this.channels,g=!1;if(h==="scroll")for(var y,m=0;m<p.length;m++)if(g=!0,(y=p[m]).operating[h])g=!1;else{var b=y.queue[h][0];if(!b||b.fullySlideIntoScreen){if(g)break}else g=!1}else g=!0;return g}},{key:"destroy",value:function(){for(var h in this.logger&&this.logger.info("destroy"),this.channels.splice(0,this.channels.length),this._cancelResizeTimer(),this)l.hasOwnProperty.call(this,h)&&delete this[h]}},{key:"reset",value:function(){var h=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.logger&&this.logger.info("reset");var p=this,g=p.danmu,y=g.container,m=g.bulletBtn;function b(){if(p.danmu&&p.danmu.container){var k=p.danmu.container.getBoundingClientRect();p.width=k.width,p.height=k.height,p.resetId&&(cancelAnimationFrame(p.resetId),p.resetId=null);var w=p._initChannels(),C=w.channelSize,x=w.channelCount,R=w.channels;p.channelCount=x,p.channels=R,p.direction==="b2t"?p.channelWidth=C:p.channelHeight=C}}p.container=y,m&&m.main&&m.main.queue.forEach(function(k){k.remove()}),p.channels&&p.channels.length>0&&["scroll","top","bottom"].forEach(function(k){for(var w=0;w<p.channels.length;w++)p.channels[w].queue[k].forEach(function(C){C.remove()})}),m&&m.main&&m.main.data&&m.main.data.forEach(function(k){k.attached_=!1}),h?this.resetId=requestAnimationFrame(b):b()}},{key:"getRealOccupyArea",value:function(){return{width:this.width,height:this.height}}},{key:"updatePos",value:function(){var h=this.container.getBoundingClientRect();this.containerPos=h,this.containerWidth=h.width,this.containerHeight=h.height,this.containerTop=h.top,this.containerBottom=h.bottom,this.containerLeft=h.left,this.containerRight=h.right}},{key:"addBullet",value:function(h){var p=this,g=this.danmu,y=this.channels,m=void 0,b=void 0,k=void 0;if(p.direction==="b2t"?(b=this.channelWidth,k=Math.ceil(h.width/b)):(m=this.channelHeight,k=Math.ceil(h.height/m)),k>y.length)return{result:!1,message:"exceed channels.length, occupy="+k+",channelsSize="+y.length};for(var w=!0,C=void 0,x=-1,R=0,N=y.length;R<N;R++)if(y[R].queue[h.mode].some(function(ge){return ge.id===h.id}))return{result:!1,message:"exited, channelOrder="+R+",danmu_id="+h.id};if(h.mode==="scroll")for(var D=0,L=y.length-k;D<=L;D+=k){w=!0;for(var S=D;S<D+k;S++){if((C=y[S]).operating.scroll||C.bookId.scroll&&C.bookId.scroll!==h.id){w=!1;break}C.operating.scroll=!0;var E=C.queue.scroll[0];if(E){var T=E.el.getBoundingClientRect();if(p.direction==="b2t"){if(T.bottom>=p.containerPos.bottom){w=!1,C.operating.scroll=!1;break}}else if(T.right>=p.containerPos.right){w=!1,C.operating.scroll=!1;break}var O=void 0,P=E.moveV,U=void 0,j=h.moveV,q=void 0;if(p.direction==="b2t"?(U=(O=T.bottom-p.containerTop)/P,q=p.containerHeight+h.random-O):(U=(O=T.right-p.containerLeft)/P,q=p.containerWidth+h.random-O),j>P){var ue=q/(j-P);if(g.config.bOffset||(g.config.bOffset=0),U+g.config.bOffset>=ue){var V=U*j-p.containerPos.width;V>0&&h.updateOffset(V+(1+Math.ceil(5*Math.random())))}}}C.operating.scroll=!1}if(w){x=D;break}}else if(h.mode==="top")for(var ve=0,K=y.length-k;ve<=K;ve++){w=!0;for(var Ke=ve;Ke<ve+k;Ke++){if(Ke>Math.floor(y.length/2)){w=!1;break}if((C=y[Ke]).operating[h.mode]){w=!1;break}if((C.bookId[h.mode]||h.prior)&&C.bookId[h.mode]!==h.id){w=!1;break}if(C.operating[h.mode]=!0,C.queue[h.mode].length>0){w=!1,C.operating[h.mode]=!1;break}C.operating[h.mode]=!1}if(w){x=ve;break}}else if(h.mode==="bottom")for(var Pe=y.length-k;Pe>=0;Pe--){w=!0;for(var Ye=Pe;Ye<Pe+k;Ye++){if(Ye<=Math.floor(y.length/2)){w=!1;break}if((C=y[Ye]).operating[h.mode]){w=!1;break}if((C.bookId[h.mode]||h.prior)&&C.bookId[h.mode]!==h.id){w=!1;break}if(C.operating[h.mode]=!0,C.queue[h.mode].length>0){w=!1,C.operating[h.mode]=!1;break}C.operating[h.mode]=!1}if(w){x=Pe;break}}if(x!==-1){for(var Qe=x,$t=x+k;Qe<$t;Qe++)(C=y[Qe]).operating[h.mode]=!0,C.queue[h.mode].unshift(h),h.prior&&(delete C.bookId[h.mode],p.logger&&p.logger.info(Qe+"号轨道恢复正常使用")),C.operating[h.mode]=!1;return h.prior&&(p.logger&&p.logger.info(h.id+"号优先弹幕运行完毕"),delete h.bookChannelId,g.player&&g.bulletBtn.main.data.some(function(ge){return ge.id===h.id&&(delete ge.bookChannelId,!0)})),h.channel_id=[x,k],h.el.setAttribute("data-line-index",x+1),p.direction==="b2t"?(h.top=x*b,p.danmu.config.area&&p.danmu.config.area.start&&(h.top+=p.containerWidth*p.danmu.config.area.start)):(h.top=x*m,p.danmu.config.area&&p.danmu.config.area.start&&(h.top+=p.containerHeight*p.danmu.config.area.start)),{result:h,message:"success"}}if(h.options.realTime){var ye=0,Kt=-1,He=null;if(p.danmu.bulletBtn.main.queue.forEach(function(ge,ht){!ge.prior&&!ge.options.realTime&&ge.el&&ge.el.getBoundingClientRect().left>p.containerPos.right&&ge.start>=ye&&(ye=ge.start,Kt=ht,He=ge)}),He){He.remove(),p.removeBullet(He),p.danmu.bulletBtn.main.queue.splice(Kt,1),h.channel_id=He.channel_id;for(var Rt=He.channel_id[0],hi=He.channel_id[0]+He.channel_id[1];Rt<hi;Rt++)(C=y[Rt]).operating[h.mode]=!0,C.queue[h.mode].unshift(h),h.prior&&delete C.bookId[h.mode],C.operating[h.mode]=!1;return h.top=He.top,p.danmu.config.area&&p.danmu.config.area.start&&(h.top+=p.containerHeight*p.danmu.config.area.start),{result:h,message:"success"}}}if(h.prior)if(h.bookChannelId||p.danmu.live)g.player&&g.bulletBtn.main.data.some(function(ge){return ge.id===h.id&&(p.logger&&p.logger.info(h.id+"号优先弹幕将于2秒后再次请求注册"),ge.start+=2e3,!0)});else{x=-1;for(var Et=0,xi=y.length-k;Et<=xi;Et++){w=!0;for(var Yt=Et;Yt<Et+k;Yt++)if(y[Yt].bookId[h.mode]){w=!1;break}if(w){x=Et;break}}if(x!==-1){for(var wt=x;wt<x+k;wt++)y[wt].bookId[h.mode]=h.id,p.logger&&p.logger.info(wt+"号轨道被"+h.id+"号优先弹幕预定");g.player&&g.bulletBtn.main.data.some(function(ge){return ge.id===h.id&&(p.logger&&p.logger.info(h.id+"号优先弹幕将于2秒后再次请求注册"),ge.start+=2e3,ge.bookChannelId=[x,k],p.logger&&p.logger.info(h.id+"号优先弹幕预定了"+x+"~"+(x+k-1)+"号轨道"),!0)})}}return{result:!1,message:"no surplus will right"}}},{key:"removeBullet",value:function(h){this.logger&&this.logger.info("removeBullet "+(h.options.txt||"[DOM Element]"));for(var p=this.channels,g=h.channel_id,y=void 0,m=g[0],b=g[0]+g[1];m<b;m++)if(y=p[m]){y.operating[h.mode]=!0;var k=-1;y.queue[h.mode].some(function(w,C){return w.id===h.id&&(k=C,!0)}),k>-1&&y.queue[h.mode].splice(k,1),y.operating[h.mode]=!1}h.options.loop&&this.danmu.bulletBtn.main.playedData.push(h.options)}},{key:"resizeSync",value:function(){this.resize(!0)}},{key:"_initChannels",value:function(){if(this.danmu&&this.danmu.config){var h=this.danmu.config,p=h.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),g=void 0;if(h.area){var y=h.area,m=y.lines,b=y.start,k=y.end;if((0,c.validAreaLineRule)(m))g=m,this.direction==="b2t"?this.width=g*p:this.height=g*p;else if(b>=0&&k>=b){var w=k-b;this.direction==="b2t"?this.width=Math.floor(this.width*w):this.height=Math.floor(this.height*w)}}(0,l.isNumber)(g)||(g=this.direction==="b2t"?Math.floor(this.width/p):Math.floor(this.height/p));for(var C=[],x=0;x<g;x++)C[x]={id:x,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};return{channelSize:p,channelCount:g,channels:C}}}},{key:"resize",value:function(){var h=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.logger&&this.logger.info("resize");var p=this;function g(k,w){k[w]={id:w,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}}}function y(k,w){function C(L){["scroll","top"].forEach(function(S){p.channels[L].queue[S].forEach(function(E){E.el&&k[L].queue[S].push(E)})})}function x(L){p.channels[L].queue.bottom.forEach(function(S){if(S.el&&(k[L+k.length-p.channels.length].queue.bottom.push(S),S.channel_id[0]+S.channel_id[1]-1===L)){var E=[].concat(S.channel_id);S.channel_id=[E[0]-p.channels.length+k.length,E[1]],S.top=S.channel_id[0]*w,p.danmu.config.area&&p.danmu.config.area.start&&(S.top+=p.containerHeight*p.danmu.config.area.start),S.topInit()}})}for(var R=0;R<p.channels.length;R++)g(k,R),C(R),x(R);for(var N=function(L){["scroll","top","bottom"].forEach(function(S){k[L].queue[S].forEach(function(E){E.resized=!1})})},D=0;D<k.length;D++)N(D);p.channels=k,p.direction==="b2t"?p.channelWidth=w:p.channelHeight=w}function m(k,w){for(var C=["scroll","top","bottom"],x=function(D){g(k,D),C.forEach(function(L){if(!(L==="top"&&D>Math.floor(k.length/2))){if(!(L==="bottom"&&D<=Math.floor(k.length/2))){var S=L==="bottom"?D-k.length+p.channels.length:D;p.channels[S].queue[L].forEach(function(E,T){if(E.el){if(k[D].queue[L].push(E),L==="bottom"&&E.channel_id[0]+E.channel_id[1]-1===S){var O=[].concat(E.channel_id);E.channel_id=[O[0]-p.channels.length+k.length,O[1]],E.top=E.channel_id[0]*w,p.danmu.config.area&&p.danmu.config.area.start&&(E.top+=p.containerHeight*p.danmu.config.area.start),E.topInit()}p.channels[S].queue[L].splice(T,1)}})}}})},R=0;R<k.length;R++)x(R);var N=function(D){C.forEach(function(L){k[D].queue[L].forEach(function(S){S.resized=!1})})};for(R=0;R<k.length;R++)N(R);p.channels=k,p.direction==="b2t"?p.channelWidth=w:p.channelHeight=w}function b(){var k=p.danmu,w=k.container,C=k.bulletBtn;p.container=w,p.updatePos(),p._cancelResizeTimer(),C.main.data&&C.main.data.forEach(function(D){D.bookChannelId&&(delete D.bookChannelId,p.logger&&p.logger.info("resize导致"+D.id+"号优先弹幕预定取消"))}),p.logger&&p.logger.info("resize导致所有轨道恢复正常使用"),p.width=p.containerWidth,p.height=p.containerHeight;var x=p._initChannels(),R=x.channelSize,N=x.channels;p.channels&&(p.channels.length<=N.length?y(N,R):m(N,R)),p.resizing=!1}p.resizing||(p.resizing=!0,h?b():(this._cancelResizeTimer(),this.resizeId=requestAnimationFrame(b)))}},{key:"_cancelResizeTimer",value:function(){this.resizeId&&(cancelAnimationFrame(this.resizeId),this.resizeId=null)}},{key:"direction",get:function(){return this.danmu.direction}}]),v}(u.default);t.default=f,i.exports=t.default},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.validAreaLineRule=function(n){return typeof n=="number"&&n>=0&&Number.isInteger(n)}},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function u(l,c){for(var f=0;f<c.length;f++){var d=c[f];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(l,d.key,d)}}return function(l,c,f){return c&&u(l.prototype,c),f&&u(l,f),l}}(),r=e(0),s=function(){function u(l){(function(c,f){if(!(c instanceof f))throw new TypeError("Cannot call a class as a function")})(this,u),l={initDOM:function(){return document.createElement("div")},initSize:10},this.init(l)}return n(u,[{key:"init",value:function(l){this.idleList=[],this.usingList=[],this._id=0,this.options=l,this._expand(l.initSize)}},{key:"use",value:function(){this.idleList.length||this._expand(1);var l=this.idleList.shift();return this.usingList.push(l),l}},{key:"unused",value:function(l){var c=this.usingList.indexOf(l);c<0||(this.usingList.splice(c,1),l.style.opacity=0,this.idleList.push(l))}},{key:"_expand",value:function(l){for(var c=0;c<l;c++)this.idleList.push(this.options.initDOM(this._id++))}},{key:"destroy",value:function(){for(var l=0;l<this.idleList.length;l++)this.idleList[l].innerHTML="",this.idleList[l].textcontent="",this.clearElementStyle(this.idleList[l]);for(var c=0;c<this.usingList.length;c++)this.usingList[c].innerHTML="",this.usingList[c].textcontent="",this.clearElementStyle(this.usingList[c]);for(var f in this)r.hasOwnProperty.call(this,f)&&delete this[f]}},{key:"clearElementStyle",value:function(l){var c=typeof window<"u"?window.navigator.userAgent:null;c&&(c.indexOf("MSIE ")>-1||c.indexOf("Trident/")>-1?(0,r.styleUtil)(l,"transform","none"):l.setAttribute("style",""))}}]),u}();t.default=s,i.exports=t.default},function(i,t,e){Object.defineProperty(t,"__esModule",{value:!0}),t.destroyObserver=t.unObserver=t.addObserver=void 0;var n=function(){function u(l,c){for(var f=0;f<c.length;f++){var d=c[f];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(l,d.key,d)}}return function(l,c,f){return c&&u(l.prototype,c),f&&u(l,f),l}}(),r=e(0),s=new(function(){function u(){var l=this;if(function(c,f){if(!(c instanceof f))throw new TypeError("Cannot call a class as a function")}(this,u),this.__handlers=[],window.ResizeObserver)try{this.observer=new window.ResizeObserver((0,r.throttle)(function(c){l.__trigger(c)},100))}catch(c){}}return n(u,[{key:"addObserver",value:function(l,c){if(this.observer&&l){this.observer&&this.observer.observe(l);for(var f=this.__handlers,d=-1,v=0;v<f.length;v++)f[v]&&l===f[v].target&&(d=v);d>-1?this.__handlers[d].handler.push(c):this.__handlers.push({target:l,handler:[c]})}}},{key:"unObserver",value:function(l){if(l){var c=-1;this.__handlers.map(function(f,d){l===f.target&&(c=d)}),this.observer&&this.observer.unobserve(l),c>-1&&this.__handlers.splice(c,1)}}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(l){for(var c=this.__handlers,f=0;f<c.length;f++)if(c[f]&&l===c[f].target){c[f].handler&&c[f].handler.map(function(d){try{d()}catch(v){console.error(v)}});break}}},{key:"__trigger",value:function(l){var c=this;l.map(function(f){c.__runHandler(f.target)})}}]),u}());t.addObserver=function(u,l){s.addObserver(u,l)},t.unObserver=function(u,l){s.unObserver(u,l)},t.destroyObserver=function(u,l){s.destroyObserver(u,l)}},function(i,t,e){var n=e(35);typeof n=="string"&&(n=[[i.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};e(37)(n,r),n.locals&&(i.exports=n.locals)},function(i,t,e){(i.exports=e(36)(!1)).push([i.i,".danmu{overflow:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none;-ms-user-select:none}.danmu>*{position:absolute;white-space:nowrap}.danmu-switch{width:32px;height:20px;border-radius:100px;background-color:#ccc;-webkit-box-sizing:border-box;box-sizing:border-box;outline:none;cursor:pointer;position:relative;text-align:center;margin:10px auto}.danmu-switch.danmu-switch-active{padding-left:12px;background-color:#f85959}.danmu-switch span.txt{width:20px;height:20px;line-height:20px;text-align:center;display:block;border-radius:100px;background-color:#fff;-webkit-box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);font-family:PingFangSC;font-size:10px;font-weight:500;color:#f44336}",""])},function(i,t){i.exports=function(e){var n=[];return n.toString=function(){return this.map(function(r){var s=function(u,l){var c=u[1]||"",f=u[3];if(!f)return c;if(l&&typeof btoa=="function"){var d=(h=f,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(h))))+" */"),v=f.sources.map(function(p){return"/*# sourceURL="+f.sourceRoot+p+" */"});return[c].concat(v).concat([d]).join(`
`)}var h;return[c].join(`
`)}(r,e);return r[2]?"@media "+r[2]+"{"+s+"}":s}).join("")},n.i=function(r,s){typeof r=="string"&&(r=[[null,r,""]]);for(var u={},l=0;l<this.length;l++){var c=this[l][0];typeof c=="number"&&(u[c]=!0)}for(l=0;l<r.length;l++){var f=r[l];typeof f[0]=="number"&&u[f[0]]||(s&&!f[2]?f[2]=s:s&&(f[2]="("+f[2]+") and ("+s+")"),n.push(f))}},n}},function(i,t,e){var n,r,s={},u=(n=function(){return window&&document&&document.all&&!window.atob},function(){return r===void 0&&(r=n.apply(this,arguments)),r}),l=function(L){return document.querySelector(L)},c=function(L){var S={};return function(E){if(typeof E=="function")return E();if(S[E]===void 0){var T=l.call(this,E);if(window.HTMLIFrameElement&&T instanceof window.HTMLIFrameElement)try{T=T.contentDocument.head}catch(O){T=null}S[E]=T}return S[E]}}(),f=null,d=0,v=[],h=e(38);function p(L,S){for(var E=0;E<L.length;E++){var T=L[E],O=s[T.id];if(O){O.refs++;for(var P=0;P<O.parts.length;P++)O.parts[P](T.parts[P]);for(;P<T.parts.length;P++)O.parts.push(w(T.parts[P],S))}else{var U=[];for(P=0;P<T.parts.length;P++)U.push(w(T.parts[P],S));s[T.id]={id:T.id,refs:1,parts:U}}}}function g(L,S){for(var E=[],T={},O=0;O<L.length;O++){var P=L[O],U=S.base?P[0]+S.base:P[0],j={css:P[1],media:P[2],sourceMap:P[3]};T[U]?T[U].parts.push(j):E.push(T[U]={id:U,parts:[j]})}return E}function y(L,S){var E=c(L.insertInto);if(!E)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var T=v[v.length-1];if(L.insertAt==="top")T?T.nextSibling?E.insertBefore(S,T.nextSibling):E.appendChild(S):E.insertBefore(S,E.firstChild),v.push(S);else if(L.insertAt==="bottom")E.appendChild(S);else{if(typeof L.insertAt!="object"||!L.insertAt.before)throw new Error(`[Style Loader]

 Invalid value for parameter 'insertAt' ('options.insertAt') found.
 Must be 'top', 'bottom', or Object.
 (https://github.com/webpack-contrib/style-loader#insertat)
`);var O=c(L.insertInto+" "+L.insertAt.before);E.insertBefore(S,O)}}function m(L){if(L.parentNode===null)return!1;L.parentNode.removeChild(L);var S=v.indexOf(L);S>=0&&v.splice(S,1)}function b(L){var S=document.createElement("style");return L.attrs.type===void 0&&(L.attrs.type="text/css"),k(S,L.attrs),y(L,S),S}function k(L,S){Object.keys(S).forEach(function(E){L.setAttribute(E,S[E])})}function w(L,S){var E,T,O,P;if(S.transform&&L.css){if(!(P=S.transform(L.css)))return function(){};L.css=P}if(S.singleton){var U=d++;E=f||(f=b(S)),T=R.bind(null,E,U,!1),O=R.bind(null,E,U,!0)}else L.sourceMap&&typeof URL=="function"&&typeof URL.createObjectURL=="function"&&typeof URL.revokeObjectURL=="function"&&typeof Blob=="function"&&typeof btoa=="function"?(E=function(j){var q=document.createElement("link");return j.attrs.type===void 0&&(j.attrs.type="text/css"),j.attrs.rel="stylesheet",k(q,j.attrs),y(j,q),q}(S),T=D.bind(null,E,S),O=function(){m(E),E.href&&URL.revokeObjectURL(E.href)}):(E=b(S),T=N.bind(null,E),O=function(){m(E)});return T(L),function(j){if(j){if(j.css===L.css&&j.media===L.media&&j.sourceMap===L.sourceMap)return;T(L=j)}else O()}}i.exports=function(L,S){if(typeof DEBUG<"u"&&DEBUG&&typeof document!="object")throw new Error("The style-loader cannot be used in a non-browser environment");(S=S||{}).attrs=typeof S.attrs=="object"?S.attrs:{},S.singleton||typeof S.singleton=="boolean"||(S.singleton=u()),S.insertInto||(S.insertInto="head"),S.insertAt||(S.insertAt="bottom");var E=g(L,S);return p(E,S),function(T){for(var O=[],P=0;P<E.length;P++){var U=E[P];(j=s[U.id]).refs--,O.push(j)}for(T&&p(g(T,S),S),P=0;P<O.length;P++){var j;if((j=O[P]).refs===0){for(var q=0;q<j.parts.length;q++)j.parts[q]();delete s[j.id]}}}};var C,x=(C=[],function(L,S){return C[L]=S,C.filter(Boolean).join(`
`)});function R(L,S,E,T){var O=E?"":T.css;if(L.styleSheet)L.styleSheet.cssText=x(S,O);else{var P=document.createTextNode(O),U=L.childNodes;U[S]&&L.removeChild(U[S]),U.length?L.insertBefore(P,U[S]):L.appendChild(P)}}function N(L,S){var E=S.css,T=S.media;if(T&&L.setAttribute("media",T),L.styleSheet)L.styleSheet.cssText=E;else{for(;L.firstChild;)L.removeChild(L.firstChild);L.appendChild(document.createTextNode(E))}}function D(L,S,E){var T=E.css,O=E.sourceMap,P=S.convertToAbsoluteUrls===void 0&&O;(S.convertToAbsoluteUrls||P)&&(T=h(T)),O&&(T+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(O))))+" */");var U=new Blob([T],{type:"text/css"}),j=L.href;L.href=URL.createObjectURL(U),j&&URL.revokeObjectURL(j)}},function(i,t){i.exports=function(e){var n=typeof window<"u"&&window.location;if(!n)throw new Error("fixUrls requires window.location");if(!e||typeof e!="string")return e;var r=n.protocol+"//"+n.host,s=r+n.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(u,l){var c,f=l.trim().replace(/^"(.*)"$/,function(d,v){return v}).replace(/^'(.*)'$/,function(d,v){return v});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(f)?u:(c=f.indexOf("//")===0?f:f.indexOf("/")===0?r+f:s+f.replace(/^\.\//,""),"url("+JSON.stringify(c)+")")})}}])})})(rs);var il=rs.exports;const nl=cn(il);function rl(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="-5 -11 40 40" width="40" height="40">
  <path fill="#f85959" transform="scale(0.8 0.8)" d="M36.5,18.73a1.19,1.19,0,0,0,1-1.14V16.33a1.2,1.2,0,0,0-1-1.13l-.61-.08a1.75,1.75,0,0,1-1.3-.86l-.21-.36-.2-.36A1.72,1.72,0,0,1,34,12l.23-.58a1.18,1.18,0,0,0-.5-1.42l-1.1-.62a1.18,1.18,0,0,0-1.47.3l-.39.51a1.82,1.82,0,0,1-1.41.72c-.44,0-1.88-.27-2.22-.7l-.39-.49a1.18,1.18,0,0,0-1.48-.28l-1.09.64a1.19,1.19,0,0,0-.47,1.43l.25.59a1.87,1.87,0,0,1-.08,1.58c-.26.37-1.17,1.5-1.71,1.58l-.63.09a1.19,1.19,0,0,0-1,1.14l0,1.27a1.17,1.17,0,0,0,1,1.12l.61.08a1.74,1.74,0,0,1,1.3.87l.21.36.2.35A1.69,1.69,0,0,1,24,22.08l-.23.59a1.19,1.19,0,0,0,.5,1.42l1.1.62a1.19,1.19,0,0,0,1.48-.31l.38-.5a1.83,1.83,0,0,1,1.41-.72c.44,0,1.88.25,2.22.69l.39.49a1.18,1.18,0,0,0,1.48.28L33.86,24a1.19,1.19,0,0,0,.47-1.43L34.09,22a1.84,1.84,0,0,1,.07-1.58c.26-.37,1.17-1.5,1.72-1.58ZM31,18.94a2.76,2.76,0,0,1-4.65-1.2A2.71,2.71,0,0,1,27,15.13a2.76,2.76,0,0,1,4.64,1.2A2.7,2.7,0,0,1,31,18.94Z"/>
  <path fill="#f85959" transform="scale(0.8 0.8)" d="M32,0H3.59A3.59,3.59,0,0,0,0,3.59v17A3.59,3.59,0,0,0,3.59,24.2H19.72a12.59,12.59,0,0,1-.81-1.2A11.73,11.73,0,0,1,35.54,7.28V3.59A3.59,3.59,0,0,0,32,0ZM13,14.18H4.29a1.52,1.52,0,0,1,0-3H13a1.52,1.52,0,0,1,0,3ZM16.45,8H4.29a1.51,1.51,0,0,1,0-3H16.45a1.51,1.51,0,1,1,0,3Z"/>
</svg>
`,"image/svg+xml").firstChild}var $r=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),e.set={speed:1,area:{},opacity:1,fonSize:"middle"},e}return $(i,[{key:"afterCreate",value:function(){ae.device==="mobile"?this.activeEvent="click":this.activeEvent="mouseenter",this.onStateChange=this.onStateChange.bind(this),this.onToggle=this.onToggle.bind(this),this.bind(this.activeEvent,this.onToggle),this.bind("mouseleave",this.onToggle),this.appendChild(".xgplayer-panel-icon",rl())}},{key:"onStateChange",value:function(e){this.config.onChangeSet&&this.config.onChangeSet(this.set)}},{key:"onToggle",value:function(e){e.preventDefault(),e.stopPropagation(),_.hasClass(this.root,"slider-show")?_.removeClass(this.root,"slider-show"):_.addClass(this.root,"slider-show")}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.onStateChange)}},{key:"render",value:function(){return`
      <xg-icon class="xgplayer-panel">
          <xg-panel-icon class="xgplayer-panel-icon">
          </xg-panel-icon>
          <xg-panel-slider class="xgplayer-panel-slider">
            <xg-hidemode class="xgplayer-hidemode">
              <p class="xgplayer-hidemode-font">屏蔽类型</p>
              <ul class="xgplayer-hidemode-radio">
                <li class="xgplayer-hidemode-scroll" id="false">滚动</li><li class="xgplayer-hidemode-top" id="false">顶部</li><li class="xgplayer-hidemode-bottom" id="false">底部</li><li class="xgplayer-hidemode-color" id="false">色彩</li>
              </ul>
            </xg-hidemode>
            <xg-transparency class="xgplayer-transparency">
              <span>不透明度</span>
              <input class="xgplayer-transparency-line xgplayer-transparency-color xgplayer-transparency-bar xgplayer-transparency-gradient" type="range" min="0" max="100" step="0.1" value="50"></input>
            </xg-transparency>
            <xg-showarea class="xgplayer-showarea">
              <div class="xgplayer-showarea-name">显示区域</div>
              <div class="xgplayer-showarea-control">
                <div class="xgplayer-showarea-control-up">
                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-onequarters">1/4</span>
                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-twoquarters selected-color">1/2</span>
                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-threequarters">3/4</span>
                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-full">1</span>
                </div>
                <div class="xgplayer-showarea-control-down">
                  <div class="xgplayer-showarea-control-down-dots">
                    <span class="xgplayer-showarea-onequarters-dot"></span>
                    <span class="xgplayer-showarea-twoquarters-dot"></span>
                    <span class="xgplayer-showarea-threequarters-dot"></span>
                    <span class="xgplayer-showarea-full-dot"></span>
                  </div>
                  <input class="xgplayer-showarea-line xgplayer-showarea-color xgplayer-showarea-bar xgplayer-gradient" type="range" min="1" max="4" step="1" value="1">
                </div>
              </div>
            </xg-showarea>
            <xg-danmuspeed class="xgplayer-danmuspeed">
              <div class="xgplayer-danmuspeed-name">弹幕速度</div>
              <div class="xgplayer-danmuspeed-control">
                <div class="xgplayer-danmuspeed-control-up">
                  <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-small">慢</span>
                  <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-middle selected-color">中</span>
                  <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-large">快</span>
                </div>
                <div class="xgplayer-danmuspeed-control-down">
                  <div class="xgplayer-danmuspeed-control-down-dots">
                    <span class="xgplayer-danmuspeed-small-dot"></span>
                    <span class="xgplayer-danmuspeed-middle-dot"></span>
                    <span class="xgplayer-danmuspeed-large-dot"></span>
                  </div>
                  <input class="xgplayer-danmuspeed-line xgplayer-danmuspeed-color xgplayer-danmuspeed-bar xgplayer-gradient" type="range" min="50" max="150" step="50" value="100">
                </div>
              </div>
            </xg-danmuspeed>
            <xg-danmufont class="xgplayer-danmufont">
              <div class="xgplayer-danmufont-name">字体大小</div>
              <div class="xgplayer-danmufont-control">
                <div class="xgplayer-danmufont-control-up">
                  <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-small">小</span>
                  <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-middle">中</span>
                  <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-large selected-color">大</span>
                </div>
                <div class="xgplayer-danmufont-control-down">
                  <div class="xgplayer-danmufont-control-down-dots">
                    <span class="xgplayer-danmufont-small-dot"></span>
                    <span class="xgplayer-danmufont-middle-dot"></span>
                    <span class="xgplayer-danmufont-large-dot"></span>
                  </div>
                  <input class="xgplayer-danmufont-line xgplayer-danmufont-color xgplayer-danmufont-bar xgplayer-gradient" type="range" min="20" max="30" step="5" value="25">
                </div>
              </div>
            </xg-danmufont>
          </xg-panel-slider>
      </xg-icon>`}}],[{key:"pluginName",get:function(){return"danmuPanel"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:11,onChangeSet:function(n){console.log("DanmuPanel:".concat(n))},speed:1,area:{},opacity:1,fonSize:"middle"}}}]),i}(ee),Kr=`<dk-switch class="danmu-switch">
<span class="txt">弹</span>
</dk-switch>`,Yr=function(a){X(i,a);var o=Z(i);function i(){return W(this,i),o.apply(this,arguments)}return $(i,[{key:"afterCreate",value:function(){this.initIcons(),this.onStateChange=this.onStateChange.bind(this),this.bind(["click","touchend"],this.onStateChange)}},{key:"registerIcons",value:function(){return{openDanmu:{icon:Kr,class:"danmu-switch-open"},closeDanmu:{icon:Kr,class:"danmu-switch-closed"}}}},{key:"switchState",value:function(e){e?this.setAttr("data-state","active"):this.setAttr("data-state","normal"),this.switchTips(e)}},{key:"initIcons",value:function(){var e=this.icons,n=this.find(".xgplayer-icon");n.appendChild(e.openDanmu),n.appendChild(e.closeDanmu)}},{key:"switchTips",value:function(e){var n=this.find(".xg-tips");n&&this.changeLangTextKey(n,e?"OFF":"OPEN")}},{key:"onStateChange",value:function(e){e.preventDefault(),e.stopPropagation();var n=this.root.getAttribute("data-state"),r=n==="active";this.switchState(!r),this.config.onSwitch&&this.config.onSwitch(e,!r)}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="OPEN";return`
    <xg-icon class="danmu-icon">
      <div class="xgplayer-icon">
      </div>
      `.concat(kt(this,e,this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"danmuIcon"}},{key:"defaultConfig",get:function(){return{position:pe.CONTROLS_RIGHT,index:11,onSwitch:function(n,r){}}}}]),i}(ee),qr=300,al=function(a){X(i,a);var o=Z(i);function i(t){var e;return W(this,i),e=o.call(this,t),e.danmujs=null,e.danmuPanel=null,e.isOpen=!1,e.seekCost=0,e.intervalId=0,e.isUseClose=!1,e}return $(i,[{key:"afterCreate",value:function(){var e=this;this.playerConfig.isLive&&(this.config.isLive=!0),this.initDanmu(),this.registerExtIcons(),this.once(Le,function(){e.config.defaultOpen&&!e.isUseClose&&e.start()}),this.on(jt,function(){e.isOpen&&e.danmujs&&e.danmujs.pause()}),this.on(Be,function(){e.isOpen&&e.danmujs&&e.danmujs.play()}),this.on(ki,function(){e.seekCost=window.performance.now(),!e.config.isLive&&e.danmujs&&e.danmujs.stop()}),this.on(_t,function(){e.resize()}),this.on(ct,function(){if(!(!e.danmujs||!e.isOpen)){e.intervalId&&(_.clearTimeout(e,e.intervalId),e.intervalId=null);var n=window.performance.now();n-e.seekCost>qr?e.danmujs.start():e.intervalId=_.setTimeout(e,function(){e.danmujs.start(),e.intervalId=null},qr)}})}},{key:"onPluginsReady",value:function(){var e=this.player.plugins.pc;e&&(e.onVideoDblClick&&this.bind("dblclick",e.onVideoDblClick),e.onVideoClick&&this.bind("click",e.onVideoClick))}},{key:"initDanmu",value:function(){var e=this.player,n=this.config,r=this.config,s=r.channelSize,u=r.fontSize,l=r.opacity,c=r.mouseControl,f=r.mouseControlPause,d=r.area,v=r.defaultOff,h={container:this.root,player:e.media,comments:this.config.comments,live:n.isLive,defaultOff:v,area:d,mouseControl:c,mouseControlPause:f};n.ext&&Object.keys(n.ext).map(function(g){h[g]=n.ext[g]});var p=new nl(h);this.danmujs=p,e.danmu=p,this.setFontSize(u,s),this.setArea(d),this.resize(),l!==1&&this.setOpacity(l)}},{key:"registerExtIcons",value:function(){var e=this,n=this.player,r=this.config;if(r.panel){var s={config:{onChangeset:function(f){e.changeSet(f)}}};this.danmuPanel=n.controls.registerPlugin($r,s,$r.pluginName)}var u=r.switchConfig;if(!r.closeDefaultBtn){var l={config:{onSwitch:function(f,d){e.onSwitch(f,d)}}};Object.keys(u).map(function(c){l.config[c]=u[c]}),this.danmuButton=n.controls.registerPlugin(Yr,l,Yr.pluginName),this.config.defaultOpen&&this.danmuButton.switchState(!0)}}},{key:"changeSet",value:function(e){}},{key:"onSwitch",value:function(e,n){this.emitUserAction(e,"switch_danmu",{prop:"isOpen",from:!n,to:n}),n?this.start():this.stop()}},{key:"start",value:function(){var e=this;this.isOpen||!this.danmujs||(this.isUseClose=!1,this.show(),this.resize(),_.setTimeout(this,function(){e.danmujs.start(),e.player.paused&&e.danmujs.pause(),e.isOpen=!0},0))}},{key:"stop",value:function(){this.isUseClose=!0,!(!this.isOpen||!this.danmujs)&&(this.danmujs.stop(),this.config.isLive&&this.clear(),this.isOpen=!1,this.hide())}},{key:"clear",value:function(){this.danmujs&&this.danmujs.clear()}},{key:"setCommentLike",value:function(e,n){this.danmujs&&this.danmujs.setCommentLike(e,n)}},{key:"setCommentDuration",value:function(e,n){this.danmujs&&this.danmujs.setCommentDuration(e,n)}},{key:"setAllDuration",value:function(e,n){this.danmujs&&this.danmujs.setAllDuration(e,n)}},{key:"setCommentID",value:function(e,n){this.danmujs&&this.danmujs.setCommentID(e,n)}},{key:"hideMode",value:function(e){this.danmujs&&this.danmujs.hide(e)}},{key:"showMode",value:function(e){this.danmujs&&this.danmujs.show(e)}},{key:"setArea",value:function(e){this.danmujs&&this.danmujs.setArea(e)}},{key:"setOpacity",value:function(e){this.danmujs&&this.danmujs.setOpacity(e)}},{key:"setFontSize",value:function(e,n){this.danmujs&&this.danmujs.setFontSize(e,n)}},{key:"resize",value:function(){this.danmujs&&this.danmujs.resize()}},{key:"sendComment",value:function(e){this.danmujs&&this.danmujs.sendComment(e)}},{key:"updateComments",value:function(e,n){this.danmujs&&this.danmujs.updateComments(e,n)}},{key:"hideIcon",value:function(){this.danmuButton&&this.danmuButton.hide()}},{key:"showIcon",value:function(){this.danmuButton&&this.danmuButton.show()}},{key:"destroy",value:function(){this.danmujs.stop(),this.danmujs.destroy(),this.danmujs=null,this.player.danmu=null;var e=this.danmuButton,n=this.danmuPanel;this.danmuButton&&this.danmuButton.root&&e.__destroy&&e.__destroy(),this.danmuPanel&&this.danmuPanel.root&&n.__destroy&&n.__destroy(),this.danmuButton=null,this.danmuPanel=null}},{key:"render",value:function(){return`<xg-danmu class="xgplayer-danmu">
    </xg-danmu>`}}],[{key:"pluginName",get:function(){return"danmu"}},{key:"defaultConfig",get:function(){return{comments:[],area:{start:0,end:1},closeDefaultBtn:!1,defaultOff:!1,panel:!1,panelConfig:{},switchConfig:{},defaultOpen:!0,isLive:!1,channelSize:24,fontSize:14,opacity:1,mouseControl:!1,mouseControlPause:!1,ext:{},style:{}}}}]),i}(ee);const sl=xs({name:"EleXgPlayer",props:{config:{type:Object,required:!0}},emits:{player:a=>!0},setup(a,{emit:o}){let i=null;const t=ot(null),e=()=>{var r;n(),t.value&&((r=a.config)!=null&&r.url)&&(i=new rt(Object.assign({},a.config,{el:t.value})),o("player",i))},n=()=>{i&&typeof i.destroy=="function"&&(i.destroy(),i=null)};return Ps(()=>{e()}),As(()=>{n()}),Is(()=>a.config,()=>{e()}),{rootRef:t,player:i}}}),ol=(a,o)=>{const i=a.__vccOpts||a;for(const[t,e]of o)i[t]=e;return i},ul={ref:"rootRef"};function ll(a,o,i,t,e,n){return ut(),Ca("div",ul,null,512)}const gn=ol(sl,[["render",ll]]),cl={style:{"margin-bottom":"16px"}},Ri="https://s1.pstatp.com/cdn/expire-1-M/byted-player-videos/1.0.0/xgplayer-demo.mp4",Xr="https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/solution/general-video/css/img/scene/1.png",fl="https://n.v.netease.com/2017/1212_erce/xjy_1080p.mp4",hl="https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/solution/general-video/css/img/scene/6.png",dl={__name:"demo-basic",setup(a){const o=ot({lang:"zh-cn",fluid:!0,url:Ri,poster:Xr,playbackRate:[.5,1,1.5,2],pip:!0,volume:1,autoplay:!1});let i;const t=u=>{i=u},e=()=>{i&&i.paused&&i.play()},n=()=>{i&&i.pause()},r=()=>{i&&i.replay()},s=()=>{o.value={...o.value,url:o.value.url==Ri?fl:Ri,poster:o.value.url==Ri?hl:Xr,autoplay:!0}};return(u,l)=>{const c=nr,f=gn,d=fn;return ut(),Dt(d,{header:"基础演示"},{default:_e(()=>[At("div",cl,[he(c,{type:"primary",class:"ele-btn-icon",onClick:e},{default:_e(()=>[Ot(" 播放 ")]),_:1}),he(c,{type:"primary",class:"ele-btn-icon",onClick:n},{default:_e(()=>[Ot(" 暂停 ")]),_:1}),he(c,{type:"primary",class:"ele-btn-icon",onClick:r},{default:_e(()=>[Ot(" 重新播放 ")]),_:1}),he(c,{type:"primary",class:"ele-btn-icon",onClick:s},{default:_e(()=>[Ot(" 切换视频源 ")]),_:1})]),he(f,{config:o.value,onPlayer:t},null,8,["config"])]),_:1})}}},pl={__name:"demo-danmu",setup(a){const o=Ds({lang:"zh-cn",fluid:!0,volume:1,url:"https://n.v.netease.com/2017/1212_erce/xjy_1080p.mp4",poster:"https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/solution/general-video/css/img/scene/6.png",plugins:[al],danmu:{comments:[{id:"1",start:2500,txt:"空降",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"2",start:3500,txt:"空降",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"3",start:4500,txt:"简直碉堡了",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"4",start:5e3,txt:"弹幕护体",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"5",start:6500,txt:"前方高能",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"6",start:9e3,txt:"弹幕护体",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"7",start:11e3,txt:"666666666",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"8",start:12500,txt:"简直碉堡了",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"9",start:15500,txt:"弹幕护体",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"10",start:16500,txt:"666666666",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"11",start:18e3,txt:"画面太美不敢看",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"12",start:20500,txt:"666666666",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"13",start:22e3,txt:"画面太美不敢看",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"14",start:25500,txt:"666666666",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}},{id:"15",start:26e3,txt:"前方高能666",duration:15e3,color:!0,style:{color:"#ffcd08",fontSize:"20px"}}]}}),i=ot(!1),t=ot("");let e;const n=s=>{e=s,e.on("play",()=>{i.value=!0})},r=()=>{if(!e)return;if(!t.value){Os.error("请输入弹幕内容");return}e.getPlugin("danmu").sendComment({id:Date.now(),duration:15e3,color:!0,start:e.currentTime*1e3,txt:t.value,style:{color:"#fa1f41",fontSize:"20px",border:"solid 1px #fa1f41"}}),t.value=""};return(s,u)=>{const l=Ls,c=nr,f=Rs,d=gn,v=fn;return ut(),Dt(v,{header:"显示弹幕"},{default:_e(()=>[he(f,{style:{"margin-bottom":"16px"}},{default:_e(()=>[he(l,{style:{width:"160px"},modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=h=>t.value=h),placeholder:"请输入弹幕内容",disabled:!i.value},null,8,["modelValue","disabled"]),he(c,{type:"primary",disabled:!i.value,class:"ele-btn-icon",onClick:r},{default:_e(()=>[Ot(" 发射 ")]),_:1},8,["disabled"])]),_:1}),he(d,{config:o,onPlayer:n},null,8,["config"])]),_:1})}}};function vl(a,o){var i=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(i!=null){var t,e,n,r,s=[],u=!0,l=!1;try{if(n=(i=i.call(a)).next,o===0){if(Object(i)!==i)return;u=!1}else for(;!(u=(t=n.call(i)).done)&&(s.push(t.value),s.length!==o);u=!0);}catch(c){l=!0,e=c}finally{try{if(!u&&i.return!=null&&(r=i.return(),Object(r)!==r))return}finally{if(l)throw e}}return s}}function Zr(a,o){var i=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)}return i}function de(a){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?Zr(Object(i),!0).forEach(function(t){A(a,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):Zr(Object(i)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(i,t))})}return a}function G(){G=function(){return a};var a={},o=Object.prototype,i=o.hasOwnProperty,t=Object.defineProperty||function(S,E,T){S[E]=T.value},e=typeof Symbol=="function"?Symbol:{},n=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",s=e.toStringTag||"@@toStringTag";function u(S,E,T){return Object.defineProperty(S,E,{value:T,enumerable:!0,configurable:!0,writable:!0}),S[E]}try{u({},"")}catch(S){u=function(E,T,O){return E[T]=O}}function l(S,E,T,O){var P=E&&E.prototype instanceof d?E:d,U=Object.create(P.prototype),j=new N(O||[]);return t(U,"_invoke",{value:w(S,T,j)}),U}function c(S,E,T){try{return{type:"normal",arg:S.call(E,T)}}catch(O){return{type:"throw",arg:O}}}a.wrap=l;var f={};function d(){}function v(){}function h(){}var p={};u(p,n,function(){return this});var g=Object.getPrototypeOf,y=g&&g(g(D([])));y&&y!==o&&i.call(y,n)&&(p=y);var m=h.prototype=d.prototype=Object.create(p);function b(S){["next","throw","return"].forEach(function(E){u(S,E,function(T){return this._invoke(E,T)})})}function k(S,E){function T(P,U,j,q){var ue=c(S[P],S,U);if(ue.type!=="throw"){var V=ue.arg,ve=V.value;return ve&&typeof ve=="object"&&i.call(ve,"__await")?E.resolve(ve.__await).then(function(K){T("next",K,j,q)},function(K){T("throw",K,j,q)}):E.resolve(ve).then(function(K){V.value=K,j(V)},function(K){return T("throw",K,j,q)})}q(ue.arg)}var O;t(this,"_invoke",{value:function(P,U){function j(){return new E(function(q,ue){T(P,U,q,ue)})}return O=O?O.then(j,j):j()}})}function w(S,E,T){var O="suspendedStart";return function(P,U){if(O==="executing")throw new Error("Generator is already running");if(O==="completed"){if(P==="throw")throw U;return L()}for(T.method=P,T.arg=U;;){var j=T.delegate;if(j){var q=C(j,T);if(q){if(q===f)continue;return q}}if(T.method==="next")T.sent=T._sent=T.arg;else if(T.method==="throw"){if(O==="suspendedStart")throw O="completed",T.arg;T.dispatchException(T.arg)}else T.method==="return"&&T.abrupt("return",T.arg);O="executing";var ue=c(S,E,T);if(ue.type==="normal"){if(O=T.done?"completed":"suspendedYield",ue.arg===f)continue;return{value:ue.arg,done:T.done}}ue.type==="throw"&&(O="completed",T.method="throw",T.arg=ue.arg)}}}function C(S,E){var T=E.method,O=S.iterator[T];if(O===void 0)return E.delegate=null,T==="throw"&&S.iterator.return&&(E.method="return",E.arg=void 0,C(S,E),E.method==="throw")||T!=="return"&&(E.method="throw",E.arg=new TypeError("The iterator does not provide a '"+T+"' method")),f;var P=c(O,S.iterator,E.arg);if(P.type==="throw")return E.method="throw",E.arg=P.arg,E.delegate=null,f;var U=P.arg;return U?U.done?(E[S.resultName]=U.value,E.next=S.nextLoc,E.method!=="return"&&(E.method="next",E.arg=void 0),E.delegate=null,f):U:(E.method="throw",E.arg=new TypeError("iterator result is not an object"),E.delegate=null,f)}function x(S){var E={tryLoc:S[0]};1 in S&&(E.catchLoc=S[1]),2 in S&&(E.finallyLoc=S[2],E.afterLoc=S[3]),this.tryEntries.push(E)}function R(S){var E=S.completion||{};E.type="normal",delete E.arg,S.completion=E}function N(S){this.tryEntries=[{tryLoc:"root"}],S.forEach(x,this),this.reset(!0)}function D(S){if(S){var E=S[n];if(E)return E.call(S);if(typeof S.next=="function")return S;if(!isNaN(S.length)){var T=-1,O=function P(){for(;++T<S.length;)if(i.call(S,T))return P.value=S[T],P.done=!1,P;return P.value=void 0,P.done=!0,P};return O.next=O}}return{next:L}}function L(){return{value:void 0,done:!0}}return v.prototype=h,t(m,"constructor",{value:h,configurable:!0}),t(h,"constructor",{value:v,configurable:!0}),v.displayName=u(h,s,"GeneratorFunction"),a.isGeneratorFunction=function(S){var E=typeof S=="function"&&S.constructor;return!!E&&(E===v||(E.displayName||E.name)==="GeneratorFunction")},a.mark=function(S){return Object.setPrototypeOf?Object.setPrototypeOf(S,h):(S.__proto__=h,u(S,s,"GeneratorFunction")),S.prototype=Object.create(m),S},a.awrap=function(S){return{__await:S}},b(k.prototype),u(k.prototype,r,function(){return this}),a.AsyncIterator=k,a.async=function(S,E,T,O,P){P===void 0&&(P=Promise);var U=new k(l(S,E,T,O),P);return a.isGeneratorFunction(E)?U:U.next().then(function(j){return j.done?j.value:U.next()})},b(m),u(m,s,"Generator"),u(m,n,function(){return this}),u(m,"toString",function(){return"[object Generator]"}),a.keys=function(S){var E=Object(S),T=[];for(var O in E)T.push(O);return T.reverse(),function P(){for(;T.length;){var U=T.pop();if(U in E)return P.value=U,P.done=!1,P}return P.done=!0,P}},a.values=D,N.prototype={constructor:N,reset:function(S){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!S)for(var E in this)E.charAt(0)==="t"&&i.call(this,E)&&!isNaN(+E.slice(1))&&(this[E]=void 0)},stop:function(){this.done=!0;var S=this.tryEntries[0].completion;if(S.type==="throw")throw S.arg;return this.rval},dispatchException:function(S){if(this.done)throw S;var E=this;function T(ue,V){return U.type="throw",U.arg=S,E.next=ue,V&&(E.method="next",E.arg=void 0),!!V}for(var O=this.tryEntries.length-1;O>=0;--O){var P=this.tryEntries[O],U=P.completion;if(P.tryLoc==="root")return T("end");if(P.tryLoc<=this.prev){var j=i.call(P,"catchLoc"),q=i.call(P,"finallyLoc");if(j&&q){if(this.prev<P.catchLoc)return T(P.catchLoc,!0);if(this.prev<P.finallyLoc)return T(P.finallyLoc)}else if(j){if(this.prev<P.catchLoc)return T(P.catchLoc,!0)}else{if(!q)throw new Error("try statement without catch or finally");if(this.prev<P.finallyLoc)return T(P.finallyLoc)}}}},abrupt:function(S,E){for(var T=this.tryEntries.length-1;T>=0;--T){var O=this.tryEntries[T];if(O.tryLoc<=this.prev&&i.call(O,"finallyLoc")&&this.prev<O.finallyLoc){var P=O;break}}P&&(S==="break"||S==="continue")&&P.tryLoc<=E&&E<=P.finallyLoc&&(P=null);var U=P?P.completion:{};return U.type=S,U.arg=E,P?(this.method="next",this.next=P.finallyLoc,f):this.complete(U)},complete:function(S,E){if(S.type==="throw")throw S.arg;return S.type==="break"||S.type==="continue"?this.next=S.arg:S.type==="return"?(this.rval=this.arg=S.arg,this.method="return",this.next="end"):S.type==="normal"&&E&&(this.next=E),f},finish:function(S){for(var E=this.tryEntries.length-1;E>=0;--E){var T=this.tryEntries[E];if(T.finallyLoc===S)return this.complete(T.completion,T.afterLoc),R(T),f}},catch:function(S){for(var E=this.tryEntries.length-1;E>=0;--E){var T=this.tryEntries[E];if(T.tryLoc===S){var O=T.completion;if(O.type==="throw"){var P=O.arg;R(T)}return P}}throw new Error("illegal catch attempt")},delegateYield:function(S,E,T){return this.delegate={iterator:D(S),resultName:E,nextLoc:T},this.method==="next"&&(this.arg=void 0),f}},a}function tn(a){"@babel/helpers - typeof";return tn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},tn(a)}function Jr(a,o,i,t,e,n,r){try{var s=a[n](r),u=s.value}catch(l){i(l);return}s.done?o(u):Promise.resolve(u).then(t,e)}function fe(a){return function(){var o=this,i=arguments;return new Promise(function(t,e){var n=a.apply(o,i);function r(u){Jr(n,t,e,r,s,"next",u)}function s(u){Jr(n,t,e,r,s,"throw",u)}r(void 0)})}}function Ce(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function Qr(a,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,ss(t.key),t)}}function xe(a,o,i){return o&&Qr(a.prototype,o),i&&Qr(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a}function A(a,o,i){return o=ss(o),o in a?Object.defineProperty(a,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[o]=i,a}function mn(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),o&&Yn(a,o)}function nn(a){return nn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},nn(a)}function Yn(a,o){return Yn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Yn(a,o)}function gl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function te(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function ml(a,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return te(a)}function yn(a){var o=gl();return function(){var t=nn(a),e;if(o){var n=nn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ml(this,e)}}function bt(a,o){return bl(a)||vl(a,o)||as(a,o)||El()}function yl(a){return _l(a)||Sl(a)||as(a)||kl()}function _l(a){if(Array.isArray(a))return qn(a)}function bl(a){if(Array.isArray(a))return a}function Sl(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function as(a,o){if(a){if(typeof a=="string")return qn(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return qn(a,o)}}function qn(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,t=new Array(o);i<o;i++)t[i]=a[i];return t}function kl(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function El(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wl(a,o){if(typeof a!="object"||a===null)return a;var i=a[Symbol.toPrimitive];if(i!==void 0){var t=i.call(a,o||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(a)}function ss(a){var o=wl(a,"string");return typeof o=="symbol"?o:String(o)}function ea(a,o){var i=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)}return i}function yi(a){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?ea(Object(i),!0).forEach(function(t){B(a,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):ea(Object(i)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(i,t))})}return a}function Te(){Te=function(){return a};var a={},o=Object.prototype,i=o.hasOwnProperty,t=Object.defineProperty||function(S,E,T){S[E]=T.value},e=typeof Symbol=="function"?Symbol:{},n=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",s=e.toStringTag||"@@toStringTag";function u(S,E,T){return Object.defineProperty(S,E,{value:T,enumerable:!0,configurable:!0,writable:!0}),S[E]}try{u({},"")}catch(S){u=function(E,T,O){return E[T]=O}}function l(S,E,T,O){var P=E&&E.prototype instanceof d?E:d,U=Object.create(P.prototype),j=new N(O||[]);return t(U,"_invoke",{value:w(S,T,j)}),U}function c(S,E,T){try{return{type:"normal",arg:S.call(E,T)}}catch(O){return{type:"throw",arg:O}}}a.wrap=l;var f={};function d(){}function v(){}function h(){}var p={};u(p,n,function(){return this});var g=Object.getPrototypeOf,y=g&&g(g(D([])));y&&y!==o&&i.call(y,n)&&(p=y);var m=h.prototype=d.prototype=Object.create(p);function b(S){["next","throw","return"].forEach(function(E){u(S,E,function(T){return this._invoke(E,T)})})}function k(S,E){function T(P,U,j,q){var ue=c(S[P],S,U);if(ue.type!=="throw"){var V=ue.arg,ve=V.value;return ve&&typeof ve=="object"&&i.call(ve,"__await")?E.resolve(ve.__await).then(function(K){T("next",K,j,q)},function(K){T("throw",K,j,q)}):E.resolve(ve).then(function(K){V.value=K,j(V)},function(K){return T("throw",K,j,q)})}q(ue.arg)}var O;t(this,"_invoke",{value:function(P,U){function j(){return new E(function(q,ue){T(P,U,q,ue)})}return O=O?O.then(j,j):j()}})}function w(S,E,T){var O="suspendedStart";return function(P,U){if(O==="executing")throw new Error("Generator is already running");if(O==="completed"){if(P==="throw")throw U;return L()}for(T.method=P,T.arg=U;;){var j=T.delegate;if(j){var q=C(j,T);if(q){if(q===f)continue;return q}}if(T.method==="next")T.sent=T._sent=T.arg;else if(T.method==="throw"){if(O==="suspendedStart")throw O="completed",T.arg;T.dispatchException(T.arg)}else T.method==="return"&&T.abrupt("return",T.arg);O="executing";var ue=c(S,E,T);if(ue.type==="normal"){if(O=T.done?"completed":"suspendedYield",ue.arg===f)continue;return{value:ue.arg,done:T.done}}ue.type==="throw"&&(O="completed",T.method="throw",T.arg=ue.arg)}}}function C(S,E){var T=E.method,O=S.iterator[T];if(O===void 0)return E.delegate=null,T==="throw"&&S.iterator.return&&(E.method="return",E.arg=void 0,C(S,E),E.method==="throw")||T!=="return"&&(E.method="throw",E.arg=new TypeError("The iterator does not provide a '"+T+"' method")),f;var P=c(O,S.iterator,E.arg);if(P.type==="throw")return E.method="throw",E.arg=P.arg,E.delegate=null,f;var U=P.arg;return U?U.done?(E[S.resultName]=U.value,E.next=S.nextLoc,E.method!=="return"&&(E.method="next",E.arg=void 0),E.delegate=null,f):U:(E.method="throw",E.arg=new TypeError("iterator result is not an object"),E.delegate=null,f)}function x(S){var E={tryLoc:S[0]};1 in S&&(E.catchLoc=S[1]),2 in S&&(E.finallyLoc=S[2],E.afterLoc=S[3]),this.tryEntries.push(E)}function R(S){var E=S.completion||{};E.type="normal",delete E.arg,S.completion=E}function N(S){this.tryEntries=[{tryLoc:"root"}],S.forEach(x,this),this.reset(!0)}function D(S){if(S){var E=S[n];if(E)return E.call(S);if(typeof S.next=="function")return S;if(!isNaN(S.length)){var T=-1,O=function P(){for(;++T<S.length;)if(i.call(S,T))return P.value=S[T],P.done=!1,P;return P.value=void 0,P.done=!0,P};return O.next=O}}return{next:L}}function L(){return{value:void 0,done:!0}}return v.prototype=h,t(m,"constructor",{value:h,configurable:!0}),t(h,"constructor",{value:v,configurable:!0}),v.displayName=u(h,s,"GeneratorFunction"),a.isGeneratorFunction=function(S){var E=typeof S=="function"&&S.constructor;return!!E&&(E===v||(E.displayName||E.name)==="GeneratorFunction")},a.mark=function(S){return Object.setPrototypeOf?Object.setPrototypeOf(S,h):(S.__proto__=h,u(S,s,"GeneratorFunction")),S.prototype=Object.create(m),S},a.awrap=function(S){return{__await:S}},b(k.prototype),u(k.prototype,r,function(){return this}),a.AsyncIterator=k,a.async=function(S,E,T,O,P){P===void 0&&(P=Promise);var U=new k(l(S,E,T,O),P);return a.isGeneratorFunction(E)?U:U.next().then(function(j){return j.done?j.value:U.next()})},b(m),u(m,s,"Generator"),u(m,n,function(){return this}),u(m,"toString",function(){return"[object Generator]"}),a.keys=function(S){var E=Object(S),T=[];for(var O in E)T.push(O);return T.reverse(),function P(){for(;T.length;){var U=T.pop();if(U in E)return P.value=U,P.done=!1,P}return P.done=!0,P}},a.values=D,N.prototype={constructor:N,reset:function(S){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!S)for(var E in this)E.charAt(0)==="t"&&i.call(this,E)&&!isNaN(+E.slice(1))&&(this[E]=void 0)},stop:function(){this.done=!0;var S=this.tryEntries[0].completion;if(S.type==="throw")throw S.arg;return this.rval},dispatchException:function(S){if(this.done)throw S;var E=this;function T(ue,V){return U.type="throw",U.arg=S,E.next=ue,V&&(E.method="next",E.arg=void 0),!!V}for(var O=this.tryEntries.length-1;O>=0;--O){var P=this.tryEntries[O],U=P.completion;if(P.tryLoc==="root")return T("end");if(P.tryLoc<=this.prev){var j=i.call(P,"catchLoc"),q=i.call(P,"finallyLoc");if(j&&q){if(this.prev<P.catchLoc)return T(P.catchLoc,!0);if(this.prev<P.finallyLoc)return T(P.finallyLoc)}else if(j){if(this.prev<P.catchLoc)return T(P.catchLoc,!0)}else{if(!q)throw new Error("try statement without catch or finally");if(this.prev<P.finallyLoc)return T(P.finallyLoc)}}}},abrupt:function(S,E){for(var T=this.tryEntries.length-1;T>=0;--T){var O=this.tryEntries[T];if(O.tryLoc<=this.prev&&i.call(O,"finallyLoc")&&this.prev<O.finallyLoc){var P=O;break}}P&&(S==="break"||S==="continue")&&P.tryLoc<=E&&E<=P.finallyLoc&&(P=null);var U=P?P.completion:{};return U.type=S,U.arg=E,P?(this.method="next",this.next=P.finallyLoc,f):this.complete(U)},complete:function(S,E){if(S.type==="throw")throw S.arg;return S.type==="break"||S.type==="continue"?this.next=S.arg:S.type==="return"?(this.rval=this.arg=S.arg,this.method="return",this.next="end"):S.type==="normal"&&E&&(this.next=E),f},finish:function(S){for(var E=this.tryEntries.length-1;E>=0;--E){var T=this.tryEntries[E];if(T.finallyLoc===S)return this.complete(T.completion,T.afterLoc),R(T),f}},catch:function(S){for(var E=this.tryEntries.length-1;E>=0;--E){var T=this.tryEntries[E];if(T.tryLoc===S){var O=T.completion;if(O.type==="throw"){var P=O.arg;R(T)}return P}}throw new Error("illegal catch attempt")},delegateYield:function(S,E,T){return this.delegate={iterator:D(S),resultName:E,nextLoc:T},this.method==="next"&&(this.arg=void 0),f}},a}function ui(a){"@babel/helpers - typeof";return ui=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ui(a)}function ta(a,o,i,t,e,n,r){try{var s=a[n](r),u=s.value}catch(l){i(l);return}s.done?o(u):Promise.resolve(u).then(t,e)}function mt(a){return function(){var o=this,i=arguments;return new Promise(function(t,e){var n=a.apply(o,i);function r(u){ta(n,t,e,r,s,"next",u)}function s(u){ta(n,t,e,r,s,"throw",u)}r(void 0)})}}function Fe(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function ia(a,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,us(t.key),t)}}function Ue(a,o,i){return o&&ia(a.prototype,o),i&&ia(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a}function B(a,o,i){return o=us(o),o in a?Object.defineProperty(a,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[o]=i,a}function Ti(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),o&&_i(a,o)}function Ht(a){return Ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Ht(a)}function _i(a,o){return _i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_i(a,o)}function os(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function Vi(a,o,i){return os()?Vi=Reflect.construct.bind():Vi=function(e,n,r){var s=[null];s.push.apply(s,n);var u=Function.bind.apply(e,s),l=new u;return r&&_i(l,r.prototype),l},Vi.apply(null,arguments)}function Tl(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function rn(a){var o=typeof Map=="function"?new Map:void 0;return rn=function(t){if(t===null||!Tl(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof o<"u"){if(o.has(t))return o.get(t);o.set(t,e)}function e(){return Vi(t,arguments,Ht(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),_i(e,t)},rn(a)}function Cl(a,o){if(a==null)return{};var i={},t=Object.keys(a),e,n;for(n=0;n<t.length;n++)e=t[n],!(o.indexOf(e)>=0)&&(i[e]=a[e]);return i}function xl(a,o){if(a==null)return{};var i=Cl(a,o),t,e;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);for(e=0;e<n.length;e++)t=n[e],!(o.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(a,t)&&(i[t]=a[t])}return i}function Y(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Pl(a,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Y(a)}function Ci(a){var o=os();return function(){var t=Ht(a),e;if(o){var n=Ht(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Pl(this,e)}}function Al(a,o){for(;!Object.prototype.hasOwnProperty.call(a,o)&&(a=Ht(a),a!==null););return a}function zi(){return typeof Reflect<"u"&&Reflect.get?zi=Reflect.get.bind():zi=function(o,i,t){var e=Al(o,i);if(e){var n=Object.getOwnPropertyDescriptor(e,i);return n.get?n.get.call(arguments.length<3?o:t):n.value}},zi.apply(this,arguments)}function Il(a,o){if(a){if(typeof a=="string")return na(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return na(a,o)}}function na(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,t=new Array(o);i<o;i++)t[i]=a[i];return t}function Dl(a,o){var i=typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(!i){if(Array.isArray(a)||(i=Il(a))||o){i&&(a=i);var t=0,e=function(){};return{s:e,n:function(){return t>=a.length?{done:!0}:{done:!1,value:a[t++]}},e:function(u){throw u},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var n=!0,r=!1,s;return{s:function(){i=i.call(a)},n:function(){var u=i.next();return n=u.done,u},e:function(u){r=!0,s=u},f:function(){try{!n&&i.return!=null&&i.return()}finally{if(r)throw s}}}}function Ol(a,o){if(typeof a!="object"||a===null)return a;var i=a[Symbol.toPrimitive];if(i!==void 0){var t=i.call(a,o||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(a)}function us(a){var o=Ol(a,"string");return typeof o=="symbol"?o:String(o)}function ni(){var a,o,i=new Promise(function(t,e){a=t,o=e});return i.used=!1,i.resolve=function(){return i.used=!0,a.apply(void 0,arguments)},i.reject=function(){return i.used=!0,o.apply(void 0,arguments)},i}function ii(){try{return parseInt(performance.now(),10)}catch(a){return new Date().getTime()}}var Oe=function(){function a(){Fe(this,a)}return Ue(a,null,[{key:"start",value:function(i){return!i||!i.length||i.length===1&&i.end(0)-i.start(0)<1e-6||i.length===1&&i.start(0)<0?0:i.start(0)}},{key:"end",value:function(i){return!i||!i.length||i.length===1&&i.end(0)-i.start(0)<1e-6?0:i.end(i.length-1)}},{key:"get",value:function(i){if(i)try{return i.buffered}catch(t){}}},{key:"buffers",value:function(i,t){if(!i||!i.length)return[];for(var e=[],n=0,r=i.length;n<r;n++){var s=e.length;if(!s||!t)e.push([i.start(n),i.end(n)]);else{var u=e[s-1],l=u[1],c=i.start(n);if(c-l<=t){var f=i.end(n);f>l&&(u[1]=f)}else e.push([i.start(n),i.end(n)])}}return e}},{key:"totalLength",value:function(i){return!i||!i.length?0:i.reduce(function(t,e){return t+=e[1]-e[0]},0)}},{key:"info",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(!i||!i.length)return{start:0,end:0,buffers:[]};for(var n=0,r=0,s=0,u=0,l=0,c=0,f=0,d=a.buffers(i,e),v=0,h=d.length;v<h;v++){var p=d[v];if(t+e>=p[0]&&t<=p[1])n=p[0],r=p[1],s=v;else if(t+e<p[0]){u=p[0],l=p[1];break}else t+e>p[1]&&(c=p[0],f=p[1])}return{start:n,end:r,index:s,buffers:d,nextStart:u,nextEnd:l,prevStart:c,prevEnd:f,currentTime:t,behind:t-n,remaining:r?r-t:0,length:a.totalLength&&a.totalLength(d)}}}]),a}(),Me,oe={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},Rn=(Me={},B(Me,oe.MANIFEST,{HLS:1100,DASH:1200}),B(Me,oe.NETWORK,2100),B(Me,oe.NETWORK_TIMEOUT,2101),B(Me,oe.NETWORK_FORBIDDEN,2103),B(Me,oe.NETWORK_NOTFOUND,2104),B(Me,oe.NETWROK_RANGE_NOT_SATISFIABLE,2116),B(Me,oe.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),B(Me,oe.REMUX,{FMP4:4100,MP4:4200}),B(Me,oe.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,EME_HIJACK:5301}),B(Me,oe.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),B(Me,oe.OTHER,8e3),B(Me,oe.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),Me),be=function(a){Ti(i,a);var o=Ci(i);function i(t,e,n,r,s){var u;return Fe(this,i),u=o.call(this,s||(n==null?void 0:n.message)),u.errorType=t===oe.NETWORK_TIMEOUT?oe.NETWORK:t,u.originError=n,u.ext=r,u.errorCode=Rn[t][e]||Rn[t],u.errorMessage=u.message,u.errorCode||(u.errorType=oe.OTHER,u.errorCode=Rn[u.errorType]),u}return Ue(i,null,[{key:"create",value:function(e,n,r,s,u){return e instanceof i?e:(e instanceof Error&&(r=e,e=""),e||(e=oe.OTHER),new i(e,n,r,s,u))}},{key:"network",value:function(e){var n;return new i(e!=null&&e.isTimeout?oe.NETWORK_TIMEOUT:oe.NETWORK,null,e instanceof Error?e:null,{url:e==null?void 0:e.url,response:e==null?void 0:e.response,httpCode:e==null||(n=e.response)===null||n===void 0?void 0:n.status})}}]),i}(rn(Error)),Ll=typeof window<"u",Mi={DEBUG:1,LOG:2,WARN:3,ERROR:4},Rl=200*1024,Ml=["Boolean","Number","String","Undefined","Null","Date","Object"],ft=function(){function a(o,i){Fe(this,a),this.name=o||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(i==null?void 0:i.logCacheLevel)||3,this.logMaxSize=(i==null?void 0:i.logMaxSize)||Rl,this.logSize=0,this.logTextArray=[]}return Ue(a,[{key:"debug",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[Mi.DEBUG].concat(e)),!a.disabled&&(i=console).debug.apply(i,[this._prefix,pi()].concat(e))}},{key:"log",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[Mi.LOG].concat(e)),!a.disabled&&(i=console).log.apply(i,[this._prefix,pi()].concat(e))}},{key:"warn",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[Mi.WARN].concat(e)),!a.disabled&&(i=console).warn.apply(i,[this._prefix,pi()].concat(e))}},{key:"error",value:function(){for(var i,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logCache.apply(this,[Mi.ERROR].concat(e)),!a.disabled&&(i=console).error.apply(i,[this._prefix,pi()].concat(e))}},{key:"logCache",value:function(i){if(!(i<this.logCacheLevel)){var t="";try{for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var s=n.map(function(l){return ls(l)});t=this._prefix+pi()+JSON.stringify(s)}catch(l){return}if(i>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var u=this.logTextArray.shift();this.logSize-=u.length}}}},{key:"getLogCache",value:function(){var i=this.logTextArray.join(`
`);return this.reset(),i}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var i;a.disabled||(console.group(this._prefix),(i=console).table.apply(i,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(i){this.logCacheLevel=i}}],[{key:"enable",value:function(){a.disabled=!1}},{key:"disable",value:function(){a.disabled=!0}}]),a}();B(ft,"disabled",!0);function pi(){return new Date().toLocaleString()}function Nl(a){if(ui(a)!=="object")return a;var o=Object.prototype.toString.call(a).slice(8,-1);switch(o){case"Array":case"Uint8Array":case"ArrayBuffer":return o+"["+a.length+"]";case"Object":return"{}";default:return o}}function ls(a,o,i){i||(i=1),o||(o=2);var t={};if(!a||ui(a)!=="object")return a;var e=Object.prototype.toString.call(a).slice(8,-1);if(!Ml.includes(e))return e;if(!(i>o)){for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(i===o?t[n]=Nl(a[n]):ui(a[n])==="object"?t[n]=ls(a[n],o,i+1):t[n]=a[n]);return t}}function ra(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;try{return Ll?a&&typeof ManagedMediaSource<"u"?ManagedMediaSource:window.MediaSource:null}catch(o){}}function Mn(a){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(a))}var Ni={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},Ve=function(){function a(o,i){var t=this;Fe(this,a),B(this,"media",null),B(this,"mediaSource",null),B(this,"_openPromise",ni()),B(this,"_queue",Object.create(null)),B(this,"_sourceBuffer",Object.create(null)),B(this,"_mseFullFlag",{}),B(this,"_st",0),B(this,"_opst",0),B(this,"_logger",null),B(this,"_config",null),B(this,"_url",null),B(this,"_onStartStreaming",function(){t._logger.debug("startstreaming")}),B(this,"_onEndStreaming",function(){t._logger.debug("endstreaming")}),B(this,"_onSBUpdateEnd",function(e){var n=t._queue[e];if(n){var r=n[0];if((r==null?void 0:r.opName)!==Ni.UPDATE_DURATION&&n.shift(),r){var s=ii()-t._opst;t._logger.debug("UpdateEnd",r.opName,s,r.context),r.promise.resolve({name:r.opName,context:r.context,costtime:s}),t._startQueue(e)}}}),B(this,"_onSBUpdateError",function(e,n){var r=t._queue[e];if(r){var s=r[0];s&&(t._logger.error("UpdateError",e,s.opName,s.context),s.promise.reject(new be(oe.MEDIA,oe.SUB_TYPES.MSE_APPEND_BUFFER,n)))}}),this._config=Object.assign(a.getDefaultConfig(),i),o&&this.bindMedia(o),this._logger=new ft("MSE"),this._config.openLog&&ft.enable()}return Ue(a,[{key:"isOpened",get:function(){var i;return((i=this.mediaSource)===null||i===void 0?void 0:i.readyState)==="open"}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var i;return((i=this.mediaSource)===null||i===void 0?void 0:i.duration)||-1}},{key:"isEnded",get:function(){return this.mediaSource?this.mediaSource.readyState==="ended":!1}},{key:"streaming",get:function(){return Mn(this.mediaSource)?this.mediaSource.streaming:!0}},{key:"isFull",value:function(i){return i?this._mseFullFlag[i]:this._mseFullFlag[a.VIDEO]}},{key:"updateDuration",value:function(i){var t=this,e=this.mediaSource&&this.mediaSource.duration>i;if(this.mediaSource&&this.mediaSource.duration>i){var n=0;if(Object.keys(this._sourceBuffer).forEach(function(r){try{n=Math.max(t.bufferEnd(r)||0,n)}catch(s){}}),i<n)return Promise.resolve()}return this._enqueueBlockingOp(function(){if(t.isEnded){t._logger.debug("setDuration but ended");return}t.mediaSource&&(t.mediaSource.duration=i,t._logger.debug("setDuration",i))},Ni.UPDATE_DURATION,{isReduceDuration:e})}},{key:"open",value:function(){var i=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource,e=function n(){var r=ii()-i._st;i._logger.debug("sourceopen",r),t.removeEventListener("sourceopen",n),i._openPromise.resolve({costtime:r})};t.addEventListener("sourceopen",e),this._openPromise=ni()}return this._openPromise}},{key:"bindMedia",value:function(){var o=mt(Te().mark(function t(e){var n=this,r,s,u,l;return Te().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(this.mediaSource||this.media)){f.next=3;break}return f.next=3,this.unbindMedia();case 3:if(r=ra(this._config.preferMMS),!(!e||!r)){f.next=6;break}throw new Error("Param media or MediaSource does not exist");case 6:return this.media=e,s=this.mediaSource=new r,u=Mn(s),this._st=ii(),l=function d(){var v=ii()-n._st;n._logger.debug("sourceopen"),s.removeEventListener("sourceopen",d),URL.revokeObjectURL(e.src),n._openPromise.resolve({costtime:v})},s.addEventListener("sourceopen",l),u&&(s.addEventListener("startstreaming",this._onStartStreaming),s.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(s),e.src=this._url,e.disableRemotePlayback=u,f.abrupt("return",this._openPromise);case 17:case"end":return f.stop()}},t,this)}));function i(t){return o.apply(this,arguments)}return i}()},{key:"unbindMedia",value:function(){var o=mt(Te().mark(function t(){var e=this,n,r,s;return Te().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),n=this.mediaSource,n){if(Object.keys(this._queue).forEach(function(c){var f=e._queue[c];f&&f.forEach(function(d){var v,h;return(v=d.promise)===null||v===void 0||(h=v.resolve)===null||h===void 0?void 0:h.call(v)})}),r=!!this.media&&this.media.readyState>=1,s=n.readyState==="open",r&&s)try{n.endOfStream()}catch(c){}Object.keys(this._sourceBuffer).forEach(function(c){try{n.removeSourceBuffer(e._sourceBuffer[c])}catch(f){}}),Mn(n)&&(n.removeEventListener("startstreaming",this._onStartStreaming),n.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch(c){}this.media=null}this.mediaSource=null,this._openPromise=ni(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return l.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i}()},{key:"createSource",value:function(i,t){if(!(this._sourceBuffer[i]||!this.mediaSource)){var e;try{e=this._sourceBuffer[i]=this.mediaSource.addSourceBuffer(t)}catch(n){throw new be(oe.MEDIA,oe.SUB_TYPES.MSE_ADD_SB,n)}e.mimeType=t,e.addEventListener("updateend",this._onSBUpdateEnd.bind(this,i)),e.addEventListener("error",this._onSBUpdateError.bind(this,i))}}},{key:"changeType",value:function(i,t){var e=this,n=this._sourceBuffer[i];return!this.mediaSource||!n||n.mimeType===t?Promise.resolve():typeof n.changeType!="function"?Promise.reject():this._enqueueOp(i,function(){n.changeType(t),n.mimeType=t,e._onSBUpdateEnd(i)},"changeType",{mimeType:t})}},{key:"createOrChangeSource",value:function(i,t){return this.createSource(i,t),this.changeType(i,t)}},{key:"append",value:function(i,t,e){var n=this;return!t||!t.byteLength||!this._sourceBuffer[i]?Promise.resolve():this._enqueueOp(i,function(){var r;!n.mediaSource||n.media.error||(n._logger.debug("MSE APPEND START",e),n._opst=ii(),(r=n._sourceBuffer[i])===null||r===void 0||r.appendBuffer(t))},Ni.APPEND,e)}},{key:"remove",value:function(i,t,e,n){var r=this,s=!1;return this._mseFullFlag[i]&&(s=!0),this._enqueueOp(i,function(){if(!(!r.mediaSource||r.media.error)){var u=r._sourceBuffer[i];if(t>=e||!u){r._onSBUpdateEnd(i);return}r._opst=ii(),r._logger.debug("MSE REMOVE START",i,t,e,n),u.remove(t,e)}},Ni.REMOVE,n,s)}},{key:"clearBuffer",value:function(i,t){var e=this,n;return Object.keys(this._sourceBuffer).forEach(function(r){n=e.remove(r,i,t)}),n||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var i=this,t;return Object.keys(this._sourceBuffer).forEach(function(e){var n=i._sourceBuffer[e];t=i.remove(e,0,Oe.end(Oe.get(n)))}),t}},{key:"clearOpQueues",value:function(i,t){var e;this._logger.debug("MSE clearOpQueue START");var n=this._queue[i];if(t&&n){this._queue[i]=[];return}if(!(!n||!n[i]||n.length<5)){var r=[];n.forEach(function(s){s.context&&s.context.isinit&&r.push(s)}),this._queue[i]=n.slice(0,2),r.length>0&&(e=this._queue[i]).push.apply(e,r)}}},{key:"endOfStream",value:function(i){var t=this;return!this.mediaSource||this.mediaSource.readyState!=="open"?Promise.resolve():this._enqueueBlockingOp(function(){var e=t.mediaSource;!e||e.readyState!=="open"||(t._logger.debug("MSE endOfStream START"),i?e.endOfStream(i):e.endOfStream())},"endOfStream")}},{key:"setLiveSeekableRange",value:function(i,t){var e=this.mediaSource;i<0||t<i||!(e!=null&&e.setLiveSeekableRange)||e.readyState!=="open"||e.setLiveSeekableRange(i,t)}},{key:"getSourceBuffer",value:function(i){return this._sourceBuffer[i]}},{key:"buffered",value:function(i){return Oe.get(this._sourceBuffer[i])}},{key:"bufferStart",value:function(i){return Oe.start(this.buffered(i))}},{key:"bufferEnd",value:function(i){return Oe.end(this.buffered(i))}},{key:"_enqueueOp",value:function(i,t,e,n,r){var s=this;if(!this.mediaSource)return Promise.resolve();var u=this._queue[i]=this._queue[i]||[],l={exec:t,promise:ni(),opName:e,context:n};return r?(u.splice(0,0,l),this._mseFullFlag[i]=!1,this._startQueue(i)):u.push(l),this.isOpened||this.isEnded?u.length===1&&this._startQueue(i):this._openPromise.then(function(){u.length===1&&s._startQueue(i)}),l.promise}},{key:"_enqueueBlockingOp",value:function(){var o=mt(Te().mark(function t(e,n,r){var s=this,u,l;return Te().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.mediaSource){f.next=2;break}return f.abrupt("return",Promise.resolve());case 2:if(u=Object.keys(this._sourceBuffer),u.length){f.next=5;break}return f.abrupt("return",e());case 5:return l=[],u.forEach(function(d){var v=s._queue[d],h=ni();l.push(h),v.push({exec:function(){h.resolve()},promise:h,opName:n,context:r}),v.length===1&&s._startQueue(d)}),f.abrupt("return",Promise.all(l).then(function(){try{return e()}finally{u.forEach(function(d){var v=s._queue[d],h=s._sourceBuffer[d];v==null||v.shift(),(!h||!h.updating)&&s._startQueue(d)})}}));case 8:case"end":return f.stop()}},t,this)}));function i(t,e,n){return o.apply(this,arguments)}return i}()},{key:"_startQueue",value:function(i){var t=this._queue[i];if(t){var e=t[0];if(e&&!this._mseFullFlag[i])try{e.exec()}catch(n){n&&n.message&&n.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[i]=!0,this._logger.error("[MSE error],  context,",e.context," ,name,",e.opName,",err,SourceBuffer is full"),e.promise.reject(new be(oe.MEDIA,oe.SUB_TYPES.MSE_FULL,n))):(this._logger.error(n),e.promise.reject(new be(oe.MEDIA,oe.SUB_TYPES.MSE_OTHER,n)),t.shift(),this._startQueue(i))}}}},{key:"setTimeoffset",value:function(i,t,e){var n=this;return this._enqueueOp(i,function(){t<0&&(t+=.001),n._sourceBuffer[i].timestampOffset=t,n._onSBUpdateEnd(i)},"setTimeoffset",e)}},{key:"abort",value:function(i,t){var e=this;return this.isOpened?this._enqueueOp(i,function(){e._sourceBuffer[i].abort(),e._onSBUpdateEnd(i)},"abort",t):Promise.resolve()}}],[{key:"isSupported",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',t=ra();if(!t)return!1;try{return t.isTypeSupported(i)}catch(e){return this._logger.error(i,e),!1}}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]),a}();B(Ve,"VIDEO","video");B(Ve,"AUDIO","audio");var Bt={FETCH:"fetch",XHR:"xhr"},bi={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},lt=function(a){Ti(i,a);var o=Ci(i);function i(t,e,n,r){var s;return Fe(this,i),s=o.call(this,r),B(Y(s),"retryCount",0),B(Y(s),"isTimeout",!1),B(Y(s),"loaderType",Bt.FETCH),B(Y(s),"startTime",0),B(Y(s),"endTime",0),B(Y(s),"options",{}),s.url=t,s.request=e,s.response=n,s}return Ue(i)}(rn(Error)),cs=Object.prototype.toString;function Bl(a){return a!==null&&ui(a)==="object"}function aa(a){if(cs.call(a)!=="[object Object]")return!1;var o=Object.getPrototypeOf(a);return o===null||o===Object.prototype}function Fl(a){return cs.call(a)==="[object Date]"}function fs(a){if(!(!a||a[0]===null||a[0]===void 0||a[0]===0&&(a[1]===null||a[1]===void 0))){var o="bytes="+a[0]+"-";return a[1]&&(o+=a[1]),o}}function sa(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function hs(a,o){if(a){if(!o)return a;var i,t=Object.keys(o).map(function(n){if(i=o[n],i!=null)return Array.isArray(i)?n=n+"[]":i=[i],i.map(function(r){return Fl(r)?r=r.toISOString():Bl(r)&&(r=JSON.stringify(r)),"".concat(sa(n),"=").concat(sa(r))}).join("&")}).filter(Boolean).join("&");if(t){var e=a.indexOf("#");e!==-1&&(a=a.slice(0,e)),a+=(a.indexOf("?")===-1?"?":"&")+t}return a}}function Xn(a,o,i,t,e,n,r,s,u,l,c){e=e!=null?parseFloat(e):null,t=parseInt(t||"0",10),Number.isNaN(t)&&(t=0);var f={range:u,vid:l,index:s,contentLength:t,age:e,startTime:n,firstByteTime:r,endTime:Date.now(),priOptions:c};return{data:a,done:o,options:f,response:i}}function Zn(a,o){return Math.round(a*8*1e3/o/1024)}var J={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},oa=2*1024*1024,Jn=function(a){Ti(i,a);var o=Ci(i);function i(){var t;return Fe(this,i),t=o.call(this),B(Y(t),"_abortController",null),B(Y(t),"_timeoutTimer",null),B(Y(t),"_reader",null),B(Y(t),"_response",null),B(Y(t),"_aborted",!1),B(Y(t),"_index",-1),B(Y(t),"_range",null),B(Y(t),"_receivedLength",0),B(Y(t),"_running",!1),B(Y(t),"_logger",null),B(Y(t),"_vid",""),B(Y(t),"_onProcessMinLen",0),B(Y(t),"_onCancel",null),B(Y(t),"_priOptions",null),t}return Ue(i,[{key:"load",value:function(e){var n,r=this,s=e.url,u=e.vid,l=e.timeout,c=e.responseType,f=e.onProgress,d=e.index,v=e.onTimeout,h=e.onCancel,p=e.range,g=e.transformResponse,y=e.request,m=e.params,b=e.logger,k=e.method,w=e.headers,C=e.body,x=e.mode,R=e.credentials,N=e.cache,D=e.redirect,L=e.referrer,S=e.referrerPolicy,E=e.onProcessMinLen,T=e.priOptions;this._logger=b,this._aborted=!1,this._onProcessMinLen=E,this._onCancel=h,this._abortController=typeof AbortController<"u"&&new AbortController,this._running=!0,this._index=d,this._range=p||[0,0],this._vid=u||s,this._priOptions=T||{};var O={method:k,headers:w,body:C,mode:x,credentials:R,cache:N,redirect:D,referrer:L,referrerPolicy:S,signal:(n=this._abortController)===null||n===void 0?void 0:n.signal},P=!1;clearTimeout(this._timeoutTimer),s=hs(s,m);var U=fs(p);U&&(y?w=y.headers:w=O.headers=O.headers||(Headers?new Headers:{}),Headers&&w instanceof Headers?w.append("Range",U):w.Range=U),l&&(this._timeoutTimer=setTimeout(function(){if(P=!0,r.cancel(),v){var q=new lt(s,O,null,"timeout");q.isTimeout=!0,v(q,{index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions})}},l));var j=Date.now();return this._logger.debug("[fetch load start], index,",d,",range,",p),new Promise(function(q,ue){fetch(y||s,y?void 0:O).then(function(){var V=mt(Te().mark(function ve(K){var Ke,Pe,Ye,Qe;return Te().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=K,!(r._aborted||!r._running)){ye.next=4;break}return ye.abrupt("return");case 4:if(g&&(K=g(K,s)||K),K.ok){ye.next=7;break}throw new lt(s,O,K,"bad network response");case 7:if(Ke=Date.now(),c!==bi.TEXT){ye.next=15;break}return ye.next=11,K.text();case 11:Pe=ye.sent,r._running=!1,ye.next=37;break;case 15:if(c!==bi.JSON){ye.next=22;break}return ye.next=18,K.json();case 18:Pe=ye.sent,r._running=!1,ye.next=37;break;case 22:if(!f){ye.next=29;break}return r.resolve=q,r.reject=ue,r._loadChunk(K,f,j,Ke),ye.abrupt("return");case 29:return ye.next=31,K.arrayBuffer();case 31:Pe=ye.sent,Pe=new Uint8Array(Pe),r._running=!1,Ye=Date.now()-j,Qe=Zn(Pe.byteLength,Ye),r.emit(J.REAL_TIME_SPEED,{speed:Qe,len:Pe.byteLength,time:Ye,vid:r._vid,index:r._index,range:r._range,priOptions:r._priOptions});case 37:r._logger.debug("[fetch load end], index,",d,",range,",p),q(Xn(Pe,!0,K,K.headers.get("Content-Length"),K.headers.get("age"),j,Ke,d,p,r._vid,r._priOptions));case 39:case"end":return ye.stop()}},ve)}));return function(ve){return V.apply(this,arguments)}}()).catch(function(V){var ve;clearTimeout(r._timeoutTimer),r._running=!1,!(r._aborted&&!P)&&(V=V instanceof lt?V:new lt(s,O,null,(ve=V)===null||ve===void 0?void 0:ve.message),V.startTime=j,V.endTime=Date.now(),V.isTimeout=P,V.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},ue(V))})})}},{key:"cancel",value:function(){var t=mt(Te().mark(function n(){return Te().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this._aborted){s.next=2;break}return s.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){s.next=14;break}if(s.prev=5,!this._reader){s.next=9;break}return s.next=9,this._reader.cancel();case 9:s.next=13;break;case 11:s.prev=11,s.t0=s.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(u){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return s.stop()}},n,this,[[5,11]])}));function e(){return t.apply(this,arguments)}return e}()},{key:"_loadChunk",value:function(e,n,r,s){var u=this;if(!e.body||!e.body.getReader){this._running=!1;var l=new lt(e.url,"",e,"onProgress of bad response.body.getReader");l.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(l);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(oa),this._writeIdx=0);var c=this._reader=e.body.getReader(),f,d,v,h=function(){var p=mt(Te().mark(function g(){var y,m,b,k,w,C,x,R;return Te().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return d=Date.now(),D.prev=1,D.next=4,c.read();case 4:f=D.sent,v=Date.now(),D.next=13;break;case 8:return D.prev=8,D.t0=D.catch(1),v=Date.now(),u._aborted||(u._running=!1,D.t0.options={index:u._index,range:u._range,vid:u._vid,priOptions:u._priOptions},u.reject(D.t0)),D.abrupt("return");case 13:if(m=((y=u._range)===null||y===void 0?void 0:y.length)>0?u._range[0]:0,b=m+u._receivedLength,!u._aborted){D.next=19;break}return u._running=!1,n(void 0,!1,{range:[b,b],vid:u._vid,index:u._index,startTime:d,endTime:v,st:r,firstByteTime:s,priOptions:u._priOptions},e),D.abrupt("return");case 19:k=f.value?f.value.byteLength:0,u._receivedLength+=k,u._logger.debug("【fetchLoader,onProgress call】,task,",u._range,", start,",b,", end,",m+u._receivedLength,", done,",f.done),u._onProcessMinLen>0?u._writeIdx+k>=u._onProcessMinLen||f.done?(w=new Uint8Array(u._writeIdx+k),w.set(u._cache.slice(0,u._writeIdx),0),k>0&&w.set(f.value,u._writeIdx),u._writeIdx=0,u._logger.debug("【fetchLoader,onProgress enough】,done,",f.done,",len,",w.byteLength,", writeIdx,",u._writeIdx)):k>0&&u._writeIdx+k<oa?(u._cache.set(f.value,u._writeIdx),u._writeIdx+=k,u._logger.debug("【fetchLoader,onProgress cache】,len,",k,", writeIdx,",u._writeIdx)):k>0&&(C=new Uint8Array(u._writeIdx+k+2048),u._logger.debug("【fetchLoader,onProgress extra start】,size,",u._writeIdx+k+2048,", datalen,",k,", writeIdx,",u._writeIdx),C.set(u._cache.slice(0,u._writeIdx),0),k>0&&C.set(f.value,u._writeIdx),u._writeIdx+=k,delete u._cache,u._cache=C,u._logger.debug("【fetchLoader,onProgress extra end】,len,",k,", writeIdx,",u._writeIdx)):w=f.value,(w&&w.byteLength>0||f.done)&&n(w,f.done,{range:[u._range[0]+u._receivedLength-(w?w.byteLength:0),u._range[0]+u._receivedLength],vid:u._vid,index:u._index,startTime:d,endTime:v,st:r,firstByteTime:s,priOptions:u._priOptions},e),f.done?(x=Date.now()-r,R=Zn(u._receivedLength,x),u.emit(J.REAL_TIME_SPEED,{speed:R,len:u._receivedLength,time:x,vid:u._vid,index:u._index,range:u._range,priOptions:u._priOptions}),u._running=!1,u._logger.debug("[fetchLoader onProgress end],task,",u._range,",done,",f.done),u.resolve(Xn(f,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),r,s,u._index,u._range,u._vid,u._priOptions))):h();case 25:case"end":return D.stop()}},g,null,[[1,8]])}));return function(){return p.apply(this,arguments)}}();h()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return typeof fetch<"u"}}]),i}(ci);function Ul(a){return yi({loaderType:Bt.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:bi.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},a)}var Hl=function(a){Ti(i,a);var o=Ci(i);function i(){var t;return Fe(this,i),t=o.call(this),B(Y(t),"_xhr",null),B(Y(t),"_aborted",!1),B(Y(t),"_timeoutTimer",null),B(Y(t),"_range",null),B(Y(t),"_receivedLength",0),B(Y(t),"_url",null),B(Y(t),"_onProgress",null),B(Y(t),"_index",-1),B(Y(t),"_headers",null),B(Y(t),"_currentChunkSizeKB",384),B(Y(t),"_timeout",null),B(Y(t),"_xhr",null),B(Y(t),"_withCredentials",null),B(Y(t),"_startTime",-1),B(Y(t),"_loadCompleteResolve",null),B(Y(t),"_loadCompleteReject",null),B(Y(t),"_runing",!1),B(Y(t),"_logger",!1),B(Y(t),"_vid",""),B(Y(t),"_responseType",void 0),B(Y(t),"_credentials",void 0),B(Y(t),"_method",void 0),B(Y(t),"_transformResponse",void 0),B(Y(t),"_firstRtt",void 0),B(Y(t),"_onCancel",null),B(Y(t),"_priOptions",null),t}return Ue(i,[{key:"load",value:function(e){var n=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials=e.credentials==="include"||e.credentials==="same-origin",this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=hs(e.url,e.params);var r=Date.now();return new Promise(function(s,u){n._loadCompleteResolve=s,n._loadCompleteReject=u,n._startLoad()}).catch(function(s){if(clearTimeout(n._timeoutTimer),n._runing=!1,!n._aborted)throw s=s instanceof lt?s:new lt(n._url,n._request),s.startTime=r,s.endTime=Date.now(),s.options={index:n._index,vid:n._vid,priOptions:n._priOptions},s})}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===bi.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var n=this._currentChunkSizeKB*1024,r=this._range[0]+this._receivedLength,s=this._range[1];n<this._range[1]-r&&(s=r+n),e=[r,s],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var n=this;try{this._startTime=Date.now();var r=this._xhr=new XMLHttpRequest;r.open(this._method||"GET",this._url,!0),r.responseType=this._responseType,this._timeout&&(r.timeout=this._timeout),r.withCredentials=this._withCredentials,r.onload=this._onLoad.bind(this),r.onreadystatechange=this._onReadyStatechange.bind(this),r.onerror=function(l){var c,f,d;n._running=!1;var v=new lt(n._url,n._request,l==null||(c=l.currentTarget)===null||c===void 0?void 0:c.response,"xhr.onerror.status:"+(l==null||(f=l.currentTarget)===null||f===void 0?void 0:f.status)+",statusText,"+(l==null||(d=l.currentTarget)===null||d===void 0?void 0:d.statusText));v.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},n._loadCompleteReject(v)},r.ontimeout=function(l){n.cancel();var c=new lt(n._url,n._request,{status:408},"timeout");n._onTimeout&&(c.isTimeout=!0,n._onTimeout(c,{index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions})),c.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},n._loadCompleteReject(c)};var s=this._headers||{},u=fs(e);u&&(s.Range=u),s&&Object.keys(s).forEach(function(l){r.setRequestHeader(l,s[l])}),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),r.send(this._body)}catch(l){l.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(l)}}},{key:"_onReadyStatechange",value:function(e){var n=e.target;n.readyState===2&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var n,r=e.target.status;if(r<200||r>299){var s=new lt(this._url,null,yi(yi({},e.target.response),{},{status:r}),"bad response,status:"+r);return s.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(s)}var u=null,l=!1,c,f=((n=this._range)===null||n===void 0?void 0:n.length)>0?this._range[0]:0;if(this._responseType===bi.ARRAY_BUFFER){var d,v=new Uint8Array(e.target.response);if(c=f+this._receivedLength,v&&v.byteLength>0){this._receivedLength+=v.byteLength;var h=Date.now()-this._startTime,p=Zn(this._receivedLength,h);this.emit(J.REAL_TIME_SPEED,{speed:p,len:this._receivedLength,time:h,vid:this._vid,index:this._index,range:[c,f+this._receivedLength],priOptions:this._priOptions})}u=v,((d=this._range)===null||d===void 0?void 0:d.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]?l=!1:l=!0,this._logger.debug("[xhr load done->], tast :",this._range,", start",c,"end ",f+this._receivedLength,",dataLen,",v?v.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",l)}else l=!0,u=e.target.response;var g={ok:r>=200&&r<300,status:r,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(g=this._transformResponse(g,this._url)||g),this._onProgress&&this._onProgress(u,l,{index:this._index,vid:this._vid,range:[c,f+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},g),l?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(Xn(this._onProgress?null:u,l,g,g.headers["content-length"],g.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted&&(this._aborted=!0,this._runing=!1,zi(Ht(i.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr))return this._xhr.abort()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var n=e.getAllResponseHeaders().trim().split(`\r
`),r={},s=Dl(n),u;try{for(s.s();!(u=s.n()).done;){var l=u.value,c=l.split(": ");r[c[0].toLowerCase()]=c.slice(1).join(": ")}}catch(f){s.e(f)}finally{s.f()}return r}}],[{key:"isSupported",value:function(){return typeof XMLHttpRequest<"u"}}]),i}(ci),jl=["retry","retryDelay","onRetryError","transformError"],Vl=function(){function a(o,i){Fe(this,a),this.promise=ni(),this.alive=!!i.onProgress,!i.logger&&(i.logger=new ft("Loader")),this._loaderType=o,this._loader=o===Bt.FETCH&&typeof fetch<"u"?new Jn:new Hl,this._config=i,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=i.retryCheckFunc,this._logger=i.logger}return Ue(a,[{key:"exec",value:function(){var i=this,t=this._config,e=t.retry,n=t.retryDelay,r=t.onRetryError,s=t.transformError,u=xl(t,jl),l=function(){var c=mt(Te().mark(function f(){var d,v,h;return Te().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,i._loader.load(u);case 3:d=g.sent,i.promise.resolve(d),g.next=27;break;case 7:if(g.prev=7,g.t0=g.catch(0),i._loader.running=!1,i._logger.debug("[task request catch err]",g.t0),!i._canceled){g.next=13;break}return g.abrupt("return");case 13:if(g.t0.loaderType=i._loaderType,g.t0.retryCount=i._retryCount,v=g.t0,s&&(v=s(v)||v),r&&i._retryCount>0&&r(v,i._retryCount,{index:u.index,vid:u.vid,range:u.range,priOptions:u.priOptions}),i._retryCount++,h=!0,i._retryCheckFunc&&(h=i._retryCheckFunc(g.t0)),!(h&&i._retryCount<=e)){g.next=26;break}return clearTimeout(i._retryTimer),i._logger.debug("[task request setTimeout],retry",i._retryCount,",retry range,",u.range),i._retryTimer=setTimeout(l,n),g.abrupt("return");case 26:i.promise.reject(v);case 27:case"end":return g.stop()}},f,null,[[0,7]])}));return function(){return c.apply(this,arguments)}}();return l(),this.promise}},{key:"cancel",value:function(){var o=mt(Te().mark(function t(){return Te().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,n.abrupt("return",this._loader.cancel());case 4:case"end":return n.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i}()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),a}();function zl(a){return a&&!a.paused&&!a.ended&&a.playbackRate!==0&&a.readyState!==0}function Gl(a){if(!a)return{};if(typeof a.getVideoPlaybackQuality=="function"){var o=a.getVideoPlaybackQuality();return{droppedVideoFrames:o.droppedVideoFrames||o.corruptedVideoFrames,totalVideoFrames:o.totalVideoFrames,creationTime:o.creationTime}}return{droppedVideoFrames:a.webkitDroppedFrameCount,totalVideoFrames:a.webkitDecodedFrameCount,creationTime:performance.now()}}function Gi(){for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];if(o=o.filter(Boolean),o.length<2)return o[0];var t=new Uint8Array(o.reduce(function(n,r){return n+r.byteLength},0)),e=0;return o.forEach(function(n){t.set(n,e),e+=n.byteLength}),t}function Wl(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Promise(function(o){return setTimeout(o,a)})}var si=function(a){Ti(i,a);var o=Ci(i);function i(t){var e;return Fe(this,i),e=o.call(this,t),B(Y(e),"type",Bt.FETCH),B(Y(e),"_queue",[]),B(Y(e),"_alive",[]),B(Y(e),"_currentTask",null),B(Y(e),"_finnalUrl",""),B(Y(e),"_config",void 0),e._config=Ul(t),(e._config.loaderType===Bt.XHR||!Jn.isSupported())&&(e.type=Bt.XHR),e.log=t.logger,e}return Ue(i,[{key:"isFetch",value:function(){return this.type===Bt.FETCH}},{key:"load",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};typeof e=="string"||!e?r.url=e||r.url||this._config.url:r=e,r=Object.assign({},this._config,r),r.params&&(r.params=Object.assign({},r.params)),r.headers&&aa(r.headers)&&(r.headers=Object.assign({},r.headers)),r.body&&aa(r.body)&&(r.body=Object.assign({},r.body)),r.transformRequest&&(r=r.transformRequest(r)||r),r.logger=this.log;var s=new Vl(this.type,r);return s.loader.on(J.REAL_TIME_SPEED,function(u){n.emit(J.REAL_TIME_SPEED,u)}),this._queue.push(s),this._queue.length===1&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),s.promise}},{key:"cancel",value:function(){var t=mt(Te().mark(function n(){var r;return Te().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r=this._queue.map(function(l){return l.cancel()}).concat(this._alive.map(function(l){return l.cancel()})),this._currentTask&&r.push(this._currentTask.cancel()),this._queue=[],this._alive=[],u.next=6,Promise.all(r);case 6:return u.next=8,Wl();case 8:case"end":return u.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),!!this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var n=this._currentTask.exec().catch(function(r){});n&&typeof n.finally=="function"&&n.finally(function(){var r,s;(r=e._currentTask)!==null&&r!==void 0&&r.alive&&((s=e._alive)===null||s===void 0?void 0:s.length)>0&&(e._alive=e._alive.filter(function(u){return u&&u!==e._currentTask})),e._processTask()})}}}],[{key:"isFetchSupport",value:function(){return Jn.isSupported()}}]),i}(ci),$l=function(){function a(){Fe(this,a),B(this,"_prevCurrentTime",0)}return Ue(a,[{key:"do",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(i){var r=i.currentTime,s=0;if(this._prevCurrentTime===r){var u=Oe.info(Oe.get(i),r);if(!u.buffers.length)return;e&&u.nextStart||u.nextStart&&u.nextStart-r<t?s=u.nextStart+.1:u.end&&u.end-r>n&&!i.seeking&&(s=r+.1)}this._prevCurrentTime=r,s&&r!==s&&(i.currentTime=s)}}}]),a}(),Kl=function(){function a(o){var i=this;Fe(this,a),B(this,"_seiSet",new Set),this.emitter=o,o.on(J.SEI,function(t){t&&i._seiSet.add(t)})}return Ue(a,[{key:"throw",value:function(i,t){var e=this;if(!(i==null||!this._seiSet.size)){var n=i-.2,r=i+.2,s=[];this._seiSet.forEach(function(u){u.time>=n&&u.time<=r&&s.push(u)}),s.forEach(function(u){e._seiSet.delete(u),e.emitter.emit(J.SEI_IN_TIME,u)}),t&&this._seiSet.forEach(function(u){u.time<i-5&&e._seiSet.delete(u)})}}},{key:"reset",value:function(){this._seiSet.clear()}}]),a}(),Yl=function(){function a(){Fe(this,a),B(this,"_chunkSpeeds",[]),B(this,"_speeds",[])}return Ue(a,[{key:"addRecord",value:function(i,t){!i||!t||(this._speeds.push(8e3*i/t),this._speeds=this._speeds.slice(-3))}},{key:"addChunkRecord",value:function(i,t){!i||!t||(this._chunkSpeeds.push(8e3*i/t),this._chunkSpeeds=this._chunkSpeeds.slice(-100))}},{key:"getAvgSpeed",value:function(){return!this._chunkSpeeds.length&&!this._speeds.length?0:this._speeds.length?this._speeds.reduce(function(i,t){return i+=t})/this._speeds.length:this._chunkSpeeds.reduce(function(i,t){return i+=t})/this._chunkSpeeds.length}},{key:"getLatestSpeed",value:function(){return!this._chunkSpeeds.length&&!this._speeds.length?0:this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeeds[this._chunkSpeeds.length-1]}},{key:"reset",value:function(){this._chunkSpeeds=[],this._speeds=[]}}]),a}(),ua=function(){function a(o){Fe(this,a),B(this,"encodeType",""),B(this,"audioCodec",""),B(this,"videoCodec",""),B(this,"domain",""),B(this,"fps",0),B(this,"bitrate",0),B(this,"width",0),B(this,"height",0),B(this,"samplerate",0),B(this,"channelCount",0),B(this,"gop",0),B(this,"_bitsAccumulateSize",0),B(this,"_bitsAccumulateDuration",0),B(this,"_startGopId",-1),this._timescale=o}return Ue(a,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(i){this.encodeType=i}},{key:"setFpsFromScriptData",value:function(i){var t,e=i.data,n=e==null||(t=e.onMetaData)===null||t===void 0?void 0:t.framerate;n&&n>0&&n<100&&(this.fps=n)}},{key:"setVideoMeta",value:function(i){if(this.width=i.width,this.height=i.height,this.videoCodec=i.codec,this.encodeType=i.codecType,i.fpsNum&&i.fpsDen){var t=i.fpsNum/i.fpsDen;t>0&&t<100&&(this.fps=t)}}},{key:"setAudioMeta",value:function(i){this.audioCodec=i.codec,this.samplerate=i.sampleRate,this.channelCount=i.channelCount}},{key:"setDomain",value:function(i){this.domain=i.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(i){var t=this;if((!this.fps||this.fps>=100)&&i.length){var e=i.reduce(function(n,r){return n+=r.duration},0)/i.length;this.fps=Math.round(this._timescale/e)}i.forEach(function(n){t._startGopId===-1&&(t._startGopId=n.gopId),n.gopId===t._startGopId&&t.gop++,t._bitsAccumulateDuration+=n.duration/(t._timescale/1e3),t._bitsAccumulateSize+=n.units.reduce(function(r,s){return r+=s.length},0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=t._bitsAccumulateSize*8,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)})}}]),a}(),ql=function(){function a(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;Fe(this,a),B(this,"_core",null),B(this,"_samples",[]),this._core=o,this._timescale=i,this._stats=new ua(i),this._bindEvents()}return Ue(a,[{key:"getStats",value:function(){var i,t,e,n,r,s,u,l=((i=this._core)===null||i===void 0?void 0:i.media)||{},c=l.currentTime,f=c===void 0?0:c,d=l.decodeFps,v=d===void 0?0:d;return yi(yi({},this._stats.getStats()),{},{downloadSpeed:((t=this._core)===null||t===void 0||(e=t.speedInfo)===null||e===void 0?void 0:e.call(t).speed)||0,avgSpeed:((n=this._core)===null||n===void 0||(r=n.speedInfo)===null||r===void 0?void 0:r.call(n).avgSpeed)||0,currentTime:f,bufferEnd:((s=this._core)===null||s===void 0||(u=s.bufferInfo())===null||u===void 0?void 0:u.remaining)||0,decodeFps:v})}},{key:"_bindEvents",value:function(){var i=this;this._core.on(J.DEMUXED_TRACK,function(t){var e=t.videoTrack;return i._stats.updateBitrate(e.samples)}),this._core.on(J.FLV_SCRIPT_DATA,function(t){i._stats.setFpsFromScriptData(t)}),this._core.on(J.METADATA_PARSED,function(t){t.type==="video"?i._stats.setVideoMeta(t.track):i._stats.setAudioMeta(t.track)}),this._core.on(J.TTFB,function(t){i._stats.setDomain(t.responseUrl)})}},{key:"reset",value:function(){this._samples=[],this._stats=new ua(this._timescale)}}]),a}();function Xl(a,o){var i=a==null?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(i!=null){var t,e,n,r,s=[],u=!0,l=!1;try{if(n=(i=i.call(a)).next,o!==0)for(;!(u=(t=n.call(i)).done)&&(s.push(t.value),s.length!==o);u=!0);}catch(c){l=!0,e=c}finally{try{if(!u&&i.return!=null&&(r=i.return(),Object(r)!==r))return}finally{if(l)throw e}}return s}}function ke(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function la(a,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,ps(t.key),t)}}function Ee(a,o,i){return o&&la(a.prototype,o),i&&la(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a}function F(a,o,i){return o=ps(o),o in a?Object.defineProperty(a,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[o]=i,a}function Zl(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),o&&Qn(a,o)}function an(a){return an=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},an(a)}function Qn(a,o){return Qn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Qn(a,o)}function Jl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function Ql(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function ec(a,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ql(a)}function tc(a){var o=Jl();return function(){var t=an(a),e;if(o){var n=an(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ec(this,e)}}function ic(a,o){return rc(a)||Xl(a,o)||ds(a,o)||oc()}function ze(a){return nc(a)||ac(a)||ds(a)||sc()}function nc(a){if(Array.isArray(a))return er(a)}function rc(a){if(Array.isArray(a))return a}function ac(a){if(typeof Symbol<"u"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function ds(a,o){if(a){if(typeof a=="string")return er(a,o);var i=Object.prototype.toString.call(a).slice(8,-1);if(i==="Object"&&a.constructor&&(i=a.constructor.name),i==="Map"||i==="Set")return Array.from(a);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return er(a,o)}}function er(a,o){(o==null||o>a.length)&&(o=a.length);for(var i=0,t=new Array(o);i<o;i++)t[i]=a[i];return t}function sc(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oc(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uc(a,o){if(typeof a!="object"||a===null)return a;var i=a[Symbol.toPrimitive];if(i!==void 0){var t=i.call(a,o||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(a)}function ps(a){var o=uc(a,"string");return typeof o=="symbol"?o:String(o)}var oi={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},Ut={AVC:"avc",HEVC:"hevc"},sn={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},Xe={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},vs=function(){function a(){ke(this,a),F(this,"id",1),F(this,"type",oi.VIDEO),F(this,"codecType",Ut.AVC),F(this,"pid",-1),F(this,"hvcC",void 0),F(this,"codec",""),F(this,"timescale",0),F(this,"formatTimescale",0),F(this,"sequenceNumber",0),F(this,"baseMediaDecodeTime",0),F(this,"baseDts",0),F(this,"duration",0),F(this,"warnings",[]),F(this,"samples",[]),F(this,"pps",[]),F(this,"sps",[]),F(this,"vps",[]),F(this,"fpsNum",0),F(this,"fpsDen",0),F(this,"sarRatio",[]),F(this,"width",0),F(this,"height",0),F(this,"nalUnitSize",4),F(this,"present",!1),F(this,"isVideoEncryption",!1),F(this,"isAudioEncryption",!1),F(this,"isVideo",!0),F(this,"kid",null),F(this,"pssh",null),F(this,"ext",void 0)}return Ee(a,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),a}(),gs=function(){function a(){ke(this,a),F(this,"id",2),F(this,"type",oi.AUDIO),F(this,"codecType",sn.AAC),F(this,"pid",-1),F(this,"codec",""),F(this,"sequenceNumber",0),F(this,"sampleDuration",0),F(this,"timescale",0),F(this,"formatTimescale",0),F(this,"baseMediaDecodeTime",0),F(this,"duration",0),F(this,"warnings",[]),F(this,"samples",[]),F(this,"baseDts",0),F(this,"sampleSize",16),F(this,"sampleRate",0),F(this,"channelCount",0),F(this,"objectType",0),F(this,"sampleRateIndex",0),F(this,"config",[]),F(this,"present",!1),F(this,"isVideoEncryption",!1),F(this,"isAudioEncryption",!1),F(this,"kid",null),F(this,"ext",void 0)}return Ee(a,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===sn.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}}]),a}(),ms=function(){function a(o,i,t){ke(this,a),F(this,"flag",{}),F(this,"keyframe",!1),F(this,"gopId",0),F(this,"duration",0),F(this,"size",0),F(this,"units",[]),F(this,"chromaFormat",420),this.originPts=this.pts=o,this.originDts=this.dts=i,t&&(this.units=t)}return Ee(a,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),a}(),on=Ee(function a(o,i,t,e){ke(this,a),F(this,"duration",1024),F(this,"flag",{dependsOn:2,isNonSyncSample:0}),F(this,"keyframe",!0),this.originPts=this.pts=this.dts=o,this.data=i,this.size=i.byteLength,this.sampleOffset=e,t&&(this.duration=t)}),lc=Ee(function a(o,i){ke(this,a),F(this,"time",0),this.data=o,this.originPts=this.pts=i}),cc=function(a){Zl(i,a);var o=tc(i);function i(){return ke(this,i),o.apply(this,arguments)}return Ee(i)}(lc),ys=function(){function a(){ke(this,a),F(this,"id",3),F(this,"type",oi.METADATA),F(this,"timescale",0),F(this,"flvScriptSamples",[]),F(this,"seiSamples",[])}return Ee(a,[{key:"exist",value:function(){return!!((this.flvScriptSamples.length||this.seiSamples.length)&&this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!!(this.flvScriptSamples.length||this.seiSamples.length)}}]),a}(),un=function(){function a(o){ke(this,a),this.name=o||"",this._prefix="[".concat(this.name,"]")}return Ee(a,[{key:"warn",value:function(){var i;if(!a.disabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(i=console).warn.apply(i,[this._prefix].concat(e))}}}],[{key:"enable",value:function(){a.disabled=!1}},{key:"disable",value:function(){a.disabled=!0}}]),a}();F(un,"disabled",!0);var _n=typeof window<"u",vr=_n&&navigator.userAgent.toLocaleLowerCase(),fc=_n&&/^((?!chrome|android).)*safari/.test(vr),hc=_n&&vr.includes("firefox"),dc=_n&&vr.includes("android"),gt=function(){function a(){ke(this,a)}return Ee(a,null,[{key:"getRateIndexByRate",value:function(i){return a.FREQ.indexOf(i)}},{key:"parseADTS",value:function(i,t){for(var e=i.length,n=0;n+2<e&&!(i[n]===255&&(i[n+1]&246)===240);)n++;if(!(n>=e)){var r=n,s=[],u=(i[n+2]&60)>>>2,l=a.FREQ[u];if(!l)throw new Error("Invalid sampling index: ".concat(u));for(var c=((i[n+2]&192)>>>6)+1,f=(i[n+2]&1)<<2|(i[n+3]&192)>>>6,d=a._getConfig(u,f,c),v=d.config,h=d.codec,p,g,y=0,m=a.getFrameDuration(l);n+7<e;){if(i[n]!==255||(i[n+1]&246)!==240){n++;continue}if(g=(i[n+3]&3)<<11|i[n+4]<<3|(i[n+5]&224)>>5,e-n<g)break;p=(~i[n+1]&1)*2,s.push({pts:t+y*m,data:i.subarray(n+7+p,n+g)}),y++,n+=g}return{skip:r,remaining:n>=e?void 0:i.subarray(n),frames:s,samplingFrequencyIndex:u,sampleRate:l,objectType:c,channelCount:f,codec:h,config:v,originCodec:"mp4a.40.".concat(c)}}}},{key:"parseAudioSpecificConfig",value:function(i){if(i.length){var t=i[0]>>>3,e=(i[0]&7)<<1|i[1]>>>7,n=(i[1]&120)>>>3,r=a.FREQ[e];if(r){var s=a._getConfig(e,n,t),u=s.config,l=s.codec;return{samplingFrequencyIndex:e,sampleRate:r,objectType:t,channelCount:n,config:u,codec:l,originCodec:"mp4a.40.".concat(t)}}}}},{key:"getFrameDuration",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4;return 1024*t/i}},{key:"_getConfig",value:function(i,t,e){var n=[],r,s;return hc?i>=6?(r=5,s=i-3):(r=2,s=i):dc?(r=2,s=i):(r=e===2||e===5?e:5,s=i,i>=6?s=i-3:t===1&&(r=2,s=i)),n[0]=r<<3,n[0]|=(i&14)>>1,n[1]=(i&1)<<7,n[1]|=t<<3,r===5&&(n[1]|=(s&14)>>1,n[2]=(s&1)<<7,n[2]|=8,n[3]=0),{config:n,codec:"mp4a.40.".concat(r)}}},{key:"getSilentFrame",value:function(i,t){switch(i){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),a}();F(gt,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);function qe(){for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];o=o.filter(Boolean);var t=new Uint8Array(o.reduce(function(n,r){return n+r.byteLength},0)),e=0;return o.forEach(function(n){t.set(n,e),e+=n.byteLength}),t}var pc=Math.pow(2,32);function me(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(a[o]<<8)+(a[o+1]||0)}function vc(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(a[o]<<16)+(a[o+1]<<8)+(a[o+2]||0)}function z(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(a[o]<<24>>>0)+(a[o+1]<<16)+(a[o+2]<<8)+(a[o+3]||0)}function Pt(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return z(a,o)*pc+z(a,o+4)}function _s(a){for(var o="avc1.",i,t=0;t<3;t++)i=a[t].toString(16),i.length<2&&(i="0".concat(i)),o+=i;return o}function ca(a){if(!Array.isArray(a)){for(var o=[],i="",t=0;t<a.length;t++)t%2&&(i=a[t-1]+a[t],o.push(parseInt(i,16)),i="");return o}return a.map(function(e){return parseInt(e,16)})}var It=function(){function a(){ke(this,a)}return Ee(a,null,[{key:"parseAnnexB",value:function(i){for(var t=i.length,e=2,n=0;i[e]!==null&&i[e]!==void 0&&i[e]!==1;)e++;if(e++,n=e+2,n>=t)return[];for(var r=[];n<t;)switch(i[n]){case 0:if(i[n-1]!==0){n+=2;break}else if(i[n-2]!==0){n++;break}e!==n-2&&r.push(i.subarray(e,n-2));do n++;while(i[n]!==1&&n<t);e=n+1,n=e+2;break;case 1:if(i[n-1]!==0||i[n-2]!==0){n+=3;break}e!==n-2&&r.push(i.subarray(e,n-2)),e=n+1,n=e+2;break;default:n+=3;break}return e<t&&r.push(i.subarray(e)),r}},{key:"parseAvcC",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4;if(!(i.length<4)){for(var e=i.length,n=[],r=0,s;r+t<e;)if(s=z(i,r),t===3&&(s>>>=8),r+=t,!!s){if(r+s>e)break;n.push(i.subarray(r,r+s)),r+=s}return n}}},{key:"parseSEI",value:function(i,t){for(var e=i.length,n=t?2:1,r=0,s=0,u="";i[n]===255;)r+=255,n++;for(r+=i[n++];i[n]===255;)s+=255,n++;if(s+=i[n++],r===5&&e>n+16)for(var l=0;l<16;l++)u+=i[n].toString(16),n++;return{payload:i.subarray(n,n+s),type:r,size:s,uuid:u}}},{key:"removeEPB",value:function(i){for(var t=i.byteLength,e=[],n=1;n<t-2;)i[n]===0&&i[n+1]===0&&i[n+2]===3?(e.push(n+2),n+=2):n++;if(!e.length)return i;var r=t-e.length,s=new Uint8Array(r),u=0;for(n=0;n<r;u++,n++)u===e[0]&&(u++,e.shift()),s[n]=i[u];return s}}]),a}(),tr=function(){function a(o){if(ke(this,a),F(this,"_bytesAvailable",void 0),F(this,"_bitsAvailable",0),F(this,"_word",0),!o)throw new Error("ExpGolomb data params is required");this._data=o,this._bytesAvailable=o.byteLength,this._bytesAvailable&&this._loadWord()}return Ee(a,[{key:"bitsAvailable",get:function(){return this._bitsAvailable}},{key:"_loadWord",value:function(){var i=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(t===0)throw new Error("No bytes available");var e=new Uint8Array(4);e.set(this._data.subarray(i,i+t)),this._word=new DataView(e.buffer).getUint32(0),this._bitsAvailable=t*8,this._bytesAvailable-=t}},{key:"skipBits",value:function(i){if(this._bitsAvailable>i)this._word<<=i,this._bitsAvailable-=i;else{i-=this._bitsAvailable;var t=Math.floor(i/8);i-=t*8,this._bytesAvailable-=t,this._loadWord(),this._word<<=i,this._bitsAvailable-=i}}},{key:"readBits",value:function(i){if(i>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,i),e=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),t=i-t,t>0&&this._bitsAvailable?e<<t|this.readBits(t):e}},{key:"skipLZ",value:function(){var i;for(i=0;i<this._bitsAvailable;++i)if(this._word&2147483648>>>i)return this._word<<=i,this._bitsAvailable-=i,i;return this._loadWord(),i+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var i=this.skipLZ();return this.readBits(i+1)-1}},{key:"readEG",value:function(){var i=this.readUEG();return 1&i?1+i>>>1:-1*(i>>>1)}},{key:"readBool",value:function(){return this.readBits(1)===1}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(i){for(var t=8,e=8,n,r=0;r<i;r++)e!==0&&(n=this.readEG(),e=(t+n+256)%256),t=e===0?t:e}}]),a}(),gc=function(){function a(){ke(this,a)}return Ee(a,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(i){if(!(i.length<7)){for(var t=(i[4]&3)+1,e,n=[],r=[],s=6,u=i[5]&31,l,c=0;c<u;c++)if(l=i[s]<<8|i[s+1],s+=2,!!l){var f=i.subarray(s,s+l);s+=l,n.push(f),e||(e=a.parseSPS(It.removeEPB(f)))}var d=i[s];s++;for(var v,h=0;h<d;h++)v=i[s]<<8|i[s+1],s+=2,v&&(r.push(i.subarray(s,s+v)),s+=v);return{sps:e,spsArr:n,ppsArr:r,nalUnitSize:t}}}},{key:"parseSPS",value:function(i){var t=new tr(i);t.readUByte();var e=t.readUByte(),n=t.readUByte(),r=t.readUByte();t.skipUEG();var s=420;if(e===100||e===110||e===122||e===244||e===44||e===83||e===86||e===118||e===128||e===138||e===144){var u=t.readUEG();if(u<=3&&(s=[0,420,422,444][u]),u===3&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var l=u!==3?8:12,c=0;c<l;c++)t.readBool()&&(c<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var f=t.readUEG();if(f===0)t.readUEG();else if(f===1){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var d=t.readUEG(),v=0;v<d;v++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var h=t.readUEG(),p=t.readUEG(),g=t.readBits(1);g===0&&t.skipBits(1),t.skipBits(1);var y=0,m=0,b=0,k=0;t.readBool()&&(y=t.readUEG(),m=t.readUEG(),b=t.readUEG(),k=t.readUEG());var w,C,x,R,N;if(t.readBool()){if(t.readBool()){var D=t.readUByte();switch(D){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:{w=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()];break}}}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var L=t.readBits(32),S=t.readBits(32);C=t.readBool(),x=S,R=L*2,N=x/R}}return{codec:_s(i.subarray(1,4)),profileIdc:e,profileCompatibility:n,levelIdc:r,chromaFormat:s,width:Math.ceil((h+1)*16-2*(y+m)),height:(2-g)*(p+1)*16-(g?2:4)*(b+k),sarRatio:w,fpsNum:x,fpsDen:R,fps:N,fixedFrame:C}}}]),a}(),fa=function(){function a(){ke(this,a)}return Ee(a,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(i.length<23)){t=t||{};for(var e=(i[21]&3)+1,n,r,s=[],u=[],l=[],c=23,f=i[22],d,v,h,p=0;p<f;p++){d=i[c]&63,v=i[c+1]<<8|i[c+2],c+=3;for(var g=0;g<v;g++)if(h=i[c]<<8|i[c+1],c+=2,!!h){switch(d){case 32:{var y=i.subarray(c,c+h);n||(n=a.parseVPS(It.removeEPB(y),t)),l.push(y)}break;case 33:{var m=i.subarray(c,c+h);r||(r=a.parseSPS(It.removeEPB(m),t)),s.push(m)}break;case 34:u.push(i.subarray(c,c+h));break}c+=h}}return{hvcC:t,sps:r,spsArr:s,ppsArr:u,vpsArr:l,nalUnitSize:e}}}},{key:"parseVPS",value:function(i,t){t=t||{};var e=new tr(i);e.readUByte(),e.readUByte(),e.readBits(12);var n=e.readBits(3);return t.numTemporalLayers=Math.max(t.numTemporalLayers||0,n+1),e.readBits(17),a._parseProfileTierLevel(e,n,t),t}},{key:"parseSPS",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=t||{};var e=new tr(i);e.readUByte(),e.readUByte(),e.readBits(4);var n=e.readBits(3);t.numTemporalLayers=Math.max(n+1,t.numTemporalLayers||0),t.temporalIdNested=e.readBits(1),a._parseProfileTierLevel(e,n,t),e.readUEG();var r=t.chromaFormatIdc=e.readUEG(),s=420;r<=3&&(s=[0,420,422,444][r]);var u=0;r===3&&(u=e.readBits(1));var l=e.readUEG(),c=e.readUEG(),f=e.readBits(1),d,v,h,p;if(f===1&&(d=e.readUEG(),v=e.readUEG(),h=e.readUEG(),p=e.readUEG()),t.bitDepthLumaMinus8=e.readUEG(),t.bitDepthChromaMinus8=e.readUEG(),f===1){var g=(r===1||r===2)&&u===0?2:1,y=r===1&&u===0?2:1;l-=g*(v+d),c-=y*(p+h)}return{codec:"hev1.1.6.L93.B0",width:l,height:c,chromaFormat:s,hvcC:t}}},{key:"_parseProfileTierLevel",value:function(i,t,e){var n=e.generalTierFlag||0;e.generalProfileSpace=i.readBits(2),e.generalTierFlag=Math.max(i.readBits(1),n),e.generalProfileIdc=Math.max(i.readBits(5),e.generalProfileIdc||0),e.generalProfileCompatibilityFlags=i.readBits(32),e.generalConstraintIndicatorFlags=[i.readBits(8),i.readBits(8),i.readBits(8),i.readBits(8),i.readBits(8),i.readBits(8)];var r=i.readBits(8);n<e.generalTierFlag?e.generalLevelIdc=r:e.generalLevelIdc=Math.max(r,e.generalLevelIdc||0);var s=[],u=[];if(t>i.bitsAvailable)throw new Error("maxSubLayersMinus inavlid size ".concat(t));for(var l=0;l<t;l++)s[l]=i.readBits(1),u[l]=i.readBits(1);t>0&&i.readBits((8-t)*2);for(var c=0;c<t;c++)s[c]!==0&&(i.readBits(2),i.readBits(1),i.readBits(5),i.readBits(16),i.readBits(16),i.readBits(4),i.readBits(16),i.readBits(16),i.readBits(12)),u[c]!==0&&i.readBits(8)}}]),a}(),mc=9e4/2,ha=3,Nn=9e4,Bn=5*9e4,Fn=9e4,yc=9e4/2,_c=function(){function a(o,i,t){ke(this,a),this.videoTrack=o,this.audioTrack=i,this.metadataTrack=t,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0}return Ee(a,[{key:"fix",value:function(){var i=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;t=Math.round(t*9e4);var r=this.videoTrack,s=this.audioTrack,u=r.samples,l=s.samples;if(!(!u.length&&!l.length)){var c=u[0],f=l[0],d=0;if(u.length&&l.length&&(d=c.dts-f.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),e&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t),!n){this._videoNextDts=d>0?t+d:t,this._audioNextPts=d>0?t:t-d;var v=c?c.dts-this._baseDts-this._videoNextDts:0,h=f?f.pts-this._baseDts-this._audioNextPts:0;Math.abs(v||h)>Fn&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(s),this._fixVideo(r),this.metadataTrack.exist()){var p=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(g){g.pts=g.originPts-i._baseDts,g.time=Math.max(0,g.pts)/p})}r.samples.length&&(r.baseMediaDecodeTime=r.samples[0].dts),s.samples.length&&(s.baseMediaDecodeTime=s.samples[0].pts*s.timescale/9e4)}}},{key:"_fixVideo",value:function(i){var t=this,e=i.samples;if(e.length){if(e.forEach(function(x){x.dts-=t._baseDts,x.pts-=t._baseDts}),this._videoNextDts===void 0){var n=e[0];this._videoNextDts=n.dts}var r=e.length,s=0,u=e[0],l=e[1],c=this._videoNextDts-u.dts;if(Math.abs(c)>yc){var f;if(i.warnings.push({type:Xe.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts/90,firstSampleDts:u.dts/90,nextSampleDts:(((f=e[1])===null||f===void 0?void 0:f.dts)||0)/90,sampleDuration:c/90}),u.dts+=c,u.pts+=c,l&&Math.abs(l.dts-u.dts)>Fn)this._videoTimestampBreak=!0,e.forEach(function(x,R){R!==0&&(x.dts+=c,x.pts+=c)});else for(var d=1;d<r-1;d++){var v,h=(v=e[d])===null||v===void 0?void 0:v.dts,p=e[d-1].dts;h&&h-p<0&&(e[d].dts+=c,e[d].pts+=c)}}var g;if(i.fpsNum&&i.fpsDen)g=i.timescale*(i.fpsDen/i.fpsNum);else{var y=i.samples[0],m=i.samples[1];g=r===1?9e3:Math.floor(m.dts-y.dts)}for(var b=0;b<r;b++){var k=e[b].dts,w=e[b+1];if(b<r-1?s=w.dts-k:e[b-1]?s=Math.min(k-e[b-1].dts,g):s=g,s>Fn||s<0){this._videoTimestampBreak=!0,s=this._audioTimestampBreak?g:Math.max(s,30*90);var C=this._audioNextPts||0;w&&w.dts>C&&(s=g),i.warnings.push({type:Xe.LARGE_VIDEO_GAP,time:k/i.timescale,dts:k,originDts:e[b].originDts,nextDts:this._videoNextDts,sampleDuration:s,refSampleDuration:g})}e[b].duration=s,this._videoNextDts+=s}}}},{key:"_fixAudio",value:function(i){var t=this,e=i.samples;e.length&&(e.forEach(function(n){n.pts-=t._baseDts,n.dts=n.pts}),this._doFixAudioInternal(i,e,9e4))}},{key:"_calculateBaseDts",value:function(i,t){var e=i.samples,n=t.samples;if(!e.length&&!n.length)return!1;var r=1/0,s=1/0;e.length&&(i.baseDts=r=e[0].pts),n.length&&(t.baseDts=s=n[0].dts),this._baseDts=Math.min(r,s);var u=s-r;return Number.isFinite(u)&&Math.abs(u)>mc&&t.warnings.push({type:Xe.LARGE_AV_SHIFT,videoBaseDts:s,audioBasePts:r,baseDts:this._baseDts,delta:u}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){var i=this._calculateBaseDts(this.audioTrack,this.videoTrack);if(!i)return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(i,t,e){i.sampleDuration||(i.sampleDuration=gt.getFrameDuration(i.timescale,e));var n=i.sampleDuration;if(this._audioNextPts===void 0){var r=t[0];this._audioNextPts=r.pts}for(var s=0;s<t.length;s++){var u=this._audioNextPts,l=t[s],c=l.pts-u;if(!this._audioTimestampBreak&&c>=ha*n&&c<=Nn&&!fc){var f=gt.getSilentFrame(i.codec,i.channelCount)||t[0].data.subarray(),d=Math.floor(c/n);Math.abs(l.pts-this._lastAudioExceptionGapDot)>Bn&&(this._lastAudioExceptionGapDot=l.pts),i.warnings.push({type:Xe.AUDIO_FILLED,pts:l.pts,originPts:l.originPts,count:d,nextPts:u,refSampleDuration:n});for(var v=0;v<d;v++){var h=new on(Math.floor(u),f);h.originPts=Math.floor(this._baseDts+u),t.splice(s,0,h),this._audioNextPts+=n,s++}s--}else c<=-ha*n&&c>=-1*Nn?(Math.abs(l.pts-this._lastAudioExceptionOverlapDot)>Bn&&(this._lastAudioExceptionOverlapDot=l.pts,i.warnings.push({type:Xe.AUDIO_DROPPED,pts:l.pts,originPts:l.originPts,nextPts:u,refSampleDuration:n})),t.splice(s,1),s--):(Math.abs(c)>=Nn&&(this._audioTimestampBreak=!0,Math.abs(l.pts-this._lastAudioExceptionLargeGapDot)>Bn&&(this._lastAudioExceptionLargeGapDot=l.pts,i.warnings.push({type:Xe.LARGE_AUDIO_GAP,time:l.pts/1e3,pts:l.pts,originPts:l.originPts,nextPts:u,sampleDuration:c,refSampleDuration:n}))),l.dts=l.pts=u,this._audioNextPts+=n)}}}]),a}(),et=new un("TsDemuxer"),bs=function(){function a(o,i,t){ke(this,a),F(this,"_pmtId",-1),F(this,"_remainingPacketData",null),F(this,"_videoPesData",[]),F(this,"_audioPesData",[]),F(this,"_gopId",0),this.videoTrack=o||new vs,this.audioTrack=i||new gs,this.metadataTrack=t||new ys,this._fixer=new _c(this.videoTrack,this.audioTrack,this.metadataTrack)}return Ee(a,[{key:"demux",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=this.audioTrack,r=this.videoTrack,s=this.metadataTrack;t&&(this._pmtId=-1,r.reset(),n.reset(),s.reset()),!e||t?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(r.samples=[],n.samples=[],s.seiSamples=[],r.warnings=[],n.warnings=[],this._remainingPacketData&&(i=qe(this._remainingPacketData,i),this._remainingPacketData=null));var u=i.length,l=u%188;l&&(this._remainingPacketData=i.subarray(u-l),u-=l);for(var c=r.pid,f=n.pid,d=0;d<u;d+=188){if(i[d]!==71)throw new Error("TS packet did not start with 0x47");var v=!!(i[d+1]&64),h=((i[d+1]&31)<<8)+i[d+2],p=(i[d+3]&48)>>4,g=void 0;if(p>1){if(g=d+5+i[d+4],g===d+188)continue}else g=d+4;switch(h){case 0:v&&(g+=i[g]+1),this._pmtId=(i[g+10]&31)<<8|i[g+11];break;case this._pmtId:{v&&(g+=i[g]+1);var y=g+3+((i[g+1]&15)<<8|i[g+2])-4,m=(i[g+10]&15)<<8|i[g+11];for(g+=12+m;g<y;){var b=(i[g+1]&31)<<8|i[g+2];switch(i[g]){case 15:n.pid=f=b;break;case 27:if(c!==-1)break;r.codecType=Ut.AVC,r.pid=c=b;break;case 36:if(c!==-1)break;r.codecType=Ut.HEVC,r.pid=c=b;break;default:et.warn("Unsupported stream. type: ".concat(i[g],", pid: ").concat(b))}g+=((i[g+3]&15)<<8|i[g+4])+5}}break;case c:v&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(i.subarray(g,d+188));break;case f:v&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(i.subarray(g,d+188));break;case 17:case 8191:break;default:et.warn("Unknown pid: ".concat(h))}}return this._parseVideoData(),this._parseAudioData(),n.formatTimescale=r.formatTimescale=r.timescale=s.timescale=9e4,n.timescale=n.sampleRate||0,{videoTrack:r,audioTrack:n,metadataTrack:s}}},{key:"fix",value:function(i,t,e){return this._fixer.fix(i,t,e),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(i,t,e,n){return this.demux(i,t,e),this.fix(n,t,e)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var i=a._parsePES(qe.apply(void 0,ze(this._videoPesData)));if(!i){et.warn("Cannot parse video pes",this._videoPesData);return}var t=It.parseAnnexB(i.data);t?this._createVideoSample(t,i.pts,i.dts):et.warn("Cannot parse avc units",i),this._videoPesData=[]}}},{key:"_createVideoSample",value:function(i,t,e){var n=this;if(i.length){var r=this.videoTrack,s=r.codecType===Ut.HEVC,u=new ms(t,e);i.forEach(function(l){var c=s?l[0]>>>1&63:l[0]&31;switch(c){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!s&&c!==5||s&&c===5)break;u.setToKeyframe(),n._gopId++;break;case 6:case 39:case 40:if(!s&&c!==6||s&&c===6)break;n.metadataTrack.seiSamples.push(new cc(It.parseSEI(It.removeEPB(l),s),t));return;case 32:if(!s)break;if(!r.vps.length){var f=fa.parseVPS(It.removeEPB(l),r.hvcC);r.hvcC=r.hvcC||f,r.vps=[l]}break;case 7:case 33:if(!s&&c!==7||s&&c===7)break;if(!r.sps.length){var d=It.removeEPB(l),v=s?fa.parseSPS(d,r.hvcC):gc.parseSPS(d);r.sps=[l],r.hvcC=r.hvcC||v.hvcC,r.codec=v.codec,r.width=v.width,r.height=v.height,r.sarRatio=v.sarRatio,r.fpsNum=v.fpsNum,r.fpsDen=v.fpsDen}break;case 8:case 34:if(!s&&c!==8||s&&c===8)break;r.pps.length||(r.pps=[l]);break;case 9:case 35:break;case 38:if(s){for(var h=!1,p=2;p<l.byteLength;p++)if(l[p]===255){h=!0;break}if(!h)return}break}u.units.push(l)}),u.gopId=this._gopId,this._pushVideoSample(r,u)}}},{key:"_pushVideoSample",value:function(i,t){if(t.units.length)if(t.pts===null||t.pts===void 0){et.warn("Video sample no pts",t);var e=i.samples[i.samples.length-1];e?(t.pts=e.pts,t.dts=e.dts):et.warn("Drop video sample",t)}else i.samples.push(t)}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var i=a._parsePES(qe.apply(void 0,ze(this._audioPesData)));if(!i){et.warn("Cannot parse audio pes",this._audioPesData);return}this._parseAacData(i),this._audioPesData=[]}}},{key:"_parseAacData",value:function(i){var t=this.audioTrack,e=i.pts;if(e==null){if(et.warn("AAC pes not pts",t),!t.samples.length||!t.sampleRate)return;e=t.samples[t.samples.length-1].pts+gt.getFrameDuration(t.sampleRate)}var n=gt.parseADTS(i.data,e);if(n){var r;t.codec=n.codec,t.channelCount=n.channelCount,t.sampleRate=n.sampleRate,t.objectType=n.objectType,t.sampleRateIndex=n.samplingFrequencyIndex,t.config=n.config,(r=t.samples).push.apply(r,ze(n.frames.map(function(s){return new on(s.pts,s.data)}))),n.skip&&et.warn("Skip aac adts ".concat(n.skip," bits")),n.remaining&&et.warn("Remaining aac adts ".concat(n.remaining," bits"))}else et.warn("Cannot parse aac adts",i)}}],[{key:"probe",value:function(i){return i.length?i[0]===71&&i[188]===71&&i[376]===71:!1}},{key:"_parsePES",value:function(i){var t=i[8];if(!(t==null||i.length<t+9)){var e=i[0]<<16|i[1]<<8|i[2];if(e===1){var n=(i[4]<<8)+i[5];if(!(n&&n>i.length-6)){var r,s,u=i[7];return u&192&&(r=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,u&64?(s=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,r-s>60*9e4&&(r=s)):s=r),{data:i.subarray(9+t),pts:r,dts:s}}}}}}]),a}(),we=function(){function a(){ke(this,a)}return Ee(a,null,[{key:"findBox",value:function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=[];if(!i)return n;for(var r=0,s="",u=0;i.length>7;){if(r=z(i),s=String.fromCharCode.apply(null,i.subarray(4,8)),u=8,r===1?(r=Pt(i,8),u+=8):r||(r=i.length),!t[0]||s===t[0]){var l=i.subarray(0,r);if(t.length<2)n.push({start:e,size:r,headerSize:u,type:s,data:l});else return a.findBox(l.subarray(u),t.slice(1),e+u)}e+=r,i=i.subarray(r)}return n}},{key:"tfhd",value:function(i){return ie(i,!0,function(t,e){t.trackId=z(e);var n=4,r=t.flags&255&1,s=t.flags&255&2,u=t.flags&255&8,l=t.flags&255&16,c=t.flags&255&32;r&&(n+=4,t.baseDataOffset=z(e,n),n+=4),s&&(t.sampleDescriptionIndex=z(e,n),n+=4),u&&(t.defaultSampleDuration=z(e,n),n+=4),l&&(t.defaultSampleSize=z(e,n),n+=4),c&&(t.defaultSampleFlags=z(e,n))})}},{key:"sidx",value:function(i){return ie(i,!0,function(t,e){var n=0;t.reference_ID=z(e,n),n+=4,t.timescale=z(e,n),n+=4,t.version===0?(t.earliest_presentation_time=z(e,n),n+=4,t.first_offset=z(e,n),n+=4):(t.earliest_presentation_time=Pt(e,n),n+=8,t.first_offset=Pt(e,n),n+=8),n+=2,t.references=[];var r=me(e,n);n+=2;for(var s=0;s<r;s++){var u={};t.references.push(u);var l=z(e,n);n+=4,u.reference_type=l>>31&1,u.referenced_size=l&2147483647,u.subsegment_duration=z(e,n),n+=4,l=z(e,n),n+=4,u.starts_with_SAP=l>>31&1,u.SAP_type=l>>28&7,u.SAP_delta_time=l&268435455}})}},{key:"moov",value:function(i){return ie(i,!1,function(t,e,n){t.mvhd=a.mvhd(a.findBox(e,["mvhd"],n)[0]),t.trak=a.findBox(e,["trak"],n).map(function(r){return a.trak(r)}),t.pssh=a.pssh(a.findBox(e,["pssh"],n)[0])})}},{key:"mvhd",value:function(i){return ie(i,!0,function(t,e){var n=0;t.version===1?(t.timescale=z(e,16),t.duration=Pt(e,20),n+=28):(t.timescale=z(e,8),t.duration=z(e,12),n+=16),t.nextTrackId=z(e,n+76)})}},{key:"trak",value:function(i){return ie(i,!1,function(t,e,n){t.tkhd=a.tkhd(a.findBox(e,["tkhd"],n)[0]),t.mdia=a.mdia(a.findBox(e,["mdia"],n)[0])})}},{key:"tkhd",value:function(i){return ie(i,!0,function(t,e){var n=0;t.version===1?(t.trackId=z(e,16),t.duration=Pt(e,24),n+=32):(t.trackId=z(e,8),t.duration=z(e,16),n+=20),t.width=z(e,n+52),t.height=z(e,n+56)})}},{key:"mdia",value:function(i){return ie(i,!1,function(t,e,n){t.mdhd=a.mdhd(a.findBox(e,["mdhd"],n)[0]),t.hdlr=a.hdlr(a.findBox(e,["hdlr"],n)[0]),t.minf=a.minf(a.findBox(e,["minf"],n)[0])})}},{key:"mdhd",value:function(i){return ie(i,!0,function(t,e){var n=0;t.version===1?(t.timescale=z(e,16),t.duration=Pt(e,20),n+=28):(t.timescale=z(e,8),t.duration=z(e,12),n+=16);var r=me(e,n);t.language=String.fromCharCode((r>>10&31)+96,(r>>5&31)+96,(r&31)+96)})}},{key:"hdlr",value:function(i){return ie(i,!0,function(t,e){t.version===0&&(t.handlerType=String.fromCharCode.apply(null,e.subarray(4,8)))})}},{key:"minf",value:function(i){return ie(i,!1,function(t,e,n){t.vmhd=a.vmhd(a.findBox(e,["vmhd"],n)[0]),t.smhd=a.smhd(a.findBox(e,["smhd"],n)[0]),t.stbl=a.stbl(a.findBox(e,["stbl"],n)[0])})}},{key:"vmhd",value:function(i){return ie(i,!0,function(t,e){t.graphicsmode=me(e),t.opcolor=[me(e,2),me(e,4),me(e,6)]})}},{key:"smhd",value:function(i){return ie(i,!0,function(t,e){t.balance=me(e)})}},{key:"stbl",value:function(i){return ie(i,!1,function(t,e,n){var r,s,u;t.stsd=a.stsd(a.findBox(e,["stsd"],n)[0]),t.stts=a.stts(a.findBox(e,["stts"],n)[0]),t.ctts=a.ctts(a.findBox(e,["ctts"],n)[0]),t.stsc=a.stsc(a.findBox(e,["stsc"],n)[0]),t.stsz=a.stsz(a.findBox(e,["stsz"],n)[0]),t.stco=a.stco(a.findBox(e,["stco"],n)[0]),t.stco||(t.co64=a.co64(a.findBox(e,["co64"],n)[0]),t.stco=t.co64);var l=(r=t.stsd.entries[0])===null||r===void 0||(s=r.sinf)===null||s===void 0||(u=s.schi)===null||u===void 0?void 0:u.tenc.default_IV_size;t.stss=a.stss(a.findBox(e,["stss"],n)[0]),t.senc=a.senc(a.findBox(e,["senc"],n)[0],l)})}},{key:"senc",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;return ie(i,!0,function(e,n){var r=0,s=z(n,r);r+=4,e.samples=[];for(var u=0;u<s;u++){var l={};l.InitializationVector=[];for(var c=0;c<t;c++)l.InitializationVector[c]=n[r+c];if(r+=t,e.flags&2){l.subsamples=[];var f=me(n,r);r+=2;for(var d=0;d<f;d++){var v={};v.BytesOfClearData=me(n,r),r+=2,v.BytesOfProtectedData=z(n,r),r+=4,l.subsamples.push(v)}}e.samples.push(l)}})}},{key:"pssh",value:function(i){return ie(i,!0,function(t,e){for(var n=[],r=[],s=0,u=0;u<16;u++)r.push(Un(e[s+u]));if(s+=16,t.version>0){var l=z(e,s);s+=4;for(var c=0;c<(""+l).length;c++)for(var f=0;f<16;f++){var d=e[s];s+=1,n.push(Un(d))}}var v=z(e,s);t.data_size=v,s+=4,t.kid=n,t.system_id=r,t.buffer=e})}},{key:"stsd",value:function(i){return ie(i,!0,function(t,e,n){t.entryCount=z(e),t.entries=a.findBox(e.subarray(4),[],n+4).map(function(r){switch(r.type){case"avc1":case"avc2":case"avc3":case"avc4":return a.avc1(r);case"hvc1":case"hev1":return a.hvc1(r);case"mp4a":return a.mp4a(r);case"alaw":case"ulaw":return a.alaw(r);case"enca":return ie(r,!1,function(s,u,l){s.channelCount=me(u,16),s.samplesize=me(u,18),s.sampleRate=z(u,24)/65536,u=u.subarray(28),s.sinf=a.sinf(a.findBox(u,["sinf"],l)[0]),s.esds=a.esds(a.findBox(u,["esds"],l)[0])});case"encv":return ie(r,!1,function(s,u,l){s.width=me(u,24),s.height=me(u,26),s.horizresolution=z(u,28),s.vertresolution=z(u,32),u=u.subarray(78),s.sinf=a.sinf(a.findBox(u,["sinf"],l)[0]),s.avcC=a.avcC(a.findBox(u,["avcC"],l)[0]),s.hvcC=a.hvcC(a.findBox(u,["hvcC"],l)[0]),s.pasp=a.pasp(a.findBox(u,["pasp"],l)[0])})}}).filter(Boolean)})}},{key:"tenc",value:function(i){return ie(i,!1,function(t,e){var n=6;t.default_IsEncrypted=e[n],n+=1,t.default_IV_size=e[n],n+=1,t.default_KID=[];for(var r=0;r<16;r++)t.default_KID.push(Un(e[n])),n+=1})}},{key:"schi",value:function(i){return ie(i,!1,function(t,e,n){t.tenc=a.tenc(a.findBox(e,["tenc"],n)[0])})}},{key:"sinf",value:function(i){return ie(i,!1,function(t,e,n){t.schi=a.schi(a.findBox(e,["schi"],n)[0]),t.frma=a.frma(a.findBox(e,["frma"],n)[0])})}},{key:"frma",value:function(i){return ie(i,!1,function(t,e){t.data_format="";for(var n=0;n<4;n++)t.data_format+=String.fromCharCode(e[n])})}},{key:"avc1",value:function(i){return ie(i,!1,function(t,e,n){var r=pa(t,e),s=e.subarray(r);n+=r,t.avcC=a.avcC(a.findBox(s,["avcC"],n)[0]),t.pasp=a.pasp(a.findBox(s,["pasp"],n)[0])})}},{key:"avcC",value:function(i){return ie(i,!1,function(t,e){t.configurationVersion=e[0],t.AVCProfileIndication=e[1],t.profileCompatibility=e[2],t.AVCLevelIndication=e[3],t.codec=_s([e[1],e[2],e[3]]),t.lengthSizeMinusOne=e[4]&3,t.spsLength=e[5]&31,t.sps=[];for(var n=6,r=0;r<t.spsLength;r++){var s=me(e,n);n+=2,t.sps.push(e.subarray(n,n+s)),n+=s}t.ppsLength=e[n],n+=1,t.pps=[];for(var u=0;u<t.ppsLength;u++){var l=me(e,n);n+=2,t.pps.push(e.subarray(n,n+=l)),n+=l}})}},{key:"hvc1",value:function(i){return ie(i,!1,function(t,e,n){var r=pa(t,e),s=e.subarray(r);n+=r,t.hvcC=a.hvcC(a.findBox(s,["hvcC"],n)[0]),t.pasp=a.pasp(a.findBox(s,["pasp"],n)[0])})}},{key:"hvcC",value:function(i){return ie(i,!1,function(t,e){t.data=i.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=e[0];var n=e[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(n&32)>>5,t.generalProfileIdc=n&31,t.generalProfileCompatibility=z(e,2),t.generalConstraintIndicatorFlags=e.subarray(6,12),t.generalLevelIdc=e[12],t.avgFrameRate=me(e,19),t.numOfArrays=e[22],t.vps=[],t.sps=[],t.pps=[];for(var r=23,s=0,u=0,l=0,c=0;c<t.numOfArrays;c++){s=e[r]&63,u=me(e,r+1),r+=3;for(var f=[],d=0;d<u;d++)l=me(e,r),r+=2,f.push(e.subarray(r,r+l)),r+=l;if(s===32){var v;(v=t.vps).push.apply(v,f)}else if(s===33){var h;(h=t.sps).push.apply(h,f)}else if(s===34){var p;(p=t.pps).push.apply(p,f)}}})}},{key:"pasp",value:function(i){return ie(i,!1,function(t,e){t.hSpacing=z(e),t.vSpacing=z(e,4)})}},{key:"mp4a",value:function(i){return ie(i,!1,function(t,e,n){var r=va(t,e);t.esds=a.esds(a.findBox(e.subarray(r),["esds"],n+r)[0])})}},{key:"esds",value:function(i){return ie(i,!0,function(t,e){t.codec="mp4a.";for(var n=0,r=0,s=0,u=0;e.length;){for(n=0,u=e[n],r=e[n+1],n+=2;r&128;)s=(r&127)<<7,r=e[n],n+=1;if(s+=r&127,u===3)e=e.subarray(n+3);else if(u===4)t.codec+=(e[n].toString(16)+".").padStart(3,"0"),e=e.subarray(n+13);else if(u===5){var l=t.config=e.subarray(n,n+s),c=(l[0]&248)>>3;c===31&&l.length>=2&&(c=32+((l[0]&7)<<3)+((l[1]&224)>>5)),t.objectType=c,t.codec+=c.toString(16),t.codec[t.codec.length-1]==="."&&(t.codec=t.codec.substring(0,t.codec.length-1));return}else{t.codec[t.codec.length-1]==="."&&(t.codec=t.codec.substring(0,t.codec.length-1));return}}})}},{key:"alaw",value:function(i){return ie(i,!1,function(t,e){va(t,e)})}},{key:"stts",value:function(i){return ie(i,!0,function(t,e){for(var n=z(e),r=[],s=4,u=0;u<n;u++)r.push({count:z(e,s),delta:z(e,s+4)}),s+=8;t.entryCount=n,t.entries=r})}},{key:"ctts",value:function(i){return ie(i,!0,function(t,e){var n=z(e),r=[],s=4;if(t.version===1)for(var u=0;u<n;u++)r.push({count:z(e,s),offset:z(e,s+4)}),s+=8;else for(var l=0;l<n;l++)r.push({count:z(e,s),offset:-(~z(e,s+4)+1)}),s+=8;t.entryCount=n,t.entries=r})}},{key:"stsc",value:function(i){return ie(i,!0,function(t,e){for(var n=z(e),r=[],s=4,u=0;u<n;u++)r.push({firstChunk:z(e,s),samplesPerChunk:z(e,s+4),sampleDescriptionIndex:z(e,s+8)}),s+=12;t.entryCount=n,t.entries=r})}},{key:"stsz",value:function(i){return ie(i,!0,function(t,e){var n=z(e),r=z(e,4),s=[];if(!n)for(var u=8,l=0;l<r;l++)s.push(z(e,u)),u+=4;t.sampleSize=n,t.sampleCount=r,t.entrySizes=s})}},{key:"stco",value:function(i){return ie(i,!0,function(t,e){for(var n=z(e),r=[],s=4,u=0;u<n;u++)r.push(z(e,s)),s+=4;t.entryCount=n,t.entries=r})}},{key:"co64",value:function(i){return ie(i,!0,function(t,e){for(var n=z(e),r=[],s=4,u=0;u<n;u++)r.push(Pt(e,s)),s+=8;t.entryCount=n,t.entries=r})}},{key:"stss",value:function(i){return ie(i,!0,function(t,e){for(var n=z(e),r=[],s=4,u=0;u<n;u++)r.push(z(e,s)),s+=4;t.entryCount=n,t.entries=r})}},{key:"moof",value:function(i){return ie(i,!1,function(t,e,n){t.mfhd=a.mfhd(a.findBox(e,["mfhd"],n)[0]),t.traf=a.findBox(e,["traf"],n).map(function(r){return a.traf(r)})})}},{key:"mfhd",value:function(i){return ie(i,!0,function(t,e){t.sequenceNumber=z(e)})}},{key:"traf",value:function(i){return ie(i,!1,function(t,e,n){t.tfhd=a.tfhd(a.findBox(e,["tfhd"],n)[0]),t.tfdt=a.tfdt(a.findBox(e,["tfdt"],n)[0]),t.trun=a.trun(a.findBox(e,["trun"],n)[0])})}},{key:"trun",value:function(i){return ie(i,!0,function(t,e){var n=t.version,r=t.flags,s=e.length,u=t.sampleCount=z(e),l=4;if(s>l&&r&1&&(t.dataOffset=-(~z(e,l)+1),l+=4),s>l&&r&4&&(t.firstSampleFlags=z(e,l),l+=4),t.samples=[],s>l)for(var c,f=0;f<u;f++)c={},r&256&&(c.duration=z(e,l),l+=4),r&512&&(c.size=z(e,l),l+=4),r&1024&&(c.flags=z(e,l),l+=4),r&2048&&(n?c.cts=-(~z(e,l+4)+1):c.cts=z(e,l),l+=4),t.samples.push(c)})}},{key:"tfdt",value:function(i){return ie(i,!0,function(t,e){t.version===1?t.baseMediaDecodeTime=Pt(e):t.baseMediaDecodeTime=z(e)})}},{key:"probe",value:function(i){return!!a.findBox(i,["ftyp"])}},{key:"parseSampleFlags",value:function(i){return{isLeading:(i[0]&12)>>>2,dependsOn:i[0]&3,isDependedOn:(i[1]&192)>>>6,hasRedundancy:(i[1]&48)>>>4,paddingValue:(i[1]&14)>>>1,isNonSyncSample:i[1]&1,degradationPriority:i[2]<<8|i[3]}}},{key:"moovToTrack",value:function(i,t,e){var n,r,s=i.trak;if(!(!s||!s.length)){var u=s.find(function(wt){var ge,ht;return((ge=wt.mdia)===null||ge===void 0||(ht=ge.hdlr)===null||ht===void 0?void 0:ht.handlerType)==="vide"}),l=s.find(function(wt){var ge,ht;return((ge=wt.mdia)===null||ge===void 0||(ht=ge.hdlr)===null||ht===void 0?void 0:ht.handlerType)==="soun"});if(u&&t){var c,f,d,v,h,p,g,y=t,m=(c=u.tkhd)===null||c===void 0?void 0:c.trackId;m!=null&&(y.id=u.tkhd.trackId),y.tkhdDuration=u.tkhd.duration,y.mvhdDurtion=i.mvhd.duration,y.mvhdTimecale=i.mvhd.timescale,y.timescale=y.formatTimescale=u.mdia.mdhd.timescale,y.duration=u.mdia.mdhd.duration||y.mvhdDurtion/y.mvhdTimecale*y.timescale;var b=u.mdia.minf.stbl.stsd.entries[0];if(y.width=b.width,y.height=b.height,b.pasp&&(y.sarRatio=[b.pasp.hSpacing,b.pasp.vSpacing]),b.hvcC)y.codecType=Ut.HEVC,y.codec=b.hvcC.codec,y.vps=b.hvcC.vps,y.sps=b.hvcC.sps,y.pps=b.hvcC.pps,y.hvcC=b.hvcC.data;else if(b.avcC)y.codec=b.avcC.codec,y.sps=b.avcC.sps,y.pps=b.avcC.pps;else throw new Error("unknown video stsd entry");if(y.present=!0,y.ext={},y.ext.stss=(f=u.mdia)===null||f===void 0||(d=f.minf)===null||d===void 0||(v=d.stbl)===null||v===void 0?void 0:v.stss,y.ext.ctts=(h=u.mdia)===null||h===void 0||(p=h.minf)===null||p===void 0||(g=p.stbl)===null||g===void 0?void 0:g.ctts,b&&b.type==="encv"){var k,w,C,x,R,N,D,L;y.isVideoEncryption=!0,b.default_KID=(k=b.sinf)===null||k===void 0||(w=k.schi)===null||w===void 0?void 0:w.tenc.default_KID,b.default_IsEncrypted=(C=b.sinf)===null||C===void 0||(x=C.schi)===null||x===void 0?void 0:x.tenc.default_IsEncrypted,b.default_IV_size=(R=b.sinf)===null||R===void 0||(N=R.schi)===null||N===void 0?void 0:N.tenc.default_IV_size,y.videoSenc=u.mdia.minf.stbl.senc&&u.mdia.minf.stbl.senc.samples,b.data_format=(D=b.sinf)===null||D===void 0||(L=D.frma)===null||L===void 0?void 0:L.data_format,y.useEME=i.useEME,y.kidValue=i.kidValue,y.pssh=i.pssh,y.encv=b}}if(l&&e){var S,E,T,O,P,U,j,q,ue,V=e,ve=(S=l.tkhd)===null||S===void 0?void 0:S.trackId;ve!=null&&(V.id=l.tkhd.trackId),V.tkhdDuration=l.tkhd.duration,V.mvhdDurtion=i.mvhd.duration,V.mvhdTimecale=i.mvhd.timescale,V.timescale=V.formatTimescale=l.mdia.mdhd.timescale,V.duration=l.mdia.mdhd.duration||V.mvhdDurtion/V.mvhdTimecale*V.timescale;var K=l.mdia.minf.stbl.stsd.entries[0];switch(V.sampleSize=K.sampleSize,V.sampleRate=K.sampleRate,V.channelCount=K.channelCount,V.present=!0,K.type){case"alaw":V.codecType=V.codec=sn.G711PCMA,V.sampleRate=8e3;break;case"ulaw":V.codecType=V.codec=sn.G711PCMU,V.sampleRate=8e3;break;default:V.sampleDuration=gt.getFrameDuration(V.sampleRate,V.timescale),V.sampleRateIndex=gt.getRateIndexByRate(V.sampleRate),V.objectType=((n=K.esds)===null||n===void 0?void 0:n.objectType)||2,K.esds&&(V.config=Array.from(K.esds.config)),V.codec=((r=K.esds)===null||r===void 0?void 0:r.codec)||"mp4a.40.2";break}if(V.sampleDuration=gt.getFrameDuration(V.sampleRate,V.timescale),V.objectType=((E=K.esds)===null||E===void 0?void 0:E.objectType)||2,K.esds&&(K.esds.config?V.config=Array.from(K.esds.config):console.warn("esds config is null")),V.codec=((T=K.esds)===null||T===void 0?void 0:T.codec)||"mp4a.40.2",V.sampleRateIndex=gt.getRateIndexByRate(V.sampleRate),V.ext={},V.ext.stss=(O=l.mdia)===null||O===void 0||(P=O.minf)===null||P===void 0||(U=P.stbl)===null||U===void 0?void 0:U.stss,V.ext.ctts=(j=l.mdia)===null||j===void 0||(q=j.minf)===null||q===void 0||(ue=q.stbl)===null||ue===void 0?void 0:ue.ctts,V.present=!0,K&&K.type==="enca"){var Ke,Pe,Ye,Qe,$t,ye,Kt,He;V.isAudioEncryption=!0,K.data_format=(Ke=K.sinf)===null||Ke===void 0||(Pe=Ke.frma)===null||Pe===void 0?void 0:Pe.data_format,K.default_KID=(Ye=K.sinf)===null||Ye===void 0||(Qe=Ye.schi)===null||Qe===void 0?void 0:Qe.tenc.default_KID,K.default_IsEncrypted=($t=K.sinf)===null||$t===void 0||(ye=$t.schi)===null||ye===void 0?void 0:ye.tenc.default_IsEncrypted,K.default_IV_size=(Kt=K.sinf)===null||Kt===void 0||(He=Kt.schi)===null||He===void 0?void 0:He.tenc.default_IV_size,V.audioSenc=l.mdia.minf.stbl.senc&&l.mdia.minf.stbl.senc.samples,V.useEME=i.useEME,V.kidValue=i.kidValue,V.enca=K}}if(e&&(e.isVideoEncryption=t?t.isVideoEncryption:!1),t&&(t.isAudioEncryption=e?e.isAudioEncryption:!1),t!=null&&t.encv||e!=null&&e.enca){var Rt,hi,Et=t==null||(Rt=t.encv)===null||Rt===void 0?void 0:Rt.default_KID,xi=e==null||(hi=e.enca)===null||hi===void 0?void 0:hi.default_KID,Yt=Et||xi?(Et||xi).join(""):null;t&&(t.kid=Yt),e&&(e.kid=Yt)}return t&&(t.flags=3841),e&&(e.flags=1793),{videoTrack:t,audioTrack:e}}}},{key:"evaluateDefaultDuration",value:function(i,t,e){var n,r=t==null||(n=t.samples)===null||n===void 0?void 0:n.length;if(!r)return 1024;var s=1024*r/t.timescale;return s*i.timescale/e}},{key:"moofToSamples",value:function(i,t,e){var n={};return i.mfhd&&(t&&(t.sequenceNumber=i.mfhd.sequenceNumber),e&&(e.sequenceNumber=i.mfhd.sequenceNumber)),i.traf.forEach(function(r){var s=r.tfhd,u=r.tfdt,l=r.trun;if(!(!s||!l)){u&&(t&&t.id===s.trackId&&(t.baseMediaDecodeTime=u.baseMediaDecodeTime),e&&e.id===s.trackId&&(e.baseMediaDecodeTime=u.baseMediaDecodeTime));var c=s.defaultSampleSize||0,f=s.defaultSampleDuration||a.evaluateDefaultDuration(t,e,l.samples.length||l.sampleCount),d=l.dataOffset||0,v=0,h=-1;if(!l.samples.length&&l.sampleCount){n[s.trackId]=[];for(var p=0;p<l.sampleCount;p++)n[s.trackId].push({offset:d,dts:v,duration:f,size:c}),v+=f,d+=c}else n[s.trackId]=l.samples.map(function(g,y){return g={offset:d,dts:v,pts:v+(g.cts||0),duration:g.duration||f,size:g.size||c,gopId:h,keyframe:y===0||g.flags!==null&&g.flags!==void 0&&(g.flags&65536)>>>0!==65536},g.keyframe&&(h++,g.gopId=h),v+=g.duration,d+=g.size,g})}}),n}},{key:"moovToSamples",value:function(i){var t=i.trak;if(!(!t||!t.length)){var e=t.find(function(D){var L,S;return((L=D.mdia)===null||L===void 0||(S=L.hdlr)===null||S===void 0?void 0:S.handlerType)==="vide"}),n=t.find(function(D){var L,S;return((L=D.mdia)===null||L===void 0||(S=L.hdlr)===null||S===void 0?void 0:S.handlerType)==="soun"});if(!(!e&&!n)){var r,s;if(e){var u,l,c=(u=e.mdia)===null||u===void 0||(l=u.minf)===null||l===void 0?void 0:l.stbl;if(!c)return;var f=c.stts,d=c.stsc,v=c.stsz,h=c.stco,p=c.stss,g=c.ctts;if(!f||!d||!v||!h||!p)return;r=da(f,d,v,h,g,p)}if(n){var y,m,b,k=(y=n.mdia)===null||y===void 0||(m=y.minf)===null||m===void 0?void 0:m.stbl;if(!k)return;var w=(b=n.mdia.mdhd)===null||b===void 0?void 0:b.timescale,C=k.stts,x=k.stsc,R=k.stsz,N=k.stco;if(!w||!C||!x||!R||!N)return;s=da(C,x,R,N)}return{videoSamples:r,audioSamples:s}}}}}]),a}();function da(a,o,i,t,e,n){var r=[],s=e==null?void 0:e.entries,u=o.entries,l=t.entries,c=i.entrySizes,f=n==null?void 0:n.entries,d;f&&(d={},f.forEach(function(x){d[x-1]=!0}));var v;s&&(v=[],s.forEach(function(x){for(var R=x.count,N=x.offset,D=0;D<R;D++)v.push(N)}));var h,p=-1,g=0,y=0,m=0,b=0,k=0,w=u[0].samplesPerChunk,C=u[1]?u[1].firstChunk-1:1/0;return a.entries.forEach(function(x){for(var R=x.count,N=x.delta,D=0;D<R;D++)h={dts:g,duration:N,size:c[y]||i.sampleSize,offset:l[m]+k,index:y},f&&(h.keyframe=d[y],h.keyframe&&p++,h.gopId=p),v&&y<v.length&&(h.pts=h.dts+v[y]),r.push(h),g+=N,y++,y<w?k+=h.size:(m++,k=0,m>=C&&(b++,C=u[b+1]?u[b+1].firstChunk-1:1/0),w+=u[b].samplesPerChunk)}),r}function pa(a,o){return a.dataReferenceIndex=me(o,6),a.width=me(o,24),a.height=me(o,26),a.horizresolution=z(o,28),a.vertresolution=z(o,32),a.frameCount=me(o,40),a.depth=me(o,74),78}function va(a,o){return a.dataReferenceIndex=me(o,6),a.channelCount=me(o,16),a.sampleSize=me(o,18),a.sampleRate=z(o,24)/65536,28}function ie(a,o,i){if(a){if(a.size!==a.data.length)throw new Error("box ".concat(a.type," size !== data.length"));var t={start:a.start,size:a.size,headerSize:a.headerSize,type:a.type};return o&&(t.version=a.data[a.headerSize],t.flags=vc(a.data,a.headerSize+1),t.headerSize+=4),i(t,a.data.subarray(t.headerSize),t.start+t.headerSize),t}}var bc=function(o,i,t){for(var e=String(t),n=i>>0,r=Math.ceil(n/e.length),s=[],u=String(o);r--;)s.push(e);return s.join("").substring(0,n-u.length)+u},Un=function(){for(var o=[],i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];return t.forEach(function(n){o.push(bc(Number(n).toString(16),2,0))}),o[0]},Sc=function(){function a(o,i,t){ke(this,a),this.videoTrack=o||new vs,this.audioTrack=i||new gs,this.metadataTrack=t||new ys}return Ee(a,[{key:"demux",value:function(i,t){var e=this.videoTrack,n=this.audioTrack,r=e.exist(),s=n.exist();if(e.samples=[],n.samples=[],t){if(!s){var u=we.findBox(t,["moov"])[0];if(!u)throw new Error("cannot found moov box");we.moovToTrack(we.moov(u),null,n)}var l=we.findBox(t,["moof"])[0];if(l){var c=we.moofToSamples(we.moof(l),null,n)[n.id],f=n.baseMediaDecodeTime;if(c){var d=l.start;c.map(function(k){k.offset+=d;var w=t.subarray(k.offset,k.offset+k.size);n.samples.push(new on(k.dts+f,w,k.duration))})}}}if(i){if(!r&&!s){var v=we.findBox(i,["moov"])[0];if(!v)throw new Error("cannot found moov box");we.moovToTrack(we.moov(v),e,n)}var h=we.findBox(i,["moof"])[0];if(h){var p=we.moofToSamples(we.moof(h),e,n),g=e.baseMediaDecodeTime,y=n.baseMediaDecodeTime,m=h.start,b;Object.keys(p).forEach(function(k){e.id==k?p[k].map(function(w){w.offset+=m;var C=new ms((w.pts||w.dts)+g,w.dts+g);C.duration=w.duration,C.gopId=w.gopId,w.keyframe&&C.setToKeyframe();var x=i.subarray(w.offset,w.offset+w.size);C.data=x;for(var R=0,N=x.length-1;R<N;)b=z(x,R),R+=4,C.units.push(x.subarray(R,R+b)),R+=b;e.samples.push(C)}):n.id==k&&p[k].map(function(w){w.offset+=m;var C=i.subarray(w.offset,w.offset+w.size);n.samples.push(new on(w.dts+y,C,w.duration))})})}}return{videoTrack:e,audioTrack:n,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(i){return we.probe(i)}}]),a}();function kc(a){for(var o=0,i=arguments.length,t=new Array(i>1?i-1:0),e=1;e<i;e++)t[e-1]=arguments[e];t.forEach(function(s){o+=s.length});var n=new a(o),r=0;return t.forEach(function(s){n.set(s,r),r+=s.length}),n}var Ie=function(){function a(){ke(this,a),this.buffer=new Uint8Array(0)}return Ee(a,[{key:"write",value:function(){for(var i=this,t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach(function(r){r?i.buffer=kc(Uint8Array,i.buffer,r):window.console.warn(r)})}}],[{key:"writeUint16",value:function(i){return new Uint8Array([i>>8&255,i&255])}},{key:"writeUint32",value:function(i){return new Uint8Array([i>>24,i>>16&255,i>>8&255,i&255])}}]),a}(),ga=Math.pow(2,32)-1,re=function(){function a(){ke(this,a)}return Ee(a,null,[{key:"box",value:function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];e=e.filter(Boolean);var r=8+e.reduce(function(l,c){return l+c.byteLength},0),s=new Uint8Array(r);s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=r&255,s.set(i,4);var u=8;return e.forEach(function(l){s.set(l,u),u+=l.byteLength}),s}},{key:"ftyp",value:function(i){var t=i.find(function(e){return e.type===oi.VIDEO&&e.codecType===Ut.HEVC});return t?a.FTYPHEV1:a.FTYPAVC1}},{key:"initSegment",value:function(i){var t=a.ftyp(i),e=qe(t,a.moov(i));return e}},{key:"pssh",value:function(i){var t=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],ca(i.kid),[0,0,0,0]));return a.box(a.types.pssh,t)}},{key:"moov",value:function(i){if(i[0].useEME&&(i[0].encv||i[0].enca)){i[0].pssh||(i[0].pssh={kid:i[0].kid});var t=this.pssh(i[0].pssh);return a.box.apply(a,[a.types.moov,a.mvhd(i[0].mvhdDurtion||i[0].duration,i[0].mvhdTimecale||i[0].timescale),a.mvex(i)].concat(ze(i.map(function(e){return a.trak(e)})),[t]))}else return a.box.apply(a,[a.types.moov,a.mvhd(i[0].mvhdDurtion||i[0].duration,i[0].mvhdTimecale||i[0].timescale)].concat(ze(i.map(function(e){return a.trak(e)})),[a.mvex(i)]))}},{key:"mvhd",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=a.box(a.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24&255,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return e}},{key:"trak",value:function(i){var t=a.box(a.types.trak,a.tkhd(i.id,i.tkhdDuration||0,i.width,i.height),a.mdia(i));return t}},{key:"tkhd",value:function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,r=a.box(a.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,i&255,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,e&255,0,0,n>>8&255,n&255,0,0]));return r}},{key:"mdia",value:function(i){var t=a.box(a.types.mdia,a.mdhd(i.duration,i.timescale),a.hdlr(i.type),a.minf(i));return t}},{key:"mdhd",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=a.box(a.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24&255,i>>16&255,i>>8&255,i&255,85,196,0,0]));return e}},{key:"hdlr",value:function(i){var t=a.box(a.types.hdlr,a.HDLR_TYPES[i]);return t}},{key:"minf",value:function(i){var t=a.box(a.types.minf,i.type===oi.VIDEO?a.VMHD:a.SMHD,a.DINF,a.stbl(i));return t}},{key:"stbl",value:function(i){var t=[];i&&i.ext&&i.ext.stss&&t.push(a.stss(i.ext.stss.entries));var e=a.box(a.types.stbl,a.stsd(i),a.STTS,t[0],a.STSC,a.STSZ,a.STCO);return e}},{key:"stsd",value:function(i){var t;i.type==="audio"?i.useEME&&i.enca?t=a.enca(i):t=a.mp4a(i):i.useEME&&i.encv?t=a.encv(i):t=a.avc1hev1(i);var e=a.box(a.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t);return e}},{key:"enca",value:function(i){var t=i.enca.channelCount,e=i.enca.sampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,e>>8&255,e&255,0,0]),r=a.esds(i.config),s=a.sinf(i.enca);return a.box(a.types.enca,n,r,s)}},{key:"encv",value:function(i){var t,e,n=i.sps.length>0?i.sps[0]:[],r=i.pps.length>0?i.pps[0]:[],s=i.width,u=i.height,l=i.sarRatio[0],c=i.sarRatio[1],f=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,s&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array((t=(e=[1,n[1],n[2],n[3],255,225,n.length>>>8&255,n.length&255]).concat.apply(e,ze(n)).concat([1,r.length>>>8&255,r.length&255])).concat.apply(t,ze(r))),v=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),h=a.sinf(i.encv),p=new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255]);return a.box(a.types.encv,f,a.box(a.types.avcC,d),a.box(a.types.btrt,v),h,a.box(a.types.pasp,p))}},{key:"schi",value:function(i){var t=new Uint8Array([]),e=a.tenc(i);return a.box(a.types.schi,t,e)}},{key:"tenc",value:function(i){var t=new Uint8Array([0,0,0,0,0,0,i.default_IsEncrypted&255,i.default_IV_size&255].concat(ca(i.default_KID)));return a.box(a.types.tenc,t)}},{key:"sinf",value:function(i){var t=new Uint8Array([]),e=new Uint8Array([i.data_format.charCodeAt(0),i.data_format.charCodeAt(1),i.data_format.charCodeAt(2),i.data_format.charCodeAt(3)]),n=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),r=a.schi(i);return a.box(a.types.sinf,t,a.box(a.types.frma,e),a.box(a.types.schm,n),r)}},{key:"avc1hev1",value:function(i){var t=i.codecType===Ut.HEVC,e=t?a.types.hvc1:a.types.avc1,n=t?a.hvcC(i):a.avcC(i),r=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i.width>>8&255,i.width&255,i.height>>8&255,i.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n];return t?r.push(a.box(a.types.fiel,new Uint8Array([1,0]))):i.sarRatio&&i.sarRatio.length>1&&r.push(a.pasp(i.sarRatio)),a.box.apply(a,[e].concat(r))}},{key:"avcC",value:function(i){var t,e,n=[],r=[],s;return i.sps.forEach(function(u){s=u.byteLength,n.push(s>>>8&255),n.push(s&255),n.push.apply(n,ze(u))}),i.pps.forEach(function(u){s=u.byteLength,r.push(s>>>8&255),r.push(s&255),r.push.apply(r,ze(u))}),a.box(a.types.avcC,new Uint8Array((t=(e=[1,n[3],n[4],n[5],255,224|i.sps.length]).concat.apply(e,n).concat([i.pps.length])).concat.apply(t,r)))}},{key:"hvcC",value:function(i){var t=i.hvcC;if(t instanceof ArrayBuffer||t instanceof Uint8Array)return t;var e=i.vps,n=i.sps,r=i.pps,s;if(t){var u=t.generalProfileCompatibilityFlags,l=t.generalConstraintIndicatorFlags,c=(e.length&&1)+(n.length&&1)+(r.length&&1);s=[1,t.generalProfileSpace<<6|t.generalTierFlag<<5|t.generalProfileIdc,u>>>24,u>>>16,u>>>8,u,l[0],l[1],l[2],l[3],l[4],l[5],t.generalLevelIdc,240,0,252,t.chromaFormatIdc|252,t.bitDepthLumaMinus8|248,t.bitDepthChromaMinus8|248,0,0,t.numTemporalLayers<<3|t.temporalIdNested<<2|3,c];var f=function(v){var h;s.push(v.length>>8,v.length),(h=s).push.apply(h,ze(v))};e.length&&(s.push(160,0,e.length),e.forEach(f)),n.length&&(s.push(161,0,n.length),n.forEach(f)),r.length&&(s.push(162,0,r.length),r.forEach(f))}else s=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return a.box(a.types.hvcC,new Uint8Array(s))}},{key:"pasp",value:function(i){var t=ic(i,2),e=t[0],n=t[1];return a.box(a.types.pasp,new Uint8Array([e>>24,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255]))}},{key:"mp4a",value:function(i){return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,i.sampleRate>>8&255,i.sampleRate&255,0,0]),i.config.length?a.esds(i.config):void 0)}},{key:"esds",value:function(i){var t=i.length,e=a.box(a.types.esds,new Uint8Array([0,0,0,0,3,23+t,0,0,0,4,15+t,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([t]).concat(i).concat([6,1,2])));return e}},{key:"mvex",value:function(i){var t=a.box.apply(a,[a.types.mvex].concat(ze(i.map(function(e){return a.trex(e.id)}))));return t}},{key:"trex",value:function(i){var t=a.box(a.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return t}},{key:"trex1",value:function(i){var t=a.box(a.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return t}},{key:"trex2",value:function(i){var t=a.box(a.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return t}},{key:"moof",value:function(i){var t=a.box.apply(a,[a.types.moof,a.mfhd(i[0].samples?i[0].samples[0].gopId:0)].concat(ze(i.map(function(e){return a.traf(e)}))));return t}},{key:"mfhd",value:function(i){var t=a.box(a.types.mfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255]));return t}},{key:"traf",value:function(i){var t=a.tfhd(i.id),e=a.tfdt(i,i.baseMediaDecodeTime),n=0,r;if(i.isVideo&&i.videoSenc&&(r=i.videoSenc,r.forEach(function(E){n=n+8,E.subsamples&&E.subsamples.length&&(n=n+2,n=n+E.subsamples.length*6)})),i.videoSencLength=n,!i.useEME||!i.isVideoEncryption&&!i.isAudioEncryption){var s=a.sdtp(i),u=76;return a.box(a.types.traf,t,e,s,a.trun(i.samples,s.byteLength+u))}else if(i.isVideoEncryption)if(i.isVideo){var l=a.saiz(i),c=a.saio(i),f=a.trun1(i),d=a.senc(i),v=a.box(a.types.traf,t,e,l,c,f,d);return v}else if(i.isAudioEncryption){var g=a.sbgp(),y=a.saiz(i),m=a.saio(i),b=a.senc(i),k=a.trun1(i),w=a.box(a.types.traf,t,e,g,y,m,b,k);return w}else{var h=a.sbgp(),p=a.trun1(i);return a.box(a.types.traf,t,e,h,p)}else if(i.isVideo){var C=a.trun1(i);return a.box(a.types.traf,t,e,C)}else{var x=a.sbgp(),R=a.saiz(i),N=a.saio(i),D=a.senc(i),L=a.trun1(i),S=a.box(a.types.traf,t,e,x,R,N,D,L);return S}}},{key:"sdtp",value:function(i){var t=new Ie;return i.samples.forEach(function(e){t.write(new Uint8Array(i.isVideo?[e.keyframe?32:16]:[16]))}),a.box(a.types.sdtp,this.extension(0,0),t.buffer)}},{key:"trun1",value:function(i){var t=new Ie,e=Ie.writeUint32(i.samples.length),n=null;if(i.isVideo){var r=i.videoSencLength;n=Ie.writeUint32(i.samples.length*16+r+149),!i.isVideoEncryption&&i.isAudioEncryption&&(n=Ie.writeUint32(i.samples.length*16+92))}else{var s=i.samples.length*12+124;i.isAudioEncryption&&(s=i.samples.length*12+8*i.audioSenc.length+177),n=Ie.writeUint32(s)}return i.samples.forEach(function(u){t.write(Ie.writeUint32(u.duration)),t.write(Ie.writeUint32(u.size)),t.write(Ie.writeUint32(u.keyframe?33554432:65536)),i.isVideo&&t.write(Ie.writeUint32(u.cts?u.cts:0))}),a.box(a.types.trun,this.extension(0,i.flags),e,n,t.buffer)}},{key:"senc",value:function(i){var t=new Ie,e=i.samples.length,n=i.isVideo?16:8,r=i.isVideo?2:0,s=[],u=0;return i.isVideo?(s=i.videoSenc,u=i.videoSencLength):s=i.audioSenc,u=u||n*e,t.write(Ie.writeUint32(16+u),a.types.senc,this.extension(0,r)),t.write(Ie.writeUint32(e)),s.forEach(function(l){for(var c=0;c<l.InitializationVector.length;c++)t.write(new Uint8Array([l.InitializationVector[c]]));l.subsamples&&l.subsamples.length&&(t.write(Ie.writeUint16(l.subsamples.length)),l.subsamples.forEach(function(f){t.write(Ie.writeUint16(f.BytesOfClearData)),t.write(Ie.writeUint32(f.BytesOfProtectedData))}))}),t.buffer}},{key:"saio",value:function(i){var t=i.samples.length*12+141;!i.isVideo&&i.isAudioEncryption&&(t=149);var e=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]);return a.box(a.types.saio,e)}},{key:"saiz",value:function(i){var t=i.samples.length,e=new Uint8Array([0,0,0,0,16,t>>24&255,t>>16&255,t>>8&255,t&255]);return a.box(a.types.saiz,e)}},{key:"sbgp",value:function(){var i=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return a.box(a.types.sbgp,this.extension(0,0),i)}},{key:"extension",value:function(i,t){return new Uint8Array([i,t>>16&255,t>>8&255,t&255])}},{key:"tfhd",value:function(i){return a.box(a.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"tfdt",value:function(i,t){var e=Math.floor(t/(ga+1)),n=Math.floor(t%(ga+1));return i.useEME&&(i.isVideoEncryption||i.isAudioEncryption)?a.box(a.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])):a.box(a.types.tfdt,new Uint8Array([1,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255]))}},{key:"trun",value:function(i,t){var e=i.length,n=12+16*e;t+=8+n;var r=new Uint8Array(n);r.set([0,0,15,1,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0);for(var s=0;s<e;s++){var u=i[s],l=u.duration,c=u.size,f=u.flag,d=f===void 0?{}:f,v=u.cts,h=v===void 0?0:v;r.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|(d.dependsOn===null||d.dependsOn===void 0?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(d.isNonSyncSample===null||d.isNonSyncSample===void 0?1:d.isNonSyncSample),d.degradationPriority&61440,d.degradationPriority&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*s)}return a.box(a.types.trun,r)}},{key:"moovMP4",value:function(i){return a.box.apply(a,[a.types.moov,a.mvhd(i[0].duration,i[0].timescale)].concat(ze(i.map(function(t){return a.trackMP4(t)}))))}},{key:"trackMP4",value:function(i){return a.box(a.types.trak,a.tkhd(i.id,i.duration,i.width,i.height),a.mdiaMP4(i))}},{key:"mdiaMP4",value:function(i){return a.box(a.types.mdia,a.mdhd(i.duration,i.timescale),a.hdlr(i.type),a.minfMP4(i))}},{key:"minfMP4",value:function(i){return a.box(a.types.minf,i.type===oi.VIDEO?a.VMHD:a.SMHD,a.DINF,a.stblMP4(i))}},{key:"stblMP4",value:function(i){var t=i.ext,e=[a.stsd(i),a.stts(t.stts),a.stsc(t.stsc),a.stsz(t.stsz),a.stco(t.stco)];return t.stss.length&&e.push(a.stss(t.stss)),t.ctts.length&&e.push(a.ctts(t.ctts)),a.box.apply(a,[a.types.stbl].concat(e))}},{key:"stts",value:function(i){var t=i.length,e=new Uint8Array(8*t),n=0;return i.forEach(function(r){var s=r.value,u=r.count;e.set([u>>24,u>>16&255,u>>8&255,u&255,s>>24,s>>16&255,s>>8&255,s&255],n),n+=8}),a.box(a.types.stts,qe(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stsc",value:function(i){var t=i.length,e=new Uint8Array(12*t),n=0;return i.forEach(function(r){var s=r.firstChunk,u=r.samplesPerChunk,l=r.sampleDescIndex;e.set([s>>24,s>>16&255,s>>8&255,s&255,u>>24,u>>16&255,u>>8&255,u&255,l>>24,l>>16&255,l>>8&255,l&255],n),n+=12}),a.box(a.types.stsc,qe(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stsz",value:function(i){var t=i.length,e=new Uint8Array(4*t),n=0;return i.forEach(function(r){e.set([r>>24,r>>16&255,r>>8&255,r&255],n),n+=4}),a.box(a.types.stsz,qe(new Uint8Array([0,0,0,0,0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stco",value:function(i){var t=i.length,e=new Uint8Array(4*t),n=0;return i.forEach(function(r){e.set([r>>24,r>>16&255,r>>8&255,r&255],n),n+=4}),a.box(a.types.stco,qe(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stss",value:function(i){var t=i.length,e=new Uint8Array(4*t),n=0;return i.forEach(function(r){e.set([r>>24,r>>16&255,r>>8&255,r&255],n),n+=4}),a.box(a.types.stss,qe(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"ctts",value:function(i){var t=i.length,e=new Uint8Array(8*t),n=0;return i.forEach(function(r){var s=r.value,u=r.count;e.set([u>>24,u>>16&255,u>>8&255,u&255,s>>24,s>>16&255,s>>8&255,s&255],n),n+=8}),a.box(a.types.ctts,qe(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"styp",value:function(){return a.box(a.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(i){var t=i.timescale,e=i.samples[0].duration,n=e*i.samples.length,r=i.samples[0].sampleOffset*e,s=8;i.samples.forEach(function(d){s+=d.size});var u=0;if(i.isVideo){var l=0,c;i.videoSenc&&(c=i.videoSenc),i.isVideo&&c.forEach(function(d){l=l+8,d.subsamples&&d.subsamples.length&&(l=l+2,l=l+d.subsamples.length*6)}),i.videoSencLength=l,u=s+141+i.samples.length*16+l,i.useEME&&i.isAudioEncryption&&!i.isVideoEncryption&&(u=s+i.samples.length*16+84)}else u=s+116+i.samples.length*12,i.useEME&&i.isAudioEncryption&&(u=s+169+i.samples.length*12+8*i.audioSenc.length);var f=new Uint8Array([0,0,0,0,0,0,0,i.id&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,0,0,0,1,0,u>>16&255,u>>8&255,u&255,n>>24&255,n>>16&255,n>>8&255,n&255,144,0,0,0]);return a.box(a.types.sidx,f)}},{key:"mdat",value:function(i){var t=a.box(a.types.mdat,i);return t}}]),a}();F(re,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce(function(a,o){return a[o]=[o.charCodeAt(0),o.charCodeAt(1),o.charCodeAt(2),o.charCodeAt(3)],a},Object.create(null)));F(re,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])});F(re,"FTYPAVC1",re.box(re.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])));F(re,"FTYPHEV1",re.box(re.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49])));F(re,"DINF",re.box(re.types.dinf,re.box(re.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]))));F(re,"VMHD",re.box(re.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])));F(re,"SMHD",re.box(re.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0])));F(re,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0]));F(re,"STTS",re.box(re.types.stts,re.StblTable));F(re,"STSC",re.box(re.types.stsc,re.StblTable));F(re,"STSZ",re.box(re.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0])));F(re,"STCO",re.box(re.types.stco,re.StblTable));var Ss=function(){function a(o,i){ke(this,a),this.name=o||"",this._prefix="[".concat(this.name,"]"),a.disabled=i}return Ee(a,[{key:"debug",value:function(){var i;if(!a.disabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(i=console).debug.apply(i,[this._prefix].concat(e))}}},{key:"log",value:function(){var i;if(!a.disabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(i=console).log.apply(i,[this._prefix].concat(e))}}},{key:"warn",value:function(){var i;if(!a.disabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(i=console).warn.apply(i,[this._prefix].concat(e))}}},{key:"error",value:function(){var i;if(!a.disabled){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(i=console).error.apply(i,[this._prefix].concat(e))}}},{key:"table",value:function(){var i;a.disabled||(console.group(this._prefix),(i=console).table.apply(i,arguments),console.groupEnd())}}],[{key:"enable",value:function(){a.disabled=!1}},{key:"disable",value:function(){a.disabled=!0}}]),a}();F(Ss,"disabled",!0);var Ec=function(){function a(o,i,t){ke(this,a),this.videoTrack=o,this.audioTrack=i;var e=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=e&&Number(e[1])<50,this.log=new Ss("FMP4Remuxer",t&&t.openLog?!t.openLog:!0)}return Ee(a,[{key:"remux",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=this.videoTrack,n=this.audioTrack,r=e.exist(),s=n.exist(),u,l,c,f=[];i&&(t&&t.initMerge?(r&&f.push(this.videoTrack),s&&f.push(this.audioTrack),c=re.initSegment(f)):(r&&(u=re.initSegment([this.videoTrack])),s&&(l=re.initSegment([this.audioTrack]))));var d,v;return r&&e.hasSample()&&(d=this._remuxVideo()),s&&n.hasSample()&&(v=this._remuxAudio()),e.samples=[],n.samples=[],{initSegment:c,videoInitSegment:u,audioInitSegment:l,videoSegment:d,audioSegment:v}}},{key:"_remuxVideo",value:function(){var i=this.videoTrack;this.forceFirstIDR&&(i.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=i.samples,e=0;t.forEach(function(h){e+=h.units.reduce(function(p,g){return p+g.byteLength},0),e+=h.units.length*4});for(var n=new Uint8Array(e),r=new DataView(n.buffer),s=function(p,g){g=t[u];var y=0;g.units.forEach(function(m){r.setUint32(p,m.byteLength),p+=4,n.set(m,p),p+=m.byteLength,y+=4+m.byteLength}),g.size=y,c=p,f=g},u=0,l=t.length,c=0,f;u<l;u++)s(c,f);var d=re.mdat(n),v=re.moof([i]);return qe(v,d)}},{key:"_remuxAudio",value:function(){var i=this.audioTrack,t=new Uint8Array(i.samples.reduce(function(r,s){return r+s.size},0));i.samples.reduce(function(r,s){return t.set(s.data,r),r+s.size},0);var e=re.mdat(t),n=re.moof([i]);return qe(n,e)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),a}(),wc=function(){function a(){Ce(this,a);var o=window.crypto||window.msCrypto;this.subtle=o&&(o.subtle||o.webkitSubtle),this.externalDecryptor=null}return xe(a,[{key:"destroy",value:function(){var i;(i=this.externalDecryptor)!==null&&i!==void 0&&i.destroy&&this.externalDecryptor.destroy()}},{key:"decrypt",value:function(i,t){if(!(!i&&!t)){var e=[];return i&&(e[0]=this._decryptSegment(i)),t&&(e[1]=this._decryptSegment(t)),Promise.all(e)}}},{key:"_decryptSegment",value:function(){var o=fe(G().mark(function t(e){var n;return G().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(n=e.data,!e.key){s.next=5;break}return s.next=4,this._decryptData(e.data,e.key,e.keyIv);case 4:n=s.sent;case 5:if(e.map){s.next=7;break}return s.abrupt("return",n);case 7:return s.abrupt("return",Gi(e.map,n));case 8:case"end":return s.stop()}},t,this)}));function i(t){return o.apply(this,arguments)}return i}()},{key:"_decryptData",value:function(){var o=fe(G().mark(function t(e,n,r){var s;return G().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!this.externalDecryptor){l.next=6;break}return l.next=3,this.externalDecryptor.decrypt(e,n,r);case 3:return l.abrupt("return",l.sent);case 6:if(this.subtle){l.next=8;break}throw new Error("crypto is not defined");case 8:return l.next=10,this.subtle.importKey("raw",n,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return s=l.sent,l.t0=Uint8Array,l.next=14,this.subtle.decrypt({name:"AES-CBC",iv:r},s,e);case 14:return l.t1=l.sent,l.abrupt("return",new l.t0(l.t1));case 16:case"end":return l.stop()}},t,this)}));function i(t,e,n){return o.apply(this,arguments)}return i}()}]),a}(),se=de(de({},J),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",SUBTITLE_SEGMENTS:"core.subtitlesegments",SUBTITLE_PLAYLIST:"core.subtitleplaylist",SEI_PAYLOAD_TIME:"core.seipayloadtime",APPEND_COST:"core.appendcost"}),Bi=new ft("Transmuxer"),ma=function(){function a(o,i,t){Ce(this,a),A(this,"_initSegmentId",""),this.hls=o,this._demuxer=i?new Sc:new bs,this._isMP4=i,t&&(this._remuxer=new Ec(this._demuxer.videoTrack,this._demuxer.audioTrack))}return xe(a,[{key:"transmux",value:function(i,t,e,n,r,s){var u=this._demuxer;try{this._isMP4?u.demux(i,t):u.demuxAndFix(Gi(i,t),e,n,r)}catch(k){throw new be(oe.DEMUX,oe.SUB_TYPES.HLS,k)}var l=u.videoTrack,c=u.audioTrack,f=u.metadataTrack,d="".concat(l.codec,"/").concat(l.width,"/").concat(l.height,"/").concat(c.codec,"/").concat(c.config);if(d!==this._initSegmentId&&(this._initSegmentId=d,s=!0),this._fireEvents(l,c,f,e||s),this.hls.emit(se.DEMUXED_TRACK,{videoTrack:l,audioTrack:c}),this._remuxer)try{var v=this._remuxer.remux(s),h=v.videoInitSegment,p=v.videoSegment,g=v.audioInitSegment,y=v.audioSegment,m=Gi(h,p),b=Gi(g,y);return[m?{codec:l.codec,data:m}:void 0,b?{codec:c.codec,data:b}:void 0]}catch(k){throw new be(oe.REMUX,oe.SUB_TYPES.FMP4,k)}else return[l,c]}},{key:"_fireEvents",value:function(i,t,e,n){var r=this;Bi.debug(i.samples,t.samples),n&&(i.exist()&&this.hls.emit(se.METADATA_PARSED,{type:"video",track:i,meta:{codec:i.codec,timescale:i.timescale,width:i.width,height:i.height,sarRatio:i.sarRatio,baseDts:i.baseDts}}),t.exist()&&this.hls.emit(se.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),Bi.debug("discontinuity",i,t)),i.warnings.forEach(function(s){var u;switch(s.type){case Xe.LARGE_AV_SHIFT:u=se.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case Xe.LARGE_VIDEO_GAP:u=se.LARGE_VIDEO_DTS_GAP_DETECT;break;case Xe.LARGE_VIDEO_GAP_BETWEEN_CHUNK:u=se.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}u&&r.hls.emit(se.STREAM_EXCEPTION,de(de({},s),{},{type:u})),Bi.warn("video exception",s)}),t.warnings.forEach(function(s){var u;switch(s.type){case Xe.LARGE_AUDIO_GAP:u=se.LARGE_AUDIO_DTS_GAP_DETECT;break;case Xe.AUDIO_FILLED:u=se.AUDIO_GAP_DETECT;break;case Xe.AUDIO_DROPPED:u=se.AUDIO_OVERLAP_DETECT;break}u&&r.hls.emit(se.STREAM_EXCEPTION,de(de({},s),{},{type:u})),Bi.warn("audio exception",s)}),i.samples.forEach(function(s){s.keyframe&&r.hls.emit(se.KEYFRAME,{pts:s.pts})}),e.seiSamples.forEach(function(s){r.hls.emit(se.SEI,de(de({},s),{},{originPts:s.originPts/90,sei:{code:s.data.type,content:s.data.payload,dts:s.pts}}))})}}]),a}(),ya=new ft("BufferService"),Tc=function(){function a(o){Ce(this,a),A(this,"_decryptor",new wc),A(this,"_transmuxer",null),A(this,"_mse",null),A(this,"_softVideo",null),A(this,"_sourceCreated",!1),A(this,"_needInitSegment",!0),A(this,"_directAppend",!1),this.hls=o,o.config.softDecode?this._softVideo=o.media:(this._mse=new Ve(null,{preferMMS:o.config.preferMMS}),o.config.url&&this._mse.bindMedia(o.media)),o.config.decryptor&&(this._decryptor.externalDecryptor=o.config.decryptor)}return xe(a,[{key:"baseDts",get:function(){var i,t,e;return(i=this._transmuxer)===null||i===void 0||(t=i._demuxer)===null||t===void 0||(e=t._fixer)===null||e===void 0?void 0:e._baseDts}},{key:"nbSb",get:function(){var i;return(i=this._mse)!==null&&i!==void 0&&i._sourceBuffer?Object.keys(this._mse._sourceBuffer).length:0}},{key:"msIsOpend",get:function(){var i;return(i=this._mse)===null||i===void 0?void 0:i.isOpened}},{key:"msStreaming",get:function(){var i;return(i=this._mse)===null||i===void 0?void 0:i.streaming}},{key:"updateDuration",value:function(){var o=fe(G().mark(function t(e){return G().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(ya.debug("update duration",e),!this._mse){r.next=9;break}if(this._mse.isOpened){r.next=5;break}return r.next=5,this._mse.open();case 5:return r.next=7,this._mse.updateDuration(e);case 7:r.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=e);case 10:case"end":return r.stop()}},t,this)}));function i(t){return o.apply(this,arguments)}return i}()},{key:"createSource",value:function(i,t,e,n){if(!this._sourceCreated){var r=i||t;if(r){if(bs.probe(r))this._transmuxer||(this._transmuxer=new ma(this.hls,!1,!this._softVideo));else if(we.probe(r))if(this._softVideo)this._transmuxer||(this._transmuxer=new ma(this.hls,!0));else{this._directAppend=!0;var s=!1;i&&!e&&we.findBox(i,["moov","trak"]).forEach(function(u){var l=we.findBox(u.data,["trak","mdia","minf","stbl","stsd"])[0];if(l){var c=we.stsd(l).entries[0];if(c){if(c.hvcC)e=c.hvcC.codec||"hev1.1.6.L93.B0";else if(c.avcC)e=c.avcC.codec;else if(c.sampleRate||c.esds){var f;n=((f=c.esds)===null||f===void 0?void 0:f.codec)||"mp4a.40.2",s=!0}}}}),t&&!n&&we.findBox(t,["moov","trak","mdia","minf","stbl","stsd"]).forEach(function(u){var l=we.stsd(u).entries[0];l&&l.esds&&(n=l.esds.codec)}),i&&!e&&(e="avc1.42e01e"),t&&!n&&(n="mp4a.40.2"),s&&(e+=", ".concat(n),n=""),this._createMseSource(e,n)}else throw new be(oe.OTHER,null,null,null,"unsupported stream");this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:function(){var o=fe(G().mark(function t(e,n,r,s,u,l,c){var f,d,v,h,p,g,y,m,b;return G().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!(!(r!=null&&r.length)&&!(s!=null&&s.length))){w.next=2;break}return w.abrupt("return");case 2:if(!this._directAppend){w.next=7;break}return f=[],r&&f.push(this._mse.append(Ve.VIDEO,r)),s&&f.push(this._mse.append(Ve.AUDIO,s)),w.abrupt("return",Promise.all(f));case 7:if(d=this._needInitSegment||u,v=this._transmuxer.transmux(r,s,u,l,c,this._needInitSegment||u),h=bt(v,2),p=h[0],g=h[1],s&&n&&(n==null||n.setTrackExist(!1,!0)),s&&e&&(e==null||e.setTrackExist(!0,!1)),n||e==null||e.setTrackExist(!!p,!!g),p&&!g&&this.hls.emit(se.NO_AUDIO_TRACK),!this._softVideo){w.next=18;break}this._softVideo.appendBuffer(p,g),this._needInitSegment=!1,w.next=28;break;case 18:if(!this._mse){w.next=28;break}return y=!this._sourceCreated,y&&this._createMseSource(p==null?void 0:p.codec,g==null?void 0:g.codec),this._needInitSegment=!1,m=this._mse,b=[],d&&!y&&this._handleCodecChange(p,g),p&&b.push(m.append(Ve.VIDEO,p.data)),g&&b.push(m.append(Ve.AUDIO,g.data)),w.abrupt("return",Promise.all(b));case 28:case"end":return w.stop()}},t,this)}));function i(t,e,n,r,s,u,l){return o.apply(this,arguments)}return i}()},{key:"removeBuffer",value:function(){var o=fe(G().mark(function t(){var e=this,n,r,s,u=arguments;return G().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(n=u.length>0&&u[0]!==void 0?u[0]:0,r=u.length>1&&u[1]!==void 0?u[1]:1/0,s=this.hls.media,!(!this._mse||!s||n<0||r<n||n>=this._mse.duration)){c.next=5;break}return c.abrupt("return");case 5:return c.abrupt("return",this._mse.clearBuffer(n,r).then(function(){return e.hls.emit(J.REMOVE_BUFFER,{start:n,end:r,removeEnd:r})}));case 6:case"end":return c.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i}()},{key:"evictBuffer",value:function(){var o=fe(G().mark(function t(e){var n,r,s,u;return G().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(n=this.hls.media,!(!this._mse||!n||!e||e<0)){c.next=3;break}return c.abrupt("return");case 3:if(r=n.currentTime,s=r-e,!(s<=0)){c.next=7;break}return c.abrupt("return");case 7:if(u=Oe.start(Oe.get(n)),!(u+1>=s)){c.next=10;break}return c.abrupt("return");case 10:return c.abrupt("return",this.removeBuffer(0,s));case 11:case"end":return c.stop()}},t,this)}));function i(t){return o.apply(this,arguments)}return i}()},{key:"clearAllBuffer",value:function(){var o=fe(G().mark(function t(){return G().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._mse){n.next=2;break}return n.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return n.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i}()},{key:"decryptBuffer",value:function(i,t){return this._decryptor.decrypt(i,t)}},{key:"reset",value:function(){var o=fe(G().mark(function t(){var e,n=arguments;return G().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e=n.length>0&&n[0]!==void 0?n[0]:!1,!(this._mse&&!e)){s.next=8;break}return this._transmuxer=null,this._sourceCreated=!1,s.next=6,this._mse.unbindMedia();case 6:return s.next=8,this._mse.bindMedia(this.hls.media);case 8:this._needInitSegment=!0,this._directAppend=!1;case 10:case"end":return s.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i}()},{key:"endOfStream",value:function(){var o=fe(G().mark(function t(){return G().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._mse){n.next=5;break}if(!this._sourceCreated){n.next=5;break}return n.next=4,this._mse.endOfStream();case 4:this.hls.emit(J.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return n.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i}()},{key:"setLiveSeekableRange",value:function(){var o=fe(G().mark(function t(e,n){return G().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:this._mse&&this._mse.setLiveSeekableRange(e,n);case 1:case"end":return s.stop()}},t,this)}));function i(t,e){return o.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var o=fe(G().mark(function t(){var e;return G().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if((e=this._decryptor)===null||e===void 0||e.destroy(),!this._mse){r.next=4;break}return r.next=4,this._mse.unbindMedia();case 4:this._decryptor=null,this._mse=null,this._softVideo=null;case 7:case"end":return r.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i}()},{key:"_createMseSource",value:function(i,t){ya.debug("create mse source, videoCodec=".concat(i,", audioCodec=").concat(t));var e=this._mse;e&&(i&&(e.createSource(Ve.VIDEO,"video/mp4;codecs=".concat(i)),this._sourceCreated=!0),t&&(e.createSource(Ve.AUDIO,"audio/mp4;codecs=".concat(t)),this._sourceCreated=!0),this.hls.emit(J.SOURCEBUFFER_CREATED))}},{key:"_handleCodecChange",value:function(i,t){var e=this._mse,n=[{type:Ve.VIDEO,codecs:i==null?void 0:i.codec},{type:Ve.AUDIO,codecs:t==null?void 0:t.codec}];n.filter(function(r){return!!r.codecs}).forEach(function(r){var s=r.type,u=r.codecs,l=e.getSourceBuffer(s);if(l){var c=u.split(",")[0];new RegExp(c,"ig").test(l.mimeType)||e.changeType(s,"".concat(s,"/mp4;codecs=").concat(u))}})}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0}},{key:"isFull",value:function(){var i,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ve.VIDEO;return(i=this._mse)===null||i===void 0?void 0:i.isFull(t)}}]),a}();function Cc(a){var o=(a==null?void 0:a.media)||document.createElement("video");return de(de({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,pollRetryCount:2,loadTimeout:1e4,manifestLoadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,useLowLatency:!0,targetLatency:10,maxLatency:20,allowedStreamTrackChange:!0,seiInTime:!1,manifestList:[],minSegmentsStartPlay:3,preferMMS:!1,preferMMSStreaming:!1},a),{},{media:o})}var xc=xe(function a(){Ce(this,a),A(this,"version",0),A(this,"streams",[]),A(this,"isMaster",!0)}),ks={Audio:"AUDIO",Video:"VIDEO",SubTitle:"SUBTITLE",ClosedCaptions:"CLOSED-CAPTIONS"},Fi={CLEAR_KEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",PLAYREADY:"com.microsoft.playready"},gr=xe(function a(){Ce(this,a),A(this,"id",0),A(this,"url",""),A(this,"default",!1),A(this,"autoSelect",!1),A(this,"forced",!1),A(this,"group",""),A(this,"name",""),A(this,"lang",""),A(this,"segments",[]),A(this,"endSN",0)}),Pc=function(a){mn(i,a);var o=yn(i);function i(){var t;Ce(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),A(te(t),"mediaType",ks.Audio),A(te(t),"channels",0),t}return xe(i)}(gr),Ac=function(a){mn(i,a);var o=yn(i);function i(){var t;Ce(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),A(te(t),"mediaType",ks.SubTitle),t}return xe(i)}(gr),Ic=xe(function a(){Ce(this,a),A(this,"id",0),A(this,"bitrate",0),A(this,"width",0),A(this,"height",0),A(this,"name",""),A(this,"url",""),A(this,"audioCodec",""),A(this,"videoCodec",""),A(this,"textCodec",""),A(this,"audioGroup",""),A(this,"audioStreams",[]),A(this,"subtitleStreams",[]),A(this,"closedCaptionsStream",[])}),Dc=xe(function a(){Ce(this,a),A(this,"version",0),A(this,"url",""),A(this,"type",""),A(this,"startCC",0),A(this,"endCC",0),A(this,"startSN",0),A(this,"endSN",0),A(this,"totalDuration",0),A(this,"targetDuration",0),A(this,"partTargetDuration",0),A(this,"canSkipUntil",0),A(this,"canSkipDateRanges",!1),A(this,"skippedSegments",0),A(this,"canBlockReload",!1),A(this,"partHoldBack",0),A(this,"live",!0),A(this,"lowLatency",!1),A(this,"endPartIndex",0),A(this,"segments",[])}),Ui=function(){function a(){Ce(this,a),A(this,"sn",0),A(this,"cc",0),A(this,"url",""),A(this,"title",""),A(this,"start",0),A(this,"duration",0),A(this,"dataTime",""),A(this,"key",null),A(this,"byteRange",null),A(this,"isInitSegment",!1),A(this,"initSegment",null),A(this,"isLast",!1),A(this,"hasAudio",!1),A(this,"hasVideo",!1),A(this,"independent",!1),A(this,"partIndex",0)}return xe(a,[{key:"end",get:function(){return this.start+this.duration}},{key:"setTrackExist",value:function(i,t){this.hasVideo=i,this.hasAudio=t}},{key:"setByteRange",value:function(i,t){this.byteRange=[0];var e=i.split("@");e.length===1&&t&&t.byteRange?(this.byteRange[0]=t.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(e[1]),this.byteRange[1]=this.byteRange[0]+parseInt(e[0])-1}}]),a}(),Oc=function(){function a(o){Ce(this,a),A(this,"method",""),A(this,"url",""),A(this,"iv",null),A(this,"keyFormat",""),A(this,"keyFormatVersions",""),o instanceof a&&(this.method=o.method,this.url=o.url,this.keyFormat=o.keyFormat,this.keyFormatVersions=o.keyFormatVersions,o.iv&&(this.iv=new Uint8Array(o.iv)))}return xe(a,[{key:"clone",value:function(i){var t=new a(this);return i!=null&&t.setIVFromSN(i),t}},{key:"setIVFromSN",value:function(i){if(!this.iv&&this.method==="AES-128"&&typeof i=="number"&&this.url){this.iv=new Uint8Array(16);for(var t=12;t<16;t++)this.iv[t]=i>>8*(15-t)&255}}},{key:"isSegmentEncrypted",value:function(){var i=this.method;return i==="AES-128"}},{key:"isValidKeySystem",value:function(){var i=[Fi.CLEAR_KEY,Fi.FAIRPLAY,Fi.WIDEVINE,Fi.PLAYREADY].indexOf(this.keyFormat)>-1;if(!i)return!1;var t=["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)>-1;return!!t}},{key:"isSupported",value:function(){return this.method?this.isSegmentEncrypted()?!0:!!this.isValidKeySystem():!1}}]),a}(),Lc=/^#(EXT[^:]*)(?::(.*))?$/,_a=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,Rc=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,Mc=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function Nc(a){return a.split(/[\r\n]/).map(function(o){return o.trim()}).filter(Boolean)}function Es(a){var o=a.match(Lc);if(!(!o||!o[1]))return[o[1].replace("EXT-X-",""),o[2]]}function Nt(a){for(var o={},i=_a.exec(a);i;)o[i[1]]=i[2]||i[3],i=_a.exec(a);return o}function ai(a,o){if(!o||!a||Rc.test(a))return a;var i=Mc.exec(o);return i?a[0]==="/"?i[1]+a:i[1]+i[2]+a:a}var Bc={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function Hn(a,o){var i=Bc[a];if(!(!i||!o||!o.length)){for(var t=0;t<i.length;t++)for(var e=0;e<o.length;e++)if(i[t].test(o[e]))return o[e]}}function Fc(a,o){for(var i=new xc,t=0,e,n=[],r=[];e=a[t++];){var s=Es(e);if(s){var u=bt(s,2),l=u[0],c=u[1];if(l==="VERSION")i.version=parseInt(c);else if(l==="MEDIA"&&c){var f=Nt(c),d=void 0;switch(f.TYPE){case"AUDIO":d=new Pc;break;case"SUBTITLES":d=new Ac;break;default:d=new gr}d.url=ai(f.URI,o),d.default=f.DEFAULT==="YES",d.autoSelect=f.AUTOSELECT==="YES",d.group=f["GROUP-ID"],d.name=f.NAME,d.lang=f.LANGUAGE,f.CHANNELS&&(d.channels=Number(f.CHANNELS.split("/")[0]),Number.isNaN(d.channels)&&(d.channels=0)),f.TYPE==="AUDIO"&&f.URI&&n.push(d),f.TYPE==="SUBTITLES"&&r.push(d)}else if(l==="STREAM-INF"&&c){var v=new Ic,h=Nt(c);if(v.bitrate=parseInt(h["AVERAGE-BANDWIDTH"]||h.BANDWIDTH),v.name=h.NAME,v.url=ai(a[t++],o),h.RESOLUTION){var p=h.RESOLUTION.split("x"),g=bt(p,2),y=g[0],m=g[1];v.width=parseInt(y),v.height=parseInt(m)}if(h.CODECS){var b=h.CODECS.split(/[ ,]+/).filter(Boolean);v.videoCodec=Hn("video",b),v.audioCodec=Hn("audio",b),v.textCodec=Hn("text",b)}v.audioGroup=h.AUDIO,v.subtitleGroup=h.SUBTITLES,i.streams.push(v)}}}return i.streams.forEach(function(k,w){k.id=w}),n.length&&(n.forEach(function(k,w){k.id=w}),i.streams.forEach(function(k){k.audioGroup&&(k.audioStreams=n.filter(function(w){return w.group===k.audioGroup}))})),r.length&&(r.forEach(function(k,w){k.id=w}),i.streams.forEach(function(k){k.subtitleGroup&&(k.subtitleStreams=r.filter(function(w){return w.group===k.subtitleGroup}))})),i}function Uc(a,o,i){var t=new Dc;t.url=o;for(var e=new Ui,n=null,r=null,s=0,u=0,l=0,c=0,f,d=!1,v=0;(f=a[c++])&&!d;){if(f[0]!=="#"){if(t.lowLatency){u++;continue}e.sn=u,e.cc=l,e.url=ai(f,o),r&&(e.key=r.clone(u)),n&&(e.initSegment=n),t.segments.push(e),e=new Ui,u++;continue}var h=Es(f);if(h){var p=bt(h,2),g=p[0],y=p[1];switch(g){case"VERSION":t.version=parseInt(y);break;case"PLAYLIST-TYPE":t.type=y==null?void 0:y.toUpperCase();break;case"TARGETDURATION":t.targetDuration=parseFloat(y);break;case"PART-INF":{i&&(t.lowLatency=!0);var m=Nt(y);m["PART-TARGET"]&&(t.partTargetDuration=parseFloat(m["PART-TARGET"]))}break;case"SERVER-CONTROL":{var b=Nt(y);t.canBlockReload=b["CAN-BLOCK-RELOAD"]==="YES",t.partHoldBack=parseFloat(b["PART-HOLD-BACK"]||0),t.canSkipUntil=parseFloat(b["CAN-SKIP-UNTIL"]||0),t.canSkipDateRanges=b["CAN-SKIP-DATERANGES"]==="YES"}break;case"ENDLIST":{var k=t.segments[t.segments.length-1];k&&(k.isLast=!0),t.live=!1,d=!0}break;case"MEDIA-SEQUENCE":u=t.startSN=parseInt(y);break;case"DISCONTINUITY-SEQUENCE":l=t.startCC=parseInt(y);break;case"DISCONTINUITY":l++;break;case"BYTERANGE":e.setByteRange(y,t.segments[t.segments.length-1]);break;case"PART":{if(!t.lowLatency)break;var w=Nt(y);e.duration=parseFloat(w.DURATION),e.independent=w.INDEPENDENT==="YES",e.sn=u,e.cc=l,e.partIndex=v,e.start=s,e.duration=parseFloat(w.DURATION),s+=e.duration,e.url=ai(w.URI,o),r&&(e.key=r.clone(u)),n&&(e.initSegment=n),t.segments.push(e),e=new Ui,v++}break;case"PRELOAD-HINT":break;case"PROGRAM-DATE-TIME":e.dataTime=y;break;case"EXTINF":{if(t.lowLatency){v=0;break}var C=y.split(","),x=bt(C,2),R=x[0],N=x[1];e.start=s,e.duration=parseFloat(R),s+=e.duration,e.title=N}break;case"KEY":{var D=Nt(y);if(D.METHOD==="NONE"){r=null;break}if(r=new Oc,r.method=D.METHOD,r.url=/^blob:/.test(D.URI)?D.URI:ai(D.URI,o),r.keyFormat=D.KEYFORMAT||"identity",r.keyFormatVersions=D.KEYFORMATVERSIONS,!r.isSupported())throw new Error("encrypt ".concat(D.METHOD,"/").concat(D.KEYFORMAT," is not supported"));if(D.IV){var L=D.IV.slice(2);L=(L.length&1?"0":"")+L,r.iv=new Uint8Array(L.length/2);for(var S=0,E=L.length/2;S<E;S++)r.iv[S]=parseInt(L.slice(S*2,S*2+2),16)}}break;case"MAP":{var T=Nt(y);e.url=ai(T.URI,o),T.BYTERANGE&&e.setByteRange(T.BYTERANGE),e.isInitSegment=!0,e.sn=0,r&&(e.key=r.clone(0)),n=e,e=new Ui}break}}}t.segments=t.segments.filter(function(P){return P.duration!==0});var O=t.segments[t.segments.length-1];return O&&(t.endSN=O.sn,t.endPartIndex=O.partIndex),t.totalDuration=s,t.endCC=l,t}var Hi=function(){function a(){Ce(this,a)}return xe(a,null,[{key:"parse",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;if(!i.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var n=Nc(i);return a.isMediaPlaylist(i)?Uc(n,t,e):Fc(n,t)}},{key:"isMediaPlaylist",value:function(i){return i.includes("#EXTINF:")||i.includes("#EXT-X-TARGETDURATION:")}}]),a}(),Hc=function(){function a(o){var i=this;Ce(this,a),A(this,"_emitOnLoaded",function(u,l){var c=u.response,f=u.options,d=f||{},v=d.firstByteTime,h=d.startTime,p=d.endTime,g=d.contentLength,y=p-h;i.hls.emit(J.SPEED,{time:y,byteLength:g,url:l}),i.hls.emit(J.LOAD_COMPLETE,{url:l,elapsed:y||0}),i.hls.emit(J.TTFB,{url:l,responseUrl:c.url,elapsed:v-h}),i.hls.emit(J.LOAD_RESPONSE_HEADERS,{headers:c.headers,url:l})}),A(this,"_onLoaderRetry",function(u,l){i.hls.emit(se.LOAD_RETRY,{error:be.network(u),retryTime:l})}),this.hls=o,this._timer=null,this._useLowLatency=o.config.useLowLatency;var t=this.hls.config,e=t.retryCount,n=t.retryDelay,r=t.manifestLoadTimeout,s=t.fetchOptions;this._loader=new si(de(de({},s),{},{responseType:"text",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry})),this._audioLoader=new si(de(de({},s),{},{responseType:"text",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry})),this._subtitleLoader=new si(de(de({},s),{},{responseType:"text",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry}))}return xe(a,[{key:"load",value:function(){var o=fe(G().mark(function t(e,n,r){var s,u,l,c,f,d,v,h,p,g,y,m,b,k,w,C,x,R,N,D;return G().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return s=[this._loader.load(e)],n&&s.push(this._audioLoader.load(n)),r&&s.push(this._subtitleLoader.load(r)),S.prev=3,S.next=6,Promise.all(s);case 6:if(h=S.sent,p=bt(h,3),g=p[0],y=p[1],m=p[2],g){S.next=13;break}return S.abrupt("return",[]);case 13:this._emitOnLoaded(g,e),u=g.data,f=g.response.url||e,n?(l=y==null?void 0:y.data,c=m==null?void 0:m.data,d=(y==null||(b=y.response)===null||b===void 0?void 0:b.url)||n,v=(m==null||(k=m.response)===null||k===void 0?void 0:k.url)||r,l&&this._emitOnLoaded(y,n),c&&this._emitOnLoaded(m,r)):(c=y==null?void 0:y.data,v=(y==null||(w=y.response)===null||w===void 0?void 0:w.url)||r,c&&this._emitOnLoaded(y,r)),S.next=22;break;case 19:throw S.prev=19,S.t0=S.catch(3),be.network(S.t0);case 22:if(C=this.hls.config.onPreM3U8Parse,S.prev=23,C&&(u=C(u)||u,l&&(l=C(l,!0)||l),c&&(c=C(c,!0)||c)),x=Hi.parse(u,f,this._useLowLatency),!(((D=x)===null||D===void 0?void 0:D.live)===!1&&x.segments&&!x.segments.length)){S.next=28;break}throw new Error("empty segments list");case 28:l&&(R=Hi.parse(l,d,this._useLowLatency)),c&&(N=Hi.parse(c,v,this._useLowLatency)),S.next=35;break;case 32:throw S.prev=32,S.t1=S.catch(23),new be(oe.MANIFEST,oe.SUB_TYPES.HLS,S.t1);case 35:return x&&(x.isMaster?this.hls.emit(se.HLS_MANIFEST_LOADED,{playlist:x}):this.hls.emit(se.HLS_LEVEL_LOADED,{playlist:x})),S.abrupt("return",[x,R,N]);case 37:case"end":return S.stop()}},t,this,[[3,19],[23,32]])}));function i(t,e,n){return o.apply(this,arguments)}return i}()},{key:"parseText",value:function(i,t){var e=this.hls.config.onPreM3U8Parse,n;try{var r;if(e&&(i=e(i)||i),n=Hi.parse(i,t,this._useLowLatency),((r=n)===null||r===void 0?void 0:r.live)===!1&&n.segments&&!n.segments.length)throw new Error("empty segments list")}catch(s){throw new be(oe.MANIFEST,oe.SUB_TYPES.HLS,s)}return n&&(n.isMaster?this.hls.emit(se.HLS_MANIFEST_LOADED,{playlist:n}):this.hls.emit(se.HLS_LEVEL_LOADED,{playlist:n})),[n]}},{key:"poll",value:function(i,t,e,n,r,s){var u=this;clearTimeout(this._timer),s=s||3e3;var l=this.hls.config.pollRetryCount,c=function(){var f=fe(G().mark(function d(){var v;return G().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return clearTimeout(u._timer),p.prev=1,p.next=4,u.load(i,t,e);case 4:if(v=p.sent,v[0]){p.next=7;break}return p.abrupt("return");case 7:l=u.hls.config.pollRetryCount,n(v[0],v[1],v[2]),p.next=15;break;case 11:p.prev=11,p.t0=p.catch(1),l--,l<=0&&r(p.t0);case 15:u._timer=setTimeout(c,s);case 16:case"end":return p.stop()}},d,null,[[1,11]])}));return function(){return f.apply(this,arguments)}}();this._timer=setTimeout(c,s)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),a}();function ws(a,o,i){return o>i&&(i=o),Math.min(Math.max(a,o),i)}var jn=new ft("playlist"),ba=function(){function a(o,i,t){Ce(this,a),A(this,"live",void 0),A(this,"id",0),A(this,"bitrate",0),A(this,"width",0),A(this,"height",0),A(this,"name",""),A(this,"url",""),A(this,"audioCodec",""),A(this,"videoCodec",""),A(this,"textCodec",""),A(this,"startCC",0),A(this,"endCC",0),A(this,"startSN",0),A(this,"endSN",-1),A(this,"totalDuration",0),A(this,"targetDuration",0),A(this,"partTargetDuration",0),A(this,"canSkipUntil",0),A(this,"canSkipDateRanges",!1),A(this,"skippedSegments",0),A(this,"canBlockReload",!1),A(this,"partHoldBack",0),A(this,"lowLatency",!1),A(this,"endPartIndex",0),A(this,"snDiff",null),A(this,"segments",[]),A(this,"audioStreams",[]),A(this,"subtitleStreams",[]),A(this,"closedCaptions",[]),A(this,"currentAudioStream",null),A(this,"currentSubtitleStream",null),this.update(this._setLLPlaybackPoint(o),i,t)}return xe(a,[{key:"lastSegment",get:function(){return this.segments.length?this.segments[this.segments.length-1]:null}},{key:"segmentDuration",get:function(){var i;return this.targetDuration||((i=this.segments[0])===null||i===void 0?void 0:i.duration)||0}},{key:"liveEdge",get:function(){return this.endTime}},{key:"endTime",get:function(){var i;return((i=this.lastSegment)===null||i===void 0?void 0:i.end)||0}},{key:"currentSubtitleEndSn",get:function(){var i;return((i=this.currentSubtitleStream)===null||i===void 0?void 0:i.endSN)||0}},{key:"clearOldSegment",value:function(i,t){return this.currentAudioStream&&this._clearSegments(i,t),this._clearSegments(i,t)}},{key:"getAudioSegment",value:function(i){if(!(!i||!this.currentAudioStream)){var t=i.sn-this.snDiff;return this.currentAudioStream.segments.find(function(e){return e.sn===t})}}},{key:"update",value:function(i,t){this.url=i.url,Array.isArray(i.segments)?((this.live===null||this.live===void 0)&&(this.live=i.live),this._updateSegments(i,this),this.startCC=i.startCC,this.endCC=i.endCC,this.startSN=i.startSN,this.endSN=i.endSN||-1,this.totalDuration=i.totalDuration,this.targetDuration=i.targetDuration,this.live=i.live,this.lowLatency=i.lowLatency,this.canBlockReload=i.canBlockReload,this.canSkipDateRanges=i.canSkipDateRanges,this.canSkipUntil=i.canSkipUntil,this.partHoldBack=i.partHoldBack,this.partTargetDuration=i.partTargetDuration,this.skippedSegments=i.skippedSegments,this.endPartIndex=i.endPartIndex,t&&this.currentAudioStream&&Array.isArray(t.segments)&&(this._updateSegments(t,this.currentAudioStream),(this.snDiff===null||this.snDiff===void 0)&&i.segments.length&&t.segments.length&&(this.snDiff=i.segments[0].sn-t.segments[0].sn))):(this.id=i.id,this.bitrate=i.bitrate,this.width=i.width,this.height=i.height,this.name=i.name,this.audioCodec=i.audioCodec,this.videoCodec=i.videoCodec,this.textCodec=i.textCodec,this.audioStreams=i.audioStreams,this.subtitleStreams=i.subtitleStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find(function(e){return e.default})||this.audioStreams[0]),!this.currentSubtitleStream&&this.subtitleStreams.length&&(this.currentSubtitleStream=this.subtitleStreams.find(function(e){return e.default})||this.subtitleStreams[0]))}},{key:"updateSubtitle",value:function(i){var t=this;if(i&&this.currentSubtitleStream&&Array.isArray(i.segments)){var e=this._updateSegments(i,this.currentSubtitleStream),n=this.currentSubtitleStream.segments;if(n.length>100&&(this.currentSubtitleStream.segments=n.slice(100)),!!e)return e.map(function(r){return{sn:r.sn,url:r.url,duration:r.duration,start:r.start,end:r.end,lang:t.currentSubtitleStream.lang}})}}},{key:"switchSubtitle",value:function(i){var t=this.subtitleStreams.find(function(n){return n.lang===i}),e=this.currentSubtitleStream;t&&(this.currentSubtitleStream=t,e.segments=[])}},{key:"_setLLPlaybackPoint",value:function(i){if(!i.lowLatency||!i.segments.length)return i;for(var t=i.totalDuration-i.partHoldBack,e=i.segments,n=0,r=0,s=e.length;r<s;r++)e[r].start<=t&&e[r].independent&&(n=r);var u=e.slice(n),l=0;return u.forEach(function(c){c.start=l,l=c.end}),i.segments=u,i.totalDuration=l,i.startSN=u[0].sn,i.startCC=u[0].cc,jn.log("set ll-hls playback point: SN=".concat(i.startSN," partIndex=").concat(u[0].partIndex,", duration=").concat(l)),i}},{key:"_clearSegments",value:function(i,t){for(var e=0,n=this.segments,r=0,s=n.length;r<s;r++)if(n[r].end>=i){e=r;break}return e>t&&(e=t),e&&(this.segments=this.segments.slice(e),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(e))),t-e}},{key:"_updateSegments",value:function(i,t){var e=t.segments;if(this.live){var n,r=i.lowLatency,s=e[e.length-1],u=(n=s==null?void 0:s.sn)!==null&&n!==void 0?n:-1,l=(s==null?void 0:s.partIndex)||0,c=u<i.endSN&&i.segments.length;if(r&&(c=c||l<i.endPartIndex),c){jn.log("update segments: endSN:".concat(u,", partIndex:").concat(l," --> endSN:").concat(i.endSN,", partIndex:").concat(i.endPartIndex));var f=i.segments.findIndex(function(g){return g.sn===u&&g.partIndex===l}),d=f<0?i.segments:i.segments.slice(f+1);if(e.length&&d.length){var v=s.end,h=v;d.forEach(function(g){g.start=v,v=g.end}),jn.log("liveEdge: ".concat(h," -> ").concat(v));var p=(s==null?void 0:s.cc)||-1;p>d[0].cc&&d.forEach(function(g){return g.cc+=p})}return t.endSN=i.endSN,t.segments=e.concat(d),d}}else t.segments=i.segments}}]),a}(),jc=function(){function a(o){Ce(this,a),A(this,"streams",[]),A(this,"currentStream",null),A(this,"dvrWindow",0),A(this,"_segmentPointer",-1),this.hls=o}return xe(a,[{key:"lowLatency",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.lowLatency}},{key:"lastSegment",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.lastSegment}},{key:"currentSegment",get:function(){var i;return(i=this.currentSegments)===null||i===void 0?void 0:i[this._segmentPointer]}},{key:"nextSegment",get:function(){var i;return(i=this.currentSegments)===null||i===void 0?void 0:i[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.segments}},{key:"currentSubtitleEndSn",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.currentSubtitleEndSn}},{key:"liveEdge",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.liveEdge}},{key:"totalDuration",get:function(){var i;return((i=this.currentStream)===null||i===void 0?void 0:i.totalDuration)||0}},{key:"seekRange",get:function(){var i=this.currentSegments;if(!(!i||!i.length))return[i[0].start,i[i.length-1].end]}},{key:"nbSegments",get:function(){var i;return((i=this.currentSegments)===null||i===void 0?void 0:i.length)||0}},{key:"isEmpty",get:function(){var i;return!((i=this.currentSegments)!==null&&i!==void 0&&i.length)}},{key:"isLive",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.live}},{key:"hadSegmentLoaded",get:function(){return this._segmentPointer!==-1}},{key:"hasSubtitle",get:function(){var i;return!!((i=this.currentStream)!==null&&i!==void 0&&i.currentSubtitleStream)}},{key:"getAudioSegment",value:function(i){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.getAudioSegment(i)}},{key:"moveSegmentPointer",value:function(i){var t;i==null&&(i=this._segmentPointer+1),this._segmentPointer=ws(i,-1,(t=this.currentSegments)===null||t===void 0?void 0:t.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(i){var t;return(t=this.currentSegments)===null||t===void 0?void 0:t[i]}},{key:"setNextSegmentByIndex",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._segmentPointer=i-1}},{key:"findSegmentIndexByTime",value:function(i){var t=this.currentSegments;if(t){for(var e=0,n=t.length,r;e<n;e++)if(r=t[e],i>=r.start&&i<r.end)return e;var s=t[t.length-1];if(Math.abs(i-(s==null?void 0:s.end))<.2)return t.length-1}}},{key:"upsertPlaylist",value:function(i,t,e){var n=this;if(i){if(i.isMaster)this.streams.length=i.streams.length,i.streams.filter(function(l){return l.url}).forEach(function(l,c){n.streams[c]?n.streams[c].update(l):n.streams[c]=new ba(l)}),this.currentStream=this.streams[0];else if(Array.isArray(i.segments)){var r=this.currentStream;if(r){r.update(i,t,e);var s=r.updateSubtitle(e);s&&this.hls.emit(se.SUBTITLE_SEGMENTS,{list:s})}else this.reset(),this.currentStream=this.streams[0]=new ba(i,t,e)}var u=this.currentStream;u&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce(function(l,c){return l+=c.duration,l},0))}}},{key:"switchSubtitle",value:function(i){var t;(t=this.currentStream)===null||t===void 0||t.switchSubtitle(i)}},{key:"clearOldSegment",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=this.currentStream;if(!(!this.dvrWindow||!t)){var e=t.endTime-this.dvrWindow;if(!(e<=0)){var n=t.segments;n.length<=i||(this._segmentPointer=t.clearOldSegment(e,this._segmentPointer))}}}},{key:"checkSegmentTrackChange",value:function(i,t){var e=this.findSegmentIndexByTime(i),n=this.getSegmentByIndex(e);if(n&&!(!n.hasAudio&&!n.hasVideo)){if(t!==2&&n.hasAudio&&n.hasVideo)return n;if(!(n.end-i>.3)){var r=this.getSegmentByIndex(e+1);if(r&&!(!r.hasAudio&&!r.hasVideo)&&(r.hasAudio!==n.hasAudio||r.hasVideo!==n.hasVideo))return r}}}}]),a}(),Vc=function(){function a(o){var i=this;Ce(this,a),A(this,"error",null),A(this,"_emitOnLoaded",function(u,l){var c=u.data,f=u.response,d=u.options,v=d||{},h=v.firstByteTime,p=v.startTime,g=v.endTime,y=v.contentLength,m=g-p;i._bandwidthService.addRecord(y||c.byteLength,m),i.hls.emit(J.SPEED,{time:m,byteLength:y,url:l}),i.hls.emit(J.LOAD_COMPLETE,{url:l,elapsed:m||0}),i.hls.emit(J.TTFB,{url:l,responseUrl:f.url,elapsed:h-p}),i.hls.emit(J.LOAD_RESPONSE_HEADERS,{headers:f.headers,url:l})}),A(this,"_onLoaderRetry",function(u,l){i.hls.emit(J.LOAD_RETRY,{error:be.network(u),retryTime:l})}),this.hls=o,this._bandwidthService=new Yl,this._mapCache={},this._keyCache={};var t=this.hls.config,e=t.retryCount,n=t.retryDelay,r=t.loadTimeout,s=t.fetchOptions;this._segmentLoader=new si(de(de({},s),{},{responseType:"arraybuffer",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new si(de(de({},s),{},{responseType:"arraybuffer",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry})),this._keyLoader=new si(de(de({},s),{},{responseType:"arraybuffer",retry:e,retryDelay:n,timeout:r,onRetryError:this._onLoaderRetry}))}return xe(a,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(i,t,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:e,r=[];return i&&(r[0]=this.loadVideoSegment(i,e)),t&&(r[1]=this.loadAudioSegment(t,n)),Promise.all(r)}},{key:"loadVideoSegment",value:function(i,t){return this._loadSegment(this._segmentLoader,i,t)}},{key:"loadAudioSegment",value:function(i,t){return this._loadSegment(this._audioSegmentLoader,i,t)}},{key:"_loadSegment",value:function(){var o=fe(G().mark(function t(e,n,r){var s=this,u,l,c,f,d,v,h,p,g,y,m,b,k,w,C;return G().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return h=[],this.hls.emit(J.LOAD_START,{url:n.url}),h[0]=e.load(n.url),r&&n.initSegment&&(g=n.initSegment.url,l=this._mapCache[g],l||(this.hls.emit(J.LOAD_START,{url:g}),h[1]=e.load(g).then(function(N){if(N){var D=Object.keys(s._mapCache);D>30&&(s._mapCache={}),l=s._mapCache[g]=N.data,s._emitOnLoaded(N,g)}})),y=(p=n.initSegment.key)===null||p===void 0?void 0:p.url,y&&(v=n.initSegment.key.iv,d=this._keyCache[y],d||(this.hls.emit(J.LOAD_START,{url:y}),h[2]=this._keyLoader.load(y).then(function(N){N&&(d=s._keyCache[y]=N.data,s._emitOnLoaded(N,y))})))),m=(u=n.key)===null||u===void 0?void 0:u.url,m&&n.key.isSegmentEncrypted()&&(f=n.key.iv,c=this._keyCache[m],c||(this.hls.emit(J.LOAD_START,{url:m}),h[3]=this._keyLoader.load(m).then(function(N){N&&(c=s._keyCache[m]=N.data,s._emitOnLoaded(N,m))}))),R.next=8,Promise.all(h);case 8:if(b=R.sent,k=bt(b,1),w=k[0],w){R.next=13;break}return R.abrupt("return");case 13:return C=w.data,this._emitOnLoaded(w,n.url),R.abrupt("return",{data:C,map:l,key:c,mapKey:d,keyIv:f,mapKeyIv:v});case 16:case"end":return R.stop()}},t,this)}));function i(t,e,n){return o.apply(this,arguments)}return i}()},{key:"reset",value:function(){this.error=null,this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:function(){var o=fe(G().mark(function t(){return G().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return n.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i}()}]),a}(),tt=new ft("hls"),li=function(a){mn(i,a);var o=yn(i);function i(t){var e;return Ce(this,i),e=o.call(this),A(te(e),"version",i.version),A(te(e),"media",null),A(te(e),"config",null),A(te(e),"_manifestLoader",null),A(te(e),"_segmentLoader",null),A(te(e),"_playlist",null),A(te(e),"_bufferService",null),A(te(e),"_gapService",null),A(te(e),"_seiService",null),A(te(e),"_stats",null),A(te(e),"_prevSegSn",null),A(te(e),"_prevSegCc",null),A(te(e),"_tickTimer",null),A(te(e),"_tickInterval",500),A(te(e),"_segmentProcessing",!1),A(te(e),"_reloadOnPlay",!1),A(te(e),"_switchUrlOpts",null),A(te(e),"_isProcessQuotaExceeded",!1),A(te(e),"_loadSegment",fe(G().mark(function n(){var r,s,u,l,c;return G().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(e._segmentProcessing||!e.media)){d.next=2;break}return d.abrupt("return");case 2:if(r=e._playlist.nextSegment,s=te(e),u=s.config,r){d.next=6;break}return d.abrupt("return");case 6:if(e.isLive){d.next=16;break}if(l=e.bufferInfo(),e.media.paused&&!e.media.currentTime&&(l=e.bufferInfo(l.nextStart||.5)),c=Math.abs(l.end-e.media.duration)<.1,!(l.remaining>=u.preloadTime||c)){d.next=13;break}return c&&e._bufferService.msIsOpend&&e._bufferService.endOfStream(),d.abrupt("return");case 13:if(!(u.preferMMSStreaming&&!e._bufferService.msStreaming)){d.next=15;break}return d.abrupt("return");case 15:!e._urlSwitching&&e._prevSegSn!==r.sn-1&&l.end&&Math.abs(r.start-l.end)>1&&e._playlist.setNextSegmentByIndex(e._playlist.findSegmentIndexByTime(l.end+.1));case 16:return d.abrupt("return",e._loadSegmentDirect());case 17:case"end":return d.stop()}},n)}))),A(te(e),"_onPlay",fe(G().mark(function n(){return G().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(e.media.seeking&&e.media.currentTime===0)){s.next=3;break}return tt.debug("replay currentTime 0, return"),s.abrupt("return");case 3:if(clearTimeout(e._disconnectTimer),!e._reloadOnPlay){s.next=9;break}e._reloadOnPlay=!1,e.replay(!0),s.next=12;break;case 9:return s.next=11,e._loadSegment();case 11:e._startTick();case 12:case"end":return s.stop()}},n)}))),A(te(e),"_onPause",function(){if(e.isLive){if(!e._reloadOnPlay){var n=e.config.disconnectTime;if(n==null&&(n=e._playlist.dvrWindow),!Number.isFinite(n))return;clearTimeout(e._disconnectTimer),e._disconnectTimer=setTimeout(function(){e._reloadOnPlay=!0,e._clear()},n||0)}}else e._stopTick()}),A(te(e),"_onSeeking",fe(G().mark(function n(){var r,s,u,l,c,f,d;return G().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(e.media){h.next=2;break}return h.abrupt("return");case 2:if(e._onCheckQuotaExceeded(),r=e.media.currentTime,s=e._playlist.seekRange,!s){h.next=10;break}if(u=ws(r,s[0],e.isLive?s[1]:e.media.duration),!(u>=0&&Math.abs(r-u)>=.1)){h.next=10;break}return e.media.currentTime=u,h.abrupt("return");case 10:if(l=e._playlist.currentSegment,c=Oe.info(Oe.get(e.media),r,.1),!l){h.next=15;break}if(!(c.end&&Math.abs(c.end-l.end)<.2)){h.next=15;break}return h.abrupt("return");case 15:if(f=e._playlist.findSegmentIndexByTime(r),d=e._playlist.getSegmentByIndex(f),!(f==null||!d||e._segmentProcessing&&d===e._playlist.nextSegment)){h.next=19;break}return h.abrupt("return");case 19:return tt.debug("seek to",r,d),e._playlist.setNextSegmentByIndex(f),e._stopTick(),h.next=24,e._segmentLoader.cancel();case 24:if(e._segmentProcessing=!1,!(!c.end||e.isLive)){h.next=28;break}return h.next=28,e._loadSegmentDirect(!0);case 28:e._startTick();case 29:case"end":return h.stop()}},n)}))),A(te(e),"_onTimeupdate",function(){if(e.media){var n=e.config;if(n.isLive&&n.maxLatency&&n.targetLatency&&e.media){var r=e._playlist.liveEdge;if(!r)return;var s=r-e.media.currentTime;s>=n.maxLatency&&(tt.debug("latency jump, currentTime:".concat(e.media.currentTime,", liveEdge:").concat(r,",  latency=").concat(s)),e.media.currentTime=r-n.targetLatency)}if(n.seiInTime){var u;(u=e._seiService)===null||u===void 0||u.throw(e.media.currentTime)}e.config.allowedStreamTrackChange&&!e.config.softDecode&&e._checkStreamTrackChange(e.media.currentTime)}}),A(te(e),"_tick",function(){if(e.media){e._startTick();var n=e.media,r=Oe.get(n),s=e._segmentLoader.error;if(e._onCheckQuotaExceeded(),e._isProcessQuotaExceeded&&(e._bufferService.isFull()||(e._isProcessQuotaExceeded=!1,e._segmentProcessing=!1)),s){var u=.5;(!n.readyState||e.bufferInfo(u).remaining<1)&&(s.fatal=!0,e._emitError(be.network(s)));return}Oe.end(r)<.1||!n.readyState||(zl(n)?(e._loadSegment(),e._gapService&&e._gapService.do(n,e.config.maxJumpDistance,e.isLive)):n.readyState<2&&e._gapService&&e._gapService.do(n,e.config.maxJumpDistance,n.currentTime?e.isLive:!0))}}),e.config=t=Cc(t),e.media=e.config.media,e._manifestLoader=new Hc(te(e)),e._segmentLoader=new Vc(te(e)),e._playlist=new jc(te(e)),e._bufferService=new Tc(te(e)),t.seiInTime&&(e._seiService=new Kl(te(e))),t.softDecode||(e._gapService=new $l),e._stats=new ql(te(e),9e4),e.media.addEventListener("play",e._onPlay),e.media.addEventListener("pause",e._onPause),e.media.addEventListener("seeking",e._onSeeking),e.media.addEventListener("timeupdate",e._onTimeupdate),e}return xe(i,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"hasSubtitle",get:function(){return this._playlist.hasSubtitle}},{key:"baseDts",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.baseDts}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1;return Oe.info(Oe.get(this.media),(e=this.media)===null||e===void 0?void 0:e.currentTime,n)}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"playbackQuality",value:function(){return Gl(this.media)}},{key:"load",value:function(){var t=fe(G().mark(function n(r){var s,u=arguments;return G().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=u.length>1&&u[1]!==void 0?u[1]:!1,r&&(this.config.url=r),r=this.config.url,c.next=5,this._reset(s);case 5:return c.next=7,this._loadData(r);case 7:this._startTick();case 8:case"end":return c.stop()}},n,this)}));function e(n){return t.apply(this,arguments)}return e}()},{key:"_loadData",value:function(){var t=fe(G().mark(function n(r){var s,u,l,c,f,d,v,h,p,g;return G().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:try{r&&(r=r.trim())}catch(b){}if(r){m.next=3;break}throw this._emitError(new be(oe.OTHER,oe.SUB_TYPES.OPTION,null,null,"m3u8 url is missing"));case 3:return m.next=5,this._loadM3U8(r);case 5:if(s=m.sent,u=this._playlist.currentStream,!this._urlSwitching){m.next=17;break}if(u.bitrate===0&&(l=this._switchUrlOpts)!==null&&l!==void 0&&l.bitrate&&(u.bitrate=(c=this._switchUrlOpts)===null||c===void 0?void 0:c.bitrate),f=this._getSeamlessSwitchPoint(),this.config.startTime=f,d=this._playlist.findSegmentIndexByTime(f),v=this._playlist.getSegmentByIndex(d+1),!v){m.next=17;break}return h=v.start,m.next=17,this._bufferService.removeBuffer(h);case 17:if(s){m.next=19;break}return m.abrupt("return");case 19:if(!this.isLive){m.next=30;break}if(this._bufferService.setLiveSeekableRange(0,4294967295),tt.log("totalDuration first time got:",this._playlist.totalDuration),tt.log("nb segments got:",this._playlist.nbSegments),this.config.targetLatency<this._playlist.totalDuration&&(this.config.targetLatency=this._playlist.totalDuration,this.config.maxLatency=1.5*this.config.targetLatency),s.isMaster||this._pollM3U8(r),!(this._playlist.nbSegments<this.config.minSegmentsStartPlay)){m.next=27;break}return m.abrupt("return");case 27:return m.next=29,this._loadSegment();case 29:return m.abrupt("return");case 30:return m.next=32,this._bufferService.updateDuration(u.totalDuration);case 32:return p=this.config.startTime,p&&((g=this._switchUrlOpts)!==null&&g!==void 0&&g.seamless||(this.media.currentTime=p),this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(p)||0)),m.next=36,this._loadSegment();case 36:case"end":return m.stop()}},n,this)}));function e(n){return t.apply(this,arguments)}return e}()},{key:"replay",value:function(){var t=fe(G().mark(function n(r){return G().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.config.startTime=0,u.next=3,this.load();case 3:return this._reloadOnPlay=!1,u.abrupt("return",this.media.play(!r));case 5:case"end":return u.stop()}},n,this)}));function e(n){return t.apply(this,arguments)}return e}()},{key:"switchURL",value:function(){var t=fe(G().mark(function n(r){var s,u,l,c,f,d,v,h=arguments;return G().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=h.length>1&&h[1]!==void 0?h[1]:{},u={seamless:!1,startTime:0,bitrate:0},g.t0=tn(s),g.next=g.t0==="number"?5:g.t0==="boolean"?7:g.t0==="object"?9:11;break;case 5:return s={startTime:s},g.abrupt("break",12);case 7:return s={seamless:s},g.abrupt("break",12);case 9:for(l in s)(s[l]===void 0||s[l]===null)&&delete s[l];return g.abrupt("break",12);case 11:throw"unsupported switchURL args: ".concat(s);case 12:if(s=Object.assign({},u,s),c=s,f=c.seamless,d=c.startTime,this.config.url=r,this.config.startTime=d,this._switchUrlOpts=s,f){g.next=38;break}if(g.prev=18,!this.config.softDecode){g.next=23;break}g.t1=this.load(r),g.next=26;break;case 23:return g.next=25,this.load(r);case 25:g.t1=g.sent;case 26:v=g.t1,g.next=33;break;case 29:throw g.prev=29,g.t2=g.catch(18),this.emit(se.SWITCH_URL_FAILED,g.t2),g.t2;case 33:return this._reloadOnPlay=!1,v&&this.emit(se.SWITCH_URL_SUCCESS,{url:r}),g.abrupt("return",this.media.play(!0));case 38:return this._urlSwitching=!0,this._prevSegSn=null,this._prevSegCc=null,this._playlist.reset(),this._bufferService.seamlessSwitch(),g.next=45,this._clear();case 45:return g.next=47,this._loadData(r);case 47:this._startTick();case 48:this._switchUrlOpts=null;case 49:case"end":return g.stop()}},n,this,[[18,29]])}));function e(n){return t.apply(this,arguments)}return e}()},{key:"switchStream",value:function(){var t=fe(G().mark(function n(r){var s,u,l,c,f,d=arguments;return G().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(s=d.length>1&&d[1]!==void 0?d[1]:!0,u=this.currentStream,l=this.streams,!(!u||u.id===r||!l||l.length<2)){h.next=5;break}return h.abrupt("return");case 5:if(c=l.find(function(p){return p.id===r}),c){h.next=8;break}return h.abrupt("return");case 8:return h.prev=8,h.next=11,this._clear();case 11:if(!s){h.next=14;break}return h.next=14,this._bufferService.clearAllBuffer();case 14:h.next=19;break;case 16:throw h.prev=16,h.t0=h.catch(8),this._emitError(be.create(h.t0));case 19:if(u.currentAudioStream&&c.audioStreams.length>2&&(f=u.currentAudioStream.id,c.currentAudioStream=c.audioStreams.find(function(p){return p.id===f})||c.currentAudioStream),this._playlist.currentStream=c,h.prev=21,!(this.isLive||!c.segments.length)){h.next=25;break}return h.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,h.next=29,this._loadSegmentDirect();case 29:h.next=35;break;case 31:throw h.prev=31,h.t1=h.catch(21),this._playlist.currentStream=u,h.t1;case 35:return this._startTick(),h.abrupt("return",c);case 37:case"end":return h.stop()}},n,this,[[8,16],[21,31]])}));function e(n){return t.apply(this,arguments)}return e}()},{key:"switchAudioStream",value:function(){var t=fe(G().mark(function n(r){var s,u,l,c,f=arguments;return G().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(s=f.length>1&&f[1]!==void 0?f[1]:!0,u=this.currentStream,u){v.next=4;break}return v.abrupt("return");case 4:if(l=u.currentAudioStream,!(!l||l.id===r||u.audioStreams.length<2)){v.next=7;break}return v.abrupt("return");case 7:if(c=u.audioStreams.find(function(h){return h.id===r}),c){v.next=10;break}return v.abrupt("return");case 10:return v.prev=10,v.next=13,this._clear();case 13:if(!s){v.next=16;break}return v.next=16,this._bufferService.clearAllBuffer();case 16:v.next=21;break;case 18:throw v.prev=18,v.t0=v.catch(10),this._emitError(be.create(v.t0));case 21:if(u.currentAudioStream=c,v.prev=22,!(this.isLive||!c.segments.length)){v.next=26;break}return v.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,v.next=30,this._loadSegmentDirect();case 30:v.next=36;break;case 32:throw v.prev=32,v.t1=v.catch(22),u.currentAudioStream=l,v.t1;case 36:return this._startTick(),v.abrupt("return",c);case 38:case"end":return v.stop()}},n,this,[[10,18],[22,32]])}));function e(n){return t.apply(this,arguments)}return e}()},{key:"switchSubtitleStream",value:function(){var t=fe(G().mark(function n(r){return G().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this._playlist.switchSubtitle(r),u.next=3,this._manifestLoader.stopPoll();case 3:return u.next=5,this._refreshM3U8();case 5:case"end":return u.stop()}},n,this)}));function e(n){return t.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var t=fe(G().mark(function n(){var r;return G().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.media){u.next=2;break}return u.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),(r=this._seiService)===null||r===void 0||r.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),u.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null;case 13:case"end":return u.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_loadM3U8",value:function(){var t=fe(G().mark(function n(r){var s,u,l,c,f,d,v;return G().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(p.prev=0,c=(u=this.config.manifestList)===null||u===void 0||(l=u.filter(function(g){return g.url===r})[0])===null||l===void 0?void 0:l.manifest,!c){p.next=6;break}p.t0=this._manifestLoader.parseText(c,r),p.next=9;break;case 6:return p.next=8,this._manifestLoader.load(r);case 8:p.t0=p.sent;case 9:f=p.t0,d=bt(f,1),s=d[0],p.next=17;break;case 14:throw p.prev=14,p.t1=p.catch(0),this._emitError(be.create(p.t1));case 17:if(s){p.next=19;break}return p.abrupt("return");case 19:if(this._playlist.upsertPlaylist(s),!s.isMaster){p.next=24;break}return(v=this._playlist.currentStream.subtitleStreams)!==null&&v!==void 0&&v.length&&this.emit(se.SUBTITLE_PLAYLIST,{list:this._playlist.currentStream.subtitleStreams}),p.next=24,this._refreshM3U8();case 24:return this.emit(se.STREAM_PARSED),p.abrupt("return",s);case 26:case"end":return p.stop()}},n,this,[[0,14]])}));function e(n){return t.apply(this,arguments)}return e}()},{key:"_refreshM3U8",value:function(){var e,n,r=this,s=this._playlist.currentStream;if(!s||!s.url)throw this._emitError(be.create(null,null,new Error("m3u8 url is not defined")));var u=s.url,l=(e=s.currentAudioStream)===null||e===void 0?void 0:e.url,c=(n=s.currentSubtitleStream)===null||n===void 0?void 0:n.url;return this._manifestLoader.load(u,l,c).then(function(f){var d=bt(f,3),v=d[0],h=d[1],p=d[2];v&&(r._playlist.upsertPlaylist(v,h,p),r.isLive&&r._pollM3U8(u,l,c))}).catch(function(f){throw r._emitError(be.create(f))})}},{key:"_pollM3U8",value:function(e,n,r){var s=this,u=this._playlist.isEmpty,l;if(this._playlist.lowLatency)l=(this._playlist.currentStream.partTargetDuration*2||0)*1e3;else{var c;l=(((c=this._playlist.lastSegment)===null||c===void 0?void 0:c.duration)||0)*1e3}this._manifestLoader.poll(e,n,r,function(f,d,v){s._playlist.upsertPlaylist(f,d,v),s._playlist.clearOldSegment();var h=f&&u&&!s._playlist.isEmpty;(h||!s._playlist.hadSegmentLoaded&&s._playlist.nbSegments>=s.config.minSegmentsStartPlay)&&s._loadSegment(),u&&(u=s._playlist.isEmpty)},function(f){s._emitError(be.create(f))},l)}},{key:"_loadSegmentDirect",value:function(){var t=fe(G().mark(function n(r){var s,u,l;return G().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(s=this._playlist.nextSegment,s){f.next=3;break}return f.abrupt("return");case 3:return u=!1,l=null,f.prev=5,this._segmentProcessing=!0,tt.log("load segment, sn:".concat(s.sn,", partIndex:").concat(s.partIndex)),f.next=10,this._reqAndBufferSegment(s,this._playlist.getAudioSegment(s));case 10:u=f.sent,f.next=16;break;case 13:f.prev=13,f.t0=f.catch(5),l=f.t0;case 16:return f.prev=16,this._segmentProcessing=!1,f.finish(16);case 19:if(!l){f.next=26;break}if(!this._bufferService.isFull()){f.next=25;break}return tt.log("load segment, sn:".concat(s.sn,", partIndex:").concat(s.partIndex)),this._segmentProcessing=!0,this._isProcessQuotaExceeded=!0,f.abrupt("return",!1);case 25:return f.abrupt("return",this._emitError(be.create(l)));case 26:return u&&(this._urlSwitching&&(this._urlSwitching=!1,this.emit(se.SWITCH_URL_SUCCESS,{url:this.config.url})),this._playlist.moveSegmentPointer(),s.isLast?this._end():r||this._loadSegment()),f.abrupt("return",u);case 28:case"end":return f.stop()}},n,this,[[5,13,16,19]])}));function e(n){return t.apply(this,arguments)}return e}()},{key:"_reqAndBufferSegment",value:function(){var t=fe(G().mark(function n(r,s){var u,l,c,f,d,v,h,p,g;return G().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return l=r?r.cc:s.cc,c=this._prevSegCc!==l,f=[],m.prev=3,m.next=6,this._segmentLoader.load(r,s,c);case 6:f=m.sent,m.next=14;break;case 9:throw m.prev=9,m.t0=m.catch(3),m.t0.fatal=!1,this._segmentLoader.error=m.t0,m.t0;case 14:if(f[0]){m.next=16;break}return m.abrupt("return");case 16:return m.next=18,(u=this._bufferService).decryptBuffer.apply(u,yl(f));case 18:if(d=m.sent,d){m.next=21;break}return m.abrupt("return");case 21:return v=r?r.sn:s.sn,h=r?r.start:s.start,p=this._playlist.currentStream,this._bufferService.createSource(d[0],d[1],p==null?void 0:p.videoCodec,p==null?void 0:p.audioCodec),g=Date.now(),m.next=28,this._bufferService.appendBuffer(r,s,d[0],d[1],c,this._prevSegSn===v-1,h);case 28:return this.emit(se.APPEND_COST,{elapsed:Date.now()-g,url:r.url}),m.next=31,this._bufferService.evictBuffer(this.config.bufferBehind);case 31:return this._prevSegCc=l,this._prevSegSn=v,m.abrupt("return",!0);case 34:case"end":return m.stop()}},n,this,[[3,9]])}));function e(n,r){return t.apply(this,arguments)}return e}()},{key:"_onCheckQuotaExceeded",value:function(){var t=fe(G().mark(function n(){var r,s,u,l,c,f;return G().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r=this.media.currentTime,s=this.media.buffered,u=!1,l=0;case 4:if(!(l<s.length)){v.next=11;break}if(!(s.start(0)>=r&&r<s.end(l))){v.next=8;break}return u=!0,v.abrupt("break",11);case 8:l++,v.next=4;break;case 11:if(!this._bufferService.isFull()){v.next=17;break}if(c=u?this.config.bufferBehind:5,f=this.media.currentTime,!(f-c>0)){v.next=17;break}return v.next=17,this._bufferService.removeBuffer(0,f-c);case 17:case"end":return v.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_checkStreamTrackChange",value:function(e){var n=this._playlist.checkSegmentTrackChange(e,this._bufferService.nbSb);n&&this.switchURL(this.config.url,n.start+.2)}},{key:"_clear",value:function(){var t=fe(G().mark(function n(){return G().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),s.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:this._segmentProcessing=!1;case 5:case"end":return s.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_reset",value:function(){var t=fe(G().mark(function n(){var r,s,u=arguments;return G().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=u.length>0&&u[0]!==void 0?u[0]:!1,this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._switchUrlOpts=null,this._playlist.reset(),this._segmentLoader.reset(),(r=this._seiService)===null||r===void 0||r.reset(),this._stats.reset(),c.next=11,this._clear();case 11:return c.abrupt("return",this._bufferService.reset(s));case 12:case"end":return c.stop()}},n,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream(),(this.media.readyState<=2||this.media.buffered.length>1)&&this._startTick()}},{key:"_stopTick",value:function(){this._tickTimer&&clearTimeout(this._tickTimer),this._tickTimer=null}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(((n=e.originError)===null||n===void 0?void 0:n.fatal)===!1)tt.warn(e);else{var s,u,l;tt.table(e),tt.error(e),tt.error((s=this.media)===null||s===void 0?void 0:s.error),(u=this.media)!==null&&u!==void 0&&u.readyState&&this.media.pause(),this._stopTick(),this._urlSwitching&&(this._urlSwitching=!1,this.emit(se.SWITCH_URL_FAILED,e)),this.emit(se.ERROR,e),r&&this._end(),(l=this._seiService)===null||l===void 0||l.reset()}return e}},{key:"_getSeamlessSwitchPoint",value:function(){var e=this.media,n=e.currentTime;if(!e.paused){var r,s=this._playlist.findSegmentIndexByTime(e.currentTime),u=this._playlist.getSegmentByIndex(s),l=(r=this._stats)===null||r===void 0?void 0:r.getStats().downloadSpeed;if(l&&u){var c=u.duration*this._playlist.currentStream.bitrate/l+1;n+=c}else n+=5}return n}}],[{key:"isSupported",value:function(e){return!e||e==="video"||e==="audio"?Ve.isSupported():typeof WebAssembly<"u"}},{key:"enableLogger",value:function(){ft.enable(),un.enable()}},{key:"disableLogger",value:function(){ft.disable(),un.disable()}}]),i}(ci);A(li,"version","3.0.16");try{localStorage.getItem("xgd")?li.enableLogger():li.disableLogger()}catch(a){}var zc=function(){function a(o,i){var t=this;Ce(this,a),A(this,"_opts",null),A(this,"_plugin",null),A(this,"_onLowDecode",function(){var e,n,r,s,u=t._opts,l=u.media,c=u.innerDegrade;(e=t._plugin)===null||e===void 0||(n=e.player)===null||n===void 0||n.emit("lowdecode",l.degradeInfo),(r=t._plugin)===null||r===void 0||(s=r.player)===null||s===void 0||s.emit("core_event",de(de({},l.degradeInfo),{},{eventName:se.LOWDECODE})),c===1&&t._degrade(l.src)}),A(this,"_degrade",function(e){var n=t._plugin.player,r=n.video;if(!(r&&r.TAG!=="MVideo")){var s=n.video.degradeVideo;n.video=s,r.degrade(e),e&&(n.config.url=e);var u=n.root.firstChild;u.TAG==="MVideo"&&n.root.replaceChild(s,u);var l=t._plugin.constructor.pluginName.toLowerCase();n.unRegisterPlugin(l),n.once("canplay",function(){n.play()})}}),A(this,"forceDegradeToVideo",function(e){var n=t._opts.innerDegrade;n===1&&t._degrade(e)}),this._opts=o,this._plugin=i,this._init()}return xe(a,[{key:"_init",value:function(){var i=this._opts,t=i.media,e=i.preloadTime,n=i.innerDegrade,r=i.isLive;if(t){if(!r&&t.setPlayMode){t.setPlayMode("VOD");return}n&&t.setAttribute("innerdegrade",n),e&&t.setAttribute("preloadtime",e),this._bindEvents()}}},{key:"_bindEvents",value:function(){var i=this._opts.media;i.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var i,t;(i=this._opts)===null||i===void 0||(t=i.media)===null||t===void 0||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),a}();function Gc(a,o){var i=o.player,t=i.currentTime,e={startTime:t};switch(tn(a)){case"boolean":e.seamless=a;break;case"object":Object.assign(e,a);break}return e}var mr=function(a){mn(i,a);var o=yn(i);function i(){var t;Ce(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),A(te(t),"hls",null),A(te(t),"pluginExtension",null),A(te(t),"getStats",function(){var s;return(s=t.hls)===null||s===void 0?void 0:s.getStats()}),A(te(t),"_onSwitchSubtitle",function(s){var u,l=s.lang;(u=t.hls)===null||u===void 0||u.switchSubtitleStream(l)}),A(te(t),"_onSwitchURL",function(s,u){var l=te(t),c=l.player,f=l.hls;if(f){var d,v,h=Gc(u,te(t));c.config.url=s,f.switchURL(s,h).catch(function(p){}),!h.seamless&&(d=t.player.config)!==null&&d!==void 0&&(v=d.hls)!==null&&v!==void 0&&v.keepStatusAfterSwitch&&t._keepPauseStatus()}}),A(te(t),"_keepPauseStatus",function(){var s=t.player.paused;s&&t.player.once("canplay",function(){t.player.pause()})}),t}return xe(i,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return(e=this.hls)===null||e===void 0?void 0:e.version}},{key:"softDecode",get:function(){var e,n,r=(e=this.player)===null||e===void 0||(n=e.config)===null||n===void 0?void 0:n.mediaType;return!!r&&r!=="video"&&r!=="audio"}},{key:"beforePlayerInit",value:function(){var e=this,n=this.player.config;if(!(!n.url&&!n.__allowHlsEmptyUrl__)){this.hls&&this.hls.destroy(),this.player.switchURL=this._onSwitchURL,this.player.handleSource=!1;var r=n.hls||{};if(r.innerDegrade=r.innerDegrade||n.innerDegrade,(r.disconnectTime===null||r.disconnectTime===void 0)&&(r.disconnectTime=0),this.hls=new li(de({softDecode:this.softDecode,isLive:n.isLive,media:this.player.media||this.player.video,startTime:n.startTime,url:n.url},r)),this.softDecode||nt.defineGetterOrSetter(this.player,{url:{get:function(){var l,c;return(l=e.hls)===null||l===void 0||(c=l.media)===null||c===void 0?void 0:c.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new zc(de({isLive:n.isLive,media:this.player.video},r),this),this.player.forceDegradeToVideo=function(){for(var u,l=arguments.length,c=new Array(l),f=0;f<l;f++)c[f]=arguments[f];return(u=e.pluginExtension)===null||u===void 0?void 0:u.forceDegradeToVideo.apply(u,c)}),n.isLive){var s;(s=this.player)===null||s===void 0||s.useHooks("replay",function(){var u;return(u=e.hls)===null||u===void 0?void 0:u.replay()})}this.on($a,this._onSwitchSubtitle),this.on(wi,this._onSwitchURL),this.on(dn,this.destroy.bind(this)),this._transError(),this._transCoreEvent(J.TTFB),this._transCoreEvent(J.LOAD_START),this._transCoreEvent(J.LOAD_RESPONSE_HEADERS),this._transCoreEvent(J.LOAD_COMPLETE),this._transCoreEvent(J.LOAD_RETRY),this._transCoreEvent(J.SOURCEBUFFER_CREATED),this._transCoreEvent(J.REMOVE_BUFFER),this._transCoreEvent(J.BUFFEREOS),this._transCoreEvent(J.KEYFRAME),this._transCoreEvent(J.METADATA_PARSED),this._transCoreEvent(J.DEMUXED_TRACK),this._transCoreEvent(J.SEI),this._transCoreEvent(J.SEI_IN_TIME),this._transCoreEvent(J.SPEED),this._transCoreEvent(J.HLS_MANIFEST_LOADED),this._transCoreEvent(J.HLS_LEVEL_LOADED),this._transCoreEvent(J.STREAM_EXCEPTION),this._transCoreEvent(J.SWITCH_URL_SUCCESS),this._transCoreEvent(J.SWITCH_URL_FAILED),this._transCoreEvent(se.NO_AUDIO_TRACK),this._transCoreEvent(se.STREAM_PARSED),this._transCoreEvent(se.SUBTITLE_SEGMENTS),this._transCoreEvent(se.SUBTITLE_PLAYLIST),this._transCoreEvent(se.APPEND_COST),n.url&&this.hls.load(n.url,!0).catch(function(u){})}}},{key:"destroy",value:function(){var e;this.hls&&(this.hls.destroy(),this.hls=null),(e=this.pluginExtension)===null||e===void 0||e.destroy(),this.pluginExtension=null}},{key:"_transError",value:function(){var e=this;this.hls.on(se.ERROR,function(n){e.player&&e.player.emit(fi,new gi(e.player,n))})}},{key:"_transCoreEvent",value:function(e){var n=this;this.hls.on(e,function(r){n.player&&(n.player.emit("core_event",de(de({},r),{},{eventName:e})),e===J.SEI_IN_TIME&&n.hls.hasSubtitle&&n._emitSeiPaylodTime(r))})}},{key:"_emitSeiPaylodTime",value:function(e){try{var n=JSON.parse(Array.from(e.data.payload).map(function(r){return String.fromCharCode(r)}).join("").slice(0,-1));if(!n.rtmp_dts)return;this.player.emit("core_event",{eventName:se.SEI_PAYLOAD_TIME,time:n.rtmp_dts})}catch(r){}}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e,n){return li.isSupported(e,n)}}]),i}(nt);A(mr,"Hls",li);A(mr,"EVENT",se);const Wc={style:{"margin-bottom":"16px"}},ji="https://ali-m-l.cztv.com/channels/lantian/channel001/1080p.m3u8",Sa="https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/solution/general-video/css/img/scene/6.png",$c="https://ali-m-l.cztv.com/channels/lantian/channel008/1080p.m3u8",Kc="https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/solution/general-video/css/img/scene/1.png",Yc={__name:"demo-live",setup(a){const o=ot({lang:"zh-cn",fluid:!0,url:ji,poster:Sa,pip:!0,volume:1,autoplay:!1,isLive:!0,ignores:["progress","time","playbackrate"],plugins:[mr],hls:{retryCount:3,retryDelay:1e3,loadTimeout:1e4}});let i;const t=s=>{i=s},e=()=>{i&&i.paused&&i.play()},n=()=>{i&&i.pause()},r=()=>{o.value={...o.value,url:o.value.url==ji?$c:ji,poster:o.value.url==ji?Kc:Sa,autoplay:!0}};return(s,u)=>{const l=nr,c=gn,f=fn;return ut(),Dt(f,{header:"直播功能功能演示"},{default:_e(()=>[At("div",Wc,[he(l,{type:"primary",class:"ele-btn-icon",onClick:e},{default:_e(()=>[Ot(" 播放 ")]),_:1}),he(l,{type:"primary",class:"ele-btn-icon",onClick:n},{default:_e(()=>[Ot(" 暂停 ")]),_:1}),he(l,{type:"primary",class:"ele-btn-icon",onClick:r},{default:_e(()=>[Ot(" 切换视频源 ")]),_:1})]),he(c,{config:o.value,onPlayer:t},null,8,["config"])]),_:1})}}};function ka(a,o){var i=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),i.push.apply(i,t)}return i}function Si(a){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?ka(Object(i),!0).forEach(function(t){We(a,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):ka(Object(i)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(i,t))})}return a}function Ze(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}function Ea(a,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,Ts(t.key),t)}}function Je(a,o,i){return o&&Ea(a.prototype,o),i&&Ea(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a}function We(a,o,i){return o=Ts(o),o in a?Object.defineProperty(a,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[o]=i,a}function Gt(a,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),o&&ir(a,o)}function ln(a){return ln=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},ln(a)}function ir(a,o){return ir=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ir(a,o)}function qc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function $e(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Xc(a,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $e(a)}function Wt(a){var o=qc();return function(){var t=ln(a),e;if(o){var n=ln(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Xc(this,e)}}function Zc(a,o){if(typeof a!="object"||a===null)return a;var i=a[Symbol.toPrimitive];if(i!==void 0){var t=i.call(a,o||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(a)}function Ts(a){var o=Zc(a,"string");return typeof o=="symbol"?o:String(o)}var Jc=function(){function a(o,i){Ze(this,a),this.url=o;var t=new window.XMLHttpRequest;t.target=this,t.responseType="arraybuffer",t.open("get",o),t.onload=function(){(t.status===200||t.status===206)&&i&&i instanceof Function&&i(t.response)},t.onerror=function(e){},this.xhr=t,this.run()}return Je(a,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"run",value:function(){this.xhr.readyState===1&&this.xhr.send()}}]),a}(),je={ORDER:"order",SLOOP:"sloop",LOOP:"loop",RANDOM:"random"},wa="xgplayer-music";function Wi(a,o,i){var t=Math.floor(Math.random()*(o-a)+a);return t===i?(t>o/2?o=o/2:a=o/2,o-a>2?Wi(a,o,i):t):t}var Qc=function(a){Gt(i,a);var o=Wt(i);function i(){var t;Ze(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),We($e(t),"_onEnded",function(){if(t.mode==="order"&&t.index+1>=t.list.length){t.player.pause(),t.player.currentTime=0;return}switch(t.mode){case je.SLOOP:t.change();break;case je.ORDER:case je.LOOP:default:t.next();break}}),We($e(t),"_onDurationChange",function(){var s=t.config.abCycle;t._initABCycle(s,t.player)}),We($e(t),"_onTimeUpdate",function(){var s=$e(t),u=s.config,l=s.player;if(!t.halfPass&&l.currentTime>l.duration/2&&t.confirmOrder(),u.abCycle){var c=u.abCycle,f=c.end>l.duration?l.duration:c.end;l.currentTime>=f?(c.loop||(l.pause(),t.emit("abCycle_ended")),l.currentTime=c.start||0):l.currentTime<c.start&&(l.currentTime=c.start||0)}}),t}return Je(i,[{key:"afterCreate",value:function(){var e=this.player,n=this.playerConfig;_.addClass(e.root,wa),this.halfPass=!1,this.list=this.config.list||[],this.nextIndex=-1,this.prevIndex=-1,this.history=[],this.disable=!(this.list.length>0),this.list.length!==0&&(!n.url&&this.list.length>0&&(n.url=this.list[0].src),n.poster||(n.poster=this.list[0].poster),n.title||(n.title=this.list[0].title||""),n.vid||(n.vid=this.list[0].vid||""),this._curInfo={src:n.url,poster:n.poster,title:n.title,vid:n.vid},this.index=0,this.on(Le,this._onTimeUpdate),this.on(Lt,this._onEnded),this.on(St,this._onDurationChange),this.config.offline&&this.checkOffline(this._curInfo.src,this._curInfo.vid).then(function(r){r.code===0&&(n.url=r.url,e.state>=4&&(e.src=r.url))}).catch(function(r){}))}},{key:"destroy",value:function(){_.removeClass(this.player.root,wa)}},{key:"_nextCompute",value:function(){if(!this.disable)switch(this.mode){case je.SLOOP:case je.ORDER:case je.LOOP:this.index+1<this.list.length?this.nextIndex=this.index+1:this.nextIndex=0;break;default:this.nextIndex=Wi(0,this.list.length,this.index);break}}},{key:"_prevCompute",value:function(){if(!this.disable)switch(this.mode){case je.SLOOP:case je.ORDER:case je.LOOP:this.index-1>=0?this.prevIndex=this.index-1:this.prevIndex=this.list.length-1;break;default:this.prevIndex=Wi(0,this.list.length,this.index);break}}},{key:"_emitChange",value:function(){this.emit("change",this._curInfo)}},{key:"_initABCycle",value:function(e,n){var r=n.plugins.progresspreview;if(e&&n){var s=e.end>this.player.duration?this.player.duration:e.end,u=e.start>this.player.duration?0:e.start,l={id:n.playerId,time:e.start,duration:s-u,text:e.text,color:e.color};r.findDot(l.id)?r.updateDot(l):r.createDot(l)}else r.findDot(n.playerId)&&r.deleteDot(n.playerId)}},{key:"random",value:function(){if(this.list.length<0)return null;var e=Wi(0,this.list.length,this.index);return this.list[e]}},{key:"next",value:function(){this.disable||(this.halfPass||(this.halfPass=!0,this._nextCompute()),this.index=this.nextIndex,this.change())}},{key:"prev",value:function(){this.disable||(this.halfPass||(this.halfPass=!0,this._prevCompute()),this.index=this.prevIndex,this.change())}},{key:"forward",value:function(){var e=this.player,n=this.config.timeScale;e.currentTime=e.currentTime+n<e.duration?e.currentTime+n:e.duration-.1}},{key:"backward",value:function(){var e=this.player,n=this.config.timeScale;e.currentTime=e.currentTime-n>0?e.currentTime-n:0}},{key:"add",value:function(e){this.list.push({src:e.src,title:e.title,vid:e.vid,poster:e.poster})}},{key:"remove",value:function(e){var n=-1;this.list.every(function(r,s){return r.vid===e?(n=s,!1):!0}),n>-1&&this.list.splice(n,1)}},{key:"setAbCycle",value:function(e,n,r){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e&&_.typeof(e)==="Object"?this.config.abCycle=Si({},e):this.config.abCycle=Si({start:e||0,end:n||this.player.duration,loop:r},s),this._initABCycle(this.config.abCycle,this.player)}},{key:"removeAbCycle",value:function(){this.config.abCycle=null,this._initABCycle(null,this.player)}},{key:"updateList",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.removeAbCycle(),this.player.pause(),this.player.currentTime=0,this.list=e,this.nextIndex=0,this.index=0,this.change()}},{key:"setIndex",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e<0||e>=this.list.length||(this.nextIndex=e,this.index=e,this.change())}},{key:"change",value:function(){var e=this;if(!this.disable){var n=this.player,r=this.list,s=this.index,u=r[s].vid;this.halfPass=!1,this.checkOffline(r[s].src,u).then(function(l){e._curInfo={title:e.list[e.index].title||"",vid:e.list[e.index].vid,poster:e.list[e.index].poster||"",src:l.url},n.playNext({url:l.url,vid:e.list[e.index].vid||0,poster:e.list[e.index].poster||"",autoplay:!0}),n.off("timeupdate",e._emitChange),n.once("timeupdate",e._emitChange),n.play()})}}},{key:"checkOffline",value:function(e,n){var r=this;return new Promise(function(s,u){(!r.config.offline||r.disable)&&s({url:e,code:-1,vid:n});var l=r.player.database;l.openDB(function(){l.getDataByKey(l.myDB.ojstore.name,n,function(c){setTimeout(function(){l.closeDB()},5e3),s(c?{url:URL.createObjectURL(c.blob),code:0,vid:c.vid}:{url:e,code:-2,vid:n})})})})}},{key:"confirmOrder",value:function(){this.halfPass=!0,this._nextCompute(),this._prevCompute(),this.config.preloadNext&&this.preload(this.nextIndex)}},{key:"preload",value:function(e){if(!(e<0||e>=this.list.length)){var n=this.list[e],r=this.player;this.checkOffline(n.src,n.vid).then(function(s){if(s.code===-2){var u=n.vid;new Jc(n.src,function(l){r.database.openDB(function(){r.database.addData(r.database.myDB.ojstore.name,[{vid:u,blob:new Blob([l],{type:'audio/mp4; codecs="mp4a.40.5"'})}]),setTimeout(function(){r.database.closeDB()},5e3)})})}})}}},{key:"timeScale",get:function(){return this.config.timeScale||15},set:function(e){this.config.timeScale=e}},{key:"mode",get:function(){return this.config.mode||je.RANDOM},set:function(e){this.config.mode=e}}],[{key:"pluginName",get:function(){return"music"}},{key:"defaultConfig",get:function(){return{offline:!1,preloadNext:!0,abCycle:null,timeScale:15,mode:je.ORDER,list:[]}}},{key:"ModeType",get:function(){return Object.keys(je).map(function(e){return je[e]})}}]),i}(nt),ef=function(a){Gt(i,a);var o=Wt(i);function i(){return Ze(this,i),o.apply(this,arguments)}return Je(i,[{key:"afterCreate",value:function(){var e=this;if(this.on("change",function(r){if(r&&r.poster){if(e.find("img"))e.find("img").src=r.poster;else{var s=new Image;s.src=r.poster,e.appendChild(s)}e.find("img").src=r.poster,e.show()}else e.hide()}),this.playerConfig.poster){var n=new Image;n.src=this.playerConfig.poster,this.appendChild(n)}}},{key:"render",value:function(){return'<xg-icon class="xgplayer-cover"></xg-icon>'}}],[{key:"pluginName",get:function(){return"musiccover"}},{key:"defaultConfig",get:function(){return{index:6,position:ee.POSITIONS.CONTROLS_LEFT}}}]),i}(ee),tf=function(a){Gt(i,a);var o=Wt(i);function i(){var t;Ze(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),We($e(t),"onClick",function(s){var u=$e(t),l=u.player;s.preventDefault(),s.stopPropagation(),l.plugins.music.backward()}),t}return Je(i,[{key:"afterCreate",value:function(){var e=this;this.initIcons();var n=["click","touchstart"];n.forEach(function(r){e.bind(r,e.onClick)})}},{key:"registerIcons",value:function(){return{musicBackward:{icon:`<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="-2 0 21 15">
      <path d="m 14,2.99996 0,10 -7,-5 7,-5 z m -7,5 0,5 -7,-5 7,-5 0,5 z m -7,0 0,0 z"></path>
  </svg>`,class:"xg-icon-mbackward"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.musicBackward)}},{key:"destroy",value:function(){var e=this,n=["click","touchstart"];n.forEach(function(r){e.unbind(r,e.onClick)})}},{key:"render",value:function(){return`<xg-icon class="xgplayer-backward">
            <div class="xgplayer-icon">
            </div>
          </xg-icon>`}}],[{key:"pluginName",get:function(){return"musicbackward"}},{key:"defaultConfig",get:function(){return{index:1,position:ee.POSITIONS.CONTROLS_LEFT}}}]),i}(ee),nf=function(a){Gt(i,a);var o=Wt(i);function i(){var t;Ze(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),We($e(t),"onClick",function(s){var u=$e(t),l=u.player;s.preventDefault(),s.stopPropagation(),l.plugins.music.prev()}),t}return Je(i,[{key:"afterCreate",value:function(){var e=this;this.initIcons();var n=["click","touchstart"];n.forEach(function(r){e.bind(r,e.onClick)})}},{key:"registerIcons",value:function(){return{musicPrev:{icon:` <svg xmlns="http://www.w3.org/2000/svg" width="40" height="32" viewBox="300 200 1024 1024">
        <path d="M600 1140v-768h128v352l320-320v704l-320-320v352zz"></path>
    </svg>`,class:"xg-icon-mprev"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.musicPrev)}},{key:"destroy",value:function(){var e=this,n=["click","touchstart"];n.forEach(function(r){e.unbind(r,e.onClick)})}},{key:"render",value:function(){return`<xg-icon class="xgplayer-next">
            <div class="xgplayer-icon">
            </div>
          </xg-icon>`}}],[{key:"pluginName",get:function(){return"musicprev"}},{key:"defaultConfig",get:function(){return{index:2,position:ee.POSITIONS.CONTROLS_LEFT}}}]),i}(ee),rf=function(a){Gt(i,a);var o=Wt(i);function i(){var t;Ze(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),We($e(t),"onClick",function(s){var u=$e(t),l=u.player;s.preventDefault(),s.stopPropagation(),l.plugins.music.forward()}),t}return Je(i,[{key:"afterCreate",value:function(){var e=this;this.initIcons();var n=["click","touchstart"];n.forEach(function(r){e.bind(r,e.onClick)})}},{key:"registerIcons",value:function(){return{musicForward:{icon:`<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="-2 0 21 15">
        <path d="m 2,2.99996 0,10 7,-5 -7,-5 z m 7,5 0,5 7,-5 -7,-5 0,5 z m 7,0 0,0 z"></path>
      </svg>`,class:"xg-icon-mforward"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.musicForward)}},{key:"destroy",value:function(){var e=this,n=["click","touchstart"];n.forEach(function(r){e.unbind(r,e.onClick)})}},{key:"render",value:function(){return`<xg-icon class="xgplayer-forward">
            <div class="xgplayer-icon">
            </div>
          </xg-icon>`}}],[{key:"pluginName",get:function(){return"musicforward"}},{key:"defaultConfig",get:function(){return{index:5,position:ee.POSITIONS.CONTROLS_LEFT}}}]),i}(ee),af=function(a){Gt(i,a);var o=Wt(i);function i(){var t;Ze(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),We($e(t),"onClick",function(s){var u=$e(t),l=u.player;s.preventDefault(),s.stopPropagation(),l.plugins.music.next()}),t}return Je(i,[{key:"afterCreate",value:function(){var e=this;this.initIcons();var n=["click","touchstart"];n.forEach(function(r){e.bind(r,e.onClick)})}},{key:"registerIcons",value:function(){return{musicNext:{icon:` <svg xmlns="http://www.w3.org/2000/svg" width="40" height="32" viewBox="100 200 1024 1024">
        <path d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z">
      </svg>`,class:"xg-icon-mnext"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.musicNext)}},{key:"destroy",value:function(){var e=this,n=["click","touchstart"];n.forEach(function(r){e.unbind(r,e.onClick)})}},{key:"render",value:function(){return`<xg-icon class="xgplayer-next">
            <div class="xgplayer-icon">
            </div>
          </xg-icon>`}}],[{key:"pluginName",get:function(){return"musicnext"}},{key:"defaultConfig",get:function(){return{index:4,position:ee.POSITIONS.CONTROLS_LEFT}}}]),i}(ee),sf=function(a){Gt(i,a);var o=Wt(i);function i(){return Ze(this,i),o.apply(this,arguments)}return Je(i,[{key:"beforeCreate",value:function(e){var n=e.player.plugins.progress;n&&(e.root=n.root)}},{key:"afterCreate",value:function(){var e=this;this.on("change",function(n){n&&n.title?e.root.innerHTML="".concat(n.title):e.root.innerHTML=""})}},{key:"render",value:function(){var e=this.playerConfig;return`<xg-title class="xgplayer-name">
          `.concat(e.title||"",`
       </xg-title>`)}}],[{key:"pluginName",get:function(){return"musicmeta"}},{key:"defaultConfig",get:function(){return{index:0}}}]),i}(ee);function of(a){if(_.typeOf(a.controls)!=="Object")a.controls={mode:"flex",initShow:!0};else{var o=a.controls;a.controls=Si({mode:"flex",initShow:!0},o)}var i=a.play||{};a.play=Si({index:3},i),a.marginControls=!0,a.mediaType="audio"}var uf=Je(function a(o,i){Ze(this,a),console.log("config",o,i),console.log("playerConfig",_.typeOf(i.controls)!=="Object"),of(i),this.plugins=[Qc,tf,nf,rf,af,ef,sf],this.ignores=["start","cssFullScreen","fullscreen","pip","enter","replay","pc","loading","poster"]}),lf=function(a){var o=a.data,i=a.options,t=a.ctx,e=a.h,n=a.w,r=o.length>i.count?i.count:o.length,s=parseInt(e/255*2,10);t.clearRect(0,0,n,e),t.fillStyle=i.bgColor,t.fillRect(0,0,n,e);for(var u=n/r,l=u-u/4,c,f=0,d=i.linear,v=0;v<r;v++)c=o[v],t.fillStyle=d,t.fillRect(f,e-c,l,c*s+e/2),f+=u},cf=function(a){var o=a.data,i=a.options,t=a.ctx,e=a.h,n=a.w,r=i.count||128;o.length<r&&(r=o.length);var s=e/255,u=n/r,l=i.linear;t.clearRect(0,0,n,e),t.fillStyle=i.bgColor,t.fillRect(0,0,n,e);for(var c=1;c<=r;c++){var f=o[c];f*=s;var d=u*c;t.moveTo(d,e),t.lineTo(d,e-f),t.strokeStyle=l,t.stroke(),t.beginPath()}},ff=function(a){var o=a.data,i=a.options,t=a.ctx,e=a.h,n=a.w,r=o.length>i.count?i.count:o.length;t.clearRect(0,0,n,e),t.fillStyle=i.bgColor,t.fillRect(0,0,n,e),t.beginPath();var s=i.linear;t.strokeStyle=s;for(var u=n/r,l=0,c=0;c<r;c++){var f=o[c]/128,d=f*e/2;c===0?t.moveTo(l,d):t.lineTo(l,d),l+=u}t.lineTo(n,e/2),t.stroke()},hf=function(a){var o=a.data,i=a.options,t=a.ctx,e=a.h,n=a.w,r=e/255,s=n/128,u=i.count||128,l=5;t.clearRect(0,0,n,e),t.fillStyle=i.bgColor,t.fillRect(0,0,n,e);for(var c=i.linear,f=1;f<=u;f++){var d=o[f];d+=l,d*=r;var v=s*f,h=e/2+d/2;t.moveTo(v,h),t.lineTo(v,h-d),t.strokeStyle=c,t.stroke(),t.beginPath()}},df=function(a){var o=a.data,i=a.options,t=a.ctx,e=a.h,n=a.w,r=o.length>i.count?i.count:o.length,s=e/255;t.clearRect(0,0,n,e),t.fillStyle=i.bgColor,t.fillRect(0,0,n,e);for(var u=n/r,l=u-u/4,c,f=0,d=i.linear,v=0;v<r;v++)c=o[v]*s,t.fillStyle=d,t.fillRect(f,e/2+c/2,l,-c),f+=u};function pf(a,o,i){for(var t=a.createLinearGradient(0,0,o,0),e=i.length,n=100/e,r=0;r<i.length;r++)t.addColorStop(n*r/100,i[r]);return t}function vf(a,o){for(var i=[],t=Math.floor(a.length/o),e=1;e<=o;e++){var n=a.slice(e*t,e*t+t),r=n[Math.floor(n.length/2)];i.push(r)}return i}function gf(a,o){var i=o/255;o<=3&&o>=0&&(i=o);var t=a.map(function(e){return e*i});return t}function mf(a,o){for(var i=Math.floor(a.length/o),t=[],e=[],n=0,r=0;r<=i*o;r++)n===i&&(t.push(e),e=[],n=0),e.push(a[r]),n++;return t}function Ta(a,o,i,t){var e=i.w,n=i.linear,r=i.reverse,s=i.offset;a.save(),a.beginPath();var u=e*1/t;a.strokeStyle=n;for(var l=0,c=0,f=0;f<t;f++)c=r?0-o[f]:o[f],c=s-c,f===0?a.moveTo(l,c):a.lineTo(l,c),l+=u;a.lineTo(e,c),a.stroke()}var yf=function(a){var o=a.options,i=a.ctx,t=a.h,e=a.w,n=a.data,r=o.colors;n=vf(n,2048),n=gf(n,t/2),n=mf(n,4).slice(0,3),i.clearRect(0,0,e,t),i.fillStyle=o.bgColor,i.fillRect(0,0,e,t);for(var s=0;s<n.length;s++)Ta(i,n[s],{linear:r[s],w:e,h:t,offset:t/2,reverse:!1},n[s].length),Ta(i,n[s],{linear:r[s],w:e,h:t,offset:t/2,reverse:!0},n[s].length)},_f={bars:lf,vertLines:cf,lightning:ff,doubleLine:hf,doubleBars:df,waves:yf},bf={bars:2,vertLines:1,lightning:2,doubleLine:1,doubleBars:2,waves:2},Sf={BARS:"bars",VERT_LINES:"vertLines",LIGHTNING:"lightning",DOUBLE_LINE:"doubleLine",DOUBLE_BARS:"doubleBars",WAVES:"waves"};function kf(a,o){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},t=arguments.length>3?arguments[3]:void 0;if(o){i=Si({},i),i.stroke||(i.stroke=1),i.colors||(i.colors=["#ff8177","#cf556c","#f99185","#b12a5b"]);var e=o.getContext("2d"),n=o.height,r=o.width;e.strokeStyle=i.colors[0],e.lineWidth=i.stroke;var s={data:a,options:i,ctx:e,h:n,w:r};typeof i.mode=="string"&&(i.mode=[i.mode]),i.mode.forEach(function(u){t%bf[u]===0&&(e.clearRect(0,0,r,n),e.beginPath(),_f[u](s))})}}var Ef=function(){function a(o,i){var t=this,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Ze(this,a),We(this,"start",function(){t.reqId||t._renderFrame()}),We(this,"stop",function(){cancelAnimationFrame(t.reqId),t.reqId=null}),We(this,"_onDestroy",function(){t._audioCtx.close()}),We(this,"_onoVolumechange",function(){console.log("onoVolumechange"),t.gainNode.gain.setValueAtTime(t.player.volume,t.player.currentTime)}),We(this,"_renderFrame",function(){t.reqId&&cancelAnimationFrame(t.reqId),t.reqId=requestAnimationFrame(t._renderFrame),t.frameCount++,t.mode==="lightning"?t.analyser.getByteTimeDomainData(t.dataArray):t.analyser.getByteFrequencyData(t.dataArray),kf.call(t,t.dataArray,t.canvas,t.options,t.frameCount)}),this.canvas=i;var n=this.canvas.getBoundingClientRect(),r=n.width,s=n.height;if(this.canvas.width=r*2,this.canvas.height=s*2,this.player=o,this.options=a.defaultConfig,Object.keys(e).map(function(l){t.options[l]=e[l]}),!!a.AudioCtx){o.audioCtx?this._audioCtx=o.audioCtx:this._audioCtx=new a.AudioCtx,this.analyser=this._audioCtx.createAnalyser();var u=this._audioCtx.createGain();u.gain.setValueAtTime(o.volume,o.currentTime),this.gainNode=u,this.source=this._audioCtx.createMediaElementSource(o.video),this.ctx=i.getContext("2d"),this.source.connect(this.analyser),this.analyser.connect(u),this.fftSize=this.options.fftSize,this.frameCount=0,this.options.isGradient&&(this.options.linear=pf(this.ctx,i.width,this.options.colors)),u.connect(this._audioCtx.destination),this._initPlayerEvents()}}return Je(a,[{key:"_initPlayerEvents",value:function(){var i=this;["play","playing","seeked"].forEach(function(t){i.player.on(t,i.start)}),this.player.on("volumechange",this._onoVolumechange),this.player.on("destroy",this._onDestroy)}},{key:"destroy",value:function(){var i=this;this.stop(),["play","playing","seeked"].forEach(function(t){i.player.off(t,i.start)}),this.player.off("volumechange",this._onoVolumechange),this.player.off("destroy",this._onDestroy),this._audioCtx.close()}},{key:"mode",get:function(){return this.options.mode},set:function(i){this.options.mode=i}},{key:"fftSize",get:function(){return this.analyser.frequencyBinCount*2},set:function(i){this.analyser.fftSize=i;var t=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(t)}}],[{key:"defaultConfig",get:function(){return{fftSize:16384,count:1024,mode:"bars",colors:["#ff8177","#cf556c","#f99185","#b12a5b"],stroke:2,bgColor:"#000",isGradient:!0,linear:null}}},{key:"MODES",get:function(){return Sf}},{key:"AudioCtx",get:function(){return window.AudioContext||window.webkitAudioContext}}]),a}(),wf=Je(function a(o){Ze(this,a),this.regRule=/(\d{2}(?=:)):(\d{2}(?=\.))\.(\d{2,3})/g,this.regRule.test(o)?this.time=RegExp.$1*60+RegExp.$2*1+("0."+RegExp.$3)*1:this.time=-1}),Tf=function(){function a(o,i){var t=this;Ze(this,a),this.rawTxts=o,this.txts=o.map(function(e){return e.replace(/^[\r\n]|[\r\n]$/g,"").match(/(\[.*\])[^[]+/g)}),this.isDynamics=o.map(function(e,n){return[].concat(e.match(/\[\d{2}:\d{2}\.\d{2,3}\]/g)).length===t.txts[n].length&&t.txts[n].length===t.txts[0].length&&t.txts[n].length>1}),this.isDynamic=this.isDynamics.some(function(e){return e}),this.__ainimateInterval__=0,this.__offset__=0,this.__offsetScale__=.5,this.dom=i,this.lists=[],this.isDynamics.map(function(e,n){e&&t.lists.push(t.txts[n].map(function(r,s){var u=/(\[[\d:\S]+\])([^[]+)/g.test(r),l=RegExp.$1,c=RegExp.$2;return{time:u?new wf(l).time:-1,lyric:c,idx:s}}))}),this.list=this.lists.reduce(function(e,n){return e.map(function(r,s){return{time:r.time,lyric:r.lyric===`
`?"".concat(r.lyric).concat(n[s].lyric):"".concat(r.lyric,"<br/>").concat(n[s].lyric),idx:s}})}),this.line=0}return Je(a,[{key:"interval",get:function(){return this.__ainimateInterval__},set:function(i){this.__ainimateInterval__=i}},{key:"offset",get:function(){return this.__offset__},set:function(i){this.__offset__=i}},{key:"offsetScale",get:function(){return this.__offsetScale__},set:function(i){this.__offsetScale__=i}},{key:"adjust",value:function(){for(var i=this.list,t=0,e,n,r=i.length;t<r;t++){for(e=t+1;e<r&&!(i[e].time>i[t].time);e++);if(e<r){var s=(i[e].time-i[t].time)/(e-t);for(n=t+1;n<e;n++)i[n].time=i[n-1].time+s}}}},{key:"find",value:function(i){var t=this.list,e=this.__ainimateInterval__,n=this.__offset__;return i=i+n>0?i+n:0,t.filter(function(r,s){var u=r.time,l=s+1;return i>=u&&(t[l]&&i*1+e*1<=t[l].time||l>=t.length)})}},{key:"bind",value:function(i){var t=this,e=this;return this.__player__=i,e.isDynamic?(e.__handle__=function(){var n=t.find(i.currentTime)[0];n&&n.idx!==t.line&&(t.line=n.idx,i.emit("lyricUpdate",n))}.bind(e,i),i.on("timeupdate",e.__handle__),e.__startHandle__=function(){i.emit("lyricUpdate",e.list[0])}.bind(e,i),i.once("playing",e.__startHandle__),!0):!1}},{key:"unbind",value:function(i){delete this.__player__,this.__handle__&&(i.off("lyricUpdate",this.__handle__),delete this.__handle__)}},{key:"show",value:function(){var i=this,t=this.dom,e=[],n=this,r=["click","touchstart"];if(t&&t.nodeType===1){var s=_.createDom("div","<div></div>",{},"xgplayer-lrcWrap");t.appendChild(s),this.list.forEach(function(c){e.push('<xg-lyric-item class="xgplayer-lyric-item" data-idx="'.concat(c.idx,'">').concat(c.lyric.replace(/[\r\n]/g,""),"</xg-lyric-item>"))}),s.innerHTML=e.join("");var u=_.createDom("xg-lrcForward","<div></div>",{},"xgplayer-lrcForward");t.appendChild(u),r.forEach(function(c){u.addEventListener(c,function(f){f.preventDefault(),f.stopPropagation(),n.offset-=n.offsetScale,console.log("lyric go forward ".concat(n.offsetScale,"s"))},!1)});var l=_.createDom("xg-lrcBack","<div></div>",{},"xgplayer-lrcBack");t.appendChild(l),r.forEach(function(c){l.addEventListener(c,function(f){f.preventDefault(),f.stopPropagation(),n.offset+=n.offsetScale,console.log("lyric go back ".concat(n.offsetScale,"s"))},!1)}),this.__updateHandle__=function(c){var f=i.dom.querySelector(".xgplayer-lrcWrap"),d=f.querySelector(".xgplayer-lyric-item-active"),v=f.offsetHeight,h;d&&(d.className="xgplayer-lyric-item"),d=f.querySelector('.xgplayer-lyric-item[data-idx="'.concat(c.idx,'"]')),d&&(d.className="xgplayer-lyric-item xgplayer-lyric-item-active",h=d.getBoundingClientRect().top-f.getBoundingClientRect().top+f.scrollTop-v/2,h&&(f.scrollTop=h))},this.__player__.on("lyricUpdate",this.__updateHandle__)}else this.__player__.emit("error","lyric container can not be empty")}},{key:"hide",value:function(){this.__updateHandle__.off("lyricUpdate",this.__updateHandle__)}}]),a}();const Cf={class:"demo-music-wrap"},xf={class:"music-wrapper"},Pf={class:"music-footer"},Af={class:"music-controls"},If={__name:"demo-music",setup(a){const o=[{vid:"000001",lrc:`[00:00.00] 脆弱一分钟
[00:00.00] 作曲 : 林家谦
[00:00.00] 作词 : 徐世珍/吴辉福
[00:00.000]编曲：林家谦
[00:00.000]时钟不要走
[00:04.220]让我脆弱一分钟
[00:07.440]要多久才能习惯被放手
[00:15.800]马克杯空了 暖暖的温热
[00:22.660]却还在我手中停留
[00:27.960]
[00:29.790]勇气不要走
[00:32.200]给我理由再冲动
[00:35.690]去相信爱情 就算还在痛
[00:43.960]如果我不说不会有人懂
[00:50.720]失去你我有多寂寞
[00:55.610]还是愿意
[00:57.580]付出一切仅仅为了一个好梦
[01:03.980]梦里有人真心爱我 陪我快乐也陪我沉默
[01:11.260]没有无缘无故的痛承受越多越成熟
[01:18.630]能让你拥抱更好的我
[01:25.030] 谁也不要走
[01:28.270]应该是一种奢求
[01:31.900]可是我只想 握紧你的手
[01:39.780]我宁愿等候 也不愿错过
[01:46.630]你对我微笑的时候
[01:56.780]
[02:18.910]还是愿意
[02:21.320]用尽全力仅仅为了一个以后
[02:27.870]哪怕生命并不温柔哪怕被幸福一再反驳
[02:34.870]也要相信伤痕累累 其实只是在琢磨
[02:42.070]能让你为之一亮 的我
[02:53.910]
[02:56.350]制作人：林宥嘉
[02:57.750]制作助理：张婕汝
[02:59.010]录音师：陈文骏、叶育轩
[03:00.410]录音室：白金录音室
[03:01.740]混音师：SimonLi @ nOiz
[03:03.000]OP: Terence Lam Production & Co. (Warner/Chappell Music, HK Ltd.)
[03:04.050]SP: Warner/Chappell Music Taiwan Ltd.
[03:04.910]OP：Universal Ms Publ Ltd Taiwan
`},{vid:"000002",lrc:`[00:00.000]Westlife-My Love
[00:08.800]An empty street
[00:10.510]An empty house
[00:12.200]A hole inside my heart
[00:15.470]I am all alone
[00:17.270]The rooms are getting smaller
[00:22.440]I wonder how
[00:23.850]I wonder why
[00:25.460]I wonder where they are
[00:28.870]The days we had
[00:30.500]The songs we sang together
[00:33.320]Oh yeah
[00:35.480]And oh my love
[00:38.710]I am holding on forever
[00:42.200]Reaching for a love that seems so far
[00:48.070]So i say a little prayer
[00:51.100]And hope my dreams will take me there
[00:54.520]Where the skies are blue to see you once again, my love
[01:01.230]Over seas and coast to coast
[01:04.430]To find a place i love the most
[01:07.830]Where the fields are green to see you once again, my love
[01:18.730]I try to read
[01:20.210]I go to work
[01:21.900]I am laughing with my friends
[01:25.180]But i cannot stop to keep myself from thinking
[01:29.710]Oh no I wonder how
[01:33.420]I wonder why
[01:34.960]I wonder where they are
[01:38.470]The days we had
[01:40.150]The songs we sang together
[01:42.900]Oh yeah And oh my love
[01:48.300]I am holding on forever
[01:51.760]Reaching for a love that seems so far Mark:
[01:58.070]So i say a little prayer
[02:01.400]And hope my dreams will take me there
[02:04.800]Where the skies are blue to see you once again, my love
[02:11.400]Over seas and coast to coast
[02:14.720]To find a place i love the most
[02:18.080]Where the fields are green to see you once again, my love
[02:24.040]To hold you in my arms
[02:27.290]To promise you my love
[02:30.610]To tell you from the heart
[02:33.870]You are all i am thinking of
[02:45.460]I am reaching for a love that seems so far
[02:51.940]So i say a little prayer
[02:54.820]And hope my dreams will take me there
[02:58.080]Where the skies are blue to see you once again, my love
[03:04.700]Over seas and coast to coast
[03:07.980]To find a place i love the most
[03:11.520]Where the fields are green to see you once again,my love
[03:19.000]Where the fields are green to see you once again,my love
[03:31.580]Over seas and coast to coast
[03:34.670]To find a place i love the most
[03:38.110]Where the fields are green to see you once again,my love
[03:19.020]say a little prayer
[03:22.300]dreams will take me there
[03:24.770]Where the skies are blue to see you once again
`}],i=[{vid:"000001",src:"//sf1-cdn-tos.huoshanstatic.com/obj/media-fe/xgplayer_doc_video/music/audio.mp3",poster:"https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/solution/general-video/css/img/scene/1.png"},{vid:"000002",src:"//sf1-cdn-tos.huoshanstatic.com/obj/media-fe/xgplayer_doc_video/music/audio-en.mp3",poster:"https://imgcache.qq.com/open_proj/proj_qcloud_v2/gateway/solution/general-video/css/img/scene/6.png"}],t=ot({url:i[0].src,volume:1,height:54,width:"100%",autoplay:!1,mediaType:"audio",marginControls:!0,controls:{initShow:!0,mode:"flex"},ignores:["play","mobile","playbackrate","musicbackward","musicforward","musiccover","musicmeta","musicnext","musicprev"],presets:["default",uf],videoConfig:{crossOrigin:"anonymous"}}),e=ot(null),n=ot(null),r=ot(i[0]),s=ot(!1),u={player:null,analyze:null},l=v=>{var p;u.player=v,u.player.crossOrigin="anonymous",u.player.on("pause",()=>{s.value=!1}),u.player.on("ended",()=>{s.value=!1,f()}),u.player.on("play",()=>{s.value=!0,!u.analyze&&e.value&&(u.analyze=new Ef(u.player,e.value,{stroke:1,mode:"vertLines",bgColor:"rgba(0, 0, 0, 0)"}))});const h=new Tf([(p=o.find(g=>g.vid==r.value.vid))==null?void 0:p.lrc],n.value);h.bind(u.player),h.show()},c=()=>{u.player&&(u.player.paused?u.player.play():u.player.pause())},f=()=>{const v=i.findIndex(h=>h.vid===r.value.vid);v===i.length-1?r.value=i[0]:r.value=i[v+1],u.analyze&&(u.analyze.stop(),u.analyze=null),t.value={...t.value,url:r.value.src,autoplay:!0}},d=()=>{const v=i.findIndex(h=>h.vid===r.value.vid);v===0?r.value=i[i.length-1]:r.value=i[v-1],u.analyze&&(u.analyze.stop(),u.analyze=null),t.value={...t.value,url:r.value.src,autoplay:!0}};return(v,h)=>{const p=Hs,g=gn,y=fn;return ut(),Dt(y,{header:"音乐播放功能演示"},{default:_e(()=>[At("div",Cf,[At("div",xf,[(ut(),Ca("div",{key:r.value.vid,class:"music-body",style:Ms({backgroundImage:`url('${r.value.poster}')`})},[At("div",{ref_key:"lrcRef",ref:n,class:"lrc-wrap",style:{height:"100%"}},null,512),At("canvas",{ref_key:"analyzeRef",ref:e,class:"analyze-wrap"},null,512)],4)),At("div",Pf,[At("div",Af,[he(p,null,{default:_e(()=>[he(Pi(Ns),{onClick:d})]),_:1}),he(p,{onClick:c},{default:_e(()=>[s.value?(ut(),Dt(Pi(Bs),{key:0,style:{transform:"scale(1.4)"}})):(ut(),Dt(Pi(Fs),{key:1,style:{transform:"scale(1.4)"}}))]),_:1}),he(p,null,{default:_e(()=>[he(Pi(Us),{onClick:f})]),_:1})]),(ut(),Dt(g,{key:r.value.vid,config:t.value,onPlayer:l,style:{flex:"1",overflow:"visible"}},null,8,["config"]))])])])]),_:1})}}},Df=xa(If,[["__scopeId","data-v-3fe06159"]]),Of={name:"ExtensionPlayer"},Lf=Object.assign(Of,{setup(a){return(o,i)=>{const t=js,e=Vs,n=zs;return ut(),Dt(n,null,{default:_e(()=>[he(e,{gutter:16},{default:_e(()=>[he(t,{md:12,sm:24,xs:24},{default:_e(()=>[he(dl)]),_:1}),he(t,{md:12,sm:24,xs:24},{default:_e(()=>[he(pl)]),_:1})]),_:1}),he(e,{gutter:16,class:"demo-player-music-wrap"},{default:_e(()=>[he(t,{md:12,sm:24,xs:24},{default:_e(()=>[he(Yc)]),_:1}),he(t,{md:12,sm:24,xs:24},{default:_e(()=>[he(Df)]),_:1})]),_:1})]),_:1})}}}),Ff=xa(Lf,[["__scopeId","data-v-56e1590e"]]);export{Ff as default};
