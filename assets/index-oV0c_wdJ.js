import{b5 as J,o as g,c as h,w as t,b as e,cK as se,aG as L,u as a,d as b,aI as q,aH as G,aC as A,aL as P,r as C,f8 as Q,E as O,a7 as X,fw as B,g as K,a as re,R as ue,fx as S,Q as D,a8 as F,e as j,t as W,aO as pe,x as me,j as Y,i as ce,aT as _e,aE as fe,bE as ye,dU as be,fy as ge,aW as he,k as Ve,ay as ve}from"./index-C4BxmZrN.js";import{i as Z}from"./index-CkGVv88Q.js";import{i as xe}from"./index-BCHJo1Hi.js";import"./index-DPWieFbN.js";import"./index-BY7TmcLY.js";import"./index-Cw5RFCD5.js";import"./virtual-list-CYzSvSUd.js";import"./index-CuklncWx.js";import"./index-CL6ZmOyB.js";import{E as ee,a as le}from"./col-DljvzS69.js";import{E as Te}from"./input-number-B8T5Eosy.js";import"./tree-C3JkgW2I.js";import{E as ke}from"./tree-select-D5LaKo_I.js";import{l as te,u as Ie,a as Ee,r as Ce}from"./index-BNJnQpFL.js";import"./index-CobIQQS4.js";import{i as Ue}from"./index-DqHIRIRy.js";import{i as we}from"./index-DSHqkOzX.js";import"./isArrayLikeObject-XYcYxEsS.js";import"./vuedraggable.umd-BuphSp9t.js";import"./index-dVmM0e8c.js";const Ne={__name:"menu-search",emits:["search"],setup(V,{emit:c}){const k=c,[i,_]=J({title:"",path:"",authority:""}),p=()=>{k("search",{...i})},I=()=>{_(),p()};return(l,f)=>{const M=q,U=G,w=ee,N=A,n=le,d=P,v=Z;return g(),h(v,{"body-style":{paddingBottom:"2px"}},{default:t(()=>[e(d,{"label-width":"72px",onKeyup:se(p,["enter"]),onSubmit:f[3]||(f[3]=L(()=>{},["prevent"]))},{default:t(()=>[e(n,{gutter:8},{default:t(()=>[e(w,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(U,{label:"菜单名称"},{default:t(()=>[e(M,{clearable:"",modelValue:a(i).title,"onUpdate:modelValue":f[0]||(f[0]=x=>a(i).title=x),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(U,{label:"菜单地址"},{default:t(()=>[e(M,{clearable:"",modelValue:a(i).path,"onUpdate:modelValue":f[1]||(f[1]=x=>a(i).path=x),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(U,{label:"权限标识"},{default:t(()=>[e(M,{clearable:"",modelValue:a(i).authority,"onUpdate:modelValue":f[2]||(f[2]=x=>a(i).authority=x),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(U,{"label-width":"16px"},{default:t(()=>[e(N,{type:"primary",onClick:p},{default:t(()=>[b("查询")]),_:1}),e(N,{onClick:I},{default:t(()=>[b("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},Me={__name:"menu-select",props:{modelValue:[Number,String],placeholder:{type:String,default:"请选择上级菜单"}},emits:["update:modelValue"],setup(V,{emit:c}){const k=c,i=C([]),_=p=>{k("update:modelValue",p||0)};return te().then(p=>{i.value=Q({data:p,idField:"menuId",parentIdField:"parentId"})}).catch(p=>{O.error(p.message)}),(p,I)=>{const l=ke;return g(),h(l,{clearable:"",filterable:"",data:i.value,"check-strictly":"","default-expand-all":"","node-key":"menuId",props:{label:"title"},placeholder:V.placeholder,"model-value":V.modelValue||void 0,class:"ele-fluid","onUpdate:modelValue":_},null,8,["data","placeholder","model-value"])}}},Oe={components:B,data(){const V=Object.keys(B);return{iconData:[{title:"线框风格",icons:V.filter(c=>!c.endsWith("Filled"))},{title:"实底风格",icons:V.filter(c=>c.endsWith("Filled"))}]}}},$e=Object.assign(Oe,{__name:"icon-select",props:{modelValue:String,disabled:Boolean,placeholder:{type:String,default:"请选择菜单图标"}},emits:["update:modelValue"],setup(V,{emit:c}){const k=c,i=_=>{k("update:modelValue",_)};return(_,p)=>{const I=K,l=Ue;return g(),h(l,{clearable:"",filterable:"popper",data:_.iconData,"model-value":V.modelValue,placeholder:V.placeholder,disabled:V.disabled,"popper-width":420,"popper-height":294,"grid-style":{gridTemplateColumns:"repeat(6, 1fr)"},"item-style":{height:"52px"},"onUpdate:modelValue":i},{icon:t(({icon:f})=>[e(I,null,{default:t(()=>[(g(),h(X(f)))]),_:2},1024)]),_:1},8,["data","model-value","placeholder","disabled","grid-style"])}}}),Se={__name:"menu-edit",props:{modelValue:Boolean,data:Object,parentId:Number},emits:["done","update:modelValue"],setup(V,{emit:c}){const k=c,i=V,_=C(!1),p=C(!1),I=C(null),[l,f,M]=J({menuId:void 0,parentId:void 0,title:"",menuType:0,openType:0,icon:"",path:"",component:"",authority:"",sortNumber:void 0,hide:0,meta:""}),U=re({title:[{required:!0,type:"string",message:"请输入菜单名称",trigger:"blur"}],sortNumber:[{required:!0,type:"number",message:"请输入排序号",trigger:"blur"}],meta:[{type:"string",validator:(r,o,s)=>{if(o){const T="请输入正确的JSON格式";try{const y=JSON.parse(o);if(y==null||typeof y!="object")return s(T)}catch(y){return s(T)}}s()},trigger:"blur"}]}),w=()=>{var r,o;(o=(r=I.value)==null?void 0:r.validate)==null||o.call(r,s=>{if(!s)return;p.value=!0,(_.value?Ie:Ee)({...l,menuType:l.menuType===2?1:0,parentId:l.parentId||0}).then(y=>{p.value=!1,O.success(y),N(!1),k("done")}).catch(y=>{p.value=!1,O.error(y.message)})})},N=r=>{k("update:modelValue",r)},n=()=>{l.menuType===0?(l.authority="",l.openType=0,l.component=""):l.menuType===1?l.openType===2&&(l.authority=""):(l.openType=0,l.icon="",l.path="",l.component="",l.hide=0)},d=()=>{l.openType===2&&(l.component="",l.authority="")},v=r=>{l.hide=r?0:1},x=r=>{var o;return!!((o=r.children)!=null&&o.length)&&!r.component};return ue(()=>i.modelValue,r=>{var o,s;if(r)if(i.data){const T=S(i.data.path),y=S(i.data.component),E=i.data.menuType===1?2:x(i.data)?0:1;M({...i.data,menuType:E,openType:T?2:y?1:0,parentId:i.data.parentId===0?void 0:i.data.parentId}),_.value=!0}else l.parentId=i.parentId,_.value=!1;else f(),(s=(o=I.value)==null?void 0:o.clearValidate)==null||s.call(o)}),(r,o)=>{const s=G,T=q,y=ee,E=pe,m=me,$=le,ae=Y,R=K,z=ce,oe=Te,ne=_e,de=P,H=A,ie=fe;return g(),h(ie,{form:"",width:740,"model-value":V.modelValue,title:_.value?"修改菜单":"新建菜单","onUpdate:modelValue":N},{footer:t(()=>[e(H,{onClick:o[11]||(o[11]=u=>N(!1))},{default:t(()=>[b("取消")]),_:1}),e(H,{type:"primary",loading:p.value,onClick:w},{default:t(()=>[b(" 保存 ")]),_:1},8,["loading"])]),default:t(()=>[e(de,{ref_key:"formRef",ref:I,model:a(l),rules:U,"label-width":"92px",onSubmit:o[10]||(o[10]=L(()=>{},["prevent"]))},{default:t(()=>[e($,{gutter:16},{default:t(()=>[e(y,{sm:12,xs:24},{default:t(()=>[e(s,{label:"上级菜单",prop:"parentId"},{default:t(()=>[e(Me,{modelValue:a(l).parentId,"onUpdate:modelValue":o[0]||(o[0]=u=>a(l).parentId=u)},null,8,["modelValue"])]),_:1}),e(s,{label:"菜单名称",prop:"title"},{default:t(()=>[e(T,{clearable:"",maxlength:20,modelValue:a(l).title,"onUpdate:modelValue":o[1]||(o[1]=u=>a(l).title=u),placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{sm:12,xs:24},{default:t(()=>[e(s,{label:"菜单类型",prop:"menuType"},{default:t(()=>[e(m,{modelValue:a(l).menuType,"onUpdate:modelValue":o[2]||(o[2]=u=>a(l).menuType=u),onChange:n},{default:t(()=>[e(E,{value:0,label:"目录"}),e(E,{value:1,label:"菜单"}),e(E,{value:2,label:"按钮"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"打开方式"},{default:t(()=>[e(m,{modelValue:a(l).openType,"onUpdate:modelValue":o[3]||(o[3]=u=>a(l).openType=u),disabled:a(l).menuType===0||a(l).menuType===2,onChange:d},{default:t(()=>[e(E,{value:0,label:"组件"}),e(E,{value:1,label:"内链"}),e(E,{value:2,label:"外链"})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(ae,{style:{margin:"8px 0 22px 0",opacity:"0.6"}}),e($,{gutter:16},{default:t(()=>[e(y,{sm:12,xs:24},{default:t(()=>[e(s,{label:"菜单图标",prop:"icon"},{default:t(()=>[e($e,{modelValue:a(l).icon,"onUpdate:modelValue":o[4]||(o[4]=u=>a(l).icon=u),disabled:a(l).menuType===2},null,8,["modelValue","disabled"])]),_:1}),e(s,{prop:"path"},{label:t(()=>[a(l).openType===2?(g(),h(z,{key:0,content:"需要以`http://`、`https://`、`//`开头"},{default:t(()=>[e(R,{size:15,style:{"align-self":"center","margin-right":"4px",cursor:"help"}},{default:t(()=>[e(a(D),{style:{opacity:"0.6"}})]),_:1})]),_:1})):F("",!0),j("span",null,W(a(l).openType===2?"外链地址":"路由地址"),1)]),default:t(()=>[e(T,{clearable:"",maxlength:100,modelValue:a(l).path,"onUpdate:modelValue":o[5]||(o[5]=u=>a(l).path=u),disabled:a(l).menuType===2,placeholder:a(l).openType===2?"请输入外链地址":"请输入路由地址"},null,8,["modelValue","disabled","placeholder"])]),_:1}),e(s,{prop:"component"},{label:t(()=>[a(l).openType===1?(g(),h(z,{key:0,content:"需要以`http://`、`https://`、`//`开头"},{default:t(()=>[e(R,{size:15,style:{"align-self":"center","margin-right":"4px",cursor:"help"}},{default:t(()=>[e(a(D),{style:{opacity:"0.6"}})]),_:1})]),_:1})):F("",!0),j("span",null,W(a(l).openType===1?"内链地址":"组件路径"),1)]),default:t(()=>[e(T,{clearable:"",maxlength:100,modelValue:a(l).component,"onUpdate:modelValue":o[6]||(o[6]=u=>a(l).component=u),disabled:a(l).menuType===0||a(l).menuType===2||a(l).openType===2,placeholder:a(l).openType===1?"请输入内链地址":"请输入组件路径"},null,8,["modelValue","disabled","placeholder"])]),_:1})]),_:1}),e(y,{sm:12,xs:24},{default:t(()=>[e(s,{label:"权限标识",prop:"authority"},{default:t(()=>[e(T,{clearable:"",modelValue:a(l).authority,"onUpdate:modelValue":o[7]||(o[7]=u=>a(l).authority=u),placeholder:"请输入权限标识",disabled:a(l).menuType===0||a(l).menuType===1&&a(l).openType===2},null,8,["modelValue","disabled"])]),_:1}),e(s,{label:"排序号",prop:"sortNumber"},{default:t(()=>[e(oe,{min:0,max:99999,modelValue:a(l).sortNumber,"onUpdate:modelValue":o[8]||(o[8]=u=>a(l).sortNumber=u),placeholder:"请输入排序号","controls-position":"right",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),e(s,{label:"是否展示"},{default:t(()=>[e(ne,{"inline-prompt":"","active-text":"是","inactive-text":"否","model-value":a(l).hide===0,disabled:a(l).menuType===2,onChange:v},null,8,["model-value","disabled"]),e(z,{content:"选择不展示只注册路由不展示在侧边栏, 比如添加页面应该选择不展示","popper-style":{maxWidth:"240px"}},{default:t(()=>[e(R,{size:15,style:{"margin-left":"16px",cursor:"help"}},{default:t(()=>[e(a(D),{style:{opacity:"0.6"}})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(s,{label:"路由元数据",prop:"meta"},{default:t(()=>[e(T,{rows:4,type:"textarea",maxlength:200,modelValue:a(l).meta,"onUpdate:modelValue":o[9]||(o[9]=u=>a(l).meta=u),placeholder:"请输入JSON格式的路由元数据"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}},Fe={name:"SystemMenu",components:B},tl=Object.assign(Fe,{setup(V){const c=C(null),k=C([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"title",label:"菜单名称",slot:"title",minWidth:160},{prop:"path",label:"路由地址",minWidth:110},{prop:"sortNumber",label:"排序",width:100,align:"center"},{prop:"hide",label:"可见",width:100,align:"center",formatter:n=>["是","否"][n.hide]},{prop:"menuType",label:"类型",width:100,align:"center",slot:"menuType"},{columnKey:"action",label:"操作",width:180,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),i=C(null),_=C(!1),p=C(),I=async({where:n})=>{const d=await te({...n});return Q({data:d,idField:"menuId",parentIdField:"parentId"})},l=n=>{var d,v;(v=(d=c.value)==null?void 0:d.reload)==null||v.call(d,{where:n})},f=(n,d)=>{i.value=n!=null?n:null,p.value=d,_.value=!0},M=n=>{var d;if((d=n.children)!=null&&d.length){O.error("请先删除子节点");return}he.confirm("确定要删除“"+n.title+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const v=O.loading("请求中..");Ce(n.menuId).then(x=>{v.close(),O.success(x),l()}).catch(x=>{v.close(),O.error(x.message)})}).catch(()=>{})},U=()=>{var n,d;(d=(n=c.value)==null?void 0:n.toggleRowExpansionAll)==null||d.call(n,!0)},w=()=>{var n,d;(d=(n=c.value)==null?void 0:n.toggleRowExpansionAll)==null||d.call(n,!1)},N=n=>{var d;return!!((d=n.children)!=null&&d.length)&&!n.component};return(n,d)=>{const v=A,x=K,r=Ve,o=ve,s=Y,T=xe,y=Z,E=we;return g(),h(E,null,{default:t(()=>[e(Ne,{onSearch:l}),e(y,{"body-style":{paddingTop:"8px"}},{default:t(()=>[e(T,{sticky:"",ref_key:"tableRef",ref:c,"row-key":"menuId",columns:k.value,datasource:I,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"菜单数据"},"default-expand-all":!1,pagination:!1,"cache-key":"systemMenuTable"},{toolbar:t(()=>[e(v,{type:"primary",class:"ele-btn-icon",icon:a(ye),onClick:d[0]||(d[0]=m=>f())},{default:t(()=>[b(" 新建 ")]),_:1},8,["icon"]),e(v,{class:"ele-btn-icon",icon:a(be),onClick:U},{default:t(()=>[b(" 展开全部 ")]),_:1},8,["icon"]),e(v,{class:"ele-btn-icon",icon:a(ge),onClick:w},{default:t(()=>[b(" 折叠全部 ")]),_:1},8,["icon"])]),title:t(({row:m})=>[m.icon?(g(),h(x,{key:0,size:15,style:{"margin-right":"8px","vertical-align":"-2px"}},{default:t(()=>[(g(),h(X(m.icon)))]),_:2},1024)):F("",!0),j("span",null,W(m.title),1)]),menuType:t(({row:m})=>[a(S)(m.path)?(g(),h(r,{key:0,size:"small",type:"danger","disable-transitions":!0},{default:t(()=>[b(" 外链 ")]),_:1})):a(S)(m.component)?(g(),h(r,{key:1,size:"small",type:"warning","disable-transitions":!0},{default:t(()=>[b(" 内链 ")]),_:1})):N(m)?(g(),h(r,{key:2,size:"small","disable-transitions":!0},{default:t(()=>[b(" 目录 ")]),_:1})):m.menuType===0?(g(),h(r,{key:3,size:"small",type:"success","disable-transitions":!0},{default:t(()=>[b(" 菜单 ")]),_:1})):m.menuType===1?(g(),h(r,{key:4,size:"small",type:"info","disable-transitions":!0},{default:t(()=>[b(" 按钮 ")]),_:1})):F("",!0)]),action:t(({row:m})=>[e(o,{type:"primary",underline:!1,onClick:$=>f(null,m.menuId)},{default:t(()=>[b(" 添加 ")]),_:2},1032,["onClick"]),e(s,{direction:"vertical"}),e(o,{type:"primary",underline:!1,onClick:$=>f(m)},{default:t(()=>[b(" 修改 ")]),_:2},1032,["onClick"]),e(s,{direction:"vertical"}),e(o,{type:"danger",underline:!1,onClick:$=>M(m)},{default:t(()=>[b(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns"])]),_:1}),e(Se,{modelValue:_.value,"onUpdate:modelValue":d[1]||(d[1]=m=>_.value=m),data:i.value,"parent-id":p.value,onDone:l},null,8,["modelValue","data","parent-id"])]),_:1})}}});export{tl as default};
