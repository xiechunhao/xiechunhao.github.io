import{L as ae,bG as ne,r as T,J as R,R as w,U as oe,aj as D,o as ue,c as se,aV as I,w as k,a2 as K,b1 as L,b2 as j,b as ie,a$ as re,n as ce,W as h}from"./index-C4BxmZrN.js";import{i as de,a as c,v as E}from"./index-CobIQQS4.js";import{i as fe}from"./index-BCHJo1Hi.js";const me={modelValue:{type:[String,Number,Boolean,Array],default:()=>null},multiple:Boolean,disabled:Boolean,size:String,clearable:Boolean,placeholder:String,valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},initValue:[Object,Array],cacheData:Array,tableProps:{type:Object,required:!0},maxTagCount:Number,maxTagTextLength:Number,tagType:{type:String,default:"info"},automaticDropdown:Boolean,filterable:Boolean,teleported:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},placement:{type:String,default:"bottom-start"},transition:{type:String,default:"el-zoom-in-top"},popperOptions:Object,popperClass:String,popperWidth:[Number,String],selectStyle:Object,inputStyle:Object,responsive:{type:Boolean,default:null}},be={"update:modelValue":e=>!0,change:e=>!0,visibleChange:e=>!0,removeTag:e=>!0,clear:()=>!0,focus:e=>!0,blur:e=>!0,select:e=>!0,filterChange:e=>!0},pe=ae({name:"EleTableSelect",components:{EleBasicSelect:de,EleProTable:fe},props:me,emits:be,setup(e,{emit:u}){const v=ne(e),f=T(null),i=T(null),S=T(!1),r=T([]),V=R(()=>{const l=r.value;return!e.multiple&&l.length?l[0].label:""}),m=R(()=>{if(!(e.multiple||c(e.modelValue)))return e.modelValue}),B=R(()=>{if(!(!e.multiple||c(e.modelValue)))return e.modelValue}),F=R(()=>{const l=["ele-table-select-popper"];return v.value&&l.push("is-responsive"),e.popperClass&&l.push(e.popperClass),l.join(" ")}),y=()=>{f.value&&f.value.updatePopper()},z=l=>{if(!c(l)){if(e.cacheData!=null){const a=e.cacheData.find(t=>t[e.valueKey]===l);if(a!=null)return a}if(!c(e.initValue))return e.multiple?e.initValue.find(a=>a[e.valueKey]===l):e.initValue}},A=(l,a,t,n,o)=>{if(t!=null){const s=a.indexOf(l);if(s!==-1)return t[s]}if(o!=null){const s=n.indexOf(l);if(s!==-1)return o[s]}},U=()=>{const l=e.modelValue;if(c(l,!0))return[];const a=[],t=[];if(i.value&&(i.value.getSelectionRows()||[]).forEach(o=>{if(!o._isMock){const s=o[e.valueKey],p=l.indexOf(s);p!==-1&&(a.push({value:s,label:o[e.labelKey],index:p}),t.push(s))}}),t.length!==l.length){const{valueKey:n,cacheData:o,initValue:s}=e,p=o?o.map(d=>d[n]):[],P=s?s.map(d=>d[n]):[];l.forEach(d=>{if(!t.includes(d)){const $=A(d,p,o,P,s),le=$?$[e.labelKey]:String(d),te=l.indexOf(d);a.push({value:d,label:le,index:te})}})}return a.sort((n,o)=>n.index-o.index),a},b=l=>{if(!e.multiple){const t=e.modelValue,n=r.value.length?r.value[0]:null;if(c(t)){n!=null&&(r.value=[]);return}if(l||!n||n.value!==t){const o=i.value?i.value.getCurrentRow():null,p=(o&&o[e.valueKey]===t?o:void 0)||z(t),P=p?p[e.labelKey]:String(t);r.value=[{label:P,value:t}]}return}if(c(e.modelValue,!0)){r.value.length&&(r.value=[],h(()=>{y()}));return}const a=r.value.map(t=>t.value);(l||E(e.modelValue,a,!0))&&(r.value=U(),h(()=>{y()}))},W=()=>{f.value&&f.value.focusSearchInput()},O=l=>{const a=e.valueKey;if(!e.multiple){const n=l[a];n===e.modelValue?b():g(n);return}const t=l.map(n=>n[a]);E(e.modelValue,t,!0)?g(t):b()},g=l=>{E(l,e.modelValue,e.multiple)&&(u("update:modelValue",l),u("change",l))},C=l=>{var a;if(S.value!==l){if(S.value=l,l&&((a=e.tableProps)!=null&&a.virtual)&&i.value){const t=i.value.getTableRef();t!=null&&!t.wrapWidth&&h(()=>{t.updateWrapSize(),h(()=>{y()})})}u("visibleChange",l)}},N=l=>{const a=e.modelValue||[];g(a.filter(t=>t!==l.value)),u("removeTag",l.value)},M=()=>{g(e.multiple?[]:null),C(!1),u("clear")},q=l=>{u("focus",l)},G=l=>{u("blur",l)},J=l=>{u("filterChange",l)},H=l=>{e.multiple&&g(l)},Q=l=>{e.multiple||g(l)},X=l=>{!e.multiple&&l!=null&&b(!0)},Y=()=>{e.multiple&&b(!0)},Z=l=>{var a;e.multiple?(a=e.tableProps)!=null&&a.rowClickChecked&&i.value&&u("select",i.value.getSelectionRows()||[]):(C(!1),u("select",l))},x=l=>{u("select",l)},_=l=>{u("select",l)},ee=()=>{h(()=>{y()})};return w(()=>e.modelValue,()=>{b()},{deep:!0}),w(()=>e.cacheData,()=>{b(!0)}),w(()=>e.initValue,l=>{c(l)||O(l)},{deep:!0}),w(()=>e.disabled,l=>{l&&C(!1)}),oe(()=>{c(e.initValue,e.multiple)?c(e.modelValue,e.multiple)||b():O(e.initValue)}),{selectRef:f,tableRef:i,selectVisible:S,selectedItems:r,selectedLabel:V,currentRowKey:m,selectedRowKeys:B,selectPopperClass:F,updatePopover:y,updateSelectedItems:b,focusSearchInput:W,updateVisible:C,onSelectRemove:N,onSelectClear:M,onSelectFocus:q,onSelectBlur:G,onSelectFilter:J,updateSelectedRowKeys:H,updateCurrentRowKey:Q,onTableCurrentChange:X,onTableSelectionChange:Y,onTableRowClick:Z,onTableSelect:x,onTableSelectAll:_,onTableDone:ee}}}),ge=(e,u)=>{const v=e.__vccOpts||e;for(const[f,i]of u)v[f]=i;return v};function ve(e,u,v,f,i,S){const r=D("EleProTable"),V=D("EleBasicSelect");return ue(),se(V,{ref:"selectRef",value:e.modelValue,multiple:e.multiple,disabled:e.disabled,size:e.size,clearable:e.clearable,placeholder:e.placeholder,maxTagCount:e.maxTagCount,maxTagTextLength:e.maxTagTextLength,tagType:e.tagType,automaticDropdown:e.automaticDropdown,filterable:e.filterable,teleported:e.teleported,persistent:e.persistent,placement:e.placement,transition:e.transition,popperWidth:e.popperWidth,popperOptions:e.popperOptions,popperClass:e.selectPopperClass,selectStyle:e.selectStyle,inputStyle:e.inputStyle,selectedLabel:e.selectedLabel,selected:e.selectedItems,visible:e.selectVisible,"onUpdate:visible":e.updateVisible,onFilterChange:e.onSelectFilter,onRemoveTag:e.onSelectRemove,onClear:e.onSelectClear,onFocus:e.onSelectFocus,onBlur:e.onSelectBlur},I({default:k(()=>[K(e.$slots,"topExtra"),ie(r,re({"onUpdate:selectedRowKeys":e.updateSelectedRowKeys,"onUpdate:currentRowKey":e.updateCurrentRowKey,onSelectionChange:e.onTableSelectionChange,onCurrentChange:e.onTableCurrentChange,onRowClick:e.onTableRowClick,onSelect:e.onTableSelect,onSelectAll:e.onTableSelectAll,onDone:e.onTableDone},e.tableProps||{},{ref:"tableRef",rowKey:e.valueKey,reserveCurrent:!0,highlightCurrentRow:!e.multiple,currentRowKey:e.currentRowKey,selectedRowKeys:e.selectedRowKeys}),I({_:2},[ce(Object.keys(e.$slots).filter(m=>!["topExtra","bottomExtra","maxTagPlaceholder"].includes(m)),m=>({name:m,fn:k(B=>[K(e.$slots,m,L(j(B||{})))])}))]),1040,["onUpdate:selectedRowKeys","onUpdate:currentRowKey","onSelectionChange","onCurrentChange","onRowClick","onSelect","onSelectAll","onDone","rowKey","highlightCurrentRow","currentRowKey","selectedRowKeys"]),K(e.$slots,"bottomExtra")]),_:2},[e.$slots.maxTagPlaceholder?{name:"maxTagPlaceholder",fn:k(m=>[K(e.$slots,"maxTagPlaceholder",L(j(m||{})))]),key:"0"}:void 0]),1032,["value","multiple","disabled","size","clearable","placeholder","maxTagCount","maxTagTextLength","tagType","automaticDropdown","filterable","teleported","persistent","placement","transition","popperWidth","popperOptions","popperClass","selectStyle","inputStyle","selectedLabel","selected","visible","onUpdate:visible","onFilterChange","onRemoveTag","onClear","onFocus","onBlur"])}const Ce=ge(pe,[["render",ve]]);export{Ce as i};
