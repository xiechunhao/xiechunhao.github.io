import{J as ne,eB as oe,bF as ue,r as R,H as w,fk as c,O as V,R as se,ai as $,o as ie,c as re,aU as F,w as k,a1 as K,b1 as I,b2 as L,b as ce,a$ as de,m as fe,V as S,eC as O}from"./index-BF2fBoPb.js";import{i as me}from"./index-BFNslPul.js";import{i as he,b as be}from"./index-DG03PXF-.js";const pe={modelValue:{type:[String,Number,Boolean,Array],default:()=>null},multiple:Boolean,disabled:Boolean,size:String,clearable:Boolean,placeholder:String,valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"},initValue:[Object,Array],cacheData:Array,tableProps:{type:Object,required:!0},maxTagCount:Number,maxTagTextLength:Number,tagType:{type:String,default:"info"},automaticDropdown:Boolean,filterable:Boolean,teleported:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},placement:{type:String,default:"bottom-start"},transition:{type:String,default:"el-zoom-in-top"},popperOptions:Object,popperClass:String,popperWidth:[Number,String],selectStyle:Object,inputStyle:Object,selectTagsStyle:Object,responsive:{type:Boolean,default:null}},ge={"update:modelValue":e=>!0,change:e=>!0,visibleChange:e=>!0,removeTag:e=>!0,clear:()=>!0,focus:e=>!0,blur:e=>!0,select:e=>!0,filterChange:e=>!0},ve=ne({name:"EleTableSelect",components:{EleBasicSelect:me,EleProTable:he},props:pe,emits:ge,setup(e,{emit:u}){const{validateChange:g}=oe(),C=ue(e),f=R(null),i=R(null),v=R(!1),r=R([]),m=w(()=>{const l=r.value;return!e.multiple&&l.length?l[0].label:""}),B=w(()=>{if(!(e.multiple||c(e.modelValue)))return e.modelValue}),j=w(()=>{if(!(!e.multiple||c(e.modelValue)))return e.modelValue}),z=w(()=>{const l=["ele-table-select-popper"];return C.value&&l.push("is-responsive"),e.popperClass&&l.push(e.popperClass),l.join(" ")}),y=()=>{f.value&&f.value.updatePopper()},A=l=>{if(!c(l)){if(e.cacheData!=null){const a=e.cacheData.find(t=>t[e.valueKey]===l);if(a!=null)return a}if(!c(e.initValue))return e.multiple?e.initValue.find(a=>a[e.valueKey]===l):e.initValue}},U=(l,a,t,n,o)=>{if(t!=null){const s=a.indexOf(l);if(s!==-1)return t[s]}if(o!=null){const s=n.indexOf(l);if(s!==-1)return o[s]}},W=()=>{const l=e.modelValue;if(c(l,!0))return[];const a=[],t=[];if(i.value&&(i.value.getSelectionRows()||[]).forEach(o=>{if(!o._isMock){const s=o[e.valueKey],b=l.indexOf(s);b!==-1&&(a.push({value:s,label:o[e.labelKey],index:b}),t.push(s))}}),t.length!==l.length){const{valueKey:n,cacheData:o,initValue:s}=e,b=o?o.map(d=>d[n]):[],P=s?s.map(d=>d[n]):[];l.forEach(d=>{if(!t.includes(d)){const D=U(d,b,o,P,s),te=D?D[e.labelKey]:String(d),ae=l.indexOf(d);a.push({value:d,label:te,index:ae})}})}return a.sort((n,o)=>n.index-o.index),a},h=l=>{if(!e.multiple){const t=e.modelValue,n=r.value.length?r.value[0]:null;if(c(t)){n!=null&&(r.value=[]);return}if(l||!n||n.value!==t){const o=i.value?i.value.getCurrentRow():null,b=(o&&o[e.valueKey]===t?o:void 0)||A(t),P=b?b[e.labelKey]:String(t);r.value=[{label:P,value:t}]}return}if(c(e.modelValue,!0)){r.value.length&&(r.value=[],S(()=>{y()}));return}const a=r.value.map(t=>t.value);(l||O(e.modelValue,a,!0))&&(r.value=W(),S(()=>{y()}))},N=()=>{f.value&&f.value.focusSearchInput()},E=l=>{const a=e.valueKey;if(!e.multiple){const n=l[a];n===e.modelValue?h():p(n);return}const t=l.map(n=>n[a]);O(e.modelValue,t,!0)?p(t):h()},p=l=>{O(l,e.modelValue,e.multiple)&&(u("update:modelValue",l),g(),u("change",l))},T=l=>{var a;if(v.value!==l){if(v.value=l,l&&((a=e.tableProps)!=null&&a.virtual)&&i.value){const t=i.value.getTableRef();t!=null&&!t.wrapWidth&&S(()=>{t.updateWrapSize(),S(()=>{y()})})}u("visibleChange",l)}},M=l=>{const a=e.modelValue||[];p(a.filter(t=>t!==l.value)),u("removeTag",l.value)},q=()=>{p(e.multiple?[]:null),T(!1),u("clear")},H=l=>{u("focus",l)},J=l=>{u("blur",l)},G=l=>{u("filterChange",l)},Q=l=>{e.multiple&&p(l)},X=l=>{e.multiple||p(l)},Y=l=>{!e.multiple&&l!=null&&h(!0)},Z=()=>{e.multiple&&h(!0)},x=l=>{var a;e.multiple?(a=e.tableProps)!=null&&a.rowClickChecked&&i.value&&!be(l,i.value.tableData.indexOf(l),i.value.tableProps.columns)&&u("select",i.value.getSelectionRows()||[]):(T(!1),u("select",l))},_=l=>{u("select",l)},ee=l=>{u("select",l)},le=()=>{S(()=>{y()})};return V(()=>e.modelValue,()=>{h()},{deep:!0}),V(()=>e.cacheData,()=>{h(!0)}),V(()=>e.initValue,l=>{c(l)||E(l)},{deep:!0}),V(()=>e.disabled,l=>{l&&T(!1)}),se(()=>{c(e.initValue,e.multiple)?c(e.modelValue,e.multiple)||h():E(e.initValue)}),{selectRef:f,tableRef:i,selectVisible:v,selectedItems:r,selectedLabel:m,currentRowKey:B,selectedRowKeys:j,selectPopperClass:z,updatePopover:y,updateSelectedItems:h,focusSearchInput:N,updateVisible:T,handleSelectRemove:M,handleSelectClear:q,handleSelectFocus:H,handleSelectBlur:J,handleSelectFilter:G,updateSelectedRowKeys:Q,updateCurrentRowKey:X,handleTableCurrentChange:Y,handleTableSelectionChange:Z,handleTableRowClick:x,handleTableSelect:_,handleTableSelectAll:ee,handleTableDone:le}}}),ye=(e,u)=>{const g=e.__vccOpts||e;for(const[C,f]of u)g[C]=f;return g};function Se(e,u,g,C,f,i){const v=$("EleProTable"),r=$("EleBasicSelect");return ie(),re(r,{ref:"selectRef",value:e.modelValue,multiple:e.multiple,disabled:e.disabled,size:e.size,clearable:e.clearable,placeholder:e.placeholder,maxTagCount:e.maxTagCount,maxTagTextLength:e.maxTagTextLength,tagType:e.tagType,automaticDropdown:e.automaticDropdown,filterable:e.filterable,teleported:e.teleported,persistent:e.persistent,placement:e.placement,transition:e.transition,popperWidth:e.popperWidth,popperOptions:e.popperOptions,popperClass:e.selectPopperClass,selectStyle:e.selectStyle,inputStyle:e.inputStyle,selectTagsStyle:e.selectTagsStyle,selectedLabel:e.selectedLabel,selected:e.selectedItems,visible:e.selectVisible,"onUpdate:visible":e.updateVisible,onFilterChange:e.handleSelectFilter,onRemoveTag:e.handleSelectRemove,onClear:e.handleSelectClear,onFocus:e.handleSelectFocus,onBlur:e.handleSelectBlur},F({default:k(()=>[K(e.$slots,"topExtra"),ce(v,de({"onUpdate:selectedRowKeys":e.updateSelectedRowKeys,"onUpdate:currentRowKey":e.updateCurrentRowKey,onSelectionChange:e.handleTableSelectionChange,onCurrentChange:e.handleTableCurrentChange,onRowClick:e.handleTableRowClick,onSelect:e.handleTableSelect,onSelectAll:e.handleTableSelectAll,onDone:e.handleTableDone},e.tableProps||{},{ref:"tableRef",rowKey:e.valueKey,reserveCurrent:!0,highlightCurrentRow:!e.multiple,currentRowKey:e.currentRowKey,selectedRowKeys:e.selectedRowKeys}),F({_:2},[fe(Object.keys(e.$slots).filter(m=>!["topExtra","bottomExtra","maxTagPlaceholder"].includes(m)),m=>({name:m,fn:k(B=>[K(e.$slots,m,I(L(B||{})))])}))]),1040,["onUpdate:selectedRowKeys","onUpdate:currentRowKey","onSelectionChange","onCurrentChange","onRowClick","onSelect","onSelectAll","onDone","rowKey","highlightCurrentRow","currentRowKey","selectedRowKeys"]),K(e.$slots,"bottomExtra")]),_:2},[e.$slots.maxTagPlaceholder?{name:"maxTagPlaceholder",fn:k(m=>[K(e.$slots,"maxTagPlaceholder",I(L(m||{})))]),key:"0"}:void 0]),1032,["value","multiple","disabled","size","clearable","placeholder","maxTagCount","maxTagTextLength","tagType","automaticDropdown","filterable","teleported","persistent","placement","transition","popperWidth","popperOptions","popperClass","selectStyle","inputStyle","selectTagsStyle","selectedLabel","selected","visible","onUpdate:visible","onFilterChange","onRemoveTag","onClear","onFocus","onBlur"])}const we=ye(ve,[["render",Se]]);export{we as i};
