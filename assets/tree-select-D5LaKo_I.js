import{a1 as z,R as p,W as V,ea as A,O as U,aK as T,cX as _,J as k,L as R,aJ as H,P as B,cz as F,eb as J,co as W,N as X,ec as $,r as I,a as S,U as D,V as M,a9 as G}from"./index-C4BxmZrN.js";import{_ as L}from"./tree-C3JkgW2I.js";const Q=(e,{attrs:a,emit:d},{select:o,tree:s,key:n})=>{const u=z("tree-select");return p(()=>e.data,()=>{e.filterable&&V(()=>{var t,h;(h=s.value)==null||h.filter((t=o.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{...A(U(e),Object.keys(T.props)),...a,"onUpdate:modelValue":t=>d(_,t),valueKey:n,popperClass:k(()=>{const t=[u.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var h;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(h=s.value)==null||h.filter(t)}}},Y=R({extends:H,setup(e,a){const d=H.setup(e,a);delete d.selectOptionClick;const o=B().proxy;return V(()=>{d.select.states.cachedOptions.get(o.value)||d.select.onOptionCreate(o)}),d},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function P(e){return e||e===0}function w(e){return Array.isArray(e)&&e.length}function g(e){return Array.isArray(e)?e:P(e)?[e]:[]}function E(e,a,d,o,s){for(let n=0;n<e.length;n++){const u=e[n];if(a(u,n,e,s))return o?o(u,n,e,s):u;{const C=d(u);if(w(C)){const t=E(C,a,d,o,u);if(t)return t}}}}function j(e,a,d,o){for(let s=0;s<e.length;s++){const n=e[s];a(n,s,e,o);const u=d(n);w(u)&&j(u,a,d,n)}}const Z=(e,{attrs:a,slots:d,emit:o},{select:s,tree:n,key:u})=>{p(()=>e.modelValue,()=>{e.showCheckbox&&V(()=>{const l=n.value;l&&!F(l.getCheckedKeys(),g(e.modelValue))&&l.setCheckedKeys(g(e.modelValue))})},{immediate:!0,deep:!0});const C=k(()=>({value:u.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,c)=>{var i;const r=C.value[l];return W(r)?r(c,(i=n.value)==null?void 0:i.getNode(t("value",c))):c[r]},h=g(e.modelValue).map(l=>E(e.data||[],c=>t("value",c)===l,c=>t("children",c),(c,i,r,v)=>v&&t("value",v))).filter(l=>P(l)),N=k(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return j(e.data.concat(e.cacheData),c=>{const i=t("value",c);l.push({value:i,currentLabel:t("label",c),isDisabled:t("disabled",c)})},c=>t("children",c)),l});return{...A(U(e),Object.keys(L.props)),...a,nodeKey:u,expandOnClickNode:k(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:k(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(h):h),renderContent:(l,{node:c,data:i,store:r})=>l(Y,{value:t("value",i),label:t("label",i),disabled:t("disabled",i)},e.renderContent?()=>e.renderContent(l,{node:c,data:i,store:r}):d.default?()=>d.default({node:c,data:i,store:r}):void 0),filterNodeMethod:(l,c,i)=>e.filterNodeMethod?e.filterNodeMethod(l,c,i):l?new RegExp(J(l),"i").test(t("label",c)||""):!0,onNodeClick:(l,c,i)=>{var r,v,m,K;if((r=a.onNodeClick)==null||r.call(a,l,c,i),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||c.isLeaf)){if(!t("disabled",l)){const b=(v=s.value)==null?void 0:v.states.options.get(t("value",l));(m=s.value)==null||m.handleOptionSelect(b)}}else e.expandOnClickNode&&i.proxy.handleExpandIconClick();(K=s.value)==null||K.focus()}},onCheck:(l,c)=>{var i;if(!e.showCheckbox)return;const r=t("value",l),v={};j([n.value.store.root],f=>v[f.key]=f,f=>f.childNodes);const m=c.checkedKeys,K=e.multiple?g(e.modelValue).filter(f=>!(f in v)&&!m.includes(f)):[],b=K.concat(m);if(e.checkStrictly)o(_,e.multiple?b:b.includes(r)?r:void 0);else if(e.multiple)o(_,K.concat(n.value.getCheckedKeys(!0)));else{const f=E([l],y=>!w(t("children",y))&&!t("disabled",y),y=>t("children",y)),x=f?t("value",f):void 0,q=P(e.modelValue)&&!!E([l],y=>t("value",y)===e.modelValue,y=>t("children",y));o(_,x===e.modelValue||q?void 0:x)}V(()=>{var f;const x=g(e.modelValue);n.value.setCheckedKeys(x),(f=a.onCheck)==null||f.call(a,l,{checkedKeys:n.value.getCheckedKeys(),checkedNodes:n.value.getCheckedNodes(),halfCheckedKeys:n.value.getHalfCheckedKeys(),halfCheckedNodes:n.value.getHalfCheckedNodes()})}),(i=s.value)==null||i.focus()},cacheOptions:N}};var ee=R({props:{data:{type:Array,default:()=>[]}},setup(e){const a=X($);return p(()=>e.data,()=>{var d;e.data.forEach(s=>{a.states.cachedOptions.has(s.value)||a.states.cachedOptions.set(s.value,s)});const o=((d=a.selectRef)==null?void 0:d.querySelectorAll("input"))||[];Array.from(o).includes(document.activeElement)||a.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const te=R({name:"ElTreeSelect",inheritAttrs:!1,props:{...T.props,...L.props,cacheData:{type:Array,default:()=>[]}},setup(e,a){const{slots:d,expose:o}=a,s=I(),n=I(),u=k(()=>e.nodeKey||e.valueKey||"value"),C=Q(e,a,{select:s,tree:n,key:u}),{cacheOptions:t,...h}=Z(e,a,{select:s,tree:n,key:u}),N=S({});return o(N),D(()=>{Object.assign(N,{...A(n.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...A(s.value,["focus","blur"])})}),()=>M(T,S({...C,ref:l=>s.value=l}),{...d,default:()=>[M(ee,{data:t.value}),M(L,S({...h,ref:l=>n.value=l}))]})}});var O=G(te,[["__file","tree-select.vue"]]);O.install=e=>{e.component(O.name,O)};const le=O,ae=le;export{ae as E};
