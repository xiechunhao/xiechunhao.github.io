var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,i=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&o(e,a,t[a]);if(s)for(var a of s(t))r.call(t,a)&&o(e,a,t[a]);return e},n=(e,s)=>t(e,a(s)),u=(e,t,a)=>new Promise(((s,l)=>{var r=e=>{try{i(a.next(e))}catch(t){l(t)}},o=e=>{try{i(a.throw(e))}catch(t){l(t)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);i((a=a.apply(e,t)).next())}));import{n as c,y as d,z as p,_ as m}from"./index-AUd2T663.js";/* empty css                  *//* empty css                    */import{_ as v}from"./Editor.vue_vue_type_style_index_0_lang-BXxcw3K5.js";/* empty css               */import{E as f,h,a7 as y,a4 as g,r as _,o as b,j,t as w,s as x,m as A,q as E,aN as P,G as $,u as V,i as O,ar as T,F as k,C as U,N as q,as as C,aU as z,_ as N,a$ as S,A as D,b0 as M,ap as Y,Z as J,M as L,z as R,J as G}from"./vendor-CC2XCvy_.js";import{a as I,A as W}from"./index-CDaEv5A8.js";import{E as B}from"./emojo-Ben6gd8J.js";const F=I.create({timeout:15e3,baseURL:"https://xxxx.com",withCredentials:!0,transformRequest:[e=>JSON.stringify(e)],validateStatus:e=>e>=200&&e<300,headers:{get:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},post:{"Content-Type":"application/json;charset=utf-8"}},transformResponse:[e=>{try{return"string"==typeof e&&e.startsWith("{")?JSON.parse(e):e}catch(t){return e}}]});function Z(e){return u(this,null,(function*(){"POST"!==e.method&&"PUT"!==e.method||(e.data=e.params,e.params={});try{return(yield F.request(i({},e))).data}catch(t){return I.isAxiosError(t),Promise.reject(t)}}))}F.interceptors.request.use((e=>{const{token:t}=c().info;return t&&e.headers.set({"Content-Type":"application/json",Authorization:t}),e}),(e=>(f.error(`服务器异常！ ${B[500]}`),Promise.reject(e)))),F.interceptors.response.use((e=>e),(e=>{var t;if(I.isCancel(e));else{const a=null==(t=e.response)?void 0:t.data.message;f.error(a?`${a} ${B[500]}`:`请求超时或服务器异常！${B[500]}`)}return Promise.reject(e)}));const H={get:e=>Z(n(i({},e),{method:"GET"})),post:e=>Z(n(i({},e),{method:"POST"})),put:e=>Z(n(i({},e),{method:"PUT"})),del:e=>Z(n(i({},e),{method:"DELETE"}))};class K{static getArticleList(e){const{page:t,size:a,searchVal:s,year:l}=e;return H.get({url:`/api/articles/${t}/${a}?title=${s}&year=${l}`})}static getArticleTypes(e){return H.get({url:"/api/articles/types",params:e})}static getArticleDetail(e){return H.get({url:`/api/articles/${e}`})}static addArticle(e){return H.post({url:"/api/articles/",params:e})}static editArticle(e,t){return H.put({url:`/api/articles/${e}`,params:t})}}var Q=(e=>(e[e.Add=0]="Add",e[e.Edit=1]="Edit",e))(Q||{});const X={class:"article-edit"},ee={class:"editor-wrap"},te={class:"form-wrap"},ae={class:"el-top upload-container"},se={key:0,class:"upload-placeholder"},le=["src"],re={style:{display:"flex","justify-content":"flex-end"}},oe=m(h({__name:"ArticlePublish",setup(e){const t=y(),a=g(),s=c();let{token:l}=s.info;const r={Authorization:l};let o=Q.Add;const i=_(""),n=_(),m=_(),h=_(""),F=_(""),Z=_(""),H=_(!0);b((()=>{we(),ue(),oe()}));const oe=()=>{const{id:e}=t.query;o=e?Q.Edit:Q.Add,o===Q.Edit&&e?ie(Number(e)):ne()},ie=e=>{ce=e,de()},ne=()=>{F.value=me(d().value)},ue=()=>u(this,null,(function*(){try{const e=yield I.get("https://www.qiniu.lingchen.kim/classify.json");e.data.code===W.success&&(m.value=e.data.data)}catch(e){}}));let ce=0;const de=()=>u(this,null,(function*(){const e=yield I.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.data.code===W.success){let{title:t,blog_class:a,html_content:s}=e.data.data;i.value=t,n.value=Number(a),h.value=s}})),pe=()=>{o===Q.Edit?ye():he()},me=e=>p(e,"YYYY-MM-DD").value,ve=()=>i.value?n.value?"<p><br></p>"===h.value?(f.error("请输入文章内容"),!1):!!Z.value||(f.error("请上传图片"),!1):(f.error("请选择文章类型"),!1):(f.error("请输入文章标题"),!1),fe=()=>({title:i.value,html_content:h.value,home_img:Z.value,blog_class:n.value,create_time:F.value}),he=()=>u(this,null,(function*(){try{if(!ve())return;h.value=ge(h.value);const e=fe();(yield K.addArticle(e)).code===W.success&&(f.success(`发布成功 ${B[200]}`),je())}catch(e){}})),ye=()=>u(this,null,(function*(){try{if(!ve())return;h.value=ge(h.value);const e=fe();(yield K.editArticle(ce,e)).code===W.success&&(f.success(`修改成功 ${B[200]}`),je())}catch(e){}})),ge=e=>e.replace(/(\s*)<\/code>/g,"</code>"),_e=e=>{Z.value=e.data.url,f.success(`图片上传成功 ${B[200]}`)},be=()=>{f.error(`图片上传失败 ${B[500]}`)},je=()=>{setTimeout((()=>{a.go(-1)}),800)},we=()=>{window.scrollTo({top:0})},xe=e=>{const t=e.type.startsWith("image/"),a=e.size/1024/1024<2;return t?!!a||(f.error("图片大小不能超过 2MB!"),!1):(f.error("只能上传图片文件!"),!1)};return(e,t)=>{const a=$,s=P,l=C,u=T,c=z,d=v,p=D,f=S,y=N,g=Y,_=J,b=G;return w(),j("div",X,[x("div",null,[x("div",ee,[A(c,{gutter:10},{default:E((()=>[A(s,{span:18},{default:E((()=>[A(a,{modelValue:V(i),"onUpdate:modelValue":t[0]||(t[0]=e=>O(i)?i.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])])),_:1}),A(s,{span:6},{default:E((()=>[A(u,{modelValue:V(n),"onUpdate:modelValue":t[1]||(t[1]=e=>O(n)?n.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:E((()=>[(w(!0),j(k,null,U(V(m),(e=>(w(),q(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),A(d,{class:"el-top",modelValue:V(h),"onUpdate:modelValue":t[2]||(t[2]=e=>O(h)?h.value=e:null)},null,8,["modelValue"]),x("div",te,[t[6]||(t[6]=x("h2",null,"发布设置",-1)),A(_,null,{default:E((()=>[A(y,{label:"封面"},{default:E((()=>[x("div",ae,[A(f,{class:"cover-uploader",action:"https://xxxx.com/api/common/upload",headers:r,"show-file-list":!1,"on-success":_e,"on-error":be,"before-upload":xe},{default:E((()=>[V(Z)?(w(),j("img",{key:1,src:V(Z),class:"cover-image"},null,8,le)):(w(),j("div",se,[A(p,{class:"upload-icon"},{default:E((()=>[A(V(M))])),_:1}),t[4]||(t[4]=x("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1}),t[5]||(t[5]=x("div",{class:"el-upload__tip"},"建议尺寸 16:9，jpg/png 格式",-1))])])),_:1}),A(y,{label:"可见"},{default:E((()=>[A(g,{modelValue:V(H),"onUpdate:modelValue":t[3]||(t[3]=e=>O(H)?H.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1}),x("div",re,[A(b,{type:"primary",onClick:pe,style:{width:"100px"}},{default:E((()=>[L(R(V(o)===V(Q).Edit?"保存":"发布"),1)])),_:1})])])])])])}}}),[["__scopeId","data-v-ebf04123"]]);export{oe as default};
