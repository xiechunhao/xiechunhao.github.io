import{b5 as N,r as T,o as c,c as _,w as e,b as t,cK as O,aG as W,u as k,d as m,aI as $,aH as P,aC as C,aL as Y,_ as z,a as F,cf as K,e as y,t as u,m as U,a8 as S,k as I,y as j,aE as q,s as R,bc as H,E as D,aY as L,aX as G,ay as X}from"./index-C4BxmZrN.js";import{i as B}from"./index-CkGVv88Q.js";import{i as A}from"./index-BCHJo1Hi.js";import"./index-DPWieFbN.js";import"./index-BY7TmcLY.js";import"./index-Cw5RFCD5.js";import"./virtual-list-CYzSvSUd.js";import"./index-CuklncWx.js";import"./index-CL6ZmOyB.js";import{E as J,a as Q}from"./col-DljvzS69.js";import{E as Z}from"./date-picker-wyenFiKS.js";import{E as ee,a as te}from"./descriptions-item-C9WD04Id.js";import{i as ae}from"./index-DSHqkOzX.js";import"./isArrayLikeObject-XYcYxEsS.js";import"./vuedraggable.umd-BuphSp9t.js";import"./arrays-6TrVLtTe.js";import"./index-dVmM0e8c.js";const le={__name:"operation-record-search",emits:["search"],setup(a,{emit:i}){const w=i,[p,f]=N({username:"",module:""}),b=T(["",""]),h=()=>{const[s,l]=b.value||[];w("search",{...p,createTimeStart:s,createTimeEnd:l})},M=()=>{f(),b.value=["",""],h()};return(s,l)=>{const o=$,n=P,d=J,E=Z,g=C,V=Q,x=Y,r=B;return c(),_(r,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[t(x,{"label-width":"72px",onKeyup:O(h,["enter"]),onSubmit:l[3]||(l[3]=W(()=>{},["prevent"]))},{default:e(()=>[t(V,{gutter:8},{default:e(()=>[t(d,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(n,{label:"用户账号"},{default:e(()=>[t(o,{clearable:"",modelValue:k(p).username,"onUpdate:modelValue":l[0]||(l[0]=v=>k(p).username=v),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(n,{label:"操作模块"},{default:e(()=>[t(o,{clearable:"",modelValue:k(p).module,"onUpdate:modelValue":l[1]||(l[1]=v=>k(p).module=v),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(n,{label:"操作时间"},{default:e(()=>[t(E,{"unlink-panels":"",type:"datetimerange",modelValue:b.value,"onUpdate:modelValue":l[2]||(l[2]=v=>b.value=v),"range-separator":"-","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":"开始时间","end-placeholder":"结束时间",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[t(n,{"label-width":"16px"},{default:e(()=>[t(g,{type:"primary",onClick:h},{default:e(()=>[m("查询")]),_:1}),t(g,{onClick:M},{default:e(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},oe={key:0},se={style:{"word-break":"break-all"}},ne={style:{"word-break":"break-all"}},re={__name:"operation-record-detail",props:{modelValue:Boolean,data:Object},emits:["update:modelValue"],setup(a,{emit:i}){const w=i,p=h=>{w("update:modelValue",h)},f=F({popperStyle:{width:"580px",maxWidth:"90%",wordBreak:"break-all"},bodyStyle:{maxWidth:"calc(100vw - 32px)",maxHeight:"252px",overflowY:"auto","--ele-scrollbar-color":"#5e5e5e","--ele-scrollbar-hover-color":"#707070","--ele-scrollbar-size":"8px"},offset:4,placement:"top"}),{mobile:b}=K();return(h,M)=>{const s=ee,l=I,o=j,n=te,d=q;return c(),_(d,{title:"详情",width:720,"model-value":a.modelValue,"onUpdate:modelValue":p},{default:e(()=>[a.data?(c(),_(n,{key:0,border:!0,column:k(b)?1:2,class:"detail-table"},{default:e(()=>[t(s,{label:"操作人"},{default:e(()=>[y("div",null,u(a.data.nickname)+"("+u(a.data.username)+")",1)]),_:1}),t(s,{label:"IP地址"},{default:e(()=>[y("div",null,u(a.data.ip),1)]),_:1}),t(s,{label:"操作模块"},{default:e(()=>[y("div",null,u(a.data.module),1)]),_:1}),t(s,{label:"操作功能"},{default:e(()=>[y("div",null,u(a.data.description),1)]),_:1}),t(s,{label:"操作时间"},{default:e(()=>[y("div",null,u(a.data.createTime),1)]),_:1}),t(s,{label:"请求耗时"},{default:e(()=>[isNaN(a.data.spendTime)?S("",!0):(c(),U("div",oe,u(a.data.spendTime/1e3)+"s",1))]),_:1}),t(s,{label:"请求方式"},{default:e(()=>[y("div",null,u(a.data.requestMethod),1)]),_:1}),t(s,{label:"请求状态"},{default:e(()=>[a.data.status===0?(c(),_(l,{key:0,size:"small",type:"success","disable-transitions":!0},{default:e(()=>[m(" 正常 ")]),_:1})):a.data.status===1?(c(),_(l,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:e(()=>[m(" 异常 ")]),_:1})):S("",!0)]),_:1}),t(s,{label:"请求地址",span:2},{default:e(()=>[y("div",se,u(a.data.url),1)]),_:1}),t(s,{label:"调用方法",span:2},{default:e(()=>[y("div",ne,u(a.data.method),1)]),_:1}),t(s,{label:"请求参数",span:2},{default:e(()=>[t(o,{"max-line":4,tooltip:f},{default:e(()=>[m(u(a.data.params),1)]),_:1},8,["tooltip"])]),_:1}),a.data.status===0?(c(),_(s,{key:0,label:"返回结果",span:2},{default:e(()=>[t(o,{"max-line":4,tooltip:f},{default:e(()=>[m(u(a.data.result),1)]),_:1},8,["tooltip"])]),_:1})):(c(),_(s,{key:1,label:"异常信息",span:2},{default:e(()=>[t(o,{"max-line":4,tooltip:f},{default:e(()=>[m(u(a.data.error),1)]),_:1},8,["tooltip"])]),_:1}))]),_:1},8,["column"])):S("",!0)]),_:1},8,["model-value"])}}},ie=z(re,[["__scopeId","data-v-04022ba2"]]);async function de(a){const i=await R.get("/system/operation-record/page",{params:a});return i.data.code===0?i.data.data:Promise.reject(new Error(i.data.message))}async function ue(a){const i=await R.get("/system/operation-record",{params:a});return i.data.code===0&&i.data.data?i.data.data:Promise.reject(new Error(i.data.message))}const ce={name:"SystemOperationRecord"},De=Object.assign(ce,{setup(a){const i=T(null),w=T([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"module",label:"操作模块",sortable:"custom",minWidth:110},{prop:"description",label:"操作功能",sortable:"custom",minWidth:110},{prop:"url",label:"请求地址",sortable:"custom",minWidth:110},{prop:"requestMethod",label:"请求方式",sortable:"custom",width:110,align:"center"},{prop:"status",label:"状态",sortable:"custom",width:100,align:"center",slot:"status",filters:[{text:"正常",value:"0"},{text:"异常",value:"1"}],filterMultiple:!1},{prop:"spendTime",label:"耗时",sortable:"custom",width:100,formatter:l=>`${l.spendTime/1e3}s`},{prop:"createTime",label:"操作时间",sortable:"custom",align:"center",minWidth:110},{columnKey:"action",label:"操作",width:90,align:"center",slot:"action",fixed:"right",hideInPrint:!0,hideInExport:!0}]),p=T({module:"",description:"",url:"",requestMethod:"",method:"",params:"",result:"",error:"",spendTime:0,os:"",device:"",browser:"",ip:"",status:0,createTime:"",nickname:"",username:""}),f=T(!1),b=({pages:l,where:o,orders:n,filters:d})=>de({...o,...n,...d,...l}),h=l=>{var o,n;(n=(o=i.value)==null?void 0:o.reload)==null||n.call(o,{page:1,where:l})},M=l=>{p.value=l,f.value=!0},s=()=>{var n,d;const l=[["账号","用户名","操作模块","操作功能","请求地址","请求方式","状态","耗时","操作时间"]],o=D.loading("请求中..");(d=(n=i.value)==null?void 0:n.fetch)==null||d.call(n,({where:E,orders:g,filters:V})=>{ue({...E,...g,...V}).then(x=>{o.close(),x.forEach(r=>{l.push([r.username,r.nickname,r.module,r.description,r.url,r.requestMethod,["正常","异常"][r.status],r.spendTime/1e3+"s",r.createTime])}),L({SheetNames:["Sheet1"],Sheets:{Sheet1:G.aoa_to_sheet(l)}},"操作日志.xlsx")}).catch(x=>{o.close(),D.error(x.message)})})};return(l,o)=>{const n=C,d=I,E=X,g=A,V=B,x=ae;return c(),_(x,null,{default:e(()=>[t(le,{onSearch:h}),t(V,{"body-style":{paddingTop:"8px"}},{default:e(()=>[t(g,{ref_key:"tableRef",ref:i,"row-key":"id",columns:w.value,datasource:b,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"操作日志数据"},"cache-key":"systemOperationRecordTable"},{toolbar:e(()=>[t(n,{type:"primary",class:"ele-btn-icon",icon:k(H),onClick:s},{default:e(()=>[m(" 导出 ")]),_:1},8,["icon"])]),status:e(({row:r})=>[r.status===0?(c(),_(d,{key:0,size:"small",type:"success","disable-transitions":!0},{default:e(()=>[m(" 正常 ")]),_:1})):r.status===1?(c(),_(d,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:e(()=>[m(" 异常 ")]),_:1})):S("",!0)]),action:e(({row:r})=>[t(E,{type:"primary",underline:!1,onClick:v=>M(r)},{default:e(()=>[m(" 详情 ")]),_:2},1032,["onClick"])]),_:1},8,["columns"])]),_:1}),t(ie,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=r=>f.value=r),data:p.value},null,8,["modelValue","data"])]),_:1})}}});export{De as default};
