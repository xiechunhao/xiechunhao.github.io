import{N as nt,E as fe,aO as u,x as je,aP as st,O as rt,z as ot,v as O,aQ as se,aR as Le,aS as lt,r as at,u as Ie,aF as ht,aT as ct,aU as ut,aV as dt,q as de,aW as gt,aC as ft,ay as Tt,at as Oe,a4 as De,w as D,aE as Te,aX as ve,aK as ze,aY as Ye,R as I,as as Ae,aJ as _t,aI as mt,aA as xt,aZ as Ge,aj as Et,U as pt,a_ as Rt,a$ as Ze,X as be,b0 as Ct,b1 as yt,b2 as te,b3 as ie,b4 as _e,b5 as Ft,b6 as wt,b7 as St,Z as Pt,b8 as q,b9 as Lt,k as It,ba as Ot,S as zt}from"./reproj.9b488601.js";class Yt extends nt{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(fe.CHANGE)}release(){this.state===u.ERROR&&this.setState(u.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==u.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==u.LOADED){e.interimTile=null;break}else e.getState()==u.LOADING?t=e:e.getState()==u.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==u.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){je()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const n=t-i+1e3/60;return n>=this.transition_?1:st(n/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const Me=Yt;class At extends Me{constructor(e,t,i,n,s,r){super(e,t,r),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=u.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=u.ERROR,this.unlistenImage_(),this.image_=Xt(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=u.LOADED:this.state=u.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==u.ERROR&&(this.state=u.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==u.IDLE&&(this.state=u.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=rt(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Xt(){const o=ot(1,1);return o.fillStyle="rgba(0,0,0,0)",o.fillRect(0,0,1,1),o.canvas}const Ue=At;class jt{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return O(i!==void 0,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return O(t!==void 0,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){if(this.containsKey(e))return this.entries_[e].value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){O(!(e in this.entries_),16);const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}const Dt=jt;function Xe(o,e,t,i){return i!==void 0?(i[0]=o,i[1]=e,i[2]=t,i):[o,e,t]}function re(o,e,t){return o+"/"+e+"/"+t}function Ke(o){return re(o[0],o[1],o[2])}function vt(o){return o.split("/").map(Number)}function Gt(o){return(o[1]<<o[0])+o[2]}function Zt(o,e){const t=o[0],i=o[1],n=o[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(i,n):!0}class bt extends Dt{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=vt(e)[0];this.forEach(n=>{n.tileCoord[0]!==i&&(this.remove(Ke(n.tileCoord)),n.release())})}}const ke=bt;class Ne{constructor(e,t,i,n){this.minX=e,this.maxX=t,this.minY=i,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function k(o,e,t,i,n){return n!==void 0?(n.minX=o,n.maxX=e,n.minY=t,n.maxY=i,n):new Ne(o,e,t,i)}const qe=Ne;class Mt extends Me{constructor(e,t,i,n,s,r,l,h,a,c,d,_){super(s,u.IDLE,{interpolate:!!_}),this.renderEdges_=d!==void 0?d:!1,this.pixelRatio_=l,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=r||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const T=n.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let g=this.sourceTileGrid_.getExtent();const y=f?se(T,f):T;if(Le(y)===0){this.state=u.EMPTY;return}const x=e.getExtent();x&&(g?g=se(g,x):g=x);const E=n.getResolution(this.wrappedTileCoord_[0]),p=ut(e,i,y,E);if(!isFinite(p)||p<=0){this.state=u.EMPTY;return}const R=c!==void 0?c:gt;if(this.triangulation_=new dt(e,i,y,g,p*R,E),this.triangulation_.getTriangles().length===0){this.state=u.EMPTY;return}this.sourceZ_=t.getZForResolution(p);let C=this.triangulation_.calculateSourceExtent();if(g&&(e.canWrapX()?(C[1]=de(C[1],g[1],g[3]),C[3]=de(C[3],g[1],g[3])):C=se(C,g)),!Le(C))this.state=u.EMPTY;else{const F=t.getTileRangeForExtentAndZ(C,this.sourceZ_);for(let G=F.minX;G<=F.maxX;G++)for(let z=F.minY;z<=F.maxY;z++){const v=a(this.sourceZ_,G,z,l);v&&this.sourceTiles_.push(v)}this.sourceTiles_.length===0&&(this.state=u.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==u.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=u.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],r=this.targetTileGrid_.getResolution(t),l=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=lt(n,s,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),r,h,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=u.LOADED}this.changed()}load(){if(this.state==u.IDLE){this.state=u.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==u.IDLE||i==u.LOADING){e++;const n=at(t,fe.CHANGE,function(s){const r=t.getState();(r==u.LOADED||r==u.ERROR||r==u.EMPTY)&&(Ie(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,n){t.getState()==u.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Ie),this.sourcesListenerKeys_=null}release(){this.canvas_&&(ht(this.canvas_.getContext("2d")),ct.push(this.canvas_),this.canvas_=null),super.release()}}const ge=Mt;class Ut extends ft{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Tt(),this.tmpTileRange_=new qe(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==u.LOADED||i==u.EMPTY||i==u.ERROR&&!n}getTile(e,t,i,n){const s=n.pixelRatio,r=n.viewState.projection,l=this.getLayer();let a=l.getSource().getTile(e,t,i,s,r);return a.getState()==u.ERROR&&l.getUseInterimTilesOnError()&&l.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=Oe(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!De(s,n))return null;const r=t.pixelRatio,l=t.viewState.projection,h=t.viewState,a=i.getRenderSource(),c=a.getTileGridForProjection(h.projection),d=a.getTilePixelRatio(t.pixelRatio);for(let _=c.getZForResolution(h.resolution);_>=c.getMinZoom();--_){const T=c.getTileCoordForCoordAndZ(n,_),f=a.getTile(_,T[1],T[2],r,l);if(!(f instanceof Ue||f instanceof ge)||f instanceof ge&&f.getState()===u.EMPTY)return null;if(f.getState()!==u.LOADED)continue;const g=c.getOrigin(_),y=D(c.getTileSize(_)),x=c.getResolution(_),E=Math.floor(d*((n[0]-g[0])/x-T[1]*y[0])),p=Math.floor(d*((g[1]-n[1])/x-T[2]*y[1])),R=Math.round(d*a.getGutterForProjection(h.projection));return this.getImageData(f.getImage(),E+R,p+R)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],n=e.viewState,s=n.projection,r=n.resolution,l=n.center,h=n.rotation,a=e.pixelRatio,c=this.getLayer(),d=c.getSource(),_=d.getRevision(),T=d.getTileGridForProjection(s),f=T.getZForResolution(r,d.zDirection),g=T.getResolution(f);let y=e.extent;const x=e.viewState.resolution,E=d.getTilePixelRatio(a),p=Math.round(Te(y)/x*a),R=Math.round(ve(y)/x*a),C=i.extent&&ze(i.extent);C&&(y=se(y,ze(i.extent)));const F=g*p/2/E,G=g*R/2/E,z=[l[0]-F,l[1]-G,l[0]+F,l[1]+G],v=T.getTileRangeForExtentAndZ(y,f),$={};$[f]={};const xe=this.createLoadedTileFinder(d,s,$),Ee=this.tmpExtent,pe=this.tmpTileRange_;this.newTiles_=!1;const Ve=h?Ye(n.center,x,h,e.size):void 0;for(let X=v.minX;X<=v.maxX;++X)for(let w=v.minY;w<=v.maxY;++w){if(h&&!T.tileCoordIntersectsViewport([f,X,w],Ve))continue;const S=this.getTile(f,X,w,e);if(this.isDrawableTile(S)){const M=I(this);if(S.getState()==u.LOADED){$[f][S.tileCoord.toString()]=S;let U=S.inTransition(M);U&&i.opacity!==1&&(S.endTransition(M),U=!1),!this.newTiles_&&(U||!this.renderedTiles.includes(S))&&(this.newTiles_=!0)}if(S.getAlpha(M,e.time)===1)continue}const ae=T.getTileCoordChildTileRange(S.tileCoord,pe,Ee);let H=!1;ae&&(H=xe(f+1,ae)),H||T.forEachTileCoordParentTileRange(S.tileCoord,xe,pe,Ee)}const Q=g/r*a/E;Ae(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/a,1/a,h,-p/2,-R/2);const oe=_t(this.pixelTransform);this.useContainer(t,oe,this.getBackground(e));const m=this.context,Z=m.canvas;mt(this.inversePixelTransform,this.pixelTransform),Ae(this.tempTransform,p/2,R/2,Q,Q,0,-p/2,-R/2),Z.width!=p||Z.height!=R?(Z.width=p,Z.height=R):this.containerReused||m.clearRect(0,0,p,R),C&&this.clipUnrotated(m,e,C),d.getInterpolate()||(m.imageSmoothingEnabled=!1),this.preRender(m,e),this.renderedTiles.length=0;let W=Object.keys($).map(Number);W.sort(xt);let b,le,L;i.opacity===1&&(!this.containerReused||d.getOpaque(e.viewState.projection))?W=W.reverse():(b=[],le=[]);for(let X=W.length-1;X>=0;--X){const w=W[X],S=d.getTilePixelSize(w,a,s),H=T.getResolution(w)/g,M=S[0]*H*Q,U=S[1]*H*Q,he=T.getTileCoordForCoordAndZ(Ge(z),w),Re=T.getTileCoordExtent(he),J=Oe(this.tempTransform,[E*(Re[0]-z[0])/g,E*(z[3]-Re[3])/g]),Qe=E*d.getGutterForProjection(s),Ce=$[w];for(const Je in Ce){const K=Ce[Je],ye=K.tileCoord,Fe=he[1]-ye[1],et=Math.round(J[0]-(Fe-1)*M),we=he[2]-ye[2],tt=Math.round(J[1]-(we-1)*U),Y=Math.round(J[0]-Fe*M),A=Math.round(J[1]-we*U),B=et-Y,V=tt-A,Se=f===w,Pe=Se&&K.getAlpha(I(this),e.time)!==1;let ce=!1;if(!Pe)if(b){L=[Y,A,Y+B,A,Y+B,A+V,Y,A+V];for(let ee=0,it=b.length;ee<it;++ee)if(f!==w&&w<le[ee]){const P=b[ee];Et([Y,A,Y+B,A+V],[P[0],P[3],P[4],P[7]])&&(ce||(m.save(),ce=!0),m.beginPath(),m.moveTo(L[0],L[1]),m.lineTo(L[2],L[3]),m.lineTo(L[4],L[5]),m.lineTo(L[6],L[7]),m.moveTo(P[6],P[7]),m.lineTo(P[4],P[5]),m.lineTo(P[2],P[3]),m.lineTo(P[0],P[1]),m.clip())}b.push(L),le.push(w)}else m.clearRect(Y,A,B,V);this.drawTileImage(K,e,Y,A,B,V,Qe,Se),b&&!Pe?(ce&&m.restore(),this.renderedTiles.unshift(K)):this.renderedTiles.push(K),this.updateUsedTiles(e.usedTiles,d,K)}}return this.renderedRevision=_,this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!pt(this.renderedExtent_,z),this.renderedExtent_=z,this.renderedPixelRatio=a,this.renderedProjection=s,this.manageTilePyramid(e,d,T,a,s,y,f,c.getPreload()),this.scheduleExpireCache(e,d),this.postRender(m,e),i.extent&&m.restore(),m.imageSmoothingEnabled=!0,oe!==Z.style.transform&&(Z.style.transform=oe),this.container}drawTileImage(e,t,i,n,s,r,l,h){const a=this.getTileImage(e);if(!a)return;const c=I(this),d=t.layerStatesArray[t.layerIndex],_=d.opacity*(h?e.getAlpha(c,t.time):1),T=_!==this.context.globalAlpha;T&&(this.context.save(),this.context.globalAlpha=_),this.context.drawImage(a,l,l,a.width-2*l,a.height-2*l,i,n,s,r),T&&this.context.restore(),_!==d.opacity?t.animate=!0:h&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=function(n,s,r){const l=I(n);l in r.usedTiles&&n.expireCache(r.viewState.projection,r.usedTiles[l])}.bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const n=I(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}manageTilePyramid(e,t,i,n,s,r,l,h,a){const c=I(t);c in e.wantedTiles||(e.wantedTiles[c]={});const d=e.wantedTiles[c],_=e.tileQueue,T=i.getMinZoom(),f=e.viewState.rotation,g=f?Ye(e.viewState.center,e.viewState.resolution,f,e.size):void 0;let y=0,x,E,p,R,C,F;for(F=T;F<=l;++F)for(E=i.getTileRangeForExtentAndZ(r,F,E),p=i.getResolution(F),R=E.minX;R<=E.maxX;++R)for(C=E.minY;C<=E.maxY;++C)f&&!i.tileCoordIntersectsViewport([F,R,C],g)||(l-F<=h?(++y,x=t.getTile(F,R,C,n,s),x.getState()==u.IDLE&&(d[x.getKey()]=!0,_.isKeyQueued(x.getKey())||_.enqueue([x,c,i.getTileCoordCenter(x.tileCoord),p])),a!==void 0&&a(x)):t.useTile(F,R,C,s));t.updateCacheSize(y,s)}}const Kt=Ut,ne={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},N=[0,0,0],j=5;class kt{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,O(Rt(this.resolutions_,function(n,s){return s-n},!0),17);let t;if(!e.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,O(this.origins_.length==this.resolutions_.length,20));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Ge(i)),O(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,O(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Ze,O(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(n,s){const r=new qe(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const l=this.getTileRangeForExtentAndZ(i,s);r.minX=Math.max(l.minX,r.minX),r.maxX=Math.min(l.maxX,r.maxX),r.minY=Math.max(l.minY,r.minY),r.maxY=Math.min(l.maxY,r.maxY)}return r},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let s=n.minX,r=n.maxX;s<=r;++s)for(let l=n.minY,h=n.maxY;l<=h;++l)i([t,s,l])}forEachTileCoordParentTileRange(e,t,i,n){let s,r,l,h=null,a=e[0]-1;for(this.zoomFactor_===2?(r=e[1],l=e[2]):h=this.getTileCoordExtent(e,n);a>=this.minZoom;){if(this.zoomFactor_===2?(r=Math.floor(r/2),l=Math.floor(l/2),s=k(r,r,l,l,i)):s=this.getTileRangeForExtentAndZ(h,a,i),t(a,s))return!0;--a}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,r=e[2]*2;return k(s,s+1,r,r+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],s=e[1],r=e[2];if(t===n)return k(s,r,s,r,i);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,t-n),a=Math.floor(s*h),c=Math.floor(r*h);if(t<n)return k(a,a,c,c,i);const d=Math.floor(h*(s+1))-1,_=Math.floor(h*(r+1))-1;return k(a,d,c,_,i)}const l=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,N);const n=N[1],s=N[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,N);const r=N[1],l=N[2];return k(n,r,s,l,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=D(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=D(this.getTileSize(e[0]),this.tmpSize_),r=i[0]+e[1]*s[0]*n,l=i[1]-(e[2]+1)*s[1]*n,h=r+s[0]*n,a=l+s[1]*n;return be(r,l,h,a,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,s){const r=this.getZForResolution(i),l=i/this.getResolution(r),h=this.getOrigin(r),a=D(this.getTileSize(r),this.tmpSize_);let c=l*(e-h[0])/i/a[0],d=l*(h[1]-t)/i/a[1];return n?(c=te(c,j)-1,d=te(d,j)-1):(c=ie(c,j),d=ie(d,j)),Xe(r,c,d,s)}getTileCoordForXYAndZ_(e,t,i,n,s){const r=this.getOrigin(i),l=this.getResolution(i),h=D(this.getTileSize(i),this.tmpSize_);let a=(e-r[0])/l/h[0],c=(r[1]-t)/l/h[1];return n?(a=te(a,j)-1,c=te(c,j)-1):(a=ie(a,j),c=ie(c,j)),Xe(i,a,c,s)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=Ct(this.resolutions_,e,t||0);return de(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return yt(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}const $e=kt,ue={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function We(o){let e=o.getDefaultTileGrid();return e||(e=$t(o),o.setDefaultTileGrid(e)),e}function Nt(o,e,t){const i=e[0],n=o.getTileCoordCenter(e),s=Be(t);if(!De(s,n)){const r=Te(s),l=Math.ceil((s[0]-n[0])/r);return n[0]+=r*l,o.getTileCoordForCoordAndZ(n,i)}return e}function qt(o,e,t,i){i=i!==void 0?i:"top-left";const n=He(o,e,t);return new $e({extent:o,origin:wt(o,i),resolutions:n,tileSize:t})}function ai(o){const e=o||{},t=e.extent||_e("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:He(t,e.maxZoom,e.tileSize,e.maxResolution)};return new $e(i)}function He(o,e,t,i){e=e!==void 0?e:St,t=D(t!==void 0?t:Ze);const n=ve(o),s=Te(o);i=i>0?i:Math.max(s/t[0],n/t[1]);const r=e+1,l=new Array(r);for(let h=0;h<r;++h)l[h]=i/Math.pow(2,h);return l}function $t(o,e,t,i){const n=Be(o);return qt(n,e,t,i)}function Be(o){o=_e(o);let e=o.getExtent();if(!e){const t=180*Ft.degrees/o.getMetersPerUnit();e=be(-t,-t,t,t)}return e}class Wt extends Pt{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&D(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new ke(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,n){const s=this.getTileCacheForProjection(e);if(!s)return!1;let r=!0,l,h,a;for(let c=i.minX;c<=i.maxX;++c)for(let d=i.minY;d<=i.maxY;++d)h=re(t,c,d),a=!1,s.containsKey(h)&&(l=s.get(h),a=l.getState()===u.LOADED,a&&(a=n(l)!==!1)),a||(r=!1);return r}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,s){return je()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:We(e)}getTileCacheForProjection(e){const t=this.getProjection();return O(t===null||q(t,e),68),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(t),r=D(n.getTileSize(e),this.tmpSize);return s==1?r:Lt(r,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=Nt(i,e,t)),Zt(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,n){}}class Ht extends It{constructor(e,t){super(e),this.tile=t}}const Bt=Wt;function Vt(o,e){const t=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(r,l,h){if(r)return o.replace(t,r[0].toString()).replace(i,r[1].toString()).replace(n,r[2].toString()).replace(s,function(){const a=r[0],c=e.getFullTileRange(a);return O(c,55),(c.getHeight()-r[2]-1).toString()})}}function Qt(o,e){const t=o.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=Vt(o[n],e);return Jt(i)}function Jt(o){return o.length===1?o[0]:function(e,t,i){if(!e)return;const n=Gt(e),s=Ot(n,o.length);return o[s](e,t,i)}}function ei(o){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(o);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let s;for(s=i;s<=n;++s)e.push(o.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(o),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(o.replace(t[0],n.toString()));return e}return e.push(o),e}class me extends Bt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===me.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=I(t),n=t.getState();let s;n==u.LOADING?(this.tileLoadingKeys_[i]=!0,s=ue.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==u.ERROR?ue.TILELOADERROR:n==u.LOADED?ue.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Ht(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=ei(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Qt(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const n=re(e,t,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const ti=me;class ii extends zt{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(ne.PRELOAD)}setPreload(e){this.set(ne.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(ne.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(ne.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const ni=ii;class si extends ni{constructor(e){super(e)}createRenderer(){return new Kt(this)}}const hi=si;class ri extends ti{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:oi,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:Ue,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const n in this.tileCacheForProjection){const s=this.tileCacheForProjection[n];s.expireCache(s==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!q(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!q(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||q(t,e)))return this.tileGrid;const i=I(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=We(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||q(t,e))return this.tileCache;const i=I(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new ke(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,n,s,r){const l=[e,t,i],h=this.getTileCoordForTileUrlFunction(l,s),a=h?this.tileUrlFunction(h,n,s):void 0,c=new this.tileClass(l,a!==void 0?u.IDLE:u.EMPTY,a!==void 0?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=r,c.addEventListener(fe.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,i,n,s){const r=this.getProjection();if(!r||!s||q(r,s))return this.getTileInternal(e,t,i,n,r||s);const l=this.getTileCacheForProjection(s),h=[e,t,i];let a;const c=Ke(h);l.containsKey(c)&&(a=l.get(c));const d=this.getKey();if(a&&a.key==d)return a;const _=this.getTileGridForProjection(r),T=this.getTileGridForProjection(s),f=this.getTileCoordForTileUrlFunction(h,s),g=new ge(r,_,s,T,h,f,this.getTilePixelRatio(n),this.getGutter(),(y,x,E,p)=>this.getTileInternal(y,x,E,p,r),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return g.key=d,a?(g.interimTile=a,g.refreshInterimChain(),l.replace(c,g)):l.set(c,g),g}getTileInternal(e,t,i,n,s){let r=null;const l=re(e,t,i),h=this.getKey();if(!this.tileCache.containsKey(l))r=this.createTile_(e,t,i,n,s,h),this.tileCache.set(l,r);else if(r=this.tileCache.get(l),r.key!=h){const a=r;r=this.createTile_(e,t,i,n,s,h),a.getState()==u.IDLE?r.interimTile=a.interimTile:r.interimTile=a,r.refreshInterimChain(),this.tileCache.replace(l,r)}return r}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=_e(e);if(i){const n=I(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function oi(o,e){o.getImage().src=e}const ci=ri;export{ni as B,Ue as I,Dt as L,ge as R,hi as T,ci as a,Me as b,ai as c,qe as d,Be as e,Xe as f,Ke as g,$e as h,Jt as i};
