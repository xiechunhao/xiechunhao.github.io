import{c as R}from"./commonjsHelpers.042e6b4d.js";import{a as k}from"./leaflet-src.347f22be.js";(function(z,I){(function(o,d){d(k)})(R,function(o){o=o&&o.hasOwnProperty("default")?o.default:o;function d(i,t){var n=t.x-i.x,e=t.y-i.y;return Math.sqrt(n*n+e*e)}var b=function(t,n){return(Math.atan2(n.y-t.y,n.x-t.x)*180/Math.PI+90+360)%360},g=function(t,n){var e=t.value,r=t.isInPixels;return r?e/n:e};function y(i){if(typeof i=="string"&&i.indexOf("%")!==-1)return{value:parseFloat(i)/100,isInPixels:!1};var t=i?parseFloat(i):0;return{value:t,isInPixels:t>0}}var P=function(t,n){return t.x===n.x&&t.y===n.y};function x(i){return i.reduce(function(t,n,e,r){if(e>0&&!P(n,r[e-1])){var a=r[e-1],s=t.length>0?t[t.length-1].distB:0,h=d(a,n);t.push({a,b:n,distA:s,distB:s+h,heading:b(a,n)})}return t},[])}function O(i,t){var n=x(i),e=n.length;if(e===0)return[];var r=n[e-1].distB,a=g(t.offset,r),s=g(t.endOffset,r),h=g(t.repeat,r),l=r*h,p=a>0?r*a:0,c=s>0?r*s:0,f=[],m=p;do f.push(m),m+=l;while(l>0&&m<r-c);var _=0,u=n[0];return f.map(function(v){for(;v>u.distB&&_<e-1;)_++,u=n[_];var M=(v-u.distA)/(u.distB-u.distA);return{pt:S(u.a,u.b,M),heading:u.heading}})}function S(i,t,n){return t.x!==i.x?{x:i.x+n*(t.x-i.x),y:i.y+n*(t.y-i.y)}:{x:i.x,y:i.y+(t.y-i.y)*n}}(function(){var i=L.Marker.prototype._initIcon,t=L.Marker.prototype._setPos,n=L.DomUtil.TRANSFORM==="msTransform";L.Marker.addInitHook(function(){var e=this.options.icon&&this.options.icon.options,r=e&&this.options.icon.options.iconAnchor;r&&(r=r[0]+"px "+r[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||r||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(a){a.target._applyRotation()})}),L.Marker.include({_initIcon:function(){i.call(this)},_setPos:function(e){t.call(this,e),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,n?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(e){return this.options.rotationAngle=e,this.update(),this},setRotationOrigin:function(e){return this.options.rotationOrigin=e,this.update(),this}})})(),o.Symbol=o.Symbol||{},o.Symbol.Dash=o.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function(t){o.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,n,e,r,a){var s=this.options,h=Math.PI/180;if(s.pixelSize<=1)return o.polyline([t.latLng,t.latLng],s.pathOptions);var l=e.project(t.latLng),p=-(t.heading-90)*h,c=o.point(l.x+s.pixelSize*Math.cos(p+Math.PI)/2,l.y+s.pixelSize*Math.sin(p)/2),f=l.add(l.subtract(c));return o.polyline([e.unproject(c),e.unproject(f)],s.pathOptions)}}),o.Symbol.dash=function(i){return new o.Symbol.Dash(i)},o.Symbol.ArrowHead=o.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(t){o.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,n,e,r,a){return this.options.polygon?o.polygon(this._buildArrowPath(t,e),this.options.pathOptions):o.polyline(this._buildArrowPath(t,e),this.options.pathOptions)},_buildArrowPath:function(t,n){var e=Math.PI/180,r=n.project(t.latLng),a=-(t.heading-90)*e,s=this.options.headAngle/2*e,h=a+s,l=a-s,p=o.point(r.x-this.options.pixelSize*Math.cos(h),r.y+this.options.pixelSize*Math.sin(h)),c=o.point(r.x-this.options.pixelSize*Math.cos(l),r.y+this.options.pixelSize*Math.sin(l));return[n.unproject(p),t.latLng,n.unproject(c)]}}),o.Symbol.arrowHead=function(i){return new o.Symbol.ArrowHead(i)},o.Symbol.Marker=o.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function(t){o.Util.setOptions(this,t),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function(t,n,e,r,a){return this.options.rotate&&(this.options.markerOptions.rotationAngle=t.heading+(this.options.angleCorrection||0)),o.marker(t.latLng,this.options.markerOptions)}}),o.Symbol.marker=function(i){return new o.Symbol.Marker(i)};var A=function(t){return t instanceof o.LatLng||Array.isArray(t)&&t.length===2&&typeof t[0]=="number"},w=function(t){return Array.isArray(t)&&A(t[0])};o.PolylineDecorator=o.FeatureGroup.extend({options:{patterns:[]},initialize:function(t,n){o.FeatureGroup.prototype.initialize.call(this),o.Util.setOptions(this,n),this._map=null,this._paths=this._initPaths(t),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function(t,n){var e=this;if(w(t)){var r=n?t.concat([t[0]]):t;return[r]}return t instanceof o.Polyline?this._initPaths(t.getLatLngs(),t instanceof o.Polygon):Array.isArray(t)?t.reduce(function(a,s){return a.concat(e._initPaths(s,n))},[]):[]},_initPatterns:function(t){return t.map(this._parsePatternDef)},setPatterns:function(t){this.options.patterns=t,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function(t){this._paths=this._initPaths(t),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function(t,n){return{symbolFactory:t.symbol,offset:y(t.offset),endOffset:y(t.endOffset),repeat:y(t.repeat)}},onAdd:function(t){this._map=t,this._draw(),this._map.on("moveend",this.redraw,this)},onRemove:function(t){this._map.off("moveend",this.redraw,this),this._map=null,o.FeatureGroup.prototype.onRemove.call(this,t)},_initBounds:function(){var t=this._paths.reduce(function(n,e){return n.concat(e)},[]);return o.latLngBounds(t)},getBounds:function(){return this._bounds},_buildSymbols:function(t,n,e){var r=this;return e.map(function(a,s){return n.buildSymbol(a,t,r._map,s,e.length)})},_getDirectionPoints:function(t,n){var e=this;if(t.length<2)return[];var r=t.map(function(a){return e._map.project(a)});return O(r,n).map(function(a){return{latLng:e._map.unproject(o.point(a.pt)),heading:a.heading}})},redraw:function(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function(t){var n=this,e=this._map.getBounds().pad(.1);return this._paths.map(function(r){var a=n._getDirectionPoints(r,t).filter(function(s){return e.contains(s.latLng)});return o.featureGroup(n._buildSymbols(r,t.symbolFactory,a))})},_draw:function(){var t=this;this._patterns.map(function(n){return t._getPatternLayers(n)}).forEach(function(n){t.addLayer(o.featureGroup(n))})}}),o.polylineDecorator=function(i,t){return new o.PolylineDecorator(i,t)}})})();
