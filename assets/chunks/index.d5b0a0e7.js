import{L as o}from"./leaflet-src.347f22be.js";import"./leaflet.polylineDecorator.73fdfbec.js";import{A as S}from"./index.a511ac44.js";import{d as b,p as w,a4 as A,D as k,o as z,c as T,z as f,G as l,B as d,a as c,F as I,M,N as F,_ as P}from"./framework.3a9101bc.js";import"./commonjsHelpers.042e6b4d.js";L.AnimatedMarker=L.Marker.extend({options:{speetX:1,speedList:[],distance:100,interval:100,autoStart:!1,isPlay:!1,playCall:null},initialize:function(t,e){Object.assign(this.options,e),this.isZooming=!1,L.Marker.prototype.initialize.call(this,t[0],e),this.setLine(t),this.resetIcon()},resetIcon:function(){const t=this;var e=t.options.icon.options,s=L.DivIcon.extend({createIcon:function(){var i=document.createElement("div");i.style.width=e.iconSize[0]+"px",i.style.height=e.iconSize[1]+"px",i.style.position="absolute",t.div=document.createElement("div"),t.div.style.width=e.iconSize[0]+"px",t.div.style.height=e.iconSize[1]+"px",t.div.style.transition="transform linear 100ms",t.div.style.transformOrigin="center",t.div.style.transform="translate3d(-"+e.iconAnchor[0]+"px, -"+e.iconAnchor[0]+"px, 0) rotate(-"+t._latlngs[0].bearing+"deg)";const n=document.createElement("img");return n.src=e.iconUrl,n.width=e.iconSize[0],n.height=e.iconSize[1],t.div.appendChild(n),i.appendChild(t.div),i},rotate(i){t.before&&Math.abs(t.before-i)>=180?t.div.style.transition="none":t.div.style.transition="transform linear 100ms",t.div.style.transform="translate3d(-19px, -13px, 0) rotate(-"+i+"deg)",t.before=i},iconSize:e.iconSize});this.icon=new s,this.setIcon(this.icon)},onAdd:function(t){L.Marker.prototype.onAdd.call(this,t),this.animate(),this.map=t;const e=this;t.addEventListener("zoomstart",function(){e.isZooming=!0}),t.addEventListener("zoomend",function(){e.isZooming=!1}),this.options.autoStart&&this.start()},animate:function(){var t=Date.now(),e=this.startedAt+this.duration;if(t<e&&this.getLatLng().distanceTo(this.startLatLng)<this.nextLatLng.distanceTo(this.startLatLng)?this.isPlay&&requestAnimationFrame(this.animate.bind(this)):this._i<this._latlngs.length-1&&(this.speetChange&&(this._latlngs=this._latlngsnew,this.speetChange=!1),this.startedAt=Date.now(),this.startLatLng=this._latlngs[this._i],this.nextLatLng=this._latlngs[this._i+1],this.duration=this.startLatLng.duration,this.setLatLng(this._latlngs[this._i]),this.icon.rotate(this.startLatLng.bearing),this._i++,this.isPlay&&requestAnimationFrame(this.animate.bind(this))),!this.isZooming&&this.map){var s=t-this.startedAt;s>this.duration&&(s=this.duration);var i=this.startLatLng.lat+(this.nextLatLng.lat-this.startLatLng.lat)/this.startLatLng.duration*s,n=this.startLatLng.lng+(this.nextLatLng.lng-this.startLatLng.lng)/this.startLatLng.duration*s;this.setLatLng({lat:i,lng:n}),this.options.playCall&&this.options.playCall({lat:i,lng:n})}},setSpeetX:function(t){var e=t/this.options.speetX;this._latlngsnew=[];for(var s=0;s<this._latlngs.length;s++){var i=L.latLng(this._latlngs[s].lat,this._latlngs[s].lng);i.duration=this._latlngs[s].duration/e,i.bearing=this._latlngs[s].bearing,this._latlngsnew.push(i)}this.options.speetX=t,this.speetChange=!0},start:function(){this.isPlay=!0,this.startedAt=Date.now(),this.isPause&&(this.startedAt=this.startedAt-this.playedTime,this.isPause=!1),this.animate()},pause:function(){this.playedTime=Date.now()-this.startedAt,this.isPause=!0,this.isPlay=!1},stop:function(){this.isPlay=!1,this.isPause=!1,this.startedAt=NaN,this._i=0,this.animate()},setLine:function(t){for(var e=0;e<t.length;e++)e===t.length-1?(t[e].duration=t[e-1].duration,t[e].bearing=t[e-1].bearing):(this.options.speedList.length>0&&this.options.speedList[e]!==void 0?t[e].duration=t[e].distanceTo(t[e+1])/this.options.distance*(this.options.interval/this.options.speedList[e]):t[e].duration=t[e].distanceTo(t[e+1])/this.options.distance*this.options.interval,t[e].bearing=this.getRotation(t[e],t[e+1]));this._latlngs=t,this._i=0},getRotation:function(t,e){var s=e.lng-t.lng,i=e.lat-t.lat,n=Math.atan2(i,s),r=180*n/Math.PI;return r>-180&&r<0&&(r=360+r),r}});L.animatedMarker=function(t,e){return new L.AnimatedMarker(t,e)};const D=t=>(M("data-v-f09190e7"),t=t(),F(),t),E={class:"top-bar"},N=D(()=>f("div",{id:"map"},null,-1)),B=b({__name:"index",setup(t){let e=null,s,i,n;const r=()=>{e=o.map("map",{crs:o.CRS.EPSG3857,center:[39.924317,116.390619],zoom:12,preferCanvas:!0}),o.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{noWrap:!0,attribution:S}).addTo(e);const p=[[39.898457,116.391844],[39.898595,116.377947],[39.898341,116.368001],[39.898063,116.357144],[39.899095,116.351934],[39.905871,116.35067],[39.922329,116.3498],[39.931017,116.349671],[39.939104,116.349225],[39.942233,116.34991],[39.947263,116.366892],[39.947568,116.387537],[39.947764,116.401988],[39.947929,116.410824],[39.947558,116.42674],[39.9397,116.427338],[39.932404,116.427919],[39.923109,116.428377],[39.907094,116.429583],[39.906858,116.41404],[39.906622,116.405321],[39.906324,116.394954],[39.906308,116.391264],[39.916611,116.390748]],u=[1,1,2,2,3,3,3,4,4,4,4,4,4,5,5,4,4,4,3,2,2,1,1,1],a=o.polyline(p,{weight:8}).addTo(e);s=o.polyline([],{weight:8,color:"#FF9900"}).addTo(e),o.polylineDecorator(a,{patterns:[{repeat:50,symbol:o.Symbol.arrowHead({pixelSize:5,headAngle:75,polygon:!1,pathOptions:{stroke:!0,weight:2,color:"#FFFFFF"}})}]}).addTo(e);const C=o.icon({iconSize:[37,26],iconAnchor:[19,13],iconUrl:"/image/car.png"});n=o.animatedMarker(a.getLatLngs(),{speedList:u,interval:200,icon:C,playCall:g}).addTo(e),i=[a.getLatLngs()[0]]};function g(p){i.push(p),s.setLatLngs(i)}let h=1;function m(){h=h*2,n.setSpeetX(h)}function _(){h=h/2,n.setSpeetX(h)}function v(){n.start()}function y(){n.pause()}function x(){i=[],n.stop()}return w(()=>{r()}),A(()=>{e&&(e.remove(),e=null)}),(p,u)=>{const a=k("el-button");return z(),T(I,null,[f("div",E,[l(a,{type:"primary",onClick:v},{default:d(()=>[c("开始")]),_:1}),l(a,{type:"primary",onClick:y},{default:d(()=>[c("暂停")]),_:1}),l(a,{type:"primary",onClick:m},{default:d(()=>[c("加速")]),_:1}),l(a,{type:"primary",onClick:_},{default:d(()=>[c("减速")]),_:1}),l(a,{type:"primary",onClick:x},{default:d(()=>[c("停止")]),_:1})]),N],64)}}});const V=P(B,[["__scopeId","data-v-f09190e7"]]);export{V as default};
