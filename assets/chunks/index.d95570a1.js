import{a as q,L as F}from"./leaflet-src.347f22be.js";import{M as z,A as Y}from"./index.a511ac44.js";import{d as H,p as J,a4 as Z,o as V,c as W,_ as Q}from"./framework.57763b9a.js";import"./commonjsHelpers.042e6b4d.js";var $={exports:{}};(function(A){var _=_||q,L=15e3,x=1e3,k=60*x,b=60*k,S=24*b,O="http://www.topografix.com/GPX/gpx_style/0/2",X={startIconUrl:"pin-icon-start.png",endIconUrl:"pin-icon-end.png",shadowUrl:"pin-shadow.png",wptIcons:[],wptIconsType:[],wptIconUrls:{"":"pin-icon-wpt.png"},wptIconTypeUrls:{"":"pin-icon-wpt.png"},pointMatchers:[],iconSize:[33,45],shadowSize:[50,50],iconAnchor:[16,45],shadowAnchor:[16,47],clickable:!1},D={color:"blue"},R={parseElements:["track","route","waypoint"],joinTrackSegments:!0};_.GPX=_.FeatureGroup.extend({initialize:function(t,e){e.max_point_interval=e.max_point_interval||L,e.marker_options=this._merge_objs(X,e.marker_options||{}),e.polyline_options=e.polyline_options||{},e.gpx_options=this._merge_objs(R,e.gpx_options||{}),_.Util.setOptions(this,e),_.GPXTrackIcon=_.Icon.extend({options:e.marker_options}),this._gpx=t,this._layers={},this._init_info(),t&&this._parse(t,e,this.options.async)},get_duration_string:function(t,e){var n="";t>=S&&(n+=Math.floor(t/S)+"d ",t=t%S),t>=b&&(n+=Math.floor(t/b)+":",t=t%b);var i=Math.floor(t/k);t=t%k,i<10&&(n+="0"),n+=i+"'";var a=Math.floor(t/x);return t=t%x,a<10&&(n+="0"),n+=a,!e&&t>0?n+="."+Math.round(Math.floor(t)*1e3)/1e3:n+='"',n},get_duration_string_iso:function(t,e){var n=this.get_duration_string(t,e);return n.replace("'",":").replace('"',"")},to_miles:function(t){return t/1.60934},to_ft:function(t){return t*3.28084},m_to_km:function(t){return t/1e3},m_to_mi:function(t){return t/1609.34},ms_to_kmh:function(t){return t*3.6},ms_to_mih:function(t){return t/1609.34*3600},get_name:function(){return this._info.name},get_desc:function(){return this._info.desc},get_author:function(){return this._info.author},get_copyright:function(){return this._info.copyright},get_distance:function(){return this._info.length},get_distance_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))},get_start_time:function(){return this._info.duration.start},get_end_time:function(){return this._info.duration.end},get_moving_time:function(){return this._info.duration.moving},get_total_time:function(){return this._info.duration.total},get_moving_pace:function(){return this.get_moving_time()/this.m_to_km(this.get_distance())},get_moving_pace_imp:function(){return this.get_moving_time()/this.get_distance_imp()},get_moving_speed:function(){return this.m_to_km(this.get_distance())/(this.get_moving_time()/(3600*1e3))},get_moving_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_moving_time()/(3600*1e3))},get_total_speed:function(){return this.m_to_km(this.get_distance())/(this.get_total_time()/(3600*1e3))},get_total_speed_imp:function(){return this.to_miles(this.m_to_km(this.get_distance()))/(this.get_total_time()/(3600*1e3))},get_elevation_gain:function(){return this._info.elevation.gain},get_elevation_loss:function(){return this._info.elevation.loss},get_elevation_gain_imp:function(){return this.to_ft(this.get_elevation_gain())},get_elevation_loss_imp:function(){return this.to_ft(this.get_elevation_loss())},get_elevation_data:function(){var t=this;return this._info.elevation._points.map(function(e){return t._prepare_data_point(e,t.m_to_km,null,function(n,i){return n.toFixed(2)+" km, "+i.toFixed(0)+" m"})})},get_elevation_data_imp:function(){var t=this;return this._info.elevation._points.map(function(e){return t._prepare_data_point(e,t.m_to_mi,t.to_ft,function(n,i){return n.toFixed(2)+" mi, "+i.toFixed(0)+" ft"})})},get_elevation_max:function(){return this._info.elevation.max},get_elevation_min:function(){return this._info.elevation.min},get_elevation_max_imp:function(){return this.to_ft(this.get_elevation_max())},get_elevation_min_imp:function(){return this.to_ft(this.get_elevation_min())},get_speed_data:function(){var t=this;return this._info.speed._points.map(function(e){return t._prepare_data_point(e,t.m_to_km,t.ms_to_kmh,function(n,i){return n.toFixed(2)+" km, "+i.toFixed(2)+" km/h"})})},get_speed_data_imp:function(){var t=this;return this._info.speed._points.map(function(e){return t._prepare_data_point(e,t.m_to_mi,t.ms_to_mih,function(n,i){return n.toFixed(2)+" mi, "+i.toFixed(2)+" mi/h"})})},get_speed_max:function(){return this.m_to_km(this._info.speed.max)*3600},get_speed_max_imp:function(){return this.to_miles(this.get_speed_max())},get_average_hr:function(){return this._info.hr.avg},get_average_temp:function(){return this._info.atemp.avg},get_average_cadence:function(){return this._info.cad.avg},get_heartrate_data:function(){var t=this;return this._info.hr._points.map(function(e){return t._prepare_data_point(e,t.m_to_km,null,function(n,i){return n.toFixed(2)+" km, "+i.toFixed(0)+" bpm"})})},get_heartrate_data_imp:function(){var t=this;return this._info.hr._points.map(function(e){return t._prepare_data_point(e,t.m_to_mi,null,function(n,i){return n.toFixed(2)+" mi, "+i.toFixed(0)+" bpm"})})},get_cadence_data:function(){var t=this;return this._info.cad._points.map(function(e){return t._prepare_data_point(e,t.m_to_km,null,function(n,i){return n.toFixed(2)+" km, "+i.toFixed(0)+" rpm"})})},get_temp_data:function(){var t=this;return this._info.atemp._points.map(function(e){return t._prepare_data_point(e,t.m_to_km,null,function(n,i){return n.toFixed(2)+" km, "+i.toFixed(0)+" degrees"})})},get_cadence_data_imp:function(){var t=this;return this._info.cad._points.map(function(e){return t._prepare_data_point(e,t.m_to_mi,null,function(n,i){return n.toFixed(2)+" mi, "+i.toFixed(0)+" rpm"})})},get_temp_data_imp:function(){var t=this;return this._info.atemp._points.map(function(e){return t._prepare_data_point(e,t.m_to_mi,null,function(n,i){return n.toFixed(2)+" mi, "+i.toFixed(0)+" degrees"})})},reload:function(){this._init_info(),this.clearLayers(),this._parse(this._gpx,this.options,this.options.async)},_merge_objs:function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n},_prepare_data_point:function(t,e,n,i){var a=[e&&e(t[0])||t[0],n&&n(t[1])||t[1]];return a.push(i&&i(a[0],a[1])||a[0]+": "+a[1]),a},_init_info:function(){this._info={name:null,length:0,elevation:{gain:0,loss:0,max:0,min:1/0,_points:[]},speed:{max:0,_points:[]},hr:{avg:0,_total:0,_points:[]},duration:{start:null,end:null,moving:0,total:0},atemp:{avg:0,_total:0,_points:[]},cad:{avg:0,_total:0,_points:[]}}},_load_xml:function(t,e,n,i){i==null&&(i=this.options.async),n==null&&(n=this.options);var a=new window.XMLHttpRequest;a.open("GET",t,i);try{a.overrideMimeType("text/xml")}catch{}a.onreadystatechange=function(){a.readyState==4&&a.status==200&&e(a.responseXML,n)},a.send(null)},_parse:function(t,e,n){var i=this,a=function(h,f){var l=i._parse_gpx_data(h,f);if(!l){i.fire("error",{err:"No parseable layers of type(s) "+JSON.stringify(f.gpx_options.parseElements)});return}i.addLayer(l),i.fire("loaded",{layers:l,element:h})};if(t.substr(0,1)==="<"){var r=new DOMParser;n?setTimeout(function(){a(r.parseFromString(t,"text/xml"),e)}):a(r.parseFromString(t,"text/xml"),e)}else this._load_xml(t,a,e,n)},_parse_gpx_data:function(t,e){var n,i,a=[],r=t.getElementsByTagName("name");r.length>0&&(this._info.name=r[0].textContent);var h=t.getElementsByTagName("desc");h.length>0&&(this._info.desc=h[0].textContent);var f=t.getElementsByTagName("author");f.length>0&&(this._info.author=f[0].textContent);var l=t.getElementsByTagName("copyright");l.length>0&&(this._info.copyright=l[0].textContent);var m=e.gpx_options.parseElements;if(m.indexOf("route")>-1){var s=t.getElementsByTagName("rte");for(n=0;n<s.length;n++)a=a.concat(this._parse_segment(s[n],e,{},"rtept"))}if(m.indexOf("track")>-1){var o=t.getElementsByTagName("trk");for(n=0;n<o.length;n++){var p=o[n],T=this._extract_styling(p);if(e.gpx_options.joinTrackSegments)a=a.concat(this._parse_segment(p,e,T,"trkpt"));else{var E=p.getElementsByTagName("trkseg");for(c=0;c<E.length;c++)a=a.concat(this._parse_segment(E[c],e,T,"trkpt"))}}}if(this._info.hr.avg=Math.round(this._info.hr._total/this._info.hr._points.length),this._info.cad.avg=Math.round(this._info.cad._total/this._info.cad._points.length),this._info.atemp.avg=Math.round(this._info.atemp._total/this._info.atemp._points.length),m.indexOf("waypoint")>-1)for(i=t.getElementsByTagName("wpt"),n=0;n<i.length;n++){var B=new _.LatLng(i[n].getAttribute("lat"),i[n].getAttribute("lon")),y=i[n].getElementsByTagName("name"),r=y.length>0?y[0].textContent:"",d=i[n].getElementsByTagName("desc"),h=d.length>0?d[0].textContent:"",w=i[n].getElementsByTagName("sym"),g=w.length>0?w[0].textContent:null,G=i[n].getElementsByTagName("type"),v=G.length>0?G[0].textContent:null,N=e.marker_options.wptIcons,M=e.marker_options.wptIconUrls,C=e.marker_options.wptIconsType,P=e.marker_options.wptIconTypeUrls,I=e.marker_options.pointMatchers||[],u;if(N&&g&&N[g])u=N[g];else if(C&&v&&C[v])u=C[v];else if(M&&g&&M[g])u=new _.GPXTrackIcon({iconUrl:M[g]});else if(P&&v&&P[v])u=new _.GPXTrackIcon({iconUrl:P[v]});else if(I.length>0){for(var c=0;c<I.length;c++)if(I[c].regex.test(r)){u=I[c].icon;break}}else N&&N[""]?u=N[""]:M&&M[""]&&(u=new _.GPXTrackIcon({iconUrl:M[""]}));if(!u){console.log("No waypoint icon could be matched for symKey=%s,typeKey=%s,name=%s on waypoint %o",g,v,r,i[n]);continue}var U=new _.Marker(B,{clickable:e.marker_options.clickable,title:r,icon:u,type:"waypoint"});U.bindPopup("<b>"+r+"</b>"+(h.length>0?"<br>"+h:"")).openPopup(),this.fire("addpoint",{point:U,point_type:"waypoint",element:i[n]}),a.push(U)}if(a.length>1)return new _.FeatureGroup(a);if(a.length==1)return a[0]},_parse_segment:function(t,e,n,i){var a=t.getElementsByTagName(i);if(!a.length)return[];for(var r=[],h=[],f=[],l=null,m=0;m<a.length;m++){var s,o=new _.LatLng(a[m].getAttribute("lat"),a[m].getAttribute("lon"));o.meta={time:null,ele:null,hr:null,cad:null,atemp:null,speed:null},s=a[m].getElementsByTagName("time"),s.length>0?o.meta.time=new Date(Date.parse(s[0].textContent)):o.meta.time=new Date("1970-01-01T00:00:00");var p=l!=null?Math.abs(o.meta.time-l.meta.time):0;s=a[m].getElementsByTagName("ele"),s.length>0?o.meta.ele=parseFloat(s[0].textContent):o.meta.ele=l!=null?l.meta.ele:null;var T=l!=null?o.meta.ele-l.meta.ele:0,E=l!=null?this._dist3d(l,o):0;if(s=a[m].getElementsByTagName("speed"),s.length>0?o.meta.speed=parseFloat(s[0].textContent):o.meta.speed=p>0?1e3*E/p:0,s=a[m].getElementsByTagName("name"),s.length>0){for(var B=s[0].textContent,y=e.marker_options.pointMatchers||[],d=0;d<y.length;d++)if(y[d].regex.test(B)){h.push({label:B,coords:o,icon:y[d].icon,element:a[m]});break}}s=a[m].getElementsByTagNameNS("*","hr"),s.length>0&&(o.meta.hr=parseInt(s[0].textContent),this._info.hr._points.push([this._info.length,o.meta.hr]),this._info.hr._total+=o.meta.hr),s=a[m].getElementsByTagNameNS("*","cad"),s.length>0&&(o.meta.cad=parseInt(s[0].textContent),this._info.cad._points.push([this._info.length,o.meta.cad]),this._info.cad._total+=o.meta.cad),s=a[m].getElementsByTagNameNS("*","atemp"),s.length>0&&(o.meta.atemp=parseInt(s[0].textContent),this._info.atemp._points.push([this._info.length,o.meta.atemp]),this._info.atemp._total+=o.meta.atemp),o.meta.ele>this._info.elevation.max&&(this._info.elevation.max=o.meta.ele),o.meta.ele<this._info.elevation.min&&(this._info.elevation.min=o.meta.ele),this._info.elevation._points.push([this._info.length,o.meta.ele]),o.meta.speed>this._info.speed.max&&(this._info.speed.max=o.meta.speed),this._info.speed._points.push([this._info.length,o.meta.speed]),l==null&&this._info.duration.start==null&&(this._info.duration.start=o.meta.time),this._info.duration.end=o.meta.time,this._info.duration.total+=p,p<e.max_point_interval&&(this._info.duration.moving+=p),this._info.length+=E,T>0?this._info.elevation.gain+=T:this._info.elevation.loss+=Math.abs(T),l=o,r.push(o)}var w=new _.Polyline(r,this._extract_styling(t,n,e.polyline_options));if(this.fire("addline",{line:w,element:t}),f.push(w),e.marker_options.startIcon||e.marker_options.startIconUrl){var g=new _.Marker(r[0],{clickable:e.marker_options.clickable,icon:e.marker_options.startIcon||new _.GPXTrackIcon({iconUrl:e.marker_options.startIconUrl})});this.fire("addpoint",{point:g,point_type:"start",element:a[0]}),f.push(g)}if(e.marker_options.endIcon||e.marker_options.endIconUrl){var g=new _.Marker(r[r.length-1],{clickable:e.marker_options.clickable,icon:e.marker_options.endIcon||new _.GPXTrackIcon({iconUrl:e.marker_options.endIconUrl})});this.fire("addpoint",{point:g,point_type:"end",element:a[a.length-1]}),f.push(g)}for(var m=0;m<h.length;m++){var g=new _.Marker(h[m].coords,{clickable:e.marker_options.clickable,title:h[m].label,icon:h[m].icon});this.fire("addpoint",{point:g,point_type:"label",element:h[m].element}),f.push(g)}return f},_extract_styling:function(t,e,n){var i=this._merge_objs(D,e),a=t.getElementsByTagNameNS(O,"line");if(a.length>0){var r=a[0].getElementsByTagName("color");r.length>0&&(i.color="#"+r[0].textContent);var r=a[0].getElementsByTagName("opacity");r.length>0&&(i.opacity=r[0].textContent);var r=a[0].getElementsByTagName("weight");r.length>0&&(i.weight=r[0].textContent);var r=a[0].getElementsByTagName("linecap");r.length>0&&(i.lineCap=r[0].textContent);var r=a[0].getElementsByTagName("linejoin");r.length>0&&(i.lineJoin=r[0].textContent);var r=a[0].getElementsByTagName("dasharray");r.length>0&&(i.dashArray=r[0].textContent);var r=a[0].getElementsByTagName("dashoffset");r.length>0&&(i.dashOffset=r[0].textContent)}return this._merge_objs(i,n)},_dist2d:function(t,e){var n=6371e3,i=this._deg2rad(e.lat-t.lat),a=this._deg2rad(e.lng-t.lng),r=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this._deg2rad(t.lat))*Math.cos(this._deg2rad(e.lat))*Math.sin(a/2)*Math.sin(a/2),h=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),f=n*h;return f},_dist3d:function(t,e){var n=this._dist2d(t,e),i=Math.abs(e.meta.ele-t.meta.ele);return Math.sqrt(Math.pow(n,2)+Math.pow(i,2))},_deg2rad:function(t){return t*Math.PI/180}}),A.exports=_})($);const j={id:"map"},K=H({__name:"index",setup(A){let _=null;const L=()=>{_=F.map("map",{crs:F.CRS.EPSG3857,center:[42.45,-71.11],minZoom:1,maxZoom:18,zoom:15}),F.tileLayer(z,{noWrap:!0,attribution:Y}).addTo(_);const x="/gpx/fells_loop.gpx";new F.GPX(x,{async:!0,marker_options:{startIconUrl:"/image/pin-icon-start.png",endIconUrl:"/image/pin-icon-end.png",shadowUrl:"/image/pin-shadow.png",wptIconUrls:{"":"/image/pin-icon-wpt.png"}}}).on("loaded",k=>{_==null||_.fitBounds(k.target.getBounds())}).addTo(_)};return J(()=>{L()}),Z(()=>{_&&(_.remove(),_=null)}),(x,k)=>(V(),W("div",j))}});const at=Q(K,[["__scopeId","data-v-1d9c83ff"]]);export{at as default};
