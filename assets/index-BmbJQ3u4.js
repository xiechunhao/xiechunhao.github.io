import{b5 as M,o as E,c as F,w as t,b as a,u as r,d as k,cK as ae,aG as D,aI as S,aH as K,c9 as W,aC as R,aL as j,r as f,f8 as H,E as v,a as J,R as T,a8 as Q,aE as X,m as A,bE as Y,au as Z,F as G,n as te,t as oe,be as ne,e as q,aW as B,k as re,aT as se,ay as ie,j as de,g as ue,av as me,cf as pe,b6 as ce,at as ge,W as fe}from"./index-C4BxmZrN.js";import{i as _e}from"./index-CkGVv88Q.js";import{i as be}from"./index-DyKZEwup.js";import{i as ve}from"./index-BY7TmcLY.js";import{E as Ve}from"./tree-C3JkgW2I.js";import{i as ye}from"./index-BCHJo1Hi.js";import"./index-DPWieFbN.js";import"./index-Cw5RFCD5.js";import"./virtual-list-CYzSvSUd.js";import"./index-CuklncWx.js";import"./index-CL6ZmOyB.js";import{E as P,a as L}from"./col-DljvzS69.js";import{_ as xe}from"./role-select-CIII8WmI.js";import{E as he}from"./tree-select-D5LaKo_I.js";import{l as ee,u as ze,a as Ie,r as ke}from"./index-DkUqtUl3.js";import{c as we,u as Ue,a as Ne,p as Ee,r as Ce,b as $e,d as Fe}from"./index-DUSysJZb.js";import{e as Oe,p as Re}from"./validate-B_6HX0Io.js";import{E as Se}from"./input-number-B8T5Eosy.js";import{i as Te}from"./index-DSHqkOzX.js";import"./isArrayLikeObject-XYcYxEsS.js";import"./vuedraggable.umd-BuphSp9t.js";import"./index-Czf8vTYn.js";import"./index-dVmM0e8c.js";const qe={__name:"org-user-search",emits:["search"],setup(h,{expose:w,emit:y}){const g=y,[d,u]=M({username:"",nickname:"",sex:void 0}),p=()=>{g("search",{...d})},n=()=>{u(),p()};return w({resetFields:u}),(N,_)=>{const z=S,x=K,V=P,m=W,e=R,l=L,o=j;return E(),F(o,{"label-width":"72px",onKeyup:ae(p,["enter"]),onSubmit:_[3]||(_[3]=D(()=>{},["prevent"]))},{default:t(()=>[a(l,{gutter:8},{default:t(()=>[a(V,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[a(x,{label:"用户账号"},{default:t(()=>[a(z,{clearable:"",modelValue:r(d).username,"onUpdate:modelValue":_[0]||(_[0]=s=>r(d).username=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[a(x,{label:"用户名"},{default:t(()=>[a(z,{clearable:"",modelValue:r(d).nickname,"onUpdate:modelValue":_[1]||(_[1]=s=>r(d).nickname=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[a(x,{label:"性别"},{default:t(()=>[a(m,{code:"sex",modelValue:r(d).sex,"onUpdate:modelValue":_[2]||(_[2]=s=>r(d).sex=s),placeholder:"请选择"},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[a(x,{"label-width":"16px"},{default:t(()=>[a(e,{type:"primary",onClick:p},{default:t(()=>[k("查询")]),_:1}),a(e,{onClick:n},{default:t(()=>[k("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},le={__name:"org-select",props:{modelValue:[Number,String],placeholder:{type:String,default:"请选择所属机构"}},emits:["update:modelValue"],setup(h,{emit:w}){const y=w,g=f([]),d=u=>{y("update:modelValue",u)};return ee().then(u=>{g.value=H({data:u,idField:"organizationId",parentIdField:"parentId"})}).catch(u=>{v.error(u.message)}),(u,p)=>{const n=he;return E(),F(n,{clearable:"",filterable:"",data:g.value,"check-strictly":"","default-expand-all":"","node-key":"organizationId",props:{label:"organizationName"},placeholder:h.placeholder,"model-value":h.modelValue,class:"ele-fluid","onUpdate:modelValue":d},null,8,["data","placeholder","model-value"])}}},Be={__name:"org-user-edit",props:{modelValue:Boolean,data:Object,organizationId:Number},emits:["done","update:modelValue"],setup(h,{emit:w}){const y=w,g=h,d=f(!1),u=f(!1),p=f(null),[n,N,_]=M({userId:void 0,organizationId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:""}),z=J({username:[{required:!0,message:"请输入用户账号",type:"string",trigger:"blur"},{min:4,message:"账号长度最少为4位",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(m,e,l)=>{var o;we("username",e,(o=g.data)==null?void 0:o.userId).then(()=>{l(new Error("账号已经存在"))}).catch(()=>{l()})}}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"blur"}],roleIds:[{required:!0,message:"请选择角色",type:"array",trigger:"blur"}],email:[{pattern:Oe,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(m,e,l)=>{if(d.value||/^[\S]{5,18}$/.test(e))return l();l(new Error("密码必须为5-18位非空白字符"))}}],phone:[{pattern:Re,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),x=()=>{var m,e;(e=(m=p.value)==null?void 0:m.validate)==null||e.call(m,l=>{if(!l)return;u.value=!0,(d.value?Ue:Ne)(n).then(s=>{u.value=!1,v.success(s),V(!1),y("done")}).catch(s=>{u.value=!1,v.error(s.message)})})},V=m=>{y("update:modelValue",m)};return T(()=>g.modelValue,m=>{var e,l;m?g.data?(_({...g.data,password:""}),d.value=!0):(n.organizationId=g.organizationId,d.value=!1):(N(),(l=(e=p.value)==null?void 0:e.clearValidate)==null||l.call(e))}),(m,e)=>{const l=K,o=S,s=W,b=P,U=L,O=j,C=R,$=X;return E(),F($,{form:"",width:640,"model-value":h.modelValue,title:d.value?"修改用户":"新建用户","onUpdate:modelValue":V},{footer:t(()=>[a(C,{onClick:e[10]||(e[10]=c=>V(!1))},{default:t(()=>[k("取消")]),_:1}),a(C,{type:"primary",loading:u.value,onClick:x},{default:t(()=>[k(" 保存 ")]),_:1},8,["loading"])]),default:t(()=>[a(O,{ref_key:"formRef",ref:p,model:r(n),rules:z,"label-width":"80px",onSubmit:e[9]||(e[9]=D(()=>{},["prevent"]))},{default:t(()=>[a(U,{gutter:16},{default:t(()=>[a(b,{sm:12,xs:24},{default:t(()=>[a(l,{label:"所属机构"},{default:t(()=>[a(le,{modelValue:r(n).organizationId,"onUpdate:modelValue":e[0]||(e[0]=c=>r(n).organizationId=c)},null,8,["modelValue"])]),_:1}),a(l,{label:"用户账号",prop:"username"},{default:t(()=>[a(o,{clearable:"",maxlength:20,modelValue:r(n).username,"onUpdate:modelValue":e[1]||(e[1]=c=>r(n).username=c),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1}),a(l,{label:"用户名",prop:"nickname"},{default:t(()=>[a(o,{clearable:"",maxlength:20,modelValue:r(n).nickname,"onUpdate:modelValue":e[2]||(e[2]=c=>r(n).nickname=c),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(l,{label:"性别",prop:"sex"},{default:t(()=>[a(s,{code:"sex",modelValue:r(n).sex,"onUpdate:modelValue":e[3]||(e[3]=c=>r(n).sex=c),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),a(l,{label:"角色",prop:"roles"},{default:t(()=>[a(xe,{modelValue:r(n).roles,"onUpdate:modelValue":e[4]||(e[4]=c=>r(n).roles=c)},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{sm:12,xs:24},{default:t(()=>[a(l,{label:"手机号",prop:"phone"},{default:t(()=>[a(o,{clearable:"",maxlength:11,modelValue:r(n).phone,"onUpdate:modelValue":e[5]||(e[5]=c=>r(n).phone=c),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a(l,{label:"邮箱",prop:"email"},{default:t(()=>[a(o,{clearable:"",maxlength:100,modelValue:r(n).email,"onUpdate:modelValue":e[6]||(e[6]=c=>r(n).email=c),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),d.value?Q("",!0):(E(),F(l,{key:0,label:"登录密码",prop:"password"},{default:t(()=>[a(o,{"show-password":"",type:"password",maxlength:20,modelValue:r(n).password,"onUpdate:modelValue":e[7]||(e[7]=c=>r(n).password=c),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),a(l,{label:"个人简介"},{default:t(()=>[a(o,{type:"textarea",rows:3,maxlength:200,modelValue:r(n).introduction,"onUpdate:modelValue":e[8]||(e[8]=c=>r(n).introduction=c),placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}},Me=q("span",null,"更多",-1),De={__name:"org-user-list",props:{organizationId:Number},setup(h){const w=h,y=f(null),g=f(null),d=f([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"用户账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"sexName",label:"性别",sortable:"custom",width:90},{columnKey:"roles",label:"角色",minWidth:110,slot:"roles"},{prop:"createTime",label:"创建时间",sortable:"custom",minWidth:110},{prop:"status",label:"状态",width:90,align:"center",sortable:"custom",slot:"status"},{columnKey:"action",label:"操作",width:128,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),u=f([]),p=f(null),n=f(!1),N=({pages:e,where:l,orders:o})=>Ee({...l,...o,...e,organizationId:w.organizationId}),_=e=>{var l,o;(o=(l=g.value)==null?void 0:l.reload)==null||o.call(l,{page:1,where:e})},z=e=>{p.value=e!=null?e:null,n.value=!0},x=e=>{const l=e==null?u.value:[e];if(!l.length){v.error("请至少选择一条数据");return}B.confirm("确定要删除“"+l.map(o=>o.nickname).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const o=v.loading("请求中..");Ce(l.map(s=>s.userId)).then(s=>{o.close(),v.success(s),_()}).catch(s=>{o.close(),v.error(s.message)})}).catch(()=>{})},V=(e,l)=>{const o=e?0:1;$e(l.userId,o).then(s=>{l.status=o,v.success(s)}).catch(s=>{v.error(s.message)})},m=(e,l)=>{e==="password"?B.prompt(`请输入用户"${l.nickname}"的新密码：`,"重置密码",{inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",draggable:!0}).then(({value:o})=>{const s=v.loading("请求中..");Fe(l.userId,o).then(b=>{s.close(),v.success(b)}).catch(b=>{s.close(),v.error(b.message)})}).catch(()=>{}):e==="delete"&&x(l)};return T(()=>w.organizationId,()=>{var e,l;(l=(e=y.value)==null?void 0:e.resetFields)==null||l.call(e),_({})}),(e,l)=>{const o=R,s=re,b=se,U=ie,O=de,C=ue,$=me,c=ye;return E(),A(G,null,[a(qe,{ref_key:"searchRef",ref:y,style:{"margin-bottom":"-14px"},onSearch:_},null,512),a(c,{ref_key:"tableRef",ref:g,"row-key":"userId",columns:d.value,datasource:N,"show-overflow-tooltip":!0,selections:u.value,"onUpdate:selections":l[2]||(l[2]=i=>u.value=i),"highlight-current-row":!0,"export-config":{fileName:"用户数据"},"footer-style":{paddingBottom:"16px"},"cache-key":"systemOrgUserTable"},{toolbar:t(()=>[a(o,{type:"primary",class:"ele-btn-icon",icon:r(Y),onClick:l[0]||(l[0]=i=>z())},{default:t(()=>[k(" 新建 ")]),_:1},8,["icon"]),a(o,{type:"danger",class:"ele-btn-icon",icon:r(Z),onClick:l[1]||(l[1]=i=>x())},{default:t(()=>[k(" 删除 ")]),_:1},8,["icon"])]),roles:t(({row:i})=>[(E(!0),A(G,null,te(i.roles,I=>(E(),F(s,{key:I.roleId,size:"small","disable-transitions":!0},{default:t(()=>[k(oe(I.roleName),1)]),_:2},1024))),128))]),status:t(({row:i})=>[a(b,{size:"small","model-value":i.status===0,onChange:I=>V(I,i)},null,8,["model-value","onChange"])]),action:t(({row:i})=>[a(U,{type:"primary",underline:!1,onClick:I=>z(i)},{default:t(()=>[k(" 修改 ")]),_:2},1032,["onClick"]),a(O,{direction:"vertical"}),a($,{items:[{title:"重置密码",command:"password"},{title:"删除用户",command:"delete",danger:!0}],style:{display:"inline"},onCommand:I=>m(I,i)},{default:t(()=>[a(U,{type:"primary",underline:!1},{default:t(()=>[Me,a(C,{size:12,style:{"vertical-align":"-1px","margin-left":"2px"}},{default:t(()=>[a(r(ne))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1},8,["columns","selections"]),a(Be,{data:p.value,modelValue:n.value,"onUpdate:modelValue":l[3]||(l[3]=i=>n.value=i),"organization-id":h.organizationId,onDone:_},null,8,["data","modelValue","organization-id"])],64)}}},Ke={__name:"org-edit",props:{modelValue:Boolean,data:Object,organizationId:Number},emits:["done","update:modelValue"],setup(h,{emit:w}){const y=w,g=h,d=f(!1),u=f(!1),p=f(null),[n,N,_]=M({organizationId:void 0,parentId:void 0,organizationName:"",organizationFullName:"",organizationCode:"",organizationType:void 0,sortNumber:void 0,comments:""}),z=J({organizationName:[{required:!0,message:"请输入机构名称",type:"string",trigger:"blur"}],organizationFullName:[{required:!0,message:"请输入机构全称",type:"string",trigger:"blur"}],organizationType:[{required:!0,message:"请选择机构类型",type:"string",trigger:"blur"}],sortNumber:[{required:!0,message:"请输入排序号",type:"number",trigger:"blur"}]}),x=()=>{var m,e;(e=(m=p.value)==null?void 0:m.validate)==null||e.call(m,l=>{if(!l)return;u.value=!0,(d.value?ze:Ie)({...n,parentId:n.parentId||0}).then(s=>{u.value=!1,v.success(s),V(!1),y("done")}).catch(s=>{u.value=!1,v.error(s.message)})})},V=m=>{y("update:modelValue",m)};return T(()=>g.modelValue,m=>{var e,l;m?g.data?(_({...g.data,parentId:g.data.parentId||void 0}),d.value=!0):(n.parentId=g.organizationId,d.value=!1):(N(),(l=(e=p.value)==null?void 0:e.clearValidate)==null||l.call(e))}),(m,e)=>{const l=K,o=S,s=P,b=W,U=Se,O=L,C=j,$=R,c=X;return E(),F(c,{form:"",width:620,"model-value":h.modelValue,title:d.value?"修改机构":"添加机构","onUpdate:modelValue":V},{footer:t(()=>[a($,{onClick:e[8]||(e[8]=i=>V(!1))},{default:t(()=>[k("取消")]),_:1}),a($,{type:"primary",loading:u.value,onClick:x},{default:t(()=>[k(" 保存 ")]),_:1},8,["loading"])]),default:t(()=>[a(C,{ref_key:"formRef",ref:p,model:r(n),rules:z,"label-width":"80px",onSubmit:e[7]||(e[7]=D(()=>{},["prevent"]))},{default:t(()=>[a(O,{gutter:16},{default:t(()=>[a(s,{sm:12,xs:24},{default:t(()=>[a(l,{label:"上级机构",prop:"parentId"},{default:t(()=>[a(le,{modelValue:r(n).parentId,"onUpdate:modelValue":e[0]||(e[0]=i=>r(n).parentId=i),placeholder:"请选择上级机构"},null,8,["modelValue"])]),_:1}),a(l,{label:"机构名称",prop:"organizationName"},{default:t(()=>[a(o,{clearable:"",maxlength:20,modelValue:r(n).organizationName,"onUpdate:modelValue":e[1]||(e[1]=i=>r(n).organizationName=i),placeholder:"请输入机构名称"},null,8,["modelValue"])]),_:1}),a(l,{label:"机构全称",prop:"organizationFullName"},{default:t(()=>[a(o,{clearable:"",maxlength:100,modelValue:r(n).organizationFullName,"onUpdate:modelValue":e[2]||(e[2]=i=>r(n).organizationFullName=i),placeholder:"请输入机构全称"},null,8,["modelValue"])]),_:1}),a(l,{label:"机构代码"},{default:t(()=>[a(o,{clearable:"",maxlength:20,modelValue:r(n).organizationCode,"onUpdate:modelValue":e[3]||(e[3]=i=>r(n).organizationCode=i),placeholder:"请输入机构代码"},null,8,["modelValue"])]),_:1})]),_:1}),a(s,{sm:12,xs:24},{default:t(()=>[a(l,{label:"机构类型",prop:"organizationType"},{default:t(()=>[a(b,{code:"organization_type",modelValue:r(n).organizationType,"onUpdate:modelValue":e[4]||(e[4]=i=>r(n).organizationType=i),placeholder:"请选择机构类型"},null,8,["modelValue"])]),_:1}),a(l,{label:"排序号",prop:"sortNumber"},{default:t(()=>[a(U,{min:0,max:99999,modelValue:r(n).sortNumber,"onUpdate:modelValue":e[5]||(e[5]=i=>r(n).sortNumber=i),placeholder:"请输入排序号","controls-position":"right",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),a(l,{label:"备注"},{default:t(()=>[a(o,{rows:3,type:"textarea",maxlength:200,modelValue:r(n).comments,"onUpdate:modelValue":e[6]||(e[6]=i=>r(n).comments=i),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}},We={style:{padding:"0 16px 12px 0"}},je={style:{"margin-bottom":"12px"}},Pe={name:"SystemOrganization"},gl=Object.assign(Pe,{setup(h){const{mobile:w}=pe(),y=f(null),g=f(null),d=f(!0),u=f([]),p=f(null),n=f(""),N=f(!1),_=f(null),z=()=>{d.value=!0,ee().then(l=>{d.value=!1,u.value=H({data:l,idField:"organizationId",parentIdField:"parentId"}),fe(()=>{x(u.value[0])})}).catch(l=>{d.value=!1,v.error(l.message)})},x=l=>{var o,s,b,U;p.value!=null&&w.value&&((s=(o=y.value)==null?void 0:o.toggleCollapse)==null||s.call(o,!0)),l&&l.organizationId?(p.value=l,(U=(b=g.value)==null?void 0:b.setCurrentKey)==null||U.call(b,l.organizationId)):p.value=null},V=l=>{_.value=l!=null?l:null,N.value=!0},m=()=>{const l=p.value;l&&B.confirm(`确定要删除“${l.organizationName}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const o=v.loading("请求中..");ke(l.organizationId).then(s=>{o.close(),v.success(s),z()}).catch(s=>{o.close(),v.error(s.message)})}).catch(()=>{})},e=(l,o)=>l?!!(o.organizationName&&o.organizationName.includes(l)):!0;return T(n,l=>{var o,s;(s=(o=g.value)==null?void 0:o.filter)==null||s.call(o,l)}),z(),(l,o)=>{const s=S,b=R,U=Ve,O=ve,C=be,$=_e,c=Te;return E(),F(c,{"flex-table":"","multi-card":!1,"hide-footer":"",style:{"min-height":"420px"}},{default:t(()=>{var i;return[a($,{"flex-table":"","body-style":{padding:"0 0 0 16px",overflow:"hidden"}},{default:t(()=>[a(C,{ref_key:"splitRef",ref:y,"flex-table":"",size:"256px","allow-collapse":"","custom-style":{borderWidth:"0 1px 0 0",padding:"16px 0"},"body-style":{padding:"16px 16px 0 0",overflow:"hidden"},style:{height:"100%",overflow:"visible"}},{body:t(()=>[p.value?(E(),F(De,{key:0,"organization-id":p.value.organizationId},null,8,["organization-id"])):Q("",!0)]),default:t(()=>[q("div",We,[a(s,{clearable:"",maxlength:20,modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=I=>n.value=I),placeholder:"输入机构名称搜索","prefix-icon":r(ce)},null,8,["modelValue","prefix-icon"])]),q("div",je,[a(b,{type:"primary",class:"ele-btn-icon",icon:r(Y),onClick:o[1]||(o[1]=I=>V())},{default:t(()=>[k(" 新建 ")]),_:1},8,["icon"]),a(b,{type:"warning",disabled:!p.value,class:"ele-btn-icon",icon:r(ge),onClick:o[2]||(o[2]=I=>V(p.value))},{default:t(()=>[k(" 修改 ")]),_:1},8,["disabled","icon"]),a(b,{type:"danger",disabled:!p.value,class:"ele-btn-icon",icon:r(Z),onClick:m},{default:t(()=>[k(" 删除 ")]),_:1},8,["disabled","icon"])]),a(O,{loading:d.value,style:{flex:1,paddingRight:"16px",overflow:"auto"}},{default:t(()=>[a(U,{ref_key:"treeRef",ref:g,data:u.value,"highlight-current":"","node-key":"organizationId",props:{label:"organizationName"},"expand-on-click-node":!1,"default-expand-all":!0,"filter-node-method":e,style:{"--ele-tree-item-height":"34px"},onNodeClick:x},null,8,["data"])]),_:1},8,["loading"])]),_:1},512)]),_:1}),a(Ke,{modelValue:N.value,"onUpdate:modelValue":o[3]||(o[3]=I=>N.value=I),data:_.value,"organization-id":(i=p.value)==null?void 0:i.organizationId,onDone:z},null,8,["modelValue","data","organization-id"])]}),_:1})}}});export{gl as default};
