import{A as O,M as S}from"./chunks/index.a511ac44.js";import{T as w}from"./chunks/TileImage.70f39159.js";import{X as q}from"./chunks/XYZ.94b2552a.js";import{bS as I,E as P,M as B,_ as g,bT as N,bU as z,cc as b,r as k,$ as W,bW as m,V,cd as E,U,aZ as G,ce as X,a3 as Z,cf as j,cb as H,cg as Y,c4 as K,bV as x,bR as $}from"./chunks/reproj.9b488601.js";import{O as J}from"./chunks/Overlay.99996f63.js";import{O as Q}from"./chunks/OSM.3419e003.js";import{d as ss,p as ns,a4 as as,o as M,c as R,_ as ls,G as os,z as A,a as ps,O as es}from"./chunks/framework.57763b9a.js";const u=.75,d=.1;class ts extends I{constructor(s){s=s||{},super({element:document.createElement("div"),render:s.render,target:s.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=s.collapsed!==void 0?s.collapsed:!0,this.collapsible_=s.collapsible!==void 0?s.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=s.rotateWithView!==void 0?s.rotateWithView:!1,this.viewExtent_=void 0;const n=s.className!==void 0?s.className:"ol-overviewmap",a=s.tipLabel!==void 0?s.tipLabel:"Overview map",p=s.collapseLabel!==void 0?s.collapseLabel:"‹";typeof p=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=p):this.collapseLabel_=p;const l=s.label!==void 0?s.label:"›";typeof l=="string"?(this.label_=document.createElement("span"),this.label_.textContent=l):this.label_=l;const t=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,e=document.createElement("button");e.setAttribute("type","button"),e.title=a,e.appendChild(t),e.addEventListener(P.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=s.view;const o=new B({view:s.view,controls:new g,interactions:new g});this.ovmap_=o,s.layers&&s.layers.forEach(function(F){o.addLayer(F)});const r=document.createElement("div");r.className="ol-overviewmap-box",r.style.boxSizing="border-box",this.boxOverlay_=new J({position:[0,0],positioning:"center-center",element:r}),this.ovmap_.addOverlay(this.boxOverlay_);const D=n+" "+N+" "+z+(this.collapsed_&&this.collapsible_?" "+b:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=D,c.appendChild(this.ovmapDiv_),c.appendChild(e);const y=this,i=this.boxOverlay_,C=this.boxOverlay_.getElement(),T=function(F){return{clientX:F.clientX,clientY:F.clientY}},v=function(F){const h=T(F),L=o.getEventCoordinateInternal(h);i.setPosition(L)},f=function(F){const h=o.getEventCoordinateInternal(F);y.getMap().getView().setCenterInternal(h),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",f)};C.addEventListener("mousedown",function(){window.addEventListener("mousemove",v),window.addEventListener("mouseup",f)})}setMap(s){const n=this.getMap();if(s!==n){if(n){const a=n.getView();a&&this.unbindView_(a),this.ovmap_.setTarget(null)}if(super.setMap(s),s){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(k(s,W.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const a=s.getView();a&&(this.bindView_(a),a.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(s){if(s.key===m.VIEW){const n=s.oldValue;n&&this.unbindView_(n);const a=this.getMap().getView();this.bindView_(a)}else!this.ovmap_.isRendered()&&(s.key===m.TARGET||s.key===m.SIZE)&&this.ovmap_.updateSize()}bindView_(s){if(!this.view_){const n=new V({projection:s.getProjection()});this.ovmap_.setView(n)}s.addChangeListener(E.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()}unbindView_(s){s.removeChangeListener(E.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const s=this.getMap(),n=this.ovmap_;if(!s.isRendered()||!n.isRendered())return;const a=s.getSize(),l=s.getView().calculateExtentInternal(a);if(this.viewExtent_&&U(l,this.viewExtent_))return;this.viewExtent_=l;const t=n.getSize(),o=n.getView().calculateExtentInternal(t),r=n.getPixelFromCoordinateInternal(G(l)),D=n.getPixelFromCoordinateInternal(X(l)),c=Math.abs(r[0]-D[0]),y=Math.abs(r[1]-D[1]),i=t[0],C=t[1];c<i*d||y<C*d||c>i*u||y>C*u?this.resetExtent_():Z(o,l)||this.recenter_()}resetExtent_(){const s=this.getMap(),n=this.ovmap_,a=s.getSize(),l=s.getView().calculateExtentInternal(a),t=n.getView(),e=Math.log(u/d)/Math.LN2,o=1/(Math.pow(2,e/2)*d);j(l,o),t.fitInternal(H(l))}recenter_(){const s=this.getMap(),n=this.ovmap_,a=s.getView();n.getView().setCenterInternal(a.getCenterInternal())}updateBox_(){const s=this.getMap(),n=this.ovmap_;if(!s.isRendered()||!n.isRendered())return;const a=s.getSize(),p=s.getView(),l=n.getView(),t=this.rotateWithView_?0:-p.getRotation(),e=this.boxOverlay_,o=this.boxOverlay_.getElement(),r=p.getCenterInternal(),D=p.getResolution(),c=l.getResolution(),y=a[0]*D/c,i=a[1]*D/c;if(e.setPosition(r),o){o.style.width=y+"px",o.style.height=i+"px";const C="rotate("+t+"rad)";o.style.transform=C}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=Y(this.ovmap_,K.POSTRENDER,function(s){delete this.ovmapPostrenderKey_,this.updateBox_()},this))}handleClick_(s){s.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(b),this.collapsed_?x(this.collapseLabel_,this.label_):x(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const s=this.ovmap_;if(!this.collapsed_){if(s.isRendered()){this.viewExtent_=void 0,s.render();return}s.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(s){this.collapsible_!==s&&(this.collapsible_=s,this.element.classList.toggle("ol-uncollapsible"),!s&&this.collapsed_&&this.handleToggle_())}setCollapsed(s){!this.collapsible_||this.collapsed_===s||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(s){this.rotateWithView_!==s&&(this.rotateWithView_=s,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(s){this.validateExtent_(),this.updateBox_()}}const cs=ts,rs={id:"map"},Fs=ss({__name:"index",setup(_){const s=new w({source:new q({attributions:O,url:S,maxZoom:20})});let n=null;const a=()=>{n=new B({target:"map",layers:[s],view:new V({projection:"EPSG:4326",center:[0,0],zoom:5}),controls:$().extend([new cs({className:"ol-overviewmap ol-custom-overviewmap",layers:[new w({source:new Q({url:"https://{a-c}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=0e6fc415256d4fbb9b5166a718591d71"})})],collapseLabel:"»",label:"«",collapsed:!1})])})};return ns(()=>{a()}),as(()=>{n&&(n.dispose(),n=null)}),(p,l)=>(M(),R("div",rs))}});const Ds=ls(Fs,[["__scopeId","data-v-610db781"]]),ys=A("h1",{id:"鹰眼控件",tabindex:"-1"},[ps("鹰眼控件 "),A("a",{class:"header-anchor",href:"#鹰眼控件","aria-label":'Permalink to "鹰眼控件"'},"​")],-1),is=A("div",{class:"tip custom-block"},[A("p",{class:"custom-block-title"},"TIP"),A("p",null,"在地图右上角添加鹰眼控件。")],-1),Cs=es("",2),ws=JSON.parse('{"title":"鹰眼控件","description":"","frontmatter":{},"headers":[],"relativePath":"open-layers/map-controls/overview-map/index.md","filePath":"open-layers/map-controls/overview-map/index.md","lastUpdated":1687662745000}'),As={name:"open-layers/map-controls/overview-map/index.md"},gs=Object.assign(As,{setup(_){return(s,n)=>(M(),R("div",null,[ys,is,os(Ds),Cs]))}});export{ws as __pageData,gs as default};
