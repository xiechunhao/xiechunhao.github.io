import{aN as M,aM as P,r as g,b5 as N,a as T,R as Y,o as _,c as v,w as n,b as r,u as a,a8 as B,d as x,aG as O,E as w,aI as $,aH as S,c9 as j,aC as G,aL as H}from"./index-C4BxmZrN.js";import{E as L}from"./date-picker-wyenFiKS.js";import{_ as z}from"./role-select-CIII8WmI.js";import{c as A,u as J,a as K}from"./index-DUSysJZb.js";import{e as Q,p as W}from"./validate-B_6HX0Io.js";const re={__name:"edit-form",props:{data:Object},setup(y){const p=y,{currentRoute:c,push:h}=M(),{removePageTab:V,reloadPageTab:U}=P(),d=g(!1),i=g(!1),f=g(null),[l,k,E]=N({userId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:""}),R=T({username:[{required:!0,type:"string",trigger:"blur",validator:(u,e,o)=>{var s;if(!e)return o(new Error("请输入用户账号"));A("username",e,(s=p.data)==null?void 0:s.userId).then(()=>{o(new Error("账号已经存在"))}).catch(()=>{o()})}}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",type:"array",trigger:"blur"}],email:[{pattern:Q,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,type:"string",trigger:"blur",validator:(u,e,o)=>{if(d.value||/^[\S]{5,18}$/.test(e))return o();o(new Error("密码必须为5-18位非空白字符"))}}],phone:[{pattern:W,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),C=()=>{var u,e;(e=(u=f.value)==null?void 0:u.validate)==null||e.call(u,o=>{if(!o)return;i.value=!0,(d.value?J:K)(l).then(m=>{i.value=!1,w.success(m),D()}).catch(m=>{i.value=!1,w.error(m.message)})})},q=()=>{V({key:a(c).path}),h("/list/basic")},D=()=>{V({key:a(c).path}),U({fullPath:"/list/basic"})};return Y(()=>p.data,()=>{var u,e;p.data?(E({...p.data,password:""}),d.value=!0):(d.value=!1,k(),(e=(u=f.value)==null?void 0:u.clearValidate)==null||e.call(u))},{immediate:!0}),(u,e)=>{const o=$,s=S,m=j,F=L,b=G,I=H;return _(),v(I,{ref_key:"formRef",ref:f,model:a(l),rules:R,"label-width":"80px",style:{"max-width":"600px",margin:"10px auto"},onSubmit:e[9]||(e[9]=O(()=>{},["prevent"]))},{default:n(()=>[r(s,{label:"用户账号",prop:"username"},{default:n(()=>[r(o,{clearable:"",maxlength:20,modelValue:a(l).username,"onUpdate:modelValue":e[0]||(e[0]=t=>a(l).username=t),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1}),r(s,{label:"用户名",prop:"nickname"},{default:n(()=>[r(o,{clearable:"",maxlength:20,modelValue:a(l).nickname,"onUpdate:modelValue":e[1]||(e[1]=t=>a(l).nickname=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),r(s,{label:"性别",prop:"sex"},{default:n(()=>[r(m,{code:"sex",modelValue:a(l).sex,"onUpdate:modelValue":e[2]||(e[2]=t=>a(l).sex=t),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),r(s,{label:"角色",prop:"roles"},{default:n(()=>[r(z,{modelValue:a(l).roles,"onUpdate:modelValue":e[3]||(e[3]=t=>a(l).roles=t)},null,8,["modelValue"])]),_:1}),r(s,{label:"邮箱",prop:"email"},{default:n(()=>[r(o,{clearable:"",maxlength:100,modelValue:a(l).email,"onUpdate:modelValue":e[4]||(e[4]=t=>a(l).email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),r(s,{label:"手机号",prop:"phone"},{default:n(()=>[r(o,{clearable:"",maxlength:11,modelValue:a(l).phone,"onUpdate:modelValue":e[5]||(e[5]=t=>a(l).phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),r(s,{label:"出生日期"},{default:n(()=>[r(F,{modelValue:a(l).birthday,"onUpdate:modelValue":e[6]||(e[6]=t=>a(l).birthday=t),"value-format":"YYYY-MM-DD",placeholder:"请选择出生日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),d.value?B("",!0):(_(),v(s,{key:0,label:"登录密码",prop:"password"},{default:n(()=>[r(o,{"show-password":"",type:"password",maxlength:20,modelValue:a(l).password,"onUpdate:modelValue":e[7]||(e[7]=t=>a(l).password=t),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),r(s,{label:"个人简介"},{default:n(()=>[r(o,{type:"textarea",rows:4,modelValue:a(l).introduction,"onUpdate:modelValue":e[8]||(e[8]=t=>a(l).introduction=t),maxlength:200,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1}),r(s,null,{default:n(()=>[r(b,{onClick:q},{default:n(()=>[x("关闭")]),_:1}),r(b,{type:"primary",loading:i.value,onClick:C},{default:n(()=>[x(" 保存 ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}};export{re as _};
