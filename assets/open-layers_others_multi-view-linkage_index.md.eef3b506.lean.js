import{A as K}from"./chunks/index.47495de9.js";import{aK as cs,aX as x,am as Y,aY as fs,aZ as ie,aE as ce,aB as ue,Z as ds,a_ as os,aC as ye,a$ as Cs,_ as Fe,aD as As,E as q,b0 as De,aI as vs,b1 as us,b2 as he,ao as fe,k as ss,b3 as de,b4 as Ce,b5 as Ts,b6 as Ae,b7 as Te,m as Is,aq as Ee,ar as Es,e as _e,b8 as ge,b9 as Re,ba as me,bb as xe,M as _s,V as be,B as gs}from"./chunks/reproj.50e0d4ab.js";import{a as we,I as $s,R as ys,g as rs,b as Se,c as Rs,L as Ne,B as Oe,T as ms}from"./chunks/TileImage.36abd4f0.js";import{X as J}from"./chunks/XYZ.eaf43adc.js";import{F as xs}from"./chunks/FullScreen.9a3e590b.js";import{W as Ls,A as ve,S as Us,a as Ie,c as $e,E as Le,f as Ue,b as Be}from"./chunks/Layer.3fa5ba05.js";import{d as Me,p as Ge,a3 as Pe,o as Bs,c as Ms,M as Xe,N as ze,z as P,_ as je,G as qe,a as Ye,O as He}from"./chunks/framework.166469be.js";class We{constructor(s,n){this.name=s,this.data=n,this.texture_=null}getTexture(s){if(!this.texture_){const n=s.createTexture();s.bindTexture(s.TEXTURE_2D,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.data.length/4,1,0,s.RGBA,s.UNSIGNED_BYTE,this.data),this.texture_=n}return this.texture_}}const ke=We;function es(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?e:null}function ps(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof DataView?e:null}let z=null;function Ve(e){z||(z=cs(e.width,e.height,void 0,{willReadFrequently:!0}));const s=z.canvas,n=e.width;s.width!==n&&(s.width=n);const t=e.height;return s.height!==t&&(s.height=t),z.clearRect(0,0,n,t),z.drawImage(e,0,0),z.getImageData(0,0,n,t).data}const Ze=[256,256];class Ke extends we{constructor(s){const n=x.IDLE;super(s.tileCoord,n,{transition:s.transition,interpolate:s.interpolate}),this.loader_=s.loader,this.data_=null,this.error_=null,this.size_=s.size||null}getSize(){if(this.size_)return this.size_;const s=es(this.data_);return s?[s.width,s.height]:Ze}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==x.IDLE&&this.state!==x.ERROR)return;this.state=x.LOADING,this.changed();const s=this;this.loader_().then(function(n){s.data_=n,s.state=x.LOADED,s.changed()}).catch(function(n){s.error_=n,s.state=x.ERROR,s.changed()})}}const Gs=Ke;class Je extends Gs{constructor(s){super({tileCoord:s.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:s.interpolate,transition:s.transition}),this.pixelRatio_=s.pixelRatio,this.gutter_=s.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=s.sourceTileGrid,this.targetTileGrid_=s.targetTileGrid,this.wrappedTileCoord_=s.wrappedTileCoord||s.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const n=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),t=this.targetTileGrid_.getExtent();let o=this.sourceTileGrid_.getExtent();const a=t?Y(n,t):n;if(fs(a)===0){this.state=x.EMPTY;return}const l=s.sourceProj,c=l.getExtent();c&&(o?o=Y(o,c):o=c);const y=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),u=s.targetProj,p=ie(l,u,a,y);if(!isFinite(p)||p<=0){this.state=x.EMPTY;return}const i=s.errorThreshold!==void 0?s.errorThreshold:ce;if(this.triangulation_=new ue(l,u,a,o,p*i,y),this.triangulation_.getTriangles().length===0){this.state=x.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(p);let h=this.triangulation_.calculateSourceExtent();if(o&&(l.canWrapX()?(h[1]=ds(h[1],o[1],o[3]),h[3]=ds(h[3],o[1],o[3])):h=Y(h,o)),!fs(h))this.state=x.EMPTY;else{const D=this.sourceTileGrid_.getTileRangeForExtentAndZ(h,this.sourceZ_),C=s.getTileFunction;for(let b=D.minX;b<=D.maxX;b++)for(let g=D.minY;g<=D.maxY;g++){const w=C(this.sourceZ_,b,g,this.pixelRatio_);w&&this.sourceTiles_.push(w)}this.sourceTiles_.length===0&&(this.state=x.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const s=[];if(this.sourceTiles_.forEach(n=>{if(!n||n.getState()!==x.LOADED)return;const t=n.getSize(),o=this.gutter_;let a;const l=ps(n.getData());l?a=l:a=Ve(es(n.getData()));const c=[t[0]+2*o,t[1]+2*o],y=a instanceof Float32Array,u=c[0]*c[1],p=y?Float32Array:Uint8Array,i=new p(a.buffer),h=p.BYTES_PER_ELEMENT,D=h*i.length/u,C=i.byteLength/c[1],b=Math.floor(C/h/c[0]),g=u*b;let w=i;if(i.length!==g){w=new p(g);let T=0,R=0;const E=c[0]*b;for(let _=0;_<c[1];++_){for(let A=0;A<E;++A)w[T++]=i[R+A];R+=C/h}}s.push({extent:this.sourceTileGrid_.getTileCoordExtent(n.tileCoord),data:new Uint8Array(w.buffer),dataType:p,bytesPerPixel:D,pixelSize:c})}),this.sourceTiles_.length=0,s.length===0)this.state=x.ERROR;else{const n=this.wrappedTileCoord_[0],t=this.targetTileGrid_.getTileSize(n),o=typeof t=="number"?t:t[0],a=typeof t=="number"?t:t[1],l=this.targetTileGrid_.getResolution(n),c=this.sourceTileGrid_.getResolution(this.sourceZ_),y=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let u,p;const i=s[0].bytesPerPixel,h=Math.ceil(i/3);for(let D=h-1;D>=0;--D){const C=[];for(let E=0,_=s.length;E<_;++E){const A=s[E],m=A.data,S=A.pixelSize,U=S[0],v=S[1],G=cs(U,v,os),H=G.createImageData(U,v),B=H.data;let $=D*3;for(let M=0,ts=B.length;M<ts;M+=4)B[M]=m[$],B[M+1]=m[$+1],B[M+2]=m[$+2],B[M+3]=255,$+=i;G.putImageData(H,0,0),C.push({extent:A.extent,image:G.canvas})}const b=ye(o,a,this.pixelRatio_,c,this.sourceTileGrid_.getExtent(),l,y,this.triangulation_,C,this.gutter_,!1,!1);for(let E=0,_=C.length;E<_;++E){const m=C[E].image.getContext("2d");Cs(m),os.push(m.canvas)}const g=b.getContext("2d"),w=g.getImageData(0,0,b.width,b.height);Cs(g),os.push(b),u||(p=new Uint8Array(i*w.width*w.height),u=new s[0].dataType(p.buffer));const T=w.data;let R=D*3;for(let E=0,_=T.length;E<_;E+=4)T[E+3]===255?(p[R]=T[E],p[R+1]=T[E+1],p[R+2]=T[E+2]):(p[R]=0,p[R+1]=0,p[R+2]=0),R+=i}this.reprojData_=u,this.reprojSize_=[Math.round(o*this.pixelRatio_),Math.round(a*this.pixelRatio_)],this.state=x.LOADED}this.changed()}load(){if(this.state!==x.IDLE&&this.state!==x.ERROR)return;this.state=x.LOADING,this.changed();let s=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(n=>{const t=n.getState();if(t!==x.IDLE&&t!==x.LOADING)return;s++;const o=Fe(n,q.CHANGE,function(){const a=n.getState();(a==x.LOADED||a==x.ERROR||a==x.EMPTY)&&(As(o),s--,s===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}),s===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(n){n.getState()==x.IDLE&&n.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(As),this.sourcesListenerKeys_=null}}const Ps=Je;class Qe extends De{constructor(s){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=s.gutter||0,this.helper_=s.helper,this.loaded=!1,this.ready=!1}setTile(s){if(s!==this.tile)if(this.tile&&this.tile.removeEventListener(q.CHANGE,this.handleTileChange_),this.tile=s,this.loaded=s.getState()===x.LOADED,this.loaded)this.uploadTile();else{if(s instanceof $s){const n=s.getImage();n instanceof Image&&!n.crossOrigin&&(n.crossOrigin="anonymous")}s.addEventListener(q.CHANGE,this.handleTileChange_)}}uploadTile(){vs()}setReady(){this.ready=!0,this.dispatchEvent(q.CHANGE)}handleTileChange_(){this.tile.getState()===x.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(q.CHANGE,this.handleTileChange_)}}const sn=Qe;function Xs(e,s,n){const t=n?e.LINEAR:e.NEAREST;e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t)}function en(e,s,n,t){Xs(e,s,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)}function bs(e,s,n,t,o,a){const l=e.getGL();let c,y;n instanceof Float32Array?(c=l.FLOAT,e.getExtension("OES_texture_float"),y=e.getExtension("OES_texture_float_linear")!==null):(c=l.UNSIGNED_BYTE,y=!0),Xs(l,s,a&&y);const u=n.byteLength/t[1];let p=1;u%8===0?p=8:u%4===0?p=4:u%2===0&&(p=2);let i;switch(o){case 1:{i=l.LUMINANCE;break}case 2:{i=l.LUMINANCE_ALPHA;break}case 3:{i=l.RGB;break}case 4:{i=l.RGBA;break}default:throw new Error(`Unsupported number of bands: ${o}`)}const h=l.getParameter(l.UNPACK_ALIGNMENT);l.pixelStorei(l.UNPACK_ALIGNMENT,p),l.texImage2D(l.TEXTURE_2D,0,i,t[0],t[1],0,i,c,n),l.pixelStorei(l.UNPACK_ALIGNMENT,h)}let j=null;function nn(){j=cs(1,1,void 0,{willReadFrequently:!0})}class tn extends sn{constructor(s){super(s),this.textures=[],this.renderSize_=us(s.grid.getTileSize(s.tile.tileCoord[0])),this.bandCount=NaN;const n=new Ls(ve,Us);n.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(n),this.coords=n,this.setTile(s.tile)}uploadTile(){const s=this.helper_,n=s.getGL(),t=this.tile;this.textures.length=0;let o;t instanceof $s||t instanceof ys?o=t.getImage():o=t.getData();const a=es(o);if(a){const T=n.createTexture();this.textures.push(T),this.bandCount=4,en(n,T,a,t.interpolate),this.setReady();return}o=ps(o);const l=t.getSize(),c=[l[0]+2*this.gutter_,l[1]+2*this.gutter_],y=o instanceof Float32Array,u=c[0]*c[1],p=y?Float32Array:Uint8Array,i=p.BYTES_PER_ELEMENT,h=o.byteLength/c[1];this.bandCount=Math.floor(h/i/c[0]);const D=Math.ceil(this.bandCount/4);if(D===1){const T=n.createTexture();this.textures.push(T),bs(s,T,o,c,this.bandCount,t.interpolate),this.setReady();return}const C=new Array(D);for(let T=0;T<D;++T){const R=n.createTexture();this.textures.push(R);const E=T<D-1?4:(this.bandCount-1)%4+1;C[T]=new p(u*E)}let b=0,g=0;const w=c[0]*this.bandCount;for(let T=0;T<c[1];++T){for(let R=0;R<w;++R){const E=o[g+R],_=Math.floor(b/this.bandCount),A=R%this.bandCount,m=Math.floor(A/4),S=C[m],U=S.length/u,v=A%4;S[_*U+v]=E,++b}g+=h/i}for(let T=0;T<D;++T){const R=this.textures[T],E=C[T],_=E.length/u;bs(s,R,E,c,_,t.interpolate)}this.setReady()}disposeInternal(){const s=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let n=0;n<this.textures.length;++n)s.deleteTexture(this.textures[n]);this.tile.removeEventListener(q.CHANGE,this.handleTileChange_)}getImagePixelData_(s,n,t){const o=this.gutter_,a=this.renderSize_[0],l=this.renderSize_[1];j||nn(),j.clearRect(0,0,1,1);const c=s.width,y=s.height,u=c-2*o,p=y-2*o,i=o+Math.floor(u*(n/a)),h=o+Math.floor(p*(t/l));let D;try{j.drawImage(s,i,h,1,1,0,0,1,1),D=j.getImageData(0,0,1,1).data}catch{return j=null,null}return D}getArrayPixelData_(s,n,t,o){const a=this.gutter_,l=this.renderSize_[0],c=this.renderSize_[1],y=n[0],u=n[1],p=y+2*a,i=u+2*a,h=a+Math.floor(y*(t/l)),D=a+Math.floor(u*(o/c));if(s instanceof DataView){const b=s.byteLength/(p*i),g=b*(D*p+h),w=s.buffer.slice(g,g+b);return new DataView(w)}const C=this.bandCount*(D*p+h);return s.slice(C,C+this.bandCount)}getPixelData(s,n){if(!this.loaded)return null;if(this.tile instanceof Gs){const t=this.tile.getData(),o=ps(t);if(o){const a=this.tile.getSize();return this.getArrayPixelData_(o,a,s,n)}return this.getImagePixelData_(es(t),s,n)}return this.getImagePixelData_(this.tile.getImage(),s,n)}}const on=tn,an={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},ln={};function rn(e){return 2*(1-1/(e+1))-1}function pn(){return{tileIds:new Set,representationsByZ:{}}}function ws(e,s){return e.tileIds.has(ss(s))}function Ss(e,s,n){const t=e.representationsByZ;n in t||(t[n]=new Set),t[n].add(s),e.tileIds.add(ss(s.tile))}function as(e,s){const n=e.layerStatesArray[e.layerIndex];n.extent&&(s=Y(s,Is(n.extent,e.viewState.projection)));const t=n.layer.getRenderSource();if(!t.getWrapX()){const o=t.getTileGridForProjection(e.viewState.projection).getExtent();o&&(s=Y(s,o))}return s}function is(e,s){return`${e.getKey()},${rs(s)}`}class cn extends Ie{constructor(s,n){super(s,{uniforms:n.uniforms,postProcesses:n.postProcesses}),this.renderComplete=!1,this.tileTransform_=he(),this.tempMat4=$e(),this.tempTileRange_=new Se(0,0,0,0),this.tempTileCoord_=Rs(0,0,0),this.tempSize_=[0,0];const t=n.cacheSize!==void 0?n.cacheSize:512;this.tileRepresentationCache=new Ne(t),this.frameState=null,this.projection_=void 0}reset(s){super.reset({uniforms:s.uniforms})}isDrawableTile_(s){const n=this.getLayer(),t=s.getState(),o=n.getUseInterimTilesOnError();return t==x.LOADED||t==x.EMPTY||t==x.ERROR&&!o}prepareFrameInternal(s){this.projection_?s.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=s.viewState.projection):this.projection_=s.viewState.projection;const t=this.getLayer().getRenderSource();return!t||fe(as(s,s.extent))?!1:t.getState()==="ready"}createTileRepresentation(s){return vs()}enqueueTiles(s,n,t,o,a){const l=s.viewState,c=this.getLayer(),y=c.getRenderSource(),u=y.getTileGridForProjection(l.projection),p=y.getGutterForProjection(l.projection),i=ss(y);i in s.wantedTiles||(s.wantedTiles[i]={});const h=s.wantedTiles[i],D=this.tileRepresentationCache,C=c.getMapInternal(),b=Math.max(t-a,u.getMinZoom(),u.getZForResolution(Math.min(c.getMaxResolution(),C?C.getView().getResolutionForZoom(Math.max(c.getMinZoom(),0)):u.getResolution(0)),y.zDirection));for(let g=t;g>=b;--g){const w=u.getTileRangeForExtentAndZ(n,g,this.tempTileRange_),T=u.getResolution(g);for(let R=w.minX;R<=w.maxX;++R)for(let E=w.minY;E<=w.maxY;++E){const _=Rs(g,R,E,this.tempTileCoord_),A=is(y,_);let m,S;if(D.containsKey(A)&&(m=D.get(A),S=m.tile),(!m||m.tile.key!==y.getKey())&&(S=y.getTile(g,R,E,s.pixelRatio,l.projection)),ws(o,S))continue;if(!m)m=this.createTileRepresentation({tile:S,grid:u,helper:this.helper,gutter:p}),D.set(A,m);else if(this.isDrawableTile_(S))m.setTile(S);else{const v=S.getInterimTile();m.setTile(v)}Ss(o,m,g);const U=S.getKey();h[U]=!0,S.getState()===x.IDLE&&(s.tileQueue.isKeyQueued(U)||s.tileQueue.enqueue([S,i,u.getTileCoordCenter(_),T]))}}}beforeTilesRender(s,n){this.helper.prepareDraw(this.frameState,!n)}renderTile(s,n,t,o,a,l,c,y,u,p,i){}renderFrame(s){this.frameState=s,this.renderComplete=!0;const n=this.helper.getGL();this.preRender(n,s);const t=s.viewState,o=this.getLayer(),a=o.getRenderSource(),l=a.getTileGridForProjection(t.projection),c=a.getGutterForProjection(t.projection),y=as(s,s.extent),u=l.getZForResolution(t.resolution,a.zDirection),p=pn(),i=o.getPreload();if(s.nextExtent){const _=l.getZForResolution(t.nextResolution,a.zDirection),A=as(s,s.nextExtent);this.enqueueTiles(s,A,_,p,i)}this.enqueueTiles(s,y,u,p,0),i>0&&setTimeout(()=>{this.enqueueTiles(s,y,u-1,p,i-1)},0);const h={},D=ss(this),C=s.time;let b=!1;for(const _ of p.representationsByZ[u]){const A=_.tile;if((A instanceof ys||A instanceof Ps)&&A.getState()===x.EMPTY)continue;const m=A.tileCoord;if(_.loaded){const v=A.getAlpha(D,C);if(v===1){A.endTransition(D);continue}b=!0;const G=rs(m);h[G]=v}if(this.renderComplete=!1,this.findAltTiles_(l,m,u+1,p))continue;const U=l.getMinZoom();for(let v=u-1;v>=U&&!this.findAltTiles_(l,m,v,p);--v);}this.beforeTilesRender(s,b);const g=p.representationsByZ,w=Object.keys(g).map(Number).sort(de);for(let _=0,A=w.length;_<A;++_){const m=w[_];for(const S of g[m]){if(!S.loaded)continue;const v=S.tile.tileCoord,G=rs(v),H=G in h?h[G]:1;H<1&&(s.animate=!0);const B=l.getResolution(m),$=us(l.getTileSize(m),this.tempSize_),M=l.getOrigin(m),ts=l.getTileCoordExtent(v),ee=rn(m),V=s.viewState,ne=V.center[0],te=V.center[1],Z=$[0]+2*c,Ds=$[1]+2*c,oe=Z/Ds,ae=(ne-M[0])/($[0]*B),le=(M[1]-te)/($[1]*B),hs=V.resolution/B,re=v[1],pe=v[2];Ce(this.tileTransform_),Ts(this.tileTransform_,2/(s.size[0]*hs/Z),-2/(s.size[1]*hs/Z)),Ae(this.tileTransform_,V.rotation),Ts(this.tileTransform_,1,1/oe),Te(this.tileTransform_,($[0]*(re-ae)-c)/Z,($[1]*(pe-le)-c)/Ds),this.renderTile(S,this.tileTransform_,s,y,B,$,M,ts,ee,c,H)}}this.helper.finalizeDraw(s,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const T=this.helper.getCanvas(),R=this.tileRepresentationCache;for(;R.canExpireCache();)R.pop().dispose();const E=function(_,A){a.updateCacheSize(.1,A.viewState.projection),a.expireCache(A.viewState.projection,ln)};return s.postRenderFunctions.push(E),this.postRender(n,s),T}findAltTiles_(s,n,t,o){const a=s.getTileRangeForTileCoordAndZ(n,t,this.tempTileRange_);if(!a)return!1;let l=!0;const c=this.tileRepresentationCache,y=this.getLayer().getRenderSource();for(let u=a.minX;u<=a.maxX;++u)for(let p=a.minY;p<=a.maxY;++p){const i=is(y,[t,u,p]);let h=!1;if(c.containsKey(i)){const D=c.get(i);D.loaded&&!ws(o,D.tile)&&(Ss(o,D,t),h=!0)}h||(l=!1)}return l}clearCache(){const s=this.tileRepresentationCache;s.forEach(n=>n.dispose()),s.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const un=cn,f={...an,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Q={TEXTURE_COORD:"a_textureCoord"},yn=[{name:Q.TEXTURE_COORD,size:2,type:Be.FLOAT}];class Fn extends un{constructor(s,n){super(s,n),this.program_,this.vertexShader_=n.vertexShader,this.fragmentShader_=n.fragmentShader,this.indices_=new Ls(Le,Us),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=n.paletteTextures||[]}reset(s){super.reset(s),this.vertexShader_=s.vertexShader,this.fragmentShader_=s.fragmentShader,this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(s){return new on(s)}beforeTilesRender(s,n){super.beforeTilesRender(s,n),this.helper.useProgram(this.program_,s)}renderTile(s,n,t,o,a,l,c,y,u,p,i){const h=this.helper.getGL();this.helper.bindBuffer(s.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(yn);let D=0;for(;D<s.textures.length;){const A=`${f.TILE_TEXTURE_ARRAY}[${D}]`;this.helper.bindTexture(s.textures[D],D,A),++D}for(let A=0;A<this.paletteTextures_.length;++A){const m=this.paletteTextures_[A],S=m.getTexture(h);this.helper.bindTexture(S,D,m.name),++D}const C=t.viewState,b=l[0]+2*p,g=l[1]+2*p,T=s.tile.tileCoord,R=T[1],E=T[2];this.helper.setUniformMatrixValue(f.TILE_TRANSFORM,Ue(this.tempMat4,n)),this.helper.setUniformFloatValue(f.TRANSITION_ALPHA,i),this.helper.setUniformFloatValue(f.DEPTH,u);let _=o;p>0&&(_=y,Y(_,o,_)),this.helper.setUniformFloatVec4(f.RENDER_EXTENT,_),this.helper.setUniformFloatValue(f.RESOLUTION,C.resolution),this.helper.setUniformFloatValue(f.ZOOM,C.zoom),this.helper.setUniformFloatValue(f.TEXTURE_PIXEL_WIDTH,b),this.helper.setUniformFloatValue(f.TEXTURE_PIXEL_HEIGHT,g),this.helper.setUniformFloatValue(f.TEXTURE_RESOLUTION,a),this.helper.setUniformFloatValue(f.TEXTURE_ORIGIN_X,c[0]+R*l[0]*a-p*a),this.helper.setUniformFloatValue(f.TEXTURE_ORIGIN_Y,c[1]-E*l[1]*a+p*a),this.helper.drawElements(0,this.indices_.getSize())}getData(s){if(!this.helper.getGL())return null;const t=this.frameState;if(!t)return null;const o=this.getLayer(),a=Ee(t.pixelToCoordinateTransform,s.slice()),l=t.viewState,c=o.getExtent();if(c&&!Es(Is(c,l.projection),a))return null;const y=o.getSources(_e([a]),l.resolution);let u,p,i;for(u=y.length-1;u>=0;--u)if(p=y[u],p.getState()==="ready"){if(i=p.getTileGridForProjection(l.projection),p.getWrapX())break;const D=i.getExtent();if(!D||Es(D,a))break}if(u<0)return null;const h=this.tileRepresentationCache;for(let D=i.getZForResolution(l.resolution);D>=i.getMinZoom();--D){const C=i.getTileCoordForCoordAndZ(a,D),b=is(p,C);if(!h.containsKey(b))continue;const g=h.get(b),w=g.tile;if((w instanceof ys||w instanceof Ps)&&w.getState()===x.EMPTY)return null;if(!g.loaded)continue;const T=i.getOrigin(D),R=us(i.getTileSize(D)),E=i.getResolution(D),_=(a[0]-T[0])/E-C[1]*R[0],A=(T[1]-a[1])/E-C[2]*R[1];return g.getPixelData(_,A)}return null}disposeInternal(){const s=this.helper;s&&(s.getGL().deleteProgram(this.program_),delete this.program_,s.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}const Dn=Fn,r={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0};function hn(e){switch(e){case"string":return r.STRING;case"color":return r.COLOR;case"number":return r.NUMBER;case"boolean":return r.BOOLEAN;case"number[]":return r.NUMBER_ARRAY;default:throw new Error(`Unrecognized type hint: ${e}`)}}const d={};function I(e){if(typeof e=="number")return r.NUMBER;if(typeof e=="boolean")return r.BOOLEAN;if(typeof e=="string")return Re(e)?r.COLOR|r.STRING:r.STRING;if(!Array.isArray(e))throw new Error(`Unhandled value type: ${JSON.stringify(e)}`);const s=e;if(s.every(function(o){return typeof o=="number"}))return s.length===3||s.length===4?r.COLOR|r.NUMBER_ARRAY:r.NUMBER_ARRAY;if(typeof s[0]!="string")throw new Error(`Expected an expression operator but received: ${JSON.stringify(s)}`);const t=d[s[0]];if(t===void 0)throw new Error(`Unrecognized expression operator: ${JSON.stringify(s)}`);return t.getReturnType(s.slice(1))}function fn(e){return Math.log2(e)%1===0}function X(e){const s=[];return(e&r.NUMBER)>0&&s.push("number"),(e&r.COLOR)>0&&s.push("color"),(e&r.BOOLEAN)>0&&s.push("boolean"),(e&r.NUMBER_ARRAY)>0&&s.push("number[]"),(e&r.STRING)>0&&s.push("string"),s.length>0?s.join(", "):"(no type)"}function ns(e){const s=e.toString();return s.includes(".")?s:s+".0"}function zs(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map(ns).join(", ")})`}function dn(e){const s=me(e),n=s.length>3?s[3]:1;return zs([s[0]/255*n,s[1]/255*n,s[2]/255*n,n])}function js(e,s){return e.stringLiteralsMap[s]===void 0&&(e.stringLiteralsMap[s]=Object.keys(e.stringLiteralsMap).length),e.stringLiteralsMap[s]}function Cn(e,s){return ns(js(e,s))}function F(e,s,n){const t=n!==void 0?n:r.NUMBER;if(Array.isArray(s)&&typeof s[0]=="string"){const a=d[s[0]];if(a===void 0)throw new Error(`Unrecognized expression operator: ${JSON.stringify(s)}`);return a.toGlsl(e,s.slice(1),t)}const o=I(s)&t;if(Ws(s,o,""),(o&r.NUMBER)>0)return ns(s);if((o&r.BOOLEAN)>0)return s.toString();if((o&r.STRING)>0)return Cn(e,s.toString());if((o&r.COLOR)>0)return dn(s);if((o&r.NUMBER_ARRAY)>0)return zs(s);throw new Error(`Unexpected expression ${s} (expected type ${X(t)})`)}function qs(e){if(!(I(e)&r.NUMBER))throw new Error(`A numeric value was expected, got ${JSON.stringify(e)} instead`)}function O(e){for(let s=0;s<e.length;s++)qs(e[s])}function Ys(e){if(!(I(e)&r.STRING))throw new Error(`A string value was expected, got ${JSON.stringify(e)} instead`)}function Fs(e){if(!(I(e)&r.BOOLEAN))throw new Error(`A boolean value was expected, got ${JSON.stringify(e)} instead`)}function N(e,s){if(e.length!==s)throw new Error(`Exactly ${s} arguments were expected, got ${e.length} instead`)}function L(e,s){if(e.length<s)throw new Error(`At least ${s} arguments were expected, got ${e.length} instead`)}function W(e,s){if(e.length>s)throw new Error(`At most ${s} arguments were expected, got ${e.length} instead`)}function Hs(e){if(e.length%2!==0)throw new Error(`An even amount of arguments was expected, got ${JSON.stringify(e)} instead`)}function An(e){if(e.length%2===0)throw new Error(`An odd amount of arguments was expected, got ${JSON.stringify(e)} instead`)}function Ws(e,s,n){if(s===r.NONE)throw new Error(`No matching type was found for the following expression ${n}: ${JSON.stringify(e)}`)}function k(e,s,n){if(Ws(e,s,n),!fn(s))throw new Error(`Expected to have a unique type for the following expression ${n}: ${JSON.stringify(e)}
Got the following types instead: ${X(s)}`)}function ks(e,s,n,t){if((s&n)===r.NONE)throw new Error(`Expected the ${t} type of the following expression: ${JSON.stringify(e)} to be of the following types: ${X(n)}
Got these types instead: ${X(s)}`)}d.get={getReturnType:function(e){if(e.length===2){const s=e[1];return hn(s)}return r.ANY},toGlsl:function(e,s,n){L(s,1),W(s,2),Ys(s[0]);const t=n&d.get.getReturnType(s);k(["get",...s],t,"");const o=s[0].toString(),a=e.attributes.find(c=>c.name===o);if(!a)e.attributes.push({name:o,type:t});else if(t!==a.type)throw new Error(`The following attribute was used in different places with incompatible types: ${o}
Types were: ${X(a.type)} and ${X(t)}`);return(e.inFragmentShader?"v_":"a_")+o}};function Vs(e){return"u_var_"+e}d.var={getReturnType:function(){return r.ANY},toGlsl:function(e,s,n){N(s,1),Ys(s[0]);const t=s[0].toString();if(!e.style.variables||e.style.variables[t]===void 0)throw new Error(`The following variable is missing from the style: ${t}`);const o=e.style.variables[t],a=n&I(o);k(["var",...s],a,"");const l=e.variables.find(c=>c.name===t);if(!l)e.variables.push({name:t,type:a});else if(a!==l.type)throw new Error(`The following variable was used in different places with incompatible types: ${t}
Types were: ${X(l.type)} and ${X(a)}`);return Vs(t)}};const Zs="u_paletteTextures";d.palette={getReturnType:function(){return r.COLOR},toGlsl:function(e,s){N(s,2),qs(s[0]);const n=F(e,s[0]),t=s[1];if(!Array.isArray(t))throw new Error("The second argument of palette must be an array");const o=t.length,a=new Uint8Array(o*4);for(let y=0;y<o;y++){const u=t[y];let p;if(typeof u=="string")p=ge(u);else{if(!Array.isArray(u))throw new Error("The second argument of palette must be an array of strings or colors");const h=u.length;if(h===4)p=u;else{if(h!==3)throw new Error(`Expected palette color to have 3 or 4 values, got ${h}`);p=[u[0],u[1],u[2],1]}}const i=y*4;a[i]=p[0],a[i+1]=p[1],a[i+2]=p[2],a[i+3]=p[3]*255}e.paletteTextures||(e.paletteTextures=[]);const l=`${Zs}[${e.paletteTextures.length}]`,c=new ke(l,a);return e.paletteTextures.push(c),`texture2D(${l}, vec2((${n} + 0.5) / ${o}.0, 0.5))`}};const ls="getBandValue";d.band={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){L(s,1),W(s,3);const n=s[0];if(!(ls in e.functions)){let l="";const c=e.bandCount||1;for(let y=0;y<c;y++){const u=Math.floor(y/4);let p=y%4;y===c-1&&p===1&&(p=3);const i=`${f.TILE_TEXTURE_ARRAY}[${u}]`;l+=`
          if (band == ${y+1}.0) {
            return texture2D(${i}, v_textureCoord + vec2(dx, dy))[${p}];
          }
        `}e.functions[ls]=`
        float getBandValue(float band, float xOffset, float yOffset) {
          float dx = xOffset / ${f.TEXTURE_PIXEL_WIDTH};
          float dy = yOffset / ${f.TEXTURE_PIXEL_HEIGHT};
          ${l}
        }
      `}const t=F(e,n),o=F(e,s[1]||0),a=F(e,s[2]||0);return`${ls}(${t}, ${o}, ${a})`}};d.time={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,0),"u_time"}};d.zoom={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,0),"u_zoom"}};d.resolution={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,0),"u_resolution"}};d["*"]={getReturnType:function(e){let s=r.NUMBER|r.COLOR;for(let n=0;n<e.length;n++)s=s&I(e[n]);return s},toGlsl:function(e,s,n){L(s,2);let t=n;for(let o=0;o<s.length;o++)t=t&I(s[o]);return ks(s,t,r.NUMBER|r.COLOR,"output"),`(${s.map(o=>F(e,o,t)).join(" * ")})`}};d["/"]={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,2),O(s),`(${F(e,s[0])} / ${F(e,s[1])})`}};d["+"]={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return L(s,2),O(s),`(${s.map(n=>F(e,n)).join(" + ")})`}};d["-"]={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,2),O(s),`(${F(e,s[0])} - ${F(e,s[1])})`}};d.clamp={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){N(s,3),O(s);const n=F(e,s[1]),t=F(e,s[2]);return`clamp(${F(e,s[0])}, ${n}, ${t})`}};d["%"]={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,2),O(s),`mod(${F(e,s[0])}, ${F(e,s[1])})`}};d["^"]={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,2),O(s),`pow(${F(e,s[0])}, ${F(e,s[1])})`}};d.abs={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,1),O(s),`abs(${F(e,s[0])})`}};d.floor={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,1),O(s),`floor(${F(e,s[0])})`}};d.round={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,1),O(s),`floor(${F(e,s[0])} + 0.5)`}};d.ceil={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,1),O(s),`ceil(${F(e,s[0])})`}};d.sin={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,1),O(s),`sin(${F(e,s[0])})`}};d.cos={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return N(s,1),O(s),`cos(${F(e,s[0])})`}};d.atan={getReturnType:function(){return r.NUMBER},toGlsl:function(e,s){return L(s,1),W(s,2),O(s),s.length===2?`atan(${F(e,s[0])}, ${F(e,s[1])})`:`atan(${F(e,s[0])})`}};d[">"]={getReturnType:function(){return r.BOOLEAN},toGlsl:function(e,s){return N(s,2),O(s),`(${F(e,s[0])} > ${F(e,s[1])})`}};d[">="]={getReturnType:function(){return r.BOOLEAN},toGlsl:function(e,s){return N(s,2),O(s),`(${F(e,s[0])} >= ${F(e,s[1])})`}};d["<"]={getReturnType:function(){return r.BOOLEAN},toGlsl:function(e,s){return N(s,2),O(s),`(${F(e,s[0])} < ${F(e,s[1])})`}};d["<="]={getReturnType:function(){return r.BOOLEAN},toGlsl:function(e,s){return N(s,2),O(s),`(${F(e,s[0])} <= ${F(e,s[1])})`}};function Ks(e){return{getReturnType:function(){return r.BOOLEAN},toGlsl:function(s,n){N(n,2);let t=r.ANY;for(let o=0;o<n.length;o++)t&=I(n[o]);if(t===r.NONE)throw new Error(`All arguments should be of compatible type, got ${JSON.stringify(n)} instead`);return t&=~r.COLOR,`(${F(s,n[0],t)} ${e} ${F(s,n[1],t)})`}}}d["=="]=Ks("==");d["!="]=Ks("!=");d["!"]={getReturnType:function(){return r.BOOLEAN},toGlsl:function(e,s){return N(s,1),Fs(s[0]),`(!${F(e,s[0],r.BOOLEAN)})`}};function Js(e){return{getReturnType:function(){return r.BOOLEAN},toGlsl:function(s,n){L(n,2);for(let o=0;o<n.length;o++)Fs(n[o]);let t=n.map(o=>F(s,o,r.BOOLEAN)).join(` ${e} `);return t=`(${t})`,t}}}d.all=Js("&&");d.any=Js("||");d.between={getReturnType:function(){return r.BOOLEAN},toGlsl:function(e,s){N(s,3),O(s);const n=F(e,s[1]),t=F(e,s[2]),o=F(e,s[0]);return`(${o} >= ${n} && ${o} <= ${t})`}};d.array={getReturnType:function(){return r.NUMBER_ARRAY},toGlsl:function(e,s){L(s,2),W(s,4),O(s);const n=s.map(function(t){return F(e,t)});return`vec${s.length}(${n.join(", ")})`}};d.color={getReturnType:function(){return r.COLOR},toGlsl:function(e,s){L(s,3),W(s,4),O(s);const n=s.slice(0,3).map(o=>`${F(e,o)} / 255.0`);return s.length===3?`vec4(${n.join(", ")}, 1.0)`:`(${F(e,s[3])} * vec4(${n.join(", ")}, 1.0))`}};d.interpolate={getReturnType:function(e){let s=r.COLOR|r.NUMBER;for(let n=3;n<e.length;n+=2)s=s&I(e[n]);return s},toGlsl:function(e,s,n){Hs(s),L(s,6);const t=s[0];let o;switch(t[0]){case"linear":o=1;break;case"exponential":o=t[1];break;default:o=null}if(!o)throw new Error(`Invalid interpolation type for "interpolate" operator, received: ${JSON.stringify(t)}`);const a=r.NUMBER,l=d.interpolate.getReturnType(s)&n;k(["interpolate",...s],l,"output");const c=F(e,s[1],a),y=ns(o);let u="";for(let p=2;p<s.length-2;p+=2){const i=F(e,s[p],a),h=u||F(e,s[p+1],l),D=F(e,s[p+2],a),C=F(e,s[p+3],l);u=`mix(${h}, ${C}, pow(clamp((${c} - ${i}) / (${D} - ${i}), 0.0, 1.0), ${y}))`}return u}};d.match={getReturnType:function(e){let s=r.ANY;for(let n=2;n<e.length;n+=2)s=s&I(e[n]);return s=s&I(e[e.length-1]),s},toGlsl:function(e,s,n){Hs(s),L(s,4);let t=I(s[0]);for(let y=1;y<s.length-1;y+=2)t=t&I(s[y]);ks(["match",...s],t,r.STRING|r.NUMBER|r.BOOLEAN,"input"),t=(r.STRING|r.NUMBER|r.BOOLEAN)&t;const o=d.match.getReturnType(s)&n;k(["match",...s],o,"output");const a=F(e,s[0],t),l=F(e,s[s.length-1],o);let c=null;for(let y=s.length-3;y>=1;y-=2){const u=F(e,s[y],t),p=F(e,s[y+1],o);c=`(${a} == ${u} ? ${p} : ${c||l})`}return c}};d.case={getReturnType:function(e){let s=r.ANY;for(let n=1;n<e.length;n+=2)s=s&I(e[n]);return s=s&I(e[e.length-1]),s},toGlsl:function(e,s,n){An(s),L(s,3);const t=d.case.getReturnType(s)&n;k(["case",...s],t,"output");for(let l=0;l<s.length-1;l+=2)Fs(s[l]);const o=F(e,s[s.length-1],t);let a=null;for(let l=s.length-3;l>=0;l-=2){const c=F(e,s[l],r.BOOLEAN),y=F(e,s[l+1],t);a=`(${c} ? ${y} : ${a||o})`}return a}};function Ns(e,s){const n=`
    attribute vec2 ${Q.TEXTURE_COORD};
    uniform mat4 ${f.TILE_TRANSFORM};
    uniform float ${f.TEXTURE_PIXEL_WIDTH};
    uniform float ${f.TEXTURE_PIXEL_HEIGHT};
    uniform float ${f.TEXTURE_RESOLUTION};
    uniform float ${f.TEXTURE_ORIGIN_X};
    uniform float ${f.TEXTURE_ORIGIN_Y};
    uniform float ${f.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Q.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${f.TEXTURE_ORIGIN_X} + ${f.TEXTURE_RESOLUTION} * ${f.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${f.TEXTURE_ORIGIN_Y} - ${f.TEXTURE_RESOLUTION} * ${f.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${f.TILE_TRANSFORM} * vec4(${Q.TEXTURE_COORD}, ${f.DEPTH}, 1.0);
    }
  `,t={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},functions:{},bandCount:s,style:e},o=[];if(e.color!==void 0){const i=F(t,e.color,r.COLOR);o.push(`color = ${i};`)}if(e.contrast!==void 0){const i=F(t,e.contrast,r.NUMBER);o.push(`color.rgb = clamp((${i} + 1.0) * color.rgb - (${i} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(e.exposure!==void 0){const i=F(t,e.exposure,r.NUMBER);o.push(`color.rgb = clamp((${i} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(e.saturation!==void 0){const i=F(t,e.saturation,r.NUMBER);o.push(`
      float saturation = ${i} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(e.gamma!==void 0){const i=F(t,e.gamma,r.NUMBER);o.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${i}));`)}if(e.brightness!==void 0){const i=F(t,e.brightness,r.NUMBER);o.push(`color.rgb = clamp(color.rgb + ${i}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const a={},l=t.variables.length;if(l>1&&!e.variables)throw new Error(`Missing variables in style (expected ${t.variables})`);for(let i=0;i<l;++i){const h=t.variables[i];if(!(h.name in e.variables))throw new Error(`Missing '${h.name}' in style variables`);const D=Vs(h.name);a[D]=function(){let C=e.variables[h.name];return typeof C=="string"&&(C=js(t,C)),C!==void 0?C:-9999999}}const c=Object.keys(a).map(function(i){return`uniform float ${i};`}),y=Math.ceil(s/4);c.push(`uniform sampler2D ${f.TILE_TEXTURE_ARRAY}[${y}];`),t.paletteTextures&&c.push(`uniform sampler2D ${Zs}[${t.paletteTextures.length}];`);const u=Object.keys(t.functions).map(function(i){return t.functions[i]}),p=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${f.RENDER_EXTENT};
    uniform float ${f.TRANSITION_ALPHA};
    uniform float ${f.TEXTURE_PIXEL_WIDTH};
    uniform float ${f.TEXTURE_PIXEL_HEIGHT};
    uniform float ${f.RESOLUTION};
    uniform float ${f.ZOOM};

    ${c.join(`
`)}

    ${u.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${f.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${f.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${f.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${f.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${f.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${o.join(`
`)}

      if (color.a == 0.0) {
        discard;
      }

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${f.TRANSITION_ALPHA};
    }`;return{vertexShader:n,fragmentShader:p,uniforms:a,paletteTextures:t.paletteTextures}}class Qs extends Oe{constructor(s){s=s?Object.assign({},s):{};const n=s.style||{};delete s.style;const t=s.cacheSize;delete s.cacheSize,super(s),this.sources_=s.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=n,this.cacheSize_=t,this.styleVariables_=this.style_.variables||{},this.addChangeListener(xe.SOURCE,this.handleSourceUpdate_)}getSources(s,n){const t=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(s,n):this.sources_:t?[t]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const s=this.getRenderSource();return s?s.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const s=Number.MAX_SAFE_INTEGER,n=this.getSources([-s,-s,s,s],s);return n&&n.length&&"bandCount"in n[0]?n[0].bandCount:4}createRenderer(){const s=Ns(this.style_,this.getSourceBandCount_());return new Dn(this,{vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,uniforms:s.uniforms,cacheSize:this.cacheSize_,paletteTextures:s.paletteTextures})}renderSources(s,n){const t=this.getRenderer();let o;for(let a=0,l=n.length;a<l;++a)this.renderedSource_=n[a],t.prepareFrame(s)&&(o=t.renderFrame(s));return o}render(s,n){this.rendered=!0;const t=s.viewState,o=this.getSources(s.extent,t.resolution);let a=!0;for(let c=0,y=o.length;c<y;++c){const u=o[c],p=u.getState();if(p=="loading"){const i=()=>{u.getState()=="ready"&&(u.removeEventListener("change",i),this.changed())};u.addEventListener("change",i)}a=a&&p=="ready"}const l=this.renderSources(s,o);if(this.getRenderer().renderComplete&&a)return this.renderedResolution_=t.resolution,l;if(this.renderedResolution_>.5*t.resolution){const c=this.getSources(s.extent,this.renderedResolution_).filter(y=>!o.includes(y));if(c.length>0)return this.renderSources(s,c)}return l}setStyle(s){this.styleVariables_=s.variables||{},this.style_=s;const n=Ns(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms}),this.changed()}updateStyleVariables(s){Object.assign(this.styleVariables_,s),this.changed()}}Qs.prototype.dispose;const Os=Qs,se=e=>(Xe("data-v-fa4250d0"),e=e(),ze(),e),Tn={class:"mapBox"},En=se(()=>P("div",{class:"map",id:"canvasMap"},[P("div",{class:"title"},"Canvas")],-1)),_n=se(()=>P("div",{class:"map",id:"webglMap"},[P("div",{class:"title"},"WebGL")],-1)),gn=[En,_n],Rn=Me({__name:"index",setup(e){let s=null,n=null;const t=()=>{s=new _s({layers:[new ms({source:new J({attributions:K,url:"http://t0.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=3bc6874f2b919aa581635abab7759a3f",wrapX:!1})}),new ms({source:new J({attributions:K,url:"http://t0.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=3bc6874f2b919aa581635abab7759a3f",wrapX:!1})})],target:"canvasMap",view:new be({center:[12723048,3575638],minZoom:2,zoom:6}),controls:gs().extend([new xs])}),n=new _s({layers:[new Os({source:new J({attributions:K,url:"http://t0.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=3bc6874f2b919aa581635abab7759a3f",crossOrigin:"anonymous",wrapX:!1})}),new Os({source:new J({attributions:K,url:"http://t0.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=3bc6874f2b919aa581635abab7759a3f",crossOrigin:"anonymous",wrapX:!1})})],target:"webglMap",view:s.getView(),controls:gs().extend([new xs])})};return Ge(()=>{t()}),Pe(()=>{s&&(s.dispose(),s=null),n&&(n.dispose(),n=null)}),(o,a)=>(Bs(),Ms("div",Tn,gn))}});const mn=je(Rn,[["__scopeId","data-v-fa4250d0"]]),xn=P("h1",{id:"视图联动",tabindex:"-1"},[Ye("视图联动 "),P("a",{class:"header-anchor",href:"#视图联动","aria-label":'Permalink to "视图联动"'},"​")],-1),bn=P("div",{class:"tip custom-block"},[P("p",{class:"custom-block-title"},"TIP"),P("p",null,"视图联动。")],-1),wn=He("",2),Bn=JSON.parse('{"title":"视图联动","description":"","frontmatter":{},"headers":[],"relativePath":"open-layers/others/multi-view-linkage/index.md","filePath":"open-layers/others/multi-view-linkage/index.md"}'),Sn={name:"open-layers/others/multi-view-linkage/index.md"},Mn=Object.assign(Sn,{setup(e){return(s,n)=>(Bs(),Ms("div",null,[xn,bn,qe(mn),wn]))}});export{Bn as __pageData,Mn as default};
