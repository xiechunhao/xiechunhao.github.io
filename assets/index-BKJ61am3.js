import{b5 as C,r as E,o as b,c as g,w as e,b as a,cK as K,aG as M,u as x,d as u,aI as D,aH as O,aC as v,aL as F,s as V,a as I,bc as L,a8 as P,E as T,aY as Y,aX as $,k as j}from"./index-C4BxmZrN.js";import{i as S}from"./index-CkGVv88Q.js";import{i as z}from"./index-BCHJo1Hi.js";import"./index-DPWieFbN.js";import"./index-BY7TmcLY.js";import"./index-Cw5RFCD5.js";import"./virtual-list-CYzSvSUd.js";import"./index-CuklncWx.js";import"./index-CL6ZmOyB.js";import{E as B,a as U}from"./col-DljvzS69.js";import{E as G}from"./date-picker-wyenFiKS.js";import{i as H}from"./index-DSHqkOzX.js";import"./isArrayLikeObject-XYcYxEsS.js";import"./vuedraggable.umd-BuphSp9t.js";import"./arrays-6TrVLtTe.js";import"./index-dVmM0e8c.js";const X={__name:"login-record-search",props:{where:Object},emits:["search"],setup(p,{emit:l}){const h=p,w=l,[d,k]=C({username:"",nickname:"",...h.where||{}}),_=E(["",""]),r=()=>{const[o,t]=_.value||[];w("search",{...d,createTimeStart:o?`${o} 00:00:00`:"",createTimeEnd:t?`${t} 23:59:59`:""})},s=()=>{k(),_.value=["",""],r()};return(o,t)=>{const f=D,m=O,c=B,i=G,n=v,W=U,N=F,R=S;return b(),g(R,{"body-style":{paddingBottom:"2px"}},{default:e(()=>[a(N,{"label-width":"72px",onKeyup:K(r,["enter"]),onSubmit:t[3]||(t[3]=M(()=>{},["prevent"]))},{default:e(()=>[a(W,{gutter:8},{default:e(()=>[a(c,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[a(m,{label:"用户账号"},{default:e(()=>[a(f,{clearable:"",modelValue:x(d).username,"onUpdate:modelValue":t[0]||(t[0]=y=>x(d).username=y),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(c,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[a(m,{label:"用户名"},{default:e(()=>[a(f,{clearable:"",modelValue:x(d).nickname,"onUpdate:modelValue":t[1]||(t[1]=y=>x(d).nickname=y),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(c,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[a(m,{label:"登录时间"},{default:e(()=>[a(i,{"unlink-panels":"",type:"daterange",modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=y=>_.value=y),"range-separator":"-","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),a(c,{lg:6,md:12,sm:12,xs:24},{default:e(()=>[a(m,{"label-width":"16px"},{default:e(()=>[a(n,{type:"primary",onClick:r},{default:e(()=>[u("查询")]),_:1}),a(n,{onClick:s},{default:e(()=>[u("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};async function q(p){const l=await V.get("/system/login-record/page",{params:p});return l.data.code===0?l.data.data:Promise.reject(new Error(l.data.message))}async function A(p){const l=await V.get("/system/login-record",{params:p});return l.data.code===0&&l.data.data?l.data.data:Promise.reject(new Error(l.data.message))}const J={name:"SystemLoginRecord"},_e=Object.assign(J,{setup(p){const l=I({username:"",nickname:""}),h=E(null),w=E([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"ip",label:"IP地址",sortable:"custom",minWidth:110},{prop:"device",label:"设备型号",sortable:"custom",minWidth:110},{prop:"os",label:"操作系统",sortable:"custom",minWidth:110},{prop:"browser",label:"浏览器",sortable:"custom",minWidth:110},{prop:"loginType",label:"操作类型",sortable:"custom",width:130,slot:"loginType",filters:[{text:"登录成功",value:"0"},{text:"登录失败",value:"1"},{text:"退出登录",value:"2"},{text:"刷新TOKEN",value:"3"}],filterMultiple:!1},{prop:"comments",label:"备注",sortable:"custom",minWidth:110},{prop:"createTime",label:"登录时间",sortable:"custom",minWidth:110}]),d=({pages:r,where:s,orders:o,filters:t})=>q({...s,...o,...t,...r}),k=r=>{var s,o;(o=(s=h.value)==null?void 0:s.reload)==null||o.call(s,{page:1,where:r})},_=()=>{var o,t;const r=[["账号","用户名","IP地址","设备型号","操作系统","浏览器","操作类型","备注","登录时间"]],s=T.loading("请求中..");(t=(o=h.value)==null?void 0:o.fetch)==null||t.call(o,({where:f,orders:m,filters:c})=>{A({...f,...m,...c}).then(i=>{s.close(),i.forEach(n=>{r.push([n.username,n.nickname,n.ip,n.device,n.os,n.browser,["登录成功","登录失败","退出登录","刷新TOKEN"][n.loginType],n.comments,n.createTime])}),Y({SheetNames:["Sheet1"],Sheets:{Sheet1:$.aoa_to_sheet(r)}},"登录日志.xlsx")}).catch(i=>{s.close(),T.error(i.message)})})};return(r,s)=>{const o=v,t=j,f=z,m=S,c=H;return b(),g(c,null,{default:e(()=>[a(X,{where:l,onSearch:k},null,8,["where"]),a(m,{"body-style":{paddingTop:"8px"}},{default:e(()=>[a(f,{ref_key:"tableRef",ref:h,"row-key":"id",columns:w.value,datasource:d,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"登录日志数据"},where:l,"cache-key":"systemLoginRecordTable"},{toolbar:e(()=>[a(o,{type:"primary",class:"ele-btn-icon",icon:x(L),onClick:_},{default:e(()=>[u(" 导出 ")]),_:1},8,["icon"])]),loginType:e(({row:i})=>[i.loginType===0?(b(),g(t,{key:0,size:"small",type:"success","disable-transitions":!0},{default:e(()=>[u(" 登录成功 ")]),_:1})):i.loginType===1?(b(),g(t,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:e(()=>[u(" 登录失败 ")]),_:1})):i.loginType===2?(b(),g(t,{key:2,size:"small",type:"info","disable-transitions":!0},{default:e(()=>[u(" 退出登录 ")]),_:1})):i.loginType===3?(b(),g(t,{key:3,size:"small",type:"warning","disable-transitions":!0},{default:e(()=>[u(" 刷新TOKEN ")]),_:1})):P("",!0)]),_:1},8,["columns","where"])]),_:1})]),_:1})}}});export{_e as default};
