import{b5 as C,o as E,c as w,w as l,b as t,cK as M,aG as U,u as c,d as p,aI as K,aH as N,aC as F,aL as I,r as k,b9 as $,au as D,t as S,E as i,aW as T,ay as j,j as O}from"./index-C4BxmZrN.js";import{i as V}from"./index-CkGVv88Q.js";import{i as R}from"./index-BCHJo1Hi.js";import"./index-DPWieFbN.js";import"./index-BY7TmcLY.js";import"./index-Cw5RFCD5.js";import"./virtual-list-CYzSvSUd.js";import"./index-CuklncWx.js";import"./index-CL6ZmOyB.js";import{E as W}from"./upload-D6XcBL05.js";import"./progress-Bytq2m9M.js";import{E as G,a as L}from"./col-DljvzS69.js";import{p as z,r as H,u as P}from"./index-Nq65WDmQ.js";import{i as q}from"./index-DSHqkOzX.js";import"./isArrayLikeObject-XYcYxEsS.js";import"./vuedraggable.umd-BuphSp9t.js";import"./cloneDeep-hApPH6eT.js";const A={__name:"file-search",emits:["search"],setup(B,{emit:_}){const g=_,[n,h]=C({name:"",path:"",createNickname:""}),m=()=>{g("search",{...n})},f=()=>{h(),m()};return(v,e)=>{const o=K,a=N,r=G,u=F,b=L,y=I,x=V;return E(),w(x,{"body-style":{paddingBottom:"2px"}},{default:l(()=>[t(y,{"label-width":"72px",onKeyup:M(m,["enter"]),onSubmit:e[3]||(e[3]=U(()=>{},["prevent"]))},{default:l(()=>[t(b,{gutter:8},{default:l(()=>[t(r,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(a,{label:"文件名称"},{default:l(()=>[t(o,{clearable:"",modelValue:c(n).name,"onUpdate:modelValue":e[0]||(e[0]=d=>c(n).name=d),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(r,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(a,{label:"文件路径"},{default:l(()=>[t(o,{clearable:"",modelValue:c(n).path,"onUpdate:modelValue":e[1]||(e[1]=d=>c(n).path=d),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(r,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(a,{label:"上传人"},{default:l(()=>[t(o,{clearable:"",modelValue:c(n).createNickname,"onUpdate:modelValue":e[2]||(e[2]=d=>c(n).createNickname=d),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(r,{lg:6,md:12,sm:12,xs:24},{default:l(()=>[t(a,{"label-width":"16px"},{default:l(()=>[t(u,{type:"primary",onClick:m},{default:l(()=>[p("查询")]),_:1}),t(u,{onClick:f},{default:l(()=>[p("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},J={name:"SystemFile"},_e=Object.assign(J,{setup(B){const _=k(null),g=k([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"name",label:"文件名称",sortable:"custom",minWidth:120},{prop:"path",label:"文件路径",sortable:"custom",minWidth:120,slot:"path"},{prop:"length",label:"文件大小",width:120,align:"center",sortable:"custom",formatter:e=>e.length<1024?e.length+"B":e.length<1024*1024?(e.length/1024).toFixed(1)+"KB":e.length<1024*1024*1024?(e.length/1024/1024).toFixed(1)+"M":(e.length/1024/1024/1024).toFixed(1)+"G"},{prop:"createNickname",label:"上传人",width:120,align:"center",sortable:"custom"},{prop:"createTime",label:"上传时间",width:160,align:"center",sortable:"custom"},{columnKey:"action",label:"操作",width:120,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),n=k([]),h=({pages:e,where:o,orders:a})=>z({...o,...a,...e}),m=e=>{var o,a;n.value=[],(a=(o=_.value)==null?void 0:o.reload)==null||a.call(o,{page:1,where:e})},f=e=>{const o=e==null?n.value:[e];if(!o.length){i.error("请至少选择一条数据");return}T.confirm("确定要删除“"+o.map(a=>a.name).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const a=i.loading("请求中..");H(o.map(r=>r.id)).then(r=>{a.close(),i.success(r),m()}).catch(r=>{a.close(),i.error(r.message)})}).catch(()=>{})},v=e=>{if(e.size/1024/1024>100)return i.error("大小不能超过 100MB"),!1;const o=i.loading({message:"上传中..",mask:!0});return P(e).then(()=>{o.close(),i.success("上传成功"),m()}).catch(a=>{o.close(),i.error(a.message)}),!1};return(e,o)=>{const a=F,r=W,u=j,b=O,y=R,x=V,d=q;return E(),w(d,null,{default:l(()=>[t(A,{onSearch:m}),t(x,{"body-style":{paddingTop:"8px"}},{default:l(()=>[t(y,{ref_key:"tableRef",ref:_,"row-key":"id",columns:g.value,datasource:h,"show-overflow-tooltip":!0,selections:n.value,"onUpdate:selections":o[1]||(o[1]=s=>n.value=s),"highlight-current-row":!0,"export-config":{fileName:"文件数据"},"cache-key":"systemFileTable"},{toolbar:l(()=>[t(r,{action:"","show-upload-list":!1,"before-upload":v,style:{display:"inline-block","vertical-align":"middle"}},{default:l(()=>[t(a,{type:"primary",class:"ele-btn-icon",icon:c($)},{default:l(()=>[p(" 上传 ")]),_:1},8,["icon"])]),_:1}),t(a,{type:"danger",class:"ele-btn-icon",icon:c(D),style:{"margin-left":"12px"},onClick:o[0]||(o[0]=s=>f())},{default:l(()=>[p(" 删除 ")]),_:1},8,["icon"])]),path:l(({row:s})=>[t(u,{type:"primary",href:s.url,target:"_blank",underline:!1},{default:l(()=>[p(S(s.path),1)]),_:2},1032,["href"])]),action:l(({row:s})=>[t(u,{type:"primary",underline:!1,href:s.downloadUrl,target:"_blank"},{default:l(()=>[p(" 下载 ")]),_:2},1032,["href"]),t(b,{direction:"vertical"}),t(u,{type:"danger",underline:!1,onClick:Q=>f(s)},{default:l(()=>[p(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","selections"])]),_:1})]),_:1})}}});export{_e as default};
