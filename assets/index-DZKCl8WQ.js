import{b5 as N,o as E,c as I,w as t,b as e,cK as Q,aG as j,u as n,d as b,aI as q,aH as P,c9 as T,aC as O,aL as W,r as h,a as X,R as Z,a8 as ee,E as g,aE as z,_ as le,bU as te,m as L,fA as oe,e as Y,h as ae,ay as A,p as se,l as ne,aj as re,bE as de,au as ue,b9 as ie,t as R,F as me,n as pe,aW as K,k as ce,aT as _e,j as fe}from"./index-C4BxmZrN.js";import{i as G}from"./index-CkGVv88Q.js";import{i as ge}from"./index-BCHJo1Hi.js";import"./index-DPWieFbN.js";import{v as be}from"./index-BY7TmcLY.js";import"./index-Cw5RFCD5.js";import"./virtual-list-CYzSvSUd.js";import"./index-CuklncWx.js";import"./index-CL6ZmOyB.js";import{E as H,a as J}from"./col-DljvzS69.js";import{E as ve}from"./date-picker-wyenFiKS.js";import{_ as xe}from"./role-select-CIII8WmI.js";import{c as ye,u as he,a as Ve,i as ke,p as we,r as Ue,d as Ee,b as Ce}from"./index-DUSysJZb.js";import{e as Ie,p as $e}from"./validate-B_6HX0Io.js";import{E as Se}from"./upload-D6XcBL05.js";import"./progress-Bytq2m9M.js";import{i as Me}from"./index-DSHqkOzX.js";import"./isArrayLikeObject-XYcYxEsS.js";import"./vuedraggable.umd-BuphSp9t.js";import"./arrays-6TrVLtTe.js";import"./index-dVmM0e8c.js";import"./index-Czf8vTYn.js";import"./cloneDeep-hApPH6eT.js";const Be={__name:"user-search",emits:["search"],setup(x,{emit:U}){const V=U,[d,_]=N({username:"",nickname:"",sex:void 0}),f=()=>{V("search",{...d})},p=()=>{_(),f()};return(r,m)=>{const k=q,y=P,v=H,w=T,c=O,l=J,o=W,a=G;return E(),I(a,{"body-style":{paddingBottom:"2px"}},{default:t(()=>[e(o,{"label-width":"72px",onKeyup:Q(f,["enter"]),onSubmit:m[3]||(m[3]=j(()=>{},["prevent"]))},{default:t(()=>[e(l,{gutter:8},{default:t(()=>[e(v,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(y,{label:"用户账号"},{default:t(()=>[e(k,{clearable:"",modelValue:n(d).username,"onUpdate:modelValue":m[0]||(m[0]=s=>n(d).username=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(v,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(y,{label:"用户名"},{default:t(()=>[e(k,{clearable:"",modelValue:n(d).nickname,"onUpdate:modelValue":m[1]||(m[1]=s=>n(d).nickname=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),e(v,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(y,{label:"性别"},{default:t(()=>[e(w,{code:"sex",modelValue:n(d).sex,"onUpdate:modelValue":m[2]||(m[2]=s=>n(d).sex=s),placeholder:"请选择"},null,8,["modelValue"])]),_:1})]),_:1}),e(v,{lg:6,md:12,sm:12,xs:24},{default:t(()=>[e(y,{"label-width":"16px"},{default:t(()=>[e(c,{type:"primary",onClick:f},{default:t(()=>[b("查询")]),_:1}),e(c,{onClick:p},{default:t(()=>[b("重置")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},De={__name:"user-edit",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(x,{emit:U}){const V=U,d=x,_=h(!1),f=h(!1),p=h(null),[r,m,k]=N({userId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:"",birthday:""}),y=X({username:[{required:!0,message:"请输入用户账号",type:"string",trigger:"blur"},{min:4,message:"账号长度最少为4位",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(c,l,o)=>{var a;if(_.value){o();return}ye("username",l,(a=d.data)==null?void 0:a.userId).then(()=>{o(new Error("账号已经存在"))}).catch(()=>{o()})}}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",type:"array",trigger:"blur"}],email:[{pattern:Ie,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(c,l,o)=>{if(_.value||/^[\S]{5,18}$/.test(l))return o();o(new Error("密码必须为5-18位非空白字符"))}}],phone:[{required:!0,message:"请输入手机号",type:"string",trigger:"blur"},{pattern:$e,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),v=()=>{var c,l;(l=(c=p.value)==null?void 0:c.validate)==null||l.call(c,o=>{if(!o)return;f.value=!0,(_.value?he:Ve)(r).then(s=>{f.value=!1,g.success(s),w(!1),V("done")}).catch(s=>{f.value=!1,g.error(s.message)})})},w=c=>{V("update:modelValue",c)};return Z(()=>d.modelValue,c=>{var l,o;c?d.data?(k({...d.data,password:""}),_.value=!0):_.value=!1:(m(),(o=(l=p.value)==null?void 0:l.clearValidate)==null||o.call(l))}),(c,l)=>{const o=q,a=P,s=T,$=H,B=ve,D=J,S=W,M=O,F=z;return E(),I(F,{form:"",width:640,"model-value":x.modelValue,title:_.value?"修改用户":"新建用户","onUpdate:modelValue":w},{footer:t(()=>[e(M,{onClick:l[10]||(l[10]=u=>w(!1))},{default:t(()=>[b("取消")]),_:1}),e(M,{type:"primary",loading:f.value,onClick:v},{default:t(()=>[b(" 保存 ")]),_:1},8,["loading"])]),default:t(()=>[e(S,{ref_key:"formRef",ref:p,model:n(r),rules:y,"label-width":"80px",onSubmit:l[9]||(l[9]=j(()=>{},["prevent"]))},{default:t(()=>[e(D,{gutter:16},{default:t(()=>[e($,{sm:12,xs:24},{default:t(()=>[e(a,{label:"用户账号",prop:"username"},{default:t(()=>[e(o,{clearable:"",maxlength:20,modelValue:n(r).username,"onUpdate:modelValue":l[0]||(l[0]=u=>n(r).username=u),placeholder:"请输入用户账号",disabled:_.value},null,8,["modelValue","disabled"])]),_:1}),e(a,{label:"用户名",prop:"nickname"},{default:t(()=>[e(o,{clearable:"",maxlength:20,modelValue:n(r).nickname,"onUpdate:modelValue":l[1]||(l[1]=u=>n(r).nickname=u),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),e(a,{label:"性别",prop:"sex"},{default:t(()=>[e(s,{code:"sex",modelValue:n(r).sex,"onUpdate:modelValue":l[2]||(l[2]=u=>n(r).sex=u),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),e(a,{label:"角色",prop:"roles"},{default:t(()=>[e(xe,{modelValue:n(r).roles,"onUpdate:modelValue":l[3]||(l[3]=u=>n(r).roles=u)},null,8,["modelValue"])]),_:1}),e(a,{label:"邮箱",prop:"email"},{default:t(()=>[e(o,{clearable:"",maxlength:100,modelValue:n(r).email,"onUpdate:modelValue":l[4]||(l[4]=u=>n(r).email=u),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{sm:12,xs:24},{default:t(()=>[e(a,{label:"手机号",prop:"phone"},{default:t(()=>[e(o,{clearable:"",maxlength:11,modelValue:n(r).phone,"onUpdate:modelValue":l[5]||(l[5]=u=>n(r).phone=u),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(a,{label:"出生日期"},{default:t(()=>[e(B,{modelValue:n(r).birthday,"onUpdate:modelValue":l[6]||(l[6]=u=>n(r).birthday=u),"value-format":"YYYY-MM-DD",placeholder:"请选择出生日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),_.value?ee("",!0):(E(),I(a,{key:0,label:"登录密码",prop:"password"},{default:t(()=>[e(o,{"show-password":"",type:"password",maxlength:20,modelValue:n(r).password,"onUpdate:modelValue":l[7]||(l[7]=u=>n(r).password=u),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),e(a,{label:"个人简介"},{default:t(()=>[e(o,{type:"textarea",rows:3,maxlength:200,modelValue:n(r).introduction,"onUpdate:modelValue":l[8]||(l[8]=u=>n(r).introduction=u),placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}},Fe=x=>(se("data-v-832df708"),x=x(),ne(),x),Oe={class:"user-import-upload"},Re={style:{display:"flex","align-items":"center","justify-content":"center"}},Ke=Fe(()=>Y("span",{style:{"padding-right":"8px"}},"只能上传 xls、xlsx 文件,",-1)),Ne={__name:"user-import",props:{modelValue:Boolean},emits:["done","update:modelValue"],setup(x,{emit:U}){const V=U,d=h(!1),_=p=>["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(p.type)?p.size/1024/1024>10?(g.error("大小不能超过 10MB"),!1):(d.value=!0,ke(p).then(r=>{d.value=!1,g.success(r),f(!1),V("done")}).catch(r=>{d.value=!1,g.error(r.message)}),!1):(g.error("只能选择 excel 文件"),!1),f=p=>{V("update:modelValue",p)};return(p,r)=>{const m=ae,k=Se,y=A,v=z,w=be;return E(),I(v,{width:460,title:"导入用户","model-value":x.modelValue,"onUpdate:modelValue":f},{default:t(()=>[te((E(),L("div",Oe,[e(k,{drag:"",action:"",accept:".xls,.xlsx","show-upload-list":!1,"before-upload":_},{default:t(()=>[e(m,{type:"primary",icon:n(oe),"icon-props":{size:52},style:{"margin-bottom":"10px"}},null,8,["icon"]),e(m,{type:"placeholder"},{default:t(()=>[b("将文件拖到此处, 或点击上传")]),_:1})]),_:1})])),[[w,d.value]]),Y("div",Re,[Ke,e(y,{type:"primary",underline:!1,href:"https://cdn.eleadmin.com/20200610/用户导入模板.xlsx",download:"用户导入模板.xlsx"},{default:t(()=>[b(" 下载模板 ")]),_:1})])]),_:1},8,["model-value"])}}},je=le(Ne,[["__scopeId","data-v-832df708"]]),qe={name:"SystemUser"},il=Object.assign(qe,{setup(x){const U=h(null),V=h([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"用户账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110,slot:"nickname"},{prop:"sexName",label:"性别",sortable:"custom",width:90,align:"center"},{prop:"phone",label:"手机号",sortable:"custom",minWidth:110},{columnKey:"roles",label:"角色",minWidth:110,slot:"roles"},{prop:"createTime",label:"创建时间",sortable:"custom",minWidth:110},{prop:"status",label:"状态",width:90,align:"center",sortable:"custom",slot:"status"},{columnKey:"action",label:"操作",width:200,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),d=h([]),_=h(null),f=h(!1),p=h(!1),r=({pages:l,where:o,orders:a})=>we({...o,...a,...l}),m=l=>{var o,a;d.value=[],(a=(o=U.value)==null?void 0:o.reload)==null||a.call(o,{page:1,where:l})},k=l=>{_.value=l!=null?l:null,f.value=!0},y=()=>{p.value=!0},v=l=>{const o=l==null?d.value:[l];if(!o.length){g.error("请至少选择一条数据");return}K.confirm("确定要删除“"+o.map(a=>a.nickname).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const a=g.loading("请求中..");Ue(o.map(s=>s.userId)).then(s=>{a.close(),g.success(s),m()}).catch(s=>{a.close(),g.error(s.message)})}).catch(()=>{})},w=l=>{K.prompt(`请输入用户"${l.nickname}"的新密码：`,"重置密码",{inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",draggable:!0}).then(({value:o})=>{const a=g.loading("请求中..");Ee(l.userId,o).then(s=>{a.close(),g.success(s)}).catch(s=>{a.close(),g.error(s.message)})}).catch(()=>{})},c=(l,o)=>{const a=l?0:1;Ce(o.userId,a).then(s=>{o.status=a,g.success(s)}).catch(s=>{g.error(s.message)})};return(l,o)=>{const a=O,s=A,$=re("router-link"),B=ce,D=_e,S=fe,M=ge,F=G,u=Me;return E(),I(u,null,{default:t(()=>[e(Be,{onSearch:m}),e(F,{"body-style":{paddingTop:"8px"}},{default:t(()=>[e(M,{ref_key:"tableRef",ref:U,"row-key":"userId",columns:V.value,datasource:r,"show-overflow-tooltip":!0,selections:d.value,"onUpdate:selections":o[2]||(o[2]=i=>d.value=i),"highlight-current-row":!0,"export-config":{fileName:"用户数据"},"cache-key":"systemUserTable"},{toolbar:t(()=>[e(a,{type:"primary",class:"ele-btn-icon",icon:n(de),onClick:o[0]||(o[0]=i=>k())},{default:t(()=>[b(" 新建 ")]),_:1},8,["icon"]),e(a,{type:"danger",class:"ele-btn-icon",icon:n(ue),onClick:o[1]||(o[1]=i=>v())},{default:t(()=>[b(" 删除 ")]),_:1},8,["icon"]),e(a,{class:"ele-btn-icon",icon:n(ie),onClick:y},{default:t(()=>[b(" 导入 ")]),_:1},8,["icon"])]),nickname:t(({row:i})=>[e($,{to:"/system/user/details/"+i.userId,style:{"text-decoration":"none"}},{default:t(()=>[e(s,{type:"primary",underline:!1},{default:t(()=>[b(R(i.nickname),1)]),_:2},1024)]),_:2},1032,["to"])]),roles:t(({row:i})=>[(E(!0),L(me,null,pe(i.roles,C=>(E(),I(B,{key:C.roleId,size:"small","disable-transitions":!0,style:{"margin-right":"6px"}},{default:t(()=>[b(R(C.roleName),1)]),_:2},1024))),128))]),status:t(({row:i})=>[e(D,{size:"small","model-value":i.status===0,onChange:C=>c(C,i)},null,8,["model-value","onChange"])]),action:t(({row:i})=>[e(s,{type:"primary",underline:!1,onClick:C=>k(i)},{default:t(()=>[b(" 修改 ")]),_:2},1032,["onClick"]),e(S,{direction:"vertical"}),e(s,{type:"primary",underline:!1,onClick:C=>w(i)},{default:t(()=>[b(" 重置密码 ")]),_:2},1032,["onClick"]),e(S,{direction:"vertical"}),e(s,{type:"danger",underline:!1,onClick:C=>v(i)},{default:t(()=>[b(" 删除 ")]),_:2},1032,["onClick"])]),_:1},8,["columns","selections"])]),_:1}),e(De,{modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=i=>f.value=i),data:_.value,onDone:m},null,8,["modelValue","data"]),e(je,{modelValue:p.value,"onUpdate:modelValue":o[4]||(o[4]=i=>p.value=i),onDone:m},null,8,["modelValue"])]),_:1})}}});export{il as default};
