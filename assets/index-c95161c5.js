import{bK as H,bm as M,A as x,z as k,P as V,D as v,bU as F,bV as _,b6 as U,Z as L,bW as j,bs as G,X as Z,C as T,y as W,d as $,H as q,I as J,a7 as Q,K as ee,o as oe,bX as te,bM as ne,f as b,T as ae,j as se,bY as le,U as A,bZ as ce,R as re,S as ie,V as ue}from"../js/index.dc884249.js";import{u as ve}from"./use-expose-9032f2c9.js";import{T as E,p as de,H as fe,I as he}from"./index-49d41786.js";import{u as me,O as ye}from"./index-972af07d.js";import{P as Ie}from"./on-popup-reopen-e2cd79b3.js";function be(e,{args:o=[],done:a,canceled:l,error:t}){if(e){const n=e.apply(null,o);H(n)?n.then(c=>{c?a():l&&l()}).catch(t||M):n?a():l&&l()}else a()}const B={show:Boolean,zIndex:x,overlay:k,duration:x,teleport:[String,Object],lockScroll:k,lazyRender:k,beforeClose:Function,overlayStyle:Object,overlayClass:V,transitionAppear:Boolean,closeOnClickOverlay:k},De=Object.keys(B);function Oe(e,o){return e>o?"horizontal":o>e?"vertical":""}function Ce(){const e=v(0),o=v(0),a=v(0),l=v(0),t=v(0),n=v(0),c=v(""),r=v(!0),O=()=>c.value==="vertical",I=()=>c.value==="horizontal",i=()=>{a.value=0,l.value=0,t.value=0,n.value=0,c.value="",r.value=!0};return{move:u=>{const d=u.touches[0];a.value=(d.clientX<0?0:d.clientX)-e.value,l.value=d.clientY-o.value,t.value=Math.abs(a.value),n.value=Math.abs(l.value);const y=10;(!c.value||t.value<y&&n.value<y)&&(c.value=Oe(t.value,n.value)),r.value&&(t.value>E||n.value>E)&&(r.value=!1)},start:u=>{i(),e.value=u.touches[0].clientX,o.value=u.touches[0].clientY},reset:i,startX:e,startY:o,deltaX:a,deltaY:l,offsetX:t,offsetY:n,direction:c,isVertical:O,isHorizontal:I,isTap:r}}let C=0;const D="van-overflow-hidden";function Pe(e,o){const a=Ce(),l="01",t="10",n=i=>{a.move(i);const m=a.deltaY.value>0?t:l,P=j(i.target,e.value),{scrollHeight:u,offsetHeight:d,scrollTop:y}=P;let f="11";y===0?f=d>=u?"00":"01":y+d>=u&&(f="10"),f!=="11"&&a.isVertical()&&!(parseInt(f,2)&parseInt(m,2))&&de(i,!0)},c=()=>{document.addEventListener("touchstart",a.start),document.addEventListener("touchmove",n,{passive:!1}),C||document.body.classList.add(D),C++},r=()=>{C&&(document.removeEventListener("touchstart",a.start),document.removeEventListener("touchmove",n),C--,C||document.body.classList.remove(D))},O=()=>o()&&c(),I=()=>o()&&r();F(O),_(I),U(I),L(o,i=>{i?c():r()})}const g=()=>{var e;const{scopeId:o}=((e=G())==null?void 0:e.vnode)||{};return o?{[o]:""}:null},pe=Z({},B,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[ke,z]=W("popup");var we=$({name:ke,inheritAttrs:!1,props:pe,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:a,slots:l}){let t,n;const c=v(),r=v(),O=me(()=>e.show||!e.lazyRender),I=q(()=>{const s={zIndex:c.value};if(J(e.duration)){const h=e.position==="center"?"animationDuration":"transitionDuration";s[h]="".concat(e.duration,"s")}return s}),i=()=>{t||(t=!0,c.value=e.zIndex!==void 0?+e.zIndex:le(),o("open"))},m=()=>{t&&be(e.beforeClose,{done(){t=!1,o("close"),o("update:show",!1)}})},P=s=>{o("clickOverlay",s),e.closeOnClickOverlay&&m()},u=()=>{if(e.overlay)return b(ye,A({show:e.show,class:e.overlayClass,zIndex:c.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},g(),{onClick:P}),{default:l["overlay-content"]})},d=s=>{o("clickCloseIcon",s),m()},y=()=>{if(e.closeable)return b(he,{role:"button",tabindex:0,name:e.closeIcon,class:[z("close-icon",e.closeIconPosition),fe],classPrefix:e.iconPrefix,onClick:d},null)};let f;const R=()=>{f&&clearTimeout(f),f=setTimeout(()=>{o("opened")})},K=()=>o("closed"),Y=s=>o("keydown",s),X=O(()=>{var s;const{round:h,position:p,safeAreaInsetTop:w,safeAreaInsetBottom:N}=e;return re(b("div",A({ref:r,style:I.value,role:"dialog",tabindex:0,class:[z({round:h,[p]:p}),{"van-safe-area-top":w,"van-safe-area-bottom":N}],onKeydown:Y},a,g()),[(s=l.default)==null?void 0:s.call(l),y()]),[[ie,e.show]])}),S=()=>{const{position:s,transition:h,transitionAppear:p}=e,w=s==="center"?"van-fade":"van-popup-slide-".concat(s);return b(ce,{name:h||w,appear:p,onAfterEnter:R,onAfterLeave:K},{default:X})};return L(()=>e.show,s=>{s&&!t&&(i(),a.tabindex===0&&Q(()=>{var h;(h=r.value)==null||h.focus()})),!s&&t&&(t=!1,o("close"))}),ve({popupRef:r}),Pe(r,()=>e.show&&e.lockScroll),ee("popstate",()=>{e.closeOnPopstate&&(m(),n=!1)}),oe(()=>{e.show&&i()}),te(()=>{n&&(o("update:show",!0),n=!1)}),_(()=>{e.show&&e.teleport&&(m(),n=!0)}),ne(Ie,()=>e.show),()=>e.teleport?b(ae,{to:e.teleport},{default:()=>[u(),S()]}):b(se,null,[u(),S()])}});const ge=ue(we);export{ge as P,De as a,be as c,B as p,Ce as u};
