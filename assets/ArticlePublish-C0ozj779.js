var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,i=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&o(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&o(e,a,t[a]);return e},n=(e,l)=>t(e,a(l)),u=(e,t,a)=>new Promise(((l,s)=>{var r=e=>{try{i(a.next(e))}catch(t){s(t)}},o=e=>{try{i(a.throw(e))}catch(t){s(t)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,o);i((a=a.apply(e,t)).next())}));import{n as c,y as d,z as p,_ as m}from"./index-jEQxvlyX.js";/* empty css                  *//* empty css                    */import{_ as v}from"./Editor.vue_vue_type_style_index_0_lang-Blmll7Kj.js";/* empty css               */import{E as f,h,a8 as y,a1 as g,r as _,a as b,k as j,p as w,l as x,m as A,u as $,i as E,aU as P,$ as V,K as O,j as T,F as k,A as U,N as q,a$ as z,H as C,z as N,L as S,aN as D,ar as Y,as as L,I as M,b0 as I,_ as R,ap as J}from"./vendor-Bhb26uf3.js";import{a as W,A as B}from"./axios-CBzZLLX9.js";import{E as F}from"./emojo-Ben6gd8J.js";const G=W.create({timeout:15e3,baseURL:"https://xxxx.com",withCredentials:!0,transformRequest:[e=>JSON.stringify(e)],validateStatus:e=>e>=200&&e<300,headers:{get:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},post:{"Content-Type":"application/json;charset=utf-8"}},transformResponse:[e=>{try{return"string"==typeof e&&e.startsWith("{")?JSON.parse(e):e}catch(t){return e}}]});function H(e){return u(this,null,(function*(){"POST"!==e.method&&"PUT"!==e.method||(e.data=e.params,e.params={});try{return(yield G.request(i({},e))).data}catch(t){return W.isAxiosError(t),Promise.reject(t)}}))}G.interceptors.request.use((e=>{const{token:t}=c().info;return t&&e.headers.set({"Content-Type":"application/json",Authorization:t}),e}),(e=>(f.error(`服务器异常！ ${F[500]}`),Promise.reject(e)))),G.interceptors.response.use((e=>e),(e=>{var t;if(W.isCancel(e));else{const a=null==(t=e.response)?void 0:t.data.message;f.error(a?`${a} ${F[500]}`:`请求超时或服务器异常！${F[500]}`)}return Promise.reject(e)}));const K={get:e=>H(n(i({},e),{method:"GET"})),post:e=>H(n(i({},e),{method:"POST"})),put:e=>H(n(i({},e),{method:"PUT"})),del:e=>H(n(i({},e),{method:"DELETE"}))};class Q{static getArticleList(e){const{page:t,size:a,searchVal:l,year:s}=e;return K.get({url:`/api/articles/${t}/${a}?title=${l}&year=${s}`})}static getArticleTypes(e){return K.get({url:"/api/articles/types",params:e})}static getArticleDetail(e){return K.get({url:`/api/articles/${e}`})}static addArticle(e){return K.post({url:"/api/articles/",params:e})}static editArticle(e,t){return K.put({url:`/api/articles/${e}`,params:t})}}var X=(e=>(e[e.Add=0]="Add",e[e.Edit=1]="Edit",e))(X||{});const Z={class:"article-edit"},ee={class:"editor-wrap"},te={class:"form-wrap"},ae={class:"el-top upload-container"},le={key:0,class:"upload-placeholder"},se=["src"],re={style:{display:"flex","justify-content":"flex-end"}},oe=m(h({__name:"ArticlePublish",setup(e){const t=y(),a=g(),l=c();let{token:s}=l.info;const r={Authorization:s};let o=X.Add;const i=_(""),n=_(),m=_(),h=_(""),G=_(""),H=_(""),K=_(!0);b((()=>{we(),ue(),oe()}));const oe=()=>{const{id:e}=t.query;o=e?X.Edit:X.Add,o===X.Edit&&e?ie(Number(e)):ne()},ie=e=>{ce=e,de()},ne=()=>{G.value=me(d().value)},ue=()=>u(this,null,(function*(){try{const e=yield W.get("https://www.qiniu.lingchen.kim/classify.json");e.data.code===B.success&&(m.value=e.data.data)}catch(e){}}));let ce=0;const de=()=>u(this,null,(function*(){const e=yield W.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.data.code===B.success){let{title:t,blog_class:a,html_content:l}=e.data.data;i.value=t,n.value=Number(a),h.value=l}})),pe=()=>{o===X.Edit?ye():he()},me=e=>p(e,"YYYY-MM-DD").value,ve=()=>i.value?n.value?"<p><br></p>"===h.value?(f.error("请输入文章内容"),!1):!!H.value||(f.error("请上传图片"),!1):(f.error("请选择文章类型"),!1):(f.error("请输入文章标题"),!1),fe=()=>({title:i.value,html_content:h.value,home_img:H.value,blog_class:n.value,create_time:G.value}),he=()=>u(this,null,(function*(){try{if(!ve())return;h.value=ge(h.value);const e=fe();(yield Q.addArticle(e)).code===B.success&&(f.success(`发布成功 ${F[200]}`),je())}catch(e){}})),ye=()=>u(this,null,(function*(){try{if(!ve())return;h.value=ge(h.value);const e=fe();(yield Q.editArticle(ce,e)).code===B.success&&(f.success(`修改成功 ${F[200]}`),je())}catch(e){}})),ge=e=>e.replace(/(\s*)<\/code>/g,"</code>"),_e=e=>{H.value=e.data.url,f.success(`图片上传成功 ${F[200]}`)},be=()=>{f.error(`图片上传失败 ${F[500]}`)},je=()=>{setTimeout((()=>{a.go(-1)}),800)},we=()=>{window.scrollTo({top:0})},xe=e=>{const t=e.type.startsWith("image/"),a=e.size/1024/1024<2;return t?!!a||(f.error("图片大小不能超过 2MB!"),!1):(f.error("只能上传图片文件!"),!1)};return(e,t)=>{const a=S,l=D,s=Y,u=L,c=P,d=v,p=M,f=I,y=R,g=J,_=V,b=O;return T(),j("div",Z,[w("div",null,[w("div",ee,[x(c,{gutter:10},{default:A((()=>[x(l,{span:18},{default:A((()=>[x(a,{modelValue:$(i),"onUpdate:modelValue":t[0]||(t[0]=e=>E(i)?i.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])])),_:1}),x(l,{span:6},{default:A((()=>[x(u,{modelValue:$(n),"onUpdate:modelValue":t[1]||(t[1]=e=>E(n)?n.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:A((()=>[(T(!0),j(k,null,U($(m),(e=>(T(),q(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),x(d,{class:"el-top",modelValue:$(h),"onUpdate:modelValue":t[2]||(t[2]=e=>E(h)?h.value=e:null)},null,8,["modelValue"]),w("div",te,[t[6]||(t[6]=w("h2",null,"发布设置",-1)),x(_,null,{default:A((()=>[x(y,{label:"封面"},{default:A((()=>[w("div",ae,[x(f,{class:"cover-uploader",action:"https://xxxx.com/api/common/upload",headers:r,"show-file-list":!1,"on-success":_e,"on-error":be,"before-upload":xe},{default:A((()=>[$(H)?(T(),j("img",{key:1,src:$(H),class:"cover-image"},null,8,se)):(T(),j("div",le,[x(p,{class:"upload-icon"},{default:A((()=>[x($(z))])),_:1}),t[4]||(t[4]=w("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1}),t[5]||(t[5]=w("div",{class:"el-upload__tip"},"建议尺寸 16:9，jpg/png 格式",-1))])])),_:1}),x(y,{label:"可见"},{default:A((()=>[x(g,{modelValue:$(K),"onUpdate:modelValue":t[3]||(t[3]=e=>E(K)?K.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1}),w("div",re,[x(b,{type:"primary",onClick:pe,style:{width:"100px"}},{default:A((()=>[C(N($(o)===$(X).Edit?"保存":"发布"),1)])),_:1})])])])])])}}}),[["__scopeId","data-v-ebf04123"]]);export{oe as default};
