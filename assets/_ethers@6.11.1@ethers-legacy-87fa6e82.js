System.register(["./_@noble_hashes@1.3.2@@noble-legacy-e7a6e0b8.js","./_@adraffy_ens-normalize@1.10.1@@adraffy-legacy-472412ad.js","./_@noble_curves@1.2.0@@noble-legacy-77177b83.js"],(function(t,e){"use strict";var r,n,s;return{setters:[t=>{r=t.k},t=>{n=t.e},t=>{s=t.s}],execute:function(){t({a:function(t,e){null==e&&(e={});const r=t=>"-"!==e[t]&&("string"==typeof e.exclusive?t===e.exclusive:!Array.isArray(e.exclusive)||-1!==e.exclusive.indexOf(t));if("string"==typeof t&&t.match(/^https?:/))return new Ni(t);if("string"==typeof t&&t.match(/^wss?:/)||(n=t)&&"function"==typeof n.send&&"function"==typeof n.close)return new ji(t);var n;let s=null;try{s=Cs.from(t)}catch(o){}const i=[];if(r("publicPolygon")&&s&&"matic"===s.name&&i.push(new Ni("https://polygon-rpc.com/",s,{staticNetwork:s})),r("alchemy"))try{i.push(new Ii(t,e.alchemy))}catch(o){}if(r("ankr")&&null!=e.ankr)try{i.push(new Oi(t,e.ankr))}catch(o){}if(r("cloudflare"))try{i.push(new Ai(t))}catch(o){}if(r("etherscan"))try{i.push(new Ci(t,e.etherscan))}catch(o){}if(r("infura"))try{let r,n=e.infura;"object"==typeof n&&(r=n.projectSecret,n=n.projectId),i.push(new Hi(t,n,r))}catch(o){}if(r("quicknode"))try{let r=e.quicknode;i.push(new Ji(t,r))}catch(o){}if(d(i.length,"unsupported default network","UNSUPPORTED_OPERATION",{operation:"getDefaultProvider"}),1===i.length)return i[0];let a=Math.floor(i.length/2);return a>2&&(a=2),s&&-1!==ia.indexOf(s.name)&&(a=1),e&&e.quorum&&(a=e.quorum),new sa(i,void 0,{quorum:a})},f:function(t,e){let r=18;if("string"==typeof e){const t=Ot.indexOf(e);f(t>=0,"invalid unit","unit",e),r=3*t}else null!=e&&(r=G(e,"unit"));return bt.fromValue(t,r,{decimals:r,width:512}).toString()},g:oe,p:function(t,e){f("string"==typeof t,"value must be a string","value",t);let r=18;if("string"==typeof e){const t=Ot.indexOf(e);f(t>=0,"invalid unit","unit",e),r=3*t}else null!=e&&(r=G(e,"unit"));return bt.fromString(t,{decimals:r,width:512}).value}});const e="6.11.1";function i(t,e,r){const n=e.split("|").map((t=>t.trim()));for(let i=0;i<n.length;i++)switch(e){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof t===e)return}const s=new Error(`invalid value for type ${e}`);throw s.code="INVALID_ARGUMENT",s.argument=`value.${r}`,s.value=t,s}async function a(t){const e=Object.keys(t);return(await Promise.all(e.map((e=>Promise.resolve(t[e]))))).reduce(((t,r,n)=>(t[e[n]]=r,t)),{})}function o(t,e,r){for(let n in e){let s=e[n];const a=r?r[n]:null;a&&i(s,a,n),Object.defineProperty(t,n,{enumerable:!0,value:s,writable:!1})}}function c(t){if(null==t)return"null";if(Array.isArray(t))return"[ "+t.map(c).join(", ")+" ]";if(t instanceof Uint8Array){const e="0123456789abcdef";let r="0x";for(let n=0;n<t.length;n++)r+=e[t[n]>>4],r+=e[15&t[n]];return r}if("object"==typeof t&&"function"==typeof t.toJSON)return c(t.toJSON());switch(typeof t){case"boolean":case"symbol":case"number":return t.toString();case"bigint":return BigInt(t).toString();case"string":return JSON.stringify(t);case"object":{const e=Object.keys(t);return e.sort(),"{ "+e.map((e=>`${c(e)}: ${c(t[e])}`)).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function l(t,e){return t&&t.code===e}function u(t){return l(t,"CALL_EXCEPTION")}function h(t,r,n){let s,i=t;{const s=[];if(n){if("message"in n||"code"in n||"name"in n)throw new Error(`value will overwrite populated values: ${c(n)}`);for(const t in n){if("shortMessage"===t)continue;const e=n[t];s.push(t+"="+c(e))}}s.push(`code=${r}`),s.push(`version=${e}`),s.length&&(t+=" ("+s.join(", ")+")")}switch(r){case"INVALID_ARGUMENT":s=new TypeError(t);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":s=new RangeError(t);break;default:s=new Error(t)}return o(s,{code:r}),n&&Object.assign(s,n),null==s.shortMessage&&o(s,{shortMessage:i}),s}function d(t,e,r,n){if(!t)throw h(e,r,n)}function f(t,e,r,n){d(t,e,"INVALID_ARGUMENT",{argument:r,value:n})}function p(t,e,r){null==r&&(r=""),r&&(r=": "+r),d(t>=e,"missing arguemnt"+r,"MISSING_ARGUMENT",{count:t,expectedCount:e}),d(t<=e,"too many arguments"+r,"UNEXPECTED_ARGUMENT",{count:t,expectedCount:e})}const g=["NFD","NFC","NFKD","NFKC"].reduce(((t,e)=>{try{if("test"!=="test".normalize(e))throw new Error("bad");if("NFD"===e){const t=String.fromCharCode(233).normalize("NFD");if(t!==String.fromCharCode(101,769))throw new Error("broken")}t.push(e)}catch(r){}return t}),[]);function m(t,e,r){if(null==r&&(r=""),t!==e){let t=r,e="new";r&&(t+=".",e+=" "+r),d(!1,`private constructor; use ${t}from* methods`,"UNSUPPORTED_OPERATION",{operation:e})}}function y(t,e,r){if(t instanceof Uint8Array)return r?new Uint8Array(t):t;if("string"==typeof t&&t.match(/^0x([0-9a-f][0-9a-f])*$/i)){const e=new Uint8Array((t.length-2)/2);let r=2;for(let n=0;n<e.length;n++)e[n]=parseInt(t.substring(r,r+2),16),r+=2;return e}f(!1,"invalid BytesLike value",e||"value",t)}function b(t,e){return y(t,e,!1)}function w(t,e){return y(t,e,!0)}function v(t,e){return!("string"!=typeof t||!t.match(/^0x[0-9A-Fa-f]*$/)||"number"==typeof e&&t.length!==2+2*e||!0===e&&t.length%2!=0)}const k="0123456789abcdef";function P(t){const e=b(t);let r="0x";for(let n=0;n<e.length;n++){const t=e[n];r+=k[(240&t)>>4]+k[15&t]}return r}function E(t){return"0x"+t.map((t=>P(t).substring(2))).join("")}function N(t){return v(t,!0)?(t.length-2)/2:b(t).length}function T(t,e,r){const n=b(t);return null!=r&&r>n.length&&d(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:n,length:n.length,offset:r}),P(n.slice(null==e?0:e,null==r?n.length:r))}function x(t,e,r){const n=b(t);d(e>=n.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(n),length:e,offset:e+1});const s=new Uint8Array(e);return s.fill(0),r?s.set(n,e-n.length):s.set(n,0),P(s)}function R(t,e){return x(t,e,!0)}const O=BigInt(0),_=BigInt(1),I=9007199254740991;function A(t,e){const r=U(t,"value"),n=BigInt(G(e,"width"));return d(r>>n===O,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:t}),r>>n-_?-((~r&(_<<n)-_)+_):r}function S(t,e){let r=C(t,"value");const n=BigInt(G(e,"width")),s=_<<n-_;return r<O?(r=-r,d(r<=s,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:t}),(~r&(_<<n)-_)+_):(d(r<s,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:t}),r)}function F(t,e){const r=U(t,"value"),n=BigInt(G(e,"bits"));return r&(_<<n)-_}function C(t,e){switch(typeof t){case"bigint":return t;case"number":return f(Number.isInteger(t),"underflow",e||"value",t),f(t>=-I&&t<=I,"overflow",e||"value",t),BigInt(t);case"string":try{if(""===t)throw new Error("empty string");return"-"===t[0]&&"-"!==t[1]?-BigInt(t.substring(1)):BigInt(t)}catch(r){f(!1,`invalid BigNumberish string: ${r.message}`,e||"value",t)}}f(!1,"invalid BigNumberish value",e||"value",t)}function U(t,e){const r=C(t,e);return d(r>=O,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:t}),r}const B="0123456789abcdef";function L(t){if(t instanceof Uint8Array){let e="0x0";for(const r of t)e+=B[r>>4],e+=B[15&r];return BigInt(e)}return C(t)}function G(t,e){switch(typeof t){case"bigint":return f(t>=-I&&t<=I,"overflow",e||"value",t),Number(t);case"number":return f(Number.isInteger(t),"underflow",e||"value",t),f(t>=-I&&t<=I,"overflow",e||"value",t),t;case"string":try{if(""===t)throw new Error("empty string");return G(BigInt(t),e)}catch(r){f(!1,`invalid numeric string: ${r.message}`,e||"value",t)}}f(!1,"invalid numeric value",e||"value",t)}function D(t,e){let r=U(t,"value").toString(16);if(null==e)r.length%2&&(r="0"+r);else{const n=G(e,"width");for(d(2*n>=r.length,`value exceeds width (${n} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:t});r.length<2*n;)r="0"+r}return"0x"+r}function $(t){const e=U(t,"value");if(e===O)return new Uint8Array([]);let r=e.toString(16);r.length%2&&(r="0"+r);const n=new Uint8Array(r.length/2);for(let s=0;s<n.length;s++){const t=2*s;n[s]=parseInt(r.substring(t,t+2),16)}return n}function j(t){let e=P(function(t){return v(t,!0)||t instanceof Uint8Array}(t)?t:$(t)).substring(2);for(;e.startsWith("0");)e=e.substring(1);return""===e&&(e="0"),"0x"+e}const M="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";BigInt(0);const V=BigInt(58);class H{filter;emitter;#t;constructor(t,e,r){this.#t=e,o(this,{emitter:t,filter:r})}async removeListener(){null!=this.#t&&await this.emitter.off(this.filter,this.#t)}}function q(t,e,r,n,s){if("BAD_PREFIX"===t||"UNEXPECTED_CONTINUE"===t){let t=0;for(let n=e+1;n<r.length&&r[n]>>6==2;n++)t++;return t}return"OVERRUN"===t?r.length-e-1:0}const J=Object.freeze({error:function(t,e,r,n,s){f(!1,`invalid codepoint at offset ${e}; ${t}`,"bytes",r)},ignore:q,replace:function(t,e,r,n,s){return"OVERLONG"===t?(f("number"==typeof s,"invalid bad code point for replacement","badCodepoint",s),n.push(s),0):(n.push(65533),q(t,e,r))}});function z(t,e){f("string"==typeof t,"invalid string value","str",t),null!=e&&(function(t){d(g.indexOf(t)>=0,"platform missing String.prototype.normalize","UNSUPPORTED_OPERATION",{operation:"String.prototype.normalize",info:{form:t}})}(e),t=t.normalize(e));let r=[];for(let n=0;n<t.length;n++){const e=t.charCodeAt(n);if(e<128)r.push(e);else if(e<2048)r.push(e>>6|192),r.push(63&e|128);else if(55296==(64512&e)){n++;const s=t.charCodeAt(n);f(n<t.length&&56320==(64512&s),"invalid surrogate pair","str",t);const i=65536+((1023&e)<<10)+(1023&s);r.push(i>>18|240),r.push(i>>12&63|128),r.push(i>>6&63|128),r.push(63&i|128)}else r.push(e>>12|224),r.push(e>>6&63|128),r.push(63&e|128)}return new Uint8Array(r)}function K(t,e){return r=function(t,e){null==e&&(e=J.error);const r=b(t,"bytes"),n=[];let s=0;for(;s<r.length;){const t=r[s++];if(!(t>>7)){n.push(t);continue}let i=null,a=null;if(192==(224&t))i=1,a=127;else if(224==(240&t))i=2,a=2047;else{if(240!=(248&t)){s+=e(128==(192&t)?"UNEXPECTED_CONTINUE":"BAD_PREFIX",s-1,r,n);continue}i=3,a=65535}if(s-1+i>=r.length){s+=e("OVERRUN",s-1,r,n);continue}let o=t&(1<<8-i-1)-1;for(let c=0;c<i;c++){let t=r[s];if(128!=(192&t)){s+=e("MISSING_CONTINUE",s,r,n),o=null;break}o=o<<6|63&t,s++}null!==o&&(o>1114111?s+=e("OUT_OF_RANGE",s-1-i,r,n,o):o>=55296&&o<=57343?s+=e("UTF16_SURROGATE",s-1-i,r,n,o):o<=a?s+=e("OVERLONG",s-1-i,r,n,o):n.push(o))}return n}(t,e),r.map((t=>t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10&1023),56320+(1023&t))))).join("");var r}function W(t){return async function(t,e){const r=t.url.split(":")[0].toLowerCase();let n;if(d("http"===r||"https"===r,`unsupported protocol ${r}`,"UNSUPPORTED_OPERATION",{info:{protocol:r},operation:"request"}),d("https"===r||!t.credentials||t.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"}),e){const t=new AbortController;n=t.signal,e.addListener((()=>{t.abort()}))}const s={method:t.method,headers:new Headers(Array.from(t)),body:t.body||void 0,signal:n},i=await fetch(t.url,s),a={};i.headers.forEach(((t,e)=>{a[e.toLowerCase()]=t}));const o=await i.arrayBuffer(),c=null==o?null:new Uint8Array(o);return{statusCode:i.status,statusMessage:i.statusText,headers:a,body:c}}}let X=W();const Z=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),Q=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let Y=!1;async function tt(t,e){try{const e=t.match(Z);if(!e)throw new Error("invalid data");return new ot(200,"OK",{"content-type":e[1]||"text/plain"},e[2]?function(t){t=atob(t);const e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return b(e)}(e[3]):z(e[3].replace(/%([0-9a-f][0-9a-f])/gi,((t,e)=>String.fromCharCode(parseInt(e,16))))))}catch(r){return new ot(599,"BAD REQUEST (invalid data: URI)",{},null,new at(t))}}function et(t){return async function(e,r){try{const r=e.match(Q);if(!r)throw new Error("invalid link");return new at(`${t}${r[2]}`)}catch(n){return new ot(599,"BAD REQUEST (invalid IPFS URI)",{},null,new at(e))}}}const rt={data:tt,ipfs:et("https://gateway.ipfs.io/ipfs/")},nt=new WeakMap;class st{#e;#r;constructor(t){this.#e=[],this.#r=!1,nt.set(t,(()=>{if(!this.#r){this.#r=!0;for(const t of this.#e)setTimeout((()=>{t()}),0);this.#e=[]}}))}addListener(t){d(!this.#r,"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),this.#e.push(t)}get cancelled(){return this.#r}checkSignal(){d(!this.cancelled,"cancelled","CANCELLED",{})}}function it(t){if(null==t)throw new Error("missing signal; should not happen");return t.checkSignal(),t}class at{#n;#s;#i;#a;#o;#c;#l;#u;#h;#d;#f;#p;#g;#m;#y;get url(){return this.#c}set url(t){this.#c=String(t)}get body(){return null==this.#l?null:new Uint8Array(this.#l)}set body(t){if(null==t)this.#l=void 0,this.#u=void 0;else if("string"==typeof t)this.#l=z(t),this.#u="text/plain";else if(t instanceof Uint8Array)this.#l=t,this.#u="application/octet-stream";else{if("object"!=typeof t)throw new Error("invalid body");this.#l=z(JSON.stringify(t)),this.#u="application/json"}}hasBody(){return null!=this.#l}get method(){return this.#a?this.#a:this.hasBody()?"POST":"GET"}set method(t){null==t&&(t=""),this.#a=String(t).toUpperCase()}get headers(){const t=Object.assign({},this.#i);return this.#h&&(t.authorization=`Basic ${function(t){const e=b(t);let r="";for(let n=0;n<e.length;n++)r+=String.fromCharCode(e[n]);return btoa(r)}(z(this.#h))}`),this.allowGzip&&(t["accept-encoding"]="gzip"),null==t["content-type"]&&this.#u&&(t["content-type"]=this.#u),this.body&&(t["content-length"]=String(this.body.length)),t}getHeader(t){return this.headers[t.toLowerCase()]}setHeader(t,e){this.#i[String(t).toLowerCase()]=String(e)}clearHeaders(){this.#i={}}[Symbol.iterator](){const t=this.headers,e=Object.keys(t);let r=0;return{next:()=>{if(r<e.length){const n=e[r++];return{value:[n,t[n]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return this.#h||null}setCredentials(t,e){f(!t.match(/:/),"invalid basic authentication username","username","[REDACTED]"),this.#h=`${t}:${e}`}get allowGzip(){return this.#s}set allowGzip(t){this.#s=!!t}get allowInsecureAuthentication(){return!!this.#n}set allowInsecureAuthentication(t){this.#n=!!t}get timeout(){return this.#o}set timeout(t){f(t>=0,"timeout must be non-zero","timeout",t),this.#o=t}get preflightFunc(){return this.#d||null}set preflightFunc(t){this.#d=t}get processFunc(){return this.#f||null}set processFunc(t){this.#f=t}get retryFunc(){return this.#p||null}set retryFunc(t){this.#p=t}get getUrlFunc(){return this.#y||X}set getUrlFunc(t){this.#y=t}constructor(t){this.#c=String(t),this.#n=!1,this.#s=!0,this.#i={},this.#a="",this.#o=3e5,this.#m={slotInterval:250,maxAttempts:12},this.#y=null}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${this.#l?P(this.#l):"null"}>`}setThrottleParams(t){null!=t.slotInterval&&(this.#m.slotInterval=t.slotInterval),null!=t.maxAttempts&&(this.#m.maxAttempts=t.maxAttempts)}async#b(t,e,r,n,s){if(t>=this.#m.maxAttempts)return s.makeServerError("exceeded maximum retry limit");d(ct()<=e,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:n}),r>0&&await function(t){return new Promise((e=>setTimeout(e,t)))}(r);let i=this.clone();const a=(i.url.split(":")[0]||"").toLowerCase();if(a in rt){const t=await rt[a](i.url,it(n.#g));if(t instanceof ot){let e=t;if(this.processFunc){it(n.#g);try{e=await this.processFunc(i,e)}catch(l){null!=l.throttle&&"number"==typeof l.stall||e.makeServerError("error in post-processing function",l).assertOk()}}return e}i=t}this.preflightFunc&&(i=await this.preflightFunc(i));const o=await this.getUrlFunc(i,it(n.#g));let c=new ot(o.statusCode,o.statusMessage,o.headers,o.body,n);if(301===c.statusCode||302===c.statusCode){try{const r=c.headers.location||"";return i.redirect(r).#b(t+1,e,0,n,c)}catch(l){}return c}if(429===c.statusCode&&(null==this.retryFunc||await this.retryFunc(i,c,t))){const r=c.headers["retry-after"];let s=this.#m.slotInterval*Math.trunc(Math.random()*Math.pow(2,t));return"string"==typeof r&&r.match(/^[1-9][0-9]*$/)&&(s=parseInt(r)),i.clone().#b(t+1,e,s,n,c)}if(this.processFunc){it(n.#g);try{c=await this.processFunc(i,c)}catch(l){null!=l.throttle&&"number"==typeof l.stall||c.makeServerError("error in post-processing function",l).assertOk();let r=this.#m.slotInterval*Math.trunc(Math.random()*Math.pow(2,t));return l.stall>=0&&(r=l.stall),i.clone().#b(t+1,e,r,n,c)}}return c}send(){return d(null==this.#g,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),this.#g=new st(this),this.#b(0,ct()+this.timeout,0,this,new ot(0,"",{},null,this))}cancel(){d(null!=this.#g,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const t=nt.get(this);if(!t)throw new Error("missing signal; should not happen");t()}redirect(t){const e=this.url.split(":")[0].toLowerCase(),r=t.split(":")[0].toLowerCase();d("GET"===this.method&&("https"!==e||"http"!==r)&&t.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(t)})`});const n=new at(t);return n.method="GET",n.allowGzip=this.allowGzip,n.timeout=this.timeout,n.#i=Object.assign({},this.#i),this.#l&&(n.#l=new Uint8Array(this.#l)),n.#u=this.#u,n}clone(){const t=new at(this.url);return t.#a=this.#a,this.#l&&(t.#l=this.#l),t.#u=this.#u,t.#i=Object.assign({},this.#i),t.#h=this.#h,this.allowGzip&&(t.allowGzip=!0),t.timeout=this.timeout,this.allowInsecureAuthentication&&(t.allowInsecureAuthentication=!0),t.#d=this.#d,t.#f=this.#f,t.#p=this.#p,t.#y=this.#y,t}static lockConfig(){Y=!0}static getGateway(t){return rt[t.toLowerCase()]||null}static registerGateway(t,e){if("http"===(t=t.toLowerCase())||"https"===t)throw new Error(`cannot intercept ${t}; use registerGetUrl`);if(Y)throw new Error("gateways locked");rt[t]=e}static registerGetUrl(t){if(Y)throw new Error("gateways locked");X=t}static createGetUrlFunc(t){return W()}static createDataGateway(){return tt}static createIpfsGatewayFunc(t){return et(t)}}class ot{#w;#v;#i;#l;#k;#P;toString(){return`<FetchResponse status=${this.statusCode} body=${this.#l?P(this.#l):"null"}>`}get statusCode(){return this.#w}get statusMessage(){return this.#v}get headers(){return Object.assign({},this.#i)}get body(){return null==this.#l?null:new Uint8Array(this.#l)}get bodyText(){try{return null==this.#l?"":K(this.#l)}catch(t){d(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch(t){d(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const t=this.headers,e=Object.keys(t);let r=0;return{next:()=>{if(r<e.length){const n=e[r++];return{value:[n,t[n]],done:!1}}return{value:void 0,done:!0}}}}constructor(t,e,r,n,s){this.#w=t,this.#v=e,this.#i=Object.keys(r).reduce(((t,e)=>(t[e.toLowerCase()]=String(r[e]),t)),{}),this.#l=null==n?null:new Uint8Array(n),this.#k=s||null,this.#P={message:""}}makeServerError(t,e){let r;r=t?`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${t})`:`CLIENT ESCALATED SERVER ERROR (${t=`${this.statusCode} ${this.statusMessage}`})`;const n=new ot(599,r,this.headers,this.body,this.#k||void 0);return n.#P={message:t,error:e},n}throwThrottleError(t,e){null==e?e=-1:f(Number.isInteger(e)&&e>=0,"invalid stall timeout","stall",e);const r=new Error(t||"throttling requests");throw o(r,{stall:e,throttle:!0}),r}getHeader(t){return this.headers[t.toLowerCase()]}hasBody(){return null!=this.#l}get request(){return this.#k}ok(){return""===this.#P.message&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:t,error:e}=this.#P;""===t&&(t=`server response ${this.statusCode} ${this.statusMessage}`);let r=null;this.request&&(r=this.request.url);let n=null;try{this.#l&&(n=K(this.#l))}catch(s){}d(!1,t,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:e,info:{requestUrl:r,responseBody:n,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}}function ct(){return(new Date).getTime()}const lt=BigInt(-1),ut=BigInt(0),ht=BigInt(1),dt=BigInt(5),ft={};let pt="0000";for(;pt.length<80;)pt+=pt;function gt(t){let e=pt;for(;e.length<t;)e+=e;return BigInt("1"+e.substring(0,t))}function mt(t,e,r){const n=BigInt(e.width);if(e.signed){const e=ht<<n-ht;d(null==r||t>=-e&&t<e,"overflow","NUMERIC_FAULT",{operation:r,fault:"overflow",value:t}),t=t>ut?A(F(t,n),n):-A(F(-t,n),n)}else{const e=ht<<n;d(null==r||t>=0&&t<e,"overflow","NUMERIC_FAULT",{operation:r,fault:"overflow",value:t}),t=(t%e+e)%e&e-ht}return t}function yt(t){"number"==typeof t&&(t=`fixed128x${t}`);let e=!0,r=128,n=18;if("string"==typeof t)if("fixed"===t);else if("ufixed"===t)e=!1;else{const s=t.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);f(s,"invalid fixed format","format",t),e="u"!==s[1],r=parseInt(s[2]),n=parseInt(s[3])}else if(t){const s=t,i=(t,e,r)=>null==s[t]?r:(f(typeof s[t]===e,"invalid fixed format ("+t+" not "+e+")","format."+t,s[t]),s[t]);e=i("signed","boolean",e),r=i("width","number",r),n=i("decimals","number",n)}return f(r%8==0,"invalid FixedNumber width (not byte aligned)","format.width",r),f(n<=80,"invalid FixedNumber decimals (too large)","format.decimals",n),{signed:e,width:r,decimals:n,name:(e?"":"u")+"fixed"+String(r)+"x"+String(n)}}class bt{format;#E;#N;#T;_value;constructor(t,e,r){m(t,ft,"FixedNumber"),this.#N=e,this.#E=r;const n=function(t,e){let r="";t<ut&&(r="-",t*=lt);let n=t.toString();if(0===e)return r+n;for(;n.length<=e;)n=pt+n;const s=n.length-e;for(n=n.substring(0,s)+"."+n.substring(s);"0"===n[0]&&"."!==n[1];)n=n.substring(1);for(;"0"===n[n.length-1]&&"."!==n[n.length-2];)n=n.substring(0,n.length-1);return r+n}(e,r.decimals);o(this,{format:r.name,_value:n}),this.#T=gt(r.decimals)}get signed(){return this.#E.signed}get width(){return this.#E.width}get decimals(){return this.#E.decimals}get value(){return this.#N}#x(t){f(this.format===t.format,"incompatible format; use fixedNumber.toFormat","other",t)}#R(t,e){return t=mt(t,this.#E,e),new bt(ft,t,this.#E)}#O(t,e){return this.#x(t),this.#R(this.#N+t.#N,e)}addUnsafe(t){return this.#O(t)}add(t){return this.#O(t,"add")}#_(t,e){return this.#x(t),this.#R(this.#N-t.#N,e)}subUnsafe(t){return this.#_(t)}sub(t){return this.#_(t,"sub")}#I(t,e){return this.#x(t),this.#R(this.#N*t.#N/this.#T,e)}mulUnsafe(t){return this.#I(t)}mul(t){return this.#I(t,"mul")}mulSignal(t){this.#x(t);const e=this.#N*t.#N;return d(e%this.#T===ut,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),this.#R(e/this.#T,"mulSignal")}#A(t,e){return d(t.#N!==ut,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),this.#x(t),this.#R(this.#N*this.#T/t.#N,e)}divUnsafe(t){return this.#A(t)}div(t){return this.#A(t,"div")}divSignal(t){d(t.#N!==ut,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),this.#x(t);const e=this.#N*this.#T;return d(e%t.#N===ut,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),this.#R(e/t.#N,"divSignal")}cmp(t){let e=this.value,r=t.value;const n=this.decimals-t.decimals;return n>0?r*=gt(n):n<0&&(e*=gt(-n)),e<r?-1:e>r?1:0}eq(t){return 0===this.cmp(t)}lt(t){return this.cmp(t)<0}lte(t){return this.cmp(t)<=0}gt(t){return this.cmp(t)>0}gte(t){return this.cmp(t)>=0}floor(){let t=this.#N;return this.#N<ut&&(t-=this.#T-ht),t=this.#N/this.#T*this.#T,this.#R(t,"floor")}ceiling(){let t=this.#N;return this.#N>ut&&(t+=this.#T-ht),t=this.#N/this.#T*this.#T,this.#R(t,"ceiling")}round(t){if(null==t&&(t=0),t>=this.decimals)return this;const e=this.decimals-t,r=dt*gt(e-1);let n=this.value+r;const s=gt(e);return n=n/s*s,mt(n,this.#E,"round"),new bt(ft,n,this.#E)}isZero(){return this.#N===ut}isNegative(){return this.#N<ut}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return bt.fromString(this.toString(),t)}static fromValue(t,e,r){const n=null==e?0:G(e),s=yt(r);let i=C(t,"value");const a=n-s.decimals;if(a>0){const e=gt(a);d(i%e===ut,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:t}),i/=e}else a<0&&(i*=gt(-a));return mt(i,s,"fromValue"),new bt(ft,i,s)}static fromString(t,e){const r=t.match(/^(-?)([0-9]*)\.?([0-9]*)$/);f(r&&r[2].length+r[3].length>0,"invalid FixedNumber string value","value",t);const n=yt(e);let s=r[2]||"0",i=r[3]||"";for(;i.length<n.decimals;)i+=pt;d(i.substring(n.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:t}),i=i.substring(0,n.decimals);const a=BigInt(r[1]+s+i);return mt(a,n,"fromString"),new bt(ft,a,n)}static fromBytes(t,e){let r=L(b(t,"value"));const n=yt(e);return n.signed&&(r=A(r,n.width)),mt(r,n,"fromBytes"),new bt(ft,r,n)}}function wt(t){let e=t.toString(16);for(;e.length<2;)e="0"+e;return"0x"+e}function vt(t,e,r){let n=0;for(let s=0;s<r;s++)n=256*n+t[e+s];return n}function kt(t,e,r,n){const s=[];for(;r<e+1+n;){const i=Pt(t,r);s.push(i.result),d((r+=i.consumed)<=e+1+n,"child data too short","BUFFER_OVERRUN",{buffer:t,length:n,offset:e})}return{consumed:1+n,result:s}}function Pt(t,e){d(0!==t.length,"data too short","BUFFER_OVERRUN",{buffer:t,length:0,offset:1});const r=e=>{d(e<=t.length,"data short segment too short","BUFFER_OVERRUN",{buffer:t,length:t.length,offset:e})};if(t[e]>=248){const n=t[e]-247;r(e+1+n);const s=vt(t,e+1,n);return r(e+1+n+s),kt(t,e,e+1+n,n+s)}if(t[e]>=192){const n=t[e]-192;return r(e+1+n),kt(t,e,e+1,n)}if(t[e]>=184){const n=t[e]-183;r(e+1+n);const s=vt(t,e+1,n);return r(e+1+n+s),{consumed:1+n+s,result:P(t.slice(e+1+n,e+1+n+s))}}if(t[e]>=128){const n=t[e]-128;return r(e+1+n),{consumed:1+n,result:P(t.slice(e+1,e+1+n))}}return{consumed:1,result:wt(t[e])}}function Et(t){const e=b(t,"data"),r=Pt(e,0);return f(r.consumed===e.length,"unexpected junk after rlp payload","data",t),r.result}function Nt(t){const e=[];for(;t;)e.unshift(255&t),t>>=8;return e}function Tt(t){if(Array.isArray(t)){let e=[];if(t.forEach((function(t){e=e.concat(Tt(t))})),e.length<=55)return e.unshift(192+e.length),e;const r=Nt(e.length);return r.unshift(247+r.length),r.concat(e)}const e=Array.prototype.slice.call(b(t,"object"));if(1===e.length&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const r=Nt(e.length);return r.unshift(183+r.length),r.concat(e)}const xt="0123456789abcdef";function Rt(t){let e="0x";for(const r of Tt(t))e+=xt[r>>4],e+=xt[15&r];return e}const Ot=["wei","kwei","mwei","gwei","szabo","finney","ether"],_t=32,It=new Uint8Array(_t),At=["then"],St={};function Ft(t,e){const r=new Error(`deferred error during ABI decoding triggered accessing ${t}`);throw r.error=e,r}class Ct extends Array{#S;constructor(...t){const e=t[0];let r=t[1],n=(t[2]||[]).slice(),s=!0;e!==St&&(r=t,n=[],s=!1),super(r.length),r.forEach(((t,e)=>{this[e]=t}));const i=n.reduce(((t,e)=>("string"==typeof e&&t.set(e,(t.get(e)||0)+1),t)),new Map);if(this.#S=Object.freeze(r.map(((t,e)=>{const r=n[e];return null!=r&&1===i.get(r)?r:null}))),s)return Object.freeze(this),new Proxy(this,{get:(t,e,r)=>{if("string"==typeof e){if(e.match(/^[0-9]+$/)){const r=G(e,"%index");if(r<0||r>=this.length)throw new RangeError("out of result range");const n=t[r];return n instanceof Error&&Ft(`index ${r}`,n),n}if(At.indexOf(e)>=0)return Reflect.get(t,e,r);const n=t[e];if(n instanceof Function)return function(...e){return n.apply(this===r?t:this,e)};if(!(e in t))return t.getValue.apply(this===r?t:this,[e])}return Reflect.get(t,e,r)}})}toArray(){const t=[];return this.forEach(((e,r)=>{e instanceof Error&&Ft(`index ${r}`,e),t.push(e)})),t}toObject(){return this.#S.reduce(((t,e,r)=>(d(null!=e,"value at index ${ index } unnamed","UNSUPPORTED_OPERATION",{operation:"toObject()"}),e in t||(t[e]=this.getValue(e)),t)),{})}slice(t,e){null==t&&(t=0),t<0&&(t+=this.length)<0&&(t=0),null==e&&(e=this.length),e<0&&(e+=this.length)<0&&(e=0),e>this.length&&(e=this.length);const r=[],n=[];for(let s=t;s<e;s++)r.push(this[s]),n.push(this.#S[s]);return new Ct(St,r,n)}filter(t,e){const r=[],n=[];for(let s=0;s<this.length;s++){const i=this[s];i instanceof Error&&Ft(`index ${s}`,i),t.call(e,i,s,this)&&(r.push(i),n.push(this.#S[s]))}return new Ct(St,r,n)}map(t,e){const r=[];for(let n=0;n<this.length;n++){const s=this[n];s instanceof Error&&Ft(`index ${n}`,s),r.push(t.call(e,s,n,this))}return r}getValue(t){const e=this.#S.indexOf(t);if(-1===e)return;const r=this[e];return r instanceof Error&&Ft(`property ${JSON.stringify(t)}`,r.error),r}static fromItems(t,e){return new Ct(St,t,e)}}function Ut(t){let e=$(t);return d(e.length<=_t,"value out-of-bounds","BUFFER_OVERRUN",{buffer:e,length:_t,offset:e.length}),e.length!==_t&&(e=w(E([It.slice(e.length%_t),e]))),e}class Bt{name;type;localName;dynamic;constructor(t,e,r,n){o(this,{name:t,type:e,localName:r,dynamic:n},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(t,e){f(!1,t,this.localName,e)}}class Lt{#F;#C;constructor(){this.#F=[],this.#C=0}get data(){return E(this.#F)}get length(){return this.#C}#U(t){return this.#F.push(t),this.#C+=t.length,t.length}appendWriter(t){return this.#U(w(t.data))}writeBytes(t){let e=w(t);const r=e.length%_t;return r&&(e=w(E([e,It.slice(r)]))),this.#U(e)}writeValue(t){return this.#U(Ut(t))}writeUpdatableValue(){const t=this.#F.length;return this.#F.push(It),this.#C+=_t,e=>{this.#F[t]=Ut(e)}}}class Gt{allowLoose;#F;#B;#L;#G;#D;constructor(t,e,r){o(this,{allowLoose:!!e}),this.#F=w(t),this.#L=0,this.#G=null,this.#D=null!=r?r:1024,this.#B=0}get data(){return P(this.#F)}get dataLength(){return this.#F.length}get consumed(){return this.#B}get bytes(){return new Uint8Array(this.#F)}#$(t){if(this.#G)return this.#G.#$(t);this.#L+=t,d(this.#D<1||this.#L<=this.#D*this.dataLength,`compressed ABI data exceeds inflation ratio of ${this.#D} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:w(this.#F),offset:this.#B,length:t,info:{bytesRead:this.#L,dataLength:this.dataLength}})}#j(t,e,r){let n=Math.ceil(e/_t)*_t;return this.#B+n>this.#F.length&&(this.allowLoose&&r&&this.#B+e<=this.#F.length?n=e:d(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:w(this.#F),length:this.#F.length,offset:this.#B+n})),this.#F.slice(this.#B,this.#B+n)}subReader(t){const e=new Gt(this.#F.slice(this.#B+t),this.allowLoose,this.#D);return e.#G=this,e}readBytes(t,e){let r=this.#j(0,t,!!e);return this.#$(t),this.#B+=r.length,r.slice(0,t)}readValue(){return L(this.readBytes(_t))}readIndex(){return G(L(this.readBytes(_t)))}}let Dt=!1;const $t=function(t){return r(t)};let jt=$t;function Mt(t){const e=b(t,"data");return P(jt(e))}Mt._=$t,Mt.lock=function(){Dt=!0},Mt.register=function(t){if(Dt)throw new TypeError("keccak256 is locked");jt=t},Object.freeze(Mt);const Vt="0x0000000000000000000000000000000000000000",Ht="0x0000000000000000000000000000000000000000000000000000000000000000",qt=BigInt(0),Jt=BigInt(1),zt=BigInt(2),Kt=BigInt(27),Wt=BigInt(28),Xt=BigInt(35),Zt={};function Qt(t){return R($(t),32)}class Yt{#M;#V;#H;#q;get r(){return this.#M}set r(t){f(32===N(t),"invalid r","value",t),this.#M=P(t)}get s(){return this.#V}set s(t){f(32===N(t),"invalid s","value",t);const e=P(t);f(parseInt(e.substring(0,3))<8,"non-canonical s","value",e),this.#V=e}get v(){return this.#H}set v(t){const e=G(t,"value");f(27===e||28===e,"invalid v","v",t),this.#H=e}get networkV(){return this.#q}get legacyChainId(){const t=this.networkV;return null==t?null:Yt.getChainId(t)}get yParity(){return 27===this.v?0:1}get yParityAndS(){const t=b(this.s);return this.yParity&&(t[0]|=128),P(t)}get compactSerialized(){return E([this.r,this.yParityAndS])}get serialized(){return E([this.r,this.s,this.yParity?"0x1c":"0x1b"])}constructor(t,e,r,n){m(t,Zt,"Signature"),this.#M=e,this.#V=r,this.#H=n,this.#q=null}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this.s}", yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){const t=new Yt(Zt,this.r,this.s,this.v);return this.networkV&&(t.#q=this.networkV),t}toJSON(){const t=this.networkV;return{_type:"signature",networkV:null!=t?t.toString():null,r:this.r,s:this.s,v:this.v}}static getChainId(t){const e=C(t,"v");return e==Kt||e==Wt?qt:(f(e>=Xt,"invalid EIP-155 v","v",t),(e-Xt)/zt)}static getChainIdV(t,e){return C(t)*zt+BigInt(35+e-27)}static getNormalizedV(t){const e=C(t);return e===qt||e===Kt?27:e===Jt||e===Wt?28:(f(e>=Xt,"invalid v","v",t),e&Jt?27:28)}static from(t){function e(e,r){f(e,r,"signature",t)}if(null==t)return new Yt(Zt,Ht,Ht,27);if("string"==typeof t){const r=b(t,"signature");if(64===r.length){const t=P(r.slice(0,32)),e=r.slice(32,64),n=128&e[0]?28:27;return e[0]&=127,new Yt(Zt,t,P(e),n)}if(65===r.length){const t=P(r.slice(0,32)),n=r.slice(32,64);e(!(128&n[0]),"non-canonical s");const s=Yt.getNormalizedV(r[64]);return new Yt(Zt,t,P(n),s)}e(!1,"invalid raw signature length")}if(t instanceof Yt)return t.clone();const r=t.r;e(null!=r,"missing r");const n=Qt(r),s=function(t,r){if(null!=t)return Qt(t);if(null!=r){e(v(r,32),"invalid yParityAndS");const t=b(r);return t[0]&=127,P(t)}e(!1,"missing s")}(t.s,t.yParityAndS);e(!(128&b(s)[0]),"non-canonical s");const{networkV:i,v:a}=function(t,r,n){if(null!=t){const e=C(t);return{networkV:e>=Xt?e:void 0,v:Yt.getNormalizedV(e)}}if(null!=r)return e(v(r,32),"invalid yParityAndS"),{v:128&b(r)[0]?28:27};if(null!=n){switch(G(n,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}e(!1,"invalid yParity")}e(!1,"missing v")}(t.v,t.yParityAndS,t.yParity),o=new Yt(Zt,n,s,a);return i&&(o.#q=i),e(null==t.yParity||G(t.yParity,"sig.yParity")===o.yParity,"yParity mismatch"),e(null==t.yParityAndS||t.yParityAndS===o.yParityAndS,"yParityAndS mismatch"),o}}class te{#J;constructor(t){f(32===N(t),"invalid private key","privateKey","[REDACTED]"),this.#J=P(t)}get privateKey(){return this.#J}get publicKey(){return te.computePublicKey(this.#J)}get compressedPublicKey(){return te.computePublicKey(this.#J,!0)}sign(t){f(32===N(t),"invalid digest length","digest",t);const e=s.sign(w(t),w(this.#J),{lowS:!0});return Yt.from({r:D(e.r,32),s:D(e.s,32),v:e.recovery?28:27})}computeSharedSecret(t){const e=te.computePublicKey(t);return P(s.getSharedSecret(w(this.#J),b(e),!1))}static computePublicKey(t,e){let r=b(t,"key");if(32===r.length)return P(s.getPublicKey(r,!!e));if(64===r.length){const t=new Uint8Array(65);t[0]=4,t.set(r,1),r=t}return P(s.ProjectivePoint.fromHex(r).toRawBytes(e))}static recoverPublicKey(t,e){f(32===N(t),"invalid digest length","digest",t);const r=Yt.from(e);let n=s.Signature.fromCompact(w(E([r.r,r.s])));n=n.addRecoveryBit(r.yParity);const i=n.recoverPublicKey(w(t));return f(null!=i,"invalid signautre for digest","signature",e),"0x"+i.toHex(!1)}static addPoints(t,e,r){const n=s.ProjectivePoint.fromHex(te.computePublicKey(t).substring(2)),i=s.ProjectivePoint.fromHex(te.computePublicKey(e).substring(2));return"0x"+n.add(i).toHex(!!r)}}const ee=BigInt(0),re=BigInt(36);function ne(t){const e=(t=t.toLowerCase()).substring(2).split(""),r=new Uint8Array(40);for(let s=0;s<40;s++)r[s]=e[s].charCodeAt(0);const n=b(Mt(r));for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&(e[s]=e[s].toUpperCase()),(15&n[s>>1])>=8&&(e[s+1]=e[s+1].toUpperCase());return"0x"+e.join("")}const se={};for(let t=0;t<10;t++)se[String(t)]=String(t);for(let t=0;t<26;t++)se[String.fromCharCode(65+t)]=String(10+t);const ie=15,ae=function(){const t={};for(let e=0;e<36;e++)t["0123456789abcdefghijklmnopqrstuvwxyz"[e]]=BigInt(e);return t}();function oe(t){if(f("string"==typeof t,"invalid address","address",t),t.match(/^(0x)?[0-9a-fA-F]{40}$/)){t.startsWith("0x")||(t="0x"+t);const e=ne(t);return f(!t.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||e===t,"bad address checksum","address",t),e}if(t.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){f(t.substring(2,4)===function(t){let e=(t=(t=t.toUpperCase()).substring(4)+t.substring(0,2)+"00").split("").map((t=>se[t])).join("");for(;e.length>=ie;){let t=e.substring(0,ie);e=parseInt(t,10)%97+e.substring(t.length)}let r=String(98-parseInt(e,10)%97);for(;r.length<2;)r="0"+r;return r}(t),"bad icap checksum","address",t);let e=function(t){t=t.toLowerCase();let e=ee;for(let r=0;r<t.length;r++)e=e*re+ae[t[r]];return e}(t.substring(4)).toString(16);for(;e.length<40;)e="0"+e;return ne("0x"+e)}f(!1,"invalid address","address",t)}function ce(t){return t&&"function"==typeof t.getAddress}async function le(t,e){const r=await e;return null!=r&&"0x0000000000000000000000000000000000000000"!==r||(d("string"!=typeof t,"unconfigured name","UNCONFIGURED_NAME",{value:t}),f(!1,"invalid AddressLike value; did not resolve to a value address","target",t)),oe(r)}function ue(t,e){return"string"==typeof t?t.match(/^0x[0-9a-f]{40}$/i)?oe(t):(d(null!=e,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),le(t,e.resolveName(t))):ce(t)?le(t,t.getAddress()):t&&"function"==typeof t.then?le(t,t):void f(!1,"unsupported addressable value","target",t)}const he={};function de(t,e){let r=!1;return e<0&&(r=!0,e*=-1),new ge(he,`${r?"":"u"}int${e}`,t,{signed:r,width:e})}function fe(t,e){return new ge(he,`bytes${e||""}`,t,{size:e})}const pe=Symbol.for("_ethers_typed");class ge{type;value;#z;_typedSymbol;constructor(t,e,r,n){null==n&&(n=null),m(he,t,"Typed"),o(this,{_typedSymbol:pe,type:e,value:r}),this.#z=n,this.format()}format(){if("array"===this.type)throw new Error("");if("dynamicArray"===this.type)throw new Error("");return"tuple"===this.type?`tuple(${this.value.map((t=>t.format())).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return"string"===this.type}get tupleName(){if("tuple"!==this.type)throw TypeError("not a tuple");return this.#z}get arrayLength(){if("array"!==this.type)throw TypeError("not an array");return!0===this.#z?-1:!1===this.#z?this.value.length:null}static from(t,e){return new ge(he,t,e)}static uint8(t){return de(t,8)}static uint16(t){return de(t,16)}static uint24(t){return de(t,24)}static uint32(t){return de(t,32)}static uint40(t){return de(t,40)}static uint48(t){return de(t,48)}static uint56(t){return de(t,56)}static uint64(t){return de(t,64)}static uint72(t){return de(t,72)}static uint80(t){return de(t,80)}static uint88(t){return de(t,88)}static uint96(t){return de(t,96)}static uint104(t){return de(t,104)}static uint112(t){return de(t,112)}static uint120(t){return de(t,120)}static uint128(t){return de(t,128)}static uint136(t){return de(t,136)}static uint144(t){return de(t,144)}static uint152(t){return de(t,152)}static uint160(t){return de(t,160)}static uint168(t){return de(t,168)}static uint176(t){return de(t,176)}static uint184(t){return de(t,184)}static uint192(t){return de(t,192)}static uint200(t){return de(t,200)}static uint208(t){return de(t,208)}static uint216(t){return de(t,216)}static uint224(t){return de(t,224)}static uint232(t){return de(t,232)}static uint240(t){return de(t,240)}static uint248(t){return de(t,248)}static uint256(t){return de(t,256)}static uint(t){return de(t,256)}static int8(t){return de(t,-8)}static int16(t){return de(t,-16)}static int24(t){return de(t,-24)}static int32(t){return de(t,-32)}static int40(t){return de(t,-40)}static int48(t){return de(t,-48)}static int56(t){return de(t,-56)}static int64(t){return de(t,-64)}static int72(t){return de(t,-72)}static int80(t){return de(t,-80)}static int88(t){return de(t,-88)}static int96(t){return de(t,-96)}static int104(t){return de(t,-104)}static int112(t){return de(t,-112)}static int120(t){return de(t,-120)}static int128(t){return de(t,-128)}static int136(t){return de(t,-136)}static int144(t){return de(t,-144)}static int152(t){return de(t,-152)}static int160(t){return de(t,-160)}static int168(t){return de(t,-168)}static int176(t){return de(t,-176)}static int184(t){return de(t,-184)}static int192(t){return de(t,-192)}static int200(t){return de(t,-200)}static int208(t){return de(t,-208)}static int216(t){return de(t,-216)}static int224(t){return de(t,-224)}static int232(t){return de(t,-232)}static int240(t){return de(t,-240)}static int248(t){return de(t,-248)}static int256(t){return de(t,-256)}static int(t){return de(t,-256)}static bytes1(t){return fe(t,1)}static bytes2(t){return fe(t,2)}static bytes3(t){return fe(t,3)}static bytes4(t){return fe(t,4)}static bytes5(t){return fe(t,5)}static bytes6(t){return fe(t,6)}static bytes7(t){return fe(t,7)}static bytes8(t){return fe(t,8)}static bytes9(t){return fe(t,9)}static bytes10(t){return fe(t,10)}static bytes11(t){return fe(t,11)}static bytes12(t){return fe(t,12)}static bytes13(t){return fe(t,13)}static bytes14(t){return fe(t,14)}static bytes15(t){return fe(t,15)}static bytes16(t){return fe(t,16)}static bytes17(t){return fe(t,17)}static bytes18(t){return fe(t,18)}static bytes19(t){return fe(t,19)}static bytes20(t){return fe(t,20)}static bytes21(t){return fe(t,21)}static bytes22(t){return fe(t,22)}static bytes23(t){return fe(t,23)}static bytes24(t){return fe(t,24)}static bytes25(t){return fe(t,25)}static bytes26(t){return fe(t,26)}static bytes27(t){return fe(t,27)}static bytes28(t){return fe(t,28)}static bytes29(t){return fe(t,29)}static bytes30(t){return fe(t,30)}static bytes31(t){return fe(t,31)}static bytes32(t){return fe(t,32)}static address(t){return new ge(he,"address",t)}static bool(t){return new ge(he,"bool",!!t)}static bytes(t){return new ge(he,"bytes",t)}static string(t){return new ge(he,"string",t)}static array(t,e){throw new Error("not implemented yet")}static tuple(t,e){throw new Error("not implemented yet")}static overrides(t){return new ge(he,"overrides",Object.assign({},t))}static isTyped(t){return t&&"object"==typeof t&&"_typedSymbol"in t&&t._typedSymbol===pe}static dereference(t,e){if(ge.isTyped(t)){if(t.type!==e)throw new Error(`invalid type: expecetd ${e}, got ${t.type}`);return t.value}return t}}class me extends Bt{constructor(t){super("address","address",t,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(t,e){let r=ge.dereference(e,"string");try{r=oe(r)}catch(n){return this._throwError(n.message,e)}return t.writeValue(r)}decode(t){return oe(D(t.readValue(),20))}}class ye extends Bt{coder;constructor(t){super(t.name,t.type,"_",t.dynamic),this.coder=t}defaultValue(){return this.coder.defaultValue()}encode(t,e){return this.coder.encode(t,e)}decode(t){return this.coder.decode(t)}}function be(t,e,r){let n=[];if(Array.isArray(r))n=r;else if(r&&"object"==typeof r){let t={};n=e.map((e=>{const n=e.localName;return d(n,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:e},value:r}),d(!t[n],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:e},value:r}),t[n]=!0,r[n]}))}else f(!1,"invalid tuple value","tuple",r);f(e.length===n.length,"types/value length mismatch","tuple",r);let s=new Lt,i=new Lt,a=[];e.forEach(((t,e)=>{let r=n[e];if(t.dynamic){let e=i.length;t.encode(i,r);let n=s.writeUpdatableValue();a.push((t=>{n(t+e)}))}else t.encode(s,r)})),a.forEach((t=>{t(s.length)}));let o=t.appendWriter(s);return o+=t.appendWriter(i),o}function we(t,e){let r=[],n=[],s=t.subReader(0);return e.forEach((e=>{let i=null;if(e.dynamic){let r=t.readIndex(),n=s.subReader(r);try{i=e.decode(n)}catch(a){if(l(a,"BUFFER_OVERRUN"))throw a;i=a,i.baseType=e.name,i.name=e.localName,i.type=e.type}}else try{i=e.decode(t)}catch(a){if(l(a,"BUFFER_OVERRUN"))throw a;i=a,i.baseType=e.name,i.name=e.localName,i.type=e.type}if(null==i)throw new Error("investigate");r.push(i),n.push(e.localName||null)})),Ct.fromItems(r,n)}class ve extends Bt{coder;length;constructor(t,e,r){super("array",t.type+"["+(e>=0?e:"")+"]",r,-1===e||t.dynamic),o(this,{coder:t,length:e})}defaultValue(){const t=this.coder.defaultValue(),e=[];for(let r=0;r<this.length;r++)e.push(t);return e}encode(t,e){const r=ge.dereference(e,"array");Array.isArray(r)||this._throwError("expected array value",r);let n=this.length;-1===n&&(n=r.length,t.writeValue(r.length)),p(r.length,n,"coder array"+(this.localName?" "+this.localName:""));let s=[];for(let i=0;i<r.length;i++)s.push(this.coder);return be(t,s,r)}decode(t){let e=this.length;-1===e&&(e=t.readIndex(),d(e*_t<=t.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:t.bytes,offset:e*_t,length:t.dataLength}));let r=[];for(let n=0;n<e;n++)r.push(new ye(this.coder));return we(t,r)}}class ke extends Bt{constructor(t){super("bool","bool",t,!1)}defaultValue(){return!1}encode(t,e){const r=ge.dereference(e,"bool");return t.writeValue(r?1:0)}decode(t){return!!t.readValue()}}class Pe extends Bt{constructor(t,e){super(t,t,e,!0)}defaultValue(){return"0x"}encode(t,e){e=w(e);let r=t.writeValue(e.length);return r+=t.writeBytes(e),r}decode(t){return t.readBytes(t.readIndex(),!0)}}class Ee extends Pe{constructor(t){super("bytes",t)}decode(t){return P(super.decode(t))}}class Ne extends Bt{size;constructor(t,e){let r="bytes"+String(t);super(r,r,e,!1),o(this,{size:t},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+2*this.size)}encode(t,e){let r=w(ge.dereference(e,this.type));return r.length!==this.size&&this._throwError("incorrect data length",e),t.writeBytes(r)}decode(t){return P(t.readBytes(this.size))}}const Te=new Uint8Array([]);class xe extends Bt{constructor(t){super("null","",t,!1)}defaultValue(){return null}encode(t,e){return null!=e&&this._throwError("not null",e),t.writeBytes(Te)}decode(t){return t.readBytes(0),null}}const Re=BigInt(0),Oe=BigInt(1),_e=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class Ie extends Bt{size;signed;constructor(t,e,r){const n=(e?"int":"uint")+8*t;super(n,n,r,!1),o(this,{size:t,signed:e},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(t,e){let r=C(ge.dereference(e,this.type)),n=F(_e,256);if(this.signed){let t=F(n,8*this.size-1);(r>t||r<-(t+Oe))&&this._throwError("value out-of-bounds",e),r=S(r,256)}else(r<Re||r>F(n,8*this.size))&&this._throwError("value out-of-bounds",e);return t.writeValue(r)}decode(t){let e=F(t.readValue(),8*this.size);return this.signed&&(e=A(e,8*this.size)),e}}class Ae extends Pe{constructor(t){super("string",t)}defaultValue(){return""}encode(t,e){return super.encode(t,z(ge.dereference(e,"string")))}decode(t){return K(super.decode(t))}}class Se extends Bt{coders;constructor(t,e){let r=!1;const n=[];t.forEach((t=>{t.dynamic&&(r=!0),n.push(t.type)})),super("tuple","tuple("+n.join(",")+")",e,r),o(this,{coders:Object.freeze(t.slice())})}defaultValue(){const t=[];this.coders.forEach((e=>{t.push(e.defaultValue())}));const e=this.coders.reduce(((t,e)=>{const r=e.localName;return r&&(t[r]||(t[r]=0),t[r]++),t}),{});return this.coders.forEach(((r,n)=>{let s=r.localName;s&&1===e[s]&&("length"===s&&(s="_length"),null==t[s]&&(t[s]=t[n]))})),Object.freeze(t)}encode(t,e){const r=ge.dereference(e,"tuple");return be(t,this.coders,r)}decode(t){return we(t,this.coders)}}function Fe(t){return Mt(z(t))}const Ce=new Uint8Array(32);function Ue(t){return f(0!==t.length,"invalid ENS name; empty component","comp",t),t}function Be(t){const e=z(function(t){try{if(0===t.length)throw new Error("empty label");return n(t)}catch(e){f(!1,`invalid ENS name (${e.message})`,"name",t)}}(t)),r=[];if(0===t.length)return r;let s=0;for(let n=0;n<e.length;n++)46===e[n]&&(r.push(Ue(e.slice(s,n))),s=n+1);return f(s<e.length,"invalid ENS name; empty component","name",t),r.push(Ue(e.slice(s))),r}function Le(t){f("string"==typeof t,"invalid ENS name; not a string","name",t),f(t.length,"invalid ENS name (empty label)","name",t);let e=Ce;const r=Be(t);for(;r.length;)e=Mt(E([e,Mt(r.pop())]));return P(e)}function Ge(t,e){const r=null!=e?e:63;return f(r<=255,"DNS encoded label cannot exceed 255","length",r),P(E(Be(t).map((e=>{f(e.length<=r,`label ${JSON.stringify(t)} exceeds ${r} bytes`,"name",t);const n=new Uint8Array(e.length+1);return n.set(e,1),n[0]=n.length-1,n}))))+"00"}function De(t,e){return{address:oe(t),storageKeys:e.map(((t,e)=>(f(v(t,32),"invalid slot",`storageKeys[${e}]`,t),t.toLowerCase())))}}function $e(t){if(Array.isArray(t))return t.map(((e,r)=>Array.isArray(e)?(f(2===e.length,"invalid slot set",`value[${r}]`,e),De(e[0],e[1])):(f(null!=e&&"object"==typeof e,"invalid address-slot set","value",t),De(e.address,e.storageKeys))));f(null!=t&&"object"==typeof t,"invalid access list","value",t);const e=Object.keys(t).map((e=>{const r=t[e].reduce(((t,e)=>(t[e]=!0,t)),{});return De(e,Object.keys(r).sort())}));return e.sort(((t,e)=>t.address.localeCompare(e.address))),e}function je(t,e){return function(t){let e;return e="string"==typeof t?te.computePublicKey(t,!1):t.publicKey,oe(Mt("0x"+e.substring(4)).substring(26))}(te.recoverPublicKey(t,e))}Ce.fill(0);const Me=BigInt(0),Ve=BigInt(2),He=BigInt(27),qe=BigInt(28),Je=BigInt(35),ze=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function Ke(t){return"0x"===t?null:oe(t)}function We(t,e){try{return $e(t)}catch(r){f(!1,r.message,e,t)}}function Xe(t,e){return"0x"===t?0:G(t,e)}function Ze(t,e){if("0x"===t)return Me;const r=C(t,e);return f(r<=ze,"value exceeds uint size",e,r),r}function Qe(t,e){const r=C(t,"value"),n=$(r);return f(n.length<=32,"value too large",`tx.${e}`,r),n}function Ye(t){return $e(t).map((t=>[t.address,t.storageKeys]))}function tr(t,e){f(Array.isArray(t),`invalid ${e}`,"value",t);for(let r=0;r<t.length;r++)f(v(t[r],32),"invalid ${ param } hash",`value[${r}]`,t[r]);return t}function er(t,e){const r=[Qe(t.nonce,"nonce"),Qe(t.gasPrice||0,"gasPrice"),Qe(t.gasLimit,"gasLimit"),t.to||"0x",Qe(t.value,"value"),t.data];let n=Me;if(t.chainId!=Me)n=C(t.chainId,"tx.chainId"),f(!e||null==e.networkV||e.legacyChainId===n,"tx.chainId/sig.v mismatch","sig",e);else if(t.signature){const e=t.signature.legacyChainId;null!=e&&(n=e)}if(!e)return n!==Me&&(r.push($(n)),r.push("0x"),r.push("0x")),Rt(r);let s=BigInt(27+e.yParity);return n!==Me?s=Yt.getChainIdV(n,e.v):BigInt(e.v)!==s&&f(!1,"tx.chainId/sig.v mismatch","sig",e),r.push($(s)),r.push($(e.r)),r.push($(e.s)),Rt(r)}function rr(t,e){let r;try{if(r=Xe(e[0],"yParity"),0!==r&&1!==r)throw new Error("bad yParity")}catch(a){f(!1,"invalid yParity","yParity",e[0])}const n=R(e[1],32),s=R(e[2],32),i=Yt.from({r:n,s:s,yParity:r});t.signature=i}function nr(t,e){const r=[Qe(t.chainId,"chainId"),Qe(t.nonce,"nonce"),Qe(t.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),Qe(t.maxFeePerGas||0,"maxFeePerGas"),Qe(t.gasLimit,"gasLimit"),t.to||"0x",Qe(t.value,"value"),t.data,Ye(t.accessList||[])];return e&&(r.push(Qe(e.yParity,"yParity")),r.push($(e.r)),r.push($(e.s))),E(["0x02",Rt(r)])}function sr(t,e){const r=[Qe(t.chainId,"chainId"),Qe(t.nonce,"nonce"),Qe(t.gasPrice||0,"gasPrice"),Qe(t.gasLimit,"gasLimit"),t.to||"0x",Qe(t.value,"value"),t.data,Ye(t.accessList||[])];return e&&(r.push(Qe(e.yParity,"recoveryParam")),r.push($(e.r)),r.push($(e.s))),E(["0x01",Rt(r)])}function ir(t,e){const r=[Qe(t.chainId,"chainId"),Qe(t.nonce,"nonce"),Qe(t.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),Qe(t.maxFeePerGas||0,"maxFeePerGas"),Qe(t.gasLimit,"gasLimit"),t.to||Vt,Qe(t.value,"value"),t.data,Ye(t.accessList||[]),Qe(t.maxFeePerBlobGas||0,"maxFeePerBlobGas"),tr(t.blobVersionedHashes||[],"blobVersionedHashes")];return e&&(r.push(Qe(e.yParity,"yParity")),r.push($(e.r)),r.push($(e.s))),E(["0x03",Rt(r)])}class ar{#K;#W;#F;#X;#Z;#Q;#Y;#tt;#et;#rt;#nt;#st;#it;#at;get type(){return this.#K}set type(t){switch(t){case null:this.#K=null;break;case 0:case"legacy":this.#K=0;break;case 1:case"berlin":case"eip-2930":this.#K=1;break;case 2:case"london":case"eip-1559":this.#K=2;break;case 3:case"cancun":case"eip-4844":this.#K=3;break;default:f(!1,"unsupported transaction type","type",t)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844"}return null}get to(){const t=this.#W;return null==t&&3===this.type?Vt:t}set to(t){this.#W=null==t?null:oe(t)}get nonce(){return this.#X}set nonce(t){this.#X=G(t,"value")}get gasLimit(){return this.#Z}set gasLimit(t){this.#Z=C(t)}get gasPrice(){const t=this.#Q;return null!=t||0!==this.type&&1!==this.type?t:Me}set gasPrice(t){this.#Q=null==t?null:C(t,"gasPrice")}get maxPriorityFeePerGas(){const t=this.#Y;return null==t?2===this.type||3===this.type?Me:null:t}set maxPriorityFeePerGas(t){this.#Y=null==t?null:C(t,"maxPriorityFeePerGas")}get maxFeePerGas(){const t=this.#tt;return null==t?2===this.type||3===this.type?Me:null:t}set maxFeePerGas(t){this.#tt=null==t?null:C(t,"maxFeePerGas")}get data(){return this.#F}set data(t){this.#F=P(t)}get value(){return this.#et}set value(t){this.#et=C(t,"value")}get chainId(){return this.#rt}set chainId(t){this.#rt=C(t)}get signature(){return this.#nt||null}set signature(t){this.#nt=null==t?null:Yt.from(t)}get accessList(){const t=this.#st||null;return null==t?1===this.type||2===this.type||3===this.type?[]:null:t}set accessList(t){this.#st=null==t?null:$e(t)}get maxFeePerBlobGas(){const t=this.#it;return null==t&&3===this.type?Me:t}set maxFeePerBlobGas(t){this.#it=null==t?null:C(t,"maxFeePerBlobGas")}get blobVersionedHashes(){let t=this.#at;return null==t&&3===this.type?[]:t}set blobVersionedHashes(t){if(null!=t){f(Array.isArray(t),"blobVersionedHashes must be an Array","value",t),t=t.slice();for(let e=0;e<t.length;e++)f(v(t[e],32),"invalid blobVersionedHash",`value[${e}]`,t[e])}this.#at=t}constructor(){this.#K=null,this.#W=null,this.#X=0,this.#Z=Me,this.#Q=null,this.#Y=null,this.#tt=null,this.#F="0x",this.#et=Me,this.#rt=Me,this.#nt=null,this.#st=null,this.#it=null,this.#at=null}get hash(){return null==this.signature?null:Mt(this.serialized)}get unsignedHash(){return Mt(this.unsignedSerialized)}get from(){return null==this.signature?null:je(this.unsignedHash,this.signature)}get fromPublicKey(){return null==this.signature?null:te.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return null!=this.signature}get serialized(){switch(d(null!=this.signature,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"}),this.inferType()){case 0:return er(this,this.signature);case 1:return sr(this,this.signature);case 2:return nr(this,this.signature);case 3:return ir(this,this.signature)}d(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})}get unsignedSerialized(){switch(this.inferType()){case 0:return er(this);case 1:return sr(this);case 2:return nr(this);case 3:return ir(this)}d(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".unsignedSerialized"})}inferType(){const t=this.inferTypes();return t.indexOf(2)>=0?2:t.pop()}inferTypes(){const t=null!=this.gasPrice,e=null!=this.maxFeePerGas||null!=this.maxPriorityFeePerGas,r=null!=this.accessList,n=null!=this.#it||this.#at;null!=this.maxFeePerGas&&null!=this.maxPriorityFeePerGas&&d(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),d(!e||0!==this.type&&1!==this.type,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),d(0!==this.type||!r,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const s=[];return null!=this.type?s.push(this.type):e?s.push(2):t?(s.push(1),r||s.push(0)):r?(s.push(1),s.push(2)):(n&&this.to||(s.push(0),s.push(1),s.push(2)),s.push(3)),s.sort(),s}isLegacy(){return 0===this.type}isBerlin(){return 1===this.type}isLondon(){return 2===this.type}isCancun(){return 3===this.type}clone(){return ar.from(this)}toJSON(){const t=t=>null==t?null:t.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:t(this.gasLimit),gasPrice:t(this.gasPrice),maxPriorityFeePerGas:t(this.maxPriorityFeePerGas),maxFeePerGas:t(this.maxFeePerGas),value:t(this.value),chainId:t(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(t){if(null==t)return new ar;if("string"==typeof t){const e=b(t);if(e[0]>=127)return ar.from(function(t){const e=Et(t);f(Array.isArray(e)&&(9===e.length||6===e.length),"invalid field count for legacy transaction","data",t);const r={type:0,nonce:Xe(e[0],"nonce"),gasPrice:Ze(e[1],"gasPrice"),gasLimit:Ze(e[2],"gasLimit"),to:Ke(e[3]),value:Ze(e[4],"value"),data:P(e[5]),chainId:Me};if(6===e.length)return r;const n=Ze(e[6],"v"),s=Ze(e[7],"r"),i=Ze(e[8],"s");if(s===Me&&i===Me)r.chainId=n;else{let s=(n-Je)/Ve;s<Me&&(s=Me),r.chainId=s,f(s!==Me||n===He||n===qe,"non-canonical legacy v","v",e[6]),r.signature=Yt.from({r:R(e[7],32),s:R(e[8],32),v:n}),r.hash=Mt(t)}return r}(e));switch(e[0]){case 1:return ar.from(function(t){const e=Et(b(t).slice(1));f(Array.isArray(e)&&(8===e.length||11===e.length),"invalid field count for transaction type: 1","data",P(t));const r={type:1,chainId:Ze(e[0],"chainId"),nonce:Xe(e[1],"nonce"),gasPrice:Ze(e[2],"gasPrice"),gasLimit:Ze(e[3],"gasLimit"),to:Ke(e[4]),value:Ze(e[5],"value"),data:P(e[6]),accessList:We(e[7],"accessList")};return 8===e.length||(r.hash=Mt(t),rr(r,e.slice(8))),r}(e));case 2:return ar.from(function(t){const e=Et(b(t).slice(1));f(Array.isArray(e)&&(9===e.length||12===e.length),"invalid field count for transaction type: 2","data",P(t));const r={type:2,chainId:Ze(e[0],"chainId"),nonce:Xe(e[1],"nonce"),maxPriorityFeePerGas:Ze(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Ze(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Ze(e[4],"gasLimit"),to:Ke(e[5]),value:Ze(e[6],"value"),data:P(e[7]),accessList:We(e[8],"accessList")};return 9===e.length||(r.hash=Mt(t),rr(r,e.slice(9))),r}(e));case 3:return ar.from(function(t){const e=Et(b(t).slice(1));f(Array.isArray(e)&&(11===e.length||14===e.length),"invalid field count for transaction type: 3","data",P(t));const r={type:3,chainId:Ze(e[0],"chainId"),nonce:Xe(e[1],"nonce"),maxPriorityFeePerGas:Ze(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Ze(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Ze(e[4],"gasLimit"),to:Ke(e[5]),value:Ze(e[6],"value"),data:P(e[7]),accessList:We(e[8],"accessList"),maxFeePerBlobGas:Ze(e[9],"maxFeePerBlobGas"),blobVersionedHashes:e[10]};f(null!=r.to,"invalid address for transaction type: 3","data",t),f(Array.isArray(r.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",t);for(let n=0;n<r.blobVersionedHashes.length;n++)f(v(r.blobVersionedHashes[n],32),`invalid blobVersionedHash at index ${n}: must be length 32`,"data",t);return 11===e.length||(r.hash=Mt(t),rr(r,e.slice(11))),r}(e))}d(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const e=new ar;return null!=t.type&&(e.type=t.type),null!=t.to&&(e.to=t.to),null!=t.nonce&&(e.nonce=t.nonce),null!=t.gasLimit&&(e.gasLimit=t.gasLimit),null!=t.gasPrice&&(e.gasPrice=t.gasPrice),null!=t.maxPriorityFeePerGas&&(e.maxPriorityFeePerGas=t.maxPriorityFeePerGas),null!=t.maxFeePerGas&&(e.maxFeePerGas=t.maxFeePerGas),null!=t.maxFeePerBlobGas&&(e.maxFeePerBlobGas=t.maxFeePerBlobGas),null!=t.data&&(e.data=t.data),null!=t.value&&(e.value=t.value),null!=t.chainId&&(e.chainId=t.chainId),null!=t.signature&&(e.signature=Yt.from(t.signature)),null!=t.accessList&&(e.accessList=t.accessList),null!=t.blobVersionedHashes&&(e.blobVersionedHashes=t.blobVersionedHashes),null!=t.hash&&(f(e.isSigned(),"unsigned transaction cannot define hash","tx",t),f(e.hash===t.hash,"hash mismatch","tx",t)),null!=t.from&&(f(e.isSigned(),"unsigned transaction cannot define from","tx",t),f(e.from.toLowerCase()===(t.from||"").toLowerCase(),"from mismatch","tx",t)),e}}const or=new Uint8Array(32);or.fill(0);const cr=BigInt(-1),lr=BigInt(0),ur=BigInt(1),hr=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),dr=D(ur,32),fr=D(lr,32),pr={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},gr=["name","version","chainId","verifyingContract","salt"];function mr(t){return function(e){return f("string"==typeof e,`invalid domain value for ${JSON.stringify(t)}`,`domain.${t}`,e),e}}const yr={name:mr("name"),version:mr("version"),chainId:function(t){const e=C(t,"domain.chainId");return f(e>=0,"invalid chain ID","domain.chainId",t),Number.isSafeInteger(e)?Number(e):j(e)},verifyingContract:function(t){try{return oe(t).toLowerCase()}catch(e){}f(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",t)},salt:function(t){const e=b(t,"domain.salt");return f(32===e.length,'invalid domain value "salt"',"domain.salt",t),P(e)}};function br(t){{const e=t.match(/^(u?)int(\d+)$/);if(e){const r=""===e[1],n=parseInt(e[2]);f(n%8==0&&0!==n&&n<=256&&e[2]===String(n),"invalid numeric width","type",t);const s=F(hr,r?n-1:n),i=r?(s+ur)*cr:lr;return function(e){const n=C(e,"value");return f(n>=i&&n<=s,`value out-of-bounds for ${t}`,"value",n),D(r?S(n,256):n,32)}}}{const e=t.match(/^bytes(\d+)$/);if(e){const r=parseInt(e[1]);return f(0!==r&&r<=32&&e[1]===String(r),"invalid bytes width","type",t),function(e){return f(b(e).length===r,`invalid length for ${t}`,"value",e),function(t){const e=b(t),r=e.length%32;return r?E([e,or.slice(r)]):P(e)}(e)}}}switch(t){case"address":return function(t){return R(oe(t),32)};case"bool":return function(t){return t?dr:fr};case"bytes":return function(t){return Mt(t)};case"string":return function(t){return Fe(t)}}return null}function wr(t,e){return`${t}(${e.map((({name:t,type:e})=>e+" "+t)).join(",")})`}function vr(t){const e=t.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return e?{base:e[1],index:e[2]+e[4],array:{base:e[1],prefix:e[1]+e[2],count:e[5]?parseInt(e[5]):-1}}:{base:t}}class kr{primaryType;#ot;get types(){return JSON.parse(this.#ot)}#ct;#lt;constructor(t){this.#ct=new Map,this.#lt=new Map;const e=new Map,r=new Map,n=new Map,s={};Object.keys(t).forEach((i=>{s[i]=t[i].map((({name:e,type:r})=>{let{base:n,index:s}=vr(r);return"int"!==n||t.int||(n="int256"),"uint"!==n||t.uint||(n="uint256"),{name:e,type:n+(s||"")}})),e.set(i,new Set),r.set(i,[]),n.set(i,new Set)})),this.#ot=JSON.stringify(s);for(const a in s){const n=new Set;for(const i of s[a]){f(!n.has(i.name),`duplicate variable name ${JSON.stringify(i.name)} in ${JSON.stringify(a)}`,"types",t),n.add(i.name);const s=vr(i.type).base;f(s!==a,`circular type reference to ${JSON.stringify(s)}`,"types",t),br(s)||(f(r.has(s),`unknown type ${JSON.stringify(s)}`,"types",t),r.get(s).push(a),e.get(a).add(s))}}const i=Array.from(r.keys()).filter((t=>0===r.get(t).length));f(0!==i.length,"missing primary type","types",t),f(1===i.length,`ambiguous primary types or unused types: ${i.map((t=>JSON.stringify(t))).join(", ")}`,"types",t),o(this,{primaryType:i[0]}),function s(i,a){f(!a.has(i),`circular type reference to ${JSON.stringify(i)}`,"types",t),a.add(i);for(const t of e.get(i))if(r.has(t)){s(t,a);for(const e of a)n.get(e).add(t)}a.delete(i)}(this.primaryType,new Set);for(const[a,o]of n){const t=Array.from(o);t.sort(),this.#ct.set(a,wr(a,s[a])+t.map((t=>wr(t,s[t]))).join(""))}}getEncoder(t){let e=this.#lt.get(t);return e||(e=this.#ut(t),this.#lt.set(t,e)),e}#ut(t){{const e=br(t);if(e)return e}const e=vr(t).array;if(e){const t=e.prefix,r=this.getEncoder(t);return n=>{f(-1===e.count||e.count===n.length,`array length mismatch; expected length ${e.count}`,"value",n);let s=n.map(r);return this.#ct.has(t)&&(s=s.map(Mt)),Mt(E(s))}}const r=this.types[t];if(r){const e=Fe(this.#ct.get(t));return t=>{const n=r.map((({name:e,type:r})=>{const n=this.getEncoder(r)(t[e]);return this.#ct.has(r)?Mt(n):n}));return n.unshift(e),E(n)}}f(!1,`unknown type: ${t}`,"type",t)}encodeType(t){const e=this.#ct.get(t);return f(e,`unknown type: ${JSON.stringify(t)}`,"name",t),e}encodeData(t,e){return this.getEncoder(t)(e)}hashStruct(t,e){return Mt(this.encodeData(t,e))}encode(t){return this.encodeData(this.primaryType,t)}hash(t){return this.hashStruct(this.primaryType,t)}_visit(t,e,r){if(br(t))return r(t,e);const n=vr(t).array;if(n)return f(-1===n.count||n.count===e.length,`array length mismatch; expected length ${n.count}`,"value",e),e.map((t=>this._visit(n.prefix,t,r)));const s=this.types[t];if(s)return s.reduce(((t,{name:n,type:s})=>(t[n]=this._visit(s,e[n],r),t)),{});f(!1,`unknown type: ${t}`,"type",t)}visit(t,e){return this._visit(this.primaryType,t,e)}static from(t){return new kr(t)}static getPrimaryType(t){return kr.from(t).primaryType}static hashStruct(t,e,r){return kr.from(e).hashStruct(t,r)}static hashDomain(t){const e=[];for(const r in t){if(null==t[r])continue;const n=pr[r];f(n,`invalid typed-data domain key: ${JSON.stringify(r)}`,"domain",t),e.push({name:r,type:n})}return e.sort(((t,e)=>gr.indexOf(t.name)-gr.indexOf(e.name))),kr.hashStruct("EIP712Domain",{EIP712Domain:e},t)}static encode(t,e,r){return E(["0x1901",kr.hashDomain(t),kr.from(e).hash(r)])}static hash(t,e,r){return Mt(kr.encode(t,e,r))}static async resolveNames(t,e,r,n){t=Object.assign({},t);for(const a in t)null==t[a]&&delete t[a];const s={};t.verifyingContract&&!v(t.verifyingContract,20)&&(s[t.verifyingContract]="0x");const i=kr.from(e);i.visit(r,((t,e)=>("address"!==t||v(e,20)||(s[e]="0x"),e)));for(const a in s)s[a]=await n(a);return t.verifyingContract&&s[t.verifyingContract]&&(t.verifyingContract=s[t.verifyingContract]),{domain:t,value:r=i.visit(r,((t,e)=>"address"===t&&s[e]?s[e]:e))}}static getPayload(t,e,r){kr.hashDomain(t);const n={},s=[];gr.forEach((e=>{const r=t[e];null!=r&&(n[e]=yr[e](r),s.push({name:e,type:pr[e]}))}));const i=kr.from(e);e=i.types;const a=Object.assign({},e);return f(null==a.EIP712Domain,"types must not contain EIP712Domain type","types.EIP712Domain",e),a.EIP712Domain=s,i.encode(r),{types:a,domain:n,primaryType:i.primaryType,message:i.visit(r,((t,e)=>{if(t.match(/^bytes(\d*)/))return P(b(e));if(t.match(/^u?int/))return C(e).toString();switch(t){case"address":return e.toLowerCase();case"bool":return!!e;case"string":return f("string"==typeof e,"invalid string","value",e),e}f(!1,"unsupported type","type",t)}))}}}function Pr(t){const e=new Set;return t.forEach((t=>e.add(t))),Object.freeze(e)}const Er=Pr("external public payable override".split(" ")),Nr="constant external internal payable private public pure view override",Tr=Pr(Nr.split(" ")),xr="constructor error event fallback function receive struct",Rr=Pr(xr.split(" ")),Or="calldata memory storage payable indexed",_r=Pr(Or.split(" ")),Ir=Pr([xr,Or,"tuple returns",Nr].join(" ").split(" ")),Ar={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},Sr=new RegExp("^(\\s*)"),Fr=new RegExp("^([0-9]+)"),Cr=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),Ur=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),Br=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");class Lr{#B;#ht;get offset(){return this.#B}get length(){return this.#ht.length-this.#B}constructor(t){this.#B=0,this.#ht=t.slice()}clone(){return new Lr(this.#ht)}reset(){this.#B=0}#dt(t=0,e=0){return new Lr(this.#ht.slice(t,e).map((e=>Object.freeze(Object.assign({},e,{match:e.match-t,linkBack:e.linkBack-t,linkNext:e.linkNext-t})))))}popKeyword(t){const e=this.peek();if("KEYWORD"!==e.type||!t.has(e.text))throw new Error(`expected keyword ${e.text}`);return this.pop().text}popType(t){if(this.peek().type!==t){const e=this.peek();throw new Error(`expected ${t}; got ${e.type} ${JSON.stringify(e.text)}`)}return this.pop().text}popParen(){const t=this.peek();if("OPEN_PAREN"!==t.type)throw new Error("bad start");const e=this.#dt(this.#B+1,t.match+1);return this.#B=t.match+1,e}popParams(){const t=this.peek();if("OPEN_PAREN"!==t.type)throw new Error("bad start");const e=[];for(;this.#B<t.match-1;){const t=this.peek().linkNext;e.push(this.#dt(this.#B+1,t)),this.#B=t}return this.#B=t.match+1,e}peek(){if(this.#B>=this.#ht.length)throw new Error("out-of-bounds");return this.#ht[this.#B]}peekKeyword(t){const e=this.peekType("KEYWORD");return null!=e&&t.has(e)?e:null}peekType(t){if(0===this.length)return null;const e=this.peek();return e.type===t?e.text:null}pop(){const t=this.peek();return this.#B++,t}toString(){const t=[];for(let e=this.#B;e<this.#ht.length;e++){const r=this.#ht[e];t.push(`${r.type}:${r.text}`)}return`<TokenString ${t.join(" ")}>`}}function Gr(t){const e=[],r=e=>{const r=i<t.length?JSON.stringify(t[i]):"$EOI";throw new Error(`invalid token ${r} at ${i}: ${e}`)};let n=[],s=[],i=0;for(;i<t.length;){let a=t.substring(i),o=a.match(Sr);o&&(i+=o[1].length,a=t.substring(i));const c={depth:n.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:i,value:-1};e.push(c);let l=Ar[a[0]]||"";if(l){if(c.type=l,c.text=a[0],i++,"OPEN_PAREN"===l)n.push(e.length-1),s.push(e.length-1);else if("CLOSE_PAREN"==l)0===n.length&&r("no matching open bracket"),c.match=n.pop(),e[c.match].match=e.length-1,c.depth--,c.linkBack=s.pop(),e[c.linkBack].linkNext=e.length-1;else if("COMMA"===l)c.linkBack=s.pop(),e[c.linkBack].linkNext=e.length-1,s.push(e.length-1);else if("OPEN_BRACKET"===l)c.type="BRACKET";else if("CLOSE_BRACKET"===l){let t=e.pop().text;if(e.length>0&&"NUMBER"===e[e.length-1].type){const r=e.pop().text;t=r+t,e[e.length-1].value=G(r)}if(0===e.length||"BRACKET"!==e[e.length-1].type)throw new Error("missing opening bracket");e[e.length-1].text+=t}}else if(o=a.match(Cr),o){if(c.text=o[1],i+=c.text.length,Ir.has(c.text)){c.type="KEYWORD";continue}if(c.text.match(Br)){c.type="TYPE";continue}c.type="ID"}else{if(o=a.match(Fr),!o)throw new Error(`unexpected token ${JSON.stringify(a[0])} at position ${i}`);c.text=o[1],c.type="NUMBER",i+=c.text.length}}return new Lr(e.map((t=>Object.freeze(t))))}function Dr(t,e){let r=[];for(const n in e.keys())t.has(n)&&r.push(n);if(r.length>1)throw new Error(`conflicting types: ${r.join(", ")}`)}function $r(t,e){if(e.peekKeyword(Rr)){const r=e.pop().text;if(r!==t)throw new Error(`expected ${t}, got ${r}`)}return e.popType("ID")}function jr(t,e){const r=new Set;for(;;){const n=t.peekType("KEYWORD");if(null==n||e&&!e.has(n))break;if(t.pop(),r.has(n))throw new Error(`duplicate keywords: ${JSON.stringify(n)}`);r.add(n)}return Object.freeze(r)}function Mr(t){let e=jr(t,Tr);return Dr(e,Pr("constant payable nonpayable".split(" "))),Dr(e,Pr("pure view payable nonpayable".split(" "))),e.has("view")?"view":e.has("pure")?"pure":e.has("payable")?"payable":e.has("nonpayable")?"nonpayable":e.has("constant")?"view":"nonpayable"}function Vr(t,e){return t.popParams().map((t=>nn.from(t,e)))}function Hr(t){if(t.peekType("AT")){if(t.pop(),t.peekType("NUMBER"))return C(t.pop().text);throw new Error("invalid gas")}return null}function qr(t){if(t.length)throw new Error(`unexpected tokens at offset ${t.offset}: ${t.toString()}`)}const Jr=new RegExp(/^(.*)\[([0-9]*)\]$/);function zr(t){const e=t.match(Br);if(f(e,"invalid type","type",t),"uint"===t)return"uint256";if("int"===t)return"int256";if(e[2]){const r=parseInt(e[2]);f(0!==r&&r<=32,"invalid bytes length","type",t)}else if(e[3]){const r=parseInt(e[3]);f(0!==r&&r<=256&&r%8==0,"invalid numeric width","type",t)}return t}const Kr={},Wr=Symbol.for("_ethers_internal"),Xr="_ParamTypeInternal",Zr="_ErrorInternal",Qr="_EventInternal",Yr="_ConstructorInternal",tn="_FallbackInternal",en="_FunctionInternal",rn="_StructInternal";class nn{name;type;baseType;indexed;components;arrayLength;arrayChildren;constructor(t,e,r,n,s,i,a,c){if(m(t,Kr,"ParamType"),Object.defineProperty(this,Wr,{value:Xr}),i&&(i=Object.freeze(i.slice())),"array"===n){if(null==a||null==c)throw new Error("")}else if(null!=a||null!=c)throw new Error("");if("tuple"===n){if(null==i)throw new Error("")}else if(null!=i)throw new Error("");o(this,{name:e,type:r,baseType:n,indexed:s,components:i,arrayLength:a,arrayChildren:c})}format(t){if(null==t&&(t="sighash"),"json"===t){const e=this.name||"";if(this.isArray()){const t=JSON.parse(this.arrayChildren.format("json"));return t.name=e,t.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(t)}const r={type:"tuple"===this.baseType?"tuple":this.type,name:e};return"boolean"==typeof this.indexed&&(r.indexed=this.indexed),this.isTuple()&&(r.components=this.components.map((e=>JSON.parse(e.format(t))))),JSON.stringify(r)}let e="";return this.isArray()?(e+=this.arrayChildren.format(t),e+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?e+="("+this.components.map((e=>e.format(t))).join("full"===t?", ":",")+")":e+=this.type,"sighash"!==t&&(!0===this.indexed&&(e+=" indexed"),"full"===t&&this.name&&(e+=" "+this.name)),e}isArray(){return"array"===this.baseType}isTuple(){return"tuple"===this.baseType}isIndexable(){return null!=this.indexed}walk(t,e){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(-1!==this.arrayLength&&t.length!==this.arrayLength)throw new Error("array is wrong length");const r=this;return t.map((t=>r.arrayChildren.walk(t,e)))}if(this.isTuple()){if(!Array.isArray(t))throw new Error("invalid tuple value");if(t.length!==this.components.length)throw new Error("array is wrong length");const r=this;return t.map(((t,n)=>r.components[n].walk(t,e)))}return e(this.type,t)}#ft(t,e,r,n){if(this.isArray()){if(!Array.isArray(e))throw new Error("invalid array value");if(-1!==this.arrayLength&&e.length!==this.arrayLength)throw new Error("array is wrong length");const s=this.arrayChildren,i=e.slice();return i.forEach(((e,n)=>{s.#ft(t,e,r,(t=>{i[n]=t}))})),void n(i)}if(this.isTuple()){const s=this.components;let i;if(Array.isArray(e))i=e.slice();else{if(null==e||"object"!=typeof e)throw new Error("invalid tuple value");i=s.map((t=>{if(!t.name)throw new Error("cannot use object value with unnamed components");if(!(t.name in e))throw new Error(`missing value for component ${t.name}`);return e[t.name]}))}if(i.length!==this.components.length)throw new Error("array is wrong length");return i.forEach(((e,n)=>{s[n].#ft(t,e,r,(t=>{i[n]=t}))})),void n(i)}const s=r(this.type,e);s.then?t.push(async function(){n(await s)}()):n(s)}async walkAsync(t,e){const r=[],n=[t];return this.#ft(r,t,e,(t=>{n[0]=t})),r.length&&await Promise.all(r),n[0]}static from(t,e){if(nn.isParamType(t))return t;if("string"==typeof t)try{return nn.from(Gr(t),e)}catch(a){f(!1,"invalid param type","obj",t)}else if(t instanceof Lr){let r="",n="",s=null;jr(t,Pr(["tuple"])).has("tuple")||t.peekType("OPEN_PAREN")?(n="tuple",s=t.popParams().map((t=>nn.from(t))),r=`tuple(${s.map((t=>t.format())).join(",")})`):(r=zr(t.popType("TYPE")),n=r);let i=null,a=null;for(;t.length&&t.peekType("BRACKET");){const e=t.pop();i=new nn(Kr,"",r,n,null,s,a,i),a=e.value,r+=e.text,n="array",s=null}let o=null;if(jr(t,_r).has("indexed")){if(!e)throw new Error("");o=!0}const c=t.peekType("ID")?t.pop().text:"";if(t.length)throw new Error("leftover tokens");return new nn(Kr,c,r,n,o,s,a,i)}const r=t.name;f(!r||"string"==typeof r&&r.match(Ur),"invalid name","obj.name",r);let n=t.indexed;null!=n&&(f(e,"parameter cannot be indexed","obj.indexed",t.indexed),n=!!n);let s=t.type,i=s.match(Jr);if(i){const e=parseInt(i[2]||"-1"),a=nn.from({type:i[1],components:t.components});return new nn(Kr,r||"",s,"array",n,null,e,a)}if("tuple"===s||s.startsWith("tuple(")||s.startsWith("(")){const e=null!=t.components?t.components.map((t=>nn.from(t))):null;return new nn(Kr,r||"",s,"tuple",n,e,null,null)}return s=zr(t.type),new nn(Kr,r||"",s,s,n,null,null,null)}static isParamType(t){return t&&t[Wr]===Xr}}class sn{type;inputs;constructor(t,e,r){m(t,Kr,"Fragment"),o(this,{type:e,inputs:r=Object.freeze(r.slice())})}static from(t){if("string"==typeof t){try{sn.from(JSON.parse(t))}catch(e){}return sn.from(Gr(t))}if(t instanceof Lr)switch(t.peekKeyword(Rr)){case"constructor":return un.from(t);case"error":return cn.from(t);case"event":return ln.from(t);case"fallback":case"receive":return hn.from(t);case"function":return dn.from(t);case"struct":return fn.from(t)}else if("object"==typeof t){switch(t.type){case"constructor":return un.from(t);case"error":return cn.from(t);case"event":return ln.from(t);case"fallback":case"receive":return hn.from(t);case"function":return dn.from(t);case"struct":return fn.from(t)}d(!1,`unsupported type: ${t.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}f(!1,"unsupported frgament object","obj",t)}static isConstructor(t){return un.isFragment(t)}static isError(t){return cn.isFragment(t)}static isEvent(t){return ln.isFragment(t)}static isFunction(t){return dn.isFragment(t)}static isStruct(t){return fn.isFragment(t)}}class an extends sn{name;constructor(t,e,r,n){super(t,e,n),f("string"==typeof r&&r.match(Ur),"invalid identifier","name",r),n=Object.freeze(n.slice()),o(this,{name:r})}}function on(t,e){return"("+e.map((e=>e.format(t))).join("full"===t?", ":",")+")"}class cn extends an{constructor(t,e,r){super(t,"error",e,r),Object.defineProperty(this,Wr,{value:Zr})}get selector(){return Fe(this.format("sighash")).substring(0,10)}format(t){if(null==t&&(t="sighash"),"json"===t)return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map((e=>JSON.parse(e.format(t))))});const e=[];return"sighash"!==t&&e.push("error"),e.push(this.name+on(t,this.inputs)),e.join(" ")}static from(t){if(cn.isFragment(t))return t;if("string"==typeof t)return cn.from(Gr(t));if(t instanceof Lr){const e=$r("error",t),r=Vr(t);return qr(t),new cn(Kr,e,r)}return new cn(Kr,t.name,t.inputs?t.inputs.map(nn.from):[])}static isFragment(t){return t&&t[Wr]===Zr}}class ln extends an{anonymous;constructor(t,e,r,n){super(t,"event",e,r),Object.defineProperty(this,Wr,{value:Qr}),o(this,{anonymous:n})}get topicHash(){return Fe(this.format("sighash"))}format(t){if(null==t&&(t="sighash"),"json"===t)return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map((e=>JSON.parse(e.format(t))))});const e=[];return"sighash"!==t&&e.push("event"),e.push(this.name+on(t,this.inputs)),"sighash"!==t&&this.anonymous&&e.push("anonymous"),e.join(" ")}static getTopicHash(t,e){return e=(e||[]).map((t=>nn.from(t))),new ln(Kr,t,e,!1).topicHash}static from(t){if(ln.isFragment(t))return t;if("string"==typeof t)try{return ln.from(Gr(t))}catch(e){f(!1,"invalid event fragment","obj",t)}else if(t instanceof Lr){const e=$r("event",t),r=Vr(t,!0),n=!!jr(t,Pr(["anonymous"])).has("anonymous");return qr(t),new ln(Kr,e,r,n)}return new ln(Kr,t.name,t.inputs?t.inputs.map((t=>nn.from(t,!0))):[],!!t.anonymous)}static isFragment(t){return t&&t[Wr]===Qr}}class un extends sn{payable;gas;constructor(t,e,r,n,s){super(t,e,r),Object.defineProperty(this,Wr,{value:Yr}),o(this,{payable:n,gas:s})}format(t){if(d(null!=t&&"sighash"!==t,"cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),"json"===t)return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:null!=this.gas?this.gas:void 0,inputs:this.inputs.map((e=>JSON.parse(e.format(t))))});const e=[`constructor${on(t,this.inputs)}`];return this.payable&&e.push("payable"),null!=this.gas&&e.push(`@${this.gas.toString()}`),e.join(" ")}static from(t){if(un.isFragment(t))return t;if("string"==typeof t)try{return un.from(Gr(t))}catch(e){f(!1,"invalid constuctor fragment","obj",t)}else if(t instanceof Lr){jr(t,Pr(["constructor"]));const e=Vr(t),r=!!jr(t,Er).has("payable"),n=Hr(t);return qr(t),new un(Kr,"constructor",e,r,n)}return new un(Kr,"constructor",t.inputs?t.inputs.map(nn.from):[],!!t.payable,null!=t.gas?t.gas:null)}static isFragment(t){return t&&t[Wr]===Yr}}class hn extends sn{payable;constructor(t,e,r){super(t,"fallback",e),Object.defineProperty(this,Wr,{value:tn}),o(this,{payable:r})}format(t){const e=0===this.inputs.length?"receive":"fallback";if("json"===t){const t=this.payable?"payable":"nonpayable";return JSON.stringify({type:e,stateMutability:t})}return`${e}()${this.payable?" payable":""}`}static from(t){if(hn.isFragment(t))return t;if("string"==typeof t)try{return hn.from(Gr(t))}catch(e){f(!1,"invalid fallback fragment","obj",t)}else if(t instanceof Lr){const e=t.toString();if(f(t.peekKeyword(Pr(["fallback","receive"])),"type must be fallback or receive","obj",e),"receive"===t.popKeyword(Pr(["fallback","receive"]))){const e=Vr(t);return f(0===e.length,"receive cannot have arguments","obj.inputs",e),jr(t,Pr(["payable"])),qr(t),new hn(Kr,[],!0)}let r=Vr(t);r.length?f(1===r.length&&"bytes"===r[0].type,"invalid fallback inputs","obj.inputs",r.map((t=>t.format("minimal"))).join(", ")):r=[nn.from("bytes")];const n=Mr(t);if(f("nonpayable"===n||"payable"===n,"fallback cannot be constants","obj.stateMutability",n),jr(t,Pr(["returns"])).has("returns")){const e=Vr(t);f(1===e.length&&"bytes"===e[0].type,"invalid fallback outputs","obj.outputs",e.map((t=>t.format("minimal"))).join(", "))}return qr(t),new hn(Kr,r,"payable"===n)}if("receive"===t.type)return new hn(Kr,[],!0);if("fallback"===t.type){const e=[nn.from("bytes")],r="payable"===t.stateMutability;return new hn(Kr,e,r)}f(!1,"invalid fallback description","obj",t)}static isFragment(t){return t&&t[Wr]===tn}}class dn extends an{constant;outputs;stateMutability;payable;gas;constructor(t,e,r,n,s,i){super(t,"function",e,n),Object.defineProperty(this,Wr,{value:en}),o(this,{constant:"view"===r||"pure"===r,gas:i,outputs:s=Object.freeze(s.slice()),payable:"payable"===r,stateMutability:r})}get selector(){return Fe(this.format("sighash")).substring(0,10)}format(t){if(null==t&&(t="sighash"),"json"===t)return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:"nonpayable"!==this.stateMutability?this.stateMutability:void 0,payable:this.payable,gas:null!=this.gas?this.gas:void 0,inputs:this.inputs.map((e=>JSON.parse(e.format(t)))),outputs:this.outputs.map((e=>JSON.parse(e.format(t))))});const e=[];return"sighash"!==t&&e.push("function"),e.push(this.name+on(t,this.inputs)),"sighash"!==t&&("nonpayable"!==this.stateMutability&&e.push(this.stateMutability),this.outputs&&this.outputs.length&&(e.push("returns"),e.push(on(t,this.outputs))),null!=this.gas&&e.push(`@${this.gas.toString()}`)),e.join(" ")}static getSelector(t,e){return e=(e||[]).map((t=>nn.from(t))),new dn(Kr,t,"view",e,[],null).selector}static from(t){if(dn.isFragment(t))return t;if("string"==typeof t)try{return dn.from(Gr(t))}catch(r){f(!1,"invalid function fragment","obj",t)}else if(t instanceof Lr){const e=$r("function",t),r=Vr(t),n=Mr(t);let s=[];jr(t,Pr(["returns"])).has("returns")&&(s=Vr(t));const i=Hr(t);return qr(t),new dn(Kr,e,n,r,s,i)}let e=t.stateMutability;return null==e&&(e="payable","boolean"==typeof t.constant?(e="view",t.constant||(e="payable","boolean"!=typeof t.payable||t.payable||(e="nonpayable"))):"boolean"!=typeof t.payable||t.payable||(e="nonpayable")),new dn(Kr,t.name,e,t.inputs?t.inputs.map(nn.from):[],t.outputs?t.outputs.map(nn.from):[],null!=t.gas?t.gas:null)}static isFragment(t){return t&&t[Wr]===en}}class fn extends an{constructor(t,e,r){super(t,"struct",e,r),Object.defineProperty(this,Wr,{value:rn})}format(){throw new Error("@TODO")}static from(t){if("string"==typeof t)try{return fn.from(Gr(t))}catch(e){f(!1,"invalid struct fragment","obj",t)}else if(t instanceof Lr){const e=$r("struct",t),r=Vr(t);return qr(t),new fn(Kr,e,r)}return new fn(Kr,t.name,t.inputs?t.inputs.map(nn.from):[])}static isFragment(t){return t&&t[Wr]===rn}}const pn=new Map;pn.set(0,"GENERIC_PANIC"),pn.set(1,"ASSERT_FALSE"),pn.set(17,"OVERFLOW"),pn.set(18,"DIVIDE_BY_ZERO"),pn.set(33,"ENUM_RANGE_ERROR"),pn.set(34,"BAD_STORAGE_DATA"),pn.set(49,"STACK_UNDERFLOW"),pn.set(50,"ARRAY_RANGE_ERROR"),pn.set(65,"OUT_OF_MEMORY"),pn.set(81,"UNINITIALIZED_FUNCTION_CALL");const gn=new RegExp(/^bytes([0-9]*)$/),mn=new RegExp(/^(u?int)([0-9]*)$/);let yn=null,bn=1024;class wn{#pt(t){if(t.isArray())return new ve(this.#pt(t.arrayChildren),t.arrayLength,t.name);if(t.isTuple())return new Se(t.components.map((t=>this.#pt(t))),t.name);switch(t.baseType){case"address":return new me(t.name);case"bool":return new ke(t.name);case"string":return new Ae(t.name);case"bytes":return new Ee(t.name);case"":return new xe(t.name)}let e=t.type.match(mn);if(e){let r=parseInt(e[2]||"256");return f(0!==r&&r<=256&&r%8==0,"invalid "+e[1]+" bit length","param",t),new Ie(r/8,"int"===e[1],t.name)}if(e=t.type.match(gn),e){let r=parseInt(e[1]);return f(0!==r&&r<=32,"invalid bytes length","param",t),new Ne(r,t.name)}f(!1,"invalid type","type",t.type)}getDefaultValue(t){const e=t.map((t=>this.#pt(nn.from(t))));return new Se(e,"_").defaultValue()}encode(t,e){p(e.length,t.length,"types/values length mismatch");const r=t.map((t=>this.#pt(nn.from(t)))),n=new Se(r,"_"),s=new Lt;return n.encode(s,e),s.data}decode(t,e,r){const n=t.map((t=>this.#pt(nn.from(t))));return new Se(n,"_").decode(new Gt(e,r,bn))}static _setDefaultMaxInflation(t){f("number"==typeof t&&Number.isInteger(t),"invalid defaultMaxInflation factor","value",t),bn=t}static defaultAbiCoder(){return null==yn&&(yn=new wn),yn}static getBuiltinCallException(t,e,r){return function(t,e,r,n){let s="missing revert data",i=null,a=null;if(r){s="execution reverted";const t=b(r);if(r=P(r),0===t.length)s+=" (no data present; likely require(false) occurred",i="require(false)";else if(t.length%32!=4)s+=" (could not decode reason; invalid data length)";else if("0x08c379a0"===P(t.slice(0,4)))try{i=n.decode(["string"],t.slice(4))[0],a={signature:"Error(string)",name:"Error",args:[i]},s+=`: ${JSON.stringify(i)}`}catch(c){s+=" (could not decode reason; invalid string data)"}else if("0x4e487b71"===P(t.slice(0,4)))try{const e=Number(n.decode(["uint256"],t.slice(4))[0]);a={signature:"Panic(uint256)",name:"Panic",args:[e]},i=`Panic due to ${pn.get(e)||"UNKNOWN"}(${e})`,s+=`: ${i}`}catch(c){s+=" (could not decode panic code)"}else s+=" (unknown custom error)"}const o={to:e.to?oe(e.to):null,data:e.data||"0x"};return e.from&&(o.from=oe(e.from)),h(s,"CALL_EXCEPTION",{action:t,data:r,reason:i,transaction:o,invocation:null,revert:a})}(t,e,r,wn.defaultAbiCoder())}}class vn{fragment;name;signature;topic;args;constructor(t,e,r){const n=t.name,s=t.format();o(this,{fragment:t,name:n,signature:s,topic:e,args:r})}}class kn{fragment;name;args;signature;selector;value;constructor(t,e,r,n){const s=t.name,i=t.format();o(this,{fragment:t,name:s,args:r,signature:i,selector:e,value:n})}}class Pn{fragment;name;args;signature;selector;constructor(t,e,r){const n=t.name,s=t.format();o(this,{fragment:t,name:n,args:r,signature:s,selector:e})}}class En{hash;_isIndexed;static isIndexed(t){return!(!t||!t._isIndexed)}constructor(t){o(this,{hash:t,_isIndexed:!0})}}const Nn={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},Tn={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:t=>`reverted with reason string ${JSON.stringify(t)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:t=>{let e="unknown panic code";return t>=0&&t<=255&&Nn[t.toString()]&&(e=Nn[t.toString()]),`reverted with panic code 0x${t.toString(16)} (${e})`}}};class xn{fragments;deploy;fallback;receive;#gt;#mt;#yt;#bt;constructor(t){let e=[];e="string"==typeof t?JSON.parse(t):t,this.#yt=new Map,this.#gt=new Map,this.#mt=new Map;const r=[];for(const a of e)try{r.push(sn.from(a))}catch(i){console.log(`[Warning] Invalid Fragment ${JSON.stringify(a)}:`,i.message)}o(this,{fragments:Object.freeze(r)});let n=null,s=!1;this.#bt=this.getAbiCoder(),this.fragments.forEach(((t,e)=>{let r;switch(t.type){case"constructor":return this.deploy?void console.log("duplicate definition - constructor"):void o(this,{deploy:t});case"fallback":return void(0===t.inputs.length?s=!0:(f(!n||t.payable!==n.payable,"conflicting fallback fragments",`fragments[${e}]`,t),n=t,s=n.payable));case"function":r=this.#yt;break;case"event":r=this.#mt;break;case"error":r=this.#gt;break;default:return}const i=t.format();r.has(i)||r.set(i,t)})),this.deploy||o(this,{deploy:un.from("constructor()")}),o(this,{fallback:n,receive:s})}format(t){const e=t?"minimal":"full";return this.fragments.map((t=>t.format(e)))}formatJson(){const t=this.fragments.map((t=>t.format("json")));return JSON.stringify(t.map((t=>JSON.parse(t))))}getAbiCoder(){return wn.defaultAbiCoder()}#wt(t,e,r){if(v(t)){const e=t.toLowerCase();for(const t of this.#yt.values())if(e===t.selector)return t;return null}if(-1===t.indexOf("(")){const n=[];for(const[e,r]of this.#yt)e.split("(")[0]===t&&n.push(r);if(e){const t=e.length>0?e[e.length-1]:null;let r=e.length,s=!0;ge.isTyped(t)&&"overrides"===t.type&&(s=!1,r--);for(let e=n.length-1;e>=0;e--){const t=n[e].inputs.length;t===r||s&&t===r-1||n.splice(e,1)}for(let i=n.length-1;i>=0;i--){const t=n[i].inputs;for(let r=0;r<e.length;r++)if(ge.isTyped(e[r])){if(r>=t.length){if("overrides"===e[r].type)continue;n.splice(i,1);break}if(e[r].type!==t[r].baseType){n.splice(i,1);break}}}}if(1===n.length&&e&&e.length!==n[0].inputs.length){const t=e[e.length-1];(null==t||Array.isArray(t)||"object"!=typeof t)&&n.splice(0,1)}return 0===n.length?null:(n.length>1&&r&&f(!1,`ambiguous function description (i.e. matches ${n.map((t=>JSON.stringify(t.format()))).join(", ")})`,"key",t),n[0])}const n=this.#yt.get(dn.from(t).format());return n||null}getFunctionName(t){const e=this.#wt(t,null,!1);return f(e,"no matching function","key",t),e.name}hasFunction(t){return!!this.#wt(t,null,!1)}getFunction(t,e){return this.#wt(t,e||null,!0)}forEachFunction(t){const e=Array.from(this.#yt.keys());e.sort(((t,e)=>t.localeCompare(e)));for(let r=0;r<e.length;r++){const n=e[r];t(this.#yt.get(n),r)}}#vt(t,e,r){if(v(t)){const e=t.toLowerCase();for(const t of this.#mt.values())if(e===t.topicHash)return t;return null}if(-1===t.indexOf("(")){const n=[];for(const[e,r]of this.#mt)e.split("(")[0]===t&&n.push(r);if(e){for(let t=n.length-1;t>=0;t--)n[t].inputs.length<e.length&&n.splice(t,1);for(let t=n.length-1;t>=0;t--){const r=n[t].inputs;for(let s=0;s<e.length;s++)if(ge.isTyped(e[s])&&e[s].type!==r[s].baseType){n.splice(t,1);break}}}return 0===n.length?null:(n.length>1&&r&&f(!1,`ambiguous event description (i.e. matches ${n.map((t=>JSON.stringify(t.format()))).join(", ")})`,"key",t),n[0])}const n=this.#mt.get(ln.from(t).format());return n||null}getEventName(t){const e=this.#vt(t,null,!1);return f(e,"no matching event","key",t),e.name}hasEvent(t){return!!this.#vt(t,null,!1)}getEvent(t,e){return this.#vt(t,e||null,!0)}forEachEvent(t){const e=Array.from(this.#mt.keys());e.sort(((t,e)=>t.localeCompare(e)));for(let r=0;r<e.length;r++){const n=e[r];t(this.#mt.get(n),r)}}getError(t,e){if(v(t)){const e=t.toLowerCase();if(Tn[e])return cn.from(Tn[e].signature);for(const t of this.#gt.values())if(e===t.selector)return t;return null}if(-1===t.indexOf("(")){const e=[];for(const[r,n]of this.#gt)r.split("(")[0]===t&&e.push(n);return 0===e.length?"Error"===t?cn.from("error Error(string)"):"Panic"===t?cn.from("error Panic(uint256)"):null:(e.length>1&&f(!1,`ambiguous error description (i.e. ${e.map((t=>JSON.stringify(t.format()))).join(", ")})`,"name",t),e[0])}if("Error(string)"===(t=cn.from(t).format()))return cn.from("error Error(string)");if("Panic(uint256)"===t)return cn.from("error Panic(uint256)");const r=this.#gt.get(t);return r||null}forEachError(t){const e=Array.from(this.#gt.keys());e.sort(((t,e)=>t.localeCompare(e)));for(let r=0;r<e.length;r++){const n=e[r];t(this.#gt.get(n),r)}}_decodeParams(t,e){return this.#bt.decode(t,e)}_encodeParams(t,e){return this.#bt.encode(t,e)}encodeDeploy(t){return this._encodeParams(this.deploy.inputs,t||[])}decodeErrorResult(t,e){if("string"==typeof t){const e=this.getError(t);f(e,"unknown error","fragment",t),t=e}return f(T(e,0,4)===t.selector,`data signature does not match error ${t.name}.`,"data",e),this._decodeParams(t.inputs,T(e,4))}encodeErrorResult(t,e){if("string"==typeof t){const e=this.getError(t);f(e,"unknown error","fragment",t),t=e}return E([t.selector,this._encodeParams(t.inputs,e||[])])}decodeFunctionData(t,e){if("string"==typeof t){const e=this.getFunction(t);f(e,"unknown function","fragment",t),t=e}return f(T(e,0,4)===t.selector,`data signature does not match function ${t.name}.`,"data",e),this._decodeParams(t.inputs,T(e,4))}encodeFunctionData(t,e){if("string"==typeof t){const e=this.getFunction(t);f(e,"unknown function","fragment",t),t=e}return E([t.selector,this._encodeParams(t.inputs,e||[])])}decodeFunctionResult(t,e){if("string"==typeof t){const e=this.getFunction(t);f(e,"unknown function","fragment",t),t=e}let r="invalid length for result data";const n=w(e);if(n.length%32==0)try{return this.#bt.decode(t.outputs,n)}catch(s){r="could not decode result data"}d(!1,r,"BAD_DATA",{value:P(n),info:{method:t.name,signature:t.format()}})}makeError(t,e){const r=b(t,"data"),n=wn.getBuiltinCallException("call",e,r);if(n.message.startsWith("execution reverted (unknown custom error)")){const t=P(r.slice(0,4)),e=this.getError(t);if(e)try{const t=this.#bt.decode(e.inputs,r.slice(4));n.revert={name:e.name,signature:e.format(),args:t},n.reason=n.revert.signature,n.message=`execution reverted: ${n.reason}`}catch(i){n.message="execution reverted (coult not decode custom error)"}}const s=this.parseTransaction(e);return s&&(n.invocation={method:s.name,signature:s.signature,args:s.args}),n}encodeFunctionResult(t,e){if("string"==typeof t){const e=this.getFunction(t);f(e,"unknown function","fragment",t),t=e}return P(this.#bt.encode(t.outputs,e||[]))}encodeFilterTopics(t,e){if("string"==typeof t){const e=this.getEvent(t);f(e,"unknown event","eventFragment",t),t=e}d(e.length<=t.inputs.length,`too many arguments for ${t.format()}`,"UNEXPECTED_ARGUMENT",{count:e.length,expectedCount:t.inputs.length});const r=[];t.anonymous||r.push(t.topicHash);const n=(t,e)=>"string"===t.type?Fe(e):"bytes"===t.type?Mt(P(e)):("bool"===t.type&&"boolean"==typeof e?e=e?"0x01":"0x00":t.type.match(/^u?int/)?e=D(e):t.type.match(/^bytes/)?e=x(e,32,!1):"address"===t.type&&this.#bt.encode(["address"],[e]),R(P(e),32));for(e.forEach(((e,s)=>{const i=t.inputs[s];i.indexed?null==e?r.push(null):"array"===i.baseType||"tuple"===i.baseType?f(!1,"filtering with tuples or arrays not supported","contract."+i.name,e):Array.isArray(e)?r.push(e.map((t=>n(i,t)))):r.push(n(i,e)):f(null==e,"cannot filter non-indexed parameters; must be null","contract."+i.name,e)}));r.length&&null===r[r.length-1];)r.pop();return r}encodeEventLog(t,e){if("string"==typeof t){const e=this.getEvent(t);f(e,"unknown event","eventFragment",t),t=e}const r=[],n=[],s=[];return t.anonymous||r.push(t.topicHash),f(e.length===t.inputs.length,"event arguments/values mismatch","values",e),t.inputs.forEach(((t,i)=>{const a=e[i];if(t.indexed)if("string"===t.type)r.push(Fe(a));else if("bytes"===t.type)r.push(Mt(a));else{if("tuple"===t.baseType||"array"===t.baseType)throw new Error("not implemented");r.push(this.#bt.encode([t.type],[a]))}else n.push(t),s.push(a)})),{data:this.#bt.encode(n,s),topics:r}}decodeEventLog(t,e,r){if("string"==typeof t){const e=this.getEvent(t);f(e,"unknown event","eventFragment",t),t=e}if(null!=r&&!t.anonymous){const e=t.topicHash;f(v(r[0],32)&&r[0].toLowerCase()===e,"fragment/topic mismatch","topics[0]",r[0]),r=r.slice(1)}const n=[],s=[],i=[];t.inputs.forEach(((t,e)=>{t.indexed?"string"===t.type||"bytes"===t.type||"tuple"===t.baseType||"array"===t.baseType?(n.push(nn.from({type:"bytes32",name:t.name})),i.push(!0)):(n.push(t),i.push(!1)):(s.push(t),i.push(!1))}));const a=null!=r?this.#bt.decode(n,E(r)):null,o=this.#bt.decode(s,e,!0),c=[],l=[];let u=0,h=0;return t.inputs.forEach(((t,e)=>{let r=null;if(t.indexed)if(null==a)r=new En(null);else if(i[e])r=new En(a[h++]);else try{r=a[h++]}catch(n){r=n}else try{r=o[u++]}catch(n){r=n}c.push(r),l.push(t.name||null)})),Ct.fromItems(c,l)}parseTransaction(t){const e=b(t.data,"tx.data"),r=C(null!=t.value?t.value:0,"tx.value"),n=this.getFunction(P(e.slice(0,4)));if(!n)return null;const s=this.#bt.decode(n.inputs,e.slice(4));return new kn(n,n.selector,s,r)}parseCallResult(t){throw new Error("@TODO")}parseLog(t){const e=this.getEvent(t.topics[0]);return!e||e.anonymous?null:new vn(e,e.topicHash,this.decodeEventLog(e,t.data,t.topics))}parseError(t){const e=P(t),r=this.getError(T(e,0,4));if(!r)return null;const n=this.#bt.decode(r.inputs,T(e,4));return new Pn(r,r.selector,n)}static from(t){return t instanceof xn?t:"string"==typeof t?new xn(JSON.parse(t)):"function"==typeof t.format?new xn(t.format("json")):new xn(t)}}const Rn=BigInt(0);function On(t){return null==t?null:t}function _n(t){return null==t?null:t.toString()}class In{gasPrice;maxFeePerGas;maxPriorityFeePerGas;constructor(t,e,r){o(this,{gasPrice:On(t),maxFeePerGas:On(e),maxPriorityFeePerGas:On(r)})}toJSON(){const{gasPrice:t,maxFeePerGas:e,maxPriorityFeePerGas:r}=this;return{_type:"FeeData",gasPrice:_n(t),maxFeePerGas:_n(e),maxPriorityFeePerGas:_n(r)}}}function An(t){const e={};t.to&&(e.to=t.to),t.from&&(e.from=t.from),t.data&&(e.data=P(t.data));const r="chainId,gasLimit,gasPrice,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const s of r)s in t&&null!=t[s]&&(e[s]=C(t[s],`request.${s}`));const n="type,nonce".split(/,/);for(const s of n)s in t&&null!=t[s]&&(e[s]=G(t[s],`request.${s}`));return t.accessList&&(e.accessList=$e(t.accessList)),"blockTag"in t&&(e.blockTag=t.blockTag),"enableCcipRead"in t&&(e.enableCcipRead=!!t.enableCcipRead),"customData"in t&&(e.customData=t.customData),e}class Sn{provider;number;hash;timestamp;parentHash;parentBeaconBlockRoot;nonce;difficulty;gasLimit;gasUsed;stateRoot;receiptsRoot;blobGasUsed;excessBlobGas;miner;extraData;baseFeePerGas;#kt;constructor(t,e){this.#kt=t.transactions.map((t=>"string"!=typeof t?new Un(t,e):t)),o(this,{provider:e,hash:On(t.hash),number:t.number,timestamp:t.timestamp,parentHash:t.parentHash,parentBeaconBlockRoot:t.parentBeaconBlockRoot,nonce:t.nonce,difficulty:t.difficulty,gasLimit:t.gasLimit,gasUsed:t.gasUsed,blobGasUsed:t.blobGasUsed,excessBlobGas:t.excessBlobGas,miner:t.miner,extraData:t.extraData,baseFeePerGas:On(t.baseFeePerGas),stateRoot:t.stateRoot,receiptsRoot:t.receiptsRoot})}get transactions(){return this.#kt.map((t=>"string"==typeof t?t:t.hash))}get prefetchedTransactions(){const t=this.#kt.slice();return 0===t.length?[]:(d("object"==typeof t[0],"transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),t)}toJSON(){const{baseFeePerGas:t,difficulty:e,extraData:r,gasLimit:n,gasUsed:s,hash:i,miner:a,nonce:o,number:c,parentHash:l,parentBeaconBlockRoot:u,stateRoot:h,receiptsRoot:d,timestamp:f,transactions:p}=this;return{_type:"Block",baseFeePerGas:_n(t),difficulty:_n(e),extraData:r,gasLimit:_n(n),gasUsed:_n(s),blobGasUsed:_n(this.blobGasUsed),excessBlobGas:_n(this.excessBlobGas),hash:i,miner:a,nonce:o,number:c,parentHash:l,timestamp:f,parentBeaconBlockRoot:u,stateRoot:h,receiptsRoot:d,transactions:p}}[Symbol.iterator](){let t=0;const e=this.transactions;return{next:()=>t<this.length?{value:e[t++],done:!1}:{value:void 0,done:!0}}}get length(){return this.#kt.length}get date(){return null==this.timestamp?null:new Date(1e3*this.timestamp)}async getTransaction(t){let e;if("number"==typeof t)e=this.#kt[t];else{const r=t.toLowerCase();for(const t of this.#kt){if("string"==typeof t){if(t!==r)continue;e=t;break}if(t.hash!==r){e=t;break}}}if(null==e)throw new Error("no such tx");return"string"==typeof e?await this.provider.getTransaction(e):e}getPrefetchedTransaction(t){const e=this.prefetchedTransactions;if("number"==typeof t)return e[t];t=t.toLowerCase();for(const r of e)if(r.hash===t)return r;f(!1,"no matching transaction","indexOrHash",t)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return{orphan:"drop-block",hash:(t=this).hash,number:t.number};var t}}class Fn{provider;transactionHash;blockHash;blockNumber;removed;address;data;topics;index;transactionIndex;constructor(t,e){this.provider=e;const r=Object.freeze(t.topics.slice());o(this,{transactionHash:t.transactionHash,blockHash:t.blockHash,blockNumber:t.blockNumber,removed:t.removed,address:t.address,data:t.data,topics:r,index:t.index,transactionIndex:t.transactionIndex})}toJSON(){const{address:t,blockHash:e,blockNumber:r,data:n,index:s,removed:i,topics:a,transactionHash:o,transactionIndex:c}=this;return{_type:"log",address:t,blockHash:e,blockNumber:r,data:n,index:s,removed:i,topics:a,transactionHash:o,transactionIndex:c}}async getBlock(){const t=await this.provider.getBlock(this.blockHash);return d(!!t,"failed to find transaction","UNKNOWN_ERROR",{}),t}async getTransaction(){const t=await this.provider.getTransaction(this.transactionHash);return d(!!t,"failed to find transaction","UNKNOWN_ERROR",{}),t}async getTransactionReceipt(){const t=await this.provider.getTransactionReceipt(this.transactionHash);return d(!!t,"failed to find transaction receipt","UNKNOWN_ERROR",{}),t}removedEvent(){return{orphan:"drop-log",log:{transactionHash:(t=this).transactionHash,blockHash:t.blockHash,blockNumber:t.blockNumber,address:t.address,data:t.data,topics:Object.freeze(t.topics.slice()),index:t.index}};var t}}class Cn{provider;to;from;contractAddress;hash;index;blockHash;blockNumber;logsBloom;gasUsed;blobGasUsed;cumulativeGasUsed;gasPrice;blobGasPrice;type;status;root;#Pt;constructor(t,e){this.#Pt=Object.freeze(t.logs.map((t=>new Fn(t,e))));let r=Rn;null!=t.effectiveGasPrice?r=t.effectiveGasPrice:null!=t.gasPrice&&(r=t.gasPrice),o(this,{provider:e,to:t.to,from:t.from,contractAddress:t.contractAddress,hash:t.hash,index:t.index,blockHash:t.blockHash,blockNumber:t.blockNumber,logsBloom:t.logsBloom,gasUsed:t.gasUsed,cumulativeGasUsed:t.cumulativeGasUsed,blobGasUsed:t.blobGasUsed,gasPrice:r,blobGasPrice:t.blobGasPrice,type:t.type,status:t.status,root:t.root})}get logs(){return this.#Pt}toJSON(){const{to:t,from:e,contractAddress:r,hash:n,index:s,blockHash:i,blockNumber:a,logsBloom:o,logs:c,status:l,root:u}=this;return{_type:"TransactionReceipt",blockHash:i,blockNumber:a,contractAddress:r,cumulativeGasUsed:_n(this.cumulativeGasUsed),from:e,gasPrice:_n(this.gasPrice),blobGasUsed:_n(this.blobGasUsed),blobGasPrice:_n(this.blobGasPrice),gasUsed:_n(this.gasUsed),hash:n,index:s,logs:c,logsBloom:o,root:u,status:l,to:t}}get length(){return this.logs.length}[Symbol.iterator](){let t=0;return{next:()=>t<this.length?{value:this.logs[t++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const t=await this.provider.getBlock(this.blockHash);if(null==t)throw new Error("TODO");return t}async getTransaction(){const t=await this.provider.getTransaction(this.hash);if(null==t)throw new Error("TODO");return t}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return Ln(this)}reorderedEvent(t){return d(!t||t.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),Bn(this,t)}}class Un{provider;blockNumber;blockHash;index;hash;type;to;from;nonce;gasLimit;gasPrice;maxPriorityFeePerGas;maxFeePerGas;maxFeePerBlobGas;data;value;chainId;signature;accessList;blobVersionedHashes;#Et;constructor(t,e){this.provider=e,this.blockNumber=null!=t.blockNumber?t.blockNumber:null,this.blockHash=null!=t.blockHash?t.blockHash:null,this.hash=t.hash,this.index=t.index,this.type=t.type,this.from=t.from,this.to=t.to||null,this.gasLimit=t.gasLimit,this.nonce=t.nonce,this.data=t.data,this.value=t.value,this.gasPrice=t.gasPrice,this.maxPriorityFeePerGas=null!=t.maxPriorityFeePerGas?t.maxPriorityFeePerGas:null,this.maxFeePerGas=null!=t.maxFeePerGas?t.maxFeePerGas:null,this.maxFeePerBlobGas=null!=t.maxFeePerBlobGas?t.maxFeePerBlobGas:null,this.chainId=t.chainId,this.signature=t.signature,this.accessList=null!=t.accessList?t.accessList:null,this.blobVersionedHashes=null!=t.blobVersionedHashes?t.blobVersionedHashes:null,this.#Et=-1}toJSON(){const{blockNumber:t,blockHash:e,index:r,hash:n,type:s,to:i,from:a,nonce:o,data:c,signature:l,accessList:u,blobVersionedHashes:h}=this;return{_type:"TransactionResponse",accessList:u,blockNumber:t,blockHash:e,blobVersionedHashes:h,chainId:_n(this.chainId),data:c,from:a,gasLimit:_n(this.gasLimit),gasPrice:_n(this.gasPrice),hash:n,maxFeePerGas:_n(this.maxFeePerGas),maxPriorityFeePerGas:_n(this.maxPriorityFeePerGas),maxFeePerBlobGas:_n(this.maxFeePerBlobGas),nonce:o,signature:l,to:i,index:r,type:s,value:_n(this.value)}}async getBlock(){let t=this.blockNumber;if(null==t){const e=await this.getTransaction();e&&(t=e.blockNumber)}if(null==t)return null;const e=this.provider.getBlock(t);if(null==e)throw new Error("TODO");return e}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(null==this.blockNumber){const{tx:t,blockNumber:e}=await a({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return null==t||null==t.blockNumber?0:e-t.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(t,e){const r=null==t?1:t,n=null==e?0:e;let s=this.#Et,i=-1,o=-1===s;const c=async()=>{if(o)return null;const{blockNumber:t,nonce:e}=await a({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(e<this.nonce)return void(s=t);if(o)return null;const n=await this.getTransaction();if(!n||null==n.blockNumber)for(-1===i&&(i=s-3,i<this.#Et&&(i=this.#Et));i<=t;){if(o)return null;const e=await this.provider.getBlock(i,!0);if(null==e)return;for(const t of e)if(t===this.hash)return;for(let n=0;n<e.length;n++){const i=await e.getTransaction(n);if(i.from===this.from&&i.nonce===this.nonce){if(o)return null;const e=await this.provider.getTransactionReceipt(i.hash);if(null==e)return;if(t-e.blockNumber+1<r)return;let n="replaced";i.data===this.data&&i.to===this.to&&i.value===this.value?n="repriced":"0x"===i.data&&i.from===i.to&&i.value===Rn&&(n="cancelled"),d(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:"replaced"===n||"cancelled"===n,reason:n,replacement:i.replaceableTransaction(s),hash:i.hash,receipt:e})}}i++}},u=t=>{if(null==t||0!==t.status)return t;d(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:t.to,from:t.from,data:""},receipt:t})},f=await this.provider.getTransactionReceipt(this.hash);if(0===r)return u(f);if(f){if(await f.confirmations()>=r)return u(f)}else if(await c(),0===r)return null;const p=new Promise(((t,e)=>{const i=[],a=()=>{i.forEach((t=>t()))};if(i.push((()=>{o=!0})),n>0){const t=setTimeout((()=>{a(),e(h("wait for transaction timeout","TIMEOUT"))}),n);i.push((()=>{clearTimeout(t)}))}const d=async n=>{if(await n.confirmations()>=r){a();try{t(u(n))}catch(s){e(s)}}};if(i.push((()=>{this.provider.off(this.hash,d)})),this.provider.on(this.hash,d),s>=0){const t=async()=>{try{await c()}catch(r){if(l(r,"TRANSACTION_REPLACED"))return a(),void e(r)}o||this.provider.once("block",t)};i.push((()=>{this.provider.off("block",t)})),this.provider.once("block",t)}}));return await p}isMined(){return null!=this.blockHash}isLegacy(){return 0===this.type}isBerlin(){return 1===this.type}isLondon(){return 2===this.type}isCancun(){return 3===this.type}removedEvent(){return d(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Ln(this)}reorderedEvent(t){return d(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),d(!t||t.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Bn(this,t)}replaceableTransaction(t){f(Number.isInteger(t)&&t>=0,"invalid startBlock","startBlock",t);const e=new Un(this,this.provider);return e.#Et=t,e}}function Bn(t,e){return{orphan:"reorder-transaction",tx:t,other:e}}function Ln(t){return{orphan:"drop-transaction",tx:t}}class Gn extends Fn{interface;fragment;args;constructor(t,e,r){super(t,t.provider),o(this,{args:e.decodeEventLog(r,t.data,t.topics),fragment:r,interface:e})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class Dn extends Fn{error;constructor(t,e){super(t,t.provider),o(this,{error:e})}}class $n extends Cn{#Nt;constructor(t,e,r){super(r,e),this.#Nt=t}get logs(){return super.logs.map((t=>{const e=t.topics.length?this.#Nt.getEvent(t.topics[0]):null;if(e)try{return new Gn(t,this.#Nt,e)}catch(r){return new Dn(t,r)}return t}))}}class jn extends Un{#Nt;constructor(t,e,r){super(r,e),this.#Nt=t}async wait(t,e){const r=await super.wait(t,e);return null==r?null:new $n(this.#Nt,this.provider,r)}}class Mn extends H{log;constructor(t,e,r,n){super(t,e,r),o(this,{log:n})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class Vn extends Mn{constructor(t,e,r,n,s){super(t,e,r,new Gn(s,t.interface,n)),o(this,{args:t.interface.decodeEventLog(n,this.log.data,this.log.topics),fragment:n})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const Hn=BigInt(0);function qn(t){return t&&"function"==typeof t.call}function Jn(t){return t&&"function"==typeof t.estimateGas}function zn(t){return t&&"function"==typeof t.resolveName}function Kn(t){return t&&"function"==typeof t.sendTransaction}function Wn(t){if(null!=t){if(zn(t))return t;if(t.provider)return t.provider}}class Xn{#Tt;fragment;constructor(t,e,r){if(o(this,{fragment:e}),e.inputs.length<r.length)throw new Error("too many arguments");const n=Zn(t.runner,"resolveName"),s=zn(n)?n:null;this.#Tt=async function(){const n=await Promise.all(e.inputs.map(((t,e)=>null==r[e]?null:t.walkAsync(r[e],((t,e)=>"address"===t?Array.isArray(e)?Promise.all(e.map((t=>ue(t,s)))):ue(e,s):e)))));return t.interface.encodeFilterTopics(e,n)}()}getTopicFilter(){return this.#Tt}}function Zn(t,e){return null==t?null:"function"==typeof t[e]?t:t.provider&&"function"==typeof t.provider[e]?t.provider:null}function Qn(t){return null==t?null:t.provider||null}async function Yn(t,e){const r=ge.dereference(t,"overrides");f("object"==typeof r,"invalid overrides parameter","overrides",t);const n=An(r);return f(null==n.to||(e||[]).indexOf("to")>=0,"cannot override to","overrides.to",n.to),f(null==n.data||(e||[]).indexOf("data")>=0,"cannot override data","overrides.data",n.data),n.from&&(n.from=n.from),n}function ts(t){const e=async function(e){const r=await Yn(e,["data"]);r.to=await t.getAddress(),r.from&&(r.from=await ue(r.from,Wn(t.runner)));const n=t.interface,s=C(r.value||Hn,"overrides.value")===Hn,i="0x"===(r.data||"0x");return!n.fallback||n.fallback.payable||!n.receive||i||s||f(!1,"cannot send data to receive or send value to non-payable fallback","overrides",e),f(n.fallback||i,"cannot send data to receive-only contract","overrides.data",r.data),f(n.receive||n.fallback&&n.fallback.payable||s,"cannot send value to non-payable fallback","overrides.value",r.value),f(n.fallback||i,"cannot send data to receive-only contract","overrides.data",r.data),r},r=async function(r){const n=t.runner;d(Kn(n),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const s=await n.sendTransaction(await e(r)),i=Qn(t.runner);return new jn(t.interface,i,s)},n=async t=>await r(t);return o(n,{_contract:t,estimateGas:async function(r){const n=Zn(t.runner,"estimateGas");return d(Jn(n),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await n.estimateGas(await e(r))},populateTransaction:e,send:r,staticCall:async function(r){const n=Zn(t.runner,"call");d(qn(n),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const s=await e(r);try{return await n.call(s)}catch(i){if(u(i)&&i.data)throw t.interface.makeError(i.data,s);throw i}}}),n}function es(t,e){const r=function(...r){const n=t.interface.getFunction(e,r);return d(n,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:r}}),n},n=async function(...e){const n=r(...e);let s={};if(n.inputs.length+1===e.length&&(s=await Yn(e.pop()),s.from&&(s.from=await ue(s.from,Wn(t.runner)))),n.inputs.length!==e.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const i=await async function(t,e,r){const n=Zn(t,"resolveName"),s=zn(n)?n:null;return await Promise.all(e.map(((t,e)=>t.walkAsync(r[e],((t,e)=>(e=ge.dereference(e,t),"address"===t?ue(e,s):e))))))}(t.runner,n.inputs,e);return Object.assign({},s,await a({to:t.getAddress(),data:t.interface.encodeFunctionData(n,i)}))},s=async function(...t){const e=await c(...t);return 1===e.length?e[0]:e},i=async function(...e){const r=t.runner;d(Kn(r),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const s=await r.sendTransaction(await n(...e)),i=Qn(t.runner);return new jn(t.interface,i,s)},c=async function(...e){const s=Zn(t.runner,"call");d(qn(s),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const i=await n(...e);let a="0x";try{a=await s.call(i)}catch(c){if(u(c)&&c.data)throw t.interface.makeError(c.data,i);throw c}const o=r(...e);return t.interface.decodeFunctionResult(o,a)},l=async(...t)=>r(...t).constant?await s(...t):await i(...t);return o(l,{name:t.interface.getFunctionName(e),_contract:t,_key:e,getFragment:r,estimateGas:async function(...e){const r=Zn(t.runner,"estimateGas");return d(Jn(r),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await r.estimateGas(await n(...e))},populateTransaction:n,send:i,staticCall:s,staticCallResult:c}),Object.defineProperty(l,"fragment",{configurable:!1,enumerable:!0,get:()=>{const r=t.interface.getFunction(e);return d(r,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),r}}),l}const rs=Symbol.for("_ethersInternal_contract"),ns=new WeakMap;function ss(t){return ns.get(t[rs])}async function is(t,e){let r,n=null;if(Array.isArray(e)){const n=function(e){if(v(e,32))return e;const r=t.interface.getEvent(e);return f(r,"unknown fragment","name",e),r.topicHash};r=e.map((t=>null==t?null:Array.isArray(t)?t.map(n):n(t)))}else"*"===e?r=[null]:"string"==typeof e?v(e,32)?r=[e]:(n=t.interface.getEvent(e),f(n,"unknown fragment","event",e),r=[n.topicHash]):(s=e)&&"object"==typeof s&&"getTopicFilter"in s&&"function"==typeof s.getTopicFilter&&s.fragment?r=await e.getTopicFilter():"fragment"in e?(n=e.fragment,r=[n.topicHash]):f(!1,"unknown event name","event",e);var s;return r=r.map((t=>{if(null==t)return null;if(Array.isArray(t)){const e=Array.from(new Set(t.map((t=>t.toLowerCase()))).values());return 1===e.length?e[0]:(e.sort(),e)}return t.toLowerCase()})),{fragment:n,tag:r.map((t=>null==t?"null":Array.isArray(t)?t.join("|"):t)).join("&"),topics:r}}async function as(t,e){const{subs:r}=ss(t);return r.get((await is(t,e)).tag)||null}async function os(t,e,r){const n=Qn(t.runner);d(n,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:e});const{fragment:s,tag:i,topics:a}=await is(t,r),{addr:o,subs:c}=ss(t);let l=c.get(i);if(!l){const e={address:o||t,topics:a},u=e=>{let n=s;if(null==n)try{n=t.interface.getEvent(e.topics[0])}catch(i){}if(n){const i=n,a=s?t.interface.decodeEventLog(s,e.data,e.topics):[];ls(t,r,a,(n=>new Vn(t,n,r,i,e)))}else ls(t,r,[],(n=>new Mn(t,n,r,e)))};let h=[];l={tag:i,listeners:[],start:()=>{h.length||h.push(n.on(e,u))},stop:async()=>{if(0==h.length)return;let t=h;h=[],await Promise.all(t),n.off(e,u)}},c.set(i,l)}return l}let cs=Promise.resolve();async function ls(t,e,r,n){try{await cs}catch(i){}const s=async function(t,e,r,n){await cs;const s=await as(t,e);if(!s)return!1;const a=s.listeners.length;return s.listeners=s.listeners.filter((({listener:e,once:s})=>{const a=Array.from(r);n&&a.push(n(s?null:e));try{e.call(t,...a)}catch(i){}return!s})),0===s.listeners.length&&(s.stop(),ss(t).subs.delete(s.tag)),a>0}(t,e,r,n);return cs=s,await s}const us=["then"];class hs{target;interface;runner;filters;[rs];fallback;constructor(t,e,r,n){f("string"==typeof t||ce(t),"invalid value for Contract target","target",t),null==r&&(r=null);const s=xn.from(e);let i;o(this,{target:t,runner:r,interface:s}),Object.defineProperty(this,rs,{value:{}});let a=null,c=null;if(n){const t=Qn(r);c=new jn(this.interface,t,n)}let u=new Map;if("string"==typeof t)if(v(t))a=t,i=Promise.resolve(t);else{const e=Zn(r,"resolveName");if(!zn(e))throw h("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});i=e.resolveName(t).then((e=>{if(null==e)throw h("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:t});return ss(this).addr=e,e}))}else i=t.getAddress().then((t=>{if(null==t)throw new Error("TODO");return ss(this).addr=t,t}));var d,p;d=this,p={addrPromise:i,addr:a,deployTx:c,subs:u},ns.set(d[rs],p);const g=new Proxy({},{get:(t,e,r)=>{if("symbol"==typeof e||us.indexOf(e)>=0)return Reflect.get(t,e,r);try{return this.getEvent(e)}catch(n){if(!l(n,"INVALID_ARGUMENT")||"key"!==n.argument)throw n}},has:(t,e)=>us.indexOf(e)>=0?Reflect.has(t,e):Reflect.has(t,e)||this.interface.hasEvent(String(e))});return o(this,{filters:g}),o(this,{fallback:s.receive||s.fallback?ts(this):null}),new Proxy(this,{get:(t,e,r)=>{if("symbol"==typeof e||e in t||us.indexOf(e)>=0)return Reflect.get(t,e,r);try{return t.getFunction(e)}catch(n){if(!l(n,"INVALID_ARGUMENT")||"key"!==n.argument)throw n}},has:(t,e)=>"symbol"==typeof e||e in t||us.indexOf(e)>=0?Reflect.has(t,e):t.interface.hasFunction(e)})}connect(t){return new hs(this.target,this.interface,t)}attach(t){return new hs(t,this.interface,this.runner)}async getAddress(){return await ss(this).addrPromise}async getDeployedCode(){const t=Qn(this.runner);d(t,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const e=await t.getCode(await this.getAddress());return"0x"===e?null:e}async waitForDeployment(){const t=this.deploymentTransaction();if(t)return await t.wait(),this;if(null!=await this.getDeployedCode())return this;const e=Qn(this.runner);return d(null!=e,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise(((t,r)=>{const n=async()=>{try{if(null!=await this.getDeployedCode())return t(this);e.once("block",n)}catch(s){r(s)}};n()}))}deploymentTransaction(){return ss(this).deployTx}getFunction(t){return"string"!=typeof t&&(t=t.format()),es(this,t)}getEvent(t){return"string"!=typeof t&&(t=t.format()),function(t,e){const r=function(...r){const n=t.interface.getEvent(e,r);return d(n,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:r}}),n},n=function(...e){return new Xn(t,r(...e),e)};return o(n,{name:t.interface.getEventName(e),_contract:t,_key:e,getFragment:r}),Object.defineProperty(n,"fragment",{configurable:!1,enumerable:!0,get:()=>{const r=t.interface.getEvent(e);return d(r,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),r}}),n}(this,t)}async queryTransaction(t){throw new Error("@TODO")}async queryFilter(t,e,r){null==e&&(e=0),null==r&&(r="latest");const{addr:n,addrPromise:s}=ss(this),i=n||await s,{fragment:a,topics:o}=await is(this,t),c={address:i,topics:o,fromBlock:e,toBlock:r},l=Qn(this.runner);return d(l,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await l.getLogs(c)).map((t=>{let e=a;if(null==e)try{e=this.interface.getEvent(t.topics[0])}catch(r){}if(e)try{return new Gn(t,this.interface,e)}catch(r){return new Dn(t,r)}return new Fn(t,l)}))}async on(t,e){const r=await os(this,"on",t);return r.listeners.push({listener:e,once:!1}),r.start(),this}async once(t,e){const r=await os(this,"once",t);return r.listeners.push({listener:e,once:!0}),r.start(),this}async emit(t,...e){return await ls(this,t,e,null)}async listenerCount(t){if(t){const e=await as(this,t);return e?e.listeners.length:0}const{subs:e}=ss(this);let r=0;for(const{listeners:n}of e.values())r+=n.length;return r}async listeners(t){if(t){const e=await as(this,t);return e?e.listeners.map((({listener:t})=>t)):[]}const{subs:e}=ss(this);let r=[];for(const{listeners:n}of e.values())r=r.concat(n.map((({listener:t})=>t)));return r}async off(t,e){const r=await as(this,t);if(!r)return this;if(e){const t=r.listeners.map((({listener:t})=>t)).indexOf(e);t>=0&&r.listeners.splice(t,1)}return null!=e&&0!==r.listeners.length||(r.stop(),ss(this).subs.delete(r.tag)),this}async removeAllListeners(t){if(t){const e=await as(this,t);if(!e)return this;e.stop(),ss(this).subs.delete(e.tag)}else{const{subs:t}=ss(this);for(const{tag:e,stop:r}of t.values())r(),t.delete(e)}return this}async addListener(t,e){return await this.on(t,e)}async removeListener(t,e){return await this.off(t,e)}static buildClass(t){return class extends hs{constructor(e,r=null){super(e,t,r)}}}static from(t,e,r){return null==r&&(r=null),new this(t,e,r)}}let ds=class extends(function(){return hs}()){};function fs(t){return t.match(/^ipfs:\/\/ipfs\//i)?t=t.substring(12):t.match(/^ipfs:\/\//i)?t=t.substring(7):f(!1,"unsupported IPFS format","link",t),`https://gateway.ipfs.io/ipfs/${t}`}t("C",ds);class ps{name;constructor(t){o(this,{name:t})}connect(t){return this}supportsCoinType(t){return!1}async encodeAddress(t,e){throw new Error("unsupported coin")}async decodeAddress(t,e){throw new Error("unsupported coin")}}const gs=new RegExp("^(ipfs)://(.*)$","i"),ms=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),gs,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];class ys{provider;address;name;#xt;#Rt;constructor(t,e,r){o(this,{provider:t,address:e,name:r}),this.#xt=null,this.#Rt=new ds(e,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],t)}async supportsWildcard(){return null==this.#xt&&(this.#xt=(async()=>{try{return await this.#Rt.supportsInterface("0x9061b923")}catch(t){if(l(t,"CALL_EXCEPTION"))return!1;throw this.#xt=null,t}})()),await this.#xt}async#Ot(t,e){e=(e||[]).slice();const r=this.#Rt.interface;e.unshift(Le(this.name));let n=null;await this.supportsWildcard()&&(n=r.getFunction(t),d(n,"missing fragment","UNKNOWN_ERROR",{info:{funcName:t}}),e=[Ge(this.name,255),r.encodeFunctionData(n,e)],t="resolve(bytes,bytes)"),e.push({enableCcipRead:!0});try{const s=await this.#Rt[t](...e);return n?r.decodeFunctionResult(n,s)[0]:s}catch(s){if(!l(s,"CALL_EXCEPTION"))throw s}return null}async getAddress(t){if(null==t&&(t=60),60===t)try{const t=await this.#Ot("addr(bytes32)");return null==t||t===Vt?null:t}catch(s){if(l(s,"CALL_EXCEPTION"))return null;throw s}if(t>=0&&t<2147483648){let e=t+2147483648;const r=await this.#Ot("addr(bytes32,uint)",[e]);if(v(r,20))return oe(r)}let e=null;for(const i of this.provider.plugins)if(i instanceof ps&&i.supportsCoinType(t)){e=i;break}if(null==e)return null;const r=await this.#Ot("addr(bytes32,uint)",[t]);if(null==r||"0x"===r)return null;const n=await e.decodeAddress(t,r);if(null!=n)return n;d(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${t})`,info:{coinType:t,data:r}})}async getText(t){const e=await this.#Ot("text(bytes32,string)",[t]);return null==e||"0x"===e?null:e}async getContentHash(){const t=await this.#Ot("contenthash(bytes32)");if(null==t||"0x"===t)return null;const e=t.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(e){const t="e3010170"===e[1]?"ipfs":"ipns",r=parseInt(e[4],16);if(e[5].length===2*r)return`${t}://${function(t){const e=b(t);let r=L(e),n="";for(;r;)n=M[Number(r%V)]+n,r/=V;for(let s=0;s<e.length&&!e[s];s++)n=M[0]+n;return n}("0x"+e[2])}`}const r=t.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(r&&64===r[1].length)return`bzz://${r[1]}`;d(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:t}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const t=[{type:"name",value:this.name}];try{const r=await this.getText("avatar");if(null==r)return t.push({type:"!avatar",value:""}),{url:null,linkage:t};t.push({type:"avatar",value:r});for(let n=0;n<ms.length;n++){const s=r.match(ms[n]);if(null==s)continue;const i=s[1].toLowerCase();switch(i){case"https":case"data":return t.push({type:"url",value:r}),{linkage:t,url:r};case"ipfs":{const e=fs(r);return t.push({type:"ipfs",value:r}),t.push({type:"url",value:e}),{linkage:t,url:e}}case"erc721":case"erc1155":{const n="erc721"===i?"tokenURI(uint256)":"uri(uint256)";t.push({type:i,value:r});const a=await this.getAddress();if(null==a)return t.push({type:"!owner",value:""}),{url:null,linkage:t};const o=(s[2]||"").split("/");if(2!==o.length)return t.push({type:`!${i}caip`,value:s[2]||""}),{url:null,linkage:t};const c=o[1],l=new ds(o[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if("erc721"===i){const e=await l.ownerOf(c);if(a!==e)return t.push({type:"!owner",value:e}),{url:null,linkage:t};t.push({type:"owner",value:e})}else if("erc1155"===i){const e=await l.balanceOf(a,c);if(!e)return t.push({type:"!balance",value:"0"}),{url:null,linkage:t};t.push({type:"balance",value:e.toString()})}let u=await l[n](c);if(null==u||"0x"===u)return t.push({type:"!metadata-url",value:""}),{url:null,linkage:t};t.push({type:"metadata-url-base",value:u}),"erc1155"===i&&(u=u.replace("{id}",D(c,32).substring(2)),t.push({type:"metadata-url-expanded",value:u})),u.match(/^ipfs:/i)&&(u=fs(u)),t.push({type:"metadata-url",value:u});let h={};const d=await new at(u).send();d.assertOk();try{h=d.bodyJson}catch(e){try{t.push({type:"!metadata",value:d.bodyText})}catch(e){const r=d.body;return r&&t.push({type:"!metadata",value:P(r)}),{url:null,linkage:t}}return{url:null,linkage:t}}if(!h)return t.push({type:"!metadata",value:""}),{url:null,linkage:t};t.push({type:"metadata",value:JSON.stringify(h)});let f=h.image;if("string"!=typeof f)return t.push({type:"!imageUrl",value:""}),{url:null,linkage:t};if(f.match(/^(https:\/\/|data:)/i));else{if(null==f.match(gs))return t.push({type:"!imageUrl-ipfs",value:f}),{url:null,linkage:t};t.push({type:"imageUrl-ipfs",value:f}),f=fs(f)}return t.push({type:"url",value:f}),{linkage:t,url:f}}}}}catch(e){}return{linkage:t,url:null}}static async getEnsAddress(t){const e=await t.getNetwork(),r=e.getPlugin("org.ethers.plugins.network.Ens");return d(r,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:e}}),r.address}static async#_t(t,e){const r=await ys.getEnsAddress(t);try{const n=new ds(r,["function resolver(bytes32) view returns (address)"],t),s=await n.resolver(Le(e),{enableCcipRead:!0});return s===Vt?null:s}catch(n){throw n}return null}static async fromName(t,e){let r=e;for(;;){if(""===r||"."===r)return null;if("eth"!==e&&"eth"===r)return null;const n=await ys.#_t(t,r);if(null!=n){const s=new ys(t,n,e);return r===e||await s.supportsWildcard()?s:null}r=r.split(".").slice(1).join(".")}}}const bs=BigInt(0);function ws(t,e){return function(r){return null==r?e:t(r)}}function vs(t,e){return r=>{if(e&&null==r)return null;if(!Array.isArray(r))throw new Error("not an array");return r.map((e=>t(e)))}}function ks(t,e){return r=>{const n={};for(const i in t){let a=i;if(e&&i in e&&!(a in r))for(const t of e[i])if(t in r){a=t;break}try{const e=t[i](r[a]);void 0!==e&&(n[i]=e)}catch(s){d(!1,`invalid value for value.${i} (${s instanceof Error?s.message:"not-an-error"})`,"BAD_DATA",{value:r})}}return n}}function Ps(t){return f(v(t,!0),"invalid data","value",t),t}function Es(t){return f(v(t,32),"invalid hash","value",t),t}const Ns=ks({address:oe,blockHash:Es,blockNumber:G,data:Ps,index:G,removed:ws((function(t){switch(t){case!0:case"true":return!0;case!1:case"false":return!1}f(!1,`invalid boolean; ${JSON.stringify(t)}`,"value",t)}),!1),topics:vs(Es),transactionHash:Es,transactionIndex:G},{index:["logIndex"]}),Ts=ks({hash:ws(Es),parentHash:Es,parentBeaconBlockRoot:ws(Es,null),number:G,timestamp:G,nonce:ws(Ps),difficulty:C,gasLimit:C,gasUsed:C,stateRoot:ws(Es,null),receiptsRoot:ws(Es,null),blobGasUsed:ws(C,null),excessBlobGas:ws(C,null),miner:ws(oe),extraData:Ps,baseFeePerGas:ws(C)}),xs=ks({transactionIndex:G,blockNumber:G,transactionHash:Es,address:oe,topics:vs(Es),data:Ps,index:G,blockHash:Es},{index:["logIndex"]}),Rs=ks({to:ws(oe,null),from:ws(oe,null),contractAddress:ws(oe,null),index:G,root:ws(P),gasUsed:C,blobGasUsed:ws(C,null),logsBloom:ws(Ps),blockHash:Es,hash:Es,logs:vs((function(t){return xs(t)})),blockNumber:G,cumulativeGasUsed:C,effectiveGasPrice:ws(C),blobGasPrice:ws(C,null),status:ws(G),type:ws(G,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function Os(t){t.to&&C(t.to)===bs&&(t.to="0x0000000000000000000000000000000000000000");const e=ks({hash:Es,index:ws(G,void 0),type:t=>"0x"===t||null==t?0:G(t),accessList:ws($e,null),blobVersionedHashes:ws(vs(Es,!0),null),blockHash:ws(Es,null),blockNumber:ws(G,null),transactionIndex:ws(G,null),from:oe,gasPrice:ws(C),maxPriorityFeePerGas:ws(C),maxFeePerGas:ws(C),maxFeePerBlobGas:ws(C,null),gasLimit:C,to:ws(oe,null),value:C,nonce:G,data:Ps,creates:ws(oe,null),chainId:ws(C,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(t);if(null==e.to&&null==e.creates&&(e.creates=function(t){const e=oe(t.from);let r=C(t.nonce,"tx.nonce").toString(16);return r="0"===r?"0x":r.length%2?"0x0"+r:"0x"+r,oe(T(Mt(Rt([e,r])),12))}(e)),1!==t.type&&2!==t.type||null!=t.accessList||(e.accessList=[]),t.signature?e.signature=Yt.from(t.signature):e.signature=Yt.from(t),null==e.chainId){const t=e.signature.legacyChainId;null!=t&&(e.chainId=t)}return e.blockHash&&C(e.blockHash)===bs&&(e.blockHash=null),e}class _s{name;constructor(t){o(this,{name:t})}clone(){return new _s(this.name)}}class Is extends _s{effectiveBlock;txBase;txCreate;txDataZero;txDataNonzero;txAccessListStorageKey;txAccessListAddress;constructor(t,e){null==t&&(t=0),super(`org.ethers.network.plugins.GasCost#${t||0}`);const r={effectiveBlock:t};function n(t,n){let s=(e||{})[t];null==s&&(s=n),f("number"==typeof s,`invalud value for ${t}`,"costs",e),r[t]=s}n("txBase",21e3),n("txCreate",32e3),n("txDataZero",4),n("txDataNonzero",16),n("txAccessListStorageKey",1900),n("txAccessListAddress",2400),o(this,r)}clone(){return new Is(this.effectiveBlock,this)}}class As extends _s{address;targetNetwork;constructor(t,e){super("org.ethers.plugins.network.Ens"),o(this,{address:t||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",targetNetwork:null==e?1:e})}clone(){return new As(this.address,this.targetNetwork)}}class Ss extends _s{#c;#It;get url(){return this.#c}get processFunc(){return this.#It}constructor(t,e){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin"),this.#c=t,this.#It=e}clone(){return this}}const Fs=new Map;class Cs{#At;#rt;#St;constructor(t,e){this.#At=t,this.#rt=C(e),this.#St=new Map}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return this.#At}set name(t){this.#At=t}get chainId(){return this.#rt}set chainId(t){this.#rt=C(t,"chainId")}matches(t){if(null==t)return!1;if("string"==typeof t){try{return this.chainId===C(t)}catch(e){}return this.name===t}if("number"==typeof t||"bigint"==typeof t){try{return this.chainId===C(t)}catch(e){}return!1}if("object"==typeof t){if(null!=t.chainId){try{return this.chainId===C(t.chainId)}catch(e){}return!1}return null!=t.name&&this.name===t.name}return!1}get plugins(){return Array.from(this.#St.values())}attachPlugin(t){if(this.#St.get(t.name))throw new Error(`cannot replace existing plugin: ${t.name} `);return this.#St.set(t.name,t.clone()),this}getPlugin(t){return this.#St.get(t)||null}getPlugins(t){return this.plugins.filter((e=>e.name.split("#")[0]===t))}clone(){const t=new Cs(this.name,this.chainId);return this.plugins.forEach((e=>{t.attachPlugin(e.clone())})),t}computeIntrinsicGas(t){const e=this.getPlugin("org.ethers.plugins.network.GasCost")||new Is;let r=e.txBase;if(null==t.to&&(r+=e.txCreate),t.data)for(let n=2;n<t.data.length;n+=2)"00"===t.data.substring(n,n+2)?r+=e.txDataZero:r+=e.txDataNonzero;if(t.accessList){const n=$e(t.accessList);for(const t in n)r+=e.txAccessListAddress+e.txAccessListStorageKey*n[t].storageKeys.length}return r}static from(t){if(function(){function t(t,e,r){const n=function(){const n=new Cs(t,e);return null!=r.ensNetwork&&n.attachPlugin(new As(null,r.ensNetwork)),n.attachPlugin(new Is),(r.plugins||[]).forEach((t=>{n.attachPlugin(t)})),n};Cs.register(t,n),Cs.register(e,n),r.altNames&&r.altNames.forEach((t=>{Cs.register(t,n)}))}Ls||(Ls=!0,t("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),t("ropsten",3,{ensNetwork:3}),t("rinkeby",4,{ensNetwork:4}),t("goerli",5,{ensNetwork:5}),t("kovan",42,{ensNetwork:42}),t("sepolia",11155111,{ensNetwork:11155111}),t("holesky",17e3,{ensNetwork:17e3}),t("classic",61,{}),t("classicKotti",6,{}),t("arbitrum",42161,{ensNetwork:1}),t("arbitrum-goerli",421613,{}),t("arbitrum-sepolia",421614,{}),t("base",8453,{ensNetwork:1}),t("base-goerli",84531,{}),t("base-sepolia",84532,{}),t("bnb",56,{ensNetwork:1}),t("bnbt",97,{}),t("linea",59144,{ensNetwork:1}),t("linea-goerli",59140,{}),t("matic",137,{ensNetwork:1,plugins:[Bs("https://gasstation.polygon.technology/v2")]}),t("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[Bs("https://gasstation-testnet.polygon.technology/v2")]}),t("optimism",10,{ensNetwork:1,plugins:[]}),t("optimism-goerli",420,{}),t("optimism-sepolia",11155420,{}),t("xdai",100,{ensNetwork:1}))}(),null==t)return Cs.from("mainnet");if("number"==typeof t&&(t=BigInt(t)),"string"==typeof t||"bigint"==typeof t){const e=Fs.get(t);if(e)return e();if("bigint"==typeof t)return new Cs("unknown",t);f(!1,"unknown network","network",t)}if("function"==typeof t.clone)return t.clone();if("object"==typeof t){f("string"==typeof t.name&&"number"==typeof t.chainId,"invalid network object name or chainId","network",t);const e=new Cs(t.name,t.chainId);return(t.ensAddress||null!=t.ensNetwork)&&e.attachPlugin(new As(t.ensAddress,t.ensNetwork)),e}f(!1,"invalid network","network",t)}static register(t,e){"number"==typeof t&&(t=BigInt(t));const r=Fs.get(t);r&&f(!1,`conflicting network for ${JSON.stringify(r.name)}`,"nameOrChainId",t),Fs.set(t,e)}}function Us(t,e){const r=String(t);if(!r.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${t}`);const n=r.split(".");if(1===n.length&&n.push(""),2!==n.length)throw new Error(`invalid gwei value: ${t}`);for(;n[1].length<e;)n[1]+="0";if(n[1].length>9){let t=BigInt(n[1].substring(0,9));n[1].substring(9).match(/^0+$/)||t++,n[1]=t.toString()}return BigInt(n[0]+n[1])}function Bs(t){return new Ss(t,(async(t,e,r)=>{let n;r.setHeader("User-Agent","ethers");try{const[e,s]=await Promise.all([r.send(),t()]);n=e;const i=n.bodyJson.standard;return{gasPrice:s.gasPrice,maxFeePerGas:Us(i.maxFee,9),maxPriorityFeePerGas:Us(i.maxPriorityFee,9)}}catch(s){d(!1,`error encountered with polygon gas station (${JSON.stringify(r.url)})`,"SERVER_ERROR",{request:r,response:n,error:s})}}))}let Ls=!1;function Gs(t){return JSON.parse(JSON.stringify(t))}class Ds{#Ft;#Ct;#Ut;#Bt;constructor(t){this.#Ft=t,this.#Ct=null,this.#Ut=4e3,this.#Bt=-2}get pollingInterval(){return this.#Ut}set pollingInterval(t){this.#Ut=t}async#Lt(){try{const t=await this.#Ft.getBlockNumber();if(-2===this.#Bt)return void(this.#Bt=t);if(t!==this.#Bt){for(let e=this.#Bt+1;e<=t;e++){if(null==this.#Ct)return;await this.#Ft.emit("block",e)}this.#Bt=t}}catch(t){}null!=this.#Ct&&(this.#Ct=this.#Ft._setTimeout(this.#Lt.bind(this),this.#Ut))}start(){this.#Ct||(this.#Ct=this.#Ft._setTimeout(this.#Lt.bind(this),this.#Ut),this.#Lt())}stop(){this.#Ct&&(this.#Ft._clearTimeout(this.#Ct),this.#Ct=null)}pause(t){this.stop(),t&&(this.#Bt=-2)}resume(){this.start()}}class $s{#Ft;#Lt;#Gt;constructor(t){this.#Ft=t,this.#Gt=!1,this.#Lt=t=>{this._poll(t,this.#Ft)}}async _poll(t,e){throw new Error("sub-classes must override this")}start(){this.#Gt||(this.#Gt=!0,this.#Lt(-2),this.#Ft.on("block",this.#Lt))}stop(){this.#Gt&&(this.#Gt=!1,this.#Ft.off("block",this.#Lt))}pause(t){this.stop()}resume(){this.start()}}class js extends $s{#Dt;#$t;constructor(t,e){super(t),this.#Dt=e,this.#$t=-2}pause(t){t&&(this.#$t=-2),super.pause(t)}async _poll(t,e){const r=await e.getBlock(this.#Dt);null!=r&&(-2===this.#$t?this.#$t=r.number:r.number>this.#$t&&(e.emit(this.#Dt,r.number),this.#$t=r.number))}}class Ms extends $s{#Tt;constructor(t,e){super(t),this.#Tt=Gs(e)}async _poll(t,e){throw new Error("@TODO")}}class Vs extends $s{#jt;constructor(t,e){super(t),this.#jt=e}async _poll(t,e){const r=await e.getTransactionReceipt(this.#jt);r&&e.emit(this.#jt,r)}}class Hs{#Ft;#Tt;#Ct;#Gt;#Bt;constructor(t,e){this.#Ft=t,this.#Tt=Gs(e),this.#Ct=this.#Lt.bind(this),this.#Gt=!1,this.#Bt=-2}async#Lt(t){if(-2===this.#Bt)return;const e=Gs(this.#Tt);e.fromBlock=this.#Bt+1,e.toBlock=t;const r=await this.#Ft.getLogs(e);if(0!==r.length)for(const n of r)this.#Ft.emit(this.#Tt,n),this.#Bt=n.blockNumber;else this.#Bt<t-60&&(this.#Bt=t-60)}start(){this.#Gt||(this.#Gt=!0,-2===this.#Bt&&this.#Ft.getBlockNumber().then((t=>{this.#Bt=t})),this.#Ft.on("block",this.#Ct))}stop(){this.#Gt&&(this.#Gt=!1,this.#Ft.off("block",this.#Ct))}pause(t){this.stop(),t&&(this.#Bt=-2)}resume(){this.start()}}const qs=BigInt(2);function Js(t){return t&&"function"==typeof t.then}function zs(t,e){return t+":"+JSON.stringify(e,((t,e)=>{if(null==e)return"null";if("bigint"==typeof e)return`bigint:${e.toString()}`;if("string"==typeof e)return e.toLowerCase();if("object"==typeof e&&!Array.isArray(e)){const t=Object.keys(e);return t.sort(),t.reduce(((t,r)=>(t[r]=e[r],t)),{})}return e}))}class Ks{name;constructor(t){o(this,{name:t})}start(){}stop(){}pause(t){}resume(){}}function Ws(t){return(t=Array.from(new Set(t).values())).sort(),t}async function Xs(t,e){if(null==t)throw new Error("invalid event");if(Array.isArray(t)&&(t={topics:t}),"string"==typeof t)switch(t){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:t,tag:t}}if(v(t,32)){const e=t.toLowerCase();return{type:"transaction",tag:zs("tx",{hash:e}),hash:e}}if(t.orphan){const e=t;return{type:"orphan",tag:zs("orphan",e),filter:(r=e,JSON.parse(JSON.stringify(r)))}}var r;if(t.address||t.topics){const r=t,n={topics:(r.topics||[]).map((t=>null==t?null:Array.isArray(t)?Ws(t.map((t=>t.toLowerCase()))):t.toLowerCase()))};if(r.address){const t=[],s=[],i=r=>{v(r)?t.push(r):s.push((async()=>{t.push(await ue(r,e))})())};Array.isArray(r.address)?r.address.forEach(i):i(r.address),s.length&&await Promise.all(s),n.address=Ws(t.map((t=>t.toLowerCase())))}return{filter:n,tag:zs("event",n),type:"event"}}f(!1,"unknown ProviderEvent","event",t)}function Zs(){return(new Date).getTime()}const Qs={cacheTimeout:250,pollingInterval:4e3};class Ys{#Mt;#St;#Vt;#Ht;#qt;#Jt;#zt;#Kt;#Wt;#Xt;#Zt;#z;constructor(t,e){if(this.#z=Object.assign({},Qs,e||{}),"any"===t)this.#Jt=!0,this.#qt=null;else if(t){const e=Cs.from(t);this.#Jt=!1,this.#qt=Promise.resolve(e),setTimeout((()=>{this.emit("network",e,null)}),0)}else this.#Jt=!1,this.#qt=null;this.#Kt=-1,this.#zt=new Map,this.#Mt=new Map,this.#St=new Map,this.#Vt=null,this.#Ht=!1,this.#Wt=1,this.#Xt=new Map,this.#Zt=!1}get pollingInterval(){return this.#z.pollingInterval}get provider(){return this}get plugins(){return Array.from(this.#St.values())}attachPlugin(t){if(this.#St.get(t.name))throw new Error(`cannot replace existing plugin: ${t.name} `);return this.#St.set(t.name,t.connect(this)),this}getPlugin(t){return this.#St.get(t)||null}get disableCcipRead(){return this.#Zt}set disableCcipRead(t){this.#Zt=!!t}async#Qt(t){const e=this.#z.cacheTimeout;if(e<0)return await this._perform(t);const r=zs(t.method,t);let n=this.#zt.get(r);return n||(n=this._perform(t),this.#zt.set(r,n),setTimeout((()=>{this.#zt.get(r)===n&&this.#zt.delete(r)}),e)),await n}async ccipReadFetch(t,e,r){if(this.disableCcipRead||0===r.length||null==t.to)return null;const n=t.to.toLowerCase(),s=e.toLowerCase(),i=[];for(let o=0;o<r.length;o++){const e=r[o],c=e.replace("{sender}",n).replace("{data}",s),l=new at(c);-1===e.indexOf("{data}")&&(l.body={data:s,sender:n}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:l,index:o,urls:r});let u="unknown error";const h=await l.send();try{const t=h.bodyJson;if(t.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:l,result:t}),t.data;t.message&&(u=t.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:l,result:t})}catch(a){}d(h.statusCode<400||h.statusCode>=500,`response not found during CCIP fetch: ${u}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:t,info:{url:e,errorMessage:u}}),i.push(u)}d(!1,`error encountered during CCIP fetch: ${i.map((t=>JSON.stringify(t))).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:t,info:{urls:r,errorMessages:i}})}_wrapBlock(t,e){return new Sn(function(t){const e=Ts(t);return e.transactions=t.transactions.map((t=>"string"==typeof t?t:Os(t))),e}(t),this)}_wrapLog(t,e){return new Fn(function(t){return Ns(t)}(t),this)}_wrapTransactionReceipt(t,e){return new Cn(function(t){return Rs(t)}(t),this)}_wrapTransactionResponse(t,e){return new Un(Os(t),this)}_detectNetwork(){d(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(t){d(!1,`unsupported method: ${t.method}`,"UNSUPPORTED_OPERATION",{operation:t.method,info:t})}async getBlockNumber(){const t=G(await this.#Qt({method:"getBlockNumber"}),"%response");return this.#Kt>=0&&(this.#Kt=t),t}_getAddress(t){return ue(t,this)}_getBlockTag(t){if(null==t)return"latest";switch(t){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return t}return v(t)?v(t,32)?t:j(t):("bigint"==typeof t&&(t=G(t,"blockTag")),"number"==typeof t?t>=0?j(t):this.#Kt>=0?j(this.#Kt+t):this.getBlockNumber().then((e=>j(e+t))):void f(!1,"invalid blockTag","blockTag",t))}_getFilter(t){const e=(t.topics||[]).map((t=>null==t?null:Array.isArray(t)?Ws(t.map((t=>t.toLowerCase()))):t.toLowerCase())),r="blockHash"in t?t.blockHash:void 0,n=(t,n,s)=>{let i;switch(t.length){case 0:break;case 1:i=t[0];break;default:t.sort(),i=t}if(r&&(null!=n||null!=s))throw new Error("invalid filter");const a={};return i&&(a.address=i),e.length&&(a.topics=e),n&&(a.fromBlock=n),s&&(a.toBlock=s),r&&(a.blockHash=r),a};let s,i,a=[];if(t.address)if(Array.isArray(t.address))for(const o of t.address)a.push(this._getAddress(o));else a.push(this._getAddress(t.address));return"fromBlock"in t&&(s=this._getBlockTag(t.fromBlock)),"toBlock"in t&&(i=this._getBlockTag(t.toBlock)),a.filter((t=>"string"!=typeof t)).length||null!=s&&"string"!=typeof s||null!=i&&"string"!=typeof i?Promise.all([Promise.all(a),s,i]).then((t=>n(t[0],t[1],t[2]))):n(a,s,i)}_getTransactionRequest(t){const e=An(t),r=[];if(["to","from"].forEach((t=>{if(null==e[t])return;const n=ue(e[t],this);Js(n)?r.push(async function(){e[t]=await n}()):e[t]=n})),null!=e.blockTag){const t=this._getBlockTag(e.blockTag);Js(t)?r.push(async function(){e.blockTag=await t}()):e.blockTag=t}return r.length?async function(){return await Promise.all(r),e}():e}async getNetwork(){if(null==this.#qt){const t=(async()=>{try{const t=await this._detectNetwork();return this.emit("network",t,null),t}catch(e){throw this.#qt===t&&(this.#qt=null),e}})();return this.#qt=t,(await t).clone()}const t=this.#qt,[e,r]=await Promise.all([t,this._detectNetwork()]);return e.chainId!==r.chainId&&(this.#Jt?(this.emit("network",r,e),this.#qt===t&&(this.#qt=Promise.resolve(r))):d(!1,`network changed: ${e.chainId} => ${r.chainId} `,"NETWORK_ERROR",{event:"changed"})),e.clone()}async getFeeData(){const t=await this.getNetwork(),e=async()=>{const{_block:e,gasPrice:r,priorityFee:n}=await a({_block:this.#Yt("latest",!1),gasPrice:(async()=>{try{return C(await this.#Qt({method:"getGasPrice"}),"%response")}catch(t){}return null})(),priorityFee:(async()=>{try{return C(await this.#Qt({method:"getPriorityFee"}),"%response")}catch(t){}return null})()});let s=null,i=null;const o=this._wrapBlock(e,t);return o&&o.baseFeePerGas&&(i=null!=n?n:BigInt("1000000000"),s=o.baseFeePerGas*qs+i),new In(r,s,i)},r=t.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(r){const t=new at(r.url),n=await r.processFunc(e,this,t);return new In(n.gasPrice,n.maxFeePerGas,n.maxPriorityFeePerGas)}return await e()}async estimateGas(t){let e=this._getTransactionRequest(t);return Js(e)&&(e=await e),C(await this.#Qt({method:"estimateGas",transaction:e}),"%response")}async#te(t,e,r){d(r<10,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},t,{blockTag:e,enableCcipRead:!0})});const n=An(t);try{return P(await this._perform({method:"call",transaction:n,blockTag:e}))}catch(s){if(!this.disableCcipRead&&u(s)&&s.data&&r>=0&&"latest"===e&&null!=n.to&&"0x556f1830"===T(s.data,0,4)){const t=s.data,i=await ue(n.to,this);let a;try{a=function(t){const e={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};d(N(t)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const r=T(t,0,32);d(T(r,0,12)===T(ai,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),e.sender=T(r,12);try{const r=[],n=G(T(t,32,64)),s=G(T(t,n,n+32)),i=T(t,n+32);for(let t=0;t<s;t++){const e=ti(i,32*t);if(null==e)throw new Error("abort");r.push(e)}e.urls=r}catch(s){d(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const r=ei(t,64);if(null==r)throw new Error("abort");e.calldata=r}catch(s){d(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}d(T(t,100,128)===T(ai,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),e.selector=T(t,96,100);try{const r=ei(t,128);if(null==r)throw new Error("abort");e.extraData=r}catch(s){d(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return e.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map((t=>e[t])),e}(T(s.data,4))}catch(s){d(!1,s.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:n,info:{data:t}})}d(a.sender.toLowerCase()===i.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:t,reason:"OffchainLookup",transaction:n,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:a.errorArgs}});const o=await this.ccipReadFetch(n,a.calldata,a.urls);d(null!=o,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:n,info:{data:s.data,errorArgs:a.errorArgs}});const c={to:i,data:E([a.selector,ii([o,a.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:c});try{const t=await this.#te(c,e,r+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},c),result:t}),t}catch(s){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},c),error:s}),s}}throw s}}async#ee(t){const{value:e}=await a({network:this.getNetwork(),value:t});return e}async call(t){const{tx:e,blockTag:r}=await a({tx:this._getTransactionRequest(t),blockTag:this._getBlockTag(t.blockTag)});return await this.#ee(this.#te(e,r,t.enableCcipRead?0:-1))}async#re(t,e,r){let n=this._getAddress(e),s=this._getBlockTag(r);return"string"==typeof n&&"string"==typeof s||([n,s]=await Promise.all([n,s])),await this.#ee(this.#Qt(Object.assign(t,{address:n,blockTag:s})))}async getBalance(t,e){return C(await this.#re({method:"getBalance"},t,e),"%response")}async getTransactionCount(t,e){return G(await this.#re({method:"getTransactionCount"},t,e),"%response")}async getCode(t,e){return P(await this.#re({method:"getCode"},t,e))}async getStorage(t,e,r){const n=C(e,"position");return P(await this.#re({method:"getStorage",position:n},t,r))}async broadcastTransaction(t){const{blockNumber:e,hash:r,network:n}=await a({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:t}),network:this.getNetwork()}),s=ar.from(t);if(s.hash!==r)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(s,n).replaceableTransaction(e)}async#Yt(t,e){if(v(t,32))return await this.#Qt({method:"getBlock",blockHash:t,includeTransactions:e});let r=this._getBlockTag(t);return"string"!=typeof r&&(r=await r),await this.#Qt({method:"getBlock",blockTag:r,includeTransactions:e})}async getBlock(t,e){const{network:r,params:n}=await a({network:this.getNetwork(),params:this.#Yt(t,!!e)});return null==n?null:this._wrapBlock(n,r)}async getTransaction(t){const{network:e,params:r}=await a({network:this.getNetwork(),params:this.#Qt({method:"getTransaction",hash:t})});return null==r?null:this._wrapTransactionResponse(r,e)}async getTransactionReceipt(t){const{network:e,params:r}=await a({network:this.getNetwork(),params:this.#Qt({method:"getTransactionReceipt",hash:t})});if(null==r)return null;if(null==r.gasPrice&&null==r.effectiveGasPrice){const e=await this.#Qt({method:"getTransaction",hash:t});if(null==e)throw new Error("report this; could not find tx or effectiveGasPrice");r.effectiveGasPrice=e.gasPrice}return this._wrapTransactionReceipt(r,e)}async getTransactionResult(t){const{result:e}=await a({network:this.getNetwork(),result:this.#Qt({method:"getTransactionResult",hash:t})});return null==e?null:P(e)}async getLogs(t){let e=this._getFilter(t);Js(e)&&(e=await e);const{network:r,params:n}=await a({network:this.getNetwork(),params:this.#Qt({method:"getLogs",filter:e})});return n.map((t=>this._wrapLog(t,r)))}_getProvider(t){d(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(t){return await ys.fromName(this,t)}async getAvatar(t){const e=await this.getResolver(t);return e?await e.getAvatar():null}async resolveName(t){const e=await this.getResolver(t);return e?await e.getAddress():null}async lookupAddress(t){const e=Le((t=oe(t)).substring(2).toLowerCase()+".addr.reverse");try{const r=await ys.getEnsAddress(this),n=new ds(r,["function resolver(bytes32) view returns (address)"],this),s=await n.resolver(e);if(null==s||s===Vt)return null;const i=new ds(s,["function name(bytes32) view returns (string)"],this),a=await i.name(e);return await this.resolveName(a)!==t?null:a}catch(r){if(l(r,"BAD_DATA")&&"0x"===r.value)return null;if(l(r,"CALL_EXCEPTION"))return null;throw r}return null}async waitForTransaction(t,e,r){const n=null!=e?e:1;return 0===n?this.getTransactionReceipt(t):new Promise((async(e,s)=>{let i=null;const a=async r=>{try{const s=await this.getTransactionReceipt(t);if(null!=s&&r-s.blockNumber+1>=n)return e(s),void(i&&(clearTimeout(i),i=null))}catch(s){console.log("EEE",s)}this.once("block",a)};null!=r&&(i=setTimeout((()=>{null!=i&&(i=null,this.off("block",a),s(h("timeout","TIMEOUT",{reason:"timeout"})))}),r)),a(await this.getBlockNumber())}))}async waitForBlock(t){d(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(t){const e=this.#Xt.get(t);e&&(e.timer&&clearTimeout(e.timer),this.#Xt.delete(t))}_setTimeout(t,e){null==e&&(e=0);const r=this.#Wt++,n=()=>{this.#Xt.delete(r),t()};if(this.paused)this.#Xt.set(r,{timer:null,func:n,time:e});else{const t=setTimeout(n,e);this.#Xt.set(r,{timer:t,func:n,time:Zs()})}return r}_forEachSubscriber(t){for(const e of this.#Mt.values())t(e.subscriber)}_getSubscriber(t){switch(t.type){case"debug":case"error":case"network":return new Ks(t.type);case"block":{const t=new Ds(this);return t.pollingInterval=this.pollingInterval,t}case"safe":case"finalized":return new js(this,t.type);case"event":return new Hs(this,t.filter);case"transaction":return new Vs(this,t.hash);case"orphan":return new Ms(this,t.filter)}throw new Error(`unsupported event: ${t.type}`)}_recoverSubscriber(t,e){for(const r of this.#Mt.values())if(r.subscriber===t){r.started&&r.subscriber.stop(),r.subscriber=e,r.started&&e.start(),null!=this.#Vt&&e.pause(this.#Vt);break}}async#ne(t,e){let r=await Xs(t,this);return"event"===r.type&&e&&e.length>0&&!0===e[0].removed&&(r=await Xs({orphan:"drop-log",log:e[0]},this)),this.#Mt.get(r.tag)||null}async#se(t){const e=await Xs(t,this),r=e.tag;let n=this.#Mt.get(r);return n||(n={subscriber:this._getSubscriber(e),tag:r,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},this.#Mt.set(r,n)),n}async on(t,e){const r=await this.#se(t);return r.listeners.push({listener:e,once:!1}),r.started||(r.subscriber.start(),r.started=!0,null!=this.#Vt&&r.subscriber.pause(this.#Vt)),this}async once(t,e){const r=await this.#se(t);return r.listeners.push({listener:e,once:!0}),r.started||(r.subscriber.start(),r.started=!0,null!=this.#Vt&&r.subscriber.pause(this.#Vt)),this}async emit(t,...e){const r=await this.#ne(t,e);if(!r||0===r.listeners.length)return!1;const n=r.listeners.length;return r.listeners=r.listeners.filter((({listener:r,once:n})=>{const s=new H(this,n?null:r,t);try{r.call(this,...e,s)}catch(i){}return!n})),0===r.listeners.length&&(r.started&&r.subscriber.stop(),this.#Mt.delete(r.tag)),n>0}async listenerCount(t){if(t){const e=await this.#ne(t);return e?e.listeners.length:0}let e=0;for(const{listeners:r}of this.#Mt.values())e+=r.length;return e}async listeners(t){if(t){const e=await this.#ne(t);return e?e.listeners.map((({listener:t})=>t)):[]}let e=[];for(const{listeners:r}of this.#Mt.values())e=e.concat(r.map((({listener:t})=>t)));return e}async off(t,e){const r=await this.#ne(t);if(!r)return this;if(e){const t=r.listeners.map((({listener:t})=>t)).indexOf(e);t>=0&&r.listeners.splice(t,1)}return e&&0!==r.listeners.length||(r.started&&r.subscriber.stop(),this.#Mt.delete(r.tag)),this}async removeAllListeners(t){if(t){const{tag:e,started:r,subscriber:n}=await this.#se(t);r&&n.stop(),this.#Mt.delete(e)}else for(const[e,{started:r,subscriber:n}]of this.#Mt)r&&n.stop(),this.#Mt.delete(e);return this}async addListener(t,e){return await this.on(t,e)}async removeListener(t,e){return this.off(t,e)}get destroyed(){return this.#Ht}destroy(){this.removeAllListeners();for(const t of this.#Xt.keys())this._clearTimeout(t);this.#Ht=!0}get paused(){return null!=this.#Vt}set paused(t){!!t!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(t){if(this.#Kt=-1,null!=this.#Vt){if(this.#Vt==!!t)return;d(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber((e=>e.pause(t))),this.#Vt=!!t;for(const e of this.#Xt.values())e.timer&&clearTimeout(e.timer),e.time=Zs()-e.time}resume(){if(null!=this.#Vt){this._forEachSubscriber((t=>t.resume())),this.#Vt=null;for(const t of this.#Xt.values()){let e=t.time;e<0&&(e=0),t.time=Zs(),setTimeout(t.func,e)}}}}function ti(t,e){try{const r=ei(t,e);if(r)return K(r)}catch(r){}return null}function ei(t,e){if("0x"===t)return null;try{const r=G(T(t,e,e+32)),n=G(T(t,r,r+32));return T(t,r+32,r+32+n)}catch(r){}return null}function ri(t){const e=$(t);if(e.length>32)throw new Error("internal; should not happen");const r=new Uint8Array(32);return r.set(e,32-e.length),r}function ni(t){if(t.length%32==0)return t;const e=new Uint8Array(32*Math.ceil(t.length/32));return e.set(t),e}const si=new Uint8Array([]);function ii(t){const e=[];let r=0;for(let n=0;n<t.length;n++)e.push(si),r+=32;for(let n=0;n<t.length;n++){const s=b(t[n]);e[n]=ri(r),e.push(ri(s.length)),e.push(ni(s)),r+=32+32*Math.ceil(s.length/32)}return E(e)}const ai="0x0000000000000000000000000000000000000000000000000000000000000000";function oi(t,e){if(t.provider)return t.provider;d(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:e})}async function ci(t,e){let r=An(e);if(null!=r.to&&(r.to=ue(r.to,t)),null!=r.from){const e=r.from;r.from=Promise.all([t.getAddress(),ue(e,t)]).then((([t,e])=>(f(t.toLowerCase()===e.toLowerCase(),"transaction from mismatch","tx.from",e),t)))}else r.from=t.getAddress();return await a(r)}class li{provider;constructor(t){o(this,{provider:t||null})}async getNonce(t){return oi(this,"getTransactionCount").getTransactionCount(await this.getAddress(),t)}async populateCall(t){return await ci(this,t)}async populateTransaction(t){const e=oi(this,"populateTransaction"),r=await ci(this,t);null==r.nonce&&(r.nonce=await this.getNonce("pending")),null==r.gasLimit&&(r.gasLimit=await this.estimateGas(r));const n=await this.provider.getNetwork();null!=r.chainId?f(C(r.chainId)===n.chainId,"transaction chainId mismatch","tx.chainId",t.chainId):r.chainId=n.chainId;const s=null!=r.maxFeePerGas||null!=r.maxPriorityFeePerGas;if(null==r.gasPrice||2!==r.type&&!s?0!==r.type&&1!==r.type||!s||f(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",t):f(!1,"eip-1559 transaction do not support gasPrice","tx",t),2!==r.type&&null!=r.type||null==r.maxFeePerGas||null==r.maxPriorityFeePerGas)if(0===r.type||1===r.type){const t=await e.getFeeData();d(null!=t.gasPrice,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),null==r.gasPrice&&(r.gasPrice=t.gasPrice)}else{const t=await e.getFeeData();if(null==r.type)if(null!=t.maxFeePerGas&&null!=t.maxPriorityFeePerGas)if(r.type=2,null!=r.gasPrice){const t=r.gasPrice;delete r.gasPrice,r.maxFeePerGas=t,r.maxPriorityFeePerGas=t}else null==r.maxFeePerGas&&(r.maxFeePerGas=t.maxFeePerGas),null==r.maxPriorityFeePerGas&&(r.maxPriorityFeePerGas=t.maxPriorityFeePerGas);else null!=t.gasPrice?(d(!s,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),null==r.gasPrice&&(r.gasPrice=t.gasPrice),r.type=0):d(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else 2===r.type&&(null==r.maxFeePerGas&&(r.maxFeePerGas=t.maxFeePerGas),null==r.maxPriorityFeePerGas&&(r.maxPriorityFeePerGas=t.maxPriorityFeePerGas))}else r.type=2;return await a(r)}async estimateGas(t){return oi(this,"estimateGas").estimateGas(await this.populateCall(t))}async call(t){return oi(this,"call").call(await this.populateCall(t))}async resolveName(t){const e=oi(this,"resolveName");return await e.resolveName(t)}async sendTransaction(t){const e=oi(this,"sendTransaction"),r=await this.populateTransaction(t);delete r.from;const n=ar.from(r);return await e.broadcastTransaction(await this.signTransaction(n))}}const ui=new Set;function hi(t){ui.has(t)||(ui.add(t),console.log("========= NOTICE ========="),console.log(`Request-Rate Exceeded for ${t} (this message will not be repeated)`),console.log(""),console.log("The default API keys for each service are provided as a highly-throttled,"),console.log("community resource for low-traffic projects and early prototyping."),console.log(""),console.log("While your application will continue to function, we highly recommended"),console.log("signing up for your own API keys to improve performance, increase your"),console.log("request rate/limit and enable other perks, such as metrics and advanced APIs."),console.log(""),console.log("For more details: https://docs.ethers.org/api-keys/"),console.log("=========================="))}class di{#Ft;#ie;#Ct;#Gt;#ae;#oe;constructor(t){this.#Ft=t,this.#ie=null,this.#Ct=this.#Lt.bind(this),this.#Gt=!1,this.#ae=null,this.#oe=!1}_subscribe(t){throw new Error("subclasses must override this")}_emitResults(t,e){throw new Error("subclasses must override this")}_recover(t){throw new Error("subclasses must override this")}async#Lt(t){try{null==this.#ie&&(this.#ie=this._subscribe(this.#Ft));let t=null;try{t=await this.#ie}catch(e){if(!l(e,"UNSUPPORTED_OPERATION")||"eth_newFilter"!==e.operation)throw e}if(null==t)return this.#ie=null,void this.#Ft._recoverSubscriber(this,this._recover(this.#Ft));const r=await this.#Ft.getNetwork();if(this.#ae||(this.#ae=r),this.#ae.chainId!==r.chainId)throw new Error("chaid changed");if(this.#oe)return;const n=await this.#Ft.send("eth_getFilterChanges",[t]);await this._emitResults(this.#Ft,n)}catch(e){console.log("@TODO",e)}this.#Ft.once("block",this.#Ct)}#ce(){const t=this.#ie;t&&(this.#ie=null,t.then((t=>{this.#Ft.send("eth_uninstallFilter",[t])})))}start(){this.#Gt||(this.#Gt=!0,this.#Lt(-2))}stop(){this.#Gt&&(this.#Gt=!1,this.#oe=!0,this.#ce(),this.#Ft.off("block",this.#Ct))}pause(t){t&&this.#ce(),this.#Ft.off("block",this.#Ct)}resume(){this.start()}}class fi extends di{#le;constructor(t,e){var r;super(t),this.#le=(r=e,JSON.parse(JSON.stringify(r)))}_recover(t){return new Hs(t,this.#le)}async _subscribe(t){return await t.send("eth_newFilter",[this.#le])}async _emitResults(t,e){for(const r of e)t.emit(this.#le,t._wrapLog(r,t._network))}}class pi extends di{async _subscribe(t){return await t.send("eth_newPendingTransactionFilter",[])}async _emitResults(t,e){for(const r of e)t.emit("pending",r)}}const gi="bigint,boolean,function,number,string,symbol".split(/,/g);function mi(t){if(null==t||gi.indexOf(typeof t)>=0)return t;if("function"==typeof t.getAddress)return t;if(Array.isArray(t))return t.map(mi);if("object"==typeof t)return Object.keys(t).reduce(((e,r)=>(e[r]=t[r],e)),{});throw new Error(`should not happen: ${t} (${typeof t})`)}function yi(t){return new Promise((e=>{setTimeout(e,t)}))}function bi(t){return t?t.toLowerCase():t}function wi(t){return t&&"number"==typeof t.pollingInterval}const vi={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class ki extends li{address;constructor(t,e){super(t),o(this,{address:e=oe(e)})}connect(t){d(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(t){return await this.populateCall(t)}async sendUncheckedTransaction(t){const e=mi(t),r=[];if(e.from){const n=e.from;r.push((async()=>{const r=await ue(n,this.provider);f(null!=r&&r.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),e.from=r})())}else e.from=this.address;if(null==e.gasLimit&&r.push((async()=>{e.gasLimit=await this.provider.estimateGas({...e,from:this.address})})()),null!=e.to){const t=e.to;r.push((async()=>{e.to=await ue(t,this.provider)})())}r.length&&await Promise.all(r);const n=this.provider.getRpcTransaction(e);return this.provider.send("eth_sendTransaction",[n])}async sendTransaction(t){const e=await this.provider.getBlockNumber(),r=await this.sendUncheckedTransaction(t);return await new Promise(((t,n)=>{const s=[1e3,100];let i=0;const a=async()=>{try{const n=await this.provider.getTransaction(r);if(null!=n)return void t(n.replaceableTransaction(e))}catch(o){if(l(o,"CANCELLED")||l(o,"BAD_DATA")||l(o,"NETWORK_ERROR"))return null==o.info&&(o.info={}),o.info.sendTransactionHash=r,void n(o);if(l(o,"INVALID_ARGUMENT")&&(i++,null==o.info&&(o.info={}),o.info.sendTransactionHash=r,i>10))return void n(o);this.provider.emit("error",h("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:o}))}this.provider._setTimeout((()=>{a()}),s.pop()||4e3)};a()}))}async signTransaction(t){const e=mi(t);if(e.from){const r=await ue(e.from,this.provider);f(null!=r&&r.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),e.from=r}else e.from=this.address;const r=this.provider.getRpcTransaction(e);return await this.provider.send("eth_signTransaction",[r])}async signMessage(t){const e="string"==typeof t?z(t):t;return await this.provider.send("personal_sign",[P(e),this.address.toLowerCase()])}async signTypedData(t,e,r){const n=mi(r),s=await kr.resolveNames(t,e,n,(async t=>{const e=await ue(t);return f(null!=e,"TypedData does not support null address","value",t),e}));return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(kr.getPayload(s.domain,e,s.value))])}async unlock(t){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),t,null])}async _legacySignMessage(t){const e="string"==typeof t?z(t):t;return await this.provider.send("eth_sign",[this.address.toLowerCase(),P(e)])}}class Pi extends Ys{#z;#ue;#he;#de;#fe;#ae;#pe;#ge(){if(this.#de)return;const t=1===this._getOption("batchMaxCount")?0:this._getOption("batchStallTime");this.#de=setTimeout((()=>{this.#de=null;const t=this.#he;for(this.#he=[];t.length;){const e=[t.shift()];for(;t.length&&e.length!==this.#z.batchMaxCount;)if(e.push(t.shift()),JSON.stringify(e.map((t=>t.payload))).length>this.#z.batchMaxSize){t.unshift(e.pop());break}(async()=>{const t=1===e.length?e[0].payload:e.map((t=>t.payload));this.emit("debug",{action:"sendRpcPayload",payload:t});try{const r=await this._send(t);this.emit("debug",{action:"receiveRpcResult",result:r});for(const{resolve:t,reject:n,payload:s}of e){if(this.destroyed){n(h("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:s.method}));continue}const e=r.filter((t=>t.id===s.id))[0];if(null!=e)"error"in e?n(this.getRpcError(s,e)):t(e.result);else{const t=h("missing response for request","BAD_DATA",{value:r,info:{payload:s}});this.emit("error",t),n(t)}}}catch(r){this.emit("debug",{action:"receiveRpcError",error:r});for(const{reject:t}of e)t(r)}})()}}),t)}constructor(t,e){super(t,e),this.#ue=1,this.#z=Object.assign({},vi,e||{}),this.#he=[],this.#de=null,this.#ae=null,this.#pe=null;{let t=null;const e=new Promise((e=>{t=e}));this.#fe={promise:e,resolve:t}}const r=this._getOption("staticNetwork");"boolean"==typeof r?(f(!r||"any"!==t,"staticNetwork cannot be used on special network 'any'","options",e),r&&null!=t&&(this.#ae=Cs.from(t))):r&&(f(null==t||r.matches(t),"staticNetwork MUST match network object","options",e),this.#ae=r)}_getOption(t){return this.#z[t]}get _network(){return d(this.#ae,"network is not available yet","NETWORK_ERROR"),this.#ae}async _perform(t){if("call"===t.method||"estimateGas"===t.method){let e=t.transaction;if(e&&null!=e.type&&C(e.type)&&null==e.maxFeePerGas&&null==e.maxPriorityFeePerGas){const r=await this.getFeeData();null==r.maxFeePerGas&&null==r.maxPriorityFeePerGas&&(t=Object.assign({},t,{transaction:Object.assign({},e,{type:void 0})}))}}const e=this.getRpcRequest(t);return null!=e?await this.send(e.method,e.args):super._perform(t)}async _detectNetwork(){const t=this._getOption("staticNetwork");if(t){if(!0!==t)return t;if(this.#ae)return this.#ae}return this.#pe?await this.#pe:this.ready?(this.#pe=(async()=>{try{const t=Cs.from(C(await this.send("eth_chainId",[])));return this.#pe=null,t}catch(t){throw this.#pe=null,t}})(),await this.#pe):(this.#pe=(async()=>{const t={id:this.#ue++,method:"eth_chainId",params:[],jsonrpc:"2.0"};let e;this.emit("debug",{action:"sendRpcPayload",payload:t});try{e=(await this._send(t))[0],this.#pe=null}catch(r){throw this.#pe=null,this.emit("debug",{action:"receiveRpcError",error:r}),r}if(this.emit("debug",{action:"receiveRpcResult",result:e}),"result"in e)return Cs.from(C(e.result));throw this.getRpcError(t,e)})(),await this.#pe)}_start(){null!=this.#fe&&null!=this.#fe.resolve&&(this.#fe.resolve(),this.#fe=null,(async()=>{for(;null==this.#ae&&!this.destroyed;)try{this.#ae=await this._detectNetwork()}catch(t){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",h("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:t}})),await yi(1e3)}this.#ge()})())}async _waitUntilReady(){if(null!=this.#fe)return await this.#fe.promise}_getSubscriber(t){return"pending"===t.type?new pi(this):"event"===t.type?this._getOption("polling")?new Hs(this,t.filter):new fi(this,t.filter):"orphan"===t.type&&"drop-log"===t.filter.orphan?new Ks("orphan"):super._getSubscriber(t)}get ready(){return null==this.#fe}getRpcTransaction(t){const e={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach((r=>{if(null==t[r])return;let n=r;"gasLimit"===r&&(n="gas"),e[n]=j(C(t[r],`tx.${r}`))})),["from","to","data"].forEach((r=>{null!=t[r]&&(e[r]=P(t[r]))})),t.accessList&&(e.accessList=$e(t.accessList)),e}getRpcRequest(t){switch(t.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[bi(t.address),t.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[bi(t.address),t.blockTag]};case"getCode":return{method:"eth_getCode",args:[bi(t.address),t.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[bi(t.address),"0x"+t.position.toString(16),t.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[t.signedTransaction]};case"getBlock":if("blockTag"in t)return{method:"eth_getBlockByNumber",args:[t.blockTag,!!t.includeTransactions]};if("blockHash"in t)return{method:"eth_getBlockByHash",args:[t.blockHash,!!t.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[t.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[t.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(t.transaction),t.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(t.transaction)]};case"getLogs":return t.filter&&null!=t.filter.address&&(Array.isArray(t.filter.address)?t.filter.address=t.filter.address.map(bi):t.filter.address=bi(t.filter.address)),{method:"eth_getLogs",args:[t.filter]}}return null}getRpcError(t,e){const{method:r}=t,{error:n}=e;if("eth_estimateGas"===r&&n.message){const e=n.message;if(!e.match(/revert/i)&&e.match(/insufficient funds/i))return h("insufficient funds","INSUFFICIENT_FUNDS",{transaction:t.params[0],info:{payload:t,error:n}})}if("eth_call"===r||"eth_estimateGas"===r){const e=Ti(n),s=wn.getBuiltinCallException("eth_call"===r?"call":"estimateGas",t.params[0],e?e.data:null);return s.info={error:n,payload:t},s}const s=JSON.stringify(function(t){const e=[];return xi(t,e),e}(n));if("string"==typeof n.message&&n.message.match(/user denied|ethers-user-denied/i))return h("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[r]||"unknown",reason:"rejected",info:{payload:t,error:n}});if("eth_sendRawTransaction"===r||"eth_sendTransaction"===r){const e=t.params[0];if(s.match(/insufficient funds|base fee exceeds gas limit/i))return h("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:e,info:{error:n}});if(s.match(/nonce/i)&&s.match(/too low/i))return h("nonce has already been used","NONCE_EXPIRED",{transaction:e,info:{error:n}});if(s.match(/replacement transaction/i)&&s.match(/underpriced/i))return h("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:e,info:{error:n}});if(s.match(/only replay-protected/i))return h("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:r,info:{transaction:e,info:{error:n}}})}let i=!!s.match(/the method .* does not exist/i);return i||n&&n.details&&n.details.startsWith("Unauthorized method:")&&(i=!0),i?h("unsupported operation","UNSUPPORTED_OPERATION",{operation:t.method,info:{error:n,payload:t}}):h("could not coalesce error","UNKNOWN_ERROR",{error:n,payload:t})}send(t,e){if(this.destroyed)return Promise.reject(h("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t}));const r=this.#ue++,n=new Promise(((n,s)=>{this.#he.push({resolve:n,reject:s,payload:{method:t,params:e,id:r,jsonrpc:"2.0"}})}));return this.#ge(),n}async getSigner(t){null==t&&(t=0);const e=this.send("eth_accounts",[]);if("number"==typeof t){const r=await e;if(t>=r.length)throw new Error("no such account");return new ki(this,r[t])}const{accounts:r}=await a({network:this.getNetwork(),accounts:e});t=oe(t);for(const n of r)if(oe(n)===t)return new ki(this,t);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map((t=>new ki(this,t)))}destroy(){this.#de&&(clearTimeout(this.#de),this.#de=null);for(const{payload:t,reject:e}of this.#he)e(h("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t.method}));this.#he=[],super.destroy()}}class Ei extends Pi{#me;constructor(t,e){super(t,e),this.#me=4e3}_getSubscriber(t){const e=super._getSubscriber(t);return wi(e)&&(e.pollingInterval=this.#me),e}get pollingInterval(){return this.#me}set pollingInterval(t){if(!Number.isInteger(t)||t<0)throw new Error("invalid interval");this.#me=t,this._forEachSubscriber((t=>{wi(t)&&(t.pollingInterval=this.#me)}))}}class Ni extends Ei{#ye;constructor(t,e,r){null==t&&(t="http://localhost:8545"),super(e,r),this.#ye="string"==typeof t?new at(t):t.clone()}_getConnection(){return this.#ye.clone()}async send(t,e){return await this._start(),await super.send(t,e)}async _send(t){const e=this._getConnection();e.body=JSON.stringify(t),e.setHeader("content-type","application/json");const r=await e.send();r.assertOk();let n=r.bodyJson;return Array.isArray(n)||(n=[n]),n}}function Ti(t){if(null==t)return null;if("string"==typeof t.message&&t.message.match(/revert/i)&&v(t.data))return{message:t.message,data:t.data};if("object"==typeof t){for(const e in t){const r=Ti(t[e]);if(r)return r}return null}if("string"==typeof t)try{return Ti(JSON.parse(t))}catch(e){}return null}function xi(t,e){if(null!=t){if("string"==typeof t.message&&e.push(t.message),"object"==typeof t)for(const r in t)xi(t[r],e);if("string"==typeof t)try{return xi(JSON.parse(t),e)}catch(r){}}}const Ri="9f7d929b018cdffb338517efa06f58359e86ff1ffd350bc889738523659e7972";class Oi extends Ni{apiKey;constructor(t,e){null==t&&(t="mainnet");const r=Cs.from(t);null==e&&(e=Ri);const n={polling:!0,staticNetwork:r};super(Oi.getRequest(r,e),r,n),o(this,{apiKey:e})}_getProvider(t){try{return new Oi(t,this.apiKey)}catch(e){}return super._getProvider(t)}static getRequest(t,e){null==e&&(e=Ri);const r=new at(`https://${function(t){switch(t){case"mainnet":return"rpc.ankr.com/eth";case"goerli":return"rpc.ankr.com/eth_goerli";case"sepolia":return"rpc.ankr.com/eth_sepolia";case"arbitrum":return"rpc.ankr.com/arbitrum";case"base":return"rpc.ankr.com/base";case"base-goerli":return"rpc.ankr.com/base_goerli";case"base-sepolia":return"rpc.ankr.com/base_sepolia";case"bnb":return"rpc.ankr.com/bsc";case"bnbt":return"rpc.ankr.com/bsc_testnet_chapel";case"matic":return"rpc.ankr.com/polygon";case"matic-mumbai":return"rpc.ankr.com/polygon_mumbai";case"optimism":return"rpc.ankr.com/optimism";case"optimism-goerli":return"rpc.ankr.com/optimism_testnet";case"optimism-sepolia":return"rpc.ankr.com/optimism_sepolia"}f(!1,"unsupported network","network",t)}(t.name)}/${e}`);return r.allowGzip=!0,e===Ri&&(r.retryFunc=async(t,e,r)=>(hi("AnkrProvider"),!0)),r}getRpcError(t,e){return"eth_sendRawTransaction"===t.method&&e&&e.error&&"INTERNAL_ERROR: could not replace existing tx"===e.error.message&&(e.error.message="replacement transaction underpriced"),super.getRpcError(t,e)}isCommunityResource(){return this.apiKey===Ri}}const _i="_gg7wSSi0KMBsdKnGVfHDueq6xMB9EkC";class Ii extends Ni{apiKey;constructor(t,e){null==t&&(t="mainnet");const r=Cs.from(t);null==e&&(e=_i),super(Ii.getRequest(r,e),r,{staticNetwork:r}),o(this,{apiKey:e})}_getProvider(t){try{return new Ii(t,this.apiKey)}catch(e){}return super._getProvider(t)}async _perform(t){if("getTransactionResult"===t.method){const{trace:r,tx:n}=await a({trace:this.send("trace_transaction",[t.hash]),tx:this.getTransaction(t.hash)});if(null==r||null==n)return null;let s,i=!1;try{s=r[0].result.output,i="Reverted"===r[0].error}catch(e){}if(s)return d(!i,"an error occurred during transaction executions","CALL_EXCEPTION",{action:"getTransactionResult",data:s,reason:null,transaction:n,invocation:null,revert:null}),s;d(!1,"could not parse trace result","BAD_DATA",{value:r})}return await super._perform(t)}isCommunityResource(){return this.apiKey===_i}static getRequest(t,e){null==e&&(e=_i);const r=new at(`https://${function(t){switch(t){case"mainnet":return"eth-mainnet.alchemyapi.io";case"goerli":return"eth-goerli.g.alchemy.com";case"sepolia":return"eth-sepolia.g.alchemy.com";case"arbitrum":return"arb-mainnet.g.alchemy.com";case"arbitrum-goerli":return"arb-goerli.g.alchemy.com";case"arbitrum-sepolia":return"arb-sepolia.g.alchemy.com";case"base":return"base-mainnet.g.alchemy.com";case"base-goerli":return"base-goerli.g.alchemy.com";case"base-sepolia":return"base-sepolia.g.alchemy.com";case"matic":return"polygon-mainnet.g.alchemy.com";case"matic-mumbai":return"polygon-mumbai.g.alchemy.com";case"optimism":return"opt-mainnet.g.alchemy.com";case"optimism-goerli":return"opt-goerli.g.alchemy.com";case"optimism-sepolia":return"opt-sepolia.g.alchemy.com"}f(!1,"unsupported network","network",t)}(t.name)}/v2/${e}`);return r.allowGzip=!0,e===_i&&(r.retryFunc=async(t,e,r)=>(hi("alchemy"),!0)),r}}class Ai extends Ni{constructor(t){null==t&&(t="mainnet");const e=Cs.from(t);f("mainnet"===e.name,"unsupported network","network",t),super("https://cloudflare-eth.com/",e,{staticNetwork:e})}}const Si=["enableCcipRead"];let Fi=1;class Ci extends Ys{network;apiKey;#be;constructor(t,e){const r=null!=e?e:null;super();const n=Cs.from(t);this.#be=n.getPlugin("org.ethers.plugins.provider.Etherscan"),o(this,{apiKey:r,network:n}),this.getBaseUrl()}getBaseUrl(){if(this.#be)return this.#be.baseUrl;switch(this.network.name){case"mainnet":return"https://api.etherscan.io";case"goerli":return"https://api-goerli.etherscan.io";case"sepolia":return"https://api-sepolia.etherscan.io";case"holesky":return"https://api-holesky.etherscan.io";case"arbitrum":return"https://api.arbiscan.io";case"arbitrum-goerli":return"https://api-goerli.arbiscan.io";case"bnb":return"https://api.bscscan.com";case"bnbt":return"https://api-testnet.bscscan.com";case"matic":return"https://api.polygonscan.com";case"matic-mumbai":return"https://api-testnet.polygonscan.com";case"optimism":return"https://api-optimistic.etherscan.io";case"optimism-goerli":return"https://api-goerli-optimistic.etherscan.io"}f(!1,"unsupported network","network",this.network)}getUrl(t,e){const r=Object.keys(e).reduce(((t,r)=>{const n=e[r];return null!=n&&(t+=`&${r}=${n}`),t}),""),n=this.apiKey?`&apikey=${this.apiKey}`:"";return`${this.getBaseUrl()}/api?module=${t}${r}${n}`}getPostUrl(){return`${this.getBaseUrl()}/api`}getPostData(t,e){return e.module=t,e.apikey=this.apiKey,e}async detectNetwork(){return this.network}async fetch(t,e,r){const n=Fi++,s=r?this.getPostUrl():this.getUrl(t,e),i=r?this.getPostData(t,e):null;this.emit("debug",{action:"sendRequest",id:n,url:s,payload:i});const a=new at(s);a.setThrottleParams({slotInterval:1e3}),a.retryFunc=(t,e,r)=>(this.isCommunityResource()&&hi("Etherscan"),Promise.resolve(!0)),a.processFunc=async(e,r)=>{const s=r.hasBody()?JSON.parse(K(r.body)):{},i=("string"==typeof s.result?s.result:"").toLowerCase().indexOf("rate limit")>=0;return"proxy"===t?s&&0==s.status&&"NOTOK"==s.message&&i&&(this.emit("debug",{action:"receiveError",id:n,reason:"proxy-NOTOK",error:s}),r.throwThrottleError(s.result,2e3)):i&&(this.emit("debug",{action:"receiveError",id:n,reason:"null result",error:s.result}),r.throwThrottleError(s.result,2e3)),r},i&&(a.setHeader("content-type","application/x-www-form-urlencoded; charset=UTF-8"),a.body=Object.keys(i).map((t=>`${t}=${i[t]}`)).join("&"));const o=await a.send();try{o.assertOk()}catch(l){this.emit("debug",{action:"receiveError",id:n,error:l,reason:"assertOk"}),d(!1,"response error","SERVER_ERROR",{request:a,response:o})}o.hasBody()||(this.emit("debug",{action:"receiveError",id:n,error:"missing body",reason:"null body"}),d(!1,"missing response","SERVER_ERROR",{request:a,response:o}));const c=JSON.parse(K(o.body));return"proxy"===t?("2.0"!=c.jsonrpc&&(this.emit("debug",{action:"receiveError",id:n,result:c,reason:"invalid JSON-RPC"}),d(!1,"invalid JSON-RPC response (missing jsonrpc='2.0')","SERVER_ERROR",{request:a,response:o,info:{result:c}})),c.error&&(this.emit("debug",{action:"receiveError",id:n,result:c,reason:"JSON-RPC error"}),d(!1,"error response","SERVER_ERROR",{request:a,response:o,info:{result:c}})),this.emit("debug",{action:"receiveRequest",id:n,result:c}),c.result):0!=c.status||"No records found"!==c.message&&"No transactions found"!==c.message?((1!=c.status||"string"==typeof c.message&&!c.message.match(/^OK/))&&(this.emit("debug",{action:"receiveError",id:n,result:c}),d(!1,"error response","SERVER_ERROR",{request:a,response:o,info:{result:c}})),this.emit("debug",{action:"receiveRequest",id:n,result:c}),c.result):(this.emit("debug",{action:"receiveRequest",id:n,result:c}),c.result)}_getTransactionPostData(t){const e={};for(let r in t){if(Si.indexOf(r)>=0)continue;if(null==t[r])continue;let n=t[r];"type"===r&&0===n||"blockTag"===r&&"latest"===n||(n={type:!0,gasLimit:!0,gasPrice:!0,maxFeePerGs:!0,maxPriorityFeePerGas:!0,nonce:!0,value:!0}[r]?j(n):"accessList"===r?"["+$e(n).map((t=>`{address:"${t.address}",storageKeys:["${t.storageKeys.join('","')}"]}`)).join(",")+"]":P(n),e[r]=n)}return e}_checkError(t,e,r){let n="";if(l(e,"SERVER_ERROR")){try{n=e.info.result.error.message}catch(s){}if(!n)try{n=e.info.message}catch(s){}}if("estimateGas"===t.method&&!n.match(/revert/i)&&n.match(/insufficient funds/i)&&d(!1,"insufficient funds","INSUFFICIENT_FUNDS",{transaction:t.transaction}),("call"===t.method||"estimateGas"===t.method)&&n.match(/execution reverted/i)){let r="";try{r=e.info.result.error.data}catch(e){}const n=wn.getBuiltinCallException(t.method,t.transaction,r);throw n.info={request:t,error:e},n}if(n&&"broadcastTransaction"===t.method){const e=ar.from(t.signedTransaction);n.match(/replacement/i)&&n.match(/underpriced/i)&&d(!1,"replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:e}),n.match(/insufficient funds/)&&d(!1,"insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:e}),n.match(/same hash was already imported|transaction nonce is too low|nonce too low/)&&d(!1,"nonce has already been used","NONCE_EXPIRED",{transaction:e})}throw e}async _detectNetwork(){return this.network}async _perform(t){switch(t.method){case"chainId":return this.network.chainId;case"getBlockNumber":return this.fetch("proxy",{action:"eth_blockNumber"});case"getGasPrice":return this.fetch("proxy",{action:"eth_gasPrice"});case"getPriorityFee":if("mainnet"===this.network.name)return"1000000000";if("optimism"===this.network.name)return"1000000";throw new Error("fallback onto the AbstractProvider default");case"getBalance":return this.fetch("account",{action:"balance",address:t.address,tag:t.blockTag});case"getTransactionCount":return this.fetch("proxy",{action:"eth_getTransactionCount",address:t.address,tag:t.blockTag});case"getCode":return this.fetch("proxy",{action:"eth_getCode",address:t.address,tag:t.blockTag});case"getStorage":return this.fetch("proxy",{action:"eth_getStorageAt",address:t.address,position:t.position,tag:t.blockTag});case"broadcastTransaction":return this.fetch("proxy",{action:"eth_sendRawTransaction",hex:t.signedTransaction},!0).catch((e=>this._checkError(t,e,t.signedTransaction)));case"getBlock":if("blockTag"in t)return this.fetch("proxy",{action:"eth_getBlockByNumber",tag:t.blockTag,boolean:t.includeTransactions?"true":"false"});d(!1,"getBlock by blockHash not supported by Etherscan","UNSUPPORTED_OPERATION",{operation:"getBlock(blockHash)"});case"getTransaction":return this.fetch("proxy",{action:"eth_getTransactionByHash",txhash:t.hash});case"getTransactionReceipt":return this.fetch("proxy",{action:"eth_getTransactionReceipt",txhash:t.hash});case"call":{if("latest"!==t.blockTag)throw new Error("EtherscanProvider does not support blockTag for call");const r=this._getTransactionPostData(t.transaction);r.module="proxy",r.action="eth_call";try{return await this.fetch("proxy",r,!0)}catch(e){return this._checkError(t,e,t.transaction)}}case"estimateGas":{const r=this._getTransactionPostData(t.transaction);r.module="proxy",r.action="eth_estimateGas";try{return await this.fetch("proxy",r,!0)}catch(e){return this._checkError(t,e,t.transaction)}}}return super._perform(t)}async getNetwork(){return this.network}async getEtherPrice(){return"mainnet"!==this.network.name?0:parseFloat((await this.fetch("stats",{action:"ethprice"})).ethusd)}async getContract(t){let e=this._getAddress(t);var r;(r=e)&&"function"==typeof r.then&&(e=await e);try{const t=await this.fetch("contract",{action:"getabi",address:e}),r=JSON.parse(t);return new ds(e,r,this)}catch(n){return null}}isCommunityResource(){return null==this.apiKey}}const Ui=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}().WebSocket;class Bi{#Ft;#Tt;get filter(){return JSON.parse(this.#Tt)}#we;#ve;#ke;constructor(t,e){this.#Ft=t,this.#Tt=JSON.stringify(e),this.#we=null,this.#ve=null,this.#ke=null}start(){this.#we=this.#Ft.send("eth_subscribe",this.filter).then((t=>(this.#Ft._register(t,this),t)))}stop(){this.#we.then((t=>{this.#Ft.send("eth_unsubscribe",[t])})),this.#we=null}pause(t){d(t,"preserve logs while paused not supported by SocketSubscriber yet","UNSUPPORTED_OPERATION",{operation:"pause(false)"}),this.#ve=!!t}resume(){this.#ve=null}_handleMessage(t){if(null!=this.#we&&null===this.#ve){let e=this.#ke;e=null==e?this._emit(this.#Ft,t):e.then((async()=>{await this._emit(this.#Ft,t)})),this.#ke=e.then((()=>{this.#ke===e&&(this.#ke=null)}))}}async _emit(t,e){throw new Error("sub-classes must implemente this; _emit")}}class Li extends Bi{constructor(t){super(t,["newHeads"])}async _emit(t,e){t.emit("block",parseInt(e.number))}}class Gi extends Bi{constructor(t){super(t,["newPendingTransactions"])}async _emit(t,e){t.emit("pending",e)}}class Di extends Bi{#Pe;get logFilter(){return JSON.parse(this.#Pe)}constructor(t,e){super(t,["logs",e]),this.#Pe=JSON.stringify(e)}async _emit(t,e){t.emit(this.logFilter,t._wrapLog(e,t._network))}}class $i extends Pi{#Ee;#Mt;#Ne;constructor(t,e){const r=Object.assign({},null!=e?e:{});f(null==r.batchMaxCount||1===r.batchMaxCount,"sockets-based providers do not support batches","options.batchMaxCount",e),r.batchMaxCount=1,null==r.staticNetwork&&(r.staticNetwork=!0),super(t,r),this.#Ee=new Map,this.#Mt=new Map,this.#Ne=new Map}_getSubscriber(t){switch(t.type){case"close":return new Ks("close");case"block":return new Li(this);case"pending":return new Gi(this);case"event":return new Di(this,t.filter);case"orphan":if("drop-log"===t.filter.orphan)return new Ks("drop-log")}return super._getSubscriber(t)}_register(t,e){this.#Mt.set(t,e);const r=this.#Ne.get(t);if(r){for(const t of r)e._handleMessage(t);this.#Ne.delete(t)}}async _send(t){f(!Array.isArray(t),"WebSocket does not support batch send","payload",t);const e=new Promise(((e,r)=>{this.#Ee.set(t.id,{payload:t,resolve:e,reject:r})}));return await this._waitUntilReady(),await this._write(JSON.stringify(t)),[await e]}async _processMessage(t){const e=JSON.parse(t);if(e&&"object"==typeof e&&"id"in e){const t=this.#Ee.get(e.id);if(null==t)return void this.emit("error",h("received result for unknown id","UNKNOWN_ERROR",{reasonCode:"UNKNOWN_ID",result:e}));this.#Ee.delete(e.id),t.resolve(e)}else{if(!e||"eth_subscription"!==e.method)return void this.emit("error",h("received unexpected message","UNKNOWN_ERROR",{reasonCode:"UNEXPECTED_MESSAGE",result:e}));{const t=e.params.subscription,r=this.#Mt.get(t);if(r)r._handleMessage(e.params.result);else{let r=this.#Ne.get(t);null==r&&(r=[],this.#Ne.set(t,r)),r.push(e.params.result)}}}}async _write(t){throw new Error("sub-classes must override this")}}class ji extends $i{#ye;#Te;get websocket(){if(null==this.#Te)throw new Error("websocket closed");return this.#Te}constructor(t,e,r){super(e,r),"string"==typeof t?(this.#ye=()=>new Ui(t),this.#Te=this.#ye()):"function"==typeof t?(this.#ye=t,this.#Te=t()):(this.#ye=null,this.#Te=t),this.websocket.onopen=async()=>{try{await this._start(),this.resume()}catch(t){console.log("failed to start WebsocketProvider",t)}},this.websocket.onmessage=t=>{this._processMessage(t.data)}}async _write(t){this.websocket.send(t)}async destroy(){null!=this.#Te&&(this.#Te.close(),this.#Te=null),super.destroy()}}const Mi="84842078b09946638c03157f83405213";class Vi extends ji{projectId;projectSecret;constructor(t,e){const r=new Hi(t,e),n=r._getConnection();d(!n.credentials,"INFURA WebSocket project secrets unsupported","UNSUPPORTED_OPERATION",{operation:"InfuraProvider.getWebSocketProvider()"}),super(n.url.replace(/^http/i,"ws").replace("/v3/","/ws/v3/"),t),o(this,{projectId:r.projectId,projectSecret:r.projectSecret})}isCommunityResource(){return this.projectId===Mi}}class Hi extends Ni{projectId;projectSecret;constructor(t,e,r){null==t&&(t="mainnet");const n=Cs.from(t);null==e&&(e=Mi),null==r&&(r=null),super(Hi.getRequest(n,e,r),n,{staticNetwork:n}),o(this,{projectId:e,projectSecret:r})}_getProvider(t){try{return new Hi(t,this.projectId,this.projectSecret)}catch(e){}return super._getProvider(t)}isCommunityResource(){return this.projectId===Mi}static getWebSocketProvider(t,e){return new Vi(t,e)}static getRequest(t,e,r){null==e&&(e=Mi),null==r&&(r=null);const n=new at(`https://${function(t){switch(t){case"mainnet":return"mainnet.infura.io";case"goerli":return"goerli.infura.io";case"sepolia":return"sepolia.infura.io";case"arbitrum":return"arbitrum-mainnet.infura.io";case"arbitrum-goerli":return"arbitrum-goerli.infura.io";case"arbitrum-sepolia":return"arbitrum-sepolia.infura.io";case"base":return"base-mainnet.infura.io";case"base-goerlia":return"base-goerli.infura.io";case"base-sepolia":return"base-sepolia.infura.io";case"bnb":return"bnbsmartchain-mainnet.infura.io";case"bnbt":return"bnbsmartchain-testnet.infura.io";case"linea":return"linea-mainnet.infura.io";case"linea-goerli":return"linea-goerli.infura.io";case"matic":return"polygon-mainnet.infura.io";case"matic-mumbai":return"polygon-mumbai.infura.io";case"optimism":return"optimism-mainnet.infura.io";case"optimism-goerli":return"optimism-goerli.infura.io";case"optimism-sepolia":return"optimism-sepolia.infura.io"}f(!1,"unsupported network","network",t)}(t.name)}/v3/${e}`);return n.allowGzip=!0,r&&n.setCredentials("",r),e===Mi&&(n.retryFunc=async(t,e,r)=>(hi("InfuraProvider"),!0)),n}}const qi="919b412a057b5e9c9b6dce193c5a60242d6efadb";class Ji extends Ni{token;constructor(t,e){null==t&&(t="mainnet");const r=Cs.from(t);null==e&&(e=qi),super(Ji.getRequest(r,e),r,{staticNetwork:r}),o(this,{token:e})}_getProvider(t){try{return new Ji(t,this.token)}catch(e){}return super._getProvider(t)}isCommunityResource(){return this.token===qi}static getRequest(t,e){null==e&&(e=qi);const r=new at(`https://${function(t){switch(t){case"mainnet":return"ethers.quiknode.pro";case"goerli":return"ethers.ethereum-goerli.quiknode.pro";case"sepolia":return"ethers.ethereum-sepolia.quiknode.pro";case"holesky":return"ethers.ethereum-holesky.quiknode.pro";case"arbitrum":return"ethers.arbitrum-mainnet.quiknode.pro";case"arbitrum-goerli":return"ethers.arbitrum-goerli.quiknode.pro";case"arbitrum-sepolia":return"ethers.arbitrum-sepolia.quiknode.pro";case"base":return"ethers.base-mainnet.quiknode.pro";case"base-goerli":return"ethers.base-goerli.quiknode.pro";case"base-spolia":return"ethers.base-sepolia.quiknode.pro";case"bnb":return"ethers.bsc.quiknode.pro";case"bnbt":return"ethers.bsc-testnet.quiknode.pro";case"matic":return"ethers.matic.quiknode.pro";case"matic-mumbai":return"ethers.matic-testnet.quiknode.pro";case"optimism":return"ethers.optimism.quiknode.pro";case"optimism-goerli":return"ethers.optimism-goerli.quiknode.pro";case"optimism-sepolia":return"ethers.optimism-sepolia.quiknode.pro";case"xdai":return"ethers.xdai.quiknode.pro"}f(!1,"unsupported network","network",t)}(t.name)}/${e}`);return r.allowGzip=!0,e===qi&&(r.retryFunc=async(t,e,r)=>(hi("QuickNodeProvider"),!0)),r}}const zi=BigInt("1"),Ki=BigInt("2");function Wi(){return(new Date).getTime()}function Xi(t){return JSON.stringify(t,((t,e)=>"bigint"==typeof e?{type:"bigint",value:e.toString()}:e))}const Zi={stallTimeout:400,priority:1,weight:1},Qi={blockNumber:-2,requests:0,lateResponses:0,errorResponses:0,outOfSync:-1,unsupportedEvents:0,rollingDuration:0,score:0,_network:null,_updateNumber:null,_totalTime:0,_lastFatalError:null,_lastFatalErrorTimestamp:0};function Yi(t){if(null==t)return"null";if(Array.isArray(t))return"["+t.map(Yi).join(",")+"]";if("object"==typeof t&&"function"==typeof t.toJSON)return Yi(t.toJSON());switch(typeof t){case"boolean":case"symbol":return t.toString();case"bigint":case"number":return BigInt(t).toString();case"string":return JSON.stringify(t);case"object":{const e=Object.keys(t);return e.sort(),"{"+e.map((e=>`${JSON.stringify(e)}:${Yi(t[e])}`)).join(",")+"}"}}throw console.log("Could not serialize",t),new Error("Hmm...")}function ta(t){if("error"in t){const e=t.error;return{tag:Yi(e),value:e}}const e=t.result;return{tag:Yi(e),value:e}}function ea(t,e){const r=new Map;for(const{value:s,tag:i,weight:a}of e){const t=r.get(i)||{value:s,weight:0};t.weight+=a,r.set(i,t)}let n=null;for(const s of r.values())s.weight>=t&&(!n||s.weight>n.weight)&&(n=s);if(n)return n.value}function ra(t,e){let r=0;const n=new Map;let s=null;const i=[];for(const{value:o,tag:c,weight:l}of e)if(o instanceof Error){const t=n.get(c)||{value:o,weight:0};t.weight+=l,n.set(c,t),(null==s||t.weight>s.weight)&&(s=t)}else i.push(BigInt(o)),r+=l;if(r<t)return s&&s.weight>=t?s.value:void 0;i.sort(((t,e)=>t<e?-1:e>t?1:0));const a=Math.floor(i.length/2);return i.length%2?i[a]:(i[a-1]+i[a]+zi)/Ki}function na(t,e){const r=ea(t,e);if(void 0!==r)return r;for(const n of e)if(n.value)return n.value}class sa extends Ys{quorum;eventQuorum;eventWorkers;#xe;#Re;#Oe;constructor(t,e,r){super(e,r),this.#xe=t.map((t=>t instanceof Ys?Object.assign({provider:t},Zi,Qi):Object.assign({},Zi,t,Qi))),this.#Re=-2,this.#Oe=null,r&&null!=r.quorum?this.quorum=r.quorum:this.quorum=Math.ceil(this.#xe.reduce(((t,e)=>t+=e.weight),0)/2),this.eventQuorum=1,this.eventWorkers=1,f(this.quorum<=this.#xe.reduce(((t,e)=>t+e.weight),0),"quorum exceed provider wieght","quorum",this.quorum)}get providerConfigs(){return this.#xe.map((t=>{const e=Object.assign({},t);for(const r in e)"_"===r[0]&&delete e[r];return e}))}async _detectNetwork(){return Cs.from(C(await this._perform({method:"chainId"})))}async _translatePerform(t,e){switch(e.method){case"broadcastTransaction":return await t.broadcastTransaction(e.signedTransaction);case"call":return await t.call(Object.assign({},e.transaction,{blockTag:e.blockTag}));case"chainId":return(await t.getNetwork()).chainId;case"estimateGas":return await t.estimateGas(e.transaction);case"getBalance":return await t.getBalance(e.address,e.blockTag);case"getBlock":{const r="blockHash"in e?e.blockHash:e.blockTag;return await t.getBlock(r,e.includeTransactions)}case"getBlockNumber":return await t.getBlockNumber();case"getCode":return await t.getCode(e.address,e.blockTag);case"getGasPrice":return(await t.getFeeData()).gasPrice;case"getPriorityFee":return(await t.getFeeData()).maxPriorityFeePerGas;case"getLogs":return await t.getLogs(e.filter);case"getStorage":return await t.getStorage(e.address,e.position,e.blockTag);case"getTransaction":return await t.getTransaction(e.hash);case"getTransactionCount":return await t.getTransactionCount(e.address,e.blockTag);case"getTransactionReceipt":return await t.getTransactionReceipt(e.hash);case"getTransactionResult":return await t.getTransactionResult(e.hash)}}#_e(t){const e=Array.from(t).map((t=>t.config)),r=this.#xe.slice();!function(t){for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}}(r),r.sort(((t,e)=>t.priority-e.priority));for(const n of r)if(!n._lastFatalError&&-1===e.indexOf(n))return n;return null}#Ie(t,e){const r=this.#_e(t);if(null==r)return null;const n={config:r,result:null,didBump:!1,perform:null,staller:null},s=Wi();return n.perform=(async()=>{try{r.requests++;const t=await this._translatePerform(r.provider,e);n.result={result:t}}catch(i){r.errorResponses++,n.result={error:i}}const t=Wi()-s;r._totalTime+=t,r.rollingDuration=.95*r.rollingDuration+.05*t,n.perform=null})(),n.staller=(async()=>{var t;await(t=r.stallTimeout,new Promise((e=>{setTimeout(e,t)}))),n.staller=null})(),t.add(n),n}async#Ae(){let t=this.#Oe;if(!t){const e=[];this.#xe.forEach((t=>{e.push((async()=>{await async function(t,e){for(;(t.blockNumber<0||t.blockNumber<e)&&(t._updateNumber||(t._updateNumber=(async()=>{try{const e=await t.provider.getBlockNumber();e>t.blockNumber&&(t.blockNumber=e)}catch(e){t.blockNumber=-2,t._lastFatalError=e,t._lastFatalErrorTimestamp=Wi()}t._updateNumber=null})()),await t._updateNumber,t.outOfSync++,!t._lastFatalError););}(t,0),t._lastFatalError||(t._network=await t.provider.getNetwork())})())})),this.#Oe=t=(async()=>{await Promise.all(e);let t=null;for(const e of this.#xe){if(e._lastFatalError)continue;const r=e._network;null==t?t=r.chainId:r.chainId!==t&&d(!1,"cannot mix providers on different networks","UNSUPPORTED_OPERATION",{operation:"new FallbackProvider"})}})()}await t}async#Se(t,e){const r=[];for(const n of t)if(null!=n.result){const{tag:t,value:e}=ta(n.result);r.push({tag:t,value:e,weight:n.config.weight})}if(!(r.reduce(((t,e)=>t+e.weight),0)<this.quorum)){switch(e.method){case"getBlockNumber":{-2===this.#Re&&(this.#Re=Math.ceil(G(ra(this.quorum,this.#xe.filter((t=>!t._lastFatalError)).map((t=>({value:t.blockNumber,tag:G(t.blockNumber).toString(),weight:t.weight})))))));const t=function(t,e){if(1===t)return G(ra(t,e),"%internal");const r=new Map,n=(t,e)=>{const n=r.get(t)||{result:t,weight:0};n.weight+=e,r.set(t,n)};for(const{weight:a,value:o}of e){const t=G(o);n(t-1,a),n(t,a),n(t+1,a)}let s,i=0;for(const{weight:a,result:o}of r.values())a>=t&&(a>i||null!=s&&a===i&&o>s)&&(i=a,s=o);return s}(this.quorum,r);if(void 0===t)return;return t>this.#Re&&(this.#Re=t),this.#Re}case"getGasPrice":case"getPriorityFee":case"estimateGas":return ra(this.quorum,r);case"getBlock":return"blockTag"in e&&"pending"===e.blockTag?na(this.quorum,r):ea(this.quorum,r);case"call":case"chainId":case"getBalance":case"getTransactionCount":case"getCode":case"getStorage":case"getTransaction":case"getTransactionReceipt":case"getLogs":return ea(this.quorum,r);case"broadcastTransaction":return na(this.quorum,r)}d(!1,"unsupported method","UNSUPPORTED_OPERATION",{operation:`_perform(${Xi(e.method)})`})}}async#Fe(t,e){if(0===t.size)throw new Error("no runners?!");const r=[];let n=0;for(const i of t)i.perform&&r.push(i.perform),i.staller?r.push(i.staller):i.didBump||(i.didBump=!0,n++);const s=await this.#Se(t,e);if(void 0!==s){if(s instanceof Error)throw s;return s}for(let i=0;i<n;i++)this.#Ie(t,e);return d(r.length>0,"quorum not met","SERVER_ERROR",{request:"%sub-requests",info:{request:e,results:Array.from(t).map((t=>Xi(t.result)))}}),await Promise.race(r),await this.#Fe(t,e)}async _perform(t){if("broadcastTransaction"===t.method){const e=this.#xe.map((t=>null)),r=this.#xe.map((async({provider:r,weight:n},s)=>{try{const i=await r._perform(t);e[s]=Object.assign(ta({result:i}),{weight:n})}catch(i){e[s]=Object.assign(ta({error:i}),{weight:n})}}));for(;;){const t=e.filter((t=>null!=t));for(const{value:e}of t)if(!(e instanceof Error))return e;const n=ea(this.quorum,e.filter((t=>null!=t)));if(l(n,"INSUFFICIENT_FUNDS"))throw n;const s=r.filter(((t,r)=>null==e[r]));if(0===s.length)break;await Promise.race(s)}const n=na(this.quorum,e);if(d(void 0!==n,"problem multi-broadcasting","SERVER_ERROR",{request:"%sub-requests",info:{request:t,results:e.map(Xi)}}),n instanceof Error)throw n;return n}await this.#Ae();const e=new Set;let r=0;for(;;){const n=this.#Ie(e,t);if(null==n)break;if(r+=n.config.weight,r>=this.quorum)break}const n=await this.#Fe(e,t);for(const s of e)s.perform&&null==s.result&&s.config.lateResponses++;return n}async destroy(){for(const{provider:t}of this.#xe)t.destroy();super.destroy()}}const ia="goerli kovan sepolia classicKotti optimism-goerli arbitrum-goerli matic-mumbai bnbt".split(" ");t("B",class extends Ei{#k;constructor(t,e){f(t&&t.request,"invalid EIP-1193 provider","ethereum",t),super(e,{batchMaxCount:1}),this.#k=async(e,r)=>{const n={method:e,params:r};this.emit("debug",{action:"sendEip1193Request",payload:n});try{const e=await t.request(n);return this.emit("debug",{action:"receiveEip1193Result",result:e}),e}catch(s){const t=new Error(s.message);throw t.code=s.code,t.data=s.data,t.payload=n,this.emit("debug",{action:"receiveEip1193Error",error:t}),t}}}async send(t,e){return await this._start(),await super.send(t,e)}async _send(t){f(!Array.isArray(t),"EIP-1193 does not support batch request","payload",t);try{const e=await this.#k(t.method,t.params||[]);return[{id:t.id,result:e}]}catch(e){return[{id:t.id,error:{code:e.code,data:e.data,message:e.message}}]}}getRpcError(t,e){switch((e=JSON.parse(JSON.stringify(e))).error.code||-1){case 4001:e.error.message=`ethers-user-denied: ${e.error.message}`;break;case 4200:e.error.message=`ethers-unsupported: ${e.error.message}`}return super.getRpcError(t,e)}async hasSigner(t){null==t&&(t=0);const e=await this.send("eth_accounts",[]);return"number"==typeof t?e.length>t:(t=t.toLowerCase(),0!==e.filter((e=>e.toLowerCase()===t)).length)}async getSigner(t){if(null==t&&(t=0),!(await this.hasSigner(t)))try{await this.#k("eth_requestAccounts",[])}catch(e){const t=e.payload;throw this.getRpcError(t,{id:t.id,error:e})}return await super.getSigner(t)}})}}}));
