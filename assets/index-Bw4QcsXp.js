import{i as te}from"./index-p1XoTQj1.js";import{b4 as D,o as E,c as F,w as o,b as t,u as r,e as w,cM as ae,aF as M,aH as S,aG as K,c8 as j,aB as R,aK as W,r as _,fo as H,E as v,a as J,O as T,a7 as Q,aD as X,l as A,bD as Y,at as Z,F as G,m as oe,t as ne,d as q,bd as re,aV as B,k as se,aS as ie,ax as de,j as ue,g as me,au as pe,ce,b5 as ge,as as fe,V as _e}from"./index-BF2fBoPb.js";import{i as be}from"./index-Cjr4ibGp.js";import{i as ve}from"./index-BOtwo2Hq.js";import{i as Ve}from"./index-B-b3I1wI.js";import{E as xe}from"./tree-B2uMWqdF.js";import{i as ye}from"./index-DG03PXF-.js";import"./index-CcYpqHDV.js";import"./index-BnIMXyIx.js";import"./virtual-list-B6G0p9cv.js";import"./index-BWYZqqjh.js";import"./index-DuliLu7F.js";import{E as P,a as L}from"./col-DirwGu8S.js";import{_ as ze}from"./role-select-B3bSY8Gf.js";import{E as Ie}from"./tree-select-u-xVs2-A.js";import{l as ee,u as ke,a as we,r as he}from"./index-o56SkzsS.js";import{c as Ue,u as Ne,a as Ee,p as Ce,r as $e,b as Fe,d as Oe}from"./index-AC-OHBhs.js";import{e as Re,p as Se}from"./validate-B_6HX0Io.js";import{E as Te}from"./input-number-DNV7vLKM.js";import"./isArrayLikeObject-j402kJv_.js";import"./vuedraggable.umd-DLnsjw3h.js";import"./index-E9Z4TjLA.js";import"./index-DOwINDGR.js";const qe={__name:"org-user-search",emits:["search"],setup(z,{expose:h,emit:x}){const f=x,[d,u]=D({username:"",nickname:"",sex:void 0}),p=()=>{f("search",{...d})},n=()=>{u(),p()};return h({resetFields:u}),(N,c)=>{const I=S,y=K,V=P,m=j,e=R,l=L,a=W;return E(),F(a,{"label-width":"72px",onKeyup:ae(p,["enter"]),onSubmit:c[3]||(c[3]=M(()=>{},["prevent"]))},{default:o(()=>[t(l,{gutter:8},{default:o(()=>[t(V,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[t(y,{label:"用户账号"},{default:o(()=>[t(I,{clearable:"",modelValue:r(d).username,"onUpdate:modelValue":c[0]||(c[0]=s=>r(d).username=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(V,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[t(y,{label:"用户名"},{default:o(()=>[t(I,{clearable:"",modelValue:r(d).nickname,"onUpdate:modelValue":c[1]||(c[1]=s=>r(d).nickname=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),t(V,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[t(y,{label:"性别"},{default:o(()=>[t(m,{code:"sex",modelValue:r(d).sex,"onUpdate:modelValue":c[2]||(c[2]=s=>r(d).sex=s),placeholder:"请选择"},null,8,["modelValue"])]),_:1})]),_:1}),t(V,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[t(y,{"label-width":"16px"},{default:o(()=>[t(e,{type:"primary",onClick:p},{default:o(()=>c[4]||(c[4]=[w("查询")])),_:1}),t(e,{onClick:n},{default:o(()=>c[5]||(c[5]=[w("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},le={__name:"org-select",props:{modelValue:[Number,String],placeholder:{type:String,default:"请选择所属机构"}},emits:["update:modelValue"],setup(z,{emit:h}){const x=h,f=_([]),d=u=>{x("update:modelValue",u)};return ee().then(u=>{f.value=H({data:u,idField:"organizationId",parentIdField:"parentId"})}).catch(u=>{v.error(u.message)}),(u,p)=>{const n=Ie;return E(),F(n,{clearable:"",filterable:"",data:f.value,"check-strictly":"","default-expand-all":"","node-key":"organizationId",props:{label:"organizationName"},placeholder:z.placeholder,"model-value":z.modelValue,class:"ele-fluid","onUpdate:modelValue":d},null,8,["data","placeholder","model-value"])}}},Be={__name:"org-user-edit",props:{modelValue:Boolean,data:Object,organizationId:Number},emits:["done","update:modelValue"],setup(z,{emit:h}){const x=h,f=z,d=_(!1),u=_(!1),p=_(null),[n,N,c]=D({userId:void 0,organizationId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:""}),I=J({username:[{required:!0,message:"请输入用户账号",type:"string",trigger:"blur"},{min:4,message:"账号长度最少为4位",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(m,e,l)=>{var a;Ue("username",e,(a=f.data)==null?void 0:a.userId).then(()=>{l(new Error("账号已经存在"))}).catch(()=>{l()})}}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"blur"}],roleIds:[{required:!0,message:"请选择角色",type:"array",trigger:"blur"}],email:[{pattern:Re,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(m,e,l)=>{if(d.value||/^[\S]{5,18}$/.test(e))return l();l(new Error("密码必须为5-18位非空白字符"))}}],phone:[{pattern:Se,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),y=()=>{var m,e;(e=(m=p.value)==null?void 0:m.validate)==null||e.call(m,l=>{if(!l)return;u.value=!0,(d.value?Ne:Ee)(n).then(s=>{u.value=!1,v.success(s),V(!1),x("done")}).catch(s=>{u.value=!1,v.error(s.message)})})},V=m=>{x("update:modelValue",m)};return T(()=>f.modelValue,m=>{var e,l;m?f.data?(c({...f.data,password:""}),d.value=!0):(n.organizationId=f.organizationId,d.value=!1):(N(),(l=(e=p.value)==null?void 0:e.clearValidate)==null||l.call(e))}),(m,e)=>{const l=K,a=S,s=j,b=P,U=L,O=W,C=R,$=X;return E(),F($,{form:"",width:640,"model-value":z.modelValue,title:d.value?"修改用户":"新建用户","onUpdate:modelValue":V},{footer:o(()=>[t(C,{onClick:e[10]||(e[10]=g=>V(!1))},{default:o(()=>e[11]||(e[11]=[w("取消")])),_:1}),t(C,{type:"primary",loading:u.value,onClick:y},{default:o(()=>e[12]||(e[12]=[w(" 保存 ")])),_:1},8,["loading"])]),default:o(()=>[t(O,{ref_key:"formRef",ref:p,model:r(n),rules:I,"label-width":"80px",onSubmit:e[9]||(e[9]=M(()=>{},["prevent"]))},{default:o(()=>[t(U,{gutter:16},{default:o(()=>[t(b,{sm:12,xs:24},{default:o(()=>[t(l,{label:"所属机构"},{default:o(()=>[t(le,{modelValue:r(n).organizationId,"onUpdate:modelValue":e[0]||(e[0]=g=>r(n).organizationId=g)},null,8,["modelValue"])]),_:1}),t(l,{label:"用户账号",prop:"username"},{default:o(()=>[t(a,{clearable:"",maxlength:20,modelValue:r(n).username,"onUpdate:modelValue":e[1]||(e[1]=g=>r(n).username=g),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1}),t(l,{label:"用户名",prop:"nickname"},{default:o(()=>[t(a,{clearable:"",maxlength:20,modelValue:r(n).nickname,"onUpdate:modelValue":e[2]||(e[2]=g=>r(n).nickname=g),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(l,{label:"性别",prop:"sex"},{default:o(()=>[t(s,{code:"sex",modelValue:r(n).sex,"onUpdate:modelValue":e[3]||(e[3]=g=>r(n).sex=g),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),t(l,{label:"角色",prop:"roles"},{default:o(()=>[t(ze,{modelValue:r(n).roles,"onUpdate:modelValue":e[4]||(e[4]=g=>r(n).roles=g)},null,8,["modelValue"])]),_:1})]),_:1}),t(b,{sm:12,xs:24},{default:o(()=>[t(l,{label:"手机号",prop:"phone"},{default:o(()=>[t(a,{clearable:"",maxlength:11,modelValue:r(n).phone,"onUpdate:modelValue":e[5]||(e[5]=g=>r(n).phone=g),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),t(l,{label:"邮箱",prop:"email"},{default:o(()=>[t(a,{clearable:"",maxlength:100,modelValue:r(n).email,"onUpdate:modelValue":e[6]||(e[6]=g=>r(n).email=g),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),d.value?Q("",!0):(E(),F(l,{key:0,label:"登录密码",prop:"password"},{default:o(()=>[t(a,{"show-password":"",type:"password",maxlength:20,modelValue:r(n).password,"onUpdate:modelValue":e[7]||(e[7]=g=>r(n).password=g),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),t(l,{label:"个人简介"},{default:o(()=>[t(a,{type:"textarea",rows:3,maxlength:200,modelValue:r(n).introduction,"onUpdate:modelValue":e[8]||(e[8]=g=>r(n).introduction=g),placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}},De={__name:"org-user-list",props:{organizationId:Number},setup(z){const h=z,x=_(null),f=_(null),d=_([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"用户账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"sexName",label:"性别",sortable:"custom",width:90},{columnKey:"roles",label:"角色",minWidth:110,slot:"roles"},{prop:"createTime",label:"创建时间",sortable:"custom",minWidth:110},{prop:"status",label:"状态",width:90,align:"center",sortable:"custom",slot:"status"},{columnKey:"action",label:"操作",width:128,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),u=_([]),p=_(null),n=_(!1),N=({pages:e,where:l,orders:a})=>Ce({...l,...a,...e,organizationId:h.organizationId}),c=e=>{var l,a;(a=(l=f.value)==null?void 0:l.reload)==null||a.call(l,{page:1,where:e})},I=e=>{p.value=e!=null?e:null,n.value=!0},y=e=>{const l=e==null?u.value:[e];if(!l.length){v.error("请至少选择一条数据");return}B.confirm("确定要删除“"+l.map(a=>a.nickname).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const a=v.loading("请求中..");$e(l.map(s=>s.userId)).then(s=>{a.close(),v.success(s),c()}).catch(s=>{a.close(),v.error(s.message)})}).catch(()=>{})},V=(e,l)=>{const a=e?0:1;Fe(l.userId,a).then(s=>{l.status=a,v.success(s)}).catch(s=>{v.error(s.message)})},m=(e,l)=>{e==="password"?B.prompt(`请输入用户"${l.nickname}"的新密码：`,"重置密码",{inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",draggable:!0}).then(({value:a})=>{const s=v.loading("请求中..");Oe(l.userId,a).then(b=>{s.close(),v.success(b)}).catch(b=>{s.close(),v.error(b.message)})}).catch(()=>{}):e==="delete"&&y(l)};return T(()=>h.organizationId,()=>{var e,l;(l=(e=x.value)==null?void 0:e.resetFields)==null||l.call(e),c({})}),(e,l)=>{const a=R,s=se,b=ie,U=de,O=ue,C=me,$=pe,g=ye;return E(),A(G,null,[t(qe,{ref_key:"searchRef",ref:x,style:{"margin-bottom":"-14px"},onSearch:c},null,512),t(g,{ref_key:"tableRef",ref:f,"row-key":"userId",columns:d.value,datasource:N,"show-overflow-tooltip":!0,selections:u.value,"onUpdate:selections":l[2]||(l[2]=i=>u.value=i),"highlight-current-row":!0,"export-config":{fileName:"用户数据"},"footer-style":{paddingBottom:"16px"},"cache-key":"systemOrgUserTable"},{toolbar:o(()=>[t(a,{type:"primary",class:"ele-btn-icon",icon:r(Y),onClick:l[0]||(l[0]=i=>I())},{default:o(()=>l[4]||(l[4]=[w(" 新建 ")])),_:1},8,["icon"]),t(a,{type:"danger",class:"ele-btn-icon",icon:r(Z),onClick:l[1]||(l[1]=i=>y())},{default:o(()=>l[5]||(l[5]=[w(" 删除 ")])),_:1},8,["icon"])]),roles:o(({row:i})=>[(E(!0),A(G,null,oe(i.roles,k=>(E(),F(s,{key:k.roleId,size:"small","disable-transitions":!0},{default:o(()=>[w(ne(k.roleName),1)]),_:2},1024))),128))]),status:o(({row:i})=>[t(b,{size:"small","model-value":i.status===0,onChange:k=>V(k,i)},null,8,["model-value","onChange"])]),action:o(({row:i})=>[t(U,{type:"primary",underline:!1,onClick:k=>I(i)},{default:o(()=>l[6]||(l[6]=[w(" 修改 ")])),_:2},1032,["onClick"]),t(O,{direction:"vertical"}),t($,{items:[{title:"重置密码",command:"password"},{title:"删除用户",command:"delete",danger:!0}],style:{display:"inline"},onCommand:k=>m(k,i)},{default:o(()=>[t(U,{type:"primary",underline:!1},{default:o(()=>[l[7]||(l[7]=q("span",null,"更多",-1)),t(C,{size:12,style:{"vertical-align":"-1px","margin-left":"2px"}},{default:o(()=>[t(r(re))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1},8,["columns","selections"]),t(Be,{data:p.value,modelValue:n.value,"onUpdate:modelValue":l[3]||(l[3]=i=>n.value=i),"organization-id":z.organizationId,onDone:c},null,8,["data","modelValue","organization-id"])],64)}}},Me={__name:"org-edit",props:{modelValue:Boolean,data:Object,organizationId:Number},emits:["done","update:modelValue"],setup(z,{emit:h}){const x=h,f=z,d=_(!1),u=_(!1),p=_(null),[n,N,c]=D({organizationId:void 0,parentId:void 0,organizationName:"",organizationFullName:"",organizationCode:"",organizationType:void 0,sortNumber:void 0,comments:""}),I=J({organizationName:[{required:!0,message:"请输入机构名称",type:"string",trigger:"blur"}],organizationFullName:[{required:!0,message:"请输入机构全称",type:"string",trigger:"blur"}],organizationType:[{required:!0,message:"请选择机构类型",type:"string",trigger:"blur"}],sortNumber:[{required:!0,message:"请输入排序号",type:"number",trigger:"blur"}]}),y=()=>{var m,e;(e=(m=p.value)==null?void 0:m.validate)==null||e.call(m,l=>{if(!l)return;u.value=!0,(d.value?ke:we)({...n,parentId:n.parentId||0}).then(s=>{u.value=!1,v.success(s),V(!1),x("done")}).catch(s=>{u.value=!1,v.error(s.message)})})},V=m=>{x("update:modelValue",m)};return T(()=>f.modelValue,m=>{var e,l;m?f.data?(c({...f.data,parentId:f.data.parentId||void 0}),d.value=!0):(n.parentId=f.organizationId,d.value=!1):(N(),(l=(e=p.value)==null?void 0:e.clearValidate)==null||l.call(e))}),(m,e)=>{const l=K,a=S,s=P,b=j,U=Te,O=L,C=W,$=R,g=X;return E(),F(g,{form:"",width:620,"model-value":z.modelValue,title:d.value?"修改机构":"添加机构","onUpdate:modelValue":V},{footer:o(()=>[t($,{onClick:e[8]||(e[8]=i=>V(!1))},{default:o(()=>e[9]||(e[9]=[w("取消")])),_:1}),t($,{type:"primary",loading:u.value,onClick:y},{default:o(()=>e[10]||(e[10]=[w(" 保存 ")])),_:1},8,["loading"])]),default:o(()=>[t(C,{ref_key:"formRef",ref:p,model:r(n),rules:I,"label-width":"80px",onSubmit:e[7]||(e[7]=M(()=>{},["prevent"]))},{default:o(()=>[t(O,{gutter:16},{default:o(()=>[t(s,{sm:12,xs:24},{default:o(()=>[t(l,{label:"上级机构",prop:"parentId"},{default:o(()=>[t(le,{modelValue:r(n).parentId,"onUpdate:modelValue":e[0]||(e[0]=i=>r(n).parentId=i),placeholder:"请选择上级机构"},null,8,["modelValue"])]),_:1}),t(l,{label:"机构名称",prop:"organizationName"},{default:o(()=>[t(a,{clearable:"",maxlength:20,modelValue:r(n).organizationName,"onUpdate:modelValue":e[1]||(e[1]=i=>r(n).organizationName=i),placeholder:"请输入机构名称"},null,8,["modelValue"])]),_:1}),t(l,{label:"机构全称",prop:"organizationFullName"},{default:o(()=>[t(a,{clearable:"",maxlength:100,modelValue:r(n).organizationFullName,"onUpdate:modelValue":e[2]||(e[2]=i=>r(n).organizationFullName=i),placeholder:"请输入机构全称"},null,8,["modelValue"])]),_:1}),t(l,{label:"机构代码"},{default:o(()=>[t(a,{clearable:"",maxlength:20,modelValue:r(n).organizationCode,"onUpdate:modelValue":e[3]||(e[3]=i=>r(n).organizationCode=i),placeholder:"请输入机构代码"},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{sm:12,xs:24},{default:o(()=>[t(l,{label:"机构类型",prop:"organizationType"},{default:o(()=>[t(b,{code:"organization_type",modelValue:r(n).organizationType,"onUpdate:modelValue":e[4]||(e[4]=i=>r(n).organizationType=i),placeholder:"请选择机构类型"},null,8,["modelValue"])]),_:1}),t(l,{label:"排序号",prop:"sortNumber"},{default:o(()=>[t(U,{min:0,max:99999,modelValue:r(n).sortNumber,"onUpdate:modelValue":e[5]||(e[5]=i=>r(n).sortNumber=i),placeholder:"请输入排序号","controls-position":"right",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),t(l,{label:"备注"},{default:o(()=>[t(a,{rows:3,type:"textarea",maxlength:200,modelValue:r(n).comments,"onUpdate:modelValue":e[6]||(e[6]=i=>r(n).comments=i),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}},Ke={style:{padding:"0 16px 12px 0"}},je={style:{"margin-bottom":"12px"}},We={name:"SystemOrganization"},cl=Object.assign(We,{setup(z){const{mobile:h}=ce(),x=_(null),f=_(null),d=_(!0),u=_([]),p=_(null),n=_(""),N=_(!1),c=_(null),I=()=>{d.value=!0,ee().then(l=>{d.value=!1,u.value=H({data:l,idField:"organizationId",parentIdField:"parentId"}),_e(()=>{y(u.value[0])})}).catch(l=>{d.value=!1,v.error(l.message)})},y=l=>{var a,s,b,U;p.value!=null&&h.value&&((s=(a=x.value)==null?void 0:a.toggleCollapse)==null||s.call(a,!0)),l&&l.organizationId?(p.value=l,(U=(b=f.value)==null?void 0:b.setCurrentKey)==null||U.call(b,l.organizationId)):p.value=null},V=l=>{c.value=l!=null?l:null,N.value=!0},m=()=>{const l=p.value;l&&B.confirm(`确定要删除“${l.organizationName}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const a=v.loading("请求中..");he(l.organizationId).then(s=>{a.close(),v.success(s),I()}).catch(s=>{a.close(),v.error(s.message)})}).catch(()=>{})},e=(l,a)=>l?!!(a.organizationName&&a.organizationName.includes(l)):!0;return T(n,l=>{var a,s;(s=(a=f.value)==null?void 0:a.filter)==null||s.call(a,l)}),I(),(l,a)=>{const s=S,b=R,U=xe,O=Ve,C=ve,$=be,g=te;return E(),F(g,{"flex-table":"","multi-card":!1,"hide-footer":"",style:{"min-height":"420px"}},{default:o(()=>{var i;return[t($,{"flex-table":"","body-style":{padding:"0 0 0 16px",overflow:"hidden"}},{default:o(()=>[t(C,{ref_key:"splitRef",ref:x,"flex-table":"",size:"256px","allow-collapse":"","custom-style":{borderWidth:"0 1px 0 0",padding:"16px 0"},"body-style":{padding:"16px 16px 0 0",overflow:"hidden"},style:{height:"100%",overflow:"visible"}},{body:o(()=>[p.value?(E(),F(De,{key:0,"organization-id":p.value.organizationId},null,8,["organization-id"])):Q("",!0)]),default:o(()=>[q("div",Ke,[t(s,{clearable:"",maxlength:20,modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=k=>n.value=k),placeholder:"输入机构名称搜索","prefix-icon":r(ge)},null,8,["modelValue","prefix-icon"])]),q("div",je,[t(b,{type:"primary",class:"ele-btn-icon",icon:r(Y),onClick:a[1]||(a[1]=k=>V())},{default:o(()=>a[4]||(a[4]=[w(" 新建 ")])),_:1},8,["icon"]),t(b,{type:"warning",disabled:!p.value,class:"ele-btn-icon",icon:r(fe),onClick:a[2]||(a[2]=k=>V(p.value))},{default:o(()=>a[5]||(a[5]=[w(" 修改 ")])),_:1},8,["disabled","icon"]),t(b,{type:"danger",disabled:!p.value,class:"ele-btn-icon",icon:r(Z),onClick:m},{default:o(()=>a[6]||(a[6]=[w(" 删除 ")])),_:1},8,["disabled","icon"])]),t(O,{loading:d.value,style:{flex:1,paddingRight:"16px",overflow:"auto"}},{default:o(()=>[t(U,{ref_key:"treeRef",ref:f,data:u.value,"highlight-current":"","node-key":"organizationId",props:{label:"organizationName"},"expand-on-click-node":!1,"default-expand-all":!0,"filter-node-method":e,style:{"--ele-tree-item-height":"34px"},onNodeClick:y},null,8,["data"])]),_:1},8,["loading"])]),_:1},512)]),_:1}),t(Me,{modelValue:N.value,"onUpdate:modelValue":a[3]||(a[3]=k=>N.value=k),data:c.value,"organization-id":(i=p.value)==null?void 0:i.organizationId,onDone:I},null,8,["modelValue","data","organization-id"])]}),_:1})}}});export{cl as default};
