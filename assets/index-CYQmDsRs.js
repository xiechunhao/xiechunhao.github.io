import{i as Se}from"./index-p1XoTQj1.js";import{J as Z,r as I,H as U,o as h,l as $,d as y,a1 as j,a4 as E,t as W,aF as L,a7 as D,a_ as Ie,ai as H,c as T,w as v,F as P,m as z,aU as ae,a$ as me,a5 as re,e as G,au as Ae,b0 as De,a as ce,K as Fe,O as fe,I as Ee,b1 as ke,b2 as be,V as ue,b3 as Be,s as oe,b4 as we,b as k,u as S,E as O,aH as he,aG as $e,aK as xe,aB as pe,aD as Me,_ as ge,b5 as je,b6 as Re,b7 as Ue,b8 as Le,b9 as Ge,at as Te,aV as Ve,g as Pe,ba as _e,h as ze,as as Ne,aw as qe,bb as He,aC as We}from"./index-BF2fBoPb.js";import{i as Xe}from"./index-Cjr4ibGp.js";import{i as Ye}from"./index-B-b3I1wI.js";import{i as Je}from"./index-CcYpqHDV.js";import{E as Ke}from"./upload-CY9ZjjH3.js";import"./progress-C9ZnX_fS.js";import{u as Qe}from"./index-BoWW9VGZ.js";import{E as Ze}from"./image-viewer-NlVDGd40.js";import"./cloneDeep-Zuu3-0H5.js";import"./throttle-B3l-8Wjp.js";const et=Z({name:"FileGridItem",props:{item:{type:Object,required:!0},selectionType:String,selections:Array,current:Object,icons:Array,ctxMenuDropdownVisible:Boolean},emits:{click:e=>!0,checkChange:e=>!0,contextOpen:e=>!0},setup(e,{emit:t}){const i=I(null),s=U(()=>e.selectionType==="checkbox"||e.selectionType==="radio"),a=U(()=>!s.value||!e.item?!1:e.selectionType==="checkbox"?!!(e.selections&&e.selections.some(l=>l.key===e.item.key)):!!(e.current&&e.current.key===e.item.key)),m=U(()=>{var l,p,r;if(e.item.thumbnail)return e.item.thumbnail;if(e.icons){if(e.item.isDirectory)return(l=e.icons.find(n=>n.type==="dir"))==null?void 0:l.icon;if(e.item.name){const n=(p=e.icons.find(f=>f.suffixes?!!f.suffixes.find(b=>!!e.item.name.endsWith(b)):!1))==null?void 0:p.icon;if(n)return n}return(r=e.icons.find(n=>n.type==="file"))==null?void 0:r.icon}});return{dropdownTriggerRef:i,selectable:s,selected:a,icon:m,handleClick:()=>{t("click",e.item)},handleCheckChange:()=>{t("checkChange",e.item)},handleContextmenu:l=>{i.value!=null&&t("contextOpen",{item:e.item,triggerEl:i.value,e:l})}}}}),tt=(e,t)=>{const i=e.__vccOpts||e;for(const[s,a]of t)i[s]=a;return i},nt={class:"ele-file-list-item-icon"},lt=["src"],ot=["title"],it=y("i",{class:"ele-file-list-checkbox is-checked"},null,-1),st=[it];function at(e,t,i,s,a,m){return h(),$("div",{class:E(["ele-file-list-item",{"is-checked":e.selected},{"is-active":e.ctxMenuDropdownVisible}]),onClick:t[3]||(t[3]=L((...o)=>e.handleClick&&e.handleClick(...o),["stop"]))},[y("div",{class:"ele-file-list-item-body",onContextmenu:t[0]||(t[0]=(...o)=>e.handleContextmenu&&e.handleContextmenu(...o))},[y("div",nt,[j(e.$slots,"icon",{icon:e.icon,item:e.item},()=>[y("img",{src:e.icon,class:E({"ele-file-list-item-image":!!e.item.thumbnail})},null,10,lt)])]),j(e.$slots,"title",{item:e.item},()=>[y("div",{title:e.item.name,class:"ele-file-list-item-title"},W(e.item.name),9,ot)])],32),e.selectable?(h(),$("div",{key:0,class:"ele-file-list-item-checkbox",onClick:t[1]||(t[1]=L((...o)=>e.handleCheckChange&&e.handleCheckChange(...o),["stop"]))},st)):D("",!0),y("div",{ref:"dropdownTriggerRef",class:"ele-file-list-item-dropdown",onClick:t[2]||(t[2]=L(()=>{},["stop"]))},null,512)],2)}const rt=tt(et,[["render",at]]),ct=Z({name:"FileGrid",components:{ReceiverView:Ie,FileGridItem:rt},props:{data:Array,icons:Array,selectionType:String,selections:Array,current:Object,isCheckAll:Boolean,isIndeterminate:Boolean,checkAllText:String,selectedText:String,ctxMenuDropdownVisible:Boolean,contextMenuFileItem:Object},emits:{checkAllChange:()=>!0,itemClick:e=>!0,itemCheckChange:e=>!0,itemContextOpen:e=>!0},setup(e,{emit:t}){return{headerText:U(()=>!e.selections||!e.selections.length?e.checkAllText:e.selectedText?e.selectedText.replace(/\{\s*total\s*\}/g,String(e.selections.length)):""),handleCheckAllChange:()=>{t("checkAllChange")},handleItemClick:g=>{t("itemClick",g)},handleItemCheckChange:g=>{t("itemCheckChange",g)},handleItemContextOpen:g=>{t("itemContextOpen",g)}}}}),dt=(e,t)=>{const i=e.__vccOpts||e;for(const[s,a]of t)i[s]=a;return i},ut={key:0,class:"ele-file-list-header"},mt={class:"ele-file-list-body"};function ft(e,t,i,s,a,m){const o=H("FileGridItem"),g=H("ReceiverView");return h(),T(g,{class:"ele-file-list"},{default:v(()=>[e.selectionType==="checkbox"?(h(),$("div",ut,[y("div",{class:"ele-file-list-selection",onClick:t[0]||(t[0]=L((...c)=>e.handleCheckAllChange&&e.handleCheckAllChange(...c),["stop"]))},[y("i",{class:E(["ele-file-list-checkbox",{"is-checked":e.isCheckAll},{"is-indeterminate":e.isIndeterminate}])},null,2),y("div",null,W(e.headerText),1)])])):D("",!0),y("div",mt,[(h(!0),$(P,null,z(e.data,c=>(h(),T(o,{key:c.key,item:c,selectionType:e.selectionType,selections:e.selections,current:e.current,icons:e.icons,ctxMenuDropdownVisible:e.ctxMenuDropdownVisible&&e.contextMenuFileItem===c,onClick:e.handleItemClick,onCheckChange:e.handleItemCheckChange,onContextOpen:e.handleItemContextOpen},ae({_:2},[z(Object.keys(e.$slots),l=>({name:l,fn:v(p=>[j(e.$slots,l,me({ref_for:!0},p||{}))])}))]),1032,["item","selectionType","selections","current","icons","ctxMenuDropdownVisible","onClick","onCheckChange","onContextOpen"]))),128))])]),_:3})}const ht=dt(ct,[["render",ft]]),pt=Z({name:"FileTableItem",props:{item:{type:Object,required:!0},selectionType:String,selections:Array,current:Object,icons:Array,columns:Array,ctxMenuDropdownVisible:Boolean},emits:{click:e=>!0,checkChange:e=>!0,contextOpen:e=>!0},setup(e,{emit:t}){const i=I(null),s=U(()=>e.selectionType==="checkbox"||e.selectionType==="radio"),a=U(()=>!s.value||!e.item?!1:e.selectionType==="checkbox"?!!(e.selections&&e.selections.some(l=>l.key===e.item.key)):!!(e.current&&e.current.key===e.item.key)),m=U(()=>{var l,p,r;if(e.item.thumbnail)return e.item.thumbnail;if(e.icons){if(e.item.isDirectory)return(l=e.icons.find(n=>n.type==="dir"))==null?void 0:l.icon;if(e.item.name){const n=(p=e.icons.find(f=>f.suffixes?!!f.suffixes.find(b=>!!e.item.name.endsWith(b)):!1))==null?void 0:p.icon;if(n)return n}return(r=e.icons.find(n=>n.type==="file"))==null?void 0:r.icon}});return{dropdownTriggerRef:i,selectable:s,selected:a,icon:m,handleClick:()=>{t("click",e.item)},handleCheckChange:()=>{t("checkChange",e.item)},handleContextmenu:l=>{i.value!=null&&t("contextOpen",{item:e.item,triggerEl:i.value,e:l})}}}}),gt=(e,t)=>{const i=e.__vccOpts||e;for(const[s,a]of t)i[s]=a;return i},yt={key:0,class:"ele-file-list-item-checkbox"},Ct={class:"ele-file-list-item-name"},vt={class:"ele-file-list-item-icon"},kt=["src"],bt=["title"],_t={key:0,class:"ele-file-list-item-tools"};function It(e,t,i,s,a,m){return h(),$("div",{class:E(["ele-file-list-item",{"is-checked":e.selected},{"is-active":e.ctxMenuDropdownVisible}]),onClick:t[3]||(t[3]=L((...o)=>e.handleClick&&e.handleClick(...o),["stop"]))},[y("div",{class:"ele-file-list-item-body",onContextmenu:t[1]||(t[1]=(...o)=>e.handleContextmenu&&e.handleContextmenu(...o))},[e.selectable?(h(),$("div",yt,[y("i",{class:E(["ele-file-list-checkbox",{"is-radio":e.selectionType==="radio"},{"is-checked":e.selected}]),onClick:t[0]||(t[0]=L((...o)=>e.handleCheckChange&&e.handleCheckChange(...o),["stop"]))},null,2)])):D("",!0),y("div",Ct,[y("div",vt,[j(e.$slots,"icon",{icon:e.icon,item:e.item},()=>[y("img",{src:e.icon,class:E({"ele-file-list-item-image":!!e.item.thumbnail})},null,10,kt)]),j(e.$slots,"title",{item:e.item},()=>[y("div",{title:e.item.name,class:"ele-file-list-item-title"},W(e.item.name),9,bt)])]),e.$slots.tool?(h(),$("div",_t,[j(e.$slots,"tool",{item:e.item})])):D("",!0)]),(h(!0),$(P,null,z(e.columns,o=>(h(),$("div",{key:o.prop,style:re(o.style),class:"ele-file-list-item-cell"},[o.slot&&!["icon","title","tool","contextMenu"].includes(o.slot)&&e.$slots[o.slot]?j(e.$slots,o.slot,{key:0,item:e.item,col:o}):e.item&&o&&o.prop?(h(),$(P,{key:1},[G(W(e.item[o.prop]),1)],64)):D("",!0)],4))),128))],32),y("div",{ref:"dropdownTriggerRef",class:"ele-file-list-item-dropdown",onClick:t[2]||(t[2]=L(()=>{},["stop"]))},null,512)],2)}const wt=gt(pt,[["render",It]]),$t=Z({name:"FileSort",props:{sort:String,order:String,name:{type:String,required:!0}}}),xt=(e,t)=>{const i=e.__vccOpts||e;for(const[s,a]of t)i[s]=a;return i};function Mt(e,t,i,s,a,m){return h(),$("i",{class:E(["ele-file-list-item-sort",{"is-asc":e.name===e.sort&&e.order==="asc"},{"is-desc":e.name===e.sort&&e.order==="desc"}])},null,2)}const Tt=xt($t,[["render",Mt]]),Vt=Z({name:"FileTable",components:{ReceiverView:Ie,FileTableItem:wt,FileSort:Tt},props:{data:Array,icons:Array,selectionType:String,selections:Array,current:Object,isCheckAll:Boolean,isIndeterminate:Boolean,nameText:String,sizeText:String,timeText:String,sortable:Boolean,sort:String,order:String,columns:Array,ctxMenuDropdownVisible:Boolean,contextMenuFileItem:Object},emits:{checkAllChange:()=>!0,itemClick:e=>!0,itemCheckChange:e=>!0,itemContextOpen:e=>!0,sortChange:e=>!0},setup(e,{emit:t}){return{tableCols:U(()=>e.columns?e.columns:[{title:e.sizeText,prop:"length",style:{width:"120px",flexShrink:0},sortable:e.sortable},{title:e.timeText,prop:"updateTime",style:{width:"180px",flexShrink:0},sortable:e.sortable}]),handleCheckAllChange:()=>{t("checkAllChange")},handleItemClick:c=>{t("itemClick",c)},handleItemCheckChange:c=>{t("itemCheckChange",c)},handleSortChange:(c,l)=>{l?l.sortable&&t("sortChange",c):e.sortable&&t("sortChange",c)},handleItemContextOpen:c=>{t("itemContextOpen",c)}}}}),Ot=(e,t)=>{const i=e.__vccOpts||e;for(const[s,a]of t)i[s]=a;return i},St={class:"ele-file-list-header"},At={class:"ele-file-list-item"},Dt={class:"ele-file-list-item-body"},Ft={key:0,class:"ele-file-list-item-checkbox"},Et=["onClick"],Bt={class:"ele-file-list-body"};function jt(e,t,i,s,a,m){const o=H("FileSort"),g=H("FileTableItem"),c=H("ReceiverView");return h(),T(c,{class:"ele-file-list-table"},{default:v(()=>[y("div",St,[y("div",At,[y("div",Dt,[e.selectionType==="checkbox"||e.selectionType==="radio"?(h(),$("div",Ft,[e.selectionType==="checkbox"?(h(),$("i",{key:0,class:E(["ele-file-list-checkbox",{"is-checked":e.isCheckAll},{"is-indeterminate":e.isIndeterminate}]),onClick:t[0]||(t[0]=L((...l)=>e.handleCheckAllChange&&e.handleCheckAllChange(...l),["stop"]))},null,2)):D("",!0)])):D("",!0),y("div",{class:E(["ele-file-list-item-name",{"is-sortable":e.sortable}]),onClick:t[1]||(t[1]=l=>e.handleSortChange("name"))},[y("span",null,W(e.nameText),1),e.sortable?(h(),T(o,{key:0,sort:e.sort,order:e.order,name:"name"},null,8,["sort","order"])):D("",!0)],2),(h(!0),$(P,null,z(e.tableCols,l=>(h(),$("div",{key:l.prop,style:re(l.headerStyle||l.style),class:E(["ele-file-list-item-cell",{"is-sortable":l.sortable}]),onClick:p=>e.handleSortChange(l.prop,l)},[y("span",null,[l.headerSlot&&!["icon","title","tool","contextMenu"].includes(l.headerSlot)&&e.$slots[l.headerSlot]?j(e.$slots,l.headerSlot,{key:0,col:l}):(h(),$(P,{key:1},[G(W(l.title),1)],64))]),l.sortable?(h(),T(o,{key:0,sort:e.sort,order:e.order,name:l.prop},null,8,["sort","order","name"])):D("",!0)],14,Et))),128))])])]),y("div",Bt,[(h(!0),$(P,null,z(e.data,l=>(h(),T(g,{key:l.key,item:l,selectionType:e.selectionType,selections:e.selections,current:e.current,icons:e.icons,columns:e.tableCols,ctxMenuDropdownVisible:e.ctxMenuDropdownVisible&&e.contextMenuFileItem===l,onClick:e.handleItemClick,onCheckChange:e.handleItemCheckChange,onContextOpen:e.handleItemContextOpen},ae({_:2},[z(Object.keys(e.$slots),p=>({name:p,fn:v(r=>[j(e.$slots,p,me({ref_for:!0},r||{}))])}))]),1032,["item","selectionType","selections","current","icons","columns","ctxMenuDropdownVisible","onClick","onCheckChange","onContextOpen"]))),128))])]),_:3})}const Rt=Ot(Vt,[["render",jt]]),ye=[{icon:"/ele-file-list/ic_file_misc_sm.png",type:"file"},{icon:"/ele-file-list/ic_file_folder_sm.png",type:"dir"},{icon:"/ele-file-list/ic_file_code_sm.png",suffixes:[".java",".js",".css",".vue",".ts",".tsx",".scss",".less",".c",".cpp",".cs",".jsp",".php",".asp",".py",".go",".kt",".lua"]},{icon:"/ele-file-list/ic_file_htm_sm.png",suffixes:[".html",".htm"]},{icon:"/ele-file-list/ic_file_text_sm.png",suffixes:[".txt"]},{icon:"/ele-file-list/ic_file_pdf_sm.png",suffixes:[".pdf"]},{icon:"/ele-file-list/ic_file_word_sm.png",suffixes:[".doc",".docx"]},{icon:"/ele-file-list/ic_file_excel_sm.png",suffixes:[".xls",".xlsx"]},{icon:"/ele-file-list/ic_file_ppt_sm.png",suffixes:[".ppt",".pptx"]},{icon:"/ele-file-list/ic_file_visio_sm.png",suffixes:[".vsd"]},{icon:"/ele-file-list/ic_file_ps_sm.png",suffixes:[".psd"]},{icon:"/ele-file-list/ic_file_cad_sm.png",suffixes:[".dwg"]},{icon:"/ele-file-list/ic_file_flash_sm.png",suffixes:[".swf"]},{icon:"/ele-file-list/ic_file_music_sm.png",suffixes:[".mp3",".wav"]},{icon:"/ele-file-list/ic_file_video_sm.png",suffixes:[".mp4",".rmvb",".flv",".avi",".3gp"]},{icon:"/ele-file-list/ic_file_picture_sm.png",suffixes:[".png",".jpg",".jpeg",".gif",".bmp"]},{icon:"/ele-file-list/ic_file_fonts_sm.png",suffixes:[".ttf",".woff"]},{icon:"/ele-file-list/ic_file_bt_sm.png",suffixes:[".torrent"]},{icon:"/ele-file-list/ic_file_android_sm.png",suffixes:[".apk"]},{icon:"/ele-file-list/ic_file_exe_sm.png",suffixes:[".exe"]},{icon:"/ele-file-list/ic_file_ipa_sm.png",suffixes:[".ipa",".dmg"]},{icon:"/ele-file-list/ic_file_zip_sm.png",suffixes:[".zip",".rar",".7z"]}],Ut=ye.map(e=>({...e,icon:e.icon.replace("_sm.png",".png")})),Lt=ye.map(e=>({...e,icon:e.icon.replace("/ele-file-list/","https://cdn.eleadmin.com/20200609/")})),Gt=Lt.map(e=>({...e,icon:e.icon.replace("_sm.png",".png")})),Pt={data:{type:Array,required:!0},selectionType:String,selections:Array,current:Object,grid:{type:Boolean,default:!0},sortable:Boolean,sort:String,order:String,icons:{type:Array,default:()=>Gt},smallIcons:Array,columns:Array,boxChoose:Boolean,contextMenus:[Array,Function],contextMenuProps:Object,locale:Object},zt={itemClick:e=>!0,sortChange:e=>!0,"update:selections":e=>!0,"update:current":e=>!0,itemContextMenu:e=>!0,itemContextOpen:(e,t)=>!0},Nt=".ele-file-list-body>.ele-file-list-item",qt=Z({name:"EleFileList",components:{EleDropdown:Ae,FileGrid:ht,FileTable:Rt},props:Pt,emits:zt,setup(e,{emit:t}){const{lang:i}=De("fileList",e),s=ce({top:"0px",left:"0px",width:"0px",height:"0px",display:"none"}),a=I(null),m=Fe([]),o=I(),g=I(!1),c=I(null),l=U(()=>!!(e.data&&e.data.length&&e.selections&&e.selections.length&&!e.data.some(d=>{var M,B;return!((B=(M=e.selections)==null?void 0:M.some)!=null&&B.call(M,R=>d.key===R.key))}))),p=U(()=>!!(!l.value&&e.selections&&e.selections.length)),r=d=>{t("update:selections",d)},n=d=>{t("update:current",d)},f=()=>{if(e.selectionType!=="checkbox")return;if(l.value||e.data==null||!e.data.length){if(!e.selections){r([]);return}const M=e.selections.filter(B=>e.data?!e.data.some(R=>R.key===B.key):!0);r(M);return}if(!e.selections){r([...e.data]);return}const d=e.selections.concat(e.data.filter(M=>e.selections?!e.selections.some(B=>B.key===M.key):!0));r(d)},b=d=>{if(e.selectionType==="radio"){n(e.current&&e.current.key===d.key?null:d);return}if(e.selectionType==="checkbox"){if(!e.selections||!e.selections.length){r([d]);return}if(!e.selections.some(M=>M.key===d.key)){r(e.selections.concat([d]));return}r(e.selections.filter(M=>M.key!==d.key))}},V=d=>{t("itemClick",d)},C=d=>{const M={sort:d};e.order&&d===e.sort?M.order=e.order==="asc"?"desc":null:M.order="asc",t("sortChange",M)},_=d=>{t("itemContextMenu",d)},u=d=>{c.value!=null&&t("itemContextMenu",{key:d,item:c.value})},w=d=>{g.value=d,d&&a.value!=null&&c.value!=null&&t("itemContextOpen",a.value,c.value)},x=d=>typeof e.contextMenus=="function"?e.contextMenus(d):e.contextMenus,A=()=>{a.value&&a.value.handleClose()},N=(d,M)=>{c.value!=null&&c.value===d||(A(),ue(()=>{c.value=d,m.value=x(d)||[],o.value=M,m.value.length&&ue(()=>{a.value&&a.value.handleOpen()})}))},Y=d=>{if(e.contextMenus!=null){if(d.e.preventDefault(),d.e.stopPropagation(),o.value!==d.triggerEl){N(d.item,d.triggerEl);return}m.value.length&&a.value&&a.value.handleOpen()}},J=d=>{if(!e.boxChoose||e.selectionType!=="checkbox")return;const M=d.clientX,B=d.clientY,R=d.currentTarget,q=R.getBoundingClientRect(),de=Array.from(R.querySelectorAll(Nt)),Ce=Be(X=>{const ee=Math.max(X.clientX,q.left),te=Math.max(X.clientY,q.top),K=Math.min(ee,M)-q.left,Q=Math.min(te,B)-q.top,ne=Math.min(Math.abs(ee-M),R.clientWidth-K),le=Math.min(Math.abs(te-B),R.clientHeight-Q);if(s.left=K+"px",s.top=Q+"px",s.width=ne+"px",s.height=le+"px",s.display="block",ne<6||le<6){de.forEach(F=>{F.classList.remove("is-active")});return}d.stopPropagation(),d.preventDefault(),X.stopPropagation(),X.preventDefault(),de.forEach(F=>{const ie=F.offsetLeft+F.clientWidth,se=F.offsetTop+F.clientHeight;ie>K&&se>Q&&F.offsetLeft<K+ne&&F.offsetTop<Q+le?F.classList.add("is-active"):F.classList.remove("is-active")})},60),ve=X=>{s.display="none";const ee=Math.max(X.clientX,q.left),te=Math.max(X.clientY,q.top),K=Math.min(ee,M)-q.left,Q=Math.min(te,B)-q.top,ne=Math.min(Math.abs(ee-M),R.clientWidth-K),le=Math.min(Math.abs(te-B),R.clientHeight-Q);if(ne>6&&le>6){const F=[];de.forEach((ie,se)=>{ie.classList.contains("is-active")&&(ie.classList.remove("is-active"),e.data&&e.data[se]&&F.push(e.data[se]))}),F.length&&r(F)}document.removeEventListener("mousemove",Ce),document.removeEventListener("mouseup",ve)};document.addEventListener("mousemove",Ce),document.addEventListener("mouseup",ve)};return fe([()=>e.grid,()=>e.data],()=>{A(),o.value=null,c.value=null},{deep:!0}),Ee(()=>{c.value=null}),{lang:i,selectorStyle:s,ctxMenuDropdownRef:a,ctxMenuDropdownItems:m,ctxMenuDropdownVirtualRef:o,ctxMenuDropdownVisible:g,contextMenuFileItem:c,isCheckAll:l,isIndeterminate:p,handleCheckAllChange:f,handleItemCheckChange:b,handleItemClick:V,handleSortChange:C,handleItemContextMenu:_,handleItemCtxMenuClick:u,handleItemCtxMenuVisible:w,handleItemContextOpen:Y,handleMousedown:J}}}),Ht=(e,t)=>{const i=e.__vccOpts||e;for(const[s,a]of t)i[s]=a;return i};function Wt(e,t,i,s,a,m){const o=H("FileGrid"),g=H("FileTable"),c=H("EleDropdown");return h(),$("div",{class:"ele-file-list-group",onMousedown:t[0]||(t[0]=(...l)=>e.handleMousedown&&e.handleMousedown(...l))},[e.grid?(h(),T(o,{key:0,data:e.data,icons:e.icons,selectionType:e.selectionType,selections:e.selections,current:e.current,isCheckAll:e.isCheckAll,isIndeterminate:e.isIndeterminate,checkAllText:e.lang.selectAll,selectedText:e.lang.selectTips,ctxMenuDropdownVisible:e.ctxMenuDropdownVisible,contextMenuFileItem:e.contextMenuFileItem,onCheckAllChange:e.handleCheckAllChange,onItemClick:e.handleItemClick,onItemCheckChange:e.handleItemCheckChange,onItemContextOpen:e.handleItemContextOpen},ae({_:2},[z(Object.keys(e.$slots),l=>({name:l,fn:v(p=>[j(e.$slots,l,ke(be(p||{})))])}))]),1032,["data","icons","selectionType","selections","current","isCheckAll","isIndeterminate","checkAllText","selectedText","ctxMenuDropdownVisible","contextMenuFileItem","onCheckAllChange","onItemClick","onItemCheckChange","onItemContextOpen"])):(h(),T(g,{key:1,data:e.data,icons:e.icons,selectionType:e.selectionType,selections:e.selections,current:e.current,isCheckAll:e.isCheckAll,isIndeterminate:e.isIndeterminate,nameText:e.lang.fileName,sizeText:e.lang.fileSize,timeText:e.lang.fileTimestamp,sortable:e.sortable,sort:e.sort,order:e.order,columns:e.columns,ctxMenuDropdownVisible:e.ctxMenuDropdownVisible,contextMenuFileItem:e.contextMenuFileItem,onCheckAllChange:e.handleCheckAllChange,onItemClick:e.handleItemClick,onItemCheckChange:e.handleItemCheckChange,onItemContextOpen:e.handleItemContextOpen,onSortChange:e.handleSortChange},ae({_:2},[z(Object.keys(e.$slots),l=>({name:l,fn:v(p=>[j(e.$slots,l,ke(be(p||{})))])}))]),1032,["data","icons","selectionType","selections","current","isCheckAll","isIndeterminate","nameText","sizeText","timeText","sortable","sort","order","columns","ctxMenuDropdownVisible","contextMenuFileItem","onCheckAllChange","onItemClick","onItemCheckChange","onItemContextOpen","onSortChange"])),y("div",{class:"ele-file-list-selector",style:re(e.selectorStyle)},null,4),e.contextMenus?(h(),T(c,me({key:2,persistent:!1,placement:"bottom-start",popperClass:"ele-file-list-item-context"},e.contextMenuProps||{},{ref:"ctxMenuDropdownRef",componentType:"pro",preventContextmenu:!0,trigger:"click",virtualTriggering:!0,virtualRef:e.ctxMenuDropdownVirtualRef,disabled:!e.ctxMenuDropdownItems.length,items:e.ctxMenuDropdownItems,onCommand:e.handleItemCtxMenuClick,onVisibleChange:e.handleItemCtxMenuVisible}),null,16,["virtualRef","disabled","items","onCommand","onVisibleChange"])):D("",!0)],32)}const Xt=Ht(qt,[["render",Wt]]);async function Yt(e){const t=await oe.get("/system/user-file",{params:e});return t.data.code===0&&t.data.data?t.data.data:Promise.reject(new Error(t.data.message))}async function Oe(e){const t=await oe.post("/system/user-file",e);return t.data.code===0?t.data.message:Promise.reject(new Error(t.data.message))}async function Jt(e){const t=await oe.put("/system/user-file",e);return t.data.code===0?t.data.message:Promise.reject(new Error(t.data.message))}async function Kt(e){const t=await oe.delete("/system/user-file/"+e);return t.data.code===0?t.data.message:Promise.reject(new Error(t.data.message))}async function Qt(e){const t=await oe.delete("/system/user-file/batch",{data:e});return t.data.code===0?t.data.message:Promise.reject(new Error(t.data.message))}const Zt={__name:"folder-edit",props:{modelValue:Boolean,parentId:Number},emits:["done","update:modelValue"],setup(e,{emit:t}){const i=t,s=e,a=I(null),m=I(!1),[o,g]=we({name:""}),c=ce({name:[{required:!0,message:"请输入文件夹名称",type:"string",trigger:"blur"}]}),l=()=>{var r,n;(n=(r=a.value)==null?void 0:r.validate)==null||n.call(r,f=>{f&&(m.value=!0,Oe({...o,parentId:s.parentId,isDirectory:1}).then(b=>{m.value=!1,O.success(b),p(!1),i("done")}).catch(b=>{m.value=!1,O.error(b.message)}))})},p=r=>{i("update:modelValue",r)};return fe(()=>s.modelValue,r=>{var n,f;r||(g(),(f=(n=a.value)==null?void 0:n.clearValidate)==null||f.call(n))}),(r,n)=>{const f=he,b=$e,V=xe,C=pe,_=Me;return h(),T(_,{form:"",width:460,title:"新建文件夹","model-value":e.modelValue,"onUpdate:modelValue":p},{footer:v(()=>[k(C,{onClick:n[2]||(n[2]=u=>p(!1))},{default:v(()=>n[3]||(n[3]=[G("取消")])),_:1}),k(C,{type:"primary",loading:m.value,onClick:l},{default:v(()=>n[4]||(n[4]=[G(" 保存 ")])),_:1},8,["loading"])]),default:v(()=>[k(V,{ref_key:"formRef",ref:a,model:S(o),rules:c,"label-width":"100px",onSubmit:n[1]||(n[1]=L(()=>{},["prevent"]))},{default:v(()=>[k(b,{label:"文件夹名称",prop:"name"},{default:v(()=>[k(f,{clearable:"",maxlength:20,modelValue:S(o).name,"onUpdate:modelValue":n[0]||(n[0]=u=>S(o).name=u),placeholder:"请输入文件夹名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value"])}}},en={style:{"max-width":"240px"},class:"hidden-sm-and-down"},tn={__name:"file-toolbar",props:{grid:Boolean,selections:Array,parentId:Number},emits:["update:grid","done"],setup(e,{emit:t}){const i=e,s=t,a=I(""),m=I(!1),o=r=>{if(r.size/1024/1024>100)return O.error("大小不能超过 100MB"),!1;const n=O.loading("上传中..");return Qe(r).then(f=>{Oe({name:f.name,isDirectory:0,parentId:i.parentId,path:f.path,length:f.length,contentType:f.contentType}).then(()=>{n.close(),O.success("上传成功"),l()}).catch(b=>{n.close(),O.error(b.message)})}).catch(f=>{n.close(),O.error(f.message)}),!1},g=()=>{m.value=!0},c=()=>{const r=i.selections;Ve.confirm("确定要删除“"+r.map(n=>n.name).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const n=O.loading("请求中..");Qt(r.map(f=>f.id)).then(f=>{n.close(),O.success(f),l()}).catch(f=>{n.close(),O.error(f.message)})}).catch(()=>{})},l=()=>{s("done")},p=()=>{s("update:grid",!i.grid)};return(r,n)=>{const f=pe,b=Ke,V=he,C=Pe,_=Je;return h(),$(P,null,[k(_,{theme:"plain",class:"demo-file-toolbar"},{tools:v(()=>[y("div",en,[k(V,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=u=>a.value=u),placeholder:"搜索您的文件","prefix-icon":S(je)},null,8,["modelValue","prefix-icon"])]),k(C,{class:"demo-file-tool",onClick:p},{default:v(()=>[e.grid?(h(),T(S(Re),{key:0})):(h(),T(S(Ue),{key:1}))]),_:1})]),default:v(()=>[k(b,{action:"","show-upload-list":!1,"before-upload":o,style:{display:"inline-block","vertical-align":"middle"}},{default:v(()=>[k(f,{type:"primary",class:"ele-btn-icon",icon:S(Le)},{default:v(()=>n[2]||(n[2]=[G(" 上传 ")])),_:1},8,["icon"])]),_:1}),k(f,{class:"ele-btn-icon",icon:S(Ge),style:{"margin-left":"12px"},onClick:g},{default:v(()=>n[3]||(n[3]=[G(" 新建文件夹 ")])),_:1},8,["icon"]),k(f,{plain:"",type:"danger",icon:S(Te),disabled:!e.selections.length,class:"ele-btn-icon hidden-xs-only",onClick:c},{default:v(()=>n[4]||(n[4]=[G(" 删除 ")])),_:1},8,["icon","disabled"])]),_:1}),k(Zt,{modelValue:m.value,"onUpdate:modelValue":n[1]||(n[1]=u=>m.value=u),"parent-id":e.parentId,onDone:l},null,8,["modelValue","parent-id"])],64)}}},nn=ge(tn,[["__scopeId","data-v-b0d27d3d"]]),ln={class:"demo-breadcrumb"},on={class:"demo-breadcrumb-body"},sn={class:"demo-breadcrumb-list"},an=["onClick"],rn={class:"hidden-xs-only"},cn={__name:"file-header",props:{directorys:Array,total:Number},emits:["update:directorys"],setup(e,{emit:t}){const i=e,s=t,a=()=>{s("update:directorys",i.directorys.slice(0,i.directorys.length-1))},m=()=>{i.directorys.length&&s("update:directorys",[])},o=g=>{g!==i.directorys.length-1&&s("update:directorys",i.directorys.slice(0,g+1))};return(g,c)=>{const l=ze;return h(),$("div",ln,[y("div",on,[e.directorys.length?(h(),T(l,{key:0,type:"primary",class:"demo-breadcrumb-back",onClick:a},{default:v(()=>c[0]||(c[0]=[G(" 返回上一级 ")])),_:1})):D("",!0),y("div",sn,[k(l,{type:e.directorys.length?"primary":void 0,class:"demo-breadcrumb-item"},{default:v(()=>[y("div",{class:E({"demo-breadcrumb-link":!!e.directorys.length}),onClick:m}," 全部文件 ",2),e.directorys.length?(h(),T(l,{key:0,icon:S(_e),type:"placeholder",style:{display:"flex"}},null,8,["icon"])):D("",!0)]),_:1},8,["type"]),(h(!0),$(P,null,z(e.directorys,(p,r)=>(h(),T(l,{key:p.id,class:"demo-breadcrumb-item",type:r!==e.directorys.length-1?"primary":"default"},{default:v(()=>[y("div",{class:E({"demo-breadcrumb-link":r!==e.directorys.length-1}),onClick:n=>o(r)},W(p.name),11,an),r!==e.directorys.length-1?(h(),T(l,{key:0,icon:S(_e),type:"placeholder",style:{display:"flex"}},null,8,["icon"])):D("",!0)]),_:2},1032,["type"]))),128))])]),y("div",rn,"已全部加载，共 "+W(e.total)+" 个",1)])}}},dn=ge(cn,[["__scopeId","data-v-c7c221c0"]]),un={__name:"name-edit",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(e,{emit:t}){const i=t,s=e,a=I(null),m=I(!1),[o,g]=we({name:""}),c=ce({name:[{required:!0,message:"请输入文件/夹名称",type:"string",trigger:"blur"}]}),l=()=>{var r,n;(n=(r=a.value)==null?void 0:r.validate)==null||n.call(r,f=>{var b;f&&(m.value=!0,Jt({...o,id:(b=s.data)==null?void 0:b.id}).then(V=>{m.value=!1,O.success(V),p(!1),i("done")}).catch(V=>{m.value=!1,O.error(V.message)}))})},p=r=>{i("update:modelValue",r)};return fe(()=>s.modelValue,r=>{var n,f;r?s.data&&(o.name=s.data.name):(g(),(f=(n=a.value)==null?void 0:n.clearValidate)==null||f.call(n))}),(r,n)=>{const f=he,b=$e,V=xe,C=pe,_=Me;return h(),T(_,{form:"",width:460,title:"重命名","model-value":e.modelValue,"onUpdate:modelValue":p},{footer:v(()=>[k(C,{onClick:n[2]||(n[2]=u=>p(!1))},{default:v(()=>n[3]||(n[3]=[G("取消")])),_:1}),k(C,{type:"primary",loading:m.value,onClick:l},{default:v(()=>n[4]||(n[4]=[G(" 保存 ")])),_:1},8,["loading"])]),default:v(()=>[k(V,{ref_key:"formRef",ref:a,model:S(o),rules:c,"label-width":"100px",onSubmit:n[1]||(n[1]=L(()=>{},["prevent"]))},{default:v(()=>[k(b,{label:"文件/夹名称",prop:"name"},{default:v(()=>[k(f,{clearable:"",maxlength:20,modelValue:S(o).name,"onUpdate:modelValue":n[0]||(n[0]=u=>S(o).name=u),placeholder:"请输入文件/夹名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value"])}}},mn={class:"demo-file-list"},fn={key:0,class:"demo-file-list-empty"},hn={style:{display:"none"}},pn={__name:"file-list",props:{parentId:Number,data:Array,sort:String,order:String,selections:Array,grid:Boolean},emits:["sort-change","update:selections","go-directory","done"],setup(e,{emit:t}){const i=e,s=t,a=I(null),m=ce({currentSrc:"",current:0,visible:!1}),o=I([]),g=I(!1),c=I(),l=u=>{s("sort-change",u)},p=u=>{s("update:selections",u)},r=u=>{console.log("onItemClick:",JSON.parse(JSON.stringify(u))),u.isDirectory?s("go-directory",u):V(u)?C(u):p(i.selections.includes(u)?i.selections.filter(w=>w!==u):[...i.selections,u])},n=u=>{const{key:w,item:x}=u;w==="open"?x.isDirectory||V(x)?r(x):window.open(x.url):w==="download"?typeof x.downloadUrl=="string"&&window.open(x.downloadUrl):w==="edit"?(c.value=x,g.value=!0):w==="remove"?f(x):w==="move"&&O.info({message:`点击了移动到: ${x.name}`,plain:!0})},f=u=>{Ve.confirm(`确定要删除“${u.name}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const w=O.loading("请求中..");Kt(u.id).then(x=>{w.close(),O.success(x),b()}).catch(x=>{w.close(),O.error(x.message)})}).catch(()=>{})},b=()=>{s("done")},V=u=>typeof u.contentType=="string"&&u.contentType.startsWith("image/")&&u.url,C=u=>{const w=i.data.filter(A=>V(A)),x=w.indexOf(u);x!==-1&&(o.value=w.map(A=>A.url),m.currentSrc=u.url,m.current=x,m.visible=!0,ue(()=>{var A,N,Y,J,d;(d=(J=(Y=(N=(A=a.value)==null?void 0:A.$el)==null?void 0:N.querySelector)==null?void 0:Y.call(N,"img"))==null?void 0:J.click)==null||d.call(J)}))},_=u=>{if(!u)return[];const w=[{title:"重命名",command:"edit",icon:Ne,divided:u.isDirectory},{title:"移动到",command:"move",icon:qe},{title:"删除",command:"remove",icon:Te,divided:!0,danger:!0}];return u.isDirectory||w.unshift({title:"下载",command:"download",icon:He,divided:!0}),w.unshift({title:"打开",command:"open"}),w};return(u,w)=>{const x=Xt,A=We,N=Ze;return h(),$(P,null,[y("div",mn,[k(x,{data:e.data,grid:e.grid,sort:e.sort,order:e.order,sortable:!0,"box-choose":!0,"selection-type":"checkbox",selections:e.selections,"context-menus":_,"context-menu-props":{menuStyle:{minWidth:"120px"},iconProps:{size:15}},icons:S(Ut),"small-icons":S(ye),style:re({minHeight:"400px",minWidth:e.grid?"auto":"456px"}),onItemClick:r,onSortChange:l,"onUpdate:selections":p,onItemContextMenu:n},null,8,["data","grid","sort","order","selections","icons","small-icons","style"]),e.data.length?D("",!0):(h(),$("div",fn,[k(A,{description:"无数据","image-size":80})]))]),y("div",hn,[m.visible?(h(),T(N,{key:0,ref_key:"previewRef",ref:a,src:m.currentSrc,"preview-src-list":o.value,"initial-index":m.current,"hide-on-click-modal":!0,"preview-teleported":!0},null,8,["src","preview-src-list","initial-index"])):D("",!0)]),k(un,{modelValue:g.value,"onUpdate:modelValue":w[0]||(w[0]=Y=>g.value=Y),data:c.value,onDone:b},null,8,["modelValue","data"])],64)}}},gn=ge(pn,[["__scopeId","data-v-c76b3173"]]),yn={style:{padding:"8px 16px"}},Cn={name:"ExtensionFile"},On=Object.assign(Cn,{setup(e){const t=I(!0),i=I([]),s=I(""),a=I(""),m=I([]),o=I([]),g=I(0),c=I(!0),l=I(0),p=()=>{i.value=[],m.value=[],t.value=!0,Yt({sort:a.value?s.value:"",order:a.value,parentId:l.value}).then(C=>{t.value=!1,i.value=C.map(_=>Object.assign(_,{key:_.id,isDirectory:_.isDirectory===1,length:V(_.length)})),g.value=C.length}).catch(C=>{t.value=!1,O.error(C.message)})},r=()=>{p()},n=C=>{var _;a.value=(_=C.order)!=null?_:"",s.value=C.sort,p()},f=C=>{b([...o.value,C])},b=C=>{var _,u;o.value=C,l.value=(u=(_=o.value[o.value.length-1])==null?void 0:_.id)!=null?u:0,p()},V=C=>C==null?"-":C<1024?C+"B":C<1024*1024?(C/1024).toFixed(1)+"KB":C<1024*1024*1024?(C/1024/1024).toFixed(1)+"M":(C/1024/1024/1024).toFixed(1)+"G";return p(),(C,_)=>{const u=Ye,w=Xe,x=Se;return h(),T(x,{"multi-card":!1},{default:v(()=>[k(w,{"body-style":{padding:0}},{default:v(()=>[y("div",yn,[k(nn,{grid:c.value,"onUpdate:grid":_[0]||(_[0]=A=>c.value=A),selections:m.value,parentId:l.value,onDone:r},null,8,["grid","selections","parentId"]),k(dn,{total:g.value,directorys:o.value,"onUpdate:directorys":b},null,8,["total","directorys"])]),k(u,{loading:t.value},{default:v(()=>[k(gn,{grid:c.value,data:i.value,sort:s.value,order:a.value,parentId:l.value,selections:m.value,"onUpdate:selections":_[1]||(_[1]=A=>m.value=A),onSortChange:n,onGoDirectory:f,onDone:r},null,8,["grid","data","sort","order","parentId","selections"])]),_:1},8,["loading"])]),_:1})]),_:1})}}});export{On as default};
