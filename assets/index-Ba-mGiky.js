import{i as Q}from"./index-p1XoTQj1.js";import{b4 as q,o as h,c as $,w as o,b as l,cM as X,aF as P,u as r,e as b,aH as T,aG as j,c8 as W,aB as O,aK as z,r as y,a as Z,O as ee,a7 as le,E as g,aD as Y,_ as te,bT as oe,l as L,fR as ae,d as R,h as ne,ax as G,ai as se,bD as re,at as de,b8 as ue,t as K,F as ie,m as me,aV as N,k as pe,aS as ce,j as fe}from"./index-BF2fBoPb.js";import{i as H}from"./index-Cjr4ibGp.js";import{i as _e}from"./index-DG03PXF-.js";import"./index-CcYpqHDV.js";import{v as ge}from"./index-B-b3I1wI.js";import"./index-BnIMXyIx.js";import"./virtual-list-B6G0p9cv.js";import"./index-BWYZqqjh.js";import"./index-DuliLu7F.js";import{E as A,a as J}from"./col-DirwGu8S.js";import{E as be}from"./date-picker-BzLnEAo6.js";import{_ as ve}from"./role-select-B3bSY8Gf.js";import{c as xe,u as ye,a as Ve,i as ke,p as we,r as Ue,d as he,b as Ee}from"./index-AC-OHBhs.js";import{e as Ce,p as $e}from"./validate-B_6HX0Io.js";import{E as Ie}from"./upload-CY9ZjjH3.js";import"./progress-C9ZnX_fS.js";import"./isArrayLikeObject-j402kJv_.js";import"./vuedraggable.umd-DLnsjw3h.js";import"./arrays-6TrVLtTe.js";import"./index-DOwINDGR.js";import"./index-E9Z4TjLA.js";import"./cloneDeep-Zuu3-0H5.js";const De={__name:"user-search",emits:["search"],setup(C,{emit:U}){const V=U,[d,f]=q({username:"",nickname:"",sex:void 0}),_=()=>{V("search",{...d})},p=()=>{f(),_()};return(n,u)=>{const k=T,x=j,v=A,w=W,c=O,t=J,e=z,a=H;return h(),$(a,{"body-style":{paddingBottom:"2px"}},{default:o(()=>[l(e,{"label-width":"72px",onKeyup:X(_,["enter"]),onSubmit:u[3]||(u[3]=P(()=>{},["prevent"]))},{default:o(()=>[l(t,{gutter:8},{default:o(()=>[l(v,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(x,{label:"用户账号"},{default:o(()=>[l(k,{clearable:"",modelValue:r(d).username,"onUpdate:modelValue":u[0]||(u[0]=s=>r(d).username=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(v,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(x,{label:"用户名"},{default:o(()=>[l(k,{clearable:"",modelValue:r(d).nickname,"onUpdate:modelValue":u[1]||(u[1]=s=>r(d).nickname=s),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(v,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(x,{label:"性别"},{default:o(()=>[l(w,{code:"sex",modelValue:r(d).sex,"onUpdate:modelValue":u[2]||(u[2]=s=>r(d).sex=s),placeholder:"请选择"},null,8,["modelValue"])]),_:1})]),_:1}),l(v,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(x,{"label-width":"16px"},{default:o(()=>[l(c,{type:"primary",onClick:_},{default:o(()=>u[4]||(u[4]=[b("查询")])),_:1}),l(c,{onClick:p},{default:o(()=>u[5]||(u[5]=[b("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},Me={__name:"user-edit",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(C,{emit:U}){const V=U,d=C,f=y(!1),_=y(!1),p=y(null),[n,u,k]=q({userId:void 0,username:"",nickname:"",sex:void 0,roles:[],email:"",phone:"",password:"",introduction:"",birthday:""}),x=Z({username:[{required:!0,message:"请输入用户账号",type:"string",trigger:"blur"},{min:4,message:"账号长度最少为4位",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(c,t,e)=>{var a;if(f.value){e();return}xe("username",t,(a=d.data)==null?void 0:a.userId).then(()=>{e(new Error("账号已经存在"))}).catch(()=>{e()})}}],nickname:[{required:!0,message:"请输入用户名",type:"string",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",type:"string",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",type:"array",trigger:"blur"}],email:[{pattern:Ce,message:"邮箱格式不正确",type:"string",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",type:"string",trigger:"blur"},{type:"string",trigger:"blur",validator:(c,t,e)=>{if(f.value||/^[\S]{5,18}$/.test(t))return e();e(new Error("密码必须为5-18位非空白字符"))}}],phone:[{required:!0,message:"请输入手机号",type:"string",trigger:"blur"},{pattern:$e,message:"手机号格式不正确",type:"string",trigger:"blur"}]}),v=()=>{var c,t;(t=(c=p.value)==null?void 0:c.validate)==null||t.call(c,e=>{if(!e)return;_.value=!0,(f.value?ye:Ve)(n).then(s=>{_.value=!1,g.success(s),w(!1),V("done")}).catch(s=>{_.value=!1,g.error(s.message)})})},w=c=>{V("update:modelValue",c)};return ee(()=>d.modelValue,c=>{var t,e;c?d.data?(k({...d.data,password:""}),f.value=!0):f.value=!1:(u(),(e=(t=p.value)==null?void 0:t.clearValidate)==null||e.call(t))}),(c,t)=>{const e=T,a=j,s=W,I=A,B=be,S=J,D=z,M=O,F=Y;return h(),$(F,{form:"",width:640,"model-value":C.modelValue,title:f.value?"修改用户":"新建用户","onUpdate:modelValue":w},{footer:o(()=>[l(M,{onClick:t[10]||(t[10]=i=>w(!1))},{default:o(()=>t[11]||(t[11]=[b("取消")])),_:1}),l(M,{type:"primary",loading:_.value,onClick:v},{default:o(()=>t[12]||(t[12]=[b(" 保存 ")])),_:1},8,["loading"])]),default:o(()=>[l(D,{ref_key:"formRef",ref:p,model:r(n),rules:x,"label-width":"80px",onSubmit:t[9]||(t[9]=P(()=>{},["prevent"]))},{default:o(()=>[l(S,{gutter:16},{default:o(()=>[l(I,{sm:12,xs:24},{default:o(()=>[l(a,{label:"用户账号",prop:"username"},{default:o(()=>[l(e,{clearable:"",maxlength:20,modelValue:r(n).username,"onUpdate:modelValue":t[0]||(t[0]=i=>r(n).username=i),placeholder:"请输入用户账号",disabled:f.value},null,8,["modelValue","disabled"])]),_:1}),l(a,{label:"用户名",prop:"nickname"},{default:o(()=>[l(e,{clearable:"",maxlength:20,modelValue:r(n).nickname,"onUpdate:modelValue":t[1]||(t[1]=i=>r(n).nickname=i),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(a,{label:"性别",prop:"sex"},{default:o(()=>[l(s,{code:"sex",modelValue:r(n).sex,"onUpdate:modelValue":t[2]||(t[2]=i=>r(n).sex=i),placeholder:"请选择性别"},null,8,["modelValue"])]),_:1}),l(a,{label:"角色",prop:"roles"},{default:o(()=>[l(ve,{modelValue:r(n).roles,"onUpdate:modelValue":t[3]||(t[3]=i=>r(n).roles=i)},null,8,["modelValue"])]),_:1}),l(a,{label:"邮箱",prop:"email"},{default:o(()=>[l(e,{clearable:"",maxlength:100,modelValue:r(n).email,"onUpdate:modelValue":t[4]||(t[4]=i=>r(n).email=i),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),l(I,{sm:12,xs:24},{default:o(()=>[l(a,{label:"手机号",prop:"phone"},{default:o(()=>[l(e,{clearable:"",maxlength:11,modelValue:r(n).phone,"onUpdate:modelValue":t[5]||(t[5]=i=>r(n).phone=i),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(a,{label:"出生日期"},{default:o(()=>[l(B,{modelValue:r(n).birthday,"onUpdate:modelValue":t[6]||(t[6]=i=>r(n).birthday=i),"value-format":"YYYY-MM-DD",placeholder:"请选择出生日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1}),f.value?le("",!0):(h(),$(a,{key:0,label:"登录密码",prop:"password"},{default:o(()=>[l(e,{"show-password":"",type:"password",maxlength:20,modelValue:r(n).password,"onUpdate:modelValue":t[7]||(t[7]=i=>r(n).password=i),placeholder:"请输入登录密码"},null,8,["modelValue"])]),_:1})),l(a,{label:"个人简介"},{default:o(()=>[l(e,{type:"textarea",rows:3,maxlength:200,modelValue:r(n).introduction,"onUpdate:modelValue":t[8]||(t[8]=i=>r(n).introduction=i),placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}},Be={class:"user-import-upload"},Se={style:{display:"flex","align-items":"center","justify-content":"center"}},Fe={__name:"user-import",props:{modelValue:Boolean},emits:["done","update:modelValue"],setup(C,{emit:U}){const V=U,d=y(!1),f=p=>["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(p.type)?p.size/1024/1024>10?(g.error("大小不能超过 10MB"),!1):(d.value=!0,ke(p).then(n=>{d.value=!1,g.success(n),_(!1),V("done")}).catch(n=>{d.value=!1,g.error(n.message)}),!1):(g.error("只能选择 excel 文件"),!1),_=p=>{V("update:modelValue",p)};return(p,n)=>{const u=ne,k=Ie,x=G,v=Y,w=ge;return h(),$(v,{width:460,title:"导入用户","model-value":C.modelValue,"onUpdate:modelValue":_},{default:o(()=>[oe((h(),L("div",Be,[l(k,{drag:"",action:"",accept:".xls,.xlsx","show-upload-list":!1,"before-upload":f},{default:o(()=>[l(u,{type:"primary",icon:r(ae),"icon-props":{size:52},style:{"margin-bottom":"10px"}},null,8,["icon"]),l(u,{type:"placeholder"},{default:o(()=>n[0]||(n[0]=[b("将文件拖到此处, 或点击上传")])),_:1})]),_:1})])),[[w,d.value]]),R("div",Se,[n[2]||(n[2]=R("span",{style:{"padding-right":"8px"}},"只能上传 xls、xlsx 文件,",-1)),l(x,{type:"primary",underline:!1,href:"https://cdn.eleadmin.com/20200610/用户导入模板.xlsx",download:"用户导入模板.xlsx"},{default:o(()=>n[1]||(n[1]=[b(" 下载模板 ")])),_:1})])]),_:1},8,["model-value"])}}},Oe=te(Fe,[["__scopeId","data-v-832df708"]]),Re={name:"SystemUser"},sl=Object.assign(Re,{setup(C){const U=y(null),V=y([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"用户账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110,slot:"nickname"},{prop:"sexName",label:"性别",sortable:"custom",width:90,align:"center"},{prop:"phone",label:"手机号",sortable:"custom",minWidth:110},{columnKey:"roles",label:"角色",minWidth:110,slot:"roles"},{prop:"createTime",label:"创建时间",sortable:"custom",minWidth:110},{prop:"status",label:"状态",width:90,align:"center",sortable:"custom",slot:"status"},{columnKey:"action",label:"操作",width:200,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),d=y([]),f=y(null),_=y(!1),p=y(!1),n=({pages:t,where:e,orders:a})=>we({...e,...a,...t}),u=t=>{var e,a;d.value=[],(a=(e=U.value)==null?void 0:e.reload)==null||a.call(e,{page:1,where:t})},k=t=>{f.value=t!=null?t:null,_.value=!0},x=()=>{p.value=!0},v=t=>{const e=t==null?d.value:[t];if(!e.length){g.error("请至少选择一条数据");return}N.confirm("确定要删除“"+e.map(a=>a.nickname).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const a=g.loading("请求中..");Ue(e.map(s=>s.userId)).then(s=>{a.close(),g.success(s),u()}).catch(s=>{a.close(),g.error(s.message)})}).catch(()=>{})},w=t=>{N.prompt(`请输入用户"${t.nickname}"的新密码：`,"重置密码",{inputPattern:/^[\S]{5,18}$/,inputErrorMessage:"密码必须为5-18位非空白字符",draggable:!0}).then(({value:e})=>{const a=g.loading("请求中..");he(t.userId,e).then(s=>{a.close(),g.success(s)}).catch(s=>{a.close(),g.error(s.message)})}).catch(()=>{})},c=(t,e)=>{const a=t?0:1;Ee(e.userId,a).then(s=>{e.status=a,g.success(s)}).catch(s=>{g.error(s.message)})};return(t,e)=>{const a=O,s=G,I=se("router-link"),B=pe,S=ce,D=fe,M=_e,F=H,i=Q;return h(),$(i,null,{default:o(()=>[l(De,{onSearch:u}),l(F,{"body-style":{paddingTop:"8px"}},{default:o(()=>[l(M,{ref_key:"tableRef",ref:U,"row-key":"userId",columns:V.value,datasource:n,"show-overflow-tooltip":!0,selections:d.value,"onUpdate:selections":e[2]||(e[2]=m=>d.value=m),"highlight-current-row":!0,"export-config":{fileName:"用户数据"},"cache-key":"systemUserTable"},{toolbar:o(()=>[l(a,{type:"primary",class:"ele-btn-icon",icon:r(re),onClick:e[0]||(e[0]=m=>k())},{default:o(()=>e[5]||(e[5]=[b(" 新建 ")])),_:1},8,["icon"]),l(a,{type:"danger",class:"ele-btn-icon",icon:r(de),onClick:e[1]||(e[1]=m=>v())},{default:o(()=>e[6]||(e[6]=[b(" 删除 ")])),_:1},8,["icon"]),l(a,{class:"ele-btn-icon",icon:r(ue),onClick:x},{default:o(()=>e[7]||(e[7]=[b(" 导入 ")])),_:1},8,["icon"])]),nickname:o(({row:m})=>[l(I,{to:"/system/user/details/"+m.userId,style:{"text-decoration":"none"}},{default:o(()=>[l(s,{type:"primary",underline:!1},{default:o(()=>[b(K(m.nickname),1)]),_:2},1024)]),_:2},1032,["to"])]),roles:o(({row:m})=>[(h(!0),L(ie,null,me(m.roles,E=>(h(),$(B,{key:E.roleId,size:"small","disable-transitions":!0,style:{"margin-right":"6px"}},{default:o(()=>[b(K(E.roleName),1)]),_:2},1024))),128))]),status:o(({row:m})=>[l(S,{size:"small","model-value":m.status===0,onChange:E=>c(E,m)},null,8,["model-value","onChange"])]),action:o(({row:m})=>[l(s,{type:"primary",underline:!1,onClick:E=>k(m)},{default:o(()=>e[8]||(e[8]=[b(" 修改 ")])),_:2},1032,["onClick"]),l(D,{direction:"vertical"}),l(s,{type:"primary",underline:!1,onClick:E=>w(m)},{default:o(()=>e[9]||(e[9]=[b(" 重置密码 ")])),_:2},1032,["onClick"]),l(D,{direction:"vertical"}),l(s,{type:"danger",underline:!1,onClick:E=>v(m)},{default:o(()=>e[10]||(e[10]=[b(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["columns","selections"])]),_:1}),l(Me,{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=m=>_.value=m),data:f.value,onDone:u},null,8,["modelValue","data"]),l(Oe,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=m=>p.value=m),onDone:u},null,8,["modelValue"])]),_:1})}}});export{sl as default};
