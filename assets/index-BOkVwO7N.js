import{i as L}from"./index-CkGVv88Q.js";import{s as R,fp as M,_ as A,fj as D,aM as F,r as u,a as Q,J as G,fq as J,m as k,b as a,w as r,aN as W,E as _,u as s,o as f,e as c,d as C,t as v,c as X,ak as Y,fr as Z,bu as ee,a8 as oe,cK as ae,aG as te,dT as se,h as le,aI as ne,aH as re,aP as ie,aC as ce,aL as de,g as ue,p as me,l as pe}from"./index-C4BxmZrN.js";import{i as ge}from"./index-BfM-I2FB.js";import{i as _e}from"./index-CJjyc4ww.js";async function fe(l){var g;const o=await R.post("/login",l);return o.data.code===0?(M((g=o.data.data)==null?void 0:g.access_token,l.remember),o.data.message):Promise.reject(new Error(o.data.message))}async function ve(){const l=await R.get("/captcha");return l.data.code===0&&l.data.data?l.data.data:Promise.reject(new Error(l.data.message))}const he=l=>(me("data-v-631424b8"),l=l(),pe(),l),be={class:"login-wrapper"},xe=he(()=>c("div",{class:"login-cover"},[c("h1",{class:"login-title"},"EleAdmin Plus"),c("h4",{class:"login-subtitle"},"界面美观组件丰富的中后台前端解决方案")],-1)),we={class:"login-body"},ye={class:"login-captcha-group"},Ve=["src"],ke={key:1,class:"login-qrcode-group"},Ce={__name:"index",setup(l){const{t:o}=D.useI18n(),{currentRoute:g}=W(),{goHomeRoute:U,cleanPageTabs:z}=F(),h=u(1),b=u(),x=u(!1),n=Q({tenantId:4,username:"admin",password:"admin",code:"",remember:!0}),B=G(()=>({username:[{required:!0,message:o("login.username"),type:"string",trigger:"blur"}],password:[{required:!0,message:o("login.password"),type:"string",trigger:"blur"}],code:[{required:!0,message:o("login.code"),type:"string",trigger:"blur"}]})),w=u(""),E=u(""),I=u(""),q=()=>{var t,e;(e=(t=b.value)==null?void 0:t.validate)==null||e.call(t,d=>{if(!d)return!1;if(n.code.toLowerCase()!==E.value){_.error("验证码错误");return}x.value=!0,fe(n).then(m=>{_.success(m),z(),P()}).catch(m=>{x.value=!1,_.error(m.message),y()})})},y=()=>{ve().then(t=>{var e,d;w.value=t.base64,E.value=t.text,n.code=t.text,(d=(e=b.value)==null?void 0:e.clearValidate)==null||d.call(e)}).catch(t=>{_.error(t.message)})},T=()=>{I.value=`https://api.eleadmin.com/v2/auth/login?code=${Date.now()}`},N=t=>{t===2&&T()},P=()=>{const{query:t}=s(g);U(t.from)};return J()?P():y(),(t,e)=>{const d=le,m=ge,V=ne,p=re,S=ie,$=ce,j=de,O=_e,H=ue,K=L;return f(),k("div",be,[a(K,{shadow:"always",class:"login-card"},{default:r(()=>[xe,c("div",we,[a(d,{type:"heading",style:{"font-size":"24px","margin-bottom":"18px"}},{default:r(()=>[C(v(s(o)("login.title")),1)]),_:1}),a(m,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=i=>h.value=i),items:[{label:s(o)("login.passwordType"),value:1},{label:s(o)("login.qrcodeType"),value:2}],style:{"margin-bottom":"18px"},onChange:N},null,8,["modelValue","items"]),h.value==1?(f(),X(j,{key:0,ref_key:"formRef",ref:b,size:"large",model:n,rules:B.value,onKeyup:ae(q,["enter"]),onSubmit:e[5]||(e[5]=te(()=>{},["prevent"]))},{default:r(()=>[a(p,{prop:"username"},{default:r(()=>[a(V,{clearable:"",modelValue:n.username,"onUpdate:modelValue":e[1]||(e[1]=i=>n.username=i),placeholder:s(o)("login.username"),"prefix-icon":s(Y)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),a(p,{prop:"password"},{default:r(()=>[a(V,{"show-password":"",modelValue:n.password,"onUpdate:modelValue":e[2]||(e[2]=i=>n.password=i),placeholder:s(o)("login.password"),"prefix-icon":s(Z)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),a(p,{prop:"code"},{default:r(()=>[c("div",ye,[a(V,{clearable:"",modelValue:n.code,"onUpdate:modelValue":e[3]||(e[3]=i=>n.code=i),placeholder:s(o)("login.code"),"prefix-icon":s(ee)},null,8,["modelValue","placeholder","prefix-icon"]),c("div",{class:"login-captcha",onClick:y},[w.value?(f(),k("img",{key:0,src:w.value},null,8,Ve)):oe("",!0)])])]),_:1}),a(p,null,{default:r(()=>[a(S,{modelValue:n.remember,"onUpdate:modelValue":e[4]||(e[4]=i=>n.remember=i)},{default:r(()=>[C(v(s(o)("login.remember")),1)]),_:1},8,["modelValue"])]),_:1}),a(p,null,{default:r(()=>[a($,{size:"large",type:"primary",loading:x.value,style:{width:"100%"},onClick:q},{default:r(()=>[C(v(s(o)("login.login")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])):(f(),k("div",ke,[a(O,{size:180,margin:2,value:I.value,class:"login-qrcode"},null,8,["value"]),c("div",{style:{"margin-top":"16px",cursor:"pointer"},onClick:T},[a(H,{size:15,style:{"vertical-align":"-2px","margin-right":"6px"}},{default:r(()=>[a(s(se))]),_:1}),c("span",null,v(s(o)("login.refreshQrcode")),1)])]))])]),_:1})])}}},Pe=A(Ce,[["__scopeId","data-v-631424b8"]]);export{Pe as default};
