var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,i=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&o(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&o(e,a,t[a]);return e},u=(e,l)=>t(e,a(l)),n=(e,t,a)=>new Promise(((l,s)=>{var r=e=>{try{i(a.next(e))}catch(t){s(t)}},o=e=>{try{i(a.throw(e))}catch(t){s(t)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,o);i((a=a.apply(e,t)).next())}));import{b as c,k as d,A as p,j as m,_ as v}from"./index-D_qZw2oD.js";/* empty css                  *//* empty css                    */import{_ as f}from"./Editor.vue_vue_type_style_index_0_lang-BAe1okNP.js";/* empty css               */import{P as h,d as y,a9 as g,a3 as _,r as b,f as j,c as w,o as x,e as A,b as P,w as $,aO as E,C as O,m as T,u as V,as as k,F as C,A as U,L as q,at as S,aR as D,a0 as M,aZ as z,y as L,a_ as N,aq as R,$ as Y,M as I,x as J,I as W}from"./vendor-Dakx4FZ3.js";import{a as B}from"./index-BhTbhqQQ.js";import{E as F}from"./emojo-Ben6gd8J.js";const G=B.create({timeout:15e3,baseURL:"https://xxxx.com",withCredentials:!0,transformRequest:[e=>JSON.stringify(e)],validateStatus:e=>e>=200&&e<300,headers:{get:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},post:{"Content-Type":"application/json;charset=utf-8"}},transformResponse:[e=>{try{return"string"==typeof e&&e.startsWith("{")?JSON.parse(e):e}catch(t){return e}}]});function Z(e){return n(this,null,(function*(){var t,a;"POST"!==(null==(t=e.method)?void 0:t.toUpperCase())&&"PUT"!==(null==(a=e.method)?void 0:a.toUpperCase())||e.params&&!e.data&&(e.data=e.params,e.params=void 0);try{return(yield G.request(i({},e))).data}catch(l){return B.isAxiosError(l),Promise.reject(l)}}))}G.interceptors.request.use((e=>{const{accessToken:t}=c();return t&&e.headers.set({"Content-Type":"application/json",Authorization:t}),e}),(e=>(h.error(`服务器异常！ ${F[500]}`),Promise.reject(e)))),G.interceptors.response.use((e=>e),(e=>{var t;if(B.isCancel(e));else{const a=null==(t=e.response)?void 0:t.data.message;h.error(a?`${a} ${F[500]}`:`请求超时或服务器异常！${F[500]}`)}return Promise.reject(e)}));const H={get:e=>Z(u(i({},e),{method:"GET"})),post:e=>Z(u(i({},e),{method:"POST"})),put:e=>Z(u(i({},e),{method:"PUT"})),del:e=>Z(u(i({},e),{method:"DELETE"}))};class K{static getArticleList(e){const{page:t,size:a,searchVal:l,year:s}=e;return H.get({url:`/api/articles/${t}/${a}?title=${l}&year=${s}`})}static getArticleTypes(e){return H.get({url:"/api/articles/types",params:e})}static getArticleDetail(e){return H.get({url:`/api/articles/${e}`})}static addArticle(e){return H.post({url:"/api/articles/",data:e})}static editArticle(e,t){return H.put({url:`/api/articles/${e}`,data:t})}}var Q=(e=>(e[e.Add=0]="Add",e[e.Edit=1]="Edit",e))(Q||{});const X={class:"article-edit"},ee={class:"editor-wrap"},te={class:"form-wrap"},ae={class:"el-top upload-container"},le={key:0,class:"upload-placeholder"},se=["src"],re={style:{display:"flex","justify-content":"flex-end"}},oe=v(y({__name:"ArticlePublish",setup(e){const t=g(),a=_(),l=c();let{accessToken:s}=l;const r={Authorization:s};let o=Q.Add;const i=b(""),u=b(),v=b(),y=b(""),G=b(""),Z=b(""),H=b(!0);j((()=>{we(),ne(),oe()}));const oe=()=>{const{id:e}=t.query;o=e?Q.Edit:Q.Add,o===Q.Edit&&e?ie(Number(e)):ue()},ie=e=>{ce=e,de()},ue=()=>{G.value=me(d().value)},ne=()=>n(this,null,(function*(){try{const e=yield B.get("https://www.qiniu.lingchen.kim/classify.json");e.data.code===p.success&&(v.value=e.data.data)}catch(e){}}));let ce=0;const de=()=>n(this,null,(function*(){const e=yield B.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.data.code===p.success){let{title:t,blog_class:a,html_content:l}=e.data.data;i.value=t,u.value=Number(a),y.value=l}})),pe=()=>{o===Q.Edit?ye():he()},me=e=>m(e,"YYYY-MM-DD").value,ve=()=>i.value?u.value?"<p><br></p>"===y.value?(h.error("请输入文章内容"),!1):!!Z.value||(h.error("请上传图片"),!1):(h.error("请选择文章类型"),!1):(h.error("请输入文章标题"),!1),fe=()=>({title:i.value,html_content:y.value,home_img:Z.value,blog_class:u.value,create_time:G.value}),he=()=>n(this,null,(function*(){try{if(!ve())return;y.value=ge(y.value);const e=fe();(yield K.addArticle(e)).code===p.success&&(h.success(`发布成功 ${F[200]}`),je())}catch(e){}})),ye=()=>n(this,null,(function*(){try{if(!ve())return;y.value=ge(y.value);const e=fe();(yield K.editArticle(ce,e)).code===p.success&&(h.success(`修改成功 ${F[200]}`),je())}catch(e){}})),ge=e=>e.replace(/(\s*)<\/code>/g,"</code>"),_e=e=>{Z.value=e.data.url,h.success(`图片上传成功 ${F[200]}`)},be=()=>{h.error(`图片上传失败 ${F[500]}`)},je=()=>{setTimeout((()=>{a.go(-1)}),800)},we=()=>{window.scrollTo({top:0})},xe=e=>{const t=e.type.startsWith("image/"),a=e.size/1024/1024<2;return t?!!a||(h.error("图片大小不能超过 2MB!"),!1):(h.error("只能上传图片文件!"),!1)};return(e,t)=>{const a=O,l=E,s=S,n=k,c=D,d=f,p=L,m=z,h=M,g=R,_=Y,b=W;return x(),w("div",X,[A("div",null,[A("div",ee,[P(c,{gutter:10},{default:$((()=>[P(l,{span:18},{default:$((()=>[P(a,{modelValue:V(i),"onUpdate:modelValue":t[0]||(t[0]=e=>T(i)?i.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])])),_:1}),P(l,{span:6},{default:$((()=>[P(n,{modelValue:V(u),"onUpdate:modelValue":t[1]||(t[1]=e=>T(u)?u.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:$((()=>[(x(!0),w(C,null,U(V(v),(e=>(x(),q(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),P(d,{class:"el-top",modelValue:V(y),"onUpdate:modelValue":t[2]||(t[2]=e=>T(y)?y.value=e:null)},null,8,["modelValue"]),A("div",te,[t[6]||(t[6]=A("h2",null,"发布设置",-1)),P(_,null,{default:$((()=>[P(h,{label:"封面"},{default:$((()=>[A("div",ae,[P(m,{class:"cover-uploader",action:"https://xxxx.com/api/common/upload",headers:r,"show-file-list":!1,"on-success":_e,"on-error":be,"before-upload":xe},{default:$((()=>[V(Z)?(x(),w("img",{key:1,src:V(Z),class:"cover-image"},null,8,se)):(x(),w("div",le,[P(p,{class:"upload-icon"},{default:$((()=>[P(V(N))])),_:1}),t[4]||(t[4]=A("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1}),t[5]||(t[5]=A("div",{class:"el-upload__tip"},"建议尺寸 16:9，jpg/png 格式",-1))])])),_:1}),P(h,{label:"可见"},{default:$((()=>[P(g,{modelValue:V(H),"onUpdate:modelValue":t[3]||(t[3]=e=>T(H)?H.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1}),A("div",re,[P(b,{type:"primary",onClick:pe,style:{width:"100px"}},{default:$((()=>[I(J(V(o)===V(Q).Edit?"保存":"发布"),1)])),_:1})])])])])])}}}),[["__scopeId","data-v-513fa703"]]);export{oe as default};
