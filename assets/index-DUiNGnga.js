import{i as M}from"./index-p1XoTQj1.js";import{b4 as U,o as E,c as w,w as o,b as l,cM as C,aF as K,u as m,e as u,aH as N,aG as $,aB as F,aK as D,r as k,b8 as I,at as S,t as T,E as i,aV as j,ax as O,j as R}from"./index-BF2fBoPb.js";import{i as V}from"./index-Cjr4ibGp.js";import{i as G}from"./index-DG03PXF-.js";import"./index-CcYpqHDV.js";import"./index-B-b3I1wI.js";import"./index-BnIMXyIx.js";import"./virtual-list-B6G0p9cv.js";import"./index-BWYZqqjh.js";import"./index-DuliLu7F.js";import{E as W}from"./upload-CY9ZjjH3.js";import"./progress-C9ZnX_fS.js";import{E as z,a as H}from"./col-DirwGu8S.js";import{p as L,r as P,u as q}from"./index-BoWW9VGZ.js";import"./isArrayLikeObject-j402kJv_.js";import"./vuedraggable.umd-DLnsjw3h.js";import"./cloneDeep-Zuu3-0H5.js";const A={__name:"file-search",emits:["search"],setup(B,{emit:f}){const g=f,[a,b]=U({name:"",path:"",createNickname:""}),d=()=>{g("search",{...a})},_=()=>{b(),d()};return(v,e)=>{const t=N,n=$,r=z,c=F,h=H,y=D,x=V;return E(),w(x,{"body-style":{paddingBottom:"2px"}},{default:o(()=>[l(y,{"label-width":"72px",onKeyup:C(d,["enter"]),onSubmit:e[3]||(e[3]=K(()=>{},["prevent"]))},{default:o(()=>[l(h,{gutter:8},{default:o(()=>[l(r,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(n,{label:"文件名称"},{default:o(()=>[l(t,{clearable:"",modelValue:m(a).name,"onUpdate:modelValue":e[0]||(e[0]=p=>m(a).name=p),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(n,{label:"文件路径"},{default:o(()=>[l(t,{clearable:"",modelValue:m(a).path,"onUpdate:modelValue":e[1]||(e[1]=p=>m(a).path=p),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(n,{label:"上传人"},{default:o(()=>[l(t,{clearable:"",modelValue:m(a).createNickname,"onUpdate:modelValue":e[2]||(e[2]=p=>m(a).createNickname=p),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),l(r,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[l(n,{"label-width":"16px"},{default:o(()=>[l(c,{type:"primary",onClick:d},{default:o(()=>e[4]||(e[4]=[u("查询")])),_:1}),l(c,{onClick:_},{default:o(()=>e[5]||(e[5]=[u("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},J={name:"SystemFile"},fe=Object.assign(J,{setup(B){const f=k(null),g=k([{type:"selection",columnKey:"selection",width:50,align:"center",fixed:"left"},{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"name",label:"文件名称",sortable:"custom",minWidth:120},{prop:"path",label:"文件路径",sortable:"custom",minWidth:120,slot:"path"},{prop:"length",label:"文件大小",width:120,align:"center",sortable:"custom",formatter:e=>e.length<1024?e.length+"B":e.length<1024*1024?(e.length/1024).toFixed(1)+"KB":e.length<1024*1024*1024?(e.length/1024/1024).toFixed(1)+"M":(e.length/1024/1024/1024).toFixed(1)+"G"},{prop:"createNickname",label:"上传人",width:120,align:"center",sortable:"custom"},{prop:"createTime",label:"上传时间",width:160,align:"center",sortable:"custom"},{columnKey:"action",label:"操作",width:120,align:"center",slot:"action",hideInPrint:!0,hideInExport:!0}]),a=k([]),b=({pages:e,where:t,orders:n})=>L({...t,...n,...e}),d=e=>{var t,n;a.value=[],(n=(t=f.value)==null?void 0:t.reload)==null||n.call(t,{page:1,where:e})},_=e=>{const t=e==null?a.value:[e];if(!t.length){i.error("请至少选择一条数据");return}j.confirm("确定要删除“"+t.map(n=>n.name).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const n=i.loading("请求中..");P(t.map(r=>r.id)).then(r=>{n.close(),i.success(r),d()}).catch(r=>{n.close(),i.error(r.message)})}).catch(()=>{})},v=e=>{if(e.size/1024/1024>100)return i.error("大小不能超过 100MB"),!1;const t=i.loading({message:"上传中..",mask:!0});return q(e).then(()=>{t.close(),i.success("上传成功"),d()}).catch(n=>{t.close(),i.error(n.message)}),!1};return(e,t)=>{const n=F,r=W,c=O,h=R,y=G,x=V,p=M;return E(),w(p,null,{default:o(()=>[l(A,{onSearch:d}),l(x,{"body-style":{paddingTop:"8px"}},{default:o(()=>[l(y,{ref_key:"tableRef",ref:f,"row-key":"id",columns:g.value,datasource:b,"show-overflow-tooltip":!0,selections:a.value,"onUpdate:selections":t[1]||(t[1]=s=>a.value=s),"highlight-current-row":!0,"export-config":{fileName:"文件数据"},"cache-key":"systemFileTable"},{toolbar:o(()=>[l(r,{action:"","show-upload-list":!1,"before-upload":v,style:{display:"inline-block","vertical-align":"middle"}},{default:o(()=>[l(n,{type:"primary",class:"ele-btn-icon",icon:m(I)},{default:o(()=>t[2]||(t[2]=[u(" 上传 ")])),_:1},8,["icon"])]),_:1}),l(n,{type:"danger",class:"ele-btn-icon",icon:m(S),style:{"margin-left":"12px"},onClick:t[0]||(t[0]=s=>_())},{default:o(()=>t[3]||(t[3]=[u(" 删除 ")])),_:1},8,["icon"])]),path:o(({row:s})=>[l(c,{type:"primary",href:s.url,target:"_blank",underline:!1},{default:o(()=>[u(T(s.path),1)]),_:2},1032,["href"])]),action:o(({row:s})=>[l(c,{type:"primary",underline:!1,href:s.downloadUrl,target:"_blank"},{default:o(()=>t[4]||(t[4]=[u(" 下载 ")])),_:2},1032,["href"]),l(h,{direction:"vertical"}),l(c,{type:"danger",underline:!1,onClick:Q=>_(s)},{default:o(()=>t[5]||(t[5]=[u(" 删除 ")])),_:2},1032,["onClick"])]),_:1},8,["columns","selections"])]),_:1})]),_:1})}}});export{fe as default};
