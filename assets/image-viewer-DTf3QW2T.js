import{a3 as me,bQ as H,cg as pe,ch as ce,L as se,c$ as ve,eA as Ie,eB as _e,cv as ge,a1 as ye,eC as Le,r as b,eD as ze,M as Se,J as g,R as ue,W as we,U as be,o as w,c as de,b as u,w as L,e as y,a5 as d,u as e,a6 as fe,aG as Ce,a8 as z,g as N,cn as Ee,m as E,F as te,cR as Ne,cS as xe,eE as Oe,et as Te,a7 as $e,eF as Ae,eG as Re,n as Ve,bU as Be,bV as Me,a2 as ae,bW as Ye,e3 as De,a9 as he,bZ as A,bT as R,eH as Fe,aa as ke,cu as Pe,eI as Xe,b_ as X,t as He,a$ as Ke,c0 as We,c1 as je,eJ as Ge,eK as Ze,eL as Je}from"./index-C4BxmZrN.js";import{t as ie}from"./throttle-BbZ3x3xu.js";const Ue=me({urlList:{type:H(Array),default:()=>pe([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:H(String)}}),qe={close:()=>!0,switch:m=>ce(m),rotate:m=>ce(m)},Qe=["src","crossorigin"],ea=se({name:"ElImageViewer"}),aa=se({...ea,props:Ue,emits:qe,setup(m,{expose:x,emit:f}){var V;const c=m,p={CONTAIN:{name:"contain",icon:ve(Ie)},ORIGINAL:{name:"original",icon:ve(_e)}},{t:ne}=ge(),o=ye("image-viewer"),{nextZIndex:B}=Le(),S=b(),C=b([]),O=ze(),h=b(!0),r=b(c.initialIndex),T=Se(p.CONTAIN),n=b({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),M=b((V=c.zIndex)!=null?V:B()),le=g(()=>{const{urlList:t}=c;return t.length<=1}),K=g(()=>r.value===0),W=g(()=>r.value===c.urlList.length-1),Y=g(()=>c.urlList[r.value]),oe=g(()=>[o.e("btn"),o.e("prev"),o.is("disabled",!c.infinite&&K.value)]),j=g(()=>[o.e("btn"),o.e("next"),o.is("disabled",!c.infinite&&W.value)]),D=g(()=>{const{scale:t,deg:s,offsetX:l,offsetY:k,enableTransition:_}=n.value;let v=l/t,I=k/t;switch(s%360){case 90:case-270:[v,I]=[I,-v];break;case 180:case-180:[v,I]=[-v,-I];break;case 270:case-90:[v,I]=[-I,v];break}const $={transform:`scale(${t}) rotate(${s}deg) translate(${v}px, ${I}px)`,transition:_?"transform .3s":""};return T.value.name===p.CONTAIN.name&&($.maxWidth=$.maxHeight="100%"),$});function F(){G(),f("close")}function re(){const t=ie(l=>{switch(l.code){case A.esc:c.closeOnPressEscape&&F();break;case A.space:Q();break;case A.left:ee();break;case A.up:i("zoomIn");break;case A.right:a();break;case A.down:i("zoomOut");break}}),s=ie(l=>{const k=l.deltaY||l.deltaX;i(k<0?"zoomIn":"zoomOut",{zoomRate:c.zoomRate,enableTransition:!1})});O.run(()=>{R(document,"keydown",t),R(document,"wheel",s)})}function G(){O.stop()}function Z(){h.value=!1}function J(t){h.value=!1,t.target.alt=ne("el.image.error")}function U(t){if(h.value||t.button!==0||!S.value)return;n.value.enableTransition=!1;const{offsetX:s,offsetY:l}=n.value,k=t.pageX,_=t.pageY,v=ie($=>{n.value={...n.value,offsetX:s+$.pageX-k,offsetY:l+$.pageY-_}}),I=R(document,"mousemove",v);R(document,"mouseup",()=>{I()}),t.preventDefault()}function q(){n.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Q(){if(h.value)return;const t=Fe(p),s=Object.values(p),l=T.value.name,_=(s.findIndex(v=>v.name===l)+1)%t.length;T.value=p[t[_]],q()}function P(t){const s=c.urlList.length;r.value=(t+s)%s}function ee(){K.value&&!c.infinite||P(r.value-1)}function a(){W.value&&!c.infinite||P(r.value+1)}function i(t,s={}){if(h.value)return;const{minScale:l,maxScale:k}=c,{zoomRate:_,rotateDeg:v,enableTransition:I}={zoomRate:c.zoomRate,rotateDeg:90,enableTransition:!0,...s};switch(t){case"zoomOut":n.value.scale>l&&(n.value.scale=Number.parseFloat((n.value.scale/_).toFixed(3)));break;case"zoomIn":n.value.scale<k&&(n.value.scale=Number.parseFloat((n.value.scale*_).toFixed(3)));break;case"clockwise":n.value.deg+=v,f("rotate",n.value.deg);break;case"anticlockwise":n.value.deg-=v,f("rotate",n.value.deg);break}n.value.enableTransition=I}return ue(Y,()=>{we(()=>{const t=C.value[0];t!=null&&t.complete||(h.value=!0)})}),ue(r,t=>{q(),f("switch",t)}),be(()=>{var t,s;re(),(s=(t=S.value)==null?void 0:t.focus)==null||s.call(t)}),x({setActiveItem:P}),(t,s)=>(w(),de(De,{to:"body",disabled:!t.teleported},[u(Ye,{name:"viewer-fade",appear:""},{default:L(()=>[y("div",{ref_key:"wrapper",ref:S,tabindex:-1,class:d(e(o).e("wrapper")),style:fe({zIndex:M.value})},[y("div",{class:d(e(o).e("mask")),onClick:s[0]||(s[0]=Ce(l=>t.hideOnClickModal&&F(),["self"]))},null,2),z(" CLOSE "),y("span",{class:d([e(o).e("btn"),e(o).e("close")]),onClick:F},[u(e(N),null,{default:L(()=>[u(e(Ee))]),_:1})],2),z(" ARROW "),e(le)?z("v-if",!0):(w(),E(te,{key:0},[y("span",{class:d(e(oe)),onClick:ee},[u(e(N),null,{default:L(()=>[u(e(Ne))]),_:1})],2),y("span",{class:d(e(j)),onClick:a},[u(e(N),null,{default:L(()=>[u(e(xe))]),_:1})],2)],64)),z(" ACTIONS "),y("div",{class:d([e(o).e("btn"),e(o).e("actions")])},[y("div",{class:d(e(o).e("actions__inner"))},[u(e(N),{onClick:s[1]||(s[1]=l=>i("zoomOut"))},{default:L(()=>[u(e(Oe))]),_:1}),u(e(N),{onClick:s[2]||(s[2]=l=>i("zoomIn"))},{default:L(()=>[u(e(Te))]),_:1}),y("i",{class:d(e(o).e("actions__divider"))},null,2),u(e(N),{onClick:Q},{default:L(()=>[(w(),de($e(e(T).icon)))]),_:1}),y("i",{class:d(e(o).e("actions__divider"))},null,2),u(e(N),{onClick:s[3]||(s[3]=l=>i("anticlockwise"))},{default:L(()=>[u(e(Ae))]),_:1}),u(e(N),{onClick:s[4]||(s[4]=l=>i("clockwise"))},{default:L(()=>[u(e(Re))]),_:1})],2)],2),z(" CANVAS "),y("div",{class:d(e(o).e("canvas"))},[(w(!0),E(te,null,Ve(t.urlList,(l,k)=>Be((w(),E("img",{ref_for:!0,ref:_=>C.value[k]=_,key:l,src:l,style:fe(e(D)),class:d(e(o).e("img")),crossorigin:t.crossorigin,onLoad:Z,onError:J,onMousedown:U},null,46,Qe)),[[Me,k===r.value]])),128))],2),ae(t.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var ta=he(aa,[["__file","image-viewer.vue"]]);const sa=ke(ta),na=me({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:H([String,Object])},previewSrcList:{type:H(Array),default:()=>pe([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:H(String)}}),la={load:m=>m instanceof Event,error:m=>m instanceof Event,switch:m=>ce(m),close:()=>!0,show:()=>!0},oa=["src","loading","crossorigin"],ra={key:0},ia=se({name:"ElImage",inheritAttrs:!1}),ca=se({...ia,props:na,emits:la,setup(m,{emit:x}){const f=m;let V="";const{t:c}=ge(),p=ye("image"),ne=Pe(),o=Xe(),B=b(),S=b(!1),C=b(!0),O=b(!1),h=b(),r=b(),T=X&&"loading"in HTMLImageElement.prototype;let n,M;const le=g(()=>[p.e("inner"),Y.value&&p.e("preview"),C.value&&p.is("loading")]),K=g(()=>ne.style),W=g(()=>{const{fit:a}=f;return X&&a?{objectFit:a}:{}}),Y=g(()=>{const{previewSrcList:a}=f;return Array.isArray(a)&&a.length>0}),oe=g(()=>{const{previewSrcList:a,initialIndex:i}=f;let t=i;return i>a.length-1&&(t=0),t}),j=g(()=>f.loading==="eager"?!1:!T&&f.loading==="lazy"||f.lazy),D=()=>{X&&(C.value=!0,S.value=!1,B.value=f.src)};function F(a){C.value=!1,S.value=!1,x("load",a)}function re(a){C.value=!1,S.value=!0,x("error",a)}function G(){Ze(h.value,r.value)&&(D(),U())}const Z=Je(G,200,!0);async function J(){var a;if(!X)return;await we();const{scrollContainer:i}=f;We(i)?r.value=i:je(i)&&i!==""?r.value=(a=document.querySelector(i))!=null?a:void 0:h.value&&(r.value=Ge(h.value)),r.value&&(n=R(r,"scroll",Z),setTimeout(()=>G(),100))}function U(){!X||!r.value||!Z||(n==null||n(),r.value=void 0)}function q(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}function Q(){Y.value&&(M=R("wheel",q,{passive:!1}),V=document.body.style.overflow,document.body.style.overflow="hidden",O.value=!0,x("show"))}function P(){M==null||M(),document.body.style.overflow=V,O.value=!1,x("close")}function ee(a){x("switch",a)}return ue(()=>f.src,()=>{j.value?(C.value=!0,S.value=!1,U(),J()):D()}),be(()=>{j.value?J():D()}),(a,i)=>(w(),E("div",{ref_key:"container",ref:h,class:d([e(p).b(),a.$attrs.class]),style:fe(e(K))},[S.value?ae(a.$slots,"error",{key:0},()=>[y("div",{class:d(e(p).e("error"))},He(e(c)("el.image.error")),3)]):(w(),E(te,{key:1},[B.value!==void 0?(w(),E("img",Ke({key:0},e(o),{src:B.value,loading:a.loading,style:e(W),class:e(le),crossorigin:a.crossorigin,onClick:Q,onLoad:F,onError:re}),null,16,oa)):z("v-if",!0),C.value?(w(),E("div",{key:1,class:d(e(p).e("wrapper"))},[ae(a.$slots,"placeholder",{},()=>[y("div",{class:d(e(p).e("placeholder"))},null,2)])],2)):z("v-if",!0)],64)),e(Y)?(w(),E(te,{key:2},[O.value?(w(),de(e(sa),{key:0,"z-index":a.zIndex,"initial-index":e(oe),infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"url-list":a.previewSrcList,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:P,onSwitch:ee},{default:L(()=>[a.$slots.viewer?(w(),E("div",ra,[ae(a.$slots,"viewer")])):z("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):z("v-if",!0)],64)):z("v-if",!0)],6))}});var ua=he(ca,[["__file","image.vue"]]);const va=ke(ua);export{va as E};
