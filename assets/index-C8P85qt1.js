import{J,r as C,H as T,dQ as Y,$ as Z,ai as h,o as b,c as D,b as f,w as I,l as U,a4 as x,a5 as W,a$ as L,a1 as B,a7 as P,bV as ee,ee as te,f0 as le,fq as oe,as as ae,fr as ne,fs as M,g as z,d as E,t as j,aF as F,bD as ie,b0 as se,O as N,I as re,aU as ue,m as de,b1 as me,b2 as pe,dV as ce,E as R,_ as fe,u as ge,h as ve}from"./index-BF2fBoPb.js";import{i as ye,a as he,E as be}from"./image-viewer-NlVDGd40.js";import{E as Ve}from"./upload-CY9ZjjH3.js";import{E as ke}from"./progress-C9ZnX_fS.js";import{u as _}from"./index-BoWW9VGZ.js";import{V as Ie}from"./vuedraggable.umd-DLnsjw3h.js";const we={...ye,teleported:{type:Boolean,default:!0},modelValue:Boolean,customClass:String,customStyle:Object,transitionName:{type:String,default:"ele-image-viewer-fade"},keepAlive:Boolean},Oe={"update:modelValue":e=>!0,close:()=>!0,switch:e=>!0,rotate:e=>!0},Ue=J({name:"EleImageViewer",components:{ElImageViewer:he},props:we,emits:Oe,setup(e,{emit:o}){const d=C(null),s=T(()=>{const u=Y(e,["modelValue","customClass","customStyle","transitionName","keepAlive"]);return u.teleported=!1,u}),m=()=>{o("update:modelValue",!1),o("close")},a=u=>{o("switch",u)},p=u=>{o("rotate",u)};return Z(()=>{m()}),{imageViewerRef:d,viewerProps:s,handleClose:m,handleSwitch:a,handleRotate:p}}}),Ee=(e,o)=>{const d=e.__vccOpts||e;for(const[s,m]of o)d[s]=m;return d};function Ce(e,o,d,s,m,a){const p=h("ElImageViewer");return b(),D(te,{to:"body",disabled:!e.teleported},[f(ee,{name:e.transitionName,appear:!0},{default:I(()=>[e.modelValue?(b(),U("div",{key:0,class:x(["ele-image-viewer",e.customClass]),style:W(e.customStyle)},[f(p,L(e.viewerProps,{ref:"imageViewerRef",onClose:e.handleClose,onSwitch:e.handleSwitch,onRotate:e.handleRotate}),{default:I(()=>[B(e.$slots,"default")]),_:3},16,["onClose","onSwitch","onRotate"])],6)):P("",!0)]),_:3},8,["name"])],8,["disabled"])}const Se=Ee(Ue,[["render",Ce]]),$e=J({name:"ListItem",components:{CloseOutlined:le,EyeOutlined:oe,EditOutlined:ae,SyncOutlined:ne,FileOutlined:M,ElImage:be,ElProgress:ke,ElIcon:z},props:{item:{type:Object,required:!0},readonly:Boolean,disabled:Boolean,sortable:Boolean,imageProps:Object,progressProps:Object,imageObjectUrls:Array,tools:Boolean,listType:String,locale:{type:Object,required:!0}},emits:{itemClick:e=>!0,remove:e=>!0,edit:e=>!0,preview:e=>!0,retry:e=>!0},setup(e,{emit:o}){const d=T(()=>{var g;if(e.item.url)return e.item.url;if(!(!e.item.file||!e.imageObjectUrls))return(g=e.imageObjectUrls.find(k=>k.file===e.item.file))==null?void 0:g.url}),s=T(()=>{const g=e.item.progress;return!g||g<0?0:g>100?100:g});return{imageUrl:d,uploadProgress:s,handleItemClick:()=>{o("itemClick",e.item)},handleRemove:()=>{o("remove",e.item)},handleEdit:()=>{o("edit",e.item)},handlePreview:()=>{o("preview",e.item)},handleRetry:()=>{o("retry",e.item)}}}}),Pe=(e,o)=>{const d=e.__vccOpts||e;for(const[s,m]of o)d[s]=m;return d},Re=["title"],je={key:0,class:"ele-upload-thumbnail"},Be={class:"ele-upload-thumbnail-text"},Le={key:0,class:"ele-upload-progress"},Ne={class:"ele-upload-text"},De=["title"],Fe={class:"ele-upload-tool-text"},Te={key:1,class:"ele-upload-tools"},We=["title"],Je={class:"ele-upload-tool-text"},Me=["title"],ze={class:"ele-upload-tool-text"},_e=["title"],Ae={key:3,class:"ele-upload-handle"};function qe(e,o,d,s,m,a){const p=h("FileOutlined"),u=h("ElIcon"),V=h("ElImage"),g=h("ElProgress"),k=h("SyncOutlined"),i=h("EyeOutlined"),r=h("EditOutlined"),t=h("CloseOutlined");return b(),U("div",{title:e.item.name,class:"ele-upload-item",onClick:o[4]||(o[4]=(...l)=>e.handleItemClick&&e.handleItemClick(...l))},[B(e.$slots,"thumbnail",{item:e.item,imageUrl:e.imageUrl},()=>[e.listType==="file"||!e.imageUrl?(b(),U("div",je,[f(u,{class:"ele-upload-thumbnail-icon"},{default:I(()=>[f(p)]),_:1}),E("div",Be,j(e.item.name||e.item.url),1)])):(b(),D(V,L({key:1,fit:"contain",class:"ele-upload-image"},e.imageProps||{},{src:e.imageUrl}),null,16,["src"]))]),e.item.status==="uploading"||e.item.status==="exception"?(b(),U("div",Le,[B(e.$slots,"progress",{item:e.item},()=>[E("div",Ne,j(e.item.status=="exception"?e.locale.exception:e.locale.uploading),1),f(g,L({showText:!1,strokeWidth:e.listType==="file"?2:void 0,status:e.item.status==="exception"?"exception":void 0,class:"ele-upload-progress-bar"},e.progressProps||{},{percentage:e.uploadProgress}),null,16,["strokeWidth","status","percentage"]),!e.disabled&&e.item.status==="exception"?(b(),U("div",{key:0,title:e.locale.retry,class:"ele-upload-tool ele-upload-retry",onClick:o[0]||(o[0]=F((...l)=>e.handleRetry&&e.handleRetry(...l),["stop"]))},[f(u,{class:"ele-upload-tool-icon"},{default:I(()=>[f(k)]),_:1}),E("div",Fe,j(e.locale.retry),1)],8,De)):P("",!0)])])):e.tools&&!e.readonly&&!e.disabled&&!e.item.readonly?(b(),U("div",Te,[E("div",{title:e.locale.preview,class:"ele-upload-tool",onClick:o[1]||(o[1]=F((...l)=>e.handlePreview&&e.handlePreview(...l),["stop"]))},[f(u,{class:"ele-upload-tool-icon"},{default:I(()=>[f(i)]),_:1}),E("div",Je,j(e.locale.preview),1)],8,We),E("div",{title:e.locale.edit,class:"ele-upload-tool",onClick:o[2]||(o[2]=F((...l)=>e.handleEdit&&e.handleEdit(...l),["stop"]))},[f(u,{class:"ele-upload-tool-icon"},{default:I(()=>[f(r)]),_:1}),E("div",ze,j(e.locale.edit),1)],8,Me)])):P("",!0),!e.readonly&&!e.disabled&&!e.item.readonly?(b(),U("div",{key:2,title:e.locale.remove,class:"ele-upload-tool ele-upload-remove",onClick:o[3]||(o[3]=F((...l)=>e.handleRemove&&e.handleRemove(...l),["stop"]))},[B(e.$slots,"remove",{item:e.item},()=>[f(u,{class:"ele-upload-tool-icon"},{default:I(()=>[f(t)]),_:1})])],8,_e)):P("",!0),e.sortable?(b(),U("div",Ae)):P("",!0)],8,Re)}const He=Pe($e,[["render",qe]]),Ke={modelValue:Array,readonly:Boolean,disabled:Boolean,preview:{type:Boolean,default:!0},limit:Number,multiple:Boolean,drag:Boolean,accept:{type:String,default:"image/png,image/jpeg"},itemStyle:[Object,Boolean],buttonStyle:{type:[Object,Boolean],default:null},sortable:{type:[Boolean,Object],default:!0},imageProps:Object,progressProps:Object,previewProps:Object,tools:Boolean,listType:String,beforeUploadClick:Function,beforeItemEdit:Function,locale:Object},Qe={"update:modelValue":e=>!0,itemClick:e=>!0,upload:e=>!0,remove:e=>!0,retry:e=>!0,editUpload:e=>!0,preview:e=>!0},Ge=["default","icon"],Xe=J({name:"EleUploadList",components:{VueDraggable:Ie,ElUpload:Ve,ElIcon:z,PlusOutlined:ie,EleImageViewer:Se,ListItem:He},props:Ke,emits:Qe,setup(e,{emit:o}){const{lang:d}=se("upload",e),s=C(!1),m=C([]),a=C(0),p=C([]),u=C(null);let V=null;const g=T(()=>!e.readonly&&!(typeof e.limit=="number"&&e.limit>0&&e.modelValue!=null&&e.modelValue.length>=e.limit)),k=n=>({key:"ele"+ce(16,10)+String(Date.now()),name:n.name,status:void 0,progress:0,file:n}),i=(n,y)=>{if(n&&n.url)return n.url;const w=n==null?void 0:n.file;if(w!=null&&w.type.startsWith("image")){const O=p.value.find(X=>X.file===w);if(O!=null)return O.url;const $=URL.createObjectURL(w);return p.value.push({file:w,url:$}),$}},r=n=>{if(e.modelValue!=null){const y=[];e.modelValue.forEach(O=>{const $=i(O);$&&y.push({item:O,url:$})});const w=y.findIndex(O=>O.item.key===n.key);if(w!==-1){const O=y.map($=>$.url);t(O,w)}}},t=(n,y)=>{m.value=n,a.value=y,s.value=!0},l=n=>{o("update:modelValue",n)},c=n=>{if(g.value&&!e.disabled){const y=k(n);o("upload",y)}return!1},v=n=>{e.preview&&r(n),o("itemClick",n)},S=n=>{o("remove",n)},q=n=>{if(e.beforeItemEdit&&e.beforeItemEdit(n)===!1)return;const y=u.value;y!=null&&(V=n,y.value="",y&&y.click())},H=n=>{r(n),o("preview",n)},K=n=>{o("retry",n)},Q=n=>{var y;const w=(y=n.target.files)==null?void 0:y[0];if(w!=null&&V!=null){const O={item:V,newItem:k(w)};V=null,o("editUpload",O)}},G=n=>{e.beforeUploadClick&&e.beforeUploadClick(n)===!1&&(n.stopPropagation(),n.preventDefault())};return N(()=>e.modelValue,()=>{e.modelValue!=null&&e.modelValue.forEach(n=>{i(n)})},{immediate:!0,deep:!0}),re(()=>{p.value.forEach(n=>{URL.revokeObjectURL(n.url)}),p.value=[]}),{ownSlots:Ge,lang:d,previewVisible:s,previewImages:m,previewCurrentIndex:a,imageObjectUrls:p,uploadInputRef:u,uploadEnable:g,updateModelValue:l,handleUpload:c,handleItemClick:v,handleItemRemove:S,handleItemEdit:q,handleItemPreview:H,handleItemRetry:K,handleInputChange:Q,handleUploadClick:G,openImagePreview:t}}}),Ye=(e,o)=>{const d=e.__vccOpts||e;for(const[s,m]of o)d[s]=m;return d},Ze=["accept"];function xe(e,o,d,s,m,a){const p=h("ListItem"),u=h("PlusOutlined"),V=h("ElIcon"),g=h("ElUpload"),k=h("EleImageViewer"),i=h("VueDraggable");return b(),D(i,L({itemKey:"key",animation:300,setData:()=>{},handle:".ele-upload-handle",class:["ele-upload-list",{"is-file-list":e.listType==="file"},{"is-disabled":e.disabled}]},!e.sortable||e.sortable===!0?{}:e.sortable,{modelValue:e.modelValue||[],"onUpdate:modelValue":e.updateModelValue}),{item:I(({element:r})=>[f(p,{item:r,readonly:e.readonly,disabled:e.disabled,sortable:e.sortable&&!e.readonly&&!e.disabled&&e.limit!==1,imageProps:e.imageProps,progressProps:e.progressProps,imageObjectUrls:e.imageObjectUrls,tools:e.tools,listType:e.listType,locale:e.lang,style:W(e.itemStyle),onItemClick:e.handleItemClick,onRemove:e.handleItemRemove,onEdit:e.handleItemEdit,onPreview:e.handleItemPreview,onRetry:e.handleItemRetry},ue({_:2},[de(Object.keys(e.$slots).filter(t=>!e.ownSlots.includes(t)),t=>({name:t,fn:I(l=>[B(e.$slots,t,me(pe(l||{})))])}))]),1032,["item","readonly","disabled","sortable","imageProps","progressProps","imageObjectUrls","tools","listType","locale","style","onItemClick","onRemove","onEdit","onPreview","onRetry"])]),footer:I(()=>[e.uploadEnable&&e.buttonStyle!==!1?(b(),U("div",{key:0,style:W(typeof e.buttonStyle=="boolean"?void 0:e.buttonStyle),class:"ele-upload-item ele-upload-button"},[f(g,{action:"",drag:e.drag,accept:e.accept,multiple:e.multiple,disabled:e.disabled,showFileList:!1,beforeUpload:e.handleUpload},{default:I(()=>[E("div",{class:"ele-upload-button-inner",onClick:o[0]||(o[0]=(...r)=>e.handleUploadClick&&e.handleUploadClick(...r))},[B(e.$slots,"icon",{},()=>[f(V,{class:"ele-upload-icon"},{default:I(()=>[f(u)]),_:1})])])]),_:3},8,["drag","accept","multiple","disabled","beforeUpload"])],4)):P("",!0),e.tools?(b(),U("input",{key:1,ref:"uploadInputRef",type:"file",accept:e.accept,class:"ele-upload-input",onChange:o[1]||(o[1]=(...r)=>e.handleInputChange&&e.handleInputChange(...r))},null,40,Ze)):P("",!0),f(k,L({infinite:!1},e.previewProps||{},{modelValue:e.previewVisible,"onUpdate:modelValue":o[2]||(o[2]=r=>e.previewVisible=r),urlList:e.previewImages,initialIndex:e.previewCurrentIndex}),null,16,["modelValue","urlList","initialIndex"])]),_:3},16,["class","modelValue","onUpdate:modelValue"])}const A=Ye(Xe,[["render",xe]]),ut={__name:"index",props:{modelValue:String,limit:Number,fileLimit:{type:Number,default:20},itemStyle:Object,buttonStyle:Object},emits:["update:modelValue","change"],setup(e,{expose:o,emit:d}){const s=e,m=d,a=C([]),p=(i,r)=>{if(!i.file)return;if(!i.file.type.startsWith("image")){R.error("只能选择图片");return}if(i.file.size/1024/1024>s.fileLimit){R.error(`大小不能超过 ${s.fileLimit}MB`);return}r||a.value.push({...i});const t=a.value.find(l=>l.key===i.key);t&&(t.status="uploading",_(i.file,{onUploadProgress:l=>{l.total!=null&&(t.progress=l.loaded/l.total*100)}}).then(l=>{t.status="done",t.url=l.url}).catch(l=>{t.status="exception",R.error(l.message)}))},u=i=>{a.value.splice(a.value.indexOf(i),1)},V=i=>{s.modelValue!==i&&(m("update:modelValue",i),m("change",i))},g=()=>!a.value.some(i=>i.status!=="done"),k=()=>a.value.map(i=>i.url);return N(a,()=>{const i=k();if(s.limit===1){V(i.join());return}V(i.length?JSON.stringify(i):"")},{deep:!0}),N(()=>s.modelValue,i=>{if(!i){a.value.length&&(a.value=[]);return}if(s.limit===1){if(a.value.length===1&&a.value[0].url===i)return;a.value=[{key:`0-${i}`,url:i,status:"done"}];return}try{const r=JSON.parse(i);if(r.length===a.value.length&&JSON.stringify(k())===i)return;a.value=r.map((t,l)=>({key:`${l}-${t}`,url:t,status:"done"}))}catch(r){console.error(r),a.value=[]}},{immediate:!0}),o({isDone:g}),(i,r)=>{const t=A;return b(),D(t,{limit:e.limit,drag:!0,modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=l=>a.value=l),"item-style":e.itemStyle,"button-style":e.buttonStyle,onUpload:p,onRetry:r[1]||(r[1]=l=>p(l,!0)),onRemove:u},null,8,["limit","modelValue","item-style","button-style"])}}},et={class:"ele-upload-thumbnail"},tt={class:"ele-attachment-text"},lt={__name:"index",props:{modelValue:String,limit:Number,fileLimit:{type:Number,default:20},itemStyle:Object,buttonStyle:Object,accept:{type:String,default:""}},emits:["update:modelValue","change"],setup(e,{expose:o,emit:d}){const s=e,m=d,a=C([]),p=(t,l)=>{if(!t.file)return;if(s.accept==="image/*"){if(!t.file.type.startsWith("image")){R.error("只能选择图片");return}}else if(s.accept===".xls,.xlsx"&&!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(t.file.type))return R.error("只能选择 excel 文件"),!1;if(t.file.size/1024/1024>s.fileLimit){R.error(`大小不能超过 ${s.fileLimit}MB`);return}l||a.value.push({...t});const c=a.value.find(v=>v.key===t.key);c&&(c.status="uploading",_(t.file,{onUploadProgress:v=>{v.total!=null&&(c.progress=v.loaded/v.total*100)}}).then(v=>{c.status="done",c.name=v.name,c.fileUrl=v.url,u(c.fileUrl)&&(c.url=c.fileUrl)}).catch(v=>{c.status="exception",R.error(v.message)}))},u=t=>t?t.endsWith(".png")||t.endsWith(".jpg")||t.endsWith(".jpeg")||t.endsWith(".gif")||t.endsWith(".svg"):!1,V=t=>{a.value.splice(a.value.indexOf(t),1)},g=t=>{!t.url&&t.fileUrl&&window.open(t.fileUrl)},k=t=>{s.modelValue!==t&&(m("update:modelValue",t),m("change",t))},i=()=>!a.value.some(t=>t.status!=="done"),r=()=>a.value.map(t=>{var l;return{url:(l=t.fileUrl)!=null?l:t.url,name:t.name}});return N(a,()=>{const t=r();if(s.limit===1){k(t.length?JSON.stringify(t[0]):"");return}k(t.length?JSON.stringify(t):"")},{deep:!0}),N(()=>s.modelValue,t=>{if(!t){a.value.length&&(a.value=[]);return}if(s.limit===1){const l=JSON.parse(t);if(a.value.length===1&&a.value[0].fileUrl===l.url&&a.value[0].name===l.name)return;a.value=[{key:`0-${l.url}`,name:l.name,fileUrl:l.url,url:u(l.url)?l.url:void 0,status:"done"}];return}try{const l=JSON.parse(t);if(l.length===a.value.length&&JSON.stringify(r())===t)return;a.value=l.map((c,v)=>({key:`${v}-${c.url}`,name:c.name,fileUrl:c.url,url:u(c.url)?c.url:void 0,status:"done"}))}catch(l){console.error(l),a.value=[]}},{immediate:!0}),o({isDone:i}),(t,l)=>{const c=ve,v=A;return b(),D(v,{limit:e.limit,drag:!0,modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=S=>a.value=S),"item-style":e.itemStyle,"button-style":e.buttonStyle,accept:e.accept,"progress-props":{strokeWidth:2},sortable:{forceFallback:!0},class:"ele-attachment-upload",onUpload:p,onRetry:l[1]||(l[1]=S=>p(S,!0)),onRemove:V,onItemClick:g},{thumbnail:I(({item:S})=>[E("div",et,[f(c,{size:"md",icon:ge(M),type:"secondary",style:{"margin-right":"6px","line-height":"1"}},null,8,["icon"]),E("div",tt,j(S.name),1)])]),_:1},8,["limit","modelValue","item-style","button-style","accept"])}}},dt=fe(lt,[["__scopeId","data-v-5585b048"]]);export{dt as F,ut as _,A as i};
