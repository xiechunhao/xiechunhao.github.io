import{L as X,av as ce,r as x,J as j,aj as G,o as h,m as $,e as b,a2 as E,a5 as R,t as W,aG as B,a8 as S,c as w,aV as H,w as k,a$ as ue,b0 as de,F as z,n as N,b1 as ee,b2 as te,a6 as ne,d as L,b3 as be,b4 as _e,s as K,b5 as me,a as oe,R as fe,b as _,u as A,E as T,aI as se,aH as he,aL as pe,aC as ie,aE as ge,_ as le,b6 as Me,b7 as xe,b8 as Ie,b9 as $e,ba as we,au as Ce,aW as ye,g as Te,bb as ae,h as Ae,W as Se,at as Ve,ax as Oe,bc as Fe,aD as Ee}from"./index-C4BxmZrN.js";import{i as De}from"./index-CkGVv88Q.js";import{i as Pe}from"./index-BY7TmcLY.js";import{i as je}from"./index-DPWieFbN.js";import{E as Re}from"./upload-D6XcBL05.js";import"./progress-Bytq2m9M.js";import{u as Be}from"./index-Nq65WDmQ.js";import{E as Le}from"./image-viewer-DTf3QW2T.js";import{i as Ue}from"./index-DSHqkOzX.js";import"./cloneDeep-hApPH6eT.js";import"./throttle-BbZ3x3xu.js";const Ge=X({name:"FileGridItem",components:{EleDropdown:ce},props:{item:{type:Object,required:!0},selectionType:String,selections:Array,current:Object,icons:Array,contextMenus:Array,contextMenuProps:Object},emits:{click:e=>!0,checkChange:e=>!0,contextMenu:e=>!0,contextOpen:e=>!0},setup(e,{emit:t}){const o=x(null),i=x(!1),u=j(()=>e.selectionType==="checkbox"||e.selectionType==="radio"),p=j(()=>!u.value||!e.item?!1:e.selectionType==="checkbox"?!!(e.selections&&e.selections.some(n=>n.key===e.item.key)):!!(e.current&&e.current.key===e.item.key)),m=j(()=>{var n,g,l;if(e.item.thumbnail)return e.item.thumbnail;if(e.icons){if(e.item.isDirectory)return(n=e.icons.find(d=>d.type==="dir"))==null?void 0:n.icon;if(e.item.name){const d=(g=e.icons.find(f=>f.suffixes?!!f.suffixes.find(y=>!!e.item.name.endsWith(y)):!1))==null?void 0:g.icon;if(d)return d}return(l=e.icons.find(d=>d.type==="file"))==null?void 0:l.icon}});return{dropdownRef:o,dropdownVisible:i,selectable:u,selected:p,icon:m,onClick:()=>{t("click",e.item)},onCheckChange:()=>{t("checkChange",e.item)},onContextmenu:n=>{n.preventDefault(),n.stopPropagation(),o.value&&o.value.handleOpen()},onItemContextMenu:n=>{t("contextMenu",{key:n,item:e.item})},onContextVisibleChange:n=>{i.value=n,n&&t("contextOpen",o.value)}}}}),ze=(e,t)=>{const o=e.__vccOpts||e;for(const[i,u]of t)o[i]=u;return o},Ne={class:"ele-file-list-item-icon"},We=["src"],qe=["title"],He=b("i",{class:"ele-file-list-checkbox is-checked"},null,-1),Xe=[He];function Ye(e,t,o,i,u,p){const m=G("EleDropdown");return h(),$("div",{class:R(["ele-file-list-item",{"is-checked":e.selected},{"is-active":e.dropdownVisible}]),onClick:t[3]||(t[3]=B((...c)=>e.onClick&&e.onClick(...c),["stop"]))},[b("div",{class:"ele-file-list-item-body",onContextmenu:t[0]||(t[0]=(...c)=>e.onContextmenu&&e.onContextmenu(...c))},[b("div",Ne,[E(e.$slots,"icon",{icon:e.icon,item:e.item},()=>[b("img",{src:e.icon,class:R({"ele-file-list-item-image":!!e.item.thumbnail})},null,10,We)])]),E(e.$slots,"title",{item:e.item},()=>[b("div",{title:e.item.name,class:"ele-file-list-item-title"},W(e.item.name),9,qe)])],32),e.selectable?(h(),$("div",{key:0,class:"ele-file-list-item-checkbox",onClick:t[1]||(t[1]=B((...c)=>e.onCheckChange&&e.onCheckChange(...c),["stop"]))},Xe)):S("",!0),e.contextMenus||e.$slots.contextMenu?(h(),w(m,ue({key:1,placement:"bottom-start",popperClass:"ele-file-list-item-context"},e.contextMenuProps||{},{ref:"dropdownRef",trigger:"click",class:"ele-file-list-item-dropdown",items:e.contextMenus,onCommand:e.onItemContextMenu,onVisibleChange:e.onContextVisibleChange}),H({default:k(()=>[b("div",{onClick:t[2]||(t[2]=B(()=>{},["stop"]))})]),_:2},[e.$slots.contextMenu?{name:"dropdownMenu",fn:k(()=>[E(e.$slots,"contextMenu",{item:e.item})]),key:"0"}:void 0]),1040,["items","onCommand","onVisibleChange"])):S("",!0)],2)}const Je=ze(Ge,[["render",Ye]]),Ke=X({name:"FileGrid",components:{ReceiverView:de,FileGridItem:Je},props:{data:Array,icons:Array,selectionType:String,selections:Array,current:Object,isCheckAll:Boolean,isIndeterminate:Boolean,checkAllText:String,selectedText:String,contextMenus:[Array,Function],contextMenuProps:Object},emits:{checkAllChange:()=>!0,itemClick:e=>!0,itemCheckChange:e=>!0,itemContextMenu:e=>!0},setup(e,{emit:t}){const o=x([]),i=j(()=>{if(!e.selections||!e.selections.length)return e.checkAllText;if(e.selectedText)return e.selectedText.replace(/\{\s*total\s*\}/g,String(e.selections.length))});return{itemRefs:o,headerText:i,getContextMenus:C=>typeof e.contextMenus=="function"?e.contextMenus(C):e.contextMenus,onCheckAllChange:()=>{t("checkAllChange")},onItemClick:C=>{t("itemClick",C)},onItemCheckChange:C=>{t("itemCheckChange",C)},onItemContextMenu:C=>{t("itemContextMenu",C)},onItemContextOpen:C=>{o.value&&o.value.forEach(s=>{s!=null&&s.dropdownRef&&s.dropdownRef!==C&&s.dropdownRef.handleClose()})}}}}),Qe=(e,t)=>{const o=e.__vccOpts||e;for(const[i,u]of t)o[i]=u;return o},Ze={key:0,class:"ele-file-list-header"},et={class:"ele-file-list-body"};function tt(e,t,o,i,u,p){const m=G("FileGridItem"),c=G("ReceiverView");return h(),w(c,{class:"ele-file-list"},{default:k(()=>[e.selectionType==="checkbox"?(h(),$("div",Ze,[b("div",{class:"ele-file-list-selection",onClick:t[0]||(t[0]=B((...v)=>e.onCheckAllChange&&e.onCheckAllChange(...v),["stop"]))},[b("i",{class:R(["ele-file-list-checkbox",{"is-checked":e.isCheckAll},{"is-indeterminate":e.isIndeterminate}])},null,2),b("div",null,W(e.headerText),1)])])):S("",!0),b("div",et,[(h(!0),$(z,null,N(e.data,v=>(h(),w(m,{key:v.key,ref_for:!0,ref:"itemRefs",item:v,selectionType:e.selectionType,selections:e.selections,current:e.current,icons:e.icons,contextMenus:e.getContextMenus(v),contextMenuProps:e.contextMenuProps,onClick:e.onItemClick,onCheckChange:e.onItemCheckChange,onContextMenu:e.onItemContextMenu,onContextOpen:e.onItemContextOpen},H({_:2},[N(Object.keys(e.$slots),r=>({name:r,fn:k(C=>[E(e.$slots,r,ee(te(C||{})))])}))]),1032,["item","selectionType","selections","current","icons","contextMenus","contextMenuProps","onClick","onCheckChange","onContextMenu","onContextOpen"]))),128))])]),_:3})}const nt=Qe(Ke,[["render",tt]]),ot=X({name:"FileTableItem",components:{EleDropdown:ce},props:{item:{type:Object,required:!0},selectionType:String,selections:Array,current:Object,icons:Array,columns:Array,contextMenus:Array,contextMenuProps:Object},emits:{click:e=>!0,checkChange:e=>!0,contextMenu:e=>!0,contextOpen:e=>!0},setup(e,{emit:t}){const o=x(null),i=x(!1),u=j(()=>e.selectionType==="checkbox"||e.selectionType==="radio"),p=j(()=>!u.value||!e.item?!1:e.selectionType==="checkbox"?!!(e.selections&&e.selections.some(n=>n.key===e.item.key)):!!(e.current&&e.current.key===e.item.key)),m=j(()=>{var n,g,l;if(e.item.thumbnail)return e.item.thumbnail;if(e.icons){if(e.item.isDirectory)return(n=e.icons.find(d=>d.type==="dir"))==null?void 0:n.icon;if(e.item.name){const d=(g=e.icons.find(f=>f.suffixes?!!f.suffixes.find(y=>!!e.item.name.endsWith(y)):!1))==null?void 0:g.icon;if(d)return d}return(l=e.icons.find(d=>d.type==="file"))==null?void 0:l.icon}});return{dropdownRef:o,dropdownVisible:i,selectable:u,selected:p,icon:m,onClick:()=>{t("click",e.item)},onCheckChange:()=>{t("checkChange",e.item)},onContextmenu:n=>{n.preventDefault(),n.stopPropagation(),o.value&&o.value.handleOpen()},onItemContextMenu:n=>{t("contextMenu",{key:n,item:e.item})},onContextVisibleChange:n=>{i.value=n,n&&t("contextOpen",o.value)}}}}),st=(e,t)=>{const o=e.__vccOpts||e;for(const[i,u]of t)o[i]=u;return o},it={key:0,class:"ele-file-list-item-checkbox"},lt={class:"ele-file-list-item-name"},rt={class:"ele-file-list-item-icon"},at=["src"],ct=["title"],ut={key:0,class:"ele-file-list-item-tools"};function dt(e,t,o,i,u,p){const m=G("EleDropdown");return h(),$("div",{class:R(["ele-file-list-item",{"is-checked":e.selected},{"is-active":e.dropdownVisible}]),onClick:t[3]||(t[3]=B((...c)=>e.onClick&&e.onClick(...c),["stop"]))},[b("div",{class:"ele-file-list-item-body",onContextmenu:t[1]||(t[1]=(...c)=>e.onContextmenu&&e.onContextmenu(...c))},[e.selectable?(h(),$("div",it,[b("i",{class:R(["ele-file-list-checkbox",{"is-radio":e.selectionType==="radio"},{"is-checked":e.selected}]),onClick:t[0]||(t[0]=B((...c)=>e.onCheckChange&&e.onCheckChange(...c),["stop"]))},null,2)])):S("",!0),b("div",lt,[b("div",rt,[E(e.$slots,"icon",{icon:e.icon,item:e.item},()=>[b("img",{src:e.icon,class:R({"ele-file-list-item-image":!!e.item.thumbnail})},null,10,at)]),E(e.$slots,"title",{item:e.item},()=>[b("div",{title:e.item.name,class:"ele-file-list-item-title"},W(e.item.name),9,ct)])]),e.$slots.tool?(h(),$("div",ut,[E(e.$slots,"tool",{item:e.item})])):S("",!0)]),(h(!0),$(z,null,N(e.columns,c=>(h(),$("div",{key:c.prop,style:ne(c.style),class:"ele-file-list-item-cell"},[c.slot&&!["icon","title","tool","contextMenu"].includes(c.slot)&&e.$slots[c.slot]?E(e.$slots,c.slot,{key:0,item:e.item,col:c}):e.item&&c&&c.prop?(h(),$(z,{key:1},[L(W(e.item[c.prop]),1)],64)):S("",!0)],4))),128))],32),e.contextMenus||e.$slots.contextMenu?(h(),w(m,ue({key:0,placement:"bottom-start",popperClass:"ele-file-list-item-context"},e.contextMenuProps||{},{ref:"dropdownRef",trigger:"click",class:"ele-file-list-item-dropdown",items:e.contextMenus,onCommand:e.onItemContextMenu,onVisibleChange:e.onContextVisibleChange}),H({default:k(()=>[b("div",{onClick:t[2]||(t[2]=B(()=>{},["stop"]))})]),_:2},[e.$slots.contextMenu?{name:"dropdownMenu",fn:k(()=>[E(e.$slots,"contextMenu",{item:e.item})]),key:"0"}:void 0]),1040,["items","onCommand","onVisibleChange"])):S("",!0)],2)}const mt=st(ot,[["render",dt]]),ft=X({name:"FileSort",props:{sort:String,order:String,name:{type:String,required:!0}}}),ht=(e,t)=>{const o=e.__vccOpts||e;for(const[i,u]of t)o[i]=u;return o};function pt(e,t,o,i,u,p){return h(),$("i",{class:R(["ele-file-list-item-sort",{"is-asc":e.name===e.sort&&e.order==="asc"},{"is-desc":e.name===e.sort&&e.order==="desc"}])},null,2)}const gt=ht(ft,[["render",pt]]),Ct=X({name:"FileTable",components:{ReceiverView:de,FileTableItem:mt,FileSort:gt},props:{data:Array,icons:Array,selectionType:String,selections:Array,current:Object,isCheckAll:Boolean,isIndeterminate:Boolean,nameText:String,sizeText:String,timeText:String,sortable:Boolean,sort:String,order:String,columns:Array,contextMenus:[Array,Function],contextMenuProps:Object},emits:{checkAllChange:()=>!0,itemClick:e=>!0,itemCheckChange:e=>!0,itemContextMenu:e=>!0,sortChange:e=>!0},setup(e,{emit:t}){const o=x([]),i=j(()=>e.columns?e.columns:[{title:e.sizeText,prop:"length",style:{width:"120px",flexShrink:0},sortable:e.sortable},{title:e.timeText,prop:"updateTime",style:{width:"180px",flexShrink:0},sortable:e.sortable}]);return{itemRefs:o,tableCols:i,getContextMenus:s=>typeof e.contextMenus=="function"?e.contextMenus(s):e.contextMenus,onCheckAllChange:()=>{t("checkAllChange")},onItemClick:s=>{t("itemClick",s)},onItemCheckChange:s=>{t("itemCheckChange",s)},onSortChange:(s,n)=>{n?n.sortable&&t("sortChange",s):e.sortable&&t("sortChange",s)},onItemContextMenu:s=>{t("itemContextMenu",s)},onItemContextOpen:s=>{o.value&&o.value.forEach(n=>{n!=null&&n.dropdownRef&&n.dropdownRef!==s&&n.dropdownRef.handleClose()})}}}}),yt=(e,t)=>{const o=e.__vccOpts||e;for(const[i,u]of t)o[i]=u;return o},kt={class:"ele-file-list-header"},vt={class:"ele-file-list-item"},bt={class:"ele-file-list-item-body"},_t={key:0,class:"ele-file-list-item-checkbox"},Mt=["onClick"],xt={class:"ele-file-list-body"};function It(e,t,o,i,u,p){const m=G("FileSort"),c=G("FileTableItem"),v=G("ReceiverView");return h(),w(v,{class:"ele-file-list-table"},{default:k(()=>[b("div",kt,[b("div",vt,[b("div",bt,[e.selectionType==="checkbox"||e.selectionType==="radio"?(h(),$("div",_t,[e.selectionType==="checkbox"?(h(),$("i",{key:0,class:R(["ele-file-list-checkbox",{"is-checked":e.isCheckAll},{"is-indeterminate":e.isIndeterminate}]),onClick:t[0]||(t[0]=B((...r)=>e.onCheckAllChange&&e.onCheckAllChange(...r),["stop"]))},null,2)):S("",!0)])):S("",!0),b("div",{class:"ele-file-list-item-name",onClick:t[1]||(t[1]=r=>e.onSortChange("name"))},[b("span",null,W(e.nameText),1),e.sortable?(h(),w(m,{key:0,sort:e.sort,order:e.order,name:"name"},null,8,["sort","order"])):S("",!0)]),(h(!0),$(z,null,N(e.tableCols,r=>(h(),$("div",{key:r.prop,style:ne(r.headerStyle||r.style),class:"ele-file-list-item-cell",onClick:C=>e.onSortChange(r.prop,r)},[b("span",null,[r.headerSlot&&!["icon","title","tool","contextMenu"].includes(r.headerSlot)&&e.$slots[r.headerSlot]?E(e.$slots,r.headerSlot,{key:0,col:r}):(h(),$(z,{key:1},[L(W(r.title),1)],64))]),r.sortable?(h(),w(m,{key:0,sort:e.sort,order:e.order,name:r.prop},null,8,["sort","order","name"])):S("",!0)],12,Mt))),128))])])]),b("div",xt,[(h(!0),$(z,null,N(e.data,r=>(h(),w(c,{key:r.key,ref_for:!0,ref:"itemRefs",item:r,selectionType:e.selectionType,selections:e.selections,current:e.current,icons:e.icons,columns:e.tableCols,contextMenus:e.getContextMenus(r),contextMenuProps:e.contextMenuProps,onClick:e.onItemClick,onCheckChange:e.onItemCheckChange,onContextMenu:e.onItemContextMenu,onContextOpen:e.onItemContextOpen},H({_:2},[N(Object.keys(e.$slots),C=>({name:C,fn:k(s=>[E(e.$slots,C,ee(te(s||{})))])}))]),1032,["item","selectionType","selections","current","icons","columns","contextMenus","contextMenuProps","onClick","onCheckChange","onContextMenu","onContextOpen"]))),128))])]),_:3})}const $t=yt(Ct,[["render",It]]),re=[{icon:"/ele-file-list/ic_file_misc_sm.png",type:"file"},{icon:"/ele-file-list/ic_file_folder_sm.png",type:"dir"},{icon:"/ele-file-list/ic_file_code_sm.png",suffixes:[".java",".js",".css",".vue",".ts",".tsx",".scss",".less",".c",".cpp",".cs",".jsp",".php",".asp",".py",".go",".kt",".lua"]},{icon:"/ele-file-list/ic_file_htm_sm.png",suffixes:[".html",".htm"]},{icon:"/ele-file-list/ic_file_text_sm.png",suffixes:[".txt"]},{icon:"/ele-file-list/ic_file_pdf_sm.png",suffixes:[".pdf"]},{icon:"/ele-file-list/ic_file_word_sm.png",suffixes:[".doc",".docx"]},{icon:"/ele-file-list/ic_file_excel_sm.png",suffixes:[".xls",".xlsx"]},{icon:"/ele-file-list/ic_file_ppt_sm.png",suffixes:[".ppt",".pptx"]},{icon:"/ele-file-list/ic_file_visio_sm.png",suffixes:[".vsd"]},{icon:"/ele-file-list/ic_file_ps_sm.png",suffixes:[".psd"]},{icon:"/ele-file-list/ic_file_cad_sm.png",suffixes:[".dwg"]},{icon:"/ele-file-list/ic_file_flash_sm.png",suffixes:[".swf"]},{icon:"/ele-file-list/ic_file_music_sm.png",suffixes:[".mp3",".wav"]},{icon:"/ele-file-list/ic_file_video_sm.png",suffixes:[".mp4",".rmvb",".flv",".avi",".3gp"]},{icon:"/ele-file-list/ic_file_picture_sm.png",suffixes:[".png",".jpg",".jpeg",".gif",".bmp"]},{icon:"/ele-file-list/ic_file_fonts_sm.png",suffixes:[".ttf",".woff"]},{icon:"/ele-file-list/ic_file_bt_sm.png",suffixes:[".torrent"]},{icon:"/ele-file-list/ic_file_android_sm.png",suffixes:[".apk"]},{icon:"/ele-file-list/ic_file_exe_sm.png",suffixes:[".exe"]},{icon:"/ele-file-list/ic_file_ipa_sm.png",suffixes:[".ipa",".dmg"]},{icon:"/ele-file-list/ic_file_zip_sm.png",suffixes:[".zip",".rar",".7z"]}],wt=re.map(e=>({...e,icon:e.icon.replace("_sm.png",".png")})),ke=re.map(e=>({...e,icon:e.icon.replace("/ele-file-list/","https://cdn.eleadmin.com/20200609/")})),Tt=ke.map(e=>({...e,icon:e.icon.replace("_sm.png",".png")})),At={data:{type:Array,required:!0},selectionType:String,selections:Array,current:Object,grid:{type:Boolean,default:!0},sortable:Boolean,sort:String,order:String,icons:{type:Array,default:()=>Tt},smallIcons:{type:Array,default:()=>ke},columns:Array,boxChoose:Boolean,contextMenus:[Array,Function],contextMenuProps:Object,locale:Object},St={itemClick:e=>!0,sortChange:e=>!0,"update:selections":e=>!0,"update:current":e=>!0,itemContextMenu:e=>!0},Vt=".ele-file-list-body>.ele-file-list-item",Ot=X({name:"EleFileList",components:{FileGrid:nt,FileTable:$t},props:At,emits:St,setup(e,{emit:t}){const{lang:o}=be("fileList",e),i=x({top:"0px",left:"0px",width:"0px",height:"0px",display:"none"}),u=j(()=>!!(e.data&&e.data.length&&e.selections&&e.selections.length&&!e.data.some(l=>{var d,f;return!((f=(d=e.selections)==null?void 0:d.some)!=null&&f.call(d,y=>l.key===y.key))}))),p=j(()=>!!(!u.value&&e.selections&&e.selections.length)),m=l=>{t("update:selections",l)},c=l=>{t("update:current",l)};return{lang:o,selectorStyle:i,isCheckAll:u,isIndeterminate:p,onCheckAllChange:()=>{if(e.selectionType!=="checkbox")return;if(u.value||e.data==null||!e.data.length){if(!e.selections){m([]);return}const d=e.selections.filter(f=>e.data?!e.data.some(y=>y.key===f.key):!0);m(d);return}if(!e.selections){m([...e.data]);return}const l=e.selections.concat(e.data.filter(d=>e.selections?!e.selections.some(f=>f.key===d.key):!0));m(l)},onItemCheckChange:l=>{if(e.selectionType==="radio"){c(e.current&&e.current.key===l.key?null:l);return}if(e.selectionType==="checkbox"){if(!e.selections||!e.selections.length){m([l]);return}if(!e.selections.some(d=>d.key===l.key)){m(e.selections.concat([l]));return}m(e.selections.filter(d=>d.key!==l.key))}},onItemClick:l=>{t("itemClick",l)},onSortChange:l=>{const d={sort:l};e.order&&l===e.sort?d.order=e.order==="asc"?"desc":null:d.order="asc",t("sortChange",d)},onItemContextMenu:l=>{t("itemContextMenu",l)},onMousedown:l=>{if(!e.boxChoose||e.selectionType!=="checkbox")return;const d=l.clientX,f=l.clientY,y=l.currentTarget,a=y.getBoundingClientRect(),M=Array.from(y.querySelectorAll(Vt)),I=_e(O=>{const D=Math.max(O.clientX,a.left),P=Math.max(O.clientY,a.top),U=Math.min(D,d)-a.left,q=Math.min(P,f)-a.top,Y=Math.min(Math.abs(D-d),y.clientWidth-U),J=Math.min(Math.abs(P-f),y.clientHeight-q);if(i.value={left:U+"px",top:q+"px",width:Y+"px",height:J+"px",display:"block"},Y<6||J<6){M.forEach(F=>{F.classList.remove("is-active")});return}l.stopPropagation(),l.preventDefault(),O.stopPropagation(),O.preventDefault(),M.forEach(F=>{const Q=F.offsetLeft+F.clientWidth,Z=F.offsetTop+F.clientHeight;Q>U&&Z>q&&F.offsetLeft<U+Y&&F.offsetTop<q+J?F.classList.add("is-active"):F.classList.remove("is-active")})},60),V=O=>{i.value={...i.value,display:"none"};const D=Math.max(O.clientX,a.left),P=Math.max(O.clientY,a.top),U=Math.min(D,d)-a.left,q=Math.min(P,f)-a.top,Y=Math.min(Math.abs(D-d),y.clientWidth-U),J=Math.min(Math.abs(P-f),y.clientHeight-q);if(Y>6&&J>6){const F=[];M.forEach((Q,Z)=>{Q.classList.contains("is-active")&&(Q.classList.remove("is-active"),e.data&&e.data[Z]&&F.push(e.data[Z]))}),F.length&&m(F)}document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",V)};document.addEventListener("mousemove",I),document.addEventListener("mouseup",V)}}}}),Ft=(e,t)=>{const o=e.__vccOpts||e;for(const[i,u]of t)o[i]=u;return o};function Et(e,t,o,i,u,p){const m=G("FileGrid"),c=G("FileTable");return h(),$("div",{class:"ele-file-list-group",onMousedown:t[0]||(t[0]=(...v)=>e.onMousedown&&e.onMousedown(...v))},[e.grid?(h(),w(m,{key:0,data:e.data,icons:e.icons,selectionType:e.selectionType,selections:e.selections,current:e.current,isCheckAll:e.isCheckAll,isIndeterminate:e.isIndeterminate,checkAllText:e.lang.selectAll,selectedText:e.lang.selectTips,contextMenus:e.contextMenus,contextMenuProps:e.contextMenuProps,onCheckAllChange:e.onCheckAllChange,onItemClick:e.onItemClick,onItemCheckChange:e.onItemCheckChange,onItemContextMenu:e.onItemContextMenu},H({_:2},[N(Object.keys(e.$slots),v=>({name:v,fn:k(r=>[E(e.$slots,v,ee(te(r||{})))])}))]),1032,["data","icons","selectionType","selections","current","isCheckAll","isIndeterminate","checkAllText","selectedText","contextMenus","contextMenuProps","onCheckAllChange","onItemClick","onItemCheckChange","onItemContextMenu"])):(h(),w(c,{key:1,data:e.data,icons:e.icons,selectionType:e.selectionType,selections:e.selections,current:e.current,isCheckAll:e.isCheckAll,isIndeterminate:e.isIndeterminate,nameText:e.lang.fileName,sizeText:e.lang.fileSize,timeText:e.lang.fileTimestamp,sortable:e.sortable,sort:e.sort,order:e.order,columns:e.columns,contextMenus:e.contextMenus,contextMenuProps:e.contextMenuProps,onCheckAllChange:e.onCheckAllChange,onItemClick:e.onItemClick,onItemCheckChange:e.onItemCheckChange,onItemContextMenu:e.onItemContextMenu,onSortChange:e.onSortChange},H({_:2},[N(Object.keys(e.$slots),v=>({name:v,fn:k(r=>[E(e.$slots,v,ee(te(r||{})))])}))]),1032,["data","icons","selectionType","selections","current","isCheckAll","isIndeterminate","nameText","sizeText","timeText","sortable","sort","order","columns","contextMenus","contextMenuProps","onCheckAllChange","onItemClick","onItemCheckChange","onItemContextMenu","onSortChange"])),b("div",{class:"ele-file-list-selector",style:ne(e.selectorStyle)},null,4)],32)}const Dt=Ft(Ot,[["render",Et]]);async function Pt(e){const t=await K.get("/system/user-file",{params:e});return t.data.code===0&&t.data.data?t.data.data:Promise.reject(new Error(t.data.message))}async function ve(e){const t=await K.post("/system/user-file",e);return t.data.code===0?t.data.message:Promise.reject(new Error(t.data.message))}async function jt(e){const t=await K.put("/system/user-file",e);return t.data.code===0?t.data.message:Promise.reject(new Error(t.data.message))}async function Rt(e){const t=await K.delete("/system/user-file/"+e);return t.data.code===0?t.data.message:Promise.reject(new Error(t.data.message))}async function Bt(e){const t=await K.delete("/system/user-file/batch",{data:e});return t.data.code===0?t.data.message:Promise.reject(new Error(t.data.message))}const Lt={__name:"folder-edit",props:{modelValue:Boolean,parentId:Number},emits:["done","update:modelValue"],setup(e,{emit:t}){const o=t,i=e,u=x(null),p=x(!1),[m,c]=me({name:""}),v=oe({name:[{required:!0,message:"请输入文件夹名称",type:"string",trigger:"blur"}]}),r=()=>{var s,n;(n=(s=u.value)==null?void 0:s.validate)==null||n.call(s,g=>{g&&(p.value=!0,ve({...m,parentId:i.parentId,isDirectory:1}).then(l=>{p.value=!1,T.success(l),C(!1),o("done")}).catch(l=>{p.value=!1,T.error(l.message)}))})},C=s=>{o("update:modelValue",s)};return fe(()=>i.modelValue,s=>{var n,g;s||(c(),(g=(n=u.value)==null?void 0:n.clearValidate)==null||g.call(n))}),(s,n)=>{const g=se,l=he,d=pe,f=ie,y=ge;return h(),w(y,{form:"",width:460,title:"新建文件夹","model-value":e.modelValue,"onUpdate:modelValue":C},{footer:k(()=>[_(f,{onClick:n[2]||(n[2]=a=>C(!1))},{default:k(()=>[L("取消")]),_:1}),_(f,{type:"primary",loading:p.value,onClick:r},{default:k(()=>[L(" 保存 ")]),_:1},8,["loading"])]),default:k(()=>[_(d,{ref_key:"formRef",ref:u,model:A(m),rules:v,"label-width":"100px",onSubmit:n[1]||(n[1]=B(()=>{},["prevent"]))},{default:k(()=>[_(l,{label:"文件夹名称",prop:"name"},{default:k(()=>[_(g,{clearable:"",maxlength:20,modelValue:A(m).name,"onUpdate:modelValue":n[0]||(n[0]=a=>A(m).name=a),placeholder:"请输入文件夹名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value"])}}},Ut={style:{"max-width":"240px"},class:"hidden-sm-and-down"},Gt={__name:"file-toolbar",props:{grid:Boolean,selections:Array,parentId:Number},emits:["update:grid","done"],setup(e,{emit:t}){const o=e,i=t,u=x(""),p=x(!1),m=s=>{if(s.size/1024/1024>100)return T.error("大小不能超过 100MB"),!1;const n=T.loading("上传中..");return Be(s).then(g=>{ve({name:g.name,isDirectory:0,parentId:o.parentId,path:g.path,length:g.length,contentType:g.contentType}).then(()=>{n.close(),T.success("上传成功"),r()}).catch(l=>{n.close(),T.error(l.message)})}).catch(g=>{n.close(),T.error(g.message)}),!1},c=()=>{p.value=!0},v=()=>{const s=o.selections;ye.confirm("确定要删除“"+s.map(n=>n.name).join(", ")+"”吗?","系统提示",{type:"warning",draggable:!0}).then(()=>{const n=T.loading("请求中..");Bt(s.map(g=>g.id)).then(g=>{n.close(),T.success(g),r()}).catch(g=>{n.close(),T.error(g.message)})}).catch(()=>{})},r=()=>{i("done")},C=()=>{i("update:grid",!o.grid)};return(s,n)=>{const g=ie,l=Re,d=se,f=Te,y=je;return h(),$(z,null,[_(y,{theme:"plain",class:"demo-file-toolbar"},{tools:k(()=>[b("div",Ut,[_(d,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=a=>u.value=a),placeholder:"搜索您的文件","prefix-icon":A(Me)},null,8,["modelValue","prefix-icon"])]),_(f,{class:"demo-file-tool",onClick:C},{default:k(()=>[e.grid?(h(),w(A(xe),{key:0})):(h(),w(A(Ie),{key:1}))]),_:1})]),default:k(()=>[_(l,{action:"","show-upload-list":!1,"before-upload":m,style:{display:"inline-block","vertical-align":"middle"}},{default:k(()=>[_(g,{type:"primary",class:"ele-btn-icon",icon:A($e)},{default:k(()=>[L(" 上传 ")]),_:1},8,["icon"])]),_:1}),_(g,{class:"ele-btn-icon",icon:A(we),style:{"margin-left":"12px"},onClick:c},{default:k(()=>[L(" 新建文件夹 ")]),_:1},8,["icon"]),_(g,{plain:"",type:"danger",icon:A(Ce),disabled:!e.selections.length,class:"ele-btn-icon hidden-xs-only",onClick:v},{default:k(()=>[L(" 删除 ")]),_:1},8,["icon","disabled"])]),_:1}),_(Lt,{modelValue:p.value,"onUpdate:modelValue":n[1]||(n[1]=a=>p.value=a),"parent-id":e.parentId,onDone:r},null,8,["modelValue","parent-id"])],64)}}},zt=le(Gt,[["__scopeId","data-v-b0d27d3d"]]),Nt={class:"demo-breadcrumb"},Wt={class:"demo-breadcrumb-body"},qt={class:"demo-breadcrumb-list"},Ht=["onClick"],Xt={class:"hidden-xs-only"},Yt={__name:"file-header",props:{directorys:Array,total:Number},emits:["update:directorys"],setup(e,{emit:t}){const o=e,i=t,u=()=>{i("update:directorys",o.directorys.slice(0,o.directorys.length-1))},p=()=>{o.directorys.length&&i("update:directorys",[])},m=c=>{c!==o.directorys.length-1&&i("update:directorys",o.directorys.slice(0,c+1))};return(c,v)=>{const r=Ae;return h(),$("div",Nt,[b("div",Wt,[e.directorys.length?(h(),w(r,{key:0,type:"primary",class:"demo-breadcrumb-back",onClick:u},{default:k(()=>[L(" 返回上一级 ")]),_:1})):S("",!0),b("div",qt,[_(r,{type:e.directorys.length?"primary":void 0,class:"demo-breadcrumb-item"},{default:k(()=>[b("div",{class:R({"demo-breadcrumb-link":!!e.directorys.length}),onClick:p}," 全部文件 ",2),e.directorys.length?(h(),w(r,{key:0,icon:A(ae),type:"placeholder",style:{display:"flex"}},null,8,["icon"])):S("",!0)]),_:1},8,["type"]),(h(!0),$(z,null,N(e.directorys,(C,s)=>(h(),w(r,{key:C.id,class:"demo-breadcrumb-item",type:s!==e.directorys.length-1?"primary":"default"},{default:k(()=>[b("div",{class:R({"demo-breadcrumb-link":s!==e.directorys.length-1}),onClick:n=>m(s)},W(C.name),11,Ht),s!==e.directorys.length-1?(h(),w(r,{key:0,icon:A(ae),type:"placeholder",style:{display:"flex"}},null,8,["icon"])):S("",!0)]),_:2},1032,["type"]))),128))])]),b("div",Xt,"已全部加载，共 "+W(e.total)+" 个",1)])}}},Jt=le(Yt,[["__scopeId","data-v-c7c221c0"]]),Kt={__name:"name-edit",props:{modelValue:Boolean,data:Object},emits:["done","update:modelValue"],setup(e,{emit:t}){const o=t,i=e,u=x(null),p=x(!1),[m,c]=me({name:""}),v=oe({name:[{required:!0,message:"请输入文件/夹名称",type:"string",trigger:"blur"}]}),r=()=>{var s,n;(n=(s=u.value)==null?void 0:s.validate)==null||n.call(s,g=>{var l;g&&(p.value=!0,jt({...m,id:(l=i.data)==null?void 0:l.id}).then(d=>{p.value=!1,T.success(d),C(!1),o("done")}).catch(d=>{p.value=!1,T.error(d.message)}))})},C=s=>{o("update:modelValue",s)};return fe(()=>i.modelValue,s=>{var n,g;s?i.data&&(m.name=i.data.name):(c(),(g=(n=u.value)==null?void 0:n.clearValidate)==null||g.call(n))}),(s,n)=>{const g=se,l=he,d=pe,f=ie,y=ge;return h(),w(y,{form:"",width:460,title:"重命名","model-value":e.modelValue,"onUpdate:modelValue":C},{footer:k(()=>[_(f,{onClick:n[2]||(n[2]=a=>C(!1))},{default:k(()=>[L("取消")]),_:1}),_(f,{type:"primary",loading:p.value,onClick:r},{default:k(()=>[L(" 保存 ")]),_:1},8,["loading"])]),default:k(()=>[_(d,{ref_key:"formRef",ref:u,model:A(m),rules:v,"label-width":"100px",onSubmit:n[1]||(n[1]=B(()=>{},["prevent"]))},{default:k(()=>[_(l,{label:"文件/夹名称",prop:"name"},{default:k(()=>[_(g,{clearable:"",maxlength:20,modelValue:A(m).name,"onUpdate:modelValue":n[0]||(n[0]=a=>A(m).name=a),placeholder:"请输入文件/夹名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["model-value"])}}},Qt={class:"demo-file-list"},Zt={key:0,class:"demo-file-list-empty"},en={style:{display:"none"}},tn={__name:"file-list",props:{parentId:Number,data:Array,sort:String,order:String,selections:Array,grid:Boolean},emits:["sort-change","update:selections","go-directory","done"],setup(e,{emit:t}){const o=e,i=t,u=x(null),p=oe({currentSrc:"",current:0,visible:!1}),m=x([]),c=x(!1),v=x(),r=a=>{i("sort-change",a)},C=a=>{i("update:selections",a)},s=a=>{console.log("onItemClick:",JSON.parse(JSON.stringify(a))),a.isDirectory?i("go-directory",a):d(a)?f(a):C(o.selections.includes(a)?o.selections.filter(M=>M!==a):[...o.selections,a])},n=a=>{const{key:M,item:I}=a;M==="open"?I.isDirectory||d(I)?s(I):window.open(I.url):M==="download"?typeof I.downloadUrl=="string"&&window.open(I.downloadUrl):M==="edit"?(v.value=I,c.value=!0):M==="remove"?g(I):M==="move"&&T.info({message:`点击了移动到: ${I.name}`,plain:!0})},g=a=>{ye.confirm(`确定要删除“${a.name}”吗?`,"系统提示",{type:"warning",draggable:!0}).then(()=>{const M=T.loading("请求中..");Rt(a.id).then(I=>{M.close(),T.success(I),l()}).catch(I=>{M.close(),T.error(I.message)})}).catch(()=>{})},l=()=>{i("done")},d=a=>typeof a.contentType=="string"&&a.contentType.startsWith("image/")&&a.url,f=a=>{const M=o.data.filter(V=>d(V)),I=M.indexOf(a);I!==-1&&(m.value=M.map(V=>V.url),p.currentSrc=a.url,p.current=I,p.visible=!0,Se(()=>{var V,O,D,P,U;(U=(P=(D=(O=(V=u.value)==null?void 0:V.$el)==null?void 0:O.querySelector)==null?void 0:D.call(O,"img"))==null?void 0:P.click)==null||U.call(P)}))},y=a=>{if(!a)return[];const M=[{title:"重命名",command:"edit",icon:Ve,divided:a.isDirectory},{title:"移动到",command:"move",icon:Oe},{title:"删除",command:"remove",icon:Ce,divided:!0,danger:!0}];return a.isDirectory||M.unshift({title:"下载",command:"download",icon:Fe,divided:!0}),M.unshift({title:"打开",command:"open"}),M};return(a,M)=>{const I=Dt,V=Ee,O=Le;return h(),$(z,null,[b("div",Qt,[_(I,{data:e.data,grid:e.grid,sort:e.sort,order:e.order,sortable:!0,"box-choose":!0,"selection-type":"checkbox",selections:e.selections,"context-menus":y,"context-menu-props":{menuStyle:{minWidth:"120px"},iconProps:{size:15}},icons:A(wt),"small-icons":A(re),style:ne({minHeight:"400px",minWidth:e.grid?"auto":"456px"}),onItemClick:s,onSortChange:r,"onUpdate:selections":C,onItemContextMenu:n},null,8,["data","grid","sort","order","selections","icons","small-icons","style"]),e.data.length?S("",!0):(h(),$("div",Zt,[_(V,{description:"无数据","image-size":80})]))]),b("div",en,[p.visible?(h(),w(O,{key:0,ref_key:"previewRef",ref:u,src:p.currentSrc,"preview-src-list":m.value,"initial-index":p.current,"hide-on-click-modal":!0,"preview-teleported":!0},null,8,["src","preview-src-list","initial-index"])):S("",!0)]),_(Kt,{modelValue:c.value,"onUpdate:modelValue":M[0]||(M[0]=D=>c.value=D),data:v.value,onDone:l},null,8,["modelValue","data"])],64)}}},nn=le(tn,[["__scopeId","data-v-c76b3173"]]),on={style:{padding:"8px 16px"}},sn={name:"ExtensionFile"},Cn=Object.assign(sn,{setup(e){const t=x(!0),o=x([]),i=x(""),u=x(""),p=x([]),m=x([]),c=x(0),v=x(!0),r=x(0),C=()=>{o.value=[],p.value=[],t.value=!0,Pt({sort:u.value?i.value:"",order:u.value,parentId:r.value}).then(f=>{t.value=!1,o.value=f.map(y=>Object.assign(y,{key:y.id,isDirectory:y.isDirectory===1,length:d(y.length)})),c.value=f.length}).catch(f=>{t.value=!1,T.error(f.message)})},s=()=>{C()},n=f=>{var y;u.value=(y=f.order)!=null?y:"",i.value=f.sort,C()},g=f=>{l([...m.value,f])},l=f=>{var y,a;m.value=f,r.value=(a=(y=m.value[m.value.length-1])==null?void 0:y.id)!=null?a:0,C()},d=f=>f==null?"-":f<1024?f+"B":f<1024*1024?(f/1024).toFixed(1)+"KB":f<1024*1024*1024?(f/1024/1024).toFixed(1)+"M":(f/1024/1024/1024).toFixed(1)+"G";return C(),(f,y)=>{const a=Pe,M=De,I=Ue;return h(),w(I,{"multi-card":!1},{default:k(()=>[_(M,{"body-style":{padding:0}},{default:k(()=>[b("div",on,[_(zt,{grid:v.value,"onUpdate:grid":y[0]||(y[0]=V=>v.value=V),selections:p.value,parentId:r.value,onDone:s},null,8,["grid","selections","parentId"]),_(Jt,{total:c.value,directorys:m.value,"onUpdate:directorys":l},null,8,["total","directorys"])]),_(a,{loading:t.value},{default:k(()=>[_(nn,{grid:v.value,data:o.value,sort:i.value,order:u.value,parentId:r.value,selections:p.value,"onUpdate:selections":y[1]||(y[1]=V=>p.value=V),onSortChange:n,onGoDirectory:g,onDone:s},null,8,["grid","data","sort","order","parentId","selections"])]),_:1},8,["loading"])]),_:1})]),_:1})}}});export{Cn as default};
