import{s as P,fG as F,_ as K,fA as L,aL as D,r as u,a as G,H as Q,fH as S,l as k,b as a,w as n,aM as X,E as _,u as s,o as f,d,e as C,t as v,c as J,aj as W,fI as Y,bt as Z,a7 as ee,cM as oe,aF as ae,dX as te,h as se,aH as le,aG as ne,aO as re,aB as ie,aK as de,g as ce}from"./index-BF2fBoPb.js";import{i as ue}from"./index-Cjr4ibGp.js";import{i as me}from"./index-D1S9E-DC.js";import{i as pe}from"./index-wNuulKXY.js";async function ge(i){var g;const o=await P.post("/login",i);return o.data.code===0?(F((g=o.data.data)==null?void 0:g.access_token,i.remember),o.data.message):Promise.reject(new Error(o.data.message))}async function _e(){const i=await P.get("/captcha");return i.data.code===0&&i.data.data?i.data.data:Promise.reject(new Error(i.data.message))}const fe={class:"login-wrapper"},ve={class:"login-body"},be={class:"login-captcha-group"},xe=["src"],he={key:1,class:"login-qrcode-group"},ye={__name:"index",setup(i){const{t:o}=L.useI18n(),{currentRoute:g}=X(),{goHomeRoute:R,cleanPageTabs:U}=D(),b=u(1),x=u(),h=u(!1),l=G({tenantId:4,username:"admin",password:"admin",code:"",remember:!0}),z=Q(()=>({username:[{required:!0,message:o("login.username"),type:"string",trigger:"blur"}],password:[{required:!0,message:o("login.password"),type:"string",trigger:"blur"}],code:[{required:!0,message:o("login.code"),type:"string",trigger:"blur"}]})),y=u(""),E=u(""),q=u(""),I=()=>{var t,e;(e=(t=x.value)==null?void 0:t.validate)==null||e.call(t,c=>{if(!c)return!1;if(l.code.toLowerCase()!==E.value){_.error("验证码错误");return}h.value=!0,ge(l).then(m=>{_.success(m),U(),B()}).catch(m=>{h.value=!1,_.error(m.message),w()})})},w=()=>{_e().then(t=>{var e,c;y.value=t.base64,E.value=t.text,l.code=t.text,(c=(e=x.value)==null?void 0:e.clearValidate)==null||c.call(e)}).catch(t=>{_.error(t.message)})},T=()=>{q.value=`https://api.eleadmin.com/v2/auth/login?code=${Date.now()}`},H=t=>{t===2&&T()},B=()=>{const{query:t}=s(g);R(t.from)};return S()?B():w(),(t,e)=>{const c=se,m=me,V=le,p=ne,O=re,$=ie,j=de,M=pe,N=ce,A=ue;return f(),k("div",fe,[a(A,{shadow:"always",class:"login-card"},{default:n(()=>[e[6]||(e[6]=d("div",{class:"login-cover"},[d("h1",{class:"login-title"},"EleAdmin Plus"),d("h4",{class:"login-subtitle"},"界面美观组件丰富的中后台前端解决方案")],-1)),d("div",ve,[a(c,{type:"heading",style:{"font-size":"24px","margin-bottom":"18px"}},{default:n(()=>[C(v(s(o)("login.title")),1)]),_:1}),a(m,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=r=>b.value=r),items:[{label:s(o)("login.passwordType"),value:1},{label:s(o)("login.qrcodeType"),value:2}],style:{"margin-bottom":"18px"},onChange:H},null,8,["modelValue","items"]),b.value==1?(f(),J(j,{key:0,ref_key:"formRef",ref:x,size:"large",model:l,rules:z.value,onKeyup:oe(I,["enter"]),onSubmit:e[5]||(e[5]=ae(()=>{},["prevent"]))},{default:n(()=>[a(p,{prop:"username"},{default:n(()=>[a(V,{clearable:"",modelValue:l.username,"onUpdate:modelValue":e[1]||(e[1]=r=>l.username=r),placeholder:s(o)("login.username"),"prefix-icon":s(W)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),a(p,{prop:"password"},{default:n(()=>[a(V,{"show-password":"",modelValue:l.password,"onUpdate:modelValue":e[2]||(e[2]=r=>l.password=r),placeholder:s(o)("login.password"),"prefix-icon":s(Y)},null,8,["modelValue","placeholder","prefix-icon"])]),_:1}),a(p,{prop:"code"},{default:n(()=>[d("div",be,[a(V,{clearable:"",modelValue:l.code,"onUpdate:modelValue":e[3]||(e[3]=r=>l.code=r),placeholder:s(o)("login.code"),"prefix-icon":s(Z)},null,8,["modelValue","placeholder","prefix-icon"]),d("div",{class:"login-captcha",onClick:w},[y.value?(f(),k("img",{key:0,src:y.value},null,8,xe)):ee("",!0)])])]),_:1}),a(p,null,{default:n(()=>[a(O,{modelValue:l.remember,"onUpdate:modelValue":e[4]||(e[4]=r=>l.remember=r)},{default:n(()=>[C(v(s(o)("login.remember")),1)]),_:1},8,["modelValue"])]),_:1}),a(p,null,{default:n(()=>[a($,{size:"large",type:"primary",loading:h.value,style:{width:"100%"},onClick:I},{default:n(()=>[C(v(s(o)("login.login")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])):(f(),k("div",he,[a(M,{size:180,margin:2,value:q.value,class:"login-qrcode"},null,8,["value"]),d("div",{style:{"margin-top":"16px",cursor:"pointer"},onClick:T},[a(N,{size:15,style:{"vertical-align":"-2px","margin-right":"6px"}},{default:n(()=>[a(s(te))]),_:1}),d("span",null,v(s(o)("login.refreshQrcode")),1)])]))])]),_:1})])}}},Ee=K(ye,[["__scopeId","data-v-631424b8"]]);export{Ee as default};
