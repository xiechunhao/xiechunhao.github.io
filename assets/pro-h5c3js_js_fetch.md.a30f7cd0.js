import{_ as s,o as a,c as n,O as l}from"./chunks/framework.3a9101bc.js";const i=JSON.parse('{"title":"é‡å­¦ fetch","description":"","frontmatter":{},"headers":[],"relativePath":"pro-h5c3js/js/fetch.md","filePath":"pro-h5c3js/js/fetch.md","lastUpdated":1693814028000}'),o={name:"pro-h5c3js/js/fetch.md"},p=l(`<h1 id="é‡å­¦-fetch" tabindex="-1">é‡å­¦ fetch <a class="header-anchor" href="#é‡å­¦-fetch" aria-label="Permalink to &quot;é‡å­¦ fetch&quot;">â€‹</a></h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>fetch æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚è¯¥åè®®ä½¿ç”¨ HTTP è¯·æ±‚å’Œå“åº”è¿›è¡Œé€šä¿¡ï¼Œä¸ä¼ ç»Ÿçš„ AJAX æ–¹å¼ç›¸æ¯”ï¼Œfetch æ›´åŠ ç®€å•æ˜“ç”¨ï¼Œå¹¶æä¾›äº†è®¸å¤šç°ä»£åŒ–çš„åŠŸèƒ½ã€‚</p></div><h2 id="_1-fetch-ä»‹ç»" tabindex="-1">1. fetch ä»‹ç» <a class="header-anchor" href="#_1-fetch-ä»‹ç»" aria-label="Permalink to &quot;1. fetch ä»‹ç»&quot;">â€‹</a></h2><p>ä½¿ç”¨ fetch å¯ä»¥æ–¹ä¾¿åœ°å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ä½¿ç”¨ fetch è·å–æ–‡æœ¬ã€JSONã€å›¾åƒå’Œæ–‡ä»¶ç­‰æ•°æ®ï¼Œå¹¶è¿›è¡Œå„ç§å¤„ç†ã€‚fetch è¿˜æ”¯æŒæµå¼ä¼ è¾“å’Œå–æ¶ˆè¯·æ±‚ç­‰é«˜çº§åŠŸèƒ½ï¼Œä½¿å¾—å¤„ç†å¤§å‹æ•°æ®é›†å’Œé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œå˜å¾—æ›´åŠ ç®€å•å’Œå¯é ã€‚</p><p>fetch API ä¹Ÿæ˜¯ Javascript ä¸­å¸¸ç”¨çš„ API ä¹‹ä¸€ï¼Œå®ƒæä¾›äº†ä¸€ç»„æ–¹æ³•å’Œå±æ€§ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ç«¯ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚é€šè¿‡ fetch APIï¼Œä½ å¯ä»¥è½»æ¾åœ°ä½¿ç”¨ fetch åè®®è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå¹¶å¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œæ“ä½œå’Œå¤„ç†ã€‚</p><h3 id="_1-1-fetch-å¯¹æ¯”-xhr" tabindex="-1">1.1 fetch å¯¹æ¯” XHR <a class="header-anchor" href="#_1-1-fetch-å¯¹æ¯”-xhr" aria-label="Permalink to &quot;1.1 fetch å¯¹æ¯” XHR&quot;">â€‹</a></h3><p><code>fetch</code> å’Œ <code> XMLHttpRequestï¼ˆXHRï¼‰</code> éƒ½æ˜¯å‰ç«¯ä¸æœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤äº’çš„å¸¸ç”¨æ–¹å¼ï¼Œå®ƒä»¬å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸‹é¢æ˜¯å®ƒä»¬çš„æ¯”è¾ƒï¼š</p><ol><li><p>API è®¾è®¡å’Œä½¿ç”¨æ–¹å¼</p><ul><li>â€¢ fetch çš„ API è®¾è®¡æ›´åŠ ç°ä»£åŒ–ã€ç®€æ´å’Œæ˜“äºä½¿ç”¨ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ ç›´è§‚å’Œæ–¹ä¾¿ ğŸ‘</li><li>â€¢ XHR çš„ API è®¾è®¡æ¯”è¾ƒç¹çï¼Œéœ€è¦è¿›è¡Œå¤šä¸ªå‚æ•°çš„é…ç½®å’Œå›è°ƒå‡½æ•°çš„å¤„ç†ã€‚</li></ul></li><li><p>æ”¯æŒçš„è¯·æ±‚æ–¹æ³•</p><ul><li>â€¢ fetch API é»˜è®¤åªæ”¯æŒ GET å’Œ POST è¯·æ±‚æ–¹æ³•</li><li>â€¢ XHR åˆ™æ”¯æŒæ‰€æœ‰æ ‡å‡†çš„ HTTP è¯·æ±‚æ–¹æ³• ğŸ‘</li></ul></li><li><p>è¯·æ±‚å¤´éƒ¨</p><ul><li>â€¢ åœ¨ fetch ä¸­è®¾ç½®è¯·æ±‚å¤´éƒ¨çš„æ–¹å¼æ›´åŠ æ¸…æ™°å’Œç›´æ¥ï¼Œå¯ä»¥é€šè¿‡ Headers å¯¹è±¡è¿›è¡Œè®¾ç½® ğŸ‘</li><li>â€¢ è€Œ XHR çš„æ–¹å¼ç›¸å¯¹è¾ƒä¸ºç¹ç</li></ul></li><li><p>è¯·æ±‚ä½“</p><ul><li>â€¢ åœ¨å‘é€ POST è¯·æ±‚æ—¶ï¼Œfetch API è¦æ±‚å°†è¯·æ±‚ä½“æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™ fetch æ–¹æ³•ä¸­çš„ options å¯¹è±¡</li><li>â€¢ XHR å¯ä»¥ç›´æ¥åœ¨ send() æ–¹æ³•ä¸­è®¾ç½®è¯·æ±‚ä½“æ•°æ®</li></ul></li><li><p>æ”¯æŒçš„æ•°æ®ç±»å‹</p><ul><li>â€¢ åœ¨è§£æå“åº”æ•°æ®æ—¶ï¼Œfetch API æä¾›äº†å¤šç§æ–¹æ³•ï¼ŒåŒ…æ‹¬ .json(), .blob(), .arrayBuffer() ğŸ‘</li><li>â€¢ XHR åªæ”¯æŒæ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ•°æ®ä¸¤ç§æ•°æ®ç±»å‹</li></ul></li><li><p>è·¨åŸŸè¯·æ±‚</p><ul><li>â€¢ åœ¨è¿›è¡Œè·¨åŸŸè¯·æ±‚æ—¶ï¼Œfetch API æä¾›äº†ä¸€ç§ç®€å•è€Œå¼ºå¤§çš„è§£å†³æ–¹æ¡ˆâ€”â€”ä½¿ç”¨ CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰å¤´éƒ¨å®ç°è·¨åŸŸè¯·æ±‚ ğŸ‘</li><li>â€¢ XHR åˆ™ä½¿ç”¨äº†ä¸€ä¸ªå«åš XMLHttpRequest Level 2 çš„è§„èŒƒï¼Œåœ¨ä»£ç ç¼–å†™ä¸Šç›¸å¯¹è¾ƒä¸ºç¹ç</li></ul></li></ol><blockquote><p>æ€»çš„æ¥è¯´ï¼Œfetch API ä¸ XHR å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œå…·ä½“é€‰æ‹©å“ªç§æ–¹å¼è¿˜éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œè€ƒè™‘ã€‚å¹³æ—¶å¼€å‘ä¸­ä½¿ç”¨è¾ƒå¤šçš„æ˜¯ fetch ï¼Œå› ä¸ºå®ƒä½¿ç”¨æ–¹ä¾¿ã€API ç®€æ´ã€è¯­æ³•æ¸…æ™°ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒäº†å¤§å¤šæ•°å¸¸ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç®€åŒ–å‰ç«¯å¼€å‘æµç¨‹ã€‚</p></blockquote><h2 id="_2-fetch-å‘é€è¯·æ±‚" tabindex="-1">2. fetch å‘é€è¯·æ±‚ <a class="header-anchor" href="#_2-fetch-å‘é€è¯·æ±‚" aria-label="Permalink to &quot;2. fetch å‘é€è¯·æ±‚&quot;">â€‹</a></h2><h3 id="_2-1-fetch-è¿”å›æ ¼å¼" tabindex="-1">2.1 fetch è¿”å›æ ¼å¼ <a class="header-anchor" href="#_2-1-fetch-è¿”å›æ ¼å¼" aria-label="Permalink to &quot;2.1 fetch è¿”å›æ ¼å¼&quot;">â€‹</a></h3><ul><li>â€¢ text(): å°†å“åº”ä½“è§£æä¸ºçº¯æ–‡æœ¬å­—ç¬¦ä¸²å¹¶è¿”å›ã€‚</li><li>â€¢ json(): å°†å“åº”ä½“è§£æä¸º JSON æ ¼å¼å¹¶è¿”å›ä¸€ä¸ª JavaScript å¯¹è±¡ã€‚</li><li>â€¢ blob(): å°†å“åº”ä½“è§£æä¸ºäºŒè¿›åˆ¶æ•°æ®å¹¶è¿”å›ä¸€ä¸ª Blob å¯¹è±¡ã€‚</li><li>â€¢ arrayBuffer(): å°†å“åº”ä½“è§£æä¸ºäºŒè¿›åˆ¶æ•°æ®å¹¶è¿”å›ä¸€ä¸ª ArrayBuffer å¯¹è±¡ã€‚</li><li>â€¢ formData(): å°†å“åº”ä½“è§£æä¸º FormData å¯¹è±¡ã€‚</li></ul><h3 id="_2-2-get-è¯·æ±‚" tabindex="-1">2.2 get è¯·æ±‚ <a class="header-anchor" href="#_2-2-get-è¯·æ±‚" aria-label="Permalink to &quot;2.2 get è¯·æ±‚&quot;">â€‹</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:3000/api/txt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">text</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h3 id="_2-3-post-è¯·æ±‚" tabindex="-1">2.3 post è¯·æ±‚ <a class="header-anchor" href="#_2-3-post-è¯·æ±‚" aria-label="Permalink to &quot;2.3 post è¯·æ±‚&quot;">â€‹</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:3000/api/post</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Content-Type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">application/json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">zhangsan</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">age</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">18</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h3 id="_2-3-ä¸­æ–­è¯·æ±‚" tabindex="-1">2.3 ä¸­æ–­è¯·æ±‚ <a class="header-anchor" href="#_2-3-ä¸­æ–­è¯·æ±‚" aria-label="Permalink to &quot;2.3 ä¸­æ–­è¯·æ±‚&quot;">â€‹</a></h3><ol><li>ä½¿ç”¨ <code>AbortController</code> çš„ <code>abort</code>æ–¹æ³•ä¸­æ–­</li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> abort </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AbortController</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:3000/api/post</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">Content-Type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">application/json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">signal</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> abort</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">signal</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">zhangsan</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">age</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">18</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#stop</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">click</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">abort</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h3 id="_2-4-è·å–è¿›åº¦" tabindex="-1">2.4 è·å–è¿›åº¦ <a class="header-anchor" href="#_2-4-è·å–è¿›åº¦" aria-label="Permalink to &quot;2.4 è·å–è¿›åº¦&quot;">â€‹</a></h3><p>ä½¿ç”¨ <code>data.clone()</code> æ–¹æ³•å¤åˆ¶äº†å“åº”å¯¹è±¡ dataï¼Œç„¶åä½¿ç”¨ <code>getReader()</code> æ–¹æ³•è·å–æ•°æ®æµä¸­çš„ reader å¯¹è±¡ï¼Œæ¥ç€é€šè¿‡è¯»å–æ•°æ®æµå¹¶è®¡ç®—å·²åŠ è½½å­—èŠ‚æ•°ï¼Œå®ç°äº†ä¸€ä¸ªåŸºäºåŸç”Ÿ JavaScript çš„è¿›åº¦æ¡åŠŸèƒ½ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> btn </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#send</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> abort </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AbortController</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sendFetch </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:3000/api/txt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    signal</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">abort</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">signal</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//fetch å®ç°è¿›åº¦æ¡</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clone</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reader</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getReader</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">contentLength</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">headers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Content-Length</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">loaded</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">done</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reader</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">done</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">loaded</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">progress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">#progress</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">progress</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">innerHTML</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> ((</span><span style="color:#A6ACCD;">loaded</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">contentLength</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">100</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toFixed</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">text</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">text</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">text</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">btn</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">click</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> sendFetch)</span><span style="color:#89DDFF;">;</span></span></code></pre></div>`,22),e=[p];function t(c,r,F,y,D,A){return a(),n("div",null,e)}const h=s(o,[["render",t]]);export{i as __pageData,h as default};
