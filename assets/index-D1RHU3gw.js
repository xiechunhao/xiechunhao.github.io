import{L as _,eO as F,fa as z,fb as N,g as B,i as T,aj as c,o as g,m as V,a2 as S,c as E,a$ as U,b as p,w as h,aG as w,a8 as $,e as P,t as D,bE as q,b3 as A,r as C,a as G,J as j,a0 as K,a6 as L,a5 as H,aV as Q,n as X,b1 as Y,b2 as Z,dR as x,W as ee,R,E as I,_ as te,u as le,h as oe}from"./index-C4BxmZrN.js";import{E as W}from"./image-viewer-DTf3QW2T.js";import{E as ne}from"./upload-D6XcBL05.js";import{E as ae}from"./progress-Bytq2m9M.js";import{u as J}from"./index-Nq65WDmQ.js";import{V as se}from"./vuedraggable.umd-BuphSp9t.js";const ie=_({name:"ListItem",components:{CloseOutlined:F,SyncOutlined:z,FileOutlined:N,ElImage:W,ElProgress:ae,ElIcon:B,EleTooltip:T},props:{item:{type:Object,required:!0},readonly:Boolean,disabled:Boolean,imageProps:Object,progressProps:Object,locale:{type:Object,required:!0}},emits:{itemClick:e=>!0,remove:e=>!0,retry:e=>!0},setup(e,{emit:i}){return{onRemove:()=>{i("remove",e.item)},onItemClick:()=>{i("itemClick",e.item)},onRetry:()=>{i("retry",e.item)}}}}),re=(e,i)=>{const d=e.__vccOpts||e;for(const[r,u]of i)d[r]=u;return d},ue=["title"],me={key:1,class:"ele-upload-thumbnail"},de={key:1,class:"ele-upload-progress"},pe={class:"ele-upload-text"},ce={key:0,class:"ele-upload-tools"};function fe(e,i,d,r,u,o){const y=c("ElImage"),v=c("FileOutlined"),f=c("ElIcon"),O=c("CloseOutlined"),b=c("ElProgress"),a=c("SyncOutlined"),n=c("EleTooltip");return g(),V("div",{title:e.item.name,class:"ele-upload-item",onClick:i[2]||(i[2]=(...t)=>e.onItemClick&&e.onItemClick(...t))},[S(e.$slots,"thumbnail",{item:e.item},()=>[e.item.url?(g(),E(y,U({key:0,fit:"cover"},e.imageProps||{},{src:e.item.url}),null,16,["src"])):(g(),V("div",me,[p(f,null,{default:h(()=>[p(v)]),_:1})]))]),!e.readonly&&!e.disabled&&!e.item.readonly?(g(),V("div",{key:0,class:"ele-upload-remove",onClick:i[0]||(i[0]=w((...t)=>e.onRemove&&e.onRemove(...t),["stop"]))},[S(e.$slots,"remove",{item:e.item},()=>[p(f,null,{default:h(()=>[p(O,{style:{transform:"scale(0.92)","transform-origin":"top right"}})]),_:1})])])):$("",!0),e.item.status==="uploading"||e.item.status==="exception"?(g(),V("div",de,[S(e.$slots,"progress",{item:e.item},()=>[P("div",pe,D(e.item.status=="exception"?e.locale.exception:e.locale.uploading),1),p(b,U({showText:!1},e.progressProps||{},{percentage:e.item.progress,status:e.item.status==="exception"?"exception":void 0}),null,16,["percentage","status"]),e.disabled?$("",!0):(g(),V("div",ce,[e.item.status==="exception"?(g(),V("div",{key:0,class:"ele-upload-retry",onClick:i[1]||(i[1]=w((...t)=>e.onRetry&&e.onRetry(...t),["stop"]))},[p(n,{content:e.locale.retry,placement:"top"},{default:h(()=>[p(f,null,{default:h(()=>[p(a)]),_:1})]),_:1},8,["content"])])):$("",!0)]))])])):$("",!0)],8,ue)}const ge=re(ie,[["render",fe]]),ye={modelValue:{type:Array,required:!0},readonly:Boolean,disabled:Boolean,preview:{type:Boolean,default:!0},limit:Number,multiple:Boolean,drag:Boolean,accept:{type:String,default:"image/png,image/jpeg"},itemStyle:Object,buttonStyle:Object,sortable:{type:[Boolean,Object],default:!0},imageProps:Object,progressProps:Object,previewProps:Object,locale:Object},ve={"update:modelValue":e=>!0,itemClick:e=>!0,upload:e=>!0,remove:e=>!0,retry:e=>!0},be=_({name:"EleUploadList",components:{VueDraggable:se,ElUpload:ne,ElImage:W,ElIcon:B,PlusOutlined:q,ListItem:ge},props:ye,emits:ve,setup(e,{emit:i}){const{lang:d}=A("upload",e),r=C(null),u=G({visible:!1,current:"",currentIndex:0,images:[]}),o=j(()=>!e.readonly&&!(typeof e.limit=="number"&&e.limit>0&&e.modelValue!=null&&e.modelValue.length>=e.limit)),y=j(()=>{const n={itemKey:"key",animation:300,setData:()=>{},modelValue:e.modelValue,draggable:".ele-draggable",class:["ele-upload-list",{"is-disabled":e.disabled}]};return typeof e.sortable=="boolean"||e.sortable==null?n:Object.assign(n,e.sortable)}),v=n=>{i("update:modelValue",n)},f=n=>{if(!o.value||e.disabled)return!1;const t={key:x(),name:n.name,status:void 0,progress:0,file:n};return n.type.startsWith("image")&&(t.url=window.URL.createObjectURL(n)),i("upload",t),!1},O=n=>{i("remove",n)},b=n=>{if(e.preview&&n.url&&e.modelValue!=null){const t=e.modelValue.filter(s=>!!s.url),l=t.findIndex(s=>s.key===n.key);l!==-1&&(u.images=t.map(s=>s.url),u.current=n.url,u.currentIndex=l,u.visible=!0,ee(()=>{var s;const m=(s=r.value)==null?void 0:s.$el;if(m){const k=m.querySelector("img");k&&k.click()}}))}i("itemClick",n)},a=n=>{i("retry",n)};return K(()=>{u.visible=!1}),{lang:d,previewRef:r,previewOption:u,uploadEnable:o,draggableProps:y,updateModelValue:v,onUpload:f,onItemRemove:O,onItemClick:b,onItemRetry:a}}}),he=(e,i)=>{const d=e.__vccOpts||e;for(const[r,u]of i)d[r]=u;return d},Oe={style:{display:"none"}};function ke(e,i,d,r,u,o){const y=c("ListItem"),v=c("PlusOutlined"),f=c("ElIcon"),O=c("ElUpload"),b=c("ElImage"),a=c("VueDraggable");return g(),E(a,U(e.draggableProps,{"onUpdate:modelValue":e.updateModelValue}),{item:h(({element:n})=>[p(y,{item:n,readonly:e.readonly,disabled:e.disabled,progressProps:e.progressProps,imageProps:e.imageProps,locale:e.lang,style:L(e.itemStyle),class:H({"ele-draggable":e.sortable&&!e.readonly&&!e.disabled&&e.limit!==1}),onItemClick:e.onItemClick,onRemove:e.onItemRemove,onRetry:e.onItemRetry},Q({_:2},[X(Object.keys(e.$slots),t=>({name:t,fn:h(l=>[S(e.$slots,t,Y(Z(l||{})))])}))]),1032,["item","readonly","disabled","progressProps","imageProps","locale","style","class","onItemClick","onRemove","onRetry"])]),footer:h(()=>[e.uploadEnable?(g(),V("div",{key:0,style:L(e.buttonStyle),class:"ele-upload-item ele-upload-button"},[p(O,{action:"",drag:e.drag,accept:e.accept,multiple:e.multiple,disabled:e.disabled,showUploadList:!1,beforeUpload:e.onUpload},{default:h(()=>[S(e.$slots,"icon",{},()=>[p(f,{class:"ele-upload-icon"},{default:h(()=>[p(v)]),_:1})])]),_:3},8,["drag","accept","multiple","disabled","beforeUpload"])],4)):$("",!0),P("div",Oe,[e.previewOption.visible?(g(),E(b,U({key:0,hideOnClickModal:!0,previewTeleported:!0},e.previewProps||{},{ref:"previewRef",src:e.previewOption.current,previewSrcList:e.previewOption.images,initialIndex:e.previewOption.currentIndex}),null,16,["src","previewSrcList","initialIndex"])):$("",!0)])]),_:3},16,["onUpdate:modelValue"])}const M=he(be,[["render",ke]]),we={__name:"index",props:{modelValue:String,limit:Number,fileLimit:{type:Number,default:20},itemStyle:Object,buttonStyle:Object},emits:["update:modelValue","change"],setup(e,{expose:i,emit:d}){const r=e,u=d,o=C([]),y=(a,n)=>{if(!a.file)return;if(!a.file.type.startsWith("image")){I.error("只能选择图片");return}if(a.file.size/1024/1024>r.fileLimit){I.error(`大小不能超过 ${r.fileLimit}MB`);return}n||o.value.push({...a});const t=o.value.find(l=>l.key===a.key);t&&(t.status="uploading",J(a.file,{onUploadProgress:l=>{l.total!=null&&(t.progress=l.loaded/l.total*100)}}).then(l=>{t.status="done",t.url=l.url}).catch(l=>{t.status="exception",I.error(l.message)}))},v=a=>{o.value.splice(o.value.indexOf(a),1)},f=a=>{r.modelValue!==a&&(u("update:modelValue",a),u("change",a))},O=()=>!o.value.some(a=>a.status!=="done"),b=()=>o.value.map(a=>a.url);return R(o,()=>{const a=b();if(r.limit===1){f(a.join());return}f(a.length?JSON.stringify(a):"")},{deep:!0}),R(()=>r.modelValue,a=>{if(!a){o.value.length&&(o.value=[]);return}if(r.limit===1){if(o.value.length===1&&o.value[0].url===a)return;o.value=[{key:`0-${a}`,url:a,status:"done"}];return}try{const n=JSON.parse(a);if(n.length===o.value.length&&JSON.stringify(b())===a)return;o.value=n.map((t,l)=>({key:`${l}-${t}`,url:t,status:"done"}))}catch(n){console.error(n),o.value=[]}},{immediate:!0}),i({isDone:O}),(a,n)=>{const t=M;return g(),E(t,{limit:e.limit,drag:!0,modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=l=>o.value=l),"item-style":e.itemStyle,"button-style":e.buttonStyle,onUpload:y,onRetry:n[1]||(n[1]=l=>y(l,!0)),onRemove:v},null,8,["limit","modelValue","item-style","button-style"])}}},Ve={class:"ele-upload-thumbnail"},Ie={class:"ele-attachment-text"},$e={__name:"index",props:{modelValue:String,limit:Number,fileLimit:{type:Number,default:20},itemStyle:Object,buttonStyle:Object,accept:{type:String,default:""}},emits:["update:modelValue","change"],setup(e,{expose:i,emit:d}){const r=e,u=d,o=C([]),y=(t,l)=>{if(!t.file)return;if(r.accept==="image/*"){if(!t.file.type.startsWith("image")){I.error("只能选择图片");return}}else if(r.accept===".xls,.xlsx"&&!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(t.file.type))return I.error("只能选择 excel 文件"),!1;if(t.file.size/1024/1024>r.fileLimit){I.error(`大小不能超过 ${r.fileLimit}MB`);return}l||o.value.push({...t});const s=o.value.find(m=>m.key===t.key);s&&(s.status="uploading",J(t.file,{onUploadProgress:m=>{m.total!=null&&(s.progress=m.loaded/m.total*100)}}).then(m=>{s.status="done",s.name=m.name,s.fileUrl=m.url,v(s.fileUrl)&&(s.url=s.fileUrl)}).catch(m=>{s.status="exception",I.error(m.message)}))},v=t=>t?t.endsWith(".png")||t.endsWith(".jpg")||t.endsWith(".jpeg")||t.endsWith(".gif")||t.endsWith(".svg"):!1,f=t=>{o.value.splice(o.value.indexOf(t),1)},O=t=>{!t.url&&t.fileUrl&&window.open(t.fileUrl)},b=t=>{r.modelValue!==t&&(u("update:modelValue",t),u("change",t))},a=()=>!o.value.some(t=>t.status!=="done"),n=()=>o.value.map(t=>{var l;return{url:(l=t.fileUrl)!=null?l:t.url,name:t.name}});return R(o,()=>{const t=n();if(r.limit===1){b(t.length?JSON.stringify(t[0]):"");return}b(t.length?JSON.stringify(t):"")},{deep:!0}),R(()=>r.modelValue,t=>{if(!t){o.value.length&&(o.value=[]);return}if(r.limit===1){const l=JSON.parse(t);if(o.value.length===1&&o.value[0].fileUrl===l.url&&o.value[0].name===l.name)return;o.value=[{key:`0-${l.url}`,name:l.name,fileUrl:l.url,url:v(l.url)?l.url:void 0,status:"done"}];return}try{const l=JSON.parse(t);if(l.length===o.value.length&&JSON.stringify(n())===t)return;o.value=l.map((s,m)=>({key:`${m}-${s.url}`,name:s.name,fileUrl:s.url,url:v(s.url)?s.url:void 0,status:"done"}))}catch(l){console.error(l),o.value=[]}},{immediate:!0}),i({isDone:a}),(t,l)=>{const s=oe,m=M;return g(),E(m,{limit:e.limit,drag:!0,modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=k=>o.value=k),"item-style":e.itemStyle,"button-style":e.buttonStyle,accept:e.accept,"progress-props":{strokeWidth:2},sortable:{forceFallback:!0},class:"ele-attachment-upload",onUpload:y,onRetry:l[1]||(l[1]=k=>y(k,!0)),onRemove:f,onItemClick:O},{thumbnail:h(({item:k})=>[P("div",Ve,[p(s,{size:"md",icon:le(N),type:"secondary",style:{"margin-right":"6px","line-height":"1"}},null,8,["icon"]),P("div",Ie,D(k.name),1)])]),_:1},8,["limit","modelValue","item-style","button-style","accept"])}}},je=te($e,[["__scopeId","data-v-5585b048"]]);export{je as F,we as _,M as i};
