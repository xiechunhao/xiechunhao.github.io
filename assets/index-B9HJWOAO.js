import{i as R}from"./index-p1XoTQj1.js";import{b4 as K,r as E,o as b,c as g,w as o,b as a,cM as C,aF as D,u as h,e as p,aH as F,aG as O,aB as v,aK as B,s as V,a as P,bb as $,a7 as j,E as T,aX as z,aW as I,k as L}from"./index-BF2fBoPb.js";import{i as W}from"./index-Cjr4ibGp.js";import{i as Y}from"./index-DG03PXF-.js";import"./index-CcYpqHDV.js";import"./index-B-b3I1wI.js";import"./index-BnIMXyIx.js";import"./virtual-list-B6G0p9cv.js";import"./index-BWYZqqjh.js";import"./index-DuliLu7F.js";import{E as U,a as G}from"./col-DirwGu8S.js";import{E as H}from"./date-picker-BzLnEAo6.js";import"./isArrayLikeObject-j402kJv_.js";import"./vuedraggable.umd-DLnsjw3h.js";import"./arrays-6TrVLtTe.js";import"./index-DOwINDGR.js";const X={__name:"login-record-search",props:{where:Object},emits:["search"],setup(c,{emit:s}){const y=c,w=s,[u,k]=K({username:"",nickname:"",...y.where||{}}),f=E(["",""]),r=()=>{const[l,e]=f.value||[];w("search",{...u,createTimeStart:l?`${l} 00:00:00`:"",createTimeEnd:e?`${e} 23:59:59`:""})},t=()=>{k(),f.value=["",""],r()};return(l,e)=>{const _=F,m=O,d=U,i=H,n=v,S=G,M=B,N=W;return b(),g(N,{"body-style":{paddingBottom:"2px"}},{default:o(()=>[a(M,{"label-width":"72px",onKeyup:C(r,["enter"]),onSubmit:e[3]||(e[3]=D(()=>{},["prevent"]))},{default:o(()=>[a(S,{gutter:8},{default:o(()=>[a(d,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[a(m,{label:"用户账号"},{default:o(()=>[a(_,{clearable:"",modelValue:h(u).username,"onUpdate:modelValue":e[0]||(e[0]=x=>h(u).username=x),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(d,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[a(m,{label:"用户名"},{default:o(()=>[a(_,{clearable:"",modelValue:h(u).nickname,"onUpdate:modelValue":e[1]||(e[1]=x=>h(u).nickname=x),modelModifiers:{trim:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1}),a(d,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[a(m,{label:"登录时间"},{default:o(()=>[a(i,{"unlink-panels":"",type:"daterange",modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=x=>f.value=x),"range-separator":"-","value-format":"YYYY-MM-DD","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"ele-fluid"},null,8,["modelValue"])]),_:1})]),_:1}),a(d,{lg:6,md:12,sm:12,xs:24},{default:o(()=>[a(m,{"label-width":"16px"},{default:o(()=>[a(n,{type:"primary",onClick:r},{default:o(()=>e[4]||(e[4]=[p("查询")])),_:1}),a(n,{onClick:t},{default:o(()=>e[5]||(e[5]=[p("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}};async function q(c){const s=await V.get("/system/login-record/page",{params:c});return s.data.code===0?s.data.data:Promise.reject(new Error(s.data.message))}async function A(c){const s=await V.get("/system/login-record",{params:c});return s.data.code===0&&s.data.data?s.data.data:Promise.reject(new Error(s.data.message))}const J={name:"SystemLoginRecord"},fe=Object.assign(J,{setup(c){const s=P({username:"",nickname:""}),y=E(null),w=E([{type:"index",columnKey:"index",width:50,align:"center",fixed:"left"},{prop:"username",label:"账号",sortable:"custom",minWidth:110},{prop:"nickname",label:"用户名",sortable:"custom",minWidth:110},{prop:"ip",label:"IP地址",sortable:"custom",minWidth:110},{prop:"device",label:"设备型号",sortable:"custom",minWidth:110},{prop:"os",label:"操作系统",sortable:"custom",minWidth:110},{prop:"browser",label:"浏览器",sortable:"custom",minWidth:110},{prop:"loginType",label:"操作类型",sortable:"custom",width:130,slot:"loginType",filters:[{text:"登录成功",value:"0"},{text:"登录失败",value:"1"},{text:"退出登录",value:"2"},{text:"刷新TOKEN",value:"3"}],filterMultiple:!1},{prop:"comments",label:"备注",sortable:"custom",minWidth:110},{prop:"createTime",label:"登录时间",sortable:"custom",minWidth:110}]),u=({pages:r,where:t,orders:l,filters:e})=>q({...t,...l,...e,...r}),k=r=>{var t,l;(l=(t=y.value)==null?void 0:t.reload)==null||l.call(t,{page:1,where:r})},f=()=>{var l,e;const r=[["账号","用户名","IP地址","设备型号","操作系统","浏览器","操作类型","备注","登录时间"]],t=T.loading("请求中..");(e=(l=y.value)==null?void 0:l.fetch)==null||e.call(l,({where:_,orders:m,filters:d})=>{A({..._,...m,...d}).then(i=>{t.close(),i.forEach(n=>{r.push([n.username,n.nickname,n.ip,n.device,n.os,n.browser,["登录成功","登录失败","退出登录","刷新TOKEN"][n.loginType],n.comments,n.createTime])}),z({SheetNames:["Sheet1"],Sheets:{Sheet1:I.aoa_to_sheet(r)}},"登录日志.xlsx")}).catch(i=>{t.close(),T.error(i.message)})})};return(r,t)=>{const l=v,e=L,_=Y,m=W,d=R;return b(),g(d,null,{default:o(()=>[a(X,{where:s,onSearch:k},null,8,["where"]),a(m,{"body-style":{paddingTop:"8px"}},{default:o(()=>[a(_,{ref_key:"tableRef",ref:y,"row-key":"id",columns:w.value,datasource:u,"show-overflow-tooltip":!0,"highlight-current-row":!0,"export-config":{fileName:"登录日志数据"},where:s,"cache-key":"systemLoginRecordTable"},{toolbar:o(()=>[a(l,{type:"primary",class:"ele-btn-icon",icon:h($),onClick:f},{default:o(()=>t[0]||(t[0]=[p(" 导出 ")])),_:1},8,["icon"])]),loginType:o(({row:i})=>[i.loginType===0?(b(),g(e,{key:0,size:"small",type:"success","disable-transitions":!0},{default:o(()=>t[1]||(t[1]=[p(" 登录成功 ")])),_:1})):i.loginType===1?(b(),g(e,{key:1,size:"small",type:"danger","disable-transitions":!0},{default:o(()=>t[2]||(t[2]=[p(" 登录失败 ")])),_:1})):i.loginType===2?(b(),g(e,{key:2,size:"small",type:"info","disable-transitions":!0},{default:o(()=>t[3]||(t[3]=[p(" 退出登录 ")])),_:1})):i.loginType===3?(b(),g(e,{key:3,size:"small",type:"warning","disable-transitions":!0},{default:o(()=>t[4]||(t[4]=[p(" 刷新TOKEN ")])),_:1})):j("",!0)]),_:1},8,["columns","where"])]),_:1})]),_:1})}}});export{fe as default};
